<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FSPathExplorer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">60_sugar</a> &gt; <a href="index.source.html" class="el_package">net.sf.sugar.fspath.cli</a> &gt; <span class="el_source">FSPathExplorer.java</span></div><h1>FSPathExplorer.java</h1><pre class="source lang-java linenums">/**
 * Copyright 2008 (C) Keith Bishop (bishi@users.sourceforge.net) 
 * 
 * All rights reserved.
 * 
 * This file is part of FSPath.
 * 
 * FSPath is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * FSPath is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with FSPath.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

package net.sf.sugar.fspath.cli;
/*
 * FSPathExplorer.java
 *
 * Created on 04 April 2008, 16:36
 *
 * To change this template, choose Tools | Template Manager
 * and open the template in the editor.
 */

import java.io.File;
import java.io.IOException;
import java.io.PrintStream;
import java.util.HashMap;
import java.util.Map;
import net.sf.sugar.fspath.FSPath;
import net.sf.sugar.fspath.FSPathAttributes;
import net.sf.sugar.fspath.FSPathFactory;
import net.sf.sugar.fspath.FSPathResult;
import net.sf.sugar.fspath.FSPathResultList;


/**
 *  This is a simple command line tool for interacting with the filesystem
 *
 * @author kbishop
 */
public class FSPathExplorer {
   
    private File rootPath;
    
<span class="fc" id="L53">    private String fsPathQuery = &quot;&quot;;</span>
    
    private FSPath fsPath;
    
    private Prompt prompt;
    
    private PrintStream out;
    
    private PrintStream err;
    
<span class="fc" id="L63">    private enum Opt {</span>
<span class="fc" id="L64">        path, p, find, f</span>
    }
    
    /** Creates a new instance of FSPathExplorer */
<span class="fc" id="L68">    public FSPathExplorer() {</span>
<span class="fc" id="L69">        this.out = System.out;</span>
<span class="fc" id="L70">        this.err = System.err;</span>
<span class="fc" id="L71">        this.prompt = new Prompt(System.in, out, err);</span>
<span class="fc" id="L72">        this.prompt.setPromptText(&quot;fspath&gt;&quot;);</span>
<span class="fc" id="L73">    }</span>
    
    /**
     * @param args the command line arguments
     */
    public static void main(String[] args) {
        // TODO code application logic here
        
        //checkArgs(args);
        
<span class="fc" id="L83">        showWelcome();</span>
        
<span class="fc" id="L85">        FSPathExplorer explorer = new FSPathExplorer();</span>
        
<span class="fc" id="L87">        explorer.configureExplorer(args);</span>
        
<span class="fc" id="L89">        explorer.createFSPath();</span>
        
<span class="fc" id="L91">        explorer.start();</span>

<span class="fc" id="L93">    }</span>
    
//    protected static void checkArgs(String[] args) {
//        if(args.length &lt; 1) {
//            showUsage();
//            System.exit(1);
//        }
//    }
    
    
//    protected static void showUsage() {
//        
//        StringBuffer usage = new StringBuffer(&quot;usage : java -jar FSPathExplorer [options] &lt;-f|-find&gt; &lt;FSPath_query&gt;&quot;);
//        usage.append(&quot;\n\n\t Options : &quot;)
//               .append(&quot;\n\t\t -path &lt;root_path&gt; : the relative or absolute path of the directory to start from.&quot;)
//               .append(&quot;\n\t\t -p &lt;root_path&gt; :  see -path.&quot;)
//               .append(&quot;\n\n\t Example FSPath queries :&quot;)
//               .append(&quot;\n\t\t //dir[@name = 'var']/dir[@name = 'www']/dir[@name = 'htdocs']/file[contains(name, '.html')]&quot;);
//        
//    }
    
    protected static void showWelcome() {
        
<span class="fc" id="L116">        StringBuffer welcome = </span>
            new StringBuffer(&quot;\n+-------------------------------------------------------+&quot;);
<span class="fc" id="L118">              welcome.append(&quot;\n|                                                       |&quot;)</span>
<span class="fc" id="L119">                     .append(&quot;\n| FSPathExplorer                                        |&quot;)</span>
<span class="fc" id="L120">                     .append(&quot;\n|                                                       |&quot;)</span>
<span class="fc" id="L121">                     .append(&quot;\n+-------------------------------------------------------+\n&quot;)</span>
<span class="fc" id="L122">                     .append(&quot;\nType 'help' for commands...\n&quot;)</span>
<span class="fc" id="L123">                     .append(&quot;\nScanning filesystem metadata...\n&quot;)</span>
<span class="fc" id="L124">                     .append(&quot;\n+-------------------------------------------------------+&quot;)</span>
<span class="fc" id="L125">                     .append(&quot;\n| PLEASE NOTE running FSPathExplorer from the top level |&quot;)</span>
<span class="fc" id="L126">                     .append(&quot;\n| of your filesystem is not advised                     |&quot;)</span>
<span class="fc" id="L127">                     .append(&quot;\n+-------------------------------------------------------+&quot;);</span>
        
<span class="fc" id="L129">        System.out.println(welcome);</span>
<span class="fc" id="L130">    }</span>
    
    protected static void showHelp() {
        
<span class="fc" id="L134">        StringBuffer help = new StringBuffer(&quot;FSPathExplorer help :&quot;);</span>
<span class="fc" id="L135">        help.append(&quot;\n\nEnter an FSPath query to search the filesystem&quot;)</span>
<span class="fc" id="L136">            .append(&quot;\n\nExamples :&quot;)</span>
<span class="fc" id="L137">            .append(&quot;\n\n1) //dir[@name = 'foo'] \n   finds any directory under the current directory named 'foo'&quot;)</span>
<span class="fc" id="L138">            .append(&quot;\n\n2) //dir[@name = 'src']//file[@length &gt; 10000] \n   finds any file which is nested anywhere below a 'src' directory&quot;)</span>
<span class="fc" id="L139">            .append(&quot;\n   with a file size greater than 10000 bytes&quot;)</span>
<span class="fc" id="L140">            .append(&quot;\n\n3) //dir[fs:matches(@name, '^[.].*')] \n   finds all directories in the directory sructure which begin with a '.'&quot;);</span>
            
<span class="fc" id="L142">        help.append(&quot;\n\nAttributes : (see javadoc for java.io.File for more info)&quot;)</span>
<span class="fc" id="L143">            .append(&quot;\n&quot;);</span>
        
<span class="fc bfc" id="L145" title="All 2 branches covered.">        for (FSPathAttributes a : FSPathAttributes.values()) {</span>
<span class="fc bfc" id="L146" title="All 4 branches covered.">            if (!(a.name().equals(&quot;dir&quot;) || a.name().equals(&quot;file&quot;))) {</span>
<span class="fc" id="L147">                help.append(&quot;\n&quot;).append(&quot;@&quot;).append(a);</span>
            }
        }
        
<span class="fc" id="L151">        help.append(&quot;\n\nCommands :\n&quot;);</span>
        
<span class="fc bfc" id="L153" title="All 2 branches covered.">        for (Commands c : Commands.values()) {</span>
<span class="fc" id="L154">            help.append(&quot;\n&quot;).append(c.getCommandText()).append(&quot;\t: &quot;).append(c.getDescription());</span>
        }
        
<span class="fc" id="L157">        System.out.println(help.append(&quot;\n&quot;));</span>
<span class="fc" id="L158">    }</span>
    
    /**
     *  Assumes args is not null or 0 length.
     */
    protected void configureExplorer(String[] args) {
              
<span class="fc" id="L165">        Map&lt;Opt, Integer&gt; arguments = new HashMap&lt;Opt, Integer&gt;();</span>
        
<span class="fc bfc" id="L167" title="All 2 branches covered.">        for (int i = 0; i &lt; args.length; i++) {</span>

<span class="fc bfc" id="L169" title="All 4 branches covered.">            if (args[i].equals(&quot;-&quot; + Opt.p.toString()) || args[i].equals(&quot;-&quot; + Opt.path.toString())) {</span>
<span class="fc" id="L170">                arguments.put(Opt.path, i);</span>
            }
            
<span class="fc bfc" id="L173" title="All 4 branches covered.">            if (args[i].equals(&quot;-&quot; + Opt.f.toString()) || args[i].equals(&quot;-&quot; + Opt.find.toString())){              </span>
<span class="fc" id="L174">                arguments.put(Opt.find, i);</span>
            }
        }
        
<span class="fc" id="L178">        Integer pathIndex = arguments.get(Opt.path);</span>
        
<span class="fc bfc" id="L180" title="All 2 branches covered.">        if (pathIndex != null) {</span>
<span class="fc" id="L181">            this.rootPath = new File(args[pathIndex.intValue() + 1]);</span>
        }  
        
<span class="fc" id="L184">        Integer queryIndex = arguments.get(Opt.find);</span>
        
<span class="fc bfc" id="L186" title="All 2 branches covered.">        if (queryIndex != null) {</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">            for(int i = (queryIndex + 1); i &lt; args.length; i++) {</span>
<span class="fc" id="L188">                this.fsPathQuery += args[i];</span>
            }
        } 
        
<span class="fc" id="L192">    }</span>
    
    protected void createFSPath() {
<span class="fc bfc" id="L195" title="All 2 branches covered.">        if (this.rootPath != null) {</span>
<span class="nc" id="L196">            this.fsPath = FSPathFactory.newFSPath(this.rootPath);</span>
        } else {
<span class="fc" id="L198">            this.fsPath = FSPathFactory.newFSPath();</span>
        }

<span class="fc" id="L201">    }</span>
    
    protected void start() {
        
<span class="fc" id="L205">        boolean running = true;</span>
        
<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        while (running) {  </span>

            try {
<span class="fc" id="L210">                String currentExpression = this.prompt.readLine();</span>
                
<span class="fc" id="L212">                String[] expressionWords = currentExpression.split(&quot; &quot;);</span>
                
<span class="pc bpc" id="L214" title="1 of 4 branches missed.">                if (expressionWords[0] != null &amp;&amp; Commands.isCommand(expressionWords[0])) {</span>

<span class="pc bpc" id="L216" title="1 of 2 branches missed.">                    if (expressionWords[0].equals(Commands.EXIT.getCommandText())) {</span>
<span class="fc" id="L217">                        this.prompt.close();</span>
<span class="fc" id="L218">                        out.println(&quot;exiting.....&quot;);</span>
<span class="fc" id="L219">                        break;</span>
                    }
                    
<span class="nc bnc" id="L222" title="All 2 branches missed.">                    if (expressionWords[0].equals(Commands.PWD.getCommandText())) {</span>
<span class="nc" id="L223">                        out.println(&quot;Current directory : &quot; + this.fsPath.getRootDirectory().getAbsolutePath());</span>
                    }
                    
<span class="nc bnc" id="L226" title="All 2 branches missed.">                    if (expressionWords[0].equals(Commands.CD.getCommandText())) {</span>
                        try {
<span class="nc" id="L228">                            File newDir = new File(expressionWords[1]);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                            if (newDir.exists() </span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">                                &amp;&amp; newDir.isDirectory()</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">                                &amp;&amp; newDir.canRead()) {</span>
                                
<span class="nc" id="L233">                                this.fsPath = FSPathFactory.newFSPath(newDir);</span>
                                
<span class="nc" id="L235">                                out.println(&quot;changed to : &quot; + newDir.getAbsolutePath());</span>
                            }
<span class="nc" id="L237">                        } catch (Throwable t) {</span>
<span class="nc" id="L238">                            out.println(&quot;unable to change to &quot; + expressionWords[1] </span>
                                    + &quot; please make sure that the directory exitst and a is readable&quot;);
<span class="nc" id="L240">                        }</span>
                    }
                    
<span class="nc bnc" id="L243" title="All 2 branches missed.">                    if (expressionWords[0].equals(Commands.HELP.getCommandText())) {</span>
<span class="nc" id="L244">                        showHelp();</span>
                    }
                    
                } else {
                    //assume its an FSPath query and try to execute it
<span class="fc" id="L249">                    this.fsPathQuery = currentExpression;</span>
                    
<span class="fc" id="L251">                    FSPathResultList results = this.fsPath.query(this.fsPathQuery);</span>

<span class="pc bpc" id="L253" title="1 of 2 branches missed.">                    for (FSPathResult result : results) {</span>
<span class="nc" id="L254">                        out.println(result.getFile().getPath());</span>
<span class="nc" id="L255">                    }</span>
                }
          
<span class="fc" id="L258">            } catch (IOException ioe) {</span>
<span class="fc" id="L259">                ioe.printStackTrace();</span>
<span class="fc" id="L260">            }</span>
        }
<span class="fc" id="L262">    }</span>
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>