<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SSHSCPPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">65_gsftp</a> &gt; <a href="index.source.html" class="el_package">mindbright.ssh</a> &gt; <span class="el_source">SSHSCPPanel.java</span></div><h1>SSHSCPPanel.java</h1><pre class="source lang-java linenums">/******************************************************************************
 * Modified by Zhong Li. removed main and set ownerFrame
 * 
 * Copyright (c) 1998,99 by Mindbright Technology AB, Stockholm, Sweden.
 *                 www.mindbright.se, info@mindbright.se
 * HEAVILY modified by ISNetworks, Seattle, WA.
 *                     www.isnetworks.com, info@isnetworks.com
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 *****************************************************************************
 * $Author: webjabber $
 * $Date: 2006/11/06 00:21:55 $
 * $Name:  $
 *****************************************************************************/

/**
 * This class has been completely rewritten from the original.  Its design
 * is based on the LayoutManager tutorial at Sun's Java web site available at
 * http://developer.java.sun.com/developer/onlineTraining/GUI/AWTLayoutMgr/shortcourse.html
 *
 * It implements a WS-FTP-like interface for browsing, manipulating, and transferring
 * files in a secure way over SSH.  It logs into the remote machine using the same
 * account and authentication method as the user used to log in.  
 * Unfortunately, that means if you need root file access you'll need to log in as
 * root through SSH
 */

package mindbright.ssh;

import java.awt.*;
import java.awt.event.*;
import java.io.*;

import com.gotoservers.ftp.LoginParam;
import com.gotoservers.ftp.RemoteFileBrowser;
import com.isnetworks.ssh.*;

public class SSHSCPPanel extends Panel{//Dialog {
	private static ThreadGroup threadGroup;

<span class="fc" id="L50">	private static int thrdPart = 1; // JH_Mod</span>

	public static ThreadGroup getThreadGroup() {
<span class="nc bnc" id="L53" title="All 2 branches missed.">		if (threadGroup == null) {</span>
<span class="nc" id="L54">			threadGroup = new ThreadGroup(&quot;Mindbright SSH&quot;); // JH_Mod</span>
		}
<span class="nc" id="L56">		return threadGroup;</span>
	}

	public static synchronized String createThreadName() {
<span class="nc" id="L60">		return &quot;SSH-&quot; + (thrdPart++);</span>
	} // JH_Mod

	private Button mUploadButton;

	private Button mDownloadButton;

	private Checkbox mTypeCheckbox;

	private Panel mFileDisplayPanel;

	private Panel mMainBottomSectionPanel;

	/** Text area for error message display */
	private TextArea mMessageTextArea;

	/** GUI for browsing file systems */
	private FileDisplay mLocalFileDisplay;

	private FileDisplay mRemoteFileDisplay;

	/** Back end for browsing file systems */
	private RemoteFileBrowser mRemoteFileBrowser;

	private LocalFileBrowser mLocalFileBrowser;

	/** Frame to attach new dialog boxes to */
	private Frame mOwnerFrame;

	private SSHPropertyHandler mPropertyHandler;

	// //private SSHInteractor mInterator;

	/**
	 * Constructor Overall, the GUI is composed of two parts: the bottom section
	 * (buttons, messages) the file-display section (two file displays &amp; arrow
	 * buttons)
	 */
<span class="nc" id="L98">	public SSHSCPPanel(SSHPropertyHandler propHandler) {// ,</span>
		// SSHInteractor
		// interactor
		// ) {
		//super(owner, &quot;SCP Files&quot;, false);

<span class="nc" id="L104">		mOwnerFrame = propHandler.getParent();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">		if( mOwnerFrame==null ){</span>
<span class="nc" id="L106">			mOwnerFrame = new Frame();</span>
		}
<span class="nc" id="L108">		mPropertyHandler = propHandler;</span>
		// //mInterator = interactor;

<span class="nc" id="L111">		setLayout(new BorderLayout());</span>
<span class="nc" id="L112">		setBackground(Color.lightGray);</span>
<span class="nc" id="L113">		add(&quot;South&quot;, getMainBottomSectionPanel());</span>
<span class="nc" id="L114">		add(&quot;Center&quot;, getFileDisplayPanel());</span>
		//pack();

<span class="nc" id="L117">		mLocalFileBrowser = new LocalFileBrowser(getLocalFileDisplay(),</span>
				mPropertyHandler);

<span class="nc" id="L120">		mRemoteFileBrowser = new RemoteFileBrowser(</span>
<span class="nc" id="L121">				getRemoteFileDisplay(), mPropertyHandler, this);</span>

		//addWindowListener(new WindowAdapter() {
		//	public void windowClosing(WindowEvent e) {
		//		setVisible(false);
		//		mOwnerFrame.dispose();
		//		mRemoteFileBrowser.disconnect();
		//	}
		//});
		try{
<span class="nc" id="L131">			mLocalFileBrowser.initialize();</span>
<span class="nc" id="L132">		}catch(Exception e){</span>
<span class="nc" id="L133">			logError(e);</span>
<span class="nc" id="L134">		}</span>
<span class="nc" id="L135">	}</span>

	/**
	 * The main bottom part of the GUI. Now just contains the error text area
	 */
	private Panel getMainBottomSectionPanel() {
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if (mMainBottomSectionPanel == null) {</span>
<span class="nc" id="L142">			mMainBottomSectionPanel = new Panel(new BorderLayout());</span>
<span class="nc" id="L143">			getMainBottomSectionPanel().add(&quot;Center&quot;, getMessageTextArea());</span>
		}
<span class="nc" id="L145">		return mMainBottomSectionPanel;</span>
	}

	/**
	 * This is the message text area in the bottom part of the GUI. It is sized
	 * to 3 rows, 30 columns, which drives its preferred size (the preferred
	 * height is respected due to its position in the GUI.
	 */
	private TextArea getMessageTextArea() {
<span class="nc bnc" id="L154" title="All 2 branches missed.">		if (mMessageTextArea == null) {</span>
<span class="nc" id="L155">			mMessageTextArea = new TextArea(&quot;&quot;, 3, 30,</span>
					TextArea.SCROLLBARS_VERTICAL_ONLY);
<span class="nc" id="L157">			mMessageTextArea.setEditable(false);</span>
<span class="nc" id="L158">			mMessageTextArea.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 11));</span>
<span class="nc" id="L159">			mMessageTextArea.setBackground(Color.white);</span>
		}
<span class="nc" id="L161">		return mMessageTextArea;</span>
	}

	/**
	 * This is the upper section of the GUI, containing the local &amp; remote file
	 * displays and the direction buttons It is a big-bad-evil GridBagLayout
	 * (tm) The general idea is that the file displays expand horizontally to
	 * fill the remaining space equally and the arrow buttons float in the
	 * center between the two file displays.
	 */
	private Panel getFileDisplayPanel() {
<span class="nc bnc" id="L172" title="All 2 branches missed.">		if (mFileDisplayPanel == null) {</span>
<span class="nc" id="L173">			mFileDisplayPanel = new Panel(new GridBagLayout());</span>

<span class="nc" id="L175">			GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L177">			gbc.gridx = 0;</span>
<span class="nc" id="L178">			gbc.gridy = 0;</span>
<span class="nc" id="L179">			gbc.gridwidth = 1;</span>
<span class="nc" id="L180">			gbc.gridheight = 3;</span>
<span class="nc" id="L181">			gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L182">			gbc.anchor = GridBagConstraints.CENTER;</span>
<span class="nc" id="L183">			gbc.weightx = 0.5;</span>
<span class="nc" id="L184">			gbc.weighty = 1.0;</span>
<span class="nc" id="L185">			mFileDisplayPanel.add(getLocalFileDisplay(), gbc);</span>

<span class="nc" id="L187">			gbc.gridx = 2;</span>
<span class="nc" id="L188">			gbc.gridy = 0;</span>
<span class="nc" id="L189">			gbc.gridwidth = 1;</span>
<span class="nc" id="L190">			gbc.gridheight = 3;</span>
<span class="nc" id="L191">			gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L192">			gbc.anchor = GridBagConstraints.CENTER;</span>
<span class="nc" id="L193">			gbc.weightx = 0.5;</span>
<span class="nc" id="L194">			gbc.weighty = 1.0;</span>
<span class="nc" id="L195">			mFileDisplayPanel.add(getRemoteFileDisplay(), gbc);</span>

<span class="nc" id="L197">			gbc.gridx = 1;</span>
<span class="nc" id="L198">			gbc.gridy = 0;</span>
<span class="nc" id="L199">			gbc.gridwidth = 1;</span>
<span class="nc" id="L200">			gbc.gridheight = 1;</span>
<span class="nc" id="L201">			gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L202">			gbc.anchor = GridBagConstraints.SOUTH;</span>
<span class="nc" id="L203">			gbc.weightx = 0.0;</span>
<span class="nc" id="L204">			gbc.weighty = 0.5;</span>
<span class="nc" id="L205">			gbc.insets = new Insets(0, 4, 2, 4);</span>
<span class="nc" id="L206">			mFileDisplayPanel.add(getDownloadButton(), gbc);</span>

<span class="nc" id="L208">			gbc.gridx = 1;</span>
<span class="nc" id="L209">			gbc.gridy = 1;</span>
<span class="nc" id="L210">			gbc.gridwidth = 1;</span>
<span class="nc" id="L211">			gbc.gridheight = 1;</span>
<span class="nc" id="L212">			gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L213">			gbc.anchor = GridBagConstraints.NORTH;</span>
<span class="nc" id="L214">			gbc.weightx = 0.0;</span>
<span class="nc" id="L215">			gbc.weighty = 0.5;</span>
<span class="nc" id="L216">			gbc.insets = new Insets(2, 4, 0, 4);</span>
<span class="nc" id="L217">			mFileDisplayPanel.add(getUploadButton(), gbc);</span>

<span class="nc" id="L219">			gbc.gridx = 1;</span>
<span class="nc" id="L220">			gbc.gridy = 2;</span>
<span class="nc" id="L221">			gbc.gridwidth = 1;</span>
<span class="nc" id="L222">			gbc.gridheight = 1;</span>
<span class="nc" id="L223">			gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L224">			gbc.anchor = GridBagConstraints.NORTH;</span>
<span class="nc" id="L225">			gbc.weightx = 0.0;</span>
<span class="nc" id="L226">			gbc.weighty = 0.5;</span>
<span class="nc" id="L227">			gbc.insets = new Insets(2, 4, 0, 4);</span>
<span class="nc" id="L228">			mFileDisplayPanel.add(getTypeCheckbox(), gbc);</span>
		}
<span class="nc" id="L230">		return mFileDisplayPanel;</span>
	}

	/** An instance of FileDisplay for the local system */
	private FileDisplay getLocalFileDisplay() {
<span class="nc bnc" id="L235" title="All 2 branches missed.">		if (mLocalFileDisplay == null) {</span>
<span class="nc" id="L236">			mLocalFileDisplay = new FileDisplay(mOwnerFrame, &quot;Local&quot;,</span>
					this);
		}
<span class="nc" id="L239">		return mLocalFileDisplay;</span>
	}

	/** An instance of FileDisplay for the remote system */
	private FileDisplay getRemoteFileDisplay() {
<span class="nc bnc" id="L244" title="All 2 branches missed.">		if (mRemoteFileDisplay == null) {</span>
<span class="nc" id="L245">			mRemoteFileDisplay = new FileDisplay(mOwnerFrame, &quot;Remote&quot;,</span>
					this);
		}
<span class="nc" id="L248">		return mRemoteFileDisplay;</span>
	}

	/** A direction button pointing right */
	private Checkbox getTypeCheckbox() {
<span class="nc bnc" id="L253" title="All 2 branches missed.">		if (mTypeCheckbox == null) {</span>
<span class="nc" id="L254">			mTypeCheckbox = new Checkbox(&quot;BInary&quot;, true);</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">			if( !mPropertyHandler.hasBinay() ){</span>
<span class="nc" id="L256">				mTypeCheckbox.setEnabled(false);</span>
			}
		}
<span class="nc" id="L259">		return mTypeCheckbox;</span>
	}

	/** A direction button pointing left */
	private Button getDownloadButton() {
<span class="nc bnc" id="L264" title="All 2 branches missed.">		if (mDownloadButton == null) {</span>
<span class="nc" id="L265">			mDownloadButton = new Button(&quot;&lt;--&quot;);</span>
<span class="nc" id="L266">			mDownloadButton.addActionListener(new ActionListener() {</span>

				public void actionPerformed(ActionEvent e) {

					try {
<span class="nc" id="L271">						boolean recursive = true;</span>
<span class="nc" id="L272">						boolean background = false;</span>
<span class="nc" id="L273">						boolean isBinary = mTypeCheckbox.getState();</span>

<span class="nc" id="L275">						SSHSCPGUIThread progress = new SSHSCPGUIThread(</span>
<span class="nc" id="L276">								mOwnerFrame, mLocalFileDisplay,</span>
<span class="nc" id="L277">								mRemoteFileDisplay, mRemoteFileBrowser,</span>
								recursive, background, false, isBinary,
								SSHSCPPanel.this);
<span class="nc" id="L280">						Thread thread = new Thread(getThreadGroup(), progress,</span>
<span class="nc" id="L281">								createThreadName());</span>
<span class="nc" id="L282">						thread.start();</span>

<span class="nc" id="L284">					} catch (Exception ee) {</span>
<span class="nc" id="L285">						ee.printStackTrace();</span>
<span class="nc" id="L286">						logError(ee);</span>
<span class="nc" id="L287">					}</span>
<span class="nc" id="L288">				}</span>
			});
		}
<span class="nc" id="L291">		return mDownloadButton;</span>
	}

	/** A direction button pointing right */
	private Button getUploadButton() {
<span class="nc bnc" id="L296" title="All 2 branches missed.">		if (mUploadButton == null) {</span>
<span class="nc" id="L297">			mUploadButton = new Button(&quot;--&gt;&quot;);</span>
<span class="nc" id="L298">			mUploadButton.addActionListener(new ActionListener() {</span>

				public void actionPerformed(ActionEvent e) {

					try {
<span class="nc" id="L303">						boolean recursive = true;</span>
<span class="nc" id="L304">						boolean background = false;</span>
<span class="nc" id="L305">						boolean isBinary = mTypeCheckbox.getState();</span>
<span class="nc" id="L306">						SSHSCPGUIThread progress = new SSHSCPGUIThread(</span>
<span class="nc" id="L307">								mOwnerFrame, mLocalFileDisplay,</span>
<span class="nc" id="L308">								mRemoteFileDisplay, mRemoteFileBrowser,</span>
								recursive, background, true, isBinary,
								SSHSCPPanel.this);
<span class="nc" id="L311">						Thread thread = new Thread(getThreadGroup(), progress,</span>
<span class="nc" id="L312">								createThreadName());</span>
<span class="nc" id="L313">						thread.start();</span>

<span class="nc" id="L315">					} catch (Exception ee) {</span>
<span class="nc" id="L316">						logError(ee);</span>
<span class="nc" id="L317">					}</span>
<span class="nc" id="L318">				}</span>
			});
		}
<span class="nc" id="L321">		return mUploadButton;</span>
	}

	public void refresh() {
		try {
<span class="nc" id="L326">			mLocalFileBrowser.refresh();</span>
<span class="nc" id="L327">			mRemoteFileBrowser.refresh();</span>
<span class="nc" id="L328">		} catch (SSHException e) {</span>
<span class="nc" id="L329">			logError(e);</span>
<span class="nc" id="L330">		}</span>
<span class="nc" id="L331">	}</span>

	/**
	 * Initialize the connection to the remote system and start in the SSH home
	 * directory on the local system
	 */
	public void show(SSHPropertyHandler propsHandler) {

<span class="nc" id="L339">		setSize(600, 500);</span>
		try {
<span class="nc" id="L341">			mRemoteFileBrowser.initialize();</span>
<span class="nc" id="L342">		} catch (SSHException e) {</span>
<span class="nc" id="L343">			logError(e);</span>
<span class="nc" id="L344">		}</span>
<span class="nc" id="L345">		setVisible(true);</span>
<span class="nc" id="L346">	}</span>

	/**
	 * An exception happened, so show the user the message in the text area
	 */
	public void logError(Exception e) {
<span class="nc" id="L352">		mMessageTextArea.append(e.getMessage() + &quot;\n&quot;);</span>
		
<span class="nc" id="L354">	}</span>
	public void close(){
<span class="nc" id="L356">		this.mRemoteFileBrowser.disconnect();</span>
<span class="nc" id="L357">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>