<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileDisplay.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">65_gsftp</a> &gt; <a href="index.source.html" class="el_package">com.isnetworks.ssh</a> &gt; <span class="el_source">FileDisplay.java</span></div><h1>FileDisplay.java</h1><pre class="source lang-java linenums">/******************************************************************************
 * Modified by Zhong Li, merge headerling to one, removed Chdir
 * 
 * Copyright (c) 2001 by ISNetworks, Seattle, WA.
 *                       www.isnetworks.com, info@isnetworks.com
 * Based on MindTerm from Mindbright Technology AB, Stockholm, Sweden.
 *                        www.mindbright.se, info@mindbright.se
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *****************************************************************************/
/**
 * 
* AWT Panel that represents a file system.  Has buttons for basic
* file administration operations and a list of the files in a
* given directory.
* 
* This code is based on a LayoutManager tutorial on Sun's Java web site.
* http://developer.java.sun.com/developer/onlineTraining/GUI/AWTLayoutMgr/shortcourse.html
*/
package com.isnetworks.ssh;

import java.awt.*;
import java.awt.event.*;
import java.text.NumberFormat;
import java.util.*;
import mindbright.ssh.*;

/** This class represents a small pane which will list the files present
 *  on a given platform.  This pane was made into its own class to allow
 *  easy reuse as both the local and remote file displays
 *  
 *  This GUI is built up using &quot;lazy instantiation&quot; via method calls
 *  for each part of the component.
 */
public class FileDisplay extends Panel {
	private FileBrowser mBrowser;
<span class="nc" id="L45">	private NumberFormat nf = NumberFormat.getInstance();</span>
	private Button       mChgDirButton;
	private Button       mDeleteButton;
	private Panel        mFileButtonsInnerPanel;
	private Panel        mFileButtonsPanel;
	private Panel        mFileHeaderPanel;
	private FileList     mFileList;
	private Label        mMachineDescriptionLabel;	
	private Label        mSelectStatusLabel;
	private Button       mMkDirButton;
	private Button       mRefreshButton;
	private Button       mRenameButton;
	private TextField    mFileSystemLocationField;
	
	/**
	* Frame to own dialog boxes
	*/
	private Frame mOwnerFrame;
	
	/**
	* Reference to SCP main dialog box to send error messages to
	*/
	private SSHSCPPanel mSCPDialog;

	/** Constructor 
	*  This defines the overall GUI for this component
	*  It's a BorderLayout with a header, a set of buttons &amp; a list
	*/
<span class="nc" id="L73">	public FileDisplay( Frame ownerFrame, String name, SSHSCPPanel scpDialog ) {</span>
<span class="nc" id="L74">		mOwnerFrame = ownerFrame;</span>
<span class="nc" id="L75">		mSCPDialog = scpDialog;</span>
		
<span class="nc" id="L77">		mMachineDescriptionLabel = new Label( name );</span>
<span class="nc" id="L78">		mFileSystemLocationField = new TextField(&quot;&quot;);</span>
		
<span class="nc" id="L80">		setLayout(new BorderLayout());</span>
<span class="nc" id="L81">		setBackground(Color.lightGray);</span>
<span class="nc" id="L82">		add(&quot;North&quot;,  getFileHeaderPanel());</span>
<span class="nc" id="L83">		add(&quot;Center&quot;, getFileList());</span>
<span class="nc" id="L84">		add(&quot;South&quot;,   getFileButtonsPanel());</span>
<span class="nc" id="L85">	}</span>


	/** The header panel -- contains labels for Remote/Local and the current directory */
	private Panel getFileHeaderPanel() {
<span class="nc bnc" id="L90" title="All 2 branches missed.">		if (mFileHeaderPanel == null) {</span>
<span class="nc" id="L91">			mFileHeaderPanel = new Panel(new BorderLayout());</span>
<span class="nc" id="L92">			mSelectStatusLabel = new Label();</span>
<span class="nc" id="L93">			mFileHeaderPanel.add(mSelectStatusLabel,BorderLayout.SOUTH);</span>
<span class="nc" id="L94">			mFileHeaderPanel.add(mMachineDescriptionLabel,BorderLayout.WEST);</span>
<span class="nc" id="L95">			mFileHeaderPanel.add(mFileSystemLocationField,BorderLayout.CENTER);</span>
<span class="nc" id="L96">			mFileHeaderPanel.add(getChgDirButton(),BorderLayout.EAST);</span>
		}
<span class="nc" id="L98">		return mFileHeaderPanel;</span>
	}


	/** This is merely a wrapper to bind the set of buttons to their
	*   preferred height
	*/
	private Panel getFileButtonsPanel() {
<span class="nc bnc" id="L106" title="All 2 branches missed.">		if (mFileButtonsPanel == null) {</span>
<span class="nc" id="L107">			mFileButtonsPanel = new Panel(new BorderLayout());</span>
<span class="nc" id="L108">			mFileButtonsPanel.add(&quot;North&quot;, getFileButtonsInnerPanel());</span>
		}
<span class="nc" id="L110">		return mFileButtonsPanel;</span>
	}

	/** The panel containing the buttons for the file list */
	private Panel getFileButtonsInnerPanel() {
<span class="nc bnc" id="L115" title="All 2 branches missed.">		if (mFileButtonsInnerPanel == null) {</span>
<span class="nc" id="L116">			mFileButtonsInnerPanel = new Panel(new GridLayout(1,4));</span>
			//mFileButtonsInnerPanel.add(getChgDirButton());
<span class="nc" id="L118">			mFileButtonsInnerPanel.add(getMkDirButton());</span>
<span class="nc" id="L119">			mFileButtonsInnerPanel.add(getRenameButton());</span>
<span class="nc" id="L120">			mFileButtonsInnerPanel.add(getDeleteButton());</span>
<span class="nc" id="L121">			mFileButtonsInnerPanel.add(getRefreshButton());</span>
		}
<span class="nc" id="L123">		return mFileButtonsInnerPanel;</span>
	}


	//----- Buttons ----- 
	private Button getChgDirButton() {
<span class="nc bnc" id="L129" title="All 2 branches missed.">		if (mChgDirButton == null) {</span>
<span class="nc" id="L130">			mChgDirButton = new Button(&quot;ChDir&quot;);</span>
<span class="nc" id="L131">			mChgDirButton.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
<span class="nc" id="L133">					String directoryName = mFileSystemLocationField.getText();//SSHMiscDialogs.textfield( &quot;Change directory&quot;, &quot;Directory&quot;, mOwnerFrame, getFileSystemLocationLabelText() );</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">					if ( directoryName != null ) {</span>
						try {
<span class="nc" id="L136">							mBrowser.changeDirectory( directoryName );</span>
						}
<span class="nc" id="L138">						catch( SSHException ex ) {</span>
<span class="nc" id="L139">							mSCPDialog.logError( ex );</span>
<span class="nc" id="L140">						}</span>
					}
<span class="nc" id="L142">				}</span>
			} );
		}
<span class="nc" id="L145">		return mChgDirButton;</span>
	}

	private Button getMkDirButton() {
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (mMkDirButton == null) {</span>
<span class="nc" id="L150">			mMkDirButton = new Button(&quot;MkDir&quot;);</span>
<span class="nc" id="L151">			mMkDirButton.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
<span class="nc" id="L153">					String directoryName = SSHMiscDialogs.textfield( &quot;Make directory relative to current path&quot;, &quot;Directory name&quot;, mOwnerFrame );</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">					if ( directoryName != null ) {</span>
						try {
<span class="nc" id="L156">							mBrowser.makeDirectory( directoryName );</span>
						}
<span class="nc" id="L158">						catch( SSHException ex ) {</span>
<span class="nc" id="L159">							mSCPDialog.logError( ex );</span>
<span class="nc" id="L160">						}</span>
					}
<span class="nc" id="L162">				}</span>
			} );
		}
<span class="nc" id="L165">		return mMkDirButton;</span>
	}

	private Button getRenameButton() {
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if (mRenameButton == null) {</span>
<span class="nc" id="L170">			mRenameButton = new Button(&quot;Rename&quot;);</span>
<span class="nc" id="L171">			mRenameButton.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
<span class="nc" id="L173">					FileListItem mFileListItem = mFileList.getSelectedFileListItem();</span>
<span class="nc" id="L174">					String newName = SSHMiscDialogs.textfield( &quot;Rename file&quot;, &quot;New file name&quot;, mOwnerFrame, mFileListItem.getName() );</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">					if ( newName != null ) {</span>
						try {
<span class="nc" id="L177">							mBrowser.rename( mFileListItem, newName );</span>
						}
<span class="nc" id="L179">						catch( SSHException ex ) {</span>
<span class="nc" id="L180">							mSCPDialog.logError( ex );</span>
<span class="nc" id="L181">						}</span>
					}
<span class="nc" id="L183">				}</span>
			} );
		}
<span class="nc" id="L186">		return mRenameButton;</span>
	}

	private Button getDeleteButton() {
<span class="nc bnc" id="L190" title="All 2 branches missed.">		if (mDeleteButton == null) {</span>
<span class="nc" id="L191">			mDeleteButton = new Button(&quot;Delete&quot;);</span>
<span class="nc" id="L192">			mDeleteButton.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
					try {
<span class="nc" id="L195">						mBrowser.delete( mFileList.getSelectedFileListItems() );</span>
					}
<span class="nc" id="L197">					catch( SSHException ex ) {</span>
<span class="nc" id="L198">						mSCPDialog.logError( ex );</span>
<span class="nc" id="L199">					}</span>
<span class="nc" id="L200">				}</span>
			} );
		}
<span class="nc" id="L203">		return mDeleteButton;</span>
	}

	private Button getRefreshButton() {
<span class="nc bnc" id="L207" title="All 2 branches missed.">		if (mRefreshButton == null) {</span>
<span class="nc" id="L208">			mRefreshButton = new Button( &quot;Refresh&quot; );</span>
<span class="nc" id="L209">			mRefreshButton.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
					try {
<span class="nc" id="L212">						mBrowser.refresh();</span>
					}
<span class="nc" id="L214">					catch( SSHException ex ) {</span>
<span class="nc" id="L215">						mSCPDialog.logError( ex );</span>
<span class="nc" id="L216">					}</span>
<span class="nc" id="L217">				}</span>
			} );
		}
<span class="nc" id="L220">		return mRefreshButton;</span>
	}


	/** The list of files */
	private FileList getFileList() {
<span class="nc bnc" id="L226" title="All 2 branches missed.">		if (mFileList == null) {</span>
<span class="nc" id="L227">			mFileList = new FileList();</span>
<span class="nc" id="L228">			mFileList.setFont( new Font( &quot;Monospaced&quot;, Font.PLAIN, 12 ) );</span>
<span class="nc" id="L229">			mFileList.setMultipleMode( true );</span>
<span class="nc" id="L230">			mFileList.addActionListener( new ActionListener() {</span>
				public void actionPerformed( ActionEvent e ) {
					try {
<span class="nc" id="L233">						mBrowser.fileDoubleClicked( mFileList.getFileListItem( e.getActionCommand() ) );</span>
					}
<span class="nc" id="L235">					catch( SSHException ex ) {</span>
<span class="nc" id="L236">						mSCPDialog.logError( ex );</span>
<span class="nc" id="L237">					}</span>
<span class="nc" id="L238">				}</span>
			} );
			
<span class="nc" id="L241">			mFileList.addItemListener( new ItemListener() {</span>
				public void itemStateChanged( ItemEvent e ) {
<span class="nc" id="L243">					enableButtons();</span>
<span class="nc" id="L244">				}</span>
			} );
			
<span class="nc" id="L247">			mFileList.setBackground(Color.white);</span>
		}
<span class="nc" id="L249">		return mFileList;</span>
	}


	private void enableButtons() {
<span class="nc" id="L254">		int cn = mFileList.getSelectionCount();</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">		mRenameButton.setEnabled( cn == 1 );</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">		mDeleteButton.setEnabled( cn&gt;0 );</span>
<span class="nc" id="L257">		String ltext = &quot;&quot;;</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">		if( cn&gt;0 ){</span>
<span class="nc" id="L259">			FileListItem[] items = mFileList.getSelectedFileListItems();</span>
<span class="nc" id="L260">			long total = 0;</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">			for(int i=0;i&lt;items.length;i++){</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">				if(!items[i].isDirectory()) </span>
<span class="nc" id="L263">					total += items[i].getSize();</span>
			}
<span class="nc" id="L265">			ltext = &quot;&quot;+cn+&quot; selected. Total &quot;+nf.format(total)+&quot; Bytes.&quot;;</span>
		}
<span class="nc" id="L267">		mSelectStatusLabel.setText(ltext);</span>
<span class="nc" id="L268">	}</span>

	//----- public methods that make the file system label a property -----
	private String currentPath;
	public String getFileSystemLocation() {
<span class="nc" id="L273">		return currentPath;</span>
	}
	//public String getFileSystemLocationLabelText() {
	//	return mFileSystemLocationField.getText();
	//}

	public void setFileSystemLocationLabelText(String arg1) {
<span class="nc" id="L280">	    currentPath = arg1;</span>
<span class="nc" id="L281">		mFileSystemLocationField.setText(arg1);</span>
<span class="nc" id="L282">	}</span>

	public void setFileList( Vector files, String directory ) {
<span class="nc" id="L285">		setFileSystemLocationLabelText( directory );</span>

<span class="nc" id="L287">		mFileList.setListItems( files );</span>
<span class="nc" id="L288">		enableButtons();</span>
<span class="nc" id="L289">	}</span>
	
	public void setFileBrowser( FileBrowser browser ) {
<span class="nc" id="L292">		mBrowser = browser;</span>
<span class="nc" id="L293">	}</span>
	
	public FileListItem getSelectedFile() {
<span class="nc" id="L296">		return mFileList.getSelectedFileListItem();</span>
	}
	
	public FileListItem[] getSelectedFiles() {
<span class="nc" id="L300">		return mFileList.getSelectedFileListItems();</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>