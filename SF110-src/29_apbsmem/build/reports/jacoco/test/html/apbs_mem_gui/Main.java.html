<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">29_apbsmem</a> &gt; <a href="index.source.html" class="el_package">apbs_mem_gui</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">package apbs_mem_gui;


import javax.swing.*;

import java.awt.*;
import java.awt.event.*;
import java.util.*;
import java.io.*;

import com.jgoodies.forms.layout.*;
import com.jgoodies.forms.builder.*;

import org.jmol.api.JmolViewer;
import org.jmol.api.JmolAdapter;
import org.jmol.popup.JmolPopup;
/**
 *
 * @author Keith Callenberg, Gabriel de Forest
 */
public class Main {

    private JMenuBar mainBar;
    private JMenu fileMenu, focusMenu, helpMenu;
    private JMenuItem save, open, exit, about, readme;
    private ButtonGroup focusbuttons;
    private JRadioButtonMenuItem setFocus0, setFocus1, setFocus2;
<span class="fc" id="L28">    protected int maxfocus = 0, pb = 0;</span>
    private JPanel lpane, rpane;
    private Container mainPane;
<span class="fc" id="L31">    GridBagConstraints gbc = new GridBagConstraints();</span>
    private JButton Run, PQRBrowse1, PQRBrowse2, Preview, RedrawPot;
    protected JCheckBox drawPot;
    protected JFormattedTextField pqrFile1, pqrFile2,
            gridDimx, gridDimy, gridDimz,
            gridLen1a, gridLen2a, gridLen3a,
            gridLen1b, gridLen2b, gridLen3b,
            gridLen1c, gridLen2c, gridLen3c,
            countIon1Charge, countIon1Con, countIon1Sz,
            countIon2Charge, countIon2Con, countIon2Sz,
            proteinDi, solventDi, membraneDi,
            srad, sdens, temp,
            zmem, Lmem, idie, geoFactor1, geoFactor2, geoFactor3, potential, potcontour;
    protected javax.swing.JProgressBar pBar;
    protected javax.swing.JComboBox solMethodCombo, boundaryCondCombo,
            calcTypeCombo, centerCombo, contourCombo;
    InFile inFile;
<span class="fc" id="L48">    Exec exec = new Exec();</span>
<span class="fc" id="L49">    FileEditor file = new FileEditor();</span>
<span class="fc" id="L50">    boolean hasbeenchanged = true;		//keeps track of whether or not file has been changed</span>
<span class="fc" id="L51">    boolean file_loaded = false;		//is file already loaded/saved?</span>

    double[] finalenergy, memv;
    File ofile;
    String outfilename;
    String[] theEnergy, ctypes;
    Scanner fScan;
    PrintWriter outFile;
<span class="nc" id="L59">    private JFrame theWindow = new JFrame();</span>
    protected JmolViewer viewer;
    private JmolAdapter adapter;
    private JmolPopup jmolPopup;

<span class="fc" id="L64">    private static double version = 1.04;</span>

    private JDialog aboutdialog, helpdialog;

    private static Main m;

    /**
     * Main class that includes the GUI components
     */
<span class="fc" id="L73">    public Main() {</span>
      
<span class="nc" id="L75">        inFile = new InFile();</span>

<span class="nc" id="L77">        theWindow = new JFrame(&quot;APBSmem &quot; + version);</span>
<span class="nc" id="L78">        theWindow.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>

<span class="nc" id="L80">        mainPane = theWindow.getContentPane();</span>

<span class="nc" id="L82">        Run = new JButton(&quot;Run&quot;);</span>
<span class="nc" id="L83">        PQRBrowse1 = new JButton(&quot;Browse&quot;);</span>
<span class="nc" id="L84">        PQRBrowse2 = new JButton(&quot;Browse&quot;);</span>
<span class="nc" id="L85">        PQRBrowse2.setEnabled(false);</span>
<span class="nc" id="L86">        Preview = new JButton(&quot;Preview&quot;);</span>
<span class="nc" id="L87">        mainBar = new JMenuBar();</span>
<span class="nc" id="L88">        theWindow.setJMenuBar(mainBar);</span>

<span class="nc" id="L90">        RedrawPot = new JButton(&quot;Redraw&quot;);</span>
<span class="nc" id="L91">        RedrawPot.setEnabled(false);</span>

<span class="nc" id="L93">        fileMenu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L94">        open = new JMenuItem(&quot;Open&quot;);</span>
<span class="nc" id="L95">        save = new JMenuItem(&quot;Save&quot;);</span>
<span class="nc" id="L96">        exit = new JMenuItem(&quot;Exit&quot;);</span>
        
<span class="nc" id="L98">        helpMenu = new JMenu(&quot;Help&quot;);</span>
<span class="nc" id="L99">        readme = new JMenuItem(&quot;Readme&quot;);</span>
<span class="nc" id="L100">        about = new JMenuItem(&quot;About&quot;);</span>
        
        //helpMenu.add(readme);
<span class="nc" id="L103">        helpMenu.add(about);</span>
        

<span class="nc" id="L106">        fileMenu.add(open);</span>
<span class="nc" id="L107">        fileMenu.add(save);</span>
<span class="nc" id="L108">        fileMenu.add(exit);</span>
<span class="nc" id="L109">        focusMenu = new JMenu(&quot;Focus&quot;);</span>
<span class="nc" id="L110">        setFocus0 = new JRadioButtonMenuItem(&quot;No focus&quot;);</span>
<span class="nc" id="L111">        setFocus1 = new JRadioButtonMenuItem(&quot;1 focus level&quot;);</span>
<span class="nc" id="L112">        setFocus2 = new JRadioButtonMenuItem(&quot;2 focus levels&quot;);</span>
<span class="nc" id="L113">        setFocus0.setSelected(true);</span>
<span class="nc" id="L114">        focusbuttons = new ButtonGroup();</span>
<span class="nc" id="L115">        focusbuttons.add(setFocus0);</span>
<span class="nc" id="L116">        focusbuttons.add(setFocus1);</span>
<span class="nc" id="L117">        focusbuttons.add(setFocus2);</span>
<span class="nc" id="L118">        focusMenu.add(setFocus0);</span>
<span class="nc" id="L119">        focusMenu.add(setFocus1);</span>
<span class="nc" id="L120">        focusMenu.add(setFocus2);</span>

<span class="nc" id="L122">        mainBar.add(fileMenu);</span>
<span class="nc" id="L123">        mainBar.add(focusMenu);</span>
<span class="nc" id="L124">        mainBar.add(helpMenu);</span>

<span class="nc" id="L126">        ctypes = new String[] {&quot;Protein solvation&quot;, &quot;Ion solvation&quot;, &quot;Gating charge&quot;};</span>
        
<span class="nc" id="L128">        pBar = new javax.swing.JProgressBar();</span>
<span class="nc" id="L129">        pBar.setStringPainted(true);</span>
<span class="nc" id="L130">        pb = 0;</span>

<span class="nc" id="L132">        gridDimx = new JFormattedTextField(new Integer(97));</span>
<span class="nc" id="L133">        gridDimx.setToolTipText(&quot;Grid dimension X&quot;);</span>
<span class="nc" id="L134">        gridDimy = new JFormattedTextField(new Integer(97));</span>
<span class="nc" id="L135">        gridDimy.setToolTipText(&quot;Grid dimension Y&quot;);</span>
<span class="nc" id="L136">        gridDimz = new JFormattedTextField(new Integer(97));</span>
<span class="nc" id="L137">        gridDimz.setToolTipText(&quot;Grid dimension Z&quot;);</span>
<span class="nc" id="L138">        gridLen1a = new JFormattedTextField(new Double(300));</span>
<span class="nc" id="L139">        gridLen1a.setToolTipText(&quot;Grid length X&quot;);</span>
<span class="nc" id="L140">        gridLen2a = new JFormattedTextField(new Double(300));</span>
<span class="nc" id="L141">        gridLen2a.setToolTipText(&quot;Grid length Y&quot;);</span>
<span class="nc" id="L142">        gridLen3a = new JFormattedTextField(new Double(300));</span>
<span class="nc" id="L143">        gridLen3a.setToolTipText(&quot;Grid length Z&quot;);</span>
<span class="nc" id="L144">        gridLen1b = new JFormattedTextField(new Double(200));</span>
<span class="nc" id="L145">        gridLen1b.setToolTipText(&quot;Grid length X&quot;);</span>
<span class="nc" id="L146">        gridLen2b = new JFormattedTextField(new Double(200));</span>
<span class="nc" id="L147">        gridLen2b.setToolTipText(&quot;Grid length Y&quot;);</span>
<span class="nc" id="L148">        gridLen3b = new JFormattedTextField(new Double(200));</span>
<span class="nc" id="L149">        gridLen3b.setToolTipText(&quot;Grid length Z&quot;);</span>
<span class="nc" id="L150">        gridLen1c = new JFormattedTextField(new Double(100));</span>
<span class="nc" id="L151">        gridLen1c.setToolTipText(&quot;Grid length X&quot;);</span>
<span class="nc" id="L152">        gridLen2c = new JFormattedTextField(new Double(100));</span>
<span class="nc" id="L153">        gridLen2c.setToolTipText(&quot;Grid length Y&quot;);</span>
<span class="nc" id="L154">        gridLen3c = new JFormattedTextField(new Double(100));</span>
<span class="nc" id="L155">        gridLen3c.setToolTipText(&quot;Grid length Z&quot;);</span>
        
<span class="nc" id="L157">        setFocus1Enable(false);</span>
<span class="nc" id="L158">        setFocus2Enable(false);</span>

<span class="nc" id="L160">        countIon1Charge = new JFormattedTextField(new Double(1.0));</span>
<span class="nc" id="L161">        countIon1Charge.setToolTipText(&quot;Ion 1 CHARGE&quot;);</span>
<span class="nc" id="L162">        countIon1Con = new JFormattedTextField(new Double(0.1));</span>
<span class="nc" id="L163">        countIon1Con.setToolTipText(&quot;Ion 1 CONCENTRATION&quot;);</span>
<span class="nc" id="L164">        countIon1Sz = new JFormattedTextField(new Double(2.0));</span>
<span class="nc" id="L165">        countIon1Sz.setToolTipText(&quot;Ion 1 RADIUS&quot;);</span>
<span class="nc" id="L166">        countIon2Charge = new JFormattedTextField(new Double(-1.0));</span>
<span class="nc" id="L167">        countIon2Charge.setToolTipText(&quot;Ion 2 CHARGE&quot;);</span>
<span class="nc" id="L168">        countIon2Con = new JFormattedTextField(new Double(0.1));</span>
<span class="nc" id="L169">        countIon2Con.setToolTipText(&quot;Ion 2 CONCENTRATION&quot;);</span>
<span class="nc" id="L170">        countIon2Sz = new JFormattedTextField(new Double(2.0));</span>
<span class="nc" id="L171">        countIon2Sz.setToolTipText(&quot;Ion 2 RADIUS&quot;);</span>
<span class="nc" id="L172">        proteinDi = new JFormattedTextField(new Double(2.0));</span>
<span class="nc" id="L173">        solventDi = new JFormattedTextField(new Double(80.0));</span>
<span class="nc" id="L174">        membraneDi = new JFormattedTextField(new Double(2.0));</span>
<span class="nc" id="L175">        pqrFile1 = new JFormattedTextField(new String(&quot;&quot;));</span>
<span class="nc" id="L176">        pqrFile1.setColumns(16);</span>
<span class="nc" id="L177">        pqrFile2 = new JFormattedTextField(new String(&quot;&quot;));</span>
<span class="nc" id="L178">        pqrFile2.setColumns(16);</span>
<span class="nc" id="L179">        pqrFile2.setEnabled(false);</span>

<span class="nc" id="L181">        srad = new JFormattedTextField(new Double(1.4));</span>
<span class="nc" id="L182">        sdens = new JFormattedTextField(new Double(10.0));</span>
<span class="nc" id="L183">        temp = new JFormattedTextField(new Double(298.15));</span>
<span class="nc" id="L184">        temp.setToolTipText(&quot;Temperature in Kelvin&quot;);</span>
<span class="nc" id="L185">        zmem = new JFormattedTextField(new Double(-20.0));</span>
<span class="nc" id="L186">        zmem.setToolTipText(&quot;Protein position in membrane in Angstroms&quot;);</span>
<span class="nc" id="L187">        Lmem = new JFormattedTextField(new Double(40));</span>
<span class="nc" id="L188">        Lmem.setToolTipText(&quot;Membrane length in Angstroms&quot;);</span>
<span class="nc" id="L189">        idie = new JFormattedTextField(new Double(80));</span>

<span class="nc" id="L191">        geoFactor1 = new JFormattedTextField(new Double(0.0));</span>
<span class="nc" id="L192">        geoFactor1.setToolTipText(&quot;Exclusion radius in Angstroms&quot;);</span>
<span class="nc" id="L193">        geoFactor2 = new JFormattedTextField(new Double(0.0));</span>
<span class="nc" id="L194">        geoFactor2.setToolTipText(&quot;Exclusion radius in Angstroms&quot;);</span>
<span class="nc" id="L195">        geoFactor3 = new JFormattedTextField(new Double(0.0));</span>
<span class="nc" id="L196">        geoFactor3.setToolTipText(&quot;Thickness in Angstroms&quot;);</span>

<span class="nc" id="L198">        drawPot = new JCheckBox(&quot;Draw potential&quot;);</span>
<span class="nc" id="L199">        potcontour = new JFormattedTextField(&quot;2&quot;);</span>
<span class="nc" id="L200">        potcontour.setToolTipText(&quot;Isocontour to draw electrostatic potential (+/-)&quot;);</span>
<span class="nc" id="L201">        potcontour.setEnabled(false);</span>

<span class="nc" id="L203">        potential = new JFormattedTextField(&quot;50&quot;);</span>
<span class="nc" id="L204">        potential.setColumns(5);</span>
<span class="nc" id="L205">        potential.setToolTipText(&quot;Membrane potential in mV&quot;);</span>
<span class="nc" id="L206">        potential.setEnabled(false);</span>

<span class="nc" id="L208">        solMethodCombo = new javax.swing.JComboBox();</span>
<span class="nc" id="L209">        solMethodCombo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;lpbe&quot;, &quot;npbe&quot; }));</span>
<span class="nc" id="L210">        solMethodCombo.setToolTipText(&quot;Linearized or Non-linearized Poisson Boltzmann&quot;);</span>

<span class="nc" id="L212">        calcTypeCombo = new javax.swing.JComboBox();</span>
<span class="nc" id="L213">        calcTypeCombo.setModel(new javax.swing.DefaultComboBoxModel(ctypes));</span>

<span class="nc" id="L215">        boundaryCondCombo = new javax.swing.JComboBox();</span>
<span class="nc" id="L216">        boundaryCondCombo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;Zero&quot;, &quot;SDH&quot;, &quot;MDH&quot;, &quot;Focus&quot;, &quot;Membrane potential&quot; }));</span>

<span class="nc" id="L218">        centerCombo = new javax.swing.JComboBox();</span>
<span class="nc" id="L219">        centerCombo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;Origin&quot;, &quot;Molecule 1&quot;}));</span>

<span class="nc" id="L221">        contourCombo = new javax.swing.JComboBox();</span>
<span class="nc" id="L222">        contourCombo.setModel(new javax.swing.DefaultComboBoxModel(new String[] { &quot;Membrane-Protein&quot;, &quot;Protein-Solvent&quot;}));</span>

<span class="nc" id="L224">        fileInHandler fhandler = new fileInHandler();</span>
<span class="nc" id="L225">        menuHandler menuhandler = new menuHandler();</span>
<span class="nc" id="L226">        boundaryCondCombo.addActionListener(fhandler);</span>
<span class="nc" id="L227">        centerCombo.addActionListener(fhandler);</span>
<span class="nc" id="L228">        calcTypeCombo.addActionListener(fhandler);</span>
<span class="nc" id="L229">        pqrFile1.addActionListener(fhandler);</span>
<span class="nc" id="L230">        pqrFile2.addActionListener(fhandler);</span>
<span class="nc" id="L231">        gridDimx.addActionListener(fhandler);</span>
<span class="nc" id="L232">        gridDimy.addActionListener(fhandler);</span>
<span class="nc" id="L233">        gridDimz.addActionListener(fhandler);</span>
<span class="nc" id="L234">        gridLen1a.addActionListener(fhandler);</span>
<span class="nc" id="L235">        gridLen2a.addActionListener(fhandler);</span>
<span class="nc" id="L236">        gridLen3a.addActionListener(fhandler);</span>
<span class="nc" id="L237">        countIon1Charge.addActionListener(fhandler);</span>
<span class="nc" id="L238">        countIon1Con.addActionListener(fhandler);</span>
<span class="nc" id="L239">        countIon1Sz.addActionListener(fhandler);</span>
<span class="nc" id="L240">        countIon2Charge.addActionListener(fhandler);</span>
<span class="nc" id="L241">        countIon2Con.addActionListener(fhandler);</span>
<span class="nc" id="L242">        countIon2Sz.addActionListener(fhandler);</span>
<span class="nc" id="L243">        proteinDi.addActionListener(fhandler);</span>
<span class="nc" id="L244">        solventDi.addActionListener(fhandler);</span>
<span class="nc" id="L245">        membraneDi.addActionListener(fhandler);</span>
<span class="nc" id="L246">        Run.addActionListener(fhandler);</span>
<span class="nc" id="L247">        PQRBrowse1.addActionListener(fhandler);</span>
<span class="nc" id="L248">        PQRBrowse2.addActionListener(fhandler);</span>
<span class="nc" id="L249">        Preview.addActionListener(fhandler);</span>
<span class="nc" id="L250">        drawPot.addActionListener(fhandler);</span>
<span class="nc" id="L251">        RedrawPot.addActionListener(fhandler);</span>
<span class="nc" id="L252">        setFocus0.addActionListener(menuhandler);</span>
<span class="nc" id="L253">        setFocus1.addActionListener(menuhandler);</span>
<span class="nc" id="L254">        setFocus2.addActionListener(menuhandler);</span>
<span class="nc" id="L255">        open.addActionListener(menuhandler);</span>
<span class="nc" id="L256">        save.addActionListener(menuhandler);</span>
<span class="nc" id="L257">        exit.addActionListener(menuhandler);</span>
<span class="nc" id="L258">        about.addActionListener(menuhandler);</span>
<span class="nc" id="L259">        readme.addActionListener(menuhandler);</span>

<span class="nc" id="L261">        lpane = new JPanel();</span>

<span class="nc" id="L263">        JmolPanel jmolPanel = new JmolPanel();</span>
        
<span class="nc" id="L265">        aboutdialog = new SimpleAboutDialog(new JFrame());</span>
<span class="nc" id="L266">        helpdialog = new SimpleHelpDialog(new JFrame());</span>

<span class="nc" id="L268">        FormLayout layout = new FormLayout(</span>
                &quot;right:pref, 4dlu, pref, 4dlu, pref, 4dlu, pref, 4dlu, pref&quot;, //columns
                &quot;pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu,&quot; +
                &quot;pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu,&quot; +
                &quot;pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu,&quot; +
                &quot;pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu,&quot; +
                &quot;pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref&quot;); //rows

<span class="nc" id="L276">        PanelBuilder builder = new PanelBuilder(layout);</span>
<span class="nc" id="L277">        builder.setDefaultDialogBorder();</span>

<span class="nc" id="L279">        lpane.setLayout(layout);</span>

<span class="nc" id="L281">        CellConstraints cc = new CellConstraints();</span>
<span class="nc" id="L282">        builder.add(new JLabel(&quot;Calculation type&quot;),     cc.xy (1, 1));</span>
<span class="nc" id="L283">        builder.add(calcTypeCombo,                      cc.xyw(3, 1, 5));</span>

<span class="nc" id="L285">        builder.add(new JLabel(&quot;PQR File 1&quot;),           cc.xy (1, 3));</span>
<span class="nc" id="L286">        builder.add(pqrFile1,                           cc.xyw(3, 3, 3));</span>
<span class="nc" id="L287">        builder.add(PQRBrowse1,                         cc.xy (7, 3));</span>

<span class="nc" id="L289">        builder.add(new JLabel(&quot;PQR File 2&quot;),           cc.xy (1, 5));</span>
<span class="nc" id="L290">        builder.add(pqrFile2,                           cc.xyw (3, 5, 3));</span>
<span class="nc" id="L291">        builder.add(PQRBrowse2,                         cc.xy (7, 5));</span>

<span class="nc" id="L293">        builder.add(new JLabel(&quot;Grid dimensions&quot;),      cc.xy (1, 7));</span>
<span class="nc" id="L294">        builder.add(gridDimx,                           cc.xy (3, 7));</span>
<span class="nc" id="L295">        builder.add(gridDimy,                           cc.xy (5, 7));</span>
<span class="nc" id="L296">        builder.add(gridDimz,                           cc.xy (7, 7));</span>

<span class="nc" id="L298">        builder.add(new JLabel(&quot;Grid lengths&quot;),         cc.xy (1, 9));</span>
<span class="nc" id="L299">        builder.add(gridLen1a,                          cc.xy (3, 9));</span>
<span class="nc" id="L300">        builder.add(gridLen2a,                          cc.xy (5, 9));</span>
<span class="nc" id="L301">        builder.add(gridLen3a,                          cc.xy (7, 9));</span>

<span class="nc" id="L303">        builder.add(new JLabel(&quot;&quot;),                     cc.xy (1, 11));</span>
<span class="nc" id="L304">        builder.add(gridLen1b,                          cc.xy (3, 11));</span>
<span class="nc" id="L305">        builder.add(gridLen2b,                          cc.xy (5, 11));</span>
<span class="nc" id="L306">        builder.add(gridLen3b,                          cc.xy (7, 11));</span>

<span class="nc" id="L308">        builder.add(new JLabel(&quot;&quot;),                     cc.xy (1, 13));</span>
<span class="nc" id="L309">        builder.add(gridLen1c,                          cc.xy (3, 13));</span>
<span class="nc" id="L310">        builder.add(gridLen2c,                          cc.xy (5, 13));</span>
<span class="nc" id="L311">        builder.add(gridLen3c,                          cc.xy (7, 13));</span>

<span class="nc" id="L313">        builder.add(new JLabel(&quot;Counter-ions&quot;),         cc.xy (1, 15));</span>
<span class="nc" id="L314">        builder.add(countIon1Charge,                    cc.xy (3, 15));</span>
<span class="nc" id="L315">        builder.add(countIon1Con,                       cc.xy (5, 15));</span>
<span class="nc" id="L316">        builder.add(countIon1Sz,                        cc.xy (7, 15));</span>

<span class="nc" id="L318">        builder.add(countIon2Charge,                    cc.xy (3, 17));</span>
<span class="nc" id="L319">        builder.add(countIon2Con,                       cc.xy (5, 17));</span>
<span class="nc" id="L320">        builder.add(countIon2Sz,                        cc.xy (7, 17));</span>

<span class="nc" id="L322">        builder.addSeparator(&quot;Dielectric constants&quot;,    cc.xyw(1, 21, 7));</span>
<span class="nc" id="L323">        builder.add(new JLabel(&quot;Protein&quot;),              cc.xy (1, 23));</span>
<span class="nc" id="L324">        builder.add(proteinDi,                          cc.xy (3, 23));</span>
<span class="nc" id="L325">        builder.add(new JLabel(&quot;Solvent&quot;),              cc.xy (5, 23));</span>
<span class="nc" id="L326">        builder.add(solventDi,                          cc.xy (7, 23));</span>
<span class="nc" id="L327">        builder.add(new JLabel(&quot;Membrane&quot;),             cc.xy (1, 25));</span>
<span class="nc" id="L328">        builder.add(membraneDi,                         cc.xy (3, 25));</span>
<span class="nc" id="L329">        builder.add(new JLabel(&quot;Head group&quot;),           cc.xy (5, 25));</span>
<span class="nc" id="L330">        builder.add(idie,                               cc.xy (7, 25));</span>

<span class="nc" id="L332">        builder.addSeparator(&quot;Geometry settings&quot;,       cc.xyw(1, 27, 7));</span>
<span class="nc" id="L333">        builder.add(new JLabel(&quot;Membrane thickness&quot;),   cc.xy (1, 29));</span>
<span class="nc" id="L334">        builder.add(Lmem,                               cc.xy(3, 29));</span>
<span class="nc" id="L335">        builder.add(new JLabel(&quot;Upper exclusion&quot;),      cc.xy (5, 29));</span>
<span class="nc" id="L336">        builder.add(geoFactor1,                         cc.xy(7, 29));</span>
<span class="nc" id="L337">        builder.add(new JLabel(&quot;Head group thickness&quot;), cc.xy (1, 31));</span>
<span class="nc" id="L338">        builder.add(geoFactor3,                         cc.xy(3, 31));</span>
<span class="nc" id="L339">        builder.add(new JLabel(&quot;Lower exclusion&quot;),      cc.xy (5, 31));</span>
<span class="nc" id="L340">        builder.add(geoFactor2,                         cc.xy(7, 31));</span>
<span class="nc" id="L341">        builder.add(new JLabel(&quot;Membrane bottom z-pos&quot;),cc.xy (1, 33));</span>
<span class="nc" id="L342">        builder.add(zmem,                               cc.xy(3, 33));</span>

<span class="nc" id="L344">        builder.addSeparator(&quot;Other parameters&quot;,        cc.xyw(1, 35, 7));</span>
<span class="nc" id="L345">        builder.add(new JLabel(&quot;Solution method&quot;),      cc.xy(1, 37));</span>
<span class="nc" id="L346">        builder.add(solMethodCombo,                     cc.xy(3, 37));</span>
<span class="nc" id="L347">        builder.add(new JLabel(&quot;Temperature&quot;),          cc.xy(5, 37));</span>
<span class="nc" id="L348">        builder.add(temp,                               cc.xy(7, 37));</span>

<span class="nc" id="L350">        builder.add(new JLabel(&quot;Boundary conditions&quot;),  cc.xy(1, 39));</span>
<span class="nc" id="L351">        builder.add(boundaryCondCombo,                  cc.xy(3, 39));</span>
<span class="nc" id="L352">        builder.add(new JLabel(&quot;Membrane potential&quot;),   cc.xy(5,39));</span>
<span class="nc" id="L353">        builder.add(potential,                          cc.xy(7, 39));</span>

<span class="nc" id="L355">        builder.add(new JLabel(&quot;Solvent radius&quot;),       cc.xy(1,41));</span>
<span class="nc" id="L356">        builder.add(srad,                               cc.xy(3,41));</span>
<span class="nc" id="L357">        builder.add(new JLabel(&quot;Sphere density&quot;),       cc.xy(5,41));</span>
<span class="nc" id="L358">        builder.add(sdens,                              cc.xy(7,41));</span>

<span class="nc" id="L360">        builder.add(new JLabel(&quot;Isosurface contour&quot;),   cc.xy(1,43));</span>
<span class="nc" id="L361">        builder.add(contourCombo,                       cc.xy(3,43));</span>
<span class="nc" id="L362">        builder.add(new JLabel(&quot;Grid center&quot;),          cc.xy(5,43));</span>
<span class="nc" id="L363">        builder.add(centerCombo,                        cc.xy(7,43));</span>
        
<span class="nc" id="L365">        builder.add(drawPot,                            cc.xy(3,45));</span>
<span class="nc" id="L366">        builder.add(potcontour,                         cc.xy(5, 45));</span>
<span class="nc" id="L367">        builder.add(RedrawPot,                          cc.xy(7,45));</span>

<span class="nc" id="L369">        builder.add(new JLabel(&quot;&quot;),                     cc.xy(1, 47));</span>
<span class="nc" id="L370">        builder.add(Preview,                            cc.xy(3, 47));</span>
<span class="nc" id="L371">        builder.add(Run,                                cc.xy(5, 47));</span>

<span class="nc" id="L373">        JSplitPane sp = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, builder.getPanel(), null);</span>
<span class="nc" id="L374">        sp.setOneTouchExpandable(true);</span>
<span class="nc" id="L375">        sp.setBorder(null);</span>
<span class="nc" id="L376">        mainPane.add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L377">        JPanel bottom = new JPanel();</span>
<span class="nc" id="L378">        bottom.setLayout(new BorderLayout());</span>
<span class="nc" id="L379">        bottom.add(pBar, BorderLayout.WEST);</span>
<span class="nc" id="L380">        mainPane.add(bottom, BorderLayout.SOUTH);</span>
<span class="nc" id="L381">        viewer = jmolPanel.getViewer();</span>
<span class="nc" id="L382">        viewer.evalString(&quot;zap;frank off;&quot;);</span>
<span class="nc" id="L383">        File logo = new File(&quot;apbsmem.jvxl&quot;);</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">        if(logo.exists())</span>
<span class="nc" id="L385">            viewer.evalString(&quot;isoSurface \&quot;apbsmem.jvxl\&quot;;zoom 200;&quot;);</span>

<span class="nc" id="L387">       theWindow.pack();</span>
<span class="nc" id="L388">       jmolPanel.setPreferredSize(new Dimension(300,300));</span>
<span class="nc" id="L389">       sp.setRightComponent(jmolPanel);</span>
<span class="nc" id="L390">       theWindow.pack();</span>
<span class="nc" id="L391">       theWindow.setVisible(true);</span>

<span class="nc" id="L393">        dependencyCheck();</span>
        
<span class="nc" id="L395">    }</span>

    /**
     * Driver method
     * @param args No command-line arguments are necessary
     */
    public static void main(String[] args) {
<span class="nc" id="L402">        m = new Main();</span>
<span class="nc" id="L403">    }</span>

<span class="nc" id="L405">    private class menuHandler implements ActionListener {</span>

        public void actionPerformed(ActionEvent e) {

<span class="nc bnc" id="L409" title="All 2 branches missed.">            if (e.getSource() == setFocus0) {</span>
<span class="nc" id="L410">                setMaxFocus(0);</span>
            }

<span class="nc bnc" id="L413" title="All 2 branches missed.">            if (e.getSource() == setFocus1) {</span>
<span class="nc" id="L414">                setMaxFocus(1);</span>
            }

<span class="nc bnc" id="L417" title="All 2 branches missed.">            if (e.getSource() == setFocus2) {</span>
<span class="nc" id="L418">                setMaxFocus(2);</span>
            }

<span class="nc bnc" id="L421" title="All 2 branches missed.">            else if(e.getSource() == about) {</span>
<span class="nc" id="L422">                aboutdialog.show();</span>
            }

<span class="nc bnc" id="L425" title="All 2 branches missed.">            else if(e.getSource() == readme) {</span>
<span class="nc" id="L426">                helpdialog.show();</span>
            }

            //opens a *.in file that has between 0 and 2 focus
<span class="nc bnc" id="L430" title="All 2 branches missed.">            else if (e.getSource() == open) {</span>
                
<span class="nc bnc" id="L432" title="All 2 branches missed.">                if (OpenFile()) {</span>
                    //if got the file successfully and (dont save)
                    try {
<span class="nc" id="L435">                        fScan = new Scanner(new FileInputStream(ofile));</span>
<span class="nc" id="L436">                    } catch (Exception e1) {</span>
<span class="nc" id="L437">                        System.out.println(e1.getMessage());</span>
<span class="nc" id="L438">                    }</span>

<span class="nc" id="L440">                    calcTypeCombo.setSelectedIndex(0); //assume protein solvation unless we see &gt;1 pqr or memv parameters</span>
                    
<span class="nc" id="L442">                    StringBuffer theData = new StringBuffer();</span>
<span class="nc" id="L443">                    int loadfocus = -1;</span>
                    String nextline;
<span class="nc bnc" id="L445" title="All 2 branches missed.">                    while (fScan.hasNextLine()) {</span>
<span class="nc" id="L446">                        nextline = fScan.nextLine();</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">                        if (nextline.contains(&quot;elec name&quot;)) {</span>
<span class="nc bnc" id="L448" title="All 4 branches missed.">                            if (loadfocus &gt; -1 &amp;&amp; nextline.endsWith(&quot;0&quot;))</span>
<span class="nc" id="L449">                                break; // we only want to load one section so we stop if we see a new section</span>
                            else
<span class="nc" id="L451">                                loadfocus++;</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">                        } else if (nextline.contains(&quot;end&quot;)) {	//if done with loading a focus level</span>
<span class="nc" id="L453">                            SaveData();						//save current data regardless. first focus it wont really do anything</span>
<span class="nc" id="L454">                            maxfocus = loadfocus;</span>
<span class="nc" id="L455">                            String temp = theData.toString();</span>
<span class="nc" id="L456">                            String[] data = temp.split(&quot;\n&quot;);</span>
<span class="nc" id="L457">                            LoadData(data,loadfocus);						//then load up data to the new focus</span>
<span class="nc" id="L458">                            theData = new StringBuffer();		//finally, reset the data for the next focus</span>
<span class="nc" id="L459">                        } else {</span>
<span class="nc" id="L460">                            theData.append(nextline + &quot;\n&quot;);</span>
                        }
                    }

<span class="nc" id="L464">                    fScan.close();</span>

<span class="nc" id="L466">                    setMaxFocus(maxfocus);</span>

<span class="nc" id="L468">                }</span>

            }

<span class="nc bnc" id="L472" title="All 2 branches missed.">            else if (e.getSource() == save) {</span>
<span class="nc bnc" id="L473" title="All 4 branches missed.">                if (SaveData() &amp;&amp; SaveDialog(&quot;Save settings to file&quot;)) {</span>
                    //if it was able to save the data
<span class="nc" id="L475">                    SaveToFile(true);		//save all data to file (true = first run)</span>
<span class="nc" id="L476">                    hasbeenchanged = false;	//file has not been changed since</span>
                }
            }

<span class="nc bnc" id="L480" title="All 2 branches missed.">            else if (e.getSource() == exit) {</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">                if (hasbeenchanged) {</span>
                    int answer;
<span class="nc bnc" id="L483" title="All 2 branches missed.">                    if (file_loaded) {</span>
<span class="nc" id="L484">                        answer = JOptionPane.showConfirmDialog(null, &quot;Do you want to save changes to &quot; + ofile.getName() + &quot;?&quot;, &quot;&quot;, JOptionPane.YES_NO_OPTION);</span>
                    }
                    else {
<span class="nc" id="L487">                        answer = JOptionPane.showConfirmDialog(null, &quot;Do you want to save your settings?&quot;, &quot;&quot;, JOptionPane.YES_NO_OPTION);</span>
                    }
<span class="nc bnc" id="L489" title="All 2 branches missed.">                    if(answer == JOptionPane.YES_OPTION) {</span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">                        if (!file_loaded) {</span>
<span class="nc" id="L491">                            SaveDialog(&quot;Save settings to file&quot;);</span>
                        }
<span class="nc" id="L493">                        SaveToFile(true);</span>
                    }
                }
<span class="nc" id="L496">                File curdir = new File(&quot;.&quot;);</span>
<span class="nc" id="L497">                deleteFiles(curdir.getPath(), &quot;.dx&quot;);</span>
<span class="nc" id="L498">                System.exit(0);</span>
            }
<span class="nc" id="L500">        }</span>
    }

<span class="nc" id="L503">    private class fileInHandler implements ActionListener {</span>

        public void actionPerformed(ActionEvent e) {
<span class="nc bnc" id="L506" title="All 2 branches missed.">            if (e.getSource() == Preview) {</span>
<span class="nc bnc" id="L507" title="All 2 branches missed.">                if(pqrFile1.getText() == &quot;&quot;) {</span>
<span class="nc" id="L508">                    JOptionPane.showMessageDialog(null, &quot;Please select the PQR file&quot;, &quot;Error&quot;, JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc" id="L509">                    return;</span>
                }
                else {
<span class="nc" id="L512">                    File tfile = new File(pqrFile1.getText());</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">                    if(!tfile.exists()) {</span>
<span class="nc" id="L514">                        JOptionPane.showMessageDialog(null, &quot;PQR file not found&quot;, &quot;Error&quot;, JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc" id="L515">                        return;</span>
                    }
                }

<span class="nc" id="L519">                Integer t1 = Integer.parseInt(gridDimx.getText());</span>
<span class="nc" id="L520">                Integer t2 = Integer.parseInt(gridDimy.getText());</span>
<span class="nc" id="L521">                Integer t3 = Integer.parseInt(gridDimz.getText());</span>

<span class="nc" id="L523">                gridDimx.setText(&quot;65&quot;);</span>
<span class="nc" id="L524">                gridDimy.setText(&quot;65&quot;);</span>
<span class="nc" id="L525">                gridDimz.setText(&quot;65&quot;);</span>

<span class="nc" id="L527">                SaveData();</span>

<span class="nc" id="L529">                ofile = new File(&quot;./preview_temp&quot;);</span>

<span class="nc bnc" id="L531" title="All 2 branches missed.">                if(calcTypeCombo.getSelectedIndex() == 1) {</span>
                        //ION SOLVATION
<span class="nc bnc" id="L533" title="All 2 branches missed.">                        if (!pqrFile2.getText().equals(&quot;&quot;)) {</span>
<span class="nc" id="L534">                            viewer.evalString(&quot;load APPEND \&quot;&quot; + pqrFile2.getText() + &quot;\&quot;&quot;); //Load the ION too!</span>
<span class="nc" id="L535">                            viewer.evalString(&quot;frame *;cpk off;wireframe off;cartoon on;color green;select 2.0;color purple;spacefill 100%&quot;);</span>
                        }
                }
                

<span class="nc" id="L540">                Thread pT = new Thread(new Run(m, inFile, ofile, viewer, pBar, drawPot.isSelected(), potcontour.getText(), true));</span>
<span class="nc" id="L541">                pT.start();</span>


<span class="nc" id="L544">                ofile.delete();</span>

<span class="nc" id="L546">                gridDimx.setText(t1.toString());</span>
<span class="nc" id="L547">                gridDimy.setText(t2.toString());</span>
<span class="nc" id="L548">                gridDimz.setText(t3.toString());</span>

<span class="nc" id="L550">                pBar.setValue(0);</span>

<span class="nc" id="L552">            }</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">            else if (e.getSource() == Run) {</span>

<span class="nc bnc" id="L555" title="All 2 branches missed.">                if(pqrFile1.getText().equals(&quot;&quot;)) {</span>
<span class="nc" id="L556">                        JOptionPane.showMessageDialog(null, &quot;Please select the PQR file for the protein.&quot;, &quot;Error&quot;, JOptionPane.PLAIN_MESSAGE);</span>
<span class="nc" id="L557">                        return;</span>
                    }
                    else {
<span class="nc" id="L560">                        File tfile1 = new File(pqrFile1.getText());</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">                        if(!tfile1.exists()) {</span>
<span class="nc" id="L562">                            System.out.println(&quot;Protein PQR file not found.&quot;);</span>
<span class="nc" id="L563">                            return;</span>
                        }
                }
<span class="nc" id="L566">                System.out.println(&quot;Focus: &quot; + maxfocus + &quot; &quot; + inFile.getMaxfocus());</span>
                //clean up files from a previous run - this should not be needed at some point
<span class="nc" id="L568">                File curdir = new File(&quot;.&quot;);</span>
<span class="nc" id="L569">                deleteFiles(curdir.getPath(), &quot;.dx&quot;);</span>

<span class="nc bnc" id="L571" title="All 4 branches missed.">                if (SaveData() &amp;&amp; SaveDialog(&quot;Enter a name for the output directory before running&quot;)) {</span>

<span class="nc bnc" id="L573" title="All 2 branches missed.">                     if(calcTypeCombo.getSelectedIndex() == 1) {</span>
                        //ION SOLVATION - create concatenation file of ion + protein
<span class="nc" id="L575">                        viewer.evalString(&quot;load FILES \&quot;&quot; + pqrFile1.getText() + &quot;\&quot; \&quot;&quot; + pqrFile2.getText() + &quot;\&quot;&quot;); //Load the ION too!</span>
                        try {
<span class="nc" id="L577">                            BufferedWriter prot1 = new BufferedWriter(new FileWriter(pqrFile1.getText() + &quot;.withion.pqr&quot;, false));</span>
<span class="nc" id="L578">                            BufferedReader in1 = new BufferedReader(new FileReader(pqrFile1.getText()));</span>
<span class="nc" id="L579">                            BufferedReader in2 = new BufferedReader(new FileReader(pqrFile2.getText()));</span>
                            String inputline;

<span class="nc bnc" id="L582" title="All 2 branches missed.">                            while((inputline = in1.readLine()) != null) {</span>
<span class="nc" id="L583">                                prot1.write(inputline);</span>
<span class="nc" id="L584">                                prot1.newLine();</span>
                            }
<span class="nc bnc" id="L586" title="All 2 branches missed.">                            while((inputline = in2.readLine()) != null) {</span>
<span class="nc" id="L587">                                prot1.write(inputline);</span>
<span class="nc" id="L588">                                prot1.newLine();</span>
                            }
<span class="nc" id="L590">                            prot1.flush();</span>
<span class="nc" id="L591">                            prot1.close();</span>
<span class="nc" id="L592">                          in1.close();</span>
<span class="nc" id="L593">                          in2.close();</span>
<span class="nc" id="L594">                        } catch (Exception e1) {</span>
<span class="nc" id="L595">                            System.out.println(e1);</span>
<span class="nc" id="L596">                        }</span>

<span class="nc" id="L598">                        inFile.setMol3(pqrFile1.getText() + &quot;.withion.pqr&quot;);</span>

<span class="nc" id="L600">                        viewer.evalString(&quot;load APPEND \&quot;&quot; + pqrFile2.getText() + &quot;\&quot;&quot;); //Load the ION too!</span>
<span class="nc" id="L601">                        viewer.evalString(&quot;frame *;cpk off;wireframe off;cartoons on;color green;select 2.0;color purple;spacefill 100%&quot;);</span>

                    }
<span class="nc bnc" id="L604" title="All 2 branches missed.">                    else if(calcTypeCombo.getSelectedIndex() == 2) {</span>
                        //GATING CHARGE - turn charges off for dummy calculation
<span class="nc" id="L606">                        exec.callChargeOff(pqrFile1.getText());</span>
<span class="nc" id="L607">                        exec.callChargeOff(pqrFile2.getText());</span>
                    }


<span class="nc" id="L611">                    Thread t1 = new Thread(new Run(m, inFile, ofile, viewer, pBar, drawPot.isSelected(), potcontour.getText(), false));</span>
<span class="nc" id="L612">                    t1.start();</span>
                    
<span class="nc bnc" id="L614" title="All 2 branches missed.">                    if(drawPot.isEnabled()) {</span>
<span class="nc" id="L615">                        RedrawPot.setEnabled(true);</span>
                    }
                }
<span class="nc" id="L618">                pBar.setValue(0);</span>

<span class="nc" id="L620">            }</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">            else if (e.getSource() == PQRBrowse1) {</span>
                
<span class="nc" id="L623">                final JFileChooser fc = new JFileChooser(new File(&quot;.&quot;));</span>
                
<span class="nc" id="L625">                fc.setAcceptAllFileFilterUsed(false);</span>

<span class="nc" id="L627">                EFileFilter filter = new EFileFilter(&quot;pqr&quot;);</span>
<span class="nc" id="L628">                filter.setDescription(&quot;PQR files&quot;);</span>
<span class="nc" id="L629">                fc.addChoosableFileFilter(filter);</span>

<span class="nc" id="L631">                int returnVal = fc.showOpenDialog(theWindow);</span>

<span class="nc bnc" id="L633" title="All 2 branches missed.">                if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L634">                    pqrFile1.setText(fc.getSelectedFile().getPath());</span>
<span class="nc" id="L635">                    viewer.openFile(pqrFile1.getText());</span>
                }
<span class="nc" id="L637">            }</span>
<span class="nc bnc" id="L638" title="All 2 branches missed.">            else if (e.getSource() == PQRBrowse2) {</span>
<span class="nc" id="L639">                final JFileChooser fc = new JFileChooser(new File(&quot;.&quot;));</span>

<span class="nc" id="L641">                fc.setAcceptAllFileFilterUsed(false);</span>

<span class="nc" id="L643">                EFileFilter filter = new EFileFilter(&quot;pqr&quot;);</span>
<span class="nc" id="L644">                filter.setDescription(&quot;PQR files&quot;);</span>
<span class="nc" id="L645">                fc.addChoosableFileFilter(filter);</span>

<span class="nc" id="L647">                int returnVal = fc.showOpenDialog(theWindow);</span>

<span class="nc bnc" id="L649" title="All 2 branches missed.">                if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L650">                    pqrFile2.setText(fc.getSelectedFile().getPath());</span>
                   // viewer.openFile(pqrFile2.getText());
                }
<span class="nc" id="L653">            }</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">            else if (e.getSource() == boundaryCondCombo) {</span>

<span class="nc bnc" id="L656" title="All 2 branches missed.">                if(calcTypeCombo.getSelectedIndex() == 2) {</span>
<span class="nc" id="L657">                    boundaryCondCombo.setSelectedIndex(4);</span>
<span class="nc" id="L658">                    potential.setEnabled(true);</span>
                }
                else {
<span class="nc bnc" id="L661" title="All 2 branches missed.">                    if(boundaryCondCombo.getSelectedIndex() == 4) {</span>
<span class="nc" id="L662">                        boundaryCondCombo.setSelectedIndex(0);</span>
<span class="nc" id="L663">                        potential.setEnabled(false);</span>
                    }
<span class="nc bnc" id="L665" title="All 4 branches missed.">                    if(boundaryCondCombo.getSelectedIndex() == 3 &amp;&amp; maxfocus == 0) {</span>
                        String temp;

<span class="nc" id="L668">                        Object[] choices = {&quot;0&quot;,&quot;1&quot;,&quot;2&quot;};</span>
<span class="nc" id="L669">                        temp = (String) JOptionPane.showInputDialog(null, &quot;How many focus levels do you want to set?&quot;, &quot;Focus levels&quot;, JOptionPane.QUESTION_MESSAGE, null, choices,choices[0]);</span>

<span class="nc" id="L671">                        setMaxFocus(Integer.parseInt(temp));</span>
<span class="nc" id="L672">                    }</span>
                }

            }
            
<span class="nc bnc" id="L677" title="All 2 branches missed.">            else if (e.getSource() == calcTypeCombo) {</span>

<span class="nc bnc" id="L679" title="All 2 branches missed.">                if(calcTypeCombo.getSelectedIndex() == 0) {</span>
                    //PROTEIN SOLVATION
<span class="nc" id="L681">                    pqrFile2.setEnabled(false);</span>
<span class="nc" id="L682">                    PQRBrowse2.setEnabled(false);</span>
<span class="nc" id="L683">                    pqrFile1.setToolTipText(&quot;PQR file of protein in membrane&quot;);</span>
<span class="nc bnc" id="L684" title="All 2 branches missed.">                    if(boundaryCondCombo.getSelectedIndex() == 4) {</span>
<span class="nc" id="L685">                        boundaryCondCombo.setSelectedIndex(0);</span>
                    }
                }
<span class="nc bnc" id="L688" title="All 2 branches missed.">                else if(calcTypeCombo.getSelectedIndex() == 1) {</span>
                    //ION SOLVATION
<span class="nc" id="L690">                    pqrFile2.setEnabled(true);</span>
<span class="nc" id="L691">                    PQRBrowse2.setEnabled(true);</span>
<span class="nc" id="L692">                    pqrFile1.setToolTipText(&quot;PQR file of protein&quot;);</span>
<span class="nc" id="L693">                    pqrFile2.setToolTipText(&quot;PQR file of ion only&quot;);</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">                    if(boundaryCondCombo.getSelectedIndex() == 4) {</span>
<span class="nc" id="L695">                        boundaryCondCombo.setSelectedIndex(0);</span>
                    }
                }
                else {
                    //GATING CHARGE
<span class="nc" id="L700">                    pqrFile2.setEnabled(true);</span>
<span class="nc" id="L701">                    PQRBrowse2.setEnabled(true);</span>
<span class="nc" id="L702">                    pqrFile1.setToolTipText(&quot;PQR file of gating conformation 1&quot;);</span>
<span class="nc" id="L703">                    pqrFile2.setToolTipText(&quot;PQR file of gating conformation 2&quot;);</span>
<span class="nc" id="L704">                    boundaryCondCombo.setSelectedIndex(4);</span>
<span class="nc" id="L705">                    potential.setEnabled(true);</span>
                }

              
            }

<span class="nc bnc" id="L711" title="All 2 branches missed.">            else if (e.getSource() == drawPot) {</span>
<span class="nc" id="L712">                potcontour.setEnabled(drawPot.isSelected());</span>
            }

<span class="nc bnc" id="L715" title="All 2 branches missed.">            else if(e.getSource() == RedrawPot) {</span>
<span class="nc" id="L716">                viewer.evalString(&quot;isosurface delete&quot;);</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">                if (drawPot.isSelected()) {</span>
<span class="nc" id="L718">                    viewer.evalString(&quot;isosurface &quot; + getIsocontour() + &quot; \&quot;dielx_&quot; + (maxfocus + 1) + &quot;m.dx\&quot;; color isosurface white translucent&quot;);</span>
<span class="nc" id="L719">                    viewer.evalString(&quot;isosurface potpos &quot; + potcontour.getText() + &quot; \&quot;pot_1.dx\&quot;; color isoSurface red translucent&quot;);</span>
<span class="nc" id="L720">                    viewer.evalString(&quot;isosurface potneg -&quot; + potcontour.getText() + &quot; \&quot;pot_1.dx\&quot;; color isoSurface blue translucent&quot;);</span>
                }
            }
<span class="nc" id="L723">        }</span>
    }	///end fileInHandler

    public Double getIsocontour() {
        //protein-membrane dielectric
<span class="nc bnc" id="L728" title="All 2 branches missed.">        if (contourCombo.getSelectedIndex() == 0) {</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">            if (Double.valueOf(inFile.getMdie()) &lt; Double.valueOf(inFile.getProteinDi())) {</span>
<span class="nc" id="L730">                return Double.valueOf(inFile.getMdie()) + 0.001;</span>
            }
            else {
<span class="nc" id="L733">                return Double.valueOf(inFile.getProteinDi()) + 0.001;</span>
            }
        }
        //protein-solvent boundary
        else {
<span class="nc bnc" id="L738" title="All 2 branches missed.">            if (Double.valueOf(inFile.getProteinDi()) &lt; Double.valueOf(inFile.getSolventDi())) {</span>
<span class="nc" id="L739">                return Double.valueOf(inFile.getProteinDi()) + 0.001;</span>
            }
            else {
<span class="nc" id="L742">                return Double.valueOf(inFile.getSolventDi()) + 0.001;</span>
            }
        }
    }
    /**
     * Change the number of focus levels to use in the calculation
     * @param mf The new number of focus levels. Current options are 0, 1, or 2.
     */
    public void setMaxFocus(int mf) {
<span class="nc" id="L751">        maxfocus = mf;</span>
<span class="nc" id="L752">        inFile.setMaxFocus(mf);</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">        if (maxfocus == 0) {</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">            if(boundaryCondCombo.getSelectedIndex() == 3)</span>
<span class="nc" id="L755">                boundaryCondCombo.setSelectedIndex(0);</span>

<span class="nc" id="L757">            setFocus1Enable(false);</span>
<span class="nc" id="L758">            setFocus2Enable(false);</span>
<span class="nc" id="L759">            setFocus0.setSelected(true);</span>
        }
<span class="nc bnc" id="L761" title="All 2 branches missed.">        else if(maxfocus == 1) {</span>
<span class="nc" id="L762">            boundaryCondCombo.setSelectedIndex(3);</span>
<span class="nc" id="L763">            setFocus1Enable(true);</span>
<span class="nc" id="L764">            setFocus2Enable(false);</span>
<span class="nc" id="L765">            setFocus1.setSelected(true);</span>
        }
        else {
<span class="nc" id="L768">            boundaryCondCombo.setSelectedIndex(3);</span>
<span class="nc" id="L769">            setFocus1Enable(true);</span>
<span class="nc" id="L770">            setFocus2Enable(true);</span>
<span class="nc" id="L771">            setFocus2.setSelected(true);</span>
        }
<span class="nc" id="L773">    }</span>

    /**
     * Enable or disable text input fields for the level 1 focusing.
     * @param v flag to enable (if true) or disable (if false) the focus level 1.
     */
    public void setFocus1Enable(boolean v) {
<span class="nc" id="L780">        gridLen1b.setEnabled(v);</span>
<span class="nc" id="L781">        gridLen2b.setEnabled(v);</span>
<span class="nc" id="L782">        gridLen3b.setEnabled(v);</span>
<span class="nc" id="L783">    }</span>

    /**
     * Enable or disable text input fields for the level 2 focusing.
     * @param v flag to enable (if true) or disable (if false) the focus level 2.
     */
    public void setFocus2Enable(boolean v) {
<span class="nc" id="L790">        gridLen1c.setEnabled(v);</span>
<span class="nc" id="L791">        gridLen2c.setEnabled(v);</span>
<span class="nc" id="L792">        gridLen3c.setEnabled(v);</span>
<span class="nc" id="L793">    }</span>

    /**
     * Save the parameters stored in the inFile object to a file.
     * @param firstcall True if the file to be written is the &quot;dummy&quot; file
     * before the real calculation, otherwise false.
     */
    public void SaveToFile(boolean firstcall)
    {
<span class="nc bnc" id="L802" title="All 2 branches missed.">        if (ofile != null) {</span>
            
            try {
<span class="nc bnc" id="L805" title="All 2 branches missed.">                if(firstcall) {</span>
<span class="nc" id="L806">                    File outFile2 = new File(ofile.getPath() + &quot;.dummy.in&quot;);</span>
<span class="nc" id="L807">                    outFile2.delete();</span>
<span class="nc" id="L808">                    outFile = new PrintWriter(new FileOutputStream(outFile2));</span>
<span class="nc" id="L809">                    System.out.println(&quot;HEY: &quot; + outFile2.getPath());</span>
<span class="nc" id="L810">                }</span>
		else {
<span class="nc" id="L812">                    File outFile2 = new File(ofile.getPath() + &quot;.solv.in&quot;);</span>
<span class="nc" id="L813">                    outFile2.delete();</span>
<span class="nc" id="L814">                    outFile = new PrintWriter(new FileOutputStream(outFile2));</span>
                }
<span class="nc" id="L816">            } catch (Exception e1) {</span>
<span class="nc" id="L817">                System.out.println(&quot;SaveToFile exception: &quot; + e1.toString());</span>
<span class="nc" id="L818">            }</span>
                                

<span class="nc" id="L821">            String tempIn = inFile.toString(firstcall);         //store data in temporary string</span>
<span class="nc" id="L822">            String[] tempInSplit = tempIn.split(&quot;\n&quot;);		//split data by each new line</span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">            for (int i = 0; i &lt; tempInSplit.length; i++) {</span>
<span class="nc" id="L824">                outFile.println(tempInSplit[i]);		//print data one line at a time</span>
            }
             
<span class="nc" id="L827">            outFile.close();</span>

        }
<span class="nc" id="L830">    }</span>

    /**
     * Store the current GUI text field values in the inFile object.
     * @return True if the operation was succesful, false otherwise.
     */
    public boolean SaveData()
    {
<span class="nc bnc" id="L838" title="All 4 branches missed.">        if (pqrFile1.getText().equals(&quot;&quot;) || pqrFile1.getText() == null ||</span>
<span class="nc bnc" id="L839" title="All 12 branches missed.">                gridDimx.getText().equals(&quot;&quot;) || gridDimx.getText() == null || gridDimy.getText().equals(&quot;&quot;) || gridDimy.getText() == null || gridDimz.getText().equals(&quot;&quot;) || gridDimz.getText() == null ||</span>
<span class="nc bnc" id="L840" title="All 12 branches missed.">                gridLen1a.getText().equals(&quot;&quot;) || gridLen1a.getText() == null || gridLen2a.getText().equals(&quot;&quot;) || gridLen2a.getText() == null || gridLen3a.getText().equals(&quot;&quot;) || gridLen3a.getText() == null ||</span>
<span class="nc bnc" id="L841" title="All 12 branches missed.">                countIon1Charge.getText().equals(&quot;&quot;) || countIon1Charge.getText() == null || countIon1Con.getText().equals(&quot;&quot;) || countIon1Con.getText() == null || countIon1Sz.getText().equals(&quot;&quot;) || countIon1Sz.getText() == null ||</span>
<span class="nc bnc" id="L842" title="All 12 branches missed.">                countIon2Charge.getText().equals(&quot;&quot;) || countIon2Charge.getText() == null || countIon2Con.getText().equals(&quot;&quot;) || countIon2Con.getText() == null || countIon2Sz.getText().equals(&quot;&quot;) || countIon2Sz.getText() == null ||</span>
<span class="nc bnc" id="L843" title="All 8 branches missed.">                proteinDi.getText().equals(&quot;&quot;) || proteinDi.getText() == null || solventDi.getText().equals(&quot;&quot;) || solventDi.getText() == null ||</span>
<span class="nc bnc" id="L844" title="All 12 branches missed.">                srad.getText().equals(&quot;&quot;) || srad.getText() == null || sdens.getText().equals(&quot;&quot;) || sdens.getText() == null || temp.getText().equals(&quot;&quot;) || temp.getText() == null) {</span>
<span class="nc bnc" id="L845" title="All 14 branches missed.">            if(maxfocus &gt; 0 &amp;&amp; (gridLen1b.getText().equals(&quot;&quot;) || gridLen1b.getText() == null || gridLen2b.getText().equals(&quot;&quot;) || gridLen2b.getText() == null || gridLen3b.getText().equals(&quot;&quot;) || gridLen3b.getText() == null)) {</span>
<span class="nc bnc" id="L846" title="All 14 branches missed.">                if(maxfocus &gt; 1 &amp;&amp; (gridLen1c.getText().equals(&quot;&quot;) || gridLen1c.getText() == null || gridLen2c.getText().equals(&quot;&quot;) || gridLen2c.getText() == null || gridLen3c.getText().equals(&quot;&quot;) || gridLen3c.getText() == null)) {</span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">                    if (file_loaded) {		//if you arent opening it and it fails then fail</span>
<span class="nc" id="L848">                        JOptionPane.showMessageDialog(null, &quot;Fill in all values first&quot;, &quot;&quot;, JOptionPane.ERROR_MESSAGE);</span>
<span class="nc" id="L849">                        return false;</span>
                    }
                }
            }
        }
        //otherwise save data
<span class="nc" id="L855">        inFile.setMol1(pqrFile1.getText());</span>
<span class="nc" id="L856">        inFile.setMol2(pqrFile2.getText());        </span>
<span class="nc" id="L857">        inFile.setDime(new String(gridDimx.getText() + &quot; &quot; + gridDimy.getText() + &quot; &quot; + gridDimz.getText()));</span>
<span class="nc" id="L858">        inFile.setGlen(new String(gridLen1a.getText() + &quot; &quot; + gridLen2a.getText() + &quot; &quot; + gridLen3a.getText()),0);</span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">        if(maxfocus &gt; 0) {</span>
<span class="nc" id="L860">            inFile.setGlen(new String(gridLen1b.getText() + &quot; &quot; + gridLen2b.getText() + &quot; &quot; + gridLen3b.getText()),1);</span>
        }
<span class="nc bnc" id="L862" title="All 2 branches missed.">        if(maxfocus == 2) {</span>
<span class="nc" id="L863">            inFile.setGlen(new String(gridLen1c.getText() + &quot; &quot; + gridLen2c.getText() + &quot; &quot; + gridLen3c.getText()),2);</span>
        }
<span class="nc" id="L865">        inFile.setIon1Charge(countIon1Charge.getText());</span>
<span class="nc" id="L866">        inFile.setIon1Conc(countIon1Con.getText());</span>
<span class="nc" id="L867">        inFile.setIon1Radius(countIon1Sz.getText());</span>
<span class="nc" id="L868">        inFile.setIon2Charge(countIon2Charge.getText());</span>
<span class="nc" id="L869">        inFile.setIon2Conc(countIon2Con.getText());</span>
<span class="nc" id="L870">        inFile.setIon2Radius(countIon2Sz.getText());</span>
        
<span class="nc" id="L872">        inFile.setProteinDi(new String(proteinDi.getText()));</span>
<span class="nc" id="L873">        inFile.setSolventDi(new String(solventDi.getText()));</span>
<span class="nc" id="L874">        inFile.setSrad(srad.getText());</span>
<span class="nc" id="L875">        inFile.setSdens(sdens.getText());</span>
<span class="nc" id="L876">        inFile.setTemp(temp.getText());</span>
<span class="nc" id="L877">        inFile.setType(calcTypeCombo.getSelectedIndex());</span>
<span class="nc" id="L878">        inFile.setPotential(potential.getText());</span>
<span class="nc" id="L879">        inFile.setLmem(Lmem.getText());</span>
<span class="nc" id="L880">        inFile.setZmem(zmem.getText());</span>
<span class="nc" id="L881">        inFile.setMdie(membraneDi.getText());</span>
<span class="nc" id="L882">        inFile.setIdie(idie.getText());</span>
<span class="nc" id="L883">        inFile.setGeo1(geoFactor1.getText());</span>
<span class="nc" id="L884">        inFile.setGeo2(geoFactor2.getText());</span>
<span class="nc" id="L885">        inFile.setGeo3(geoFactor3.getText());</span>
<span class="nc" id="L886">        inFile.setDrawPot(drawPot.isSelected());</span>
<span class="nc bnc" id="L887" title="All 2 branches missed.">        if(boundaryCondCombo.getSelectedIndex() == 2) {</span>
<span class="nc" id="L888">            inFile.setBoundCond(new String(&quot;mdh&quot;));</span>
<span class="nc bnc" id="L889" title="All 2 branches missed.">        } else if (boundaryCondCombo.getSelectedIndex() == 1) {</span>
<span class="nc" id="L890">            inFile.setBoundCond(new String(&quot;sdh&quot;));</span>
<span class="nc bnc" id="L891" title="All 2 branches missed.">        } else if (boundaryCondCombo.getSelectedIndex() == 0) {</span>
<span class="nc" id="L892">            inFile.setBoundCond(new String(&quot;zero&quot;));</span>
        }
<span class="nc bnc" id="L894" title="All 2 branches missed.">        if (solMethodCombo.getSelectedIndex() == 1) {</span>
<span class="nc" id="L895">            inFile.setSolMethod(new String(&quot;npbe&quot;));</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">        } else if (solMethodCombo.getSelectedIndex() == 0) {</span>
<span class="nc" id="L897">            inFile.setSolMethod(new String(&quot;lpbe&quot;));</span>
        }

<span class="nc bnc" id="L900" title="All 2 branches missed.">        if (centerCombo.getSelectedIndex() == 0) {</span>
<span class="nc" id="L901">            inFile.setCenter(new String(&quot;0 0 0&quot;));</span>
<span class="nc bnc" id="L902" title="All 2 branches missed.">        } else if (centerCombo.getSelectedIndex() == 1) {</span>
<span class="nc" id="L903">            inFile.setCenter(new String(&quot;mol 1&quot;));</span>
        }

<span class="nc" id="L906">        return true;</span>
    }

    /**
     * Load parameters from an APBS input file into the GUI.
     * @param thedata APBS input file read into a string array by lines.
     * @param loadfocus the focus level for which to load the parameters.
     */
    private void LoadData(String[] thedata, int loadfocus) {
<span class="nc" id="L915">        boolean countion1 = true;	//take in the first ion as #1</span>
        
<span class="nc bnc" id="L917" title="All 2 branches missed.">        for (int i = 0; i &lt; thedata.length; i++) {</span>

<span class="nc bnc" id="L919" title="All 2 branches missed.">            if (thedata[i].contains(&quot;mol pqr &quot;)) {</span>

<span class="nc bnc" id="L921" title="All 2 branches missed.">                if(thedata[i-1].contains(&quot;mol pqr &quot;)) {</span>
<span class="nc bnc" id="L922" title="All 2 branches missed.">                    if(thedata[i-2].contains(&quot;mol pqr &quot;)) {</span>
                        // there are 3 files so it must be ion solvation
<span class="nc" id="L924">                        calcTypeCombo.setSelectedIndex(1);</span>
                    }
                    else {
                        // there are 2 files so it must be gating charge
<span class="nc" id="L928">                        String f_temp = thedata[i].substring((thedata[i].indexOf(&quot;mol pqr &quot;) + 8), thedata[i].length());</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">                        if (f_temp.startsWith(&quot;\&quot;&quot;))</span>
<span class="nc" id="L930">                            f_temp = f_temp.substring(1,f_temp.length()-1);</span>
<span class="nc" id="L931">                        pqrFile2.setText(f_temp);</span>
<span class="nc" id="L932">                        calcTypeCombo.setSelectedIndex(2);</span>
<span class="nc" id="L933">                    }</span>
                }
                else {
<span class="nc" id="L936">                    String f_temp = thedata[i].substring((thedata[i].indexOf(&quot;mol pqr &quot;) + 8), thedata[i].length());</span>
<span class="nc bnc" id="L937" title="All 2 branches missed.">                        if (f_temp.startsWith(&quot;\&quot;&quot;))</span>
<span class="nc" id="L938">                            f_temp = f_temp.substring(1,f_temp.length()-1);</span>
<span class="nc" id="L939">                    pqrFile1.setText(f_temp);</span>
<span class="nc" id="L940">                    viewer.openFile(pqrFile1.getText());</span>
<span class="nc" id="L941">                }</span>
<span class="nc bnc" id="L942" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;dime &quot;)) {</span>
<span class="nc" id="L943">                String tempdime[] = thedata[i].substring((thedata[i].indexOf(&quot;dime &quot;) + 5), thedata[i].length()).split(&quot; &quot;);</span>
                //if data isnt empty, set the data, else set it to blank
<span class="nc bnc" id="L945" title="All 2 branches missed.">                    if (tempdime.length &gt; 0) {</span>
<span class="nc" id="L946">                        gridDimx.setText(tempdime[0]);</span>
                    } else {
<span class="nc" id="L948">                        gridDimx.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L950" title="All 2 branches missed.">                    if (tempdime.length &gt; 1) {</span>
<span class="nc" id="L951">                        gridDimy.setText(tempdime[1]);</span>
                    } else {
<span class="nc" id="L953">                        gridDimy.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L955" title="All 2 branches missed.">                    if (tempdime.length &gt; 2) {</span>
<span class="nc" id="L956">                        gridDimz.setText(tempdime[2]);</span>
                    } else {
<span class="nc" id="L958">                        gridDimz.setText(&quot;&quot;);</span>
                    }

<span class="nc bnc" id="L961" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;glen &quot;)) {</span>
<span class="nc" id="L962">                String tempglen[] = thedata[i].substring((thedata[i].indexOf(&quot;glen &quot;) + 5), thedata[i].length()).split(&quot; &quot;);</span>
                //if data isnt empty     set the data                  else  set it to blank
<span class="nc bnc" id="L964" title="All 2 branches missed.">                if(loadfocus==0) {</span>
<span class="nc bnc" id="L965" title="All 2 branches missed.">                    if (tempglen.length &gt; 0) {</span>
<span class="nc" id="L966">                        gridLen1a.setText(tempglen[0]);</span>
                    } else {
<span class="nc" id="L968">                        gridLen1a.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L970" title="All 2 branches missed.">                    if (tempglen.length &gt; 1) {</span>
<span class="nc" id="L971">                        gridLen2a.setText(tempglen[1]);</span>
                    } else {
<span class="nc" id="L973">                        gridLen2a.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L975" title="All 2 branches missed.">                    if (tempglen.length &gt; 2) {</span>
<span class="nc" id="L976">                        gridLen3a.setText(tempglen[2]);</span>
                    } else {
<span class="nc" id="L978">                        gridLen3a.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L980" title="All 2 branches missed.">                } else if (loadfocus==1) {</span>
<span class="nc bnc" id="L981" title="All 2 branches missed.">                    if (tempglen.length &gt; 0) {</span>
<span class="nc" id="L982">                        gridLen1b.setText(tempglen[0]);</span>
                    } else {
<span class="nc" id="L984">                        gridLen1b.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L986" title="All 2 branches missed.">                    if (tempglen.length &gt; 1) {</span>
<span class="nc" id="L987">                        gridLen2b.setText(tempglen[1]);</span>
                    } else {
<span class="nc" id="L989">                        gridLen2b.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L991" title="All 2 branches missed.">                    if (tempglen.length &gt; 2) {</span>
<span class="nc" id="L992">                        gridLen3b.setText(tempglen[2]);</span>
                    } else {
<span class="nc" id="L994">                        gridLen3b.setText(&quot;&quot;);</span>
                    }
                }
                else {
<span class="nc bnc" id="L998" title="All 2 branches missed.">                    if (tempglen.length &gt; 0) {</span>
<span class="nc" id="L999">                        gridLen1c.setText(tempglen[0]);</span>
                    } else {
<span class="nc" id="L1001">                        gridLen1c.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1003" title="All 2 branches missed.">                    if (tempglen.length &gt; 1) {</span>
<span class="nc" id="L1004">                        gridLen2c.setText(tempglen[1]);</span>
                    } else {
<span class="nc" id="L1006">                        gridLen2c.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1008" title="All 2 branches missed.">                    if (tempglen.length &gt; 2) {</span>
<span class="nc" id="L1009">                        gridLen3c.setText(tempglen[2]);</span>
                    } else {
<span class="nc" id="L1011">                        gridLen3c.setText(&quot;&quot;);</span>
                    }
                }
<span class="nc bnc" id="L1014" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;ion &quot;)) {</span>
<span class="nc" id="L1015">                String tempion[] = thedata[i].substring((thedata[i].indexOf(&quot;ion &quot;) + 4), thedata[i].length()).split(&quot; &quot;);</span>
<span class="nc bnc" id="L1016" title="All 2 branches missed.">                if (countion1) {</span>
<span class="nc bnc" id="L1017" title="All 2 branches missed.">                    if (tempion.length &gt; 0) {</span>
<span class="nc" id="L1018">                        countIon1Charge.setText(tempion[0]);</span>
                    } else {
<span class="nc" id="L1020">                        countIon1Charge.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1022" title="All 2 branches missed.">                    if (tempion.length &gt; 1) {</span>
<span class="nc" id="L1023">                        countIon1Con.setText(tempion[1]);</span>
                    } else {
<span class="nc" id="L1025">                        countIon1Con.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1027" title="All 2 branches missed.">                    if (tempion.length &gt; 2) {</span>
<span class="nc" id="L1028">                        countIon1Sz.setText(tempion[2]);</span>
                    } else {
<span class="nc" id="L1030">                        countIon1Sz.setText(&quot;&quot;);</span>
                    }
<span class="nc" id="L1032">                    countion1 = false;</span>
                } else {
<span class="nc bnc" id="L1034" title="All 2 branches missed.">                    if (tempion.length &gt; 0) {</span>
<span class="nc" id="L1035">                        countIon2Charge.setText(tempion[0]);</span>
                    } else {
<span class="nc" id="L1037">                        countIon2Charge.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1039" title="All 2 branches missed.">                    if (tempion.length &gt; 1) {</span>
<span class="nc" id="L1040">                        countIon2Con.setText(tempion[1]);</span>
                    } else {
<span class="nc" id="L1042">                        countIon2Con.setText(&quot;&quot;);</span>
                    }
<span class="nc bnc" id="L1044" title="All 2 branches missed.">                    if (tempion.length &gt; 2) {</span>
<span class="nc" id="L1045">                        countIon2Sz.setText(tempion[2]);</span>
                    } else {
<span class="nc" id="L1047">                        countIon2Sz.setText(&quot;&quot;);</span>
                    }
                }
<span class="nc bnc" id="L1050" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;pdie &quot;)) {</span>
<span class="nc" id="L1051">                proteinDi.setText(thedata[i].substring((thedata[i].indexOf(&quot;pdie &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1052" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;sdie &quot;)) {</span>
<span class="nc" id="L1053">                solventDi.setText(thedata[i].substring((thedata[i].indexOf(&quot;sdie &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1054" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;srad &quot;)) {</span>
<span class="nc" id="L1055">                srad.setText(thedata[i].substring((thedata[i].indexOf(&quot;srad &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1056" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;sdens &quot;)) {</span>
<span class="nc" id="L1057">                sdens.setText(thedata[i].substring((thedata[i].indexOf(&quot;sdens &quot;) + 6), thedata[i].length()));</span>
<span class="nc bnc" id="L1058" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;temp &quot;)) {</span>
<span class="nc" id="L1059">                temp.setText(thedata[i].substring((thedata[i].indexOf(&quot;temp &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1060" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;mdie &quot;)) {</span>
<span class="nc" id="L1061">                membraneDi.setText(thedata[i].substring((thedata[i].indexOf(&quot;mdie &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1062" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;zmem &quot;)) {</span>
<span class="nc" id="L1063">                zmem.setText(thedata[i].substring((thedata[i].indexOf(&quot;zmem &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1064" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;lmem &quot;)) {</span>
<span class="nc" id="L1065">                Lmem.setText(thedata[i].substring((thedata[i].indexOf(&quot;lmem &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;memv &quot;)) {</span>
<span class="nc" id="L1067">                potential.setText(thedata[i].substring((thedata[i].indexOf(&quot;memv &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1068" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;idie &quot;)) {</span>
<span class="nc" id="L1069">                idie.setText(thedata[i].substring((thedata[i].indexOf(&quot;idie &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1070" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;geo1 &quot;)) {</span>
<span class="nc" id="L1071">                System.out.println(thedata[i]);</span>
<span class="nc" id="L1072">                geoFactor1.setText(thedata[i].substring((thedata[i].indexOf(&quot;geo1 &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1073" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;geo2 &quot;)) {</span>
<span class="nc" id="L1074">                geoFactor2.setText(thedata[i].substring((thedata[i].indexOf(&quot;geo2 &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;geo3 &quot;)) {</span>
<span class="nc" id="L1076">                geoFactor3.setText(thedata[i].substring((thedata[i].indexOf(&quot;geo3 &quot;) + 5), thedata[i].length()));</span>
<span class="nc bnc" id="L1077" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;gcent &quot;)) {</span>
<span class="nc" id="L1078">                String loadctr = (thedata[i].substring((thedata[i].indexOf(&quot;gcent &quot;) + 6), thedata[i].length()));</span>
<span class="nc bnc" id="L1079" title="All 2 branches missed.">                if (loadctr.equals(&quot;0 0 0&quot;)) {</span>
<span class="nc" id="L1080">                   centerCombo.setSelectedIndex(0);</span>
<span class="nc bnc" id="L1081" title="All 2 branches missed.">                } else if (loadctr.equals(&quot;mol 1&quot;)) {</span>
<span class="nc" id="L1082">                   centerCombo.setSelectedIndex(1);</span>
                }
<span class="nc" id="L1084">            }</span>

<span class="nc bnc" id="L1086" title="All 2 branches missed.">            else if (thedata[i].contains(&quot;lpbe&quot;)) {</span>
<span class="nc" id="L1087">                solMethodCombo.setSelectedIndex(0);</span>
<span class="nc bnc" id="L1088" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;npbe&quot;)) {</span>
<span class="nc" id="L1089">                solMethodCombo.setSelectedIndex(1);</span>
<span class="nc bnc" id="L1090" title="All 2 branches missed.">            } else if (thedata[i].contains(&quot;bcfl &quot;)) {</span>
<span class="nc" id="L1091">                String loadbcfl = thedata[i].substring((thedata[i].indexOf(&quot;bcfl &quot;) + 5), thedata[i].length());</span>
<span class="nc bnc" id="L1092" title="All 2 branches missed.">                if (loadbcfl.equals(&quot;zero&quot;)) {</span>
<span class="nc" id="L1093">                   boundaryCondCombo.setSelectedIndex(0);</span>
<span class="nc bnc" id="L1094" title="All 2 branches missed.">                } else if (loadbcfl.equals(&quot;sdh&quot;)) {</span>
<span class="nc" id="L1095">                   boundaryCondCombo.setSelectedIndex(1);</span>
<span class="nc bnc" id="L1096" title="All 2 branches missed.">                } else if (loadbcfl.equals(&quot;mdh&quot;)) {</span>
<span class="nc" id="L1097">                   boundaryCondCombo.setSelectedIndex(2);</span>
<span class="nc bnc" id="L1098" title="All 2 branches missed.">                } else if (loadbcfl.equals(&quot;focus&quot;)) {</span>
<span class="nc" id="L1099">                   boundaryCondCombo.setSelectedIndex(3);</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">                } else if (loadbcfl.equals(&quot;memv&quot;)) {</span>
<span class="nc" id="L1101">                   boundaryCondCombo.setSelectedIndex(4);</span>
                }

            }
        }
<span class="nc" id="L1106">    }	</span>

    /**
     * Simple method for logging debug output to file.
     * @param msg String to write to file for debug purposes.
     */
    protected void log(String msg) {
        if(true) {
            try {
<span class="nc" id="L1115">                outFile = new PrintWriter(new FileOutputStream(new File(ofile.getPath() + &quot;.log&quot;), true));</span>
<span class="nc" id="L1116">            } catch (Exception e1) {</span>
<span class="nc" id="L1117">                System.out.print(e1.toString());</span>
<span class="nc" id="L1118">            }</span>
<span class="nc" id="L1119">            outFile.println(msg);</span>
<span class="nc" id="L1120">            outFile.close();</span>

        }
<span class="nc" id="L1123">    }</span>

    /**
     * Locate a file from the filesystem via the JFileChooser.
     * @return True if the file was successfully selected, otherwise false.
     */
    private boolean OpenFile() {

<span class="nc" id="L1131">        File currentDir = new File(&quot;.&quot;);</span>
<span class="nc" id="L1132">        final JFileChooser fc = new JFileChooser(currentDir);</span>

<span class="nc" id="L1134">        int returnVal = fc.showOpenDialog(theWindow);</span>

<span class="nc bnc" id="L1136" title="All 2 branches missed.">        if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L1137">            ofile = fc.getSelectedFile();</span>
<span class="nc" id="L1138">            file_loaded = true;	//we now have a familiar file</span>
<span class="nc" id="L1139">            return true;</span>
        } else {
<span class="nc" id="L1141">            return false;</span>
        }
    }

    /**
     * Select a location and name for saving a file.
     * @param savetitle title for the JFileChooser window.
     * @return True if a file path was successfully chosen, otherwise false.
     */
    private boolean SaveDialog(String savetitle) {

<span class="nc" id="L1152">        File currentDir = new File(&quot;.&quot;);</span>
<span class="nc" id="L1153">        final JFileChooser fc = new JFileChooser(currentDir);</span>
<span class="nc" id="L1154">        fc.setDialogTitle(savetitle);</span>

<span class="nc" id="L1156">        int returnVal = fc.showSaveDialog(theWindow);</span>

<span class="nc bnc" id="L1158" title="All 2 branches missed.">        if (returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L1159">            ofile = fc.getSelectedFile();</span>
<span class="nc" id="L1160">            ofile.mkdir();</span>
<span class="nc" id="L1161">            log(ofile.getParent() + &quot;/&quot; + ofile.getName() + &quot;/&quot; + ofile.getName());</span>
<span class="nc" id="L1162">            ofile = new File(ofile.getParent() + &quot;/&quot; + ofile.getName() + &quot;/&quot; + ofile.getName());</span>
<span class="nc" id="L1163">            file_loaded = true;</span>

<span class="nc" id="L1165">            return true;</span>
        } else {
<span class="nc" id="L1167">            return false;</span>
        }
    }

    /**
     * Delete a list of temporary files based on extension.
     * @param directory Path to the directory that contains the files.
     * @param extension File extension of the files that will be deleted.
     */
    private void deleteFiles(String directory, String extension) {
<span class="nc" id="L1177">        ExtensionFilter filter = new ExtensionFilter(extension);</span>
<span class="nc" id="L1178">        File dir = new File(directory);</span>

<span class="nc" id="L1180">        String[] list = dir.list(filter);</span>
        File todelete;
<span class="nc bnc" id="L1182" title="All 2 branches missed.">        if (list.length == 0) return;</span>
<span class="nc" id="L1183">        System.out.println(&quot;Cleaning up current working directory...&quot;);</span>
<span class="nc bnc" id="L1184" title="All 2 branches missed.">        for (int i = 0; i &lt; list.length; i++) {</span>
<span class="nc" id="L1185">          todelete = new File(directory, list[i]);</span>
<span class="nc" id="L1186">          System.out.println(todelete + &quot;  deleted: &quot; + todelete.delete());</span>
        }
<span class="nc" id="L1188">   }</span>

    /**
     * Copy files based on extension
     * @param src Path to source directory.
     * @param dst Path to destination directory.
     * @param extension Extension of files to be copied.
     */
    public void copyFiles(String src, String dst, String extension) {
<span class="nc" id="L1197">        ExtensionFilter filter = new ExtensionFilter(extension);</span>
<span class="nc" id="L1198">        File dir = new File(src);</span>

<span class="nc" id="L1200">        File[] list = dir.listFiles(filter);</span>
<span class="nc bnc" id="L1201" title="All 2 branches missed.">        if (list.length == 0) return;</span>
        try {
<span class="nc bnc" id="L1203" title="All 2 branches missed.">        for (int i = 0; i &lt; list.length; i++) {</span>
<span class="nc" id="L1204">            InputStream in = new FileInputStream(list[i]);</span>
<span class="nc" id="L1205">            OutputStream out = new FileOutputStream(new File(dst + &quot;/&quot; + list[i].getName()));</span>

<span class="nc" id="L1207">            byte[] buf = new byte[1024];</span>
<span class="nc" id="L1208">            int len = 0;</span>

<span class="nc bnc" id="L1210" title="All 2 branches missed.">            while ((len = in.read(buf)) &gt; 0)</span>
            {
<span class="nc" id="L1212">            out.write(buf, 0, len);</span>

            }

<span class="nc" id="L1216">            in.close();</span>
<span class="nc" id="L1217">            out.close();</span>
            
<span class="nc" id="L1219">            System.out.print(list[i].getPath() + &quot; copied to &quot; + dst);</span>
        }
<span class="nc" id="L1221">        } catch (Exception fe) {</span>
<span class="nc" id="L1222">            System.out.println(fe);</span>
<span class="nc" id="L1223">        }</span>

<span class="nc" id="L1225">   }</span>

    private void dependencyCheck() {
<span class="nc" id="L1228">        String dependencyError = &quot;&quot;;</span>

        //First check to make sure the commandline utilities are available
<span class="nc" id="L1231">        File[] requiredFiles = new File[3];</span>
<span class="nc" id="L1232">        String osExt = &quot;&quot;;</span>
        
        //Add the .exe extension when running on windows
<span class="nc bnc" id="L1235" title="All 2 branches missed.">        if(System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>
<span class="nc" id="L1236">            osExt = &quot;.exe&quot;;</span>
        }

<span class="nc" id="L1239">        requiredFiles[0] = new File(&quot;draw_membrane4&quot; + osExt);</span>
<span class="nc" id="L1240">        requiredFiles[1] = new File(&quot;pull_comps&quot; + osExt);</span>
<span class="nc" id="L1241">        requiredFiles[2] = new File(&quot;total_charge_off_2&quot; + osExt);</span>

        //make sure the commandline util files exist
<span class="nc bnc" id="L1244" title="All 2 branches missed.">        for (File i : requiredFiles) {</span>
<span class="nc bnc" id="L1245" title="All 2 branches missed.">            if(!i.exists()) {</span>
<span class="nc" id="L1246">                dependencyError += i.getName() + &quot; was not found in your APBSmem directory.\n&quot;;</span>
            }
        }

        //Now check to make sure APBS is installed and available
        try {
<span class="nc" id="L1252">            ProcessBuilder pb = new ProcessBuilder();</span>
<span class="nc bnc" id="L1253" title="All 2 branches missed.">            if(System.getProperty(&quot;os.name&quot;).startsWith(&quot;Windows&quot;)) {</span>

<span class="nc" id="L1255">            pb = new ProcessBuilder( &quot;apbs.exe&quot;, &quot;--version&quot;);</span>
            }
            else {
<span class="nc" id="L1258">                 pb = new ProcessBuilder( &quot;apbs&quot;, &quot;--version&quot;);</span>
            }

<span class="nc" id="L1261">            Process pp = pb.start();</span>

<span class="nc" id="L1263">            int exitVal = pp.waitFor();</span>

<span class="nc" id="L1265">        } catch (Exception e) {</span>
<span class="nc" id="L1266">            e.printStackTrace();</span>
<span class="nc" id="L1267">            System.out.println(e.getMessage());</span>
<span class="nc" id="L1268">            dependencyError += &quot;Could not run APBS. Make sure it is installed and located on your path.\n&quot;;</span>
<span class="nc" id="L1269">        }</span>

<span class="nc bnc" id="L1271" title="All 2 branches missed.">        if (!dependencyError.equals(&quot;&quot;)) {</span>
<span class="nc" id="L1272">            JOptionPane.showMessageDialog(null, &quot;One or more errors were found during startup:\n&quot; + dependencyError + &quot;\nFor more information please see the APBSmem manual.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);</span>
        }
<span class="nc" id="L1274">    }</span>

   /**
    *
    */
   public class ExtensionFilter implements FilenameFilter {
          private String extension;
          /**
           *
           * @param extension
           */
<span class="nc" id="L1285">          public ExtensionFilter( String extension ) {</span>
<span class="nc" id="L1286">            this.extension = extension;</span>
<span class="nc" id="L1287">          }</span>

          public boolean accept(File dir, String name) {
<span class="nc" id="L1290">            return (name.endsWith(extension));</span>
          }
    }


   /**
    *
    */
   public class SimpleAboutDialog extends JDialog {
       /**
        * A basic dialog for describing details of the software and providing contact information.
        * @param parent The APBSmem main JFrame window.
        */
<span class="nc" id="L1303">       public SimpleAboutDialog(JFrame parent) {</span>
<span class="nc" id="L1304">            super(parent, &quot;About APBSmem&quot;, true);</span>

<span class="nc" id="L1306">            Box b = Box.createVerticalBox();</span>
<span class="nc" id="L1307">            b.add(Box.createGlue());</span>
<span class="nc" id="L1308">            b.add(new JLabel(&quot;APBSmem v&quot; + version));</span>
<span class="nc" id="L1309">            b.add(new JLabel(&quot;Grabe Lab&quot;));</span>
<span class="nc" id="L1310">            b.add(new JLabel(&quot;University of Pittsburgh&quot;));</span>
<span class="nc" id="L1311">            b.add(new JLabel(&quot;http://mgrabe1.bio.pitt.edu/apbsmem/&quot;));</span>
<span class="nc" id="L1312">            b.add(Box.createGlue());</span>
<span class="nc" id="L1313">            getContentPane().add(b, &quot;Center&quot;);</span>

<span class="nc" id="L1315">            JPanel p2 = new JPanel();</span>
<span class="nc" id="L1316">            JButton ok = new JButton(&quot;OK&quot;);</span>
<span class="nc" id="L1317">            p2.add(ok);</span>
<span class="nc" id="L1318">            getContentPane().add(p2, &quot;South&quot;);</span>

<span class="nc" id="L1320">            ok.addActionListener(new ActionListener() {</span>
              public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L1322">                setVisible(false);</span>
<span class="nc" id="L1323">              }</span>
            });

<span class="nc" id="L1326">            setSize(300, 200);</span>

                    
<span class="nc" id="L1329">        }</span>
    }

   public class SimpleHelpDialog extends JDialog {
       /**
        * A basic dialog for describing details of the software and providing contact information.
        * @param parent The APBSmem main JFrame window.
        */
<span class="nc" id="L1337">       public SimpleHelpDialog(JFrame parent) {</span>
<span class="nc" id="L1338">            super(parent, &quot;APBSmem Help&quot;, true);</span>
<span class="nc" id="L1339">            JScrollPane jsp = new JScrollPane();</span>
            try {
<span class="nc" id="L1341">                JEditorPane jep = new JEditorPane(&quot;http://mgrabe1.bio.pitt.edu/apbsmem/&quot;);</span>
<span class="nc" id="L1342">                jep.setEditable(false);</span>
<span class="nc" id="L1343">                jsp.getViewport().add( jep, BorderLayout.CENTER );</span>

            }
<span class="nc" id="L1346">            catch (Exception e) {</span>
<span class="nc" id="L1347">                System.out.println(&quot;couldnt load editorpane&quot;);</span>
<span class="nc" id="L1348">            }</span>

<span class="nc" id="L1350">            JButton ok = new JButton(&quot;OK&quot;);</span>
<span class="nc" id="L1351">            jsp.validate();</span>
<span class="nc" id="L1352">            jsp.add(ok);</span>
<span class="nc" id="L1353">            getContentPane().add(jsp, &quot;South&quot;);</span>

<span class="nc" id="L1355">            ok.addActionListener(new ActionListener() {</span>
              public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L1357">                setVisible(false);</span>
<span class="nc" id="L1358">              }</span>
            });
            

<span class="nc" id="L1362">            setSize(300, 200);</span>


<span class="nc" id="L1365">        }</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>