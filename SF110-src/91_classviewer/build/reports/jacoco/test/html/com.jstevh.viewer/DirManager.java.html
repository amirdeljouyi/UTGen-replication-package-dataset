<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DirManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">91_classviewer</a> &gt; <a href="index.source.html" class="el_package">com.jstevh.viewer</a> &gt; <span class="el_source">DirManager.java</span></div><h1>DirManager.java</h1><pre class="source lang-java linenums">/* 
 * DirManager - program for managing Sax parser
 *
 * Copyright (C) 2004-2007  James Harris 
 *
 * This program is free software; you can redistribute it 
 *
 * and/or modify it under the terms of the GNU General Public
 *
 * License as published by the Free Software Foundation;
 *
 * either version 2 of the License, or (at your option) any 
 *
 * later version.
 *
 *
 * This program is distributed in the hope that it will be 
 *
 * useful, but WITHOUT ANY WARRANTY; without even the implied 
 *
 * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR 
 *
 * PURPOSE. See the GNU General Public License for more details.
 *
 *
 * You should have received a copy of the GNU General Public 
 *
 * License along with this program; if not, write to the Free 
 *
 * Software Foundation, Inc., 59 Temple Place, Suite 330, 
 *
 * Boston, MA 02111-1307 USA
 *
 */


package com.jstevh.viewer;

import javax.xml.parsers.*;
import org.xml.sax.*;
import org.xml.sax.helpers.*;

import java.util.*;
import java.io.*;
import java.net.*;


import com.jstevh.tools.StringList;

/**
* Proof of Concept file for xml, really basic
*
* SAX Parser manager class 
*
* @author   James Harris
* @version  5.0 beta
*/              
public class DirManager
{

    public static String currentDir;
    public static String fileSeparator;

    private SAXDirParser parser;

    private boolean directoryLoaded;
    
    //I need to create an Exceptions class to pass back what happened to ClassInfo and ClassViewer
    //maybe later
    
<span class="nc" id="L71">    public boolean loaded(){ return directoryLoaded;}</span>
    
    private boolean fileNotFoundError;
<span class="nc" id="L74">    public boolean fileNotFoundError(){ return fileNotFoundError;}</span>
    
    private String[] pkgList;
    
    private DirManager(){}
    
<span class="fc" id="L80">    public DirManager(boolean mainrun){</span>
	    
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">	    if  (mainrun) {</span>
		    try{


			try{
<span class="nc" id="L87">				currentDir = System.getProperty(&quot;user.dir&quot;);</span>
<span class="nc" id="L88">				fileSeparator = System.getProperty(&quot;file.separator&quot;);</span>


			}
<span class="nc" id="L92">			catch (java.security.AccessControlException access){</span>
<span class="nc" id="L93">				access.printStackTrace();</span>
<span class="nc" id="L94">				System.out.println(&quot;Should never go in here&quot;);				</span>

<span class="nc" id="L96">			}</span>


<span class="nc" id="L99">			    parser = new SAXDirParser();</span>
			    
<span class="nc bnc" id="L101" title="All 2 branches missed.">			    if (!directoryLoaded){</span>
<span class="nc" id="L102">				    SAXParserFactory saxFactory = SAXParserFactory.newInstance();</span>
<span class="nc" id="L103">				    SAXParser myParser = saxFactory.newSAXParser();</span>
<span class="nc" id="L104">				    XMLReader myReader = myParser.getXMLReader();</span>
<span class="nc" id="L105">				    myReader.setContentHandler(parser);</span>
<span class="nc" id="L106">				    myReader.parse(currentDir+fileSeparator+&quot;packagedirectory.xml&quot;);</span>
<span class="nc" id="L107">				    setPackageList();</span>
<span class="nc" id="L108">				    directoryLoaded=true;</span>
			    }
		    }
<span class="nc" id="L111">		    catch (java.io.FileNotFoundException i){</span>
<span class="nc" id="L112">			    System.out.println(&quot;File Not Found&quot;);</span>
<span class="nc" id="L113">			    System.out.println(&quot;Looking in directory:&quot;+currentDir+fileSeparator);			</span>
<span class="nc" id="L114">			    fileNotFoundError = true;</span>
			    
		    }
<span class="nc" id="L117">		    catch (Exception e){</span>
			    //Will deal with properly later
<span class="nc" id="L119">			    System.out.println(&quot;Exception in Directory Manager on load.&quot;);</span>
<span class="nc" id="L120">			    e.printStackTrace();</span>
<span class="nc" id="L121">		    }</span>
	    }
	    else{
		    
		    try{
			    
<span class="fc" id="L127">			    parser = new SAXDirParser();</span>
			    
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">			    if (!directoryLoaded){</span>
<span class="fc" id="L130">				    SAXParserFactory saxFactory = SAXParserFactory.newInstance();</span>
<span class="fc" id="L131">				    SAXParser myParser = saxFactory.newSAXParser();</span>
				    
<span class="fc" id="L133">				    XMLReader myReader = myParser.getXMLReader();</span>
<span class="fc" id="L134">				    myReader.setContentHandler(parser);</span>
				    
<span class="fc" id="L136">				    InputStream dirStream = this.getClass().getResourceAsStream(&quot;packagedirectory.xml&quot;);</span>
				    
<span class="pc bpc" id="L138" title="1 of 2 branches missed.">				    if (dirStream==null) myReader.parse(new InputSource(new StringReader(defaultXML)));</span>
<span class="nc" id="L139">				    else myReader.parse(new InputSource(dirStream));</span>
				    
<span class="fc" id="L141">				    setPackageList();</span>
<span class="fc" id="L142">				    directoryLoaded=true;</span>
			    }
		    }
<span class="nc" id="L145">		    catch (Exception e){</span>
			    //Will deal with properly later
<span class="nc" id="L147">			    System.out.println(&quot;Exception in Directory Manager on load.&quot;);</span>
<span class="nc" id="L148">			    e.printStackTrace();</span>
<span class="fc" id="L149">		    }</span>
	    }
	    
<span class="fc" id="L152">    }</span>

    public void setPackageList(){

<span class="fc" id="L156">	HashMap tempDirectory = parser.getDirectory();</span>

<span class="fc" id="L158">	int size = tempDirectory.size();</span>

<span class="fc" id="L160">	pkgList = new String[size];</span>

<span class="fc" id="L162">	Set tempSet = tempDirectory.keySet();</span>

<span class="fc" id="L164">	Iterator tempIter = tempSet.iterator();</span>

<span class="fc" id="L166">	int i=0;</span>

<span class="fc bfc" id="L168" title="All 2 branches covered.">	while (tempIter.hasNext()){</span>

<span class="fc" id="L170">	  pkgList[i] = (String)tempIter.next()+&quot;.&quot;;</span>

<span class="fc" id="L172">	  i++;</span>
	}	

<span class="fc" id="L175">	return; </span>
    }

    public HashMap getDirectory(){

<span class="nc" id="L180">	return parser.getDirectory();</span>
    }

    public String[] getPackageList(){

<span class="fc" id="L185">	return pkgList.clone();</span>
    }


    public StringList getLocalPackages(){

<span class="nc" id="L191">	return parser.getLocalPackages();</span>
    }

    public String getLocalBrowser(){

<span class="nc" id="L196">	return parser.getLocalBrowser();</span>
    }


    public String getEditor(){

<span class="nc" id="L202">	return parser.getEditor();</span>
    }


    public boolean acceptsLineNumber(){

<span class="nc" id="L208">	return parser.acceptsLineNumber();</span>
    }

    public String lineNumberParameter(){

<span class="nc" id="L213">	return parser.lineNumberParameter();</span>
    }


    public static void main(String[] args) throws Exception{

<span class="nc" id="L219">	DirManager test = new DirManager();</span>

<span class="nc" id="L221">	System.out.println(test.pkgList[2]);</span>
<span class="nc" id="L222">	System.out.println(test.getLocalBrowser());</span>
	

<span class="nc" id="L225">    }</span>

<span class="fc" id="L227">    public static String defaultXML=&quot;&lt;?xml version='1.0' encoding='ISO-8859-1' standalone='yes'?&gt;&quot;+</span>
&quot;&lt;Base&gt;&lt;Documentation&gt;&lt;Group&gt;&lt;Description&gt;Java SDK 6.0&lt;/Description&gt;&lt;Owner&gt;Sun Microsystems&lt;/Owner&gt;&quot;+
&quot;&lt;Location&gt;&lt;Web&gt;http://java.sun.com/javase/6/docs/api/&lt;/Web&gt;&lt;Local&gt;&lt;/Local&gt;&lt;/Location&gt;&quot;+
&quot;&lt;Names&gt;&lt;pkg&gt;java.lang.&lt;/pkg&gt;&lt;pkg&gt;java.io.&lt;/pkg&gt;&lt;pkg&gt;java.lang.reflect.&lt;/pkg&gt;&lt;pkg&gt;java.util.&lt;/pkg&gt;&quot;+
&quot;&lt;pkg&gt;java.awt.event.&lt;/pkg&gt;&lt;pkg&gt;java.awt.datatransfer.&lt;/pkg&gt;&lt;pkg&gt;java.awt.&lt;/pkg&gt;&lt;pkg&gt;java.net.&lt;/pkg&gt;&quot;+
&quot;&lt;pkg&gt;java.applet.&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;/Names&gt;&lt;/Group&gt;&lt;Group&gt;&quot;+
&quot;&lt;Description&gt;Java Enterprise&lt;/Description&gt;&lt;Owner&gt;Sun Microsystems&lt;/Owner&gt;&lt;Location&gt;&quot;+
&quot;&lt;Web&gt;http://java.sun.com/j2se/1.4.2/docs/api/&lt;/Web&gt;&lt;/Location&gt;&lt;Names&gt;&lt;pkg&gt;javax.swing.border.&lt;/pkg&gt;&quot;+
&quot;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;pkg&gt;&lt;/pkg&gt;&lt;/Names&gt;&lt;/Group&gt;&lt;/Documentation&gt;&lt;/Base&gt;&quot;;


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>