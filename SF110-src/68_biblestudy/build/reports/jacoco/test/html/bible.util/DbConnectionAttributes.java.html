<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DbConnectionAttributes.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">68_biblestudy</a> &gt; <a href="index.source.html" class="el_package">bible.util</a> &gt; <span class="el_source">DbConnectionAttributes.java</span></div><h1>DbConnectionAttributes.java</h1><pre class="source lang-java linenums">package bible.util;

import java.sql.*;
import java.util.Date;

public class DbConnectionAttributes {
    private static final int INUSE = 1;
    private static final int FREE = 2;
    private static final int NOTUSED = 3;

<span class="fc" id="L11">    protected DbConnectionAttributes(int index) {</span>
<span class="fc" id="L12">        this.index = index;</span>
<span class="fc" id="L13">        status = FREE;</span>
<span class="fc" id="L14">    }</span>

    protected void connect(Connection connection) throws SQLException {
<span class="nc" id="L17">        this.connection = connection;</span>
<span class="nc bnc" id="L18" title="All 2 branches missed.">        if(connection == null) {</span>
<span class="nc" id="L19">            (new NullPointerException(&quot;connection - &quot; + toString())).printStackTrace();</span>
        }
<span class="nc" id="L21">        this.statement = connection.createStatement();</span>
<span class="nc" id="L22">        this.status = FREE;</span>
<span class="nc" id="L23">    }</span>

    protected void close() throws SQLException {
<span class="nc bnc" id="L26" title="All 2 branches missed.">        if(statement != null) {</span>
<span class="nc" id="L27">            statement.close();</span>
<span class="nc" id="L28">            statement = null;</span>
        }
<span class="nc bnc" id="L30" title="All 2 branches missed.">        if(connection != null) {</span>
<span class="nc" id="L31">            connection.close();</span>
<span class="nc" id="L32">            connection = null;</span>
        }
<span class="nc" id="L34">    }</span>

    protected void release() {
<span class="fc" id="L37">        status = NOTUSED;</span>
<span class="fc" id="L38">        creationTime = -1;</span>
<span class="fc" id="L39">    }</span>

    protected void free() {
<span class="nc" id="L42">        status = FREE;</span>
<span class="nc" id="L43">    }</span>

    /**
     * Used to drop a connection whe it is in use.
     * @see ConnectionBroker#disconnectAll
     * @author James Stauffer
     */
    protected void drop() {
<span class="nc" id="L51">        index = -1;</span>
<span class="nc" id="L52">    }</span>

    protected void use(int index) {
<span class="nc" id="L55">        creationTime = System.currentTimeMillis();;</span>
<span class="nc" id="L56">        status = INUSE;</span>
<span class="nc" id="L57">        this.index = index;</span>
<span class="nc" id="L58">    }</span>

    protected void init(String query) {
<span class="nc" id="L61">        this.query = query;</span>
<span class="nc" id="L62">        this.e = new Exception();</span>
<span class="nc" id="L63">    }</span>

    protected void reset() {
<span class="nc" id="L66">        this.query = &quot;&quot;;</span>
<span class="nc" id="L67">        this.e = null;</span>
<span class="nc" id="L68">    }</span>

    /**
     * Should only be used by the maintanence SQL queries in DatabaseManager
     * @see DatabaseManager#executeInsert
     * @author James Stauffer
     */
    protected ResultSet executeQuery(String identityQuery) throws SQLException {
<span class="nc" id="L76">        return statement.executeQuery(identityQuery);</span>
    }

    /**
     * Should only be used by the maintanence SQL queries in DatabaseManager
     * @see DatabaseManager#getInsertID
     * @author James Stauffer
     */
    protected void executeUpdate(String identityUpdate) throws SQLException {
<span class="nc" id="L85">        statement.executeUpdate(identityUpdate);</span>
<span class="nc" id="L86">    }</span>

    protected ResultSet executeQuery() throws SQLException {
<span class="nc" id="L89">        return statement.executeQuery(query);</span>
    }

    protected int executeUpdate() throws SQLException {
<span class="nc" id="L93">        return statement.executeUpdate(query);</span>
    }

    protected PreparedStatement prepareStatement() throws SQLException {
<span class="nc" id="L97">        return connection.prepareStatement(query);</span>
    }

    protected int getIndex() {
<span class="nc" id="L101">        return index;</span>
    }

    protected long getCreationTime() {
<span class="nc" id="L105">        return creationTime;</span>
    }

    public String getCreationDate() {
<span class="nc" id="L109">        return (new Date(creationTime)).toString();</span>
    }

    public String getConnection() {
<span class="nc" id="L113">        return &quot;&quot; + connection;</span>
    }

    public String getStatement() {
<span class="nc" id="L117">        return &quot;&quot; + statement;</span>
    }

    public String getException() {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if(e == null) {</span>
<span class="nc" id="L122">            return null;</span>
        } else {
<span class="nc" id="L124">            return Util.ToString(e);</span>
        }
    }

    public String getQuery() {
<span class="nc" id="L129">        return query;</span>
    }

    public boolean isFree() {
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">        return status == FREE;</span>
    }

    public boolean isInUse() {
<span class="nc bnc" id="L137" title="All 2 branches missed.">        return status == INUSE;</span>
    }

    public boolean isNotUsed() {
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">        return status == NOTUSED;</span>
    }
    protected boolean isClosed() throws SQLException {
<span class="nc bnc" id="L144" title="All 4 branches missed.">        return (connection == null) || connection.isClosed();</span>
    }

    /**
     * @author James Stauffer
     */
    public String toString() {
<span class="nc" id="L151">        return getClass().getName() + &quot;:[index=&quot; + index</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">            + &quot;, status=&quot; + getStatusString()</span>
            + &quot;, query=&quot; + ((query != null) ? &quot;\&quot;&quot; + query + &quot;\&quot;&quot; : query)
            + &quot;, creationDate=&quot; + new Date(creationTime)
<span class="nc" id="L155">            + &quot;, e=&quot; + Util.ToString(e)</span>
            + &quot;]&quot;;
    }

    /**
     * @author James Stauffer
     */
    public String toShortString() {
<span class="nc bnc" id="L163" title="All 2 branches missed.">        return getClass().getName() + &quot;:[&quot; + index</span>
            + &quot; &quot; + ((query != null) ? query : &quot;&quot;)
            + &quot;]&quot;;
    }

    /**
     * @author James Stauffer
     */
    public String toLogString() {
<span class="nc" id="L172">        return index + &quot; &quot; + status + &quot;  &quot; + Logger.FormatDate(creationTime) + &quot;\t&quot; + query;</span>
    }

    /**
     * @author James Stauffer
     */
    public String getStatusString() {
<span class="nc bnc" id="L179" title="All 4 branches missed.">        switch(status) {</span>
<span class="nc" id="L180">            case INUSE:    return &quot;InUse (Connected)&quot;;</span>
<span class="nc" id="L181">            case FREE:     return &quot;Free (Connected-Not Used)&quot;;</span>
<span class="nc" id="L182">            case NOTUSED:  return &quot;NotUsed (Not Connected)&quot;;</span>
<span class="nc" id="L183">            default:       return &quot;NOT KNOWN&quot;;</span>
        }

    }

    private int status;
    private Connection connection;
    private Statement statement;
    private int index;
<span class="fc" id="L192">    private long creationTime = -1;</span>
<span class="fc" id="L193">    private String query = null;</span>
<span class="fc" id="L194">    private Exception e = null;</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>