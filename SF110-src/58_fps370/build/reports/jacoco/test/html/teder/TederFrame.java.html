<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TederFrame.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">58_fps370</a> &gt; <a href="index.source.html" class="el_package">teder</a> &gt; <span class="el_source">TederFrame.java</span></div><h1>TederFrame.java</h1><pre class="source lang-java linenums">package teder;

/*
 * TederFrame - Game tile editor frame
 *
 * By: Wood Harter - Feb 22, 2006
 * Created for cpsc370 at Chapman University
 * http://www.gamedev370.com
 * (c) copyright 2006 - W. Wood Harter
 *
 * Licensed under GNU General Public License
 * http://www.gnu.org
 *
 *
 */

import java.awt.*;
import java.awt.event.*;
import java.io.*;
import javax.swing.*;
import javax.swing.filechooser.*;

public class TederFrame extends JFrame implements ActionListener,WindowListener
{
  public static final int DEFAULT_WIDTH  = 800;
  public static final int DEFAULT_HEIGHT = 600;
  
  public TederData ttd;
  public TederPanel ttp;
  
  // swing componenet for the menu bar
  public JMenuBar mbar;
  public JMenu fileMenu;
  public JMenuItem openMenuItem;
  public JMenuItem saveMenuItem;
  public JMenuItem saveAsMenuItem;
  public JMenuItem exitMenuItem;
  
  public JMenu mapMenu;
  public JMenuItem resizeMenuItem;
  
  public JMenu tileMenu;
  public JCheckBoxMenuItem tileItems[];
  
  public JScrollPane spMain;
  
  // the path to the last file operation
  public String lastPath;
  
  public TederFrame()
<span class="nc" id="L51">  {</span>
    // get the program startup location
<span class="nc" id="L53">    lastPath = System.getProperty(&quot;user.dir&quot;);</span>
    
<span class="nc" id="L55">    ttd = new TederData(30,30,64,64,&quot;images/tiles.gif&quot;,this);</span>
<span class="nc" id="L56">    ttp = new TederPanel(ttd);</span>
    
<span class="nc" id="L58">    createMenuBar();</span>
    
    //this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
<span class="nc" id="L61">    this.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L62">    addWindowListener(this);</span>
<span class="nc" id="L63">    setSize(DEFAULT_WIDTH,DEFAULT_HEIGHT);</span>
    
    //spMain = new JScrollPane(ttp,JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,
    //                             JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<span class="nc" id="L67">    spMain = new JScrollPane(ttp);</span>
<span class="nc" id="L68">    spMain.setPreferredSize(new Dimension(200,200));</span>
    
    
    // add the panel to this frame
    //add(ttp);
<span class="nc" id="L73">    add(spMain);</span>
<span class="nc" id="L74">  }</span>
  
  /*------------------- WindowListener ---------------------*/
  public void windowActivated(WindowEvent e)
  {
    
<span class="nc" id="L80">  }</span>
  public void windowClosed(WindowEvent e)
  {
<span class="nc" id="L83">    System.exit(0);</span>
<span class="nc" id="L84">  }</span>
  public void windowClosing(WindowEvent e)
  {
<span class="nc bnc" id="L87" title="All 2 branches missed.">    if (okayToClose())</span>
    {
<span class="nc" id="L89">      System.exit(0);</span>
    }
<span class="nc" id="L91">  }</span>
  public void windowDeactivated(WindowEvent e)
  {
    
<span class="nc" id="L95">  }</span>
  public void windowDeiconified(WindowEvent e)
  {
    
<span class="nc" id="L99">  }</span>
  public void windowIconified(WindowEvent e)
  {
    
<span class="nc" id="L103">  }</span>
  public void windowOpened(WindowEvent e)
  {
    
<span class="nc" id="L107">  }</span>
  /*------------------- WindowListener ---------------------*/
  
  public boolean okayToClose()
  {
<span class="nc bnc" id="L112" title="All 2 branches missed.">    if (ttd.getHasChanged())</span>
    {
      // need to pop up a dialog to see if it is okay to close
      //Custom button text
<span class="nc" id="L116">      Object[] options = {&quot;Yes&quot;,</span>
      &quot;No&quot;,
      &quot;Cancel&quot;};
<span class="nc" id="L119">      int n = JOptionPane.showOptionDialog(this,</span>
                &quot;The map has changed would you like to save the file before proceeding?&quot;,
                &quot;File Has Changed&quot;,
                JOptionPane.YES_NO_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null,
                options,
                options[2]);
<span class="nc bnc" id="L127" title="All 2 branches missed.">      if (n==0)</span>
      {
<span class="nc" id="L129">        return doSaveFile();</span>
      }
<span class="nc bnc" id="L131" title="All 2 branches missed.">      else  if ( n==2)</span>
      {
<span class="nc" id="L133">        return false;</span>
      }
    }
<span class="nc" id="L136">    return true;</span>
  }
  public void createMenuBar()
  {
    JMenuItem itmTmp;
    
<span class="nc" id="L142">    mbar =  new JMenuBar();</span>
    
    /*     FILE MENU     */
<span class="nc" id="L145">    fileMenu = new JMenu(&quot;File&quot;);</span>
    
    // new is one way to do it where we check for the string in the listener
<span class="nc" id="L148">    itmTmp = new JMenuItem(&quot;New&quot;);  // create the item</span>
<span class="nc" id="L149">    itmTmp.addActionListener(this); // add the event listener</span>
<span class="nc" id="L150">    fileMenu.add(itmTmp);           // add the item to the menu</span>
    
    // the other way to do it is to save references to each item.
    // this is better since you do less string processing, but it
    // takes more memory. Always a trade off.
<span class="nc" id="L155">    openMenuItem = new JMenuItem(&quot;Open...&quot;);</span>
<span class="nc" id="L156">    openMenuItem.addActionListener(this);</span>
<span class="nc" id="L157">    fileMenu.add(openMenuItem);</span>
<span class="nc" id="L158">    saveMenuItem = new JMenuItem(&quot;Save&quot;);</span>
<span class="nc" id="L159">    saveMenuItem.addActionListener(this);</span>
<span class="nc" id="L160">    fileMenu.add(saveMenuItem);</span>
<span class="nc" id="L161">    saveAsMenuItem = new JMenuItem(&quot;Save As...&quot;);</span>
<span class="nc" id="L162">    saveAsMenuItem.addActionListener(this);</span>
<span class="nc" id="L163">    fileMenu.add(saveAsMenuItem);</span>
    
    // the last way is not demonstrated, that is a special object
    // just for the individual item event handling. All the books show
    // it as the correct way to handle events. It is the most
    // memory/disk intensive. Not shown here.
    
    // exit is the other way, we keep the object reference and check for that
<span class="nc" id="L171">    exitMenuItem = new JMenuItem(&quot;Exit&quot;);</span>
<span class="nc" id="L172">    exitMenuItem.addActionListener(this);</span>
<span class="nc" id="L173">    fileMenu.add(exitMenuItem);</span>
    
<span class="nc" id="L175">    mbar.add(fileMenu);</span>
    
    /*     EDIT MENU     */
    
    /*     MAP MENU */
<span class="nc" id="L180">    mapMenu = new JMenu(&quot;Map&quot;);</span>
<span class="nc" id="L181">    resizeMenuItem = new JMenuItem(&quot;Resize&quot;);</span>
<span class="nc" id="L182">    resizeMenuItem.addActionListener(this);</span>
<span class="nc" id="L183">    mapMenu.add(resizeMenuItem);</span>
    
<span class="nc" id="L185">    mbar.add(mapMenu);</span>

    /*     TILES MENU    */
<span class="nc" id="L188">    tileMenu = new JMenu(&quot;Tile&quot;);</span>
<span class="nc" id="L189">    tileItems = new JCheckBoxMenuItem[TederData.NUM_TILES];</span>
    int i;
<span class="nc bnc" id="L191" title="All 2 branches missed.">    for (i=0;i&lt;TederData.NUM_TILES;i++)</span>
    {
<span class="nc" id="L193">      tileItems[i] = new JCheckBoxMenuItem(&quot;Tile &quot;+i,new ImageIcon(&quot;images/tile_icons/tile&quot;+i+&quot;.gif&quot;));</span>
<span class="nc" id="L194">      tileItems[i].addActionListener(this);</span>
<span class="nc" id="L195">      tileMenu.add(tileItems[i]);</span>
    }
<span class="nc" id="L197">    mbar.add(tileMenu);</span>
    
    
    //mbar.addActionListener(this);
<span class="nc" id="L201">    adjustMenus();</span>
<span class="nc" id="L202">    this.setJMenuBar(mbar);</span>
<span class="nc" id="L203">  }</span>
  
  
  // action listener handling
  public void actionPerformed(ActionEvent evt)
  {
    //System.out.println(&quot;evt=&quot;+evt);
<span class="nc bnc" id="L210" title="All 2 branches missed.">    if (evt.getActionCommand().equals(&quot;New&quot;))</span>
    {
<span class="nc" id="L212">      System.out.println(&quot;New command selected&quot;);</span>
    }
<span class="nc bnc" id="L214" title="All 2 branches missed.">    else if (evt.getSource()==exitMenuItem)</span>
    {
<span class="nc" id="L216">      System.out.println(&quot;Exit selected&quot;);</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">      if (okayToClose())</span>
<span class="nc" id="L218">        System.exit(0);</span>
    }
<span class="nc bnc" id="L220" title="All 2 branches missed.">    else if (evt.getSource()==saveMenuItem)</span>
    {
<span class="nc" id="L222">      this.doSaveFile();</span>
<span class="nc" id="L223">      ttd.doSave();</span>
    }
<span class="nc bnc" id="L225" title="All 2 branches missed.">    else if (evt.getSource()==saveAsMenuItem)</span>
    {
<span class="nc" id="L227">      this.doSaveAsFile();</span>
    }
<span class="nc bnc" id="L229" title="All 2 branches missed.">    else if (evt.getSource()==openMenuItem)</span>
    {
<span class="nc" id="L231">      doLoadFile();</span>
<span class="nc" id="L232">      ttp.resetPreferredSize();</span>
<span class="nc" id="L233">      this.repaint();</span>
    }
<span class="nc bnc" id="L235" title="All 2 branches missed.">    else if (evt.getSource()==resizeMenuItem)</span>
    {
<span class="nc" id="L237">      doMapSizeDialog();</span>
<span class="nc" id="L238">      this.repaint();</span>
    }
    else
    {
      // may be one of the tiles
      int i;
<span class="nc bnc" id="L244" title="All 2 branches missed.">      for (i=0;i&lt;TederData.NUM_TILES;i++)</span>
      {
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (evt.getSource()==tileItems[i])</span>
        {
<span class="nc" id="L248">          ttp.curTile = i;</span>
        }
      }
<span class="nc" id="L251">      adjustMenus();</span>
    }
<span class="nc" id="L253">  }</span>
  
  public void adjustMenus()
  {
    int i;
<span class="nc bnc" id="L258" title="All 2 branches missed.">    for (i=0;i&lt;TederData.NUM_TILES;i++)</span>
    {
<span class="nc bnc" id="L260" title="All 2 branches missed.">      if (i==ttp.curTile)</span>
<span class="nc" id="L261">        tileItems[i].setState(true);</span>
      else
<span class="nc" id="L263">        tileItems[i].setState(false);</span>
      
    }
<span class="nc" id="L266">  }</span>
  
  public void doLoadFile()
  {
    JFileChooser chooser;
    
<span class="nc bnc" id="L272" title="All 2 branches missed.">    if (!okayToClose())</span>
<span class="nc" id="L273">      return;</span>
    
<span class="nc bnc" id="L275" title="All 2 branches missed.">    if (lastPath==null)</span>
    {
<span class="nc" id="L277">      chooser = new JFileChooser();</span>
    }
    else
    {
<span class="nc" id="L281">      File fiTmp = new File(lastPath);</span>
<span class="nc" id="L282">      chooser = new JFileChooser(fiTmp);</span>
    }
    //chooser.setDialogType(JFileChooser.OPEN_DIALOG);
<span class="nc" id="L285">    MapFileFilter filter = new MapFileFilter();</span>
<span class="nc" id="L286">    chooser.setFileFilter(filter);</span>
<span class="nc" id="L287">    int returnVal = chooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">    if(returnVal == JFileChooser.APPROVE_OPTION)</span>
    {
<span class="nc" id="L290">      File fiSelected = chooser.getSelectedFile();</span>
<span class="nc" id="L291">      lastPath = fiSelected.getPath();</span>
<span class="nc" id="L292">      ttd.setFileName(fiSelected.getAbsolutePath());</span>
<span class="nc" id="L293">      ttd.doLoad();</span>
<span class="nc" id="L294">      ttd.setHasChanged(false);</span>
    }
<span class="nc" id="L296">  }</span>
  
  public boolean doSaveAsFile()
  {
    JFileChooser chooser;
<span class="nc bnc" id="L301" title="All 2 branches missed.">    if (lastPath==null)</span>
    {
<span class="nc" id="L303">      chooser = new JFileChooser();</span>
    }
    else
    {
<span class="nc" id="L307">      File fiTmp = new File(lastPath);</span>
<span class="nc" id="L308">      chooser = new JFileChooser(fiTmp);</span>
    }
    //chooser.setDialogType(JFileChooser.SAVE_DIALOG);
    //System.out.println(&quot;Save file type = SAVE_DIALOG&quot;);
<span class="nc" id="L312">    MapFileFilter filter = new MapFileFilter();</span>
<span class="nc" id="L313">    chooser.setFileFilter(filter);</span>
<span class="nc" id="L314">    int returnVal = chooser.showSaveDialog(this);</span>
    
<span class="nc bnc" id="L316" title="All 2 branches missed.">    if(returnVal == JFileChooser.APPROVE_OPTION)</span>
    {
<span class="nc" id="L318">      File fiSelected = chooser.getSelectedFile();</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">      if (fiSelected.exists())</span>
      {
        // make sure they want to overwrite
        // need to pop up a dialog to see if it is okay to close
        //Custom button text
<span class="nc" id="L324">        Object[] options = {&quot;Yes&quot;,</span>
        &quot;No&quot;};
<span class="nc" id="L326">        int n = JOptionPane.showOptionDialog(this,</span>
                  &quot;The file already exists, would you like to overwrite?&quot;,
                  &quot;File Exists&quot;,
                  JOptionPane.YES_NO_OPTION,
                  JOptionPane.QUESTION_MESSAGE,
                  null,
                  options,
                  options[1]);
<span class="nc bnc" id="L334" title="All 2 branches missed.">        if ( n==1)</span>
        {
<span class="nc" id="L336">          return false;</span>
        }
      } // exists
<span class="nc" id="L339">      lastPath = fiSelected.getPath();</span>
<span class="nc" id="L340">      ttd.setFileName(fiSelected.getAbsolutePath());</span>
<span class="nc" id="L341">      ttd.doSave();</span>
<span class="nc" id="L342">      ttd.setHasChanged(false);</span>
<span class="nc" id="L343">      return true;</span>
    }
    // user pressed cancel, return false that it did not save
<span class="nc" id="L346">    return false;</span>
  }
  public boolean doSaveFile()
  {
<span class="nc bnc" id="L350" title="All 2 branches missed.">    if (ttd.isValidFile())</span>
    {
<span class="nc" id="L352">      ttd.doSave();</span>
    }
    else
    {
<span class="nc" id="L356">      return doSaveAsFile();</span>
    }
<span class="nc" id="L358">    return true;</span>
  }
  
  public void setMapSize(int w, int h)
  {
<span class="nc" id="L363">    ttd.resize(w,h);</span>
<span class="nc" id="L364">    ttp.resetPreferredSize();</span>
<span class="nc" id="L365">  }</span>
  public void doMapSizeDialog()
    {
<span class="nc" id="L368">      MapSizeDialog msp = new MapSizeDialog(this,ttd.getWidth(),ttd.getHeight());</span>
<span class="nc" id="L369">      msp.setVisible(true);</span>
      /*
      JDialog dialog = new JDialog(this,
                                    &quot;Click a button&quot;,
                                    true);      
      dialog.setContentPane(msp);


      dialog.setDefaultCloseOperation(JDialog.DO_NOTHING_ON_CLOSE);
      dialog.pack();
      dialog.setLocationRelativeTo(this);
      dialog.setVisible(true);
       */
<span class="nc" id="L382">    }</span>
  
  class MapFileFilter extends javax.swing.filechooser.FileFilter
  {
    public MapFileFilter()
<span class="nc" id="L387">    {</span>
<span class="nc" id="L388">      super();</span>
<span class="nc" id="L389">    }</span>
    public boolean accept(File f)
    {
<span class="nc bnc" id="L392" title="All 4 branches missed.">      if ((f.getName().endsWith(&quot;.dat&quot;)) || (f.isDirectory()))</span>
      {
<span class="nc" id="L394">        return true;</span>
      }
<span class="nc" id="L396">      return false;</span>
    }
    public String getDescription()
    {
<span class="nc" id="L400">      return &quot;Map .dat files&quot;;</span>
    }
  }
 
  
  class MapSizeDialog extends JDialog
  {
   
    TederFrame parent;
    JButton okButton;
    JButton cancelButton;
    JTextField jtfWidth;
    JTextField jtfHeight;
    
    public MapSizeDialog(TederFrame parentInit, int wid, int hei)
<span class="nc" id="L415">    {</span>
<span class="nc" id="L416">      super(parentInit,true);  // create this as a modal dialog</span>
      
<span class="nc" id="L418">      parent = parentInit;</span>
      
      // create all the elements for the pane
<span class="nc" id="L421">      JPanel inputPane = new JPanel();</span>
<span class="nc" id="L422">      inputPane.setLayout(new GridLayout(0,2));</span>
      
<span class="nc" id="L424">      inputPane.add(new JLabel(&quot;Width:&quot;));</span>
<span class="nc" id="L425">      jtfWidth = new JTextField(&quot;&quot;+wid);</span>
<span class="nc" id="L426">      inputPane.add(jtfWidth);</span>
<span class="nc" id="L427">      inputPane.add(new JLabel(&quot;Height&quot;));</span>
<span class="nc" id="L428">      jtfHeight = new JTextField(&quot;&quot;+hei);</span>
<span class="nc" id="L429">      inputPane.add(jtfHeight);</span>
<span class="nc" id="L430">      inputPane.setBorder(BorderFactory.createEmptyBorder(10,10,10,10));</span>
      
<span class="nc" id="L432">      JPanel buttonPane = new JPanel();</span>
<span class="nc" id="L433">      buttonPane.setLayout(new BoxLayout(buttonPane, BoxLayout.LINE_AXIS));</span>
<span class="nc" id="L434">      buttonPane.setBorder(BorderFactory.createEmptyBorder(0, 10, 10, 10));</span>

<span class="nc" id="L436">      buttonPane.add(Box.createHorizontalGlue());</span>
<span class="nc" id="L437">      cancelButton = new JButton(&quot;Cancel&quot;);</span>
<span class="nc" id="L438">      cancelButton .addActionListener(new ActionListener() </span>
<span class="nc" id="L439">            {</span>
              public void actionPerformed(ActionEvent e)
              {
                //pick one of many
<span class="nc bnc" id="L443" title="All 2 branches missed.">                if (e.getSource()==cancelButton)</span>
                {
<span class="nc" id="L445">                  setVisible(false);</span>
<span class="nc" id="L446">                  dispose();</span>
                }
                  
<span class="nc" id="L449">              }   </span>
            });      
<span class="nc" id="L451">      buttonPane.add(cancelButton);</span>
       
<span class="nc" id="L453">      buttonPane.add(Box.createRigidArea(new Dimension(10, 0)));</span>
<span class="nc" id="L454">      okButton = new JButton(&quot;Ok&quot;);</span>
<span class="nc" id="L455">      okButton.addActionListener(new ActionListener() </span>
<span class="nc" id="L456">            {</span>
              public void actionPerformed(ActionEvent e)
              {
                //pick one of many
<span class="nc bnc" id="L460" title="All 2 branches missed.">                if (e.getSource()==okButton)</span>
                {
                  try
                  {
<span class="nc" id="L464">                    int wid = Integer.parseInt(jtfWidth.getText());</span>
<span class="nc" id="L465">                    int hei = Integer.parseInt(jtfHeight.getText());</span>
<span class="nc" id="L466">                    parent.setMapSize(wid,hei);</span>
                  }
<span class="nc" id="L468">                  catch (NumberFormatException ex)</span>
                  {
<span class="nc" id="L470">                    ex.printStackTrace();</span>
<span class="nc" id="L471">                  }</span>
                  
<span class="nc" id="L473">                  setVisible(false);</span>
<span class="nc" id="L474">                  dispose();</span>
                }
                  
<span class="nc" id="L477">              }   </span>
            });
<span class="nc" id="L479">      buttonPane.add(okButton); </span>

<span class="nc" id="L481">      Container contentPane = getContentPane();</span>
<span class="nc" id="L482">      contentPane.add(inputPane, BorderLayout.CENTER);</span>
<span class="nc" id="L483">      contentPane.add(buttonPane, BorderLayout.PAGE_END);</span>
<span class="nc" id="L484">      this.pack();</span>
<span class="nc" id="L485">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>