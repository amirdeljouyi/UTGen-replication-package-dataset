<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TederPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">58_fps370</a> &gt; <a href="index.source.html" class="el_package">teder</a> &gt; <span class="el_source">TederPanel.java</span></div><h1>TederPanel.java</h1><pre class="source lang-java linenums">package teder;

/*
 * TederPanel - Game tile editor panel
 *                This is the MVC view
 *
 * By: Wood Harter - Feb 22, 2006
 * Created for cpsc370 at Chapman University
 * http://www.gamedev370.com
 * (c) copyright 2006 - W. Wood Harter
 *
 * Licensed under GNU General Public License
 * http://www.gnu.org
 *
 *
 */
import java.awt.*;
import java.awt.event.*;
import java.util.*;
import javax.swing.*;

public class TederPanel extends JPanel implements MouseListener,Scrollable

  {
  // x and y offsets in screen space
  int offx;
  int offy;

  // the model information
  TederData ttd;

  // the default layer
  TederLayer ttlDef;

<span class="nc" id="L35">  public int curTile=0;</span>

  public TederPanel(TederData ttdInit)
<span class="nc" id="L38">    {</span>
<span class="nc" id="L39">    ttd = ttdInit;</span>

    // default testing
<span class="nc" id="L42">    ttlDef = ttd.addLayer();</span>
    int idx;
<span class="nc bnc" id="L44" title="All 2 branches missed.">    for (idx=0;idx&lt;9;idx++)</span>
      {
<span class="nc" id="L46">      ttlDef.setTileNum(idx,idx);</span>
      }
    // set a diagnol
    int i;
<span class="nc" id="L50">    idx = ttd.getWidth()+1;</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">    for (i=0;i&lt;9;i++)</span>
      {
<span class="nc" id="L53">      ttlDef.setTileNum(idx,i);</span>
<span class="nc" id="L54">      idx = idx + ttd.getWidth()+1;</span>
      }

<span class="nc" id="L57">    ttd.hwalls[5] = 1;</span>
<span class="nc" id="L58">    ttd.hwalls[70] = 1;</span>
<span class="nc" id="L59">    ttd.setHasChanged(false);</span>

<span class="nc" id="L61">    addMouseListener(this);</span>
    
<span class="nc" id="L63">    resetPreferredSize();</span>

<span class="nc" id="L65">    }</span>
  public void resetPreferredSize()
  {
<span class="nc" id="L68">    setPreferredSize(new Dimension(ttd.getMapPixelWidth()+ttd.getTileWidth()*2,</span>
<span class="nc" id="L69">              ttd.getMapPixelHeight()+ttd.getTileHeight()*2));</span>
<span class="nc" id="L70">    revalidate();</span>
<span class="nc" id="L71">  }</span>
  /* ------ Scrollable ------ */
 
  public Dimension getPreferredScrollableViewportSize()  
    {
<span class="nc" id="L76">    Dimension dim = new Dimension(800,600);</span>
<span class="nc" id="L77">    return dim;</span>
    }
 
  public int getScrollableBlockIncrement(Rectangle visibleRect, int orientation, int direction)
    {
<span class="nc" id="L82">    return ttd.getTileWidth();</span>
    }
 
  public boolean getScrollableTracksViewportHeight() 
    {
<span class="nc" id="L87">    return false;</span>
    }
    
  public boolean getScrollableTracksViewportWidth() 
    {
<span class="nc" id="L92">    return false;</span>
    }
    
  public int getScrollableUnitIncrement(Rectangle visibleRect, int orientation, int direction)
    {
<span class="nc" id="L97">    return ttd.getTileWidth();</span>
    }
  
  /* ------ Scrollable ------ */

  /* ------ MouseListener ------ */
  public void mouseClicked(MouseEvent e)
    {
    //System.out.println(&quot;clicked x=&quot;+e.getX()+&quot; y=&quot;+e.getY());
    // what is the actual tile??
<span class="nc" id="L107">    int col = e.getX()/ttd.getTileWidth();</span>
<span class="nc" id="L108">    int row = e.getY()/ttd.getTileHeight();</span>

<span class="nc" id="L110">    ttlDef.setTileNum(row*ttd.getWidth()+col,curTile);</span>
    
<span class="nc" id="L112">    ttd.setHasChanged(true);</span>

<span class="nc" id="L114">    repaint();</span>
<span class="nc" id="L115">    }</span>
  public void mouseEntered(MouseEvent e)
    {
<span class="nc" id="L118">    }</span>
  public void mouseExited(MouseEvent e)
    {
<span class="nc" id="L121">    }</span>
  public void mousePressed(MouseEvent e)
    {
<span class="nc" id="L124">    }</span>
  public void mouseReleased(MouseEvent e)
    {
<span class="nc" id="L127">    }</span>

  /* ------ MouseListener ------ */

  public void paintComponent(Graphics g)
    {
    int i;

    // clear the panel
<span class="nc" id="L136">    g.setColor(Color.black);</span>
<span class="nc" id="L137">    g.fillRect(0,0,getWidth(),getHeight());</span>

    // draw a white line around the tile area
<span class="nc" id="L140">    g.setColor(Color.white);</span>
<span class="nc" id="L141">    g.drawRect(0,0,ttd.getMapPixelWidth(),ttd.getMapPixelHeight());</span>
    //System.out.println(&quot;ttp painting &quot;+this.getWidth()+&quot; bounds=&quot;+this.bounds());
    //g.drawLine(0,0,500,500);
<span class="nc" id="L144">    ArrayList layers = ttd.getLayers();</span>
<span class="nc" id="L145">    Iterator it = layers.iterator();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">    while (it.hasNext())</span>
      {
<span class="nc" id="L148">      TederLayer ttl = (TederLayer) it.next();</span>
      // draw all the tiles on the layer
      int idx;
<span class="nc bnc" id="L151" title="All 2 branches missed.">      for (idx=0;idx&lt;ttd.size();idx++)</span>
        {
<span class="nc" id="L153">        int tilenum = ttl.getTileNum(idx);</span>
        // negative tiles are transparent
<span class="nc bnc" id="L155" title="All 2 branches missed.">        if (tilenum&gt;=0)</span>
          {
<span class="nc" id="L157">          int xpos = (idx%ttd.getWidth())*ttd.getTileWidth()+offx;</span>
<span class="nc" id="L158">          int ypos = (idx/ttd.getWidth())*ttd.getTileHeight()+offy;</span>
          //System.out.println(&quot;drawing tile num=&quot;+tilenum);
          //System.out.println(&quot;col=&quot;+(idx%ttd.getWidth())+&quot; col=&quot;+(idx/ttd.getHeight()));

<span class="nc" id="L162">          ttd.drawTileImage(g,xpos,ypos,tilenum,null);</span>
          }
        }
<span class="nc" id="L165">      } // while</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">      for (i=0;i&lt;ttd.size();i++)</span>
        {
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (ttd.hwalls[i] == 1)</span>
          {
<span class="nc" id="L170">          int row = i / ttd.getWidth();</span>
<span class="nc" id="L171">          int col = i % ttd.getWidth();</span>

<span class="nc" id="L173">          g.setColor(Color.red);</span>
<span class="nc" id="L174">          g.fillRect(col*64,row*64,64,20);</span>
          }
        }
<span class="nc" id="L177">    } // paint</span>
  }
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>