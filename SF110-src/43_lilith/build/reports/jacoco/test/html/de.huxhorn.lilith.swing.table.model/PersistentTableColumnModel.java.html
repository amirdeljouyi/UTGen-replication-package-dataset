<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PersistentTableColumnModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">43_lilith</a> &gt; <a href="index.source.html" class="el_package">de.huxhorn.lilith.swing.table.model</a> &gt; <span class="el_source">PersistentTableColumnModel.java</span></div><h1>PersistentTableColumnModel.java</h1><pre class="source lang-java linenums">package de.huxhorn.lilith.swing.table.model;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import javax.swing.table.DefaultTableColumnModel;
import javax.swing.table.TableColumn;

/**
 * This class is based on code and ideas from Stephen Kelvin (mail at StephenKelvin.de) and Thomas Darimont.
 */
public class PersistentTableColumnModel
	extends DefaultTableColumnModel
{
<span class="nc" id="L17">	protected List&lt;TableColumn&gt; allTableColumns = new ArrayList&lt;TableColumn&gt;();</span>

	/**
	 * Creates an extended table column model.
	 */
	public PersistentTableColumnModel()
<span class="nc" id="L23">	{</span>
<span class="nc" id="L24">		allTableColumns = new ArrayList&lt;TableColumn&gt;();</span>
<span class="nc" id="L25">		initColumns();</span>
<span class="nc" id="L26">	}</span>

	/**
	 * Should be implemented by subclasses if needed.
	 */
	protected void initColumns()
	{

<span class="nc" id="L34">	}</span>

	/**
	 * Sets the visibility of the specified TableColumn.
	 * The call is ignored if the TableColumn is not found in this column model
	 * or its visibility status did not change.
	 * &lt;p/&gt;
	 *
	 * @param column  the column to show/hide
	 * @param visible its new visibility status
	 */
	// listeners will receive columnAdded()/columnRemoved() event
	public void setColumnVisible(TableColumn column, boolean visible)
	{
<span class="nc bnc" id="L48" title="All 2 branches missed.">		if(!visible)</span>
		{
<span class="nc" id="L50">			super.removeColumn(column);</span>
		}
		else
		{
			// find the visible index of the column:
			// iterate through both collections of visible and all columns, counting
			// visible columns up to the one that's about to be shown again
<span class="nc" id="L57">			int noVisibleColumns = tableColumns.size();</span>
<span class="nc" id="L58">			int noInvisibleColumns = allTableColumns.size();</span>
<span class="nc" id="L59">			int visibleIndex = 0;</span>

<span class="nc bnc" id="L61" title="All 2 branches missed.">			for(int invisibleIndex = 0; invisibleIndex &lt; noInvisibleColumns; ++invisibleIndex)</span>
			{
<span class="nc bnc" id="L63" title="All 2 branches missed.">				TableColumn visibleColumn = (visibleIndex &lt; noVisibleColumns ? tableColumns.get(visibleIndex) : null);</span>
<span class="nc" id="L64">				TableColumn testColumn = allTableColumns.get(invisibleIndex);</span>

<span class="nc bnc" id="L66" title="All 2 branches missed.">				if(testColumn == column)</span>
				{
<span class="nc bnc" id="L68" title="All 2 branches missed.">					if(visibleColumn != column)</span>
					{
<span class="nc" id="L70">						super.addColumn(column);</span>
<span class="nc" id="L71">						super.moveColumn(tableColumns.size() - 1, visibleIndex);</span>
					}
<span class="nc" id="L73">					return; // ####################</span>
				}
<span class="nc bnc" id="L75" title="All 2 branches missed.">				if(testColumn == visibleColumn)</span>
				{
<span class="nc" id="L77">					++visibleIndex;</span>
				}
			}
		}
<span class="nc" id="L81">	}</span>

	/**
	 * Makes all columns in this model visible
	 */
	public void setAllColumnsVisible()
	{
<span class="nc" id="L88">		int noColumns = allTableColumns.size();</span>

<span class="nc bnc" id="L90" title="All 2 branches missed.">		for(int columnIndex = 0; columnIndex &lt; noColumns; ++columnIndex)</span>
		{
<span class="nc bnc" id="L92" title="All 2 branches missed.">			TableColumn visibleColumn = (columnIndex &lt; tableColumns.size() ? tableColumns.get(columnIndex) : null);</span>
<span class="nc" id="L93">			TableColumn invisibleColumn = allTableColumns.get(columnIndex);</span>

<span class="nc bnc" id="L95" title="All 2 branches missed.">			if(visibleColumn != invisibleColumn)</span>
			{
<span class="nc" id="L97">				super.addColumn(invisibleColumn);</span>
<span class="nc" id="L98">				super.moveColumn(tableColumns.size() - 1, columnIndex);</span>
			}
		}
<span class="nc" id="L101">	}</span>

	/**
	 * Checks wether the specified column is currently visible.
	 *
	 * @param aColumn column to check
	 * @return visibility of specified column (false if there is no such column at all. [It's not visible, right?])
	 */
	public boolean isColumnVisible(TableColumn aColumn)
	{
<span class="nc bnc" id="L111" title="All 2 branches missed.">		return (tableColumns.indexOf(aColumn) &gt;= 0);</span>
	}

	/**
	 * Append &lt;code&gt;column&lt;/code&gt; to the right of exisiting columns.
	 * Posts &lt;code&gt;columnAdded&lt;/code&gt; event.
	 *
	 * @param column The column to be added
	 * @throws IllegalArgumentException if &lt;code&gt;column&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;
	 * @see #removeColumn
	 */
	@Override
	public void addColumn(TableColumn column)
	{
<span class="nc" id="L125">		allTableColumns.add(column);</span>
<span class="nc" id="L126">		super.addColumn(column);</span>
<span class="nc" id="L127">	}</span>

	/**
	 * Removes &lt;code&gt;column&lt;/code&gt; from this column model.
	 * Posts &lt;code&gt;columnRemoved&lt;/code&gt; event.
	 * Will do nothing if the column is not in this model.
	 *
	 * @param column the column to be added
	 * @see #addColumn
	 */
	@Override
	public void removeColumn(TableColumn column)
	{
<span class="nc" id="L140">		int allColumnsIndex = allTableColumns.indexOf(column);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if(allColumnsIndex != -1)</span>
		{
<span class="nc" id="L143">			allTableColumns.remove(allColumnsIndex);</span>
		}
<span class="nc" id="L145">		super.removeColumn(column);</span>
<span class="nc" id="L146">	}</span>

	/**
	 * Moves the column from &lt;code&gt;oldIndex&lt;/code&gt; to &lt;code&gt;newIndex&lt;/code&gt;.
	 * Posts  &lt;code&gt;columnMoved&lt;/code&gt; event.
	 * Will not move any columns if &lt;code&gt;oldIndex&lt;/code&gt; equals &lt;code&gt;newIndex&lt;/code&gt;.
	 *
	 * @throws IllegalArgumentException if either &lt;code&gt;oldIndex&lt;/code&gt; or
	 *                                  &lt;code&gt;newIndex&lt;/code&gt;
	 *                                  are not in [0, getColumnCount() - 1]
	 * @param	oldIndex			index of column to be moved
	 * @param	newIndex			new index of the column
	 */
	@Override
	public void moveColumn(int oldIndex, int newIndex)
	{
<span class="nc bnc" id="L162" title="All 6 branches missed.">		if((oldIndex &lt; 0) || (oldIndex &gt;= getColumnCount()) ||</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">			(newIndex &lt; 0) || (newIndex &gt;= getColumnCount()))</span>
		{
<span class="nc" id="L165">			throw new IllegalArgumentException(&quot;moveColumn() - Index out of range&quot;);</span>
		}

<span class="nc" id="L168">		TableColumn fromColumn = tableColumns.get(oldIndex);</span>
<span class="nc" id="L169">		TableColumn toColumn = tableColumns.get(newIndex);</span>

<span class="nc" id="L171">		int allColumnsOldIndex = allTableColumns.indexOf(fromColumn);</span>
<span class="nc" id="L172">		int allColumnsNewIndex = allTableColumns.indexOf(toColumn);</span>

<span class="nc bnc" id="L174" title="All 2 branches missed.">		if(oldIndex != newIndex)</span>
		{
<span class="nc" id="L176">			allTableColumns.remove(allColumnsOldIndex);</span>
<span class="nc" id="L177">			allTableColumns.add(allColumnsNewIndex, fromColumn);</span>
		}

<span class="nc" id="L180">		super.moveColumn(oldIndex, newIndex);</span>
<span class="nc" id="L181">	}</span>

	/**
	 * Returns the total number of columns in this model.
	 *
	 * @param onlyVisible if set only visible columns will be counted
	 * @return the number of columns in the &lt;code&gt;tableColumns&lt;/code&gt; array
	 * @see	#getColumns
	 */
	public int getColumnCount(boolean onlyVisible)
	{
<span class="nc bnc" id="L192" title="All 2 branches missed.">		return (onlyVisible ? tableColumns.size() : allTableColumns.size());</span>
	}

	/**
	 * Returns an &lt;code&gt;Enumeration&lt;/code&gt; of all the columns in the model.
	 *
	 * @param onlyVisible if set all invisible columns will be missing from the enumeration.
	 * @return an &lt;code&gt;Enumeration&lt;/code&gt; of the columns in the model
	 */
	public Iterator&lt;TableColumn&gt; getColumns(boolean onlyVisible)
	{
<span class="nc bnc" id="L203" title="All 2 branches missed.">		return (onlyVisible ? tableColumns.iterator() : allTableColumns.iterator());</span>
	}

	/**
	 * Returns the position of the first column whose identifier equals &lt;code&gt;identifier&lt;/code&gt;.
	 * Position is the the index in all visible columns if &lt;code&gt;onlyVisible&lt;/code&gt; is true or
	 * else the index in all columns.
	 *
	 * @return the index of the first column whose identifier
	 *         equals &lt;code&gt;identifier&lt;/code&gt;
	 * @throws IllegalArgumentException if &lt;code&gt;identifier&lt;/code&gt;
	 *                                  is &lt;code&gt;null&lt;/code&gt;, or if no
	 *                                  &lt;code&gt;TableColumn&lt;/code&gt; has this
	 *                                  &lt;code&gt;identifier&lt;/code&gt;
	 * @param	identifier the identifier object to search for
	 * @param	onlyVisible if set searches only visible columns
	 * @see		#getColumn
	 */
	public int getColumnIndex(Object identifier, boolean onlyVisible)
	{
<span class="nc bnc" id="L223" title="All 2 branches missed.">		if(identifier == null)</span>
		{
<span class="nc" id="L225">			throw new IllegalArgumentException(&quot;Identifier is null&quot;);</span>
		}

<span class="nc bnc" id="L228" title="All 2 branches missed.">		List&lt;TableColumn&gt; columns = (onlyVisible ? tableColumns : allTableColumns);</span>
<span class="nc" id="L229">		int noColumns = columns.size();</span>
		TableColumn column;

<span class="nc bnc" id="L232" title="All 2 branches missed.">		for(int columnIndex = 0; columnIndex &lt; noColumns; ++columnIndex)</span>
		{
<span class="nc" id="L234">			column = columns.get(columnIndex);</span>

<span class="nc bnc" id="L236" title="All 2 branches missed.">			if(identifier.equals(column.getIdentifier()))</span>
			{
<span class="nc" id="L238">				return columnIndex;</span>
			}
		}

<span class="nc" id="L242">		throw new IllegalArgumentException(&quot;Identifier not found&quot;);</span>
	}

	public List&lt;TableColumnLayoutInfo&gt; getColumnLayoutInfos()
	{
<span class="nc" id="L247">		final List&lt;TableColumnLayoutInfo&gt; tableColumnLayoutInfos = new ArrayList&lt;TableColumnLayoutInfo&gt;(allTableColumns.size());</span>

<span class="nc bnc" id="L249" title="All 2 branches missed.">		for(TableColumn current : allTableColumns)</span>
		{
<span class="nc" id="L251">			boolean visible = tableColumns.contains(current);</span>
<span class="nc" id="L252">			TableColumnLayoutInfo tableColumnLayoutInfo</span>
<span class="nc" id="L253">				= new TableColumnLayoutInfo(current.getIdentifier().toString(),</span>
<span class="nc" id="L254">				current.getWidth(), visible);</span>
<span class="nc" id="L255">			tableColumnLayoutInfos.add(tableColumnLayoutInfo);</span>
<span class="nc" id="L256">		}</span>

<span class="nc" id="L258">		return tableColumnLayoutInfos;</span>
	}

	public static class TableColumnLayoutInfo
		implements Serializable
	{
		private String columnName;
		private int width;
		private boolean visible;

		public TableColumnLayoutInfo()
<span class="nc" id="L269">		{</span>
<span class="nc" id="L270">		}</span>

		public TableColumnLayoutInfo(String columnName, int width, boolean visible)
<span class="nc" id="L273">		{</span>
<span class="nc" id="L274">			this.columnName = columnName;</span>
<span class="nc" id="L275">			this.width = width;</span>
<span class="nc" id="L276">			this.visible = visible;</span>
<span class="nc" id="L277">		}</span>

		public int getWidth()
		{
<span class="nc" id="L281">			return width;</span>
		}

		public void setWidth(int width)
		{
<span class="nc" id="L286">			this.width = width;</span>
<span class="nc" id="L287">		}</span>

		public String getColumnName()
		{
<span class="nc" id="L291">			return columnName;</span>
		}

		public void setColumnName(String columnName)
		{
<span class="nc" id="L296">			this.columnName = columnName;</span>
<span class="nc" id="L297">		}</span>

		public boolean isVisible()
		{
<span class="nc" id="L301">			return visible;</span>
		}

		public void setVisible(boolean visible)
		{
<span class="nc" id="L306">			this.visible = visible;</span>
<span class="nc" id="L307">		}</span>

		@Override
		public String toString()
		{
<span class="nc" id="L312">			return &quot;TableColumnLayoutInfo[columnName=&quot; + columnName + &quot;, width=&quot; + width + &quot;, visible=&quot; + visible + &quot;]&quot;;</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>