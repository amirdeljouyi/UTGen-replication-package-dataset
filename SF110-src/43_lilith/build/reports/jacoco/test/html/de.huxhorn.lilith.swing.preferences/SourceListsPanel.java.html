<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SourceListsPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">43_lilith</a> &gt; <a href="index.source.html" class="el_package">de.huxhorn.lilith.swing.preferences</a> &gt; <span class="el_source">SourceListsPanel.java</span></div><h1>SourceListsPanel.java</h1><pre class="source lang-java linenums">/*
 * Lilith - a log event viewer.
 * Copyright (C) 2007-2009 Joern Huxhorn
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package de.huxhorn.lilith.swing.preferences;

import de.huxhorn.lilith.swing.EventWrapperViewPanel;
import de.huxhorn.sulky.swing.Windows;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.net.URL;
import java.util.ArrayList;
import java.util.List;

import javax.swing.*;
import javax.swing.border.TitledBorder;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

public class SourceListsPanel
	extends JPanel
{
<span class="nc" id="L42">	final Logger logger = LoggerFactory.getLogger(SourceListsPanel.class);</span>

	private JList sourceListList;
	private GenericSortedListModel&lt;String&gt; sourceListListModel;
	private EditSourceListAction editSourceListAction;
	private RemoveSourceListAction removeSourceListAction;
	private PreferencesDialog preferencesDialog;
	//private ApplicationPreferences applicationPreferences;
	private EditSourceListDialog editSourceListDialog;
	//private Map&lt;String, List&lt;Source&gt;&gt; sourceLists;
	private GenericSortedListModel&lt;Source&gt; listModel;

	public SourceListsPanel(PreferencesDialog preferencesDialog)
<span class="nc" id="L55">	{</span>
<span class="nc" id="L56">		this.preferencesDialog = preferencesDialog;</span>
		//applicationPreferences=preferencesDialog.getApplicationPreferences();
<span class="nc" id="L58">		createUI();</span>
<span class="nc" id="L59">	}</span>

	private void createUI()
	{
<span class="nc" id="L63">		editSourceListDialog = new EditSourceListDialog(preferencesDialog);</span>
<span class="nc" id="L64">		setLayout(new BorderLayout());</span>
<span class="nc" id="L65">		sourceListListModel = new GenericSortedListModel&lt;String&gt;();</span>
<span class="nc" id="L66">		sourceListList = new JList(sourceListListModel);</span>
<span class="nc" id="L67">		sourceListList.addMouseListener(new SourceListMouseListener());</span>
<span class="nc" id="L68">		JScrollPane sourceListScrollPane = new JScrollPane(sourceListList);</span>
		//JPanel sourceListsListPanel = new JPanel(new GridLayout(1,1));
		//sourceListsListPanel.add(sourceListScrollPane);
		//sourceListsListPanel.setBorder(new TitledBorder(&quot;Source Lists&quot;));
<span class="nc" id="L72">		sourceListScrollPane.setBorder(new TitledBorder(&quot;Source Lists&quot;));</span>

<span class="nc" id="L74">		ListCellRenderer sourceCellRenderer = new SourceCellRenderer();</span>

<span class="nc" id="L76">		listModel = new GenericSortedListModel&lt;Source&gt;();</span>
<span class="nc" id="L77">		JList listList = new JList(listModel);</span>
<span class="nc" id="L78">		listList.setEnabled(false);</span>
<span class="nc" id="L79">		listList.setCellRenderer(sourceCellRenderer);</span>
<span class="nc" id="L80">		sourceListList.addListSelectionListener(new SourceListListSelectionListener());</span>


<span class="nc" id="L83">		JScrollPane listScrollPane = new JScrollPane(listList);</span>
		//JPanel listPanel = new JPanel(new GridLayout(1,1));
		//listPanel.add(listScrollPane);
		//listPanel.setBorder(new TitledBorder(&quot;List content&quot;));
<span class="nc" id="L87">		listScrollPane.setBorder(new TitledBorder(&quot;List content&quot;));</span>

//		JPanel listsPanel = new JPanel(new GridBagLayout());
//		GridBagConstraints gbc = new GridBagConstraints();
//		gbc.weightx = 0.5;
//		gbc.weighty = 0.5;
//		gbc.gridx = 0;
//		gbc.gridy = 0;
//		gbc.gridwidth = 1;
//		gbc.fill = GridBagConstraints.BOTH;
//
//		listsPanel.add(sourceListsListPanel, gbc);
//		gbc.gridx = 1;
//		listsPanel.add(listPanel, gbc);
<span class="nc" id="L101">		JPanel listsPanel = new JPanel(new GridLayout(1, 2));</span>
<span class="nc" id="L102">		listsPanel.add(sourceListScrollPane);</span>
<span class="nc" id="L103">		listsPanel.add(listScrollPane);</span>


<span class="nc" id="L106">		JToolBar sourceListsToolbar = new JToolBar();</span>
<span class="nc" id="L107">		sourceListsToolbar.setFloatable(false);</span>

<span class="nc" id="L109">		AddSourceListAction addSourceListAction = new AddSourceListAction();</span>
<span class="nc" id="L110">		editSourceListAction = new EditSourceListAction();</span>
<span class="nc" id="L111">		removeSourceListAction = new RemoveSourceListAction();</span>

<span class="nc" id="L113">		JButton addSourceListButton = new JButton(addSourceListAction);</span>
<span class="nc" id="L114">		JButton editSourceListButton = new JButton(editSourceListAction);</span>
<span class="nc" id="L115">		JButton removeSourceListButton = new JButton(removeSourceListAction);</span>

<span class="nc" id="L117">		sourceListsToolbar.add(addSourceListButton);</span>
<span class="nc" id="L118">		sourceListsToolbar.add(editSourceListButton);</span>
<span class="nc" id="L119">		sourceListsToolbar.add(removeSourceListButton);</span>

<span class="nc" id="L121">		ListSelectionModel sourceListSelectionModel = sourceListList.getSelectionModel();</span>
<span class="nc" id="L122">		sourceListSelectionModel.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L123">		sourceListSelectionModel.addListSelectionListener(new SourceListSelectionListener());</span>

<span class="nc" id="L125">		add(sourceListsToolbar, BorderLayout.NORTH);</span>
<span class="nc" id="L126">		add(listsPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L127">	}</span>

/*
	public void saveSettings()
	{
		applicationPreferences.setSourceLists(this.sourceLists);
	}
*/

<span class="nc" id="L136">	private class SourceListSelectionListener</span>
		implements ListSelectionListener
	{
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc" id="L141">			updateActions();</span>
<span class="nc" id="L142">		}</span>
	}

	public void initUI()
	{
		/*
		Map&lt;String, List&lt;Source&gt;&gt; sourceLists = applicationPreferences.getSourceLists();
		if(sourceLists == null)
		{
			this.sourceLists = new HashMap&lt;String, List&lt;Source&gt;&gt;();
		}
		else
		{
			this.sourceLists = new HashMap&lt;String, List&lt;Source&gt;&gt;(sourceLists);
		}
		*/
<span class="nc" id="L158">		updateSourceLists();</span>
<span class="nc" id="L159">		updateListContents();</span>
<span class="nc" id="L160">		updateActions();</span>
<span class="nc" id="L161">	}</span>

	private void updateSourceLists()
	{
<span class="nc" id="L165">		sourceListListModel.setData(new ArrayList&lt;String&gt;(preferencesDialog.getSourceListNames()));</span>
<span class="nc" id="L166">	}</span>

	private void updateListContents()
	{
<span class="nc" id="L170">		String selected = (String) sourceListList.getSelectedValue();</span>

<span class="nc" id="L172">		List&lt;Source&gt; list = null;</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">		if(selected != null)</span>
		{
<span class="nc" id="L175">			list = preferencesDialog.getSourceList(selected);</span>
		}
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if(list == null)</span>
		{
<span class="nc" id="L179">			list = new ArrayList&lt;Source&gt;();</span>
		}
<span class="nc" id="L181">		listModel.setData(list);</span>
<span class="nc" id="L182">	}</span>

	private void updateActions()
	{
<span class="nc" id="L186">		int selectedIndex = sourceListList.getSelectedIndex();</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">		if(logger.isDebugEnabled()) logger.debug(&quot;selectedIndex={}&quot;, selectedIndex);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">		editSourceListAction.setEnabled(selectedIndex != -1);</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">		removeSourceListAction.setEnabled(selectedIndex != -1);</span>
<span class="nc" id="L190">	}</span>

	public void editSourceList(final String sourceListName, boolean add)
	{
<span class="nc" id="L194">		editSourceListDialog.setSourceListName(sourceListName);</span>
<span class="nc" id="L195">		List&lt;Source&gt; data = preferencesDialog.getSourceList(sourceListName);</span>
		/*
		if(sourceListName!=null)
		{
			if(sourceLists.containsKey(sourceListName))
			{
				data=new ArrayList&lt;Source&gt;(sourceLists.get(sourceListName));
			}
		}
		*/
<span class="nc bnc" id="L205" title="All 2 branches missed.">		if(data == null)</span>
		{
<span class="nc" id="L207">			data = new ArrayList&lt;Source&gt;();</span>
		}
		else
		{
<span class="nc" id="L211">			data = new ArrayList&lt;Source&gt;(data);</span>
		}
<span class="nc" id="L213">		editSourceListDialog.setAdding(add);</span>
<span class="nc" id="L214">		editSourceListDialog.setSources(data);</span>
<span class="nc" id="L215">		Windows.showWindow(editSourceListDialog, preferencesDialog, true);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if(!editSourceListDialog.isCanceled())</span>
		{
<span class="nc" id="L218">			String newSourceListName = editSourceListDialog.getSourcListeName();</span>
<span class="nc" id="L219">			List&lt;Source&gt; sources = editSourceListDialog.getSources();</span>
<span class="nc" id="L220">			preferencesDialog.setSourceList(sourceListName, newSourceListName, sources);</span>
			/*
			if(sourceListName != null &amp;&amp; sourceLists.containsKey(sourceListName))
			{
				sourceLists.remove(sourceListName);
			}
			sourceLists.put(newSourceListName, sources);
			updateSourceLists();
			updateListContents();
			*/
		}
<span class="nc bnc" id="L231" title="All 2 branches missed.">		if(logger.isDebugEnabled()) logger.debug(&quot;After show of editSourceListDialog...&quot;);</span>
<span class="nc" id="L232">	}</span>

	private class AddSourceListAction
		extends AbstractAction
	{
		public AddSourceListAction()
<span class="nc" id="L238">		{</span>
<span class="nc" id="L239">			super(&quot;Add&quot;);</span>
			Icon icon;
			{
<span class="nc" id="L242">				URL url = EventWrapperViewPanel.class.getResource(&quot;/tango/16x16/actions/list-add.png&quot;);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">				if(url != null)</span>
				{
<span class="nc" id="L245">					icon = new ImageIcon(url);</span>
				}
				else
				{
<span class="nc" id="L249">					icon = null;</span>
				}
			}
<span class="nc" id="L252">			putValue(Action.SMALL_ICON, icon);</span>
<span class="nc" id="L253">			putValue(Action.SHORT_DESCRIPTION, &quot;Add a new Source List.&quot;);</span>
<span class="nc" id="L254">		}</span>

		public void actionPerformed(ActionEvent e)
		{
<span class="nc bnc" id="L258" title="All 2 branches missed.">			if(logger.isDebugEnabled()) logger.debug(&quot;Add&quot;);</span>
<span class="nc" id="L259">			String sourceListName = &quot;&quot;;</span>
<span class="nc" id="L260">			editSourceList(sourceListName, true);</span>
<span class="nc" id="L261">		}</span>
	}

	private class EditSourceListAction
		extends AbstractAction
	{
		public EditSourceListAction()
<span class="nc" id="L268">		{</span>
<span class="nc" id="L269">			super(&quot;Edit&quot;);</span>
			Icon icon;
			{
<span class="nc" id="L272">				URL url = EventWrapperViewPanel.class.getResource(&quot;/tango/16x16/actions/list-add.png&quot;);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">				if(url != null)</span>
				{
<span class="nc" id="L275">					icon = new ImageIcon(url);</span>
				}
				else
				{
<span class="nc" id="L279">					icon = null;</span>
				}
			}
<span class="nc" id="L282">			putValue(Action.SMALL_ICON, icon);</span>
<span class="nc" id="L283">			putValue(Action.SHORT_DESCRIPTION, &quot;Edit a Source List.&quot;);</span>
<span class="nc" id="L284">		}</span>

		public void actionPerformed(ActionEvent e)
		{
<span class="nc bnc" id="L288" title="All 2 branches missed.">			if(logger.isDebugEnabled()) logger.debug(&quot;Edit&quot;);</span>
<span class="nc" id="L289">			int row = sourceListList.getSelectedIndex();</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">			if(row &gt;= 0)</span>
			{
<span class="nc" id="L292">				String sourceListName = sourceListListModel.getElementAt(row);</span>
<span class="nc" id="L293">				editSourceList(sourceListName, false);</span>
			}
<span class="nc" id="L295">		}</span>
	}

	private class RemoveSourceListAction
		extends AbstractAction
	{
		public RemoveSourceListAction()
<span class="nc" id="L302">		{</span>
<span class="nc" id="L303">			super(&quot;Remove&quot;);</span>
			Icon icon;
			{
<span class="nc" id="L306">				URL url = EventWrapperViewPanel.class.getResource(&quot;/tango/16x16/actions/list-remove.png&quot;);</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">				if(url != null)</span>
				{
<span class="nc" id="L309">					icon = new ImageIcon(url);</span>
				}
				else
				{
<span class="nc" id="L313">					icon = null;</span>
				}
			}
<span class="nc" id="L316">			putValue(Action.SMALL_ICON, icon);</span>
<span class="nc" id="L317">			putValue(Action.SHORT_DESCRIPTION, &quot;Remove the selected Source List.&quot;);</span>
<span class="nc" id="L318">		}</span>

		public void actionPerformed(ActionEvent e)
		{
<span class="nc bnc" id="L322" title="All 2 branches missed.">			if(logger.isDebugEnabled()) logger.debug(&quot;Remove&quot;);</span>

<span class="nc" id="L324">			int row = sourceListList.getSelectedIndex();</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">			if(row &gt;= 0)</span>
			{
<span class="nc" id="L327">				String sourceListName = sourceListListModel.getElementAt(row);</span>
<span class="nc" id="L328">				preferencesDialog.removeSourceList(sourceListName);</span>
			}
<span class="nc" id="L330">		}</span>
	}

	private class SourceListMouseListener
		implements MouseListener
	{
<span class="nc" id="L336">		private final Logger logger = LoggerFactory.getLogger(SourceListMouseListener.class);</span>


		public SourceListMouseListener()
<span class="nc" id="L340">		{</span>
<span class="nc" id="L341">		}</span>

		public void mouseClicked(MouseEvent evt)
		{
<span class="nc bnc" id="L345" title="All 4 branches missed.">			if(evt.getClickCount() &gt;= 2 &amp;&amp; evt.getButton() == MouseEvent.BUTTON1)</span>
			{
<span class="nc" id="L347">				Point p = evt.getPoint();</span>
<span class="nc" id="L348">				int row = sourceListList.locationToIndex(p);</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">				if(logger.isDebugEnabled()) logger.debug(&quot;Source-List-Index: {}&quot;, row);</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">				if(row &gt;= 0)</span>
				{
<span class="nc" id="L352">					String sourceListName = sourceListListModel.getElementAt(row);</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">					if(sourceListName == null)</span>
					{
<span class="nc" id="L355">						sourceListName = &quot;&quot;;</span>
					}

<span class="nc" id="L358">					editSourceList(sourceListName, false);</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">					if(logger.isInfoEnabled()) logger.info(&quot;After show...&quot;);</span>
				}
<span class="nc" id="L361">			}</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">			else if(evt.isPopupTrigger())</span>
			{
<span class="nc" id="L364">				showPopup(evt);</span>
			}
<span class="nc" id="L366">		}</span>


		/**
		 * @noinspection UNUSED_SYMBOL
		 */
		private void showPopup(MouseEvent evt)
		{
<span class="nc" id="L374">		}</span>

		public void mousePressed(MouseEvent evt)
		{
<span class="nc bnc" id="L378" title="All 2 branches missed.">			if(evt.isPopupTrigger())</span>
			{
<span class="nc" id="L380">				showPopup(evt);</span>
			}
<span class="nc" id="L382">		}</span>

		public void mouseReleased(MouseEvent evt)
		{
<span class="nc bnc" id="L386" title="All 2 branches missed.">			if(evt.isPopupTrigger())</span>
			{
<span class="nc" id="L388">				showPopup(evt);</span>
			}
<span class="nc" id="L390">		}</span>

		public void mouseEntered(MouseEvent e)
		{
<span class="nc" id="L394">		}</span>

		public void mouseExited(MouseEvent e)
		{
<span class="nc" id="L398">		}</span>

	}

<span class="nc" id="L402">	private class SourceListListSelectionListener</span>
		implements ListSelectionListener
	{
		public void valueChanged(ListSelectionEvent e)
		{
<span class="nc" id="L407">			updateListContents();</span>
<span class="nc" id="L408">			updateActions();</span>
<span class="nc" id="L409">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>