<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EventContainsCondition.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">43_lilith</a> &gt; <a href="index.source.html" class="el_package">de.huxhorn.lilith.conditions</a> &gt; <span class="el_source">EventContainsCondition.java</span></div><h1>EventContainsCondition.java</h1><pre class="source lang-java linenums">/*
 * Lilith - a log event viewer.
 * Copyright (C) 2007-2009 Joern Huxhorn
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package de.huxhorn.lilith.conditions;

import de.huxhorn.lilith.data.access.AccessEvent;
import de.huxhorn.lilith.data.eventsource.EventWrapper;
import de.huxhorn.lilith.data.logging.LoggerContext;
import de.huxhorn.lilith.data.logging.LoggingEvent;
import de.huxhorn.lilith.data.logging.Marker;
import de.huxhorn.lilith.data.logging.Message;
import de.huxhorn.lilith.data.logging.ThreadInfo;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;


public class EventContainsCondition
	implements LilithCondition
{
	private static final long serialVersionUID = -8094852331877521764L;

	private String searchString;

	public EventContainsCondition()
	{
<span class="nc" id="L44">		this(null);</span>
<span class="nc" id="L45">	}</span>

	public EventContainsCondition(String searchString)
<span class="nc" id="L48">	{</span>
<span class="nc" id="L49">		setSearchString(searchString);</span>
<span class="nc" id="L50">	}</span>

	public void setSearchString(String searchString)
	{
<span class="nc" id="L54">		this.searchString = searchString;</span>
<span class="nc" id="L55">	}</span>

	public String getSearchString()
	{
<span class="nc" id="L59">		return searchString;</span>
	}

	private boolean checkString(String input)
	{
<span class="nc bnc" id="L64" title="All 2 branches missed.">		if(searchString == null)</span>
		{
<span class="nc" id="L66">			return false;</span>
		}
<span class="nc bnc" id="L68" title="All 2 branches missed.">		if(input != null)</span>
		{
<span class="nc bnc" id="L70" title="All 2 branches missed.">			if(input.contains(searchString))</span>
			{
<span class="nc" id="L72">				return true;</span>
			}
		}
<span class="nc" id="L75">		return false;</span>
	}

	public boolean isTrue(Object value)
	{
<span class="nc bnc" id="L80" title="All 2 branches missed.">		if(searchString == null)</span>
		{
<span class="nc" id="L82">			return false;</span>
		}
<span class="nc bnc" id="L84" title="All 2 branches missed.">		if(value instanceof EventWrapper)</span>
		{
<span class="nc" id="L86">			EventWrapper wrapper = (EventWrapper) value;</span>
<span class="nc" id="L87">			Object eventObj = wrapper.getEvent();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">			if(searchString.length() == 0)</span>
			{
<span class="nc" id="L90">				return true;</span>
			}
<span class="nc bnc" id="L92" title="All 2 branches missed.">			if(eventObj instanceof LoggingEvent)</span>
			{
<span class="nc" id="L94">				LoggingEvent event = (LoggingEvent) eventObj;</span>

				{
<span class="nc" id="L97">					String message = null;</span>
<span class="nc" id="L98">					Message messageObj = event.getMessage();</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">					if(messageObj != null)</span>
					{
<span class="nc" id="L101">						message = messageObj.getMessage();</span>
					}
<span class="nc bnc" id="L103" title="All 2 branches missed.">					if(message != null)</span>
					{
<span class="nc bnc" id="L105" title="All 2 branches missed.">						if(checkString(message))</span>
						{
<span class="nc" id="L107">							return true;</span>
						}
					}
				}

				{
<span class="nc" id="L113">					LoggerContext context = event.getLoggerContext();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">					if(context != null)</span>
					{
<span class="nc bnc" id="L116" title="All 2 branches missed.">						if(checkString(context.getName()))</span>
						{
<span class="nc" id="L118">							return true;</span>
						}
<span class="nc" id="L120">						Map&lt;String, String&gt; props = context.getProperties();</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">						if(props!= null)</span>
						{
<span class="nc bnc" id="L123" title="All 2 branches missed.">							for(Map.Entry&lt;String, String&gt; current:props.entrySet())</span>
							{
<span class="nc bnc" id="L125" title="All 2 branches missed.">								if(checkString(current.getKey()))</span>
								{
<span class="nc" id="L127">									return true;</span>
								}
<span class="nc bnc" id="L129" title="All 2 branches missed.">								if(checkString(current.getValue()))</span>
								{
<span class="nc" id="L131">									return true;</span>
								}
<span class="nc" id="L133">							}</span>
						}
					}
				}

				{
<span class="nc" id="L139">					String level = &quot;&quot; + event.getLevel();</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">					if(checkString(level))</span>
					{
<span class="nc" id="L142">						return true;</span>
					}
				}

				{
<span class="nc" id="L147">					String loggerName = event.getLogger();</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">					if(checkString(loggerName))</span>
					{
<span class="nc" id="L150">						return true;</span>
					}
				}

				{
<span class="nc" id="L155">					ThreadInfo threadInfo = event.getThreadInfo();</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">					if(threadInfo != null)</span>
					{
<span class="nc" id="L158">						String threadName = threadInfo.getName();</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">						if(checkString(threadName))</span>
						{
<span class="nc" id="L161">							return true;</span>
						}
<span class="nc" id="L163">						Long threadId = threadInfo.getId();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">						if(threadId != null)</span>
						{
<span class="nc bnc" id="L166" title="All 2 branches missed.">							if(checkString(&quot;&quot; + threadId))</span>
							{
<span class="nc" id="L168">								return true;</span>
							}
						}
					}
				}

				{
<span class="nc" id="L175">					Map&lt;String, String&gt; mdcMap = event.getMdc();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">					if(checkMap(mdcMap))</span>
					{
<span class="nc" id="L178">						return true;</span>
					}
				}


				{
<span class="nc" id="L184">					Marker marker = event.getMarker();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">					if(marker != null)</span>
					{
<span class="nc bnc" id="L187" title="All 2 branches missed.">						if(checkMarker(marker, null))</span>
						{
<span class="nc" id="L189">							return true;</span>
						}
					}
				}

<span class="nc" id="L194">			}</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">			else if(eventObj instanceof AccessEvent)</span>
			{
<span class="nc" id="L197">				AccessEvent event = (AccessEvent) eventObj;</span>

				{
<span class="nc" id="L200">					String message = event.getRequestURL();</span>
<span class="nc bnc" id="L201" title="All 2 branches missed.">					if(checkString(message))</span>
					{
<span class="nc" id="L203">						return true;</span>
					}
				}

				{
<span class="nc" id="L208">					de.huxhorn.lilith.data.access.LoggerContext context = event.getLoggerContext();</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">					if(context != null)</span>
					{
<span class="nc bnc" id="L211" title="All 2 branches missed.">						if(checkString(context.getName()))</span>
						{
<span class="nc" id="L213">							return true;</span>
						}
<span class="nc" id="L215">						Map&lt;String, String&gt; props = context.getProperties();</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">						if(props!= null)</span>
						{
<span class="nc bnc" id="L218" title="All 2 branches missed.">							for(Map.Entry&lt;String, String&gt; current:props.entrySet())</span>
							{
<span class="nc bnc" id="L220" title="All 2 branches missed.">								if(checkString(current.getKey()))</span>
								{
<span class="nc" id="L222">									return true;</span>
								}
<span class="nc bnc" id="L224" title="All 2 branches missed.">								if(checkString(current.getValue()))</span>
								{
<span class="nc" id="L226">									return true;</span>
								}
<span class="nc" id="L228">							}</span>
						}
					}
				}

				{
<span class="nc" id="L234">					String message = &quot;&quot; + event.getStatusCode();</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">					if(checkString(message))</span>
					{
<span class="nc" id="L237">						return true;</span>
					}
				}

				{
<span class="nc" id="L242">					Map&lt;String, String&gt; propertyMap = event.getRequestHeaders();</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">					if(checkMap(propertyMap))</span>
					{
<span class="nc" id="L245">						return true;</span>
					}

				}

				{
<span class="nc" id="L251">					Map&lt;String, String&gt; propertyMap = event.getResponseHeaders();</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">					if(checkMap(propertyMap))</span>
					{
<span class="nc" id="L254">						return true;</span>
					}

				}

				{
<span class="nc" id="L260">					Map&lt;String, String[]&gt; propertyMap = event.getRequestParameters();</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">					if(checkArrayMap(propertyMap))</span>
					{
<span class="nc" id="L263">						return true;</span>
					}

				}
			}
		}
<span class="nc" id="L269">		return false;</span>
	}

	private boolean checkMarker(Marker marker, List&lt;String&gt; processedMarkers)
	{
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if(marker != null)</span>
		{
<span class="nc bnc" id="L276" title="All 2 branches missed.">			if(processedMarkers == null)</span>
			{
<span class="nc" id="L278">				processedMarkers = new ArrayList&lt;String&gt;();</span>
			}
<span class="nc bnc" id="L280" title="All 2 branches missed.">			if(checkString(marker.getName()))</span>
			{
<span class="nc" id="L282">				return true;</span>
			}
<span class="nc bnc" id="L284" title="All 2 branches missed.">			if(!processedMarkers.contains(marker.getName()))</span>
			{
<span class="nc" id="L286">				processedMarkers.add(marker.getName());</span>
<span class="nc bnc" id="L287" title="All 2 branches missed.">				if(marker.hasReferences())</span>
				{
<span class="nc" id="L289">					Map&lt;String, Marker&gt; children = marker.getReferences();</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">					for(Map.Entry&lt;String, Marker&gt; current : children.entrySet())</span>
					{
<span class="nc" id="L292">						Marker child = current.getValue();</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">						if(checkMarker(child, processedMarkers))</span>
						{
<span class="nc" id="L295">							return true;</span>
						}
<span class="nc" id="L297">					}</span>
				}
			}
		}
<span class="nc" id="L301">		return false;</span>
	}

	private boolean checkMap(Map&lt;String, String&gt; map)
	{
<span class="nc bnc" id="L306" title="All 2 branches missed.">		if(map != null)</span>
		{
<span class="nc bnc" id="L308" title="All 2 branches missed.">			for(Map.Entry&lt;String, String&gt; entry : map.entrySet())</span>
			{
<span class="nc bnc" id="L310" title="All 2 branches missed.">				if(checkString(entry.getKey()))</span>
				{
<span class="nc" id="L312">					return true;</span>
				}
<span class="nc bnc" id="L314" title="All 2 branches missed.">				if(checkString(entry.getValue()))</span>
				{
<span class="nc" id="L316">					return true;</span>
				}
<span class="nc" id="L318">			}</span>
		}
<span class="nc" id="L320">		return false;</span>
	}

	private boolean checkArrayMap(Map&lt;String, String[]&gt; map)
	{
<span class="nc bnc" id="L325" title="All 2 branches missed.">		if(map != null)</span>
		{
<span class="nc bnc" id="L327" title="All 2 branches missed.">			for(Map.Entry&lt;String, String[]&gt; entry : map.entrySet())</span>
			{
<span class="nc bnc" id="L329" title="All 2 branches missed.">				if(checkString(entry.getKey()))</span>
				{
<span class="nc" id="L331">					return true;</span>
				}
<span class="nc" id="L333">				String[] array = entry.getValue();</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">				for(String s : array)</span>
				{
<span class="nc bnc" id="L336" title="All 2 branches missed.">					if(checkString(s))</span>
					{
<span class="nc" id="L338">						return true;</span>
					}
				}
<span class="nc" id="L341">			}</span>
		}
<span class="nc" id="L343">		return false;</span>
	}

	private void readObject(ObjectInputStream in)
		throws IOException, ClassNotFoundException
	{
<span class="nc" id="L349">		in.defaultReadObject();</span>
<span class="nc" id="L350">		setSearchString(this.searchString);</span>
<span class="nc" id="L351">	}</span>

	public boolean equals(Object o)
	{
<span class="nc bnc" id="L355" title="All 2 branches missed.">		if(this == o) return true;</span>
<span class="nc bnc" id="L356" title="All 4 branches missed.">		if(o == null || getClass() != o.getClass()) return false;</span>

<span class="nc" id="L358">		EventContainsCondition that = (EventContainsCondition) o;</span>

<span class="nc bnc" id="L360" title="All 6 branches missed.">		return !(searchString != null ? !searchString.equals(that.searchString) : that.searchString != null);</span>
	}

	public int hashCode()
	{
		int result;
<span class="nc bnc" id="L366" title="All 2 branches missed.">		result = (searchString != null ? searchString.hashCode() : 0);</span>
<span class="nc" id="L367">		return result;</span>
	}

	public EventContainsCondition clone()
		throws CloneNotSupportedException
	{
<span class="nc" id="L373">		return (EventContainsCondition) super.clone();</span>
	}

	public String toString()
	{
<span class="nc" id="L378">		StringBuilder result = new StringBuilder();</span>
<span class="nc" id="L379">		result.append(getDescription()).append(&quot;(&quot;);</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">		if(searchString != null)</span>
		{
<span class="nc" id="L382">			result.append(&quot;\&quot;&quot;);</span>
<span class="nc" id="L383">			result.append(searchString);</span>
<span class="nc" id="L384">			result.append(&quot;\&quot;&quot;);</span>
		}
		else
		{
<span class="nc" id="L388">			result.append(&quot;null&quot;);</span>
		}
<span class="nc" id="L390">		result.append(&quot;)&quot;);</span>
<span class="nc" id="L391">		return result.toString();</span>
	}

	public String getDescription()
	{
<span class="nc" id="L396">		return &quot;event.contains&quot;;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>