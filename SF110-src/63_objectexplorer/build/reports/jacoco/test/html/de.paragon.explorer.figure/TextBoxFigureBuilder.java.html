<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TextBoxFigureBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">63_objectexplorer</a> &gt; <a href="index.source.html" class="el_package">de.paragon.explorer.figure</a> &gt; <span class="el_source">TextBoxFigureBuilder.java</span></div><h1>TextBoxFigureBuilder.java</h1><pre class="source lang-java linenums">/**
 * [ObjectExplorer4J - Tool zur grafischen Darstellung von Objekten und ihren
 * Referenzen]
 * 
 * Copyright (C) [2009] [PARAGON Systemhaus GmbH]
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 **/
package de.paragon.explorer.figure;

import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Rectangle;

import org.apache.log4j.Logger;

import de.paragon.explorer.gui.Warning;
import de.paragon.explorer.model.AttributeModel;
import de.paragon.explorer.model.ObjectHeaderModel;
import de.paragon.explorer.model.ObjectModel;
import de.paragon.explorer.model.ObjectModelPart;
import de.paragon.explorer.util.LoggerFactory;
import de.paragon.explorer.util.ResourceBundlePurchaser;
import de.paragon.explorer.util.StandardEnumeration;

public class TextBoxFigureBuilder {
<span class="nc" id="L38">	private static final Logger			logger								= LoggerFactory.make();</span>
	private static final String			ERROR_WHILE_BUILDING_TEXTBOXFIGURE	= &quot;textboxfigurebuilder.error_while_building_textboxfigure&quot;;
	private static final int			NUMBER_6							= 6;
	private static final int			NUMBER_3							= 3;
	private static TextBoxFigureBuilder	singleton;

	public static TextBoxFigureBuilder getInstance() {
<span class="nc" id="L45">		return TextBoxFigureBuilder.getSingleton();</span>
	}

	private static TextBoxFigureBuilder getSingleton() {
<span class="nc bnc" id="L49" title="All 2 branches missed.">		if (TextBoxFigureBuilder.singleton == null) {</span>
<span class="nc" id="L50">			TextBoxFigureBuilder.setSingleton(new TextBoxFigureBuilder());</span>
		}
<span class="nc" id="L52">		return TextBoxFigureBuilder.singleton;</span>
	}

	private static void setSingleton(TextBoxFigureBuilder builder) {
<span class="nc" id="L56">		TextBoxFigureBuilder.singleton = builder;</span>
<span class="nc" id="L57">	}</span>

	public TextBoxFigureBuilder() {
<span class="nc" id="L60">		super();</span>
<span class="nc" id="L61">	}</span>

	// StandardEnumeration asEnumeration(Vector&lt;?&gt; aVector) {
	// return new StandardEnumerator(aVector);
	// }
	/**
	 * Kommentar: Diese Methode geht davon aus, dass die Verknuepfungen zwischen
	 * ListBoxFigure, ObjectModel, ObjectHeaderModel und der dazugehoerigen
	 * TextBoxFigure bereits existieren. Sie setzt den entsprechenden Text und
	 * bestimmt die Groesse der TextBoxFigure. Anschliessend verknuepft sie
	 * ListBoxFigure mit der TextBoxFigure.
	 */
	private void buildFigureForHeader(ObjectModel objModl) {
<span class="nc" id="L74">		ObjectHeaderModel headModl = objModl.getHeaderModel();</span>
<span class="nc" id="L75">		TextBoxFigure figure = (TextBoxFigure) headModl.getFigure();</span>
<span class="nc" id="L76">		figure.setText(headModl.getTitle());</span>
<span class="nc" id="L77">		figure.setFont(this.getFont(figure));</span>
<span class="nc" id="L78">		figure.setVisible();</span>
<span class="nc" id="L79">		figure.setBackground(objModl.getColorManager().getBackground(figure));</span>
<span class="nc" id="L80">		figure.setForeground(objModl.getColorManager().getForeground(figure));</span>
<span class="nc" id="L81">		java.awt.Rectangle box = this.computeDisplayBox(figure);</span>
<span class="nc" id="L82">		figure.getDisplayBox().getRectangle().setBounds(box);</span>
		try {
<span class="nc" id="L84">			objModl.getFigure().add(headModl.getFigure());</span>
		}
<span class="nc" id="L86">		catch (Exception ex) {</span>
<span class="nc" id="L87">			TextBoxFigureBuilder.logger.error(ResourceBundlePurchaser.getMessage(TextBoxFigureBuilder.ERROR_WHILE_BUILDING_TEXTBOXFIGURE), ex);</span>
<span class="nc" id="L88">			Warning.showWarning(ResourceBundlePurchaser.getMessage(TextBoxFigureBuilder.ERROR_WHILE_BUILDING_TEXTBOXFIGURE));</span>
<span class="nc" id="L89">		}</span>
<span class="nc" id="L90">	}</span>

	/**
	 * Kommentar: Diese Methode geht davon aus, dass die Verknuepfungen zwischen
	 * ListBoxFigure, ObjectModel, den AttributeModels und den dazugehoerigen
	 * TextBoxFigures bereits existieren. Sie setzt den entsprechenden Text und
	 * bestimmt die Groesse der TextBoxFigure. Anschliessend verknuepft sie
	 * ListBoxFigure mit der TextBoxFigure.
	 */
	private void buildFiguresForAttributes(ObjectModel objModl) {
<span class="nc" id="L100">		StandardEnumeration attrModls = objModl.getAttributeModels();</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		while (attrModls.hasMoreElements()) {</span>
<span class="nc" id="L102">			AttributeModel attrModl = (AttributeModel) attrModls.nextElement();</span>
<span class="nc" id="L103">			TextBoxFigure figure = (TextBoxFigure) attrModl.getFigure();</span>
<span class="nc" id="L104">			figure.setText(attrModl.getTitle());</span>
<span class="nc" id="L105">			figure.setBackground(objModl.getColorManager().getBackground(figure));</span>
<span class="nc" id="L106">			figure.setForeground(objModl.getColorManager().getForeground(figure));</span>
<span class="nc" id="L107">			figure.setFont(this.getFont(figure));</span>
			try {
<span class="nc" id="L109">				objModl.getFigure().add(attrModl.getFigure());</span>
			}
<span class="nc" id="L111">			catch (Exception ex) {</span>
<span class="nc" id="L112">				TextBoxFigureBuilder.logger.error(ResourceBundlePurchaser.getMessage(TextBoxFigureBuilder.ERROR_WHILE_BUILDING_TEXTBOXFIGURE), ex);</span>
<span class="nc" id="L113">				Warning.showWarning(ResourceBundlePurchaser.getMessage(TextBoxFigureBuilder.ERROR_WHILE_BUILDING_TEXTBOXFIGURE));</span>
<span class="nc" id="L114">			}</span>
<span class="nc" id="L115">		}</span>
<span class="nc" id="L116">	}</span>

	/**
	 * Kommentar: Diese Methode geht davon aus, dass die TextBoxFigures mit den
	 * jeweiligen Models verknuepft sind. Sie weist jeder TextBoxFigure einen
	 * String zu, bestimmt mit Hilfe der Graphics, die aus der ExplorerFigure
	 * abgefragt werden, die Groesse der TextBoxFigure und verknuepft sie
	 * anschliessend mit der ListBoxFigure. So ist sichergestellt, dass fuer
	 * Bauen und Zeichnen dieselben Graphics verwendet werden. Zwischen der
	 * Verknuepfung von HeaderFigure und den Attribute- Figures wird noch ein
	 * FilledRectangleFigure verknuepft.
	 */
	private void buildTextBoxFigures(ObjectModel objModl) {
<span class="nc" id="L129">		this.buildFigureForHeader(objModl);</span>
<span class="nc" id="L130">		this.getListBoxFigureBuilder().buildHeaderUnderline(objModl);</span>
<span class="nc" id="L131">		this.buildFiguresForAttributes(objModl);</span>
<span class="nc" id="L132">	}</span>

	public Rectangle computeDisplayBox(TextBoxFigure figure) {
		int x, y, width, height;
<span class="nc" id="L136">		java.awt.FontMetrics fm = this.getFontMetrics(figure);</span>
<span class="nc" id="L137">		String text = figure.getText();</span>
<span class="nc" id="L138">		x = 0;</span>
<span class="nc" id="L139">		y = 0;</span>
<span class="nc" id="L140">		height = fm.getLeading() + fm.getMaxAscent() + fm.getMaxDescent() + TextBoxFigureBuilder.NUMBER_3;</span>
<span class="nc" id="L141">		width = fm.stringWidth(text) + TextBoxFigureBuilder.NUMBER_6;</span>
<span class="nc" id="L142">		return new java.awt.Rectangle(x, y, width, height);</span>
	}

	/**
	 * Kommentar: Diese Methode geht davon aus, dass bereits fuer das
	 * ObjectModel eine passende Anzahl entsprechender Teilmodelle erzeugt
	 * wurde. Sie erzeugt fuer jede dieser Models eine TextBoxFigure und
	 * verknuepft sie mit den Teilmodellen. Danach wird jeder TextBoxFigure ein
	 * String zugewiesen. Anschliessend wird von jeder TextBoxFigur die Groesse
	 * bestimmt und in der gleichen Routine mit der ListBoxFigure verknuepft,
	 * von der die Graphics abgefragt wurden. Beim Hinzufuegen einer neuen Figur
	 * wird ja automatisch die Groesse der ListBoxFigure neu berechnet.
	 */
	protected void createTextBoxFigures(ObjectModel objModl) {
<span class="nc" id="L156">		TextBoxFigure teBoFi = new TextBoxFigure();</span>
<span class="nc" id="L157">		StandardEnumeration attrModls = objModl.getAttributeModels();</span>
<span class="nc" id="L158">		objModl.getHeaderModel().setFigure(teBoFi);</span>
<span class="nc" id="L159">		teBoFi.setModel(objModl.getHeaderModel());</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">		while (attrModls.hasMoreElements()) {</span>
<span class="nc" id="L161">			AttributeModel tempModl = (AttributeModel) attrModls.nextElement();</span>
<span class="nc" id="L162">			teBoFi = new TextBoxFigure();</span>
<span class="nc" id="L163">			teBoFi.setModel(tempModl);</span>
<span class="nc" id="L164">			tempModl.setFigure(teBoFi);</span>
<span class="nc" id="L165">		}</span>
<span class="nc" id="L166">		this.buildTextBoxFigures(objModl);</span>
<span class="nc" id="L167">	}</span>

	private java.awt.Graphics getGraphics(TextBoxFigure teBoFi) {
<span class="nc" id="L170">		ObjectModel objModl = ((ObjectModelPart) teBoFi.getModel()).getObjectModel();</span>
<span class="nc" id="L171">		ExplorerFigure explFig = (ExplorerFigure) objModl.getExplorerModel().getFigure();</span>
<span class="nc" id="L172">		return explFig.getFrame().getGraphics();</span>
	}

	private Font getFont(TextBoxFigure teBoFi) {
<span class="nc" id="L176">		Font f = null;</span>
<span class="nc" id="L177">		ObjectModel objModl = ((ObjectModelPart) teBoFi.getModel()).getObjectModel();</span>
<span class="nc" id="L178">		ExplorerFigure explFig = (ExplorerFigure) objModl.getExplorerModel().getFigure();</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">		if (explFig.getFrame() != null) {</span>
<span class="nc" id="L180">			f = explFig.getFrame().getGraphics().getFont();</span>
		}
		else {
<span class="nc" id="L183">			f = explFig.getPanel().getFont();</span>
		}
<span class="nc" id="L185">		return f;</span>
	}

	private FontMetrics getFontMetrics(TextBoxFigure teBoFi) {
<span class="nc" id="L189">		FontMetrics fm = null;</span>
<span class="nc" id="L190">		ObjectModel objModl = ((ObjectModelPart) teBoFi.getModel()).getObjectModel();</span>
<span class="nc" id="L191">		ExplorerFigure explFig = (ExplorerFigure) objModl.getExplorerModel().getFigure();</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">		if (explFig.getFrame() != null) {</span>
<span class="nc" id="L193">			fm = explFig.getFrame().getGraphics().getFontMetrics();</span>
		}
		else {
<span class="nc" id="L196">			fm = explFig.getPanel().getFontMetrics(explFig.getPanel().getFont());</span>
		}
<span class="nc" id="L198">		return fm;</span>
	}

	private ListBoxFigureBuilder getListBoxFigureBuilder() {
<span class="nc" id="L202">		return ListBoxFigureBuilder.getInstance();</span>
	}

	public void updateAttributes(ObjectModel objModl) {
<span class="nc" id="L206">		StandardEnumeration attrModls = objModl.getAttributeModels();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">		while (attrModls.hasMoreElements()) {</span>
<span class="nc" id="L208">			AttributeModel attrModl = (AttributeModel) attrModls.nextElement();</span>
<span class="nc" id="L209">			TextBoxFigure figure = (TextBoxFigure) attrModl.getFigure();</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">			if (objModl.getObjectViewManager().shouldBeVisible(attrModl)) {</span>
<span class="nc" id="L211">				figure.setVisible();</span>
			}
<span class="nc" id="L213">			figure.setText(attrModl.getTitle());</span>
<span class="nc" id="L214">			figure.setBackground(objModl.getColorManager().getBackground(figure));</span>
<span class="nc" id="L215">			figure.setForeground(objModl.getColorManager().getForeground(figure));</span>
<span class="nc" id="L216">			figure.setFont(this.getGraphics(figure).getFont());</span>
<span class="nc" id="L217">		}</span>
<span class="nc" id="L218">	}</span>

	public void updateHeader(ObjectModel objModl) {
<span class="nc" id="L221">		de.paragon.explorer.model.ObjectHeaderModel headModl = objModl.getHeaderModel();</span>
<span class="nc" id="L222">		TextBoxFigure figure = (TextBoxFigure) headModl.getFigure();</span>
<span class="nc" id="L223">		figure.setText(headModl.getTitle());</span>
<span class="nc" id="L224">		figure.setFont(this.getGraphics(figure).getFont());</span>
<span class="nc" id="L225">		figure.setVisible();</span>
<span class="nc" id="L226">		figure.setBackground(objModl.getColorManager().getBackground(figure));</span>
<span class="nc" id="L227">		figure.setForeground(objModl.getColorManager().getForeground(figure));</span>
<span class="nc" id="L228">		java.awt.Rectangle box = this.computeDisplayBox(figure);</span>
<span class="nc" id="L229">		figure.getDisplayBox().getRectangle().setBounds(box);</span>
<span class="nc" id="L230">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>