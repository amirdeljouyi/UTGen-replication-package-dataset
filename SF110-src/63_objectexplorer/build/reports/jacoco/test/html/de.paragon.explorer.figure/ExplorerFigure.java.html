<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExplorerFigure.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">63_objectexplorer</a> &gt; <a href="index.source.html" class="el_package">de.paragon.explorer.figure</a> &gt; <span class="el_source">ExplorerFigure.java</span></div><h1>ExplorerFigure.java</h1><pre class="source lang-java linenums">/**
 * [ObjectExplorer4J - Tool zur grafischen Darstellung von Objekten und ihren
 * Referenzen]
 * 
 * Copyright (C) [2009] [PARAGON Systemhaus GmbH]
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 **/
package de.paragon.explorer.figure;

import java.awt.Dimension;
import java.awt.FontMetrics;
import java.awt.Point;
import java.awt.Rectangle;

import org.apache.log4j.Logger;

import de.paragon.explorer.Explorer;
import de.paragon.explorer.event.DrawEvent;
import de.paragon.explorer.event.DrawListener;
import de.paragon.explorer.event.FocusManager;
import de.paragon.explorer.gui.ExplorerDrawingPanel;
import de.paragon.explorer.gui.ExplorerFrame;
import de.paragon.explorer.gui.Warning;
import de.paragon.explorer.model.ExplorerModel;
import de.paragon.explorer.model.Model;
import de.paragon.explorer.util.LoggerFactory;
import de.paragon.explorer.util.ResourceBundlePurchaser;
import de.paragon.explorer.util.StandardEnumeration;

/**
 * Klassenbeschreibung
 * 
 * Instanzvariablen: frame: Beziehung zum Frame, auf dem die Figur dargestellt
 * wird. model: Verknuepfung mit dem ExplorerModel, das fuer den Inhalt der
 * ExplorerFigure zustaendig ist.
 */
public class ExplorerFigure extends StandardCompositeFigure implements DrawListener {
	private static final int		NUMBER_15										= 15;
	private static final String		EXPLORERFIGURE_ERROR_FINDING_HIT_FIGURE			= &quot;explorerfigure.error_finding_hit_figure &quot;;
	private static final String		EXPLORERFIGURE_ERROR_DRAWING_EXPLORER_FIGURE	= &quot;explorerfigure.error_drawing_explorer_figure&quot;;
	private static final String		EXPLORERFIGURE_ERROR_CALCULATING_GRAPHIC_SIZE	= &quot;explorerfigure.error_calculating_graphic_size&quot;;
<span class="fc" id="L54">	private static final Logger		logger											= LoggerFactory.make();</span>
	private ExplorerDrawingPanel	panel;
	private Model					model;
	private ExplorerFrame			frame;
	private Dimension				graphicSize;
	private FocusManager			focusManager;

	public ExplorerFigure() {
<span class="fc" id="L62">		super();</span>
<span class="fc" id="L63">	}</span>

	private void calculateGraphicSize() {
<span class="nc" id="L66">		StandardEnumeration figures = null;</span>
<span class="nc" id="L67">		this.getGraphicSize().setSize(0, 0);</span>
		try {
<span class="nc" id="L69">			figures = this.getFigures();</span>
		}
<span class="nc" id="L71">		catch (Exception ex) {</span>
<span class="nc" id="L72">			ExplorerFigure.logger.error(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_CALCULATING_GRAPHIC_SIZE), ex);</span>
<span class="nc" id="L73">			Warning.showWarning(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_CALCULATING_GRAPHIC_SIZE));</span>
<span class="nc" id="L74">		}</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">		if (figures != null) {</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">			while (figures.hasMoreElements()) {</span>
				try {
<span class="nc" id="L78">					this.calculateGraphicSize(((Figure) figures.nextElement()).getBounds());</span>
				}
<span class="nc" id="L80">				catch (Exception ex) {</span>
<span class="nc" id="L81">					ExplorerFigure.logger.error(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_CALCULATING_GRAPHIC_SIZE), ex);</span>
<span class="nc" id="L82">					Warning.showWarning(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_CALCULATING_GRAPHIC_SIZE));</span>
<span class="nc" id="L83">				}</span>
			}
		}
<span class="nc" id="L86">	}</span>

	private void calculateGraphicSize(Rectangle rec) {
		double xpos;
		double ypos;
<span class="nc" id="L91">		xpos = rec.getX() + rec.getWidth() + ExplorerFigure.NUMBER_15;</span>
<span class="nc" id="L92">		ypos = rec.getY() + rec.getHeight() + ExplorerFigure.NUMBER_15;</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (this.getGraphicSize().getWidth() &gt; xpos) {</span>
<span class="nc" id="L94">			xpos = this.getGraphicSize().getWidth();</span>
		}
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (this.getGraphicSize().getHeight() &gt; ypos) {</span>
<span class="nc" id="L97">			ypos = this.getGraphicSize().getHeight();</span>
		}
<span class="nc" id="L99">		this.getGraphicSize().setSize((int) xpos, (int) ypos);</span>
<span class="nc" id="L100">	}</span>

	/**
	 * Kommentar: Das Loeschen einer ExplorerFigure funktioniert so: Zunaechst
	 * wird die Groesse des StandardDrawingFrames bestimmt. Dieses Rechteck wird
	 * dann geloescht.
	 */
	public void clear() {
<span class="nc" id="L108">		this.setDisplayBoxIsValid(false);</span>
		// Dimension size = this.getPanel().getSize();
		// this.getGraphics().clearRect(0, 0, size.width, size.height);
<span class="nc" id="L111">	}</span>

	public void draw(DrawEvent event) {
		try {
<span class="nc" id="L115">			super.draw(event.getGraphics());</span>
		}
<span class="nc" id="L117">		catch (Exception ex) {</span>
<span class="nc" id="L118">			ExplorerFigure.logger.error(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_DRAWING_EXPLORER_FIGURE), ex);</span>
<span class="nc" id="L119">			Warning.showWarning(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_DRAWING_EXPLORER_FIGURE));</span>
<span class="nc" id="L120">		}</span>
<span class="nc" id="L121">	}</span>

	private Dimension getActualSize() {
<span class="nc" id="L124">		this.calculateGraphicSize();</span>
<span class="nc" id="L125">		return this.getGraphicSize();</span>
	}

	public FocusManager getFocusManager() {
<span class="nc bnc" id="L129" title="All 2 branches missed.">		if (this.focusManager == null) {</span>
<span class="nc" id="L130">			this.setFocusManager(new FocusManager(this));</span>
		}
<span class="nc" id="L132">		return this.focusManager;</span>
	}

	public FontMetrics getFontMetrics() {
<span class="nc" id="L136">		return this.getFrame().getGraphics().getFontMetrics();</span>
	}

	public ExplorerFrame getFrame() {
<span class="nc bnc" id="L140" title="All 2 branches missed.">		if (this.frame == null) {</span>
<span class="nc" id="L141">			this.setFrame(new ExplorerFrame());</span>
<span class="nc" id="L142">			this.getFrame().setFocusable(true);</span>
<span class="nc" id="L143">			this.getFrame().setName(((ExplorerModel) this.getModel()).getName());</span>
		}
<span class="nc" id="L145">		return this.frame;</span>
	}

	private Dimension getGraphicSize() {
<span class="nc bnc" id="L149" title="All 2 branches missed.">		if (this.graphicSize == null) {</span>
<span class="nc" id="L150">			this.setGraphicSize(new Dimension(0, 0));</span>
		}
<span class="nc" id="L152">		return this.graphicSize;</span>
	}

	/**
	 * Kommentar: Das Loeschen einer ExplorerFigure funktioniert so: Zunaechst
	 * wird die Groesse des StandardDrawingFrames bestimmt. Dieses Rechteck wird
	 * dann geloescht.
	 * 
	 * @return Figure
	 */
	public Figure getListBoxFigureForPoint(Point pt) {
<span class="nc" id="L163">		StandardEnumeration explFigParts = null;</span>
		try {
<span class="nc" id="L165">			explFigParts = this.getFigures();</span>
		}
<span class="nc" id="L167">		catch (Exception ex) {</span>
<span class="nc" id="L168">			ExplorerFigure.logger.error(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_FINDING_HIT_FIGURE), ex);</span>
<span class="nc" id="L169">			Warning.showWarning(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_FINDING_HIT_FIGURE));</span>
<span class="nc" id="L170">		}</span>
<span class="nc" id="L171">		Figure tempFig = null;</span>
<span class="nc" id="L172">		Figure hitFig = null;</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">		if (explFigParts != null) {</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">			while (explFigParts.hasMoreElements()) {</span>
<span class="nc" id="L175">				tempFig = (Figure) explFigParts.nextElement();</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">				if (tempFig.containsPoint(pt.x, pt.y)) {</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">					if (tempFig instanceof ListBoxFigure) {</span>
<span class="nc" id="L178">						hitFig = tempFig;</span>
					}
				}
			}
		}
<span class="nc" id="L183">		return hitFig;</span>
	}

	public Model getModel() {
<span class="nc" id="L187">		return this.model;</span>
	}

	public ExplorerDrawingPanel getPanel() {
<span class="nc bnc" id="L191" title="All 2 branches missed.">		if (this.panel == null) {</span>
<span class="nc" id="L192">			this.setPanel(Explorer.getPanel());</span>
<span class="nc" id="L193">			this.panel.addDrawListener(this);</span>
<span class="nc" id="L194">			this.getFrame().getScrollPane().setViewportView(this.getPanel());</span>
		}
<span class="nc" id="L196">		return this.panel;</span>
	}

	/**
	 * Kommentar: Diese Methode geht folgendermassen vor: Sie sucht sich alle
	 * getroffenen ListBoxFigures raus. Sie durchsucht jede diese Figuren nach
	 * einer getroffenen Teilfigur. Jedes Mal, wenn sie fuendig geworden ist,
	 * ueberschreibt sie die Variable fuer die Figur, die sie am Ende
	 * zurueckgibt. Da die Figuren in derselben Figur durchsucht werden, wie sie
	 * auch gezeichnet werden, gibt sie die oberste, getroffene Figur zurueck.
	 */
	public Figure getTextBoxFigureForPoint(Point pt) {
<span class="nc" id="L208">		StandardEnumeration explFigParts = null;</span>
		try {
<span class="nc" id="L210">			explFigParts = this.getFigures();</span>
		}
<span class="nc" id="L212">		catch (Exception ex) {</span>
<span class="nc" id="L213">			ExplorerFigure.logger.error(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_FINDING_HIT_FIGURE), ex);</span>
<span class="nc" id="L214">			Warning.showWarning(ResourceBundlePurchaser.getMessage(ExplorerFigure.EXPLORERFIGURE_ERROR_FINDING_HIT_FIGURE));</span>
<span class="nc" id="L215">		}</span>
<span class="nc" id="L216">		Figure tempFig = null;</span>
<span class="nc" id="L217">		Figure hitFig = null;</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">		if (explFigParts != null) {</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">			while (explFigParts.hasMoreElements()) {</span>
<span class="nc" id="L220">				tempFig = (Figure) explFigParts.nextElement();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">				if (tempFig.containsPoint(pt.x, pt.y)) {</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">					if (tempFig instanceof ListBoxFigure) {</span>
<span class="nc" id="L223">						hitFig = ((ListBoxFigure) tempFig).getTextBoxFigureForPoint(pt);</span>
					}
				}
			}
		}
<span class="nc" id="L228">		return hitFig;</span>
	}

	public void repaint() {
<span class="nc" id="L232">		this.getPanel().setPreferredSize(this.getActualSize());</span>
<span class="nc" id="L233">		this.getPanel().revalidate();</span>
<span class="nc" id="L234">		this.getPanel().repaint();</span>
<span class="nc" id="L235">	}</span>

	private void setFocusManager(de.paragon.explorer.event.FocusManager newFocusManager) {
<span class="nc" id="L238">		this.focusManager = newFocusManager;</span>
<span class="nc" id="L239">	}</span>

	public void setFrame(ExplorerFrame newFrame) {
<span class="nc" id="L242">		this.frame = newFrame;</span>
<span class="nc" id="L243">	}</span>

	private void setGraphicSize(Dimension newGraphicSize) {
<span class="nc" id="L246">		this.graphicSize = newGraphicSize;</span>
<span class="nc" id="L247">	}</span>

	public void setModel(Model modl) {
<span class="nc" id="L250">		this.model = modl;</span>
<span class="nc" id="L251">	}</span>

	public void setPanel(ExplorerDrawingPanel newPanel) {
<span class="nc" id="L254">		this.panel = newPanel;</span>
<span class="nc" id="L255">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>