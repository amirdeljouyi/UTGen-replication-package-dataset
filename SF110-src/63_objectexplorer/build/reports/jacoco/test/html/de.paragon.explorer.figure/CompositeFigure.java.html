<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CompositeFigure.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">63_objectexplorer</a> &gt; <a href="index.source.html" class="el_package">de.paragon.explorer.figure</a> &gt; <span class="el_source">CompositeFigure.java</span></div><h1>CompositeFigure.java</h1><pre class="source lang-java linenums">/**
 * [ObjectExplorer4J - Tool zur grafischen Darstellung von Objekten und ihren
 * Referenzen]
 * 
 * Copyright (C) [2009] [PARAGON Systemhaus GmbH]
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 **/
package de.paragon.explorer.figure;

import java.awt.Graphics;

import de.paragon.explorer.excp.FigureEventException;
import de.paragon.explorer.excp.FigureException;
import de.paragon.explorer.gui.DisplayBox;
import de.paragon.explorer.util.ResourceBundlePurchaser;
import de.paragon.explorer.util.StandardEnumeration;

/**
 * Kommentar: CompositeFigure ist die abstrakte Basisklasse aller
 * zusammengesetzten Figuren. Sie enthaelt Default-Implementationen von
 * Figurenmanagement-Funktionen, sowie von draw() und moveBy().
 * 
 * Die Verwaltung der Figuren erfolgt in einem Figurestore, das Ein- und
 * Austragen als FigureChangeListener bei den Figuren erfolgt in dieser Klasse.
 * Im figureStore werden die Teilfiguren als Typ Figure (Interface) gehalten.
 */
public abstract class CompositeFigure extends AbstractFigure {
	private static final String	SETTING_BOUNDS	= &quot;compositefigure.setting_bounds&quot;;
	private FigureStore			figureStore;

	// C.L.
<span class="fc" id="L44">	protected CompositeFigure() {</span>
<span class="fc" id="L45">		this.figureStore = new FigureStore();</span>
<span class="fc" id="L46">	}</span>

	// E.Gamma: konkrete Implementation soll erfolgen
	// C.L.: und zwar durch Delegation an FigureStore
	// ausserdem traegt sich die CompositeFigure bei Figure als
	// FigureChangeListener ein, damit durch die Figure ausgeloeste
	// Events (evtl. ueber eine Kette ineinandergeschachtelter
	// CompositeFigure-Objekte) beiDrawingView landen.
	@Override
	public void add(Figure figure) throws FigureEventException {
<span class="nc" id="L56">		this.figureStore.add(figure);</span>
		// figure.addChangeListener(this);
<span class="nc" id="L58">		figure.setParent(this);</span>
		// this.hasChanged();
		/*
		 * Kommentar von CHE: Soweit ich das ermittelt habe, fuehrt hasChanged
		 * zu keiner Aktion
		 */
<span class="nc" id="L64">	}</span>

	// E.Gamma: konkrete Implementation soll erfolgen
	// C.L.: benutzt this.add()
	@Override
	public void addAll(StandardEnumeration f) throws FigureException {
<span class="nc bnc" id="L70" title="All 2 branches missed.">		while (f.hasMoreElements()) {</span>
<span class="nc" id="L71">			this.add((Figure) f.nextElement());</span>
		}
<span class="nc" id="L73">	}</span>

	// 80% C.L.; analoge Implementation zu draw()
	@Override
	public void basicMoveBy(int x, int y) throws FigureException {
<span class="nc" id="L78">		de.paragon.explorer.util.StandardEnumeration f = this.getFigures();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">		while (f.hasMoreElements()) {</span>
<span class="nc" id="L80">			((Figure) f.nextElement()).moveBy(x, y);</span>
		}
<span class="nc" id="L82">	}</span>

	// 90% C.L.
	// E.Gamma fordert findFigure fuer das Interface Drawing
	@Override
	public boolean containsFigure(Figure figure) {
<span class="nc" id="L88">		return this.figureStore.isInStore(figure);</span>
	}

	// identisch zum Beispielcode von E.Gamma
	// (bis auf figure-&gt;getFigures() und Exceptions)
	@Override
	public void draw(Graphics g) throws FigureException {
<span class="nc" id="L95">		de.paragon.explorer.util.StandardEnumeration f = this.getFigures();</span>
<span class="nc bnc" id="L96" title="All 2 branches missed.">		while (f.hasMoreElements()) {</span>
<span class="nc" id="L97">			((Figure) (f.nextElement())).draw(g);</span>
		}
<span class="nc" id="L99">	}</span>

	// Differenzierung: C.L.
	// Idee des Mechnismus: E.Gamma (vgl. figureInvalidated)
	//
	// gibt Event an die eigenen Listener weiter
	// belaesst Source beim Child
	@Override
	public void figureAppeared(FigureChangeEvent e) throws FigureEventException {
<span class="nc" id="L108">		this.getChangeManager().processEvent(e);</span>
<span class="nc" id="L109">	}</span>

	// E.Gamma: die Teilfiguren (Child-Objekte) reichen Events an die
	// entsprechende CompositeFigure weiter
	// bis die CompositeFigure, die die Drawing ist, die DrawingView haelt,
	// diese benachrichtigt.
	//
	// leaf-&gt;CompositeFigure-&gt;CompositeFigure-&gt;...-&gt;CompositeFigure(=StandardDrawingView.drawing)-&gt;DrawingView
	//
	// diese Methode benachrichtigt die Listener einer CompositeFigure duch
	// Weiterreichen des
	// von einem Child empfangenen Events.
	//
	@Override
	public void figureInvalidated(FigureChangeEvent e) throws FigureEventException {
<span class="nc" id="L124">		this.getChangeManager().processEvent(e);</span>
<span class="nc" id="L125">	}</span>

	// E.Gamma schlaegt vor, dass CompositeFigure kein Layout definiert,
	// getDisplayBox() (E.Gamma DisplayBox()) also nicht implementiert wird.
	@Override
	public abstract DisplayBox getDisplayBox();

	// E.Gamma: konkrete Implementation soll erfolgen (von figures())
	// C.L.: und zwar durch Delegation an FigureStore
	@Override
	public StandardEnumeration getFigures() throws FigureException {
<span class="nc" id="L136">		return this.figureStore.getFigures();</span>
	}

	// E.Gamma: konkrete Implementation soll erfolgen
	// C.L.: und zwar durch Delegation an FigureStore
	@Override
	public void remove(Figure figure) throws FigureException {
<span class="nc" id="L143">		this.willChange();</span>
<span class="nc" id="L144">		figure.removeChangeListener(this);</span>
<span class="nc" id="L145">		figure.setParent(null);</span>
<span class="nc" id="L146">		this.figureStore.remove(figure);</span>
<span class="nc" id="L147">	}</span>

	// C.L.
	//
	// holt sich zunaechst die Figuren, um sich als Listener austragen zu
	// koennen
	@Override
	public void removeAll() throws FigureException {
<span class="nc" id="L155">		de.paragon.explorer.util.StandardEnumeration f = this.figureStore.getFigures();</span>
<span class="nc" id="L156">		Figure current = null;</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">		while (f.hasMoreElements()) {</span>
<span class="nc" id="L158">			current = (Figure) f.nextElement();</span>
<span class="nc" id="L159">			this.remove(current);</span>
		}
<span class="nc" id="L161">		this.figureStore = new FigureStore();</span>
<span class="nc" id="L162">	}</span>

	@Override
	public void setBounds(java.awt.Rectangle r) throws FigureException {
<span class="nc" id="L166">		throw new FigureException(ResourceBundlePurchaser.getMessage(CompositeFigure.SETTING_BOUNDS));</span>
	}

	// C.L.
	@Override
	public void setFigures(StandardEnumeration figures) throws FigureException {
<span class="nc" id="L172">		this.removeAll();</span>
<span class="nc" id="L173">		this.addAll(figures);</span>
<span class="nc" id="L174">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>