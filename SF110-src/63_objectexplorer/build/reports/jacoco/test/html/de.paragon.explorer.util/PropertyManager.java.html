<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PropertyManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">63_objectexplorer</a> &gt; <a href="index.source.html" class="el_package">de.paragon.explorer.util</a> &gt; <span class="el_source">PropertyManager.java</span></div><h1>PropertyManager.java</h1><pre class="source lang-java linenums">/**
 * [ObjectExplorer4J - Tool zur grafischen Darstellung von Objekten und ihren
 * Referenzen]
 * 
 * Copyright (C) [2009] [PARAGON Systemhaus GmbH]
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 **/
package de.paragon.explorer.util;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Properties;

import org.apache.log4j.Logger;

/**
 * 
 * @author Stefan Jockenhï¿½vel
 * 
 */
public final class PropertyManager {
	private static final String		EXPLORER_INI								= &quot;explorer.ini&quot;;
<span class="nc" id="L39">	private static PropertyManager	instance									= null;</span>
<span class="nc" id="L40">	private static final Logger		logger										= LoggerFactory.make();</span>
<span class="nc" id="L41">	private static Properties		properties									= null;</span>
	private static final String		PROPERTY_HIDE_NULL_ATTRIBUTES				= &quot;hideNullAttributes&quot;;
	private static final String		PROPERTY_HIDE_STATIC_ATTRIBUTES				= &quot;hideStaticAttributes&quot;;
	private static final String		PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES			= &quot;hideUnexploredAttributes&quot;;
	private static final String		PROPERTYMANAGER_ERROR_FILE_NOT_FOUND		= &quot;propertymanager.error_file_not_found&quot;;
	private static final String		PROPERTYMANAGER_ERROR_FILE_NOT_SAVED		= &quot;propertymanager.error_file_not_saved&quot;;
	private static final String		PROPERTYMANAGER_ERROR_WHILE_CLOSE			= &quot;propertymanager.error_while_close&quot;;
	private static final String		PROPERTYMANAGER_ERROR_WHILE_READING			= &quot;propertymanager.error_while_reading&quot;;
	private static final String		PROPERTYMANAGER_ERROR_WITH_MEMORY_LOCATION	= &quot;propertymanager.error_with_memory_location&quot;;
	private static final String		PROPERTYMANAGER_INFO_FILE_APPLIED			= &quot;propertymanager.info_file_applied&quot;;
	private static final String		PROPERTYMANAGER_INFO_FILE_NOT_FOUND			= &quot;propertymanager.info_file_not_found&quot;;
	private static final String		PROPERTYMANAGER_INFO_FILE_UPDATED			= &quot;propertymanager.info_file_updated&quot;;
	private static final String		PROPERTYMANAGER_INFO_FILE_WAS_UP_TO_DATE	= &quot;propertymanager.info_file_was_up_to_date&quot;;
	private static final String		PROPERTYMANAGER_INFO_SUCCESFUL_LOADING		= &quot;propertymanager.info_succesful_loading&quot;;
	private static final String		TEXT_PROPERTIES_INITIALIZE					= &quot;/* properties initialize */&quot;;
	private static final String		TEXT_PROPERTIES_UPDATET						= &quot;/* properties updatet */&quot;;
	private static final String		TRUE_AS_STRING								= &quot;true&quot;;
	private static final String		USER_HOME									= &quot;user.home&quot;;
<span class="nc" id="L59">	private static final Integer	NUMBER_OF_PROPERTIES						= 3;</span>

	public static PropertyManager getInstance() {
<span class="nc bnc" id="L62" title="All 2 branches missed.">		if ((PropertyManager.instance == null)) {</span>
<span class="nc" id="L63">			PropertyManager.instance = new PropertyManager();</span>
		}
<span class="nc" id="L65">		return PropertyManager.instance;</span>
	}

<span class="nc" id="L68">	private PropertyManager() {</span>
<span class="nc" id="L69">		String dataDir = System.getProperty(PropertyManager.USER_HOME);</span>
<span class="nc" id="L70">		String iniFile = null;</span>
		//
<span class="nc" id="L72">		iniFile = this.getCompletePath4IniFile();</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">		if (iniFile != null) {</span>
<span class="nc" id="L74">			PropertyManager.properties = new Properties();</span>
<span class="nc" id="L75">			FileInputStream fis = null;</span>
			try {
<span class="nc" id="L77">				fis = new FileInputStream(iniFile);</span>
<span class="nc" id="L78">				PropertyManager.properties.load(fis);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">				if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L80">					PropertyManager.properties.list(System.out);</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">					if (PropertyManager.properties.size() != PropertyManager.NUMBER_OF_PROPERTIES) {</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">						if (!PropertyManager.properties.containsKey(PropertyManager.PROPERTY_HIDE_NULL_ATTRIBUTES)) {</span>
<span class="nc" id="L83">							PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_NULL_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
						}
<span class="nc bnc" id="L85" title="All 2 branches missed.">						if (!PropertyManager.properties.containsKey(PropertyManager.PROPERTY_HIDE_STATIC_ATTRIBUTES)) {</span>
<span class="nc" id="L86">							PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_STATIC_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
						}
<span class="nc bnc" id="L88" title="All 2 branches missed.">						if (!PropertyManager.properties.containsKey(PropertyManager.PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES)) {</span>
<span class="nc" id="L89">							PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
						}
<span class="nc" id="L91">						this.saveIniFile(iniFile, PropertyManager.TEXT_PROPERTIES_INITIALIZE);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">						if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L93">							PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_UPDATED,</span>
									PropertyManager.EXPLORER_INI));
						}
					}
<span class="nc" id="L97">					PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_SUCCESFUL_LOADING, iniFile));</span>
				}
			}
<span class="nc" id="L100">			catch (FileNotFoundException ex) {</span>
<span class="nc" id="L101">				this.createAndSaveNewIniFile(iniFile, dataDir);</span>
			}
<span class="nc" id="L103">			catch (IOException ex) {</span>
<span class="nc" id="L104">				PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WHILE_READING, iniFile), ex);</span>
<span class="nc" id="L105">			}</span>
			try {
<span class="nc bnc" id="L107" title="All 2 branches missed.">				if (fis != null) {</span>
<span class="nc" id="L108">					fis.close();</span>
				}
			}
<span class="nc" id="L111">			catch (IOException ex) {</span>
<span class="nc" id="L112">				PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WHILE_CLOSE, iniFile), ex);</span>
<span class="nc" id="L113">			}</span>
<span class="nc" id="L114">		}</span>
		else {
<span class="nc" id="L116">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WITH_MEMORY_LOCATION, PropertyManager.USER_HOME));</span>
		}
<span class="nc" id="L118">	}</span>

	private void createAndSaveNewIniFile(String iniFile, String dataDir) {
<span class="nc bnc" id="L121" title="All 2 branches missed.">		if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L122">			PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_NOT_FOUND, PropertyManager.EXPLORER_INI, dataDir));</span>
		}
		// neue Ini-Datei anlegen
<span class="nc" id="L125">		FileWriter fw = null;</span>
		try {
<span class="nc" id="L127">			fw = new FileWriter(iniFile);</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">			if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L129">				PropertyManager.logger.debug(ResourceBundlePurchaser</span>
<span class="nc" id="L130">						.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_APPLIED, PropertyManager.EXPLORER_INI, dataDir));</span>
			}
			// Default-Properties anlegen
<span class="nc" id="L133">			PropertyManager.properties = new Properties();</span>
<span class="nc" id="L134">			PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_NULL_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
<span class="nc" id="L135">			PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_STATIC_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
<span class="nc" id="L136">			PropertyManager.properties.put(PropertyManager.PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES, PropertyManager.TRUE_AS_STRING);</span>
<span class="nc" id="L137">			this.saveIniFile(iniFile, PropertyManager.TEXT_PROPERTIES_INITIALIZE);</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">			if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L139">				PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_UPDATED, PropertyManager.EXPLORER_INI));</span>
			}
		}
<span class="nc" id="L142">		catch (IOException ex) {</span>
<span class="nc" id="L143">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_FILE_NOT_SAVED, PropertyManager.EXPLORER_INI), ex);</span>
<span class="nc" id="L144">		}</span>
		try {
<span class="nc bnc" id="L146" title="All 2 branches missed.">			if (fw != null) {</span>
<span class="nc" id="L147">				fw.close();</span>
			}
		}
<span class="nc" id="L150">		catch (IOException ex) {</span>
<span class="nc" id="L151">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WHILE_CLOSE, PropertyManager.EXPLORER_INI), ex);</span>
<span class="nc" id="L152">		}</span>
<span class="nc" id="L153">	}</span>

	private String getCompletePath4IniFile() {
<span class="nc" id="L156">		String dataDir = System.getProperty(PropertyManager.USER_HOME);</span>
<span class="nc" id="L157">		String iniFile = PropertyManager.EXPLORER_INI;</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">		if (dataDir != null) {</span>
<span class="nc bnc" id="L159" title="All 2 branches missed.">			if (!dataDir.endsWith(File.separator)) {</span>
<span class="nc" id="L160">				dataDir = dataDir + File.separator;</span>
			}
<span class="nc" id="L162">			return dataDir + iniFile;</span>
		}
<span class="nc" id="L164">		return null;</span>
	}

	public boolean getHideNullAttribut() {
<span class="nc" id="L168">		String returnValue = PropertyManager.properties.getProperty(PropertyManager.PROPERTY_HIDE_NULL_ATTRIBUTES);</span>
<span class="nc bnc" id="L169" title="All 4 branches missed.">		if ((returnValue != null) &amp;&amp; returnValue.equals(PropertyManager.TRUE_AS_STRING)) {</span>
<span class="nc" id="L170">			return true;</span>
		}
<span class="nc" id="L172">		return false;</span>
	}

	public boolean getHideStaticAttribut() {
<span class="nc" id="L176">		String returnValue = PropertyManager.properties.getProperty(PropertyManager.PROPERTY_HIDE_STATIC_ATTRIBUTES);</span>
<span class="nc bnc" id="L177" title="All 4 branches missed.">		if ((returnValue != null) &amp;&amp; returnValue.equals(PropertyManager.TRUE_AS_STRING)) {</span>
<span class="nc" id="L178">			return true;</span>
		}
<span class="nc" id="L180">		return false;</span>
	}

	public boolean getHideUnexploredAttribut() {
<span class="nc" id="L184">		String returnValue = PropertyManager.properties.getProperty(PropertyManager.PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES);</span>
<span class="nc bnc" id="L185" title="All 4 branches missed.">		if ((returnValue != null) &amp;&amp; returnValue.equals(PropertyManager.TRUE_AS_STRING)) {</span>
<span class="nc" id="L186">			return true;</span>
		}
<span class="nc" id="L188">		return false;</span>
	}

	private void saveIniFile(String iniFile, String comment) {
<span class="nc" id="L192">		FileOutputStream out = null;</span>
		try {
<span class="nc" id="L194">			out = new FileOutputStream(iniFile);</span>
		}
<span class="nc" id="L196">		catch (FileNotFoundException ex) {</span>
<span class="nc" id="L197">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_FILE_NOT_FOUND, PropertyManager.EXPLORER_INI, ex));</span>
<span class="nc" id="L198">		}</span>
		try {
<span class="nc" id="L200">			PropertyManager.properties.store(out, comment);</span>
		}
<span class="nc" id="L202">		catch (IOException ex) {</span>
<span class="nc" id="L203">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_FILE_NOT_SAVED, PropertyManager.EXPLORER_INI), ex);</span>
<span class="nc" id="L204">		}</span>
		try {
<span class="nc bnc" id="L206" title="All 2 branches missed.">			if (out != null) {</span>
<span class="nc" id="L207">				out.close();</span>
			}
		}
<span class="nc" id="L210">		catch (IOException ex) {</span>
<span class="nc" id="L211">			PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WHILE_CLOSE, PropertyManager.EXPLORER_INI), ex);</span>
<span class="nc" id="L212">		}</span>
<span class="nc" id="L213">	}</span>

	public void setHideAttributes(boolean newValueHideNull, boolean newValueHideStatic, boolean newValueHideUnexplored) {
<span class="nc" id="L216">		boolean save = false;</span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">		if (!Boolean.valueOf(this.getHideNullAttribut()).equals(newValueHideNull)) {</span>
<span class="nc" id="L218">			PropertyManager.properties.setProperty(PropertyManager.PROPERTY_HIDE_NULL_ATTRIBUTES, Boolean.valueOf(newValueHideNull).toString());</span>
<span class="nc" id="L219">			save = true;</span>
		}
<span class="nc bnc" id="L221" title="All 4 branches missed.">		if (!save &amp;&amp; !Boolean.valueOf(this.getHideStaticAttribut()).equals(newValueHideStatic)) {</span>
<span class="nc" id="L222">			PropertyManager.properties.setProperty(PropertyManager.PROPERTY_HIDE_STATIC_ATTRIBUTES, Boolean.valueOf(newValueHideStatic).toString());</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">			if (!save) {</span>
<span class="nc" id="L224">				save = true;</span>
			}
		}
<span class="nc bnc" id="L227" title="All 4 branches missed.">		if (!save &amp;&amp; !Boolean.valueOf(this.getHideUnexploredAttribut()).equals(newValueHideUnexplored)) {</span>
<span class="nc" id="L228">			PropertyManager.properties.setProperty(PropertyManager.PROPERTY_HIDE_UNEXPLORED_ATTRIBUTES, Boolean.valueOf(newValueHideUnexplored).toString());</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">			if (!save) {</span>
<span class="nc" id="L230">				save = true;</span>
			}
		}
<span class="nc bnc" id="L233" title="All 2 branches missed.">		if (save) {</span>
			// in die Ini-Datei schreiben
<span class="nc" id="L235">			String iniFile = this.getCompletePath4IniFile();</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">			if (iniFile != null) {</span>
<span class="nc" id="L237">				this.saveIniFile(iniFile, PropertyManager.TEXT_PROPERTIES_UPDATET);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">				if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L239">					PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_UPDATED, PropertyManager.EXPLORER_INI));</span>
				}
			}
			else {
<span class="nc" id="L243">				PropertyManager.logger.error(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_ERROR_WITH_MEMORY_LOCATION, PropertyManager.USER_HOME));</span>
			}
<span class="nc" id="L245">		}</span>
		else {
<span class="nc bnc" id="L247" title="All 2 branches missed.">			if (PropertyManager.logger.isDebugEnabled()) {</span>
<span class="nc" id="L248">				PropertyManager.logger.debug(ResourceBundlePurchaser.getSubstitutedMessage(PropertyManager.PROPERTYMANAGER_INFO_FILE_WAS_UP_TO_DATE, PropertyManager.EXPLORER_INI));</span>
			}
		}
<span class="nc" id="L251">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>