<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ExplorerFrameEventConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">63_objectexplorer</a> &gt; <a href="index.source.html" class="el_package">de.paragon.explorer.event</a> &gt; <span class="el_source">ExplorerFrameEventConverter.java</span></div><h1>ExplorerFrameEventConverter.java</h1><pre class="source lang-java linenums">/**
 * [ObjectExplorer4J - Tool zur grafischen Darstellung von Objekten und ihren
 * Referenzen]
 * 
 * Copyright (C) [2009] [PARAGON Systemhaus GmbH]
 * 
 * This program is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software
 * Foundation; either version 3 of the License, or (at your option) any later
 * version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
 * details.
 * 
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, see &lt;http://www.gnu.org/licenses/&gt;.
 **/
package de.paragon.explorer.event;

import java.awt.CheckboxMenuItem;
import java.awt.Component;
import java.awt.Cursor;
import java.awt.KeyboardFocusManager;
import java.awt.MenuItem;
import java.awt.Point;
import java.awt.PopupMenu;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.util.Iterator;
import java.util.Vector;

import javax.swing.JMenuItem;

import de.paragon.explorer.Explorer;
import de.paragon.explorer.ProjectConstants4ObjectExplorer;
import de.paragon.explorer.figure.ExplorerFieldListBoxFigure;
import de.paragon.explorer.figure.ExplorerFigure;
import de.paragon.explorer.figure.Figure;
import de.paragon.explorer.figure.ListBoxFigure;
import de.paragon.explorer.figure.TextBoxFigure;
import de.paragon.explorer.gui.ExplorerDrawingPanel;
import de.paragon.explorer.gui.ExplorerFrame;
import de.paragon.explorer.model.AttributeModel;
import de.paragon.explorer.model.ExplorerModel;
import de.paragon.explorer.model.ObjectHeaderModel;
import de.paragon.explorer.model.ObjectModel;
import de.paragon.explorer.popup.AttributePopupMenu;
import de.paragon.explorer.popup.HeaderPopupMenu;
import de.paragon.explorer.util.ExplorerManager;

/**
 * Kommentar: Diese Klasse empfaengt &quot;rohe&quot; Events wie Mausklicks oder
 * PopupMenu-Events vom Frame. Ihre Aufgabe besteht darin, alle noetigen
 * Informationen bei Eintreffen eines Events zu sammeln und damit ein neues
 * Explorer-Event zu basteln und an den ExplorerEventConverter weiterzusenden.
 * Sammeln heisst hierbei, sich den Punkt bei MousePressed zu merken, daraus die
 * getroffene Figur zu ermitteln und sich diese zu merken und gegebenen- falls
 * weitere Events (z.B. beim Frame im Falle des PopupMenus) anzufordern.
 * Kommentar zu den popups: Fuer die popups gibt es keine Zugriffsmethoden. Die
 * einzige Zuweisung erfolgt in der Variablendeklaration unten. Der einzige
 * Zugriff auf die Variablen erfolgt in der Methode getPopup.
 */
public class ExplorerFrameEventConverter extends WindowAdapter implements ActionListener, ItemListener, MouseListener, MouseMotionListener, KeyListener {
	private static final int				NUMBER_10	= 10;
	// private static final Logger logger =
	// Logger.getLogger(ExplorerFrameEventConverter.class);
	// private static boolean removeDependencies = true;
	// /**
	// * @return Returns the removeDependencies.
	// */
	// public static boolean removeDependencies() {
	// return ExplorerFrameEventConverter.removeDependencies;
	// }
	private ExplorerFigure					figure;
	private Point							mouseDownAt;
	private TextBoxFigure					actualTextBoxFigure;
	private ListBoxFigure					actualListBoxFigure;
	private HeaderPopupMenu					headerPopup;
	private AttributePopupMenu				attributePopup;
	// private boolean popupMenuRequested = false;
	private AboutDialogEventConverter		aboutDialogEventConverter;
	private ObjectCopyDialogEventConverter	objectCopyDialogEventConverter;
	private ObjectViewDialogEventConverter	objectViewDialogEventConverter;

	public ExplorerFrameEventConverter(ExplorerFigure explFig) {
<span class="fc" id="L98">		super();</span>
<span class="fc" id="L99">		this.setFigure(explFig);</span>
<span class="nc" id="L100">		this.initialize();</span>
<span class="nc" id="L101">	}</span>

	public void actionPerformed(ActionEvent event) {
<span class="nc" id="L104">		String actionCommandFromEvent = event.getActionCommand();</span>
<span class="nc" id="L105">		ListBoxFigure actualListBoxFigureLocal = this.getActualListBoxFigure();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">		if (actualListBoxFigureLocal != null) {</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">			if (ProjectConstants4ObjectExplorer.getHIDE_OBJECT().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L108">				this.getExplorerFigure().getFocusManager().clearFocus();</span>
<span class="nc" id="L109">				this.getExplorerPopupActionConverter().removeListBoxFigure(actualListBoxFigureLocal);</span>
<span class="nc" id="L110">				this.setActualListBoxFigure(null);</span>
			}
<span class="nc bnc" id="L112" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getHIDE_OBJECT_WITH_DEPENDENCIES().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L113">				this.getExplorerFigure().getFocusManager().clearFocus();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">				if (actualListBoxFigureLocal instanceof ExplorerFieldListBoxFigure) {</span>
<span class="nc" id="L115">					Iterator&lt;ExplorerFieldListBoxFigure&gt; it = ((ExplorerFieldListBoxFigure) actualListBoxFigureLocal).getChildren().iterator();</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">					while (it.hasNext()) {</span>
<span class="nc" id="L117">						ExplorerFieldListBoxFigure aChild = (it.next());</span>
<span class="nc" id="L118">						aChild.removeAllChildren(this.getExplorerPopupActionConverter());</span>
<span class="nc" id="L119">						this.getExplorerPopupActionConverter().removeListBoxFigure(aChild);</span>
<span class="nc" id="L120">					}</span>
				}
<span class="nc" id="L122">				this.getExplorerPopupActionConverter().removeListBoxFigure(actualListBoxFigureLocal);</span>
<span class="nc" id="L123">				this.setActualListBoxFigure(null);</span>
			}
<span class="nc bnc" id="L125" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getEXPLORE_OBJECT().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L126">				this.getExplorerPopupActionConverter().exploreObjectOf(actualListBoxFigureLocal);</span>
			}
<span class="nc bnc" id="L128" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getCOPY_OBJECT().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L129">				this.getObjectCopyDialogEventConverter().copyObject(this.getMouseDownAt(), actualListBoxFigureLocal);</span>
			}
<span class="nc bnc" id="L131" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getOBJECT_VIEW().equals(actionCommandFromEvent)) {</span>
<span class="nc bnc" id="L132" title="All 2 branches missed.">				if (actualListBoxFigureLocal != null) {</span>
<span class="nc" id="L133">					this.getObjectViewDialogEventConverter().initializeDialog(actualListBoxFigureLocal, false);</span>
				}
<span class="nc" id="L135">				this.getObjectViewDialogEventConverter().showDialog();</span>
			}
<span class="nc bnc" id="L137" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getUPDATE_OBJECT().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L138">				this.updateObject();</span>
			}
<span class="nc bnc" id="L140" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getUPDATE_OBJECTS().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L141">				this.handleUpdateObjects();</span>
			}
<span class="nc bnc" id="L143" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getHIDE_ATTRIBUTE().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L144">				this.getExplorerPopupActionConverter().setSingleAttributeUnvisibleOf(this.getActualTextBoxFigure());</span>
			}
<span class="nc bnc" id="L146" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getUPDATE_ATTRIBUTES().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L147">				this.getExplorerActionConverter().updateAttribute((AttributeModel) this.getActualTextBoxFigure().getModel());</span>
<span class="nc" id="L148">				this.getExplorerActionConverter().updateObject(actualListBoxFigureLocal);</span>
			}
<span class="nc bnc" id="L150" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getSHOW_REFERENCE().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L151">				this.getExplorerActionConverter().showInForeground(this.getActualTextBoxFigure());</span>
			}
<span class="nc bnc" id="L153" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getHIDE_REFERENCE().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L154">				this.getExplorerPopupActionConverter().removeConnection(this.getActualTextBoxFigure());</span>
			}
<span class="nc bnc" id="L156" title="All 2 branches missed.">			else if (ProjectConstants4ObjectExplorer.getSAVE().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L157">				this.getExplorerActionConverter().saveAttribute((ObjectHeaderModel) (this.getActualTextBoxFigure().getModel()));</span>
			}
		}
<span class="nc bnc" id="L160" title="All 2 branches missed.">		if (ProjectConstants4ObjectExplorer.getABOUT().equals(actionCommandFromEvent)) {</span>
<span class="nc" id="L161">			this.getAboutDialogEventConverter().showDialog();</span>
		}
		// this.setPopupMenuNotRequested();
<span class="nc" id="L164">	}</span>

	private AboutDialogEventConverter getAboutDialogEventConverter() {
<span class="nc bnc" id="L167" title="All 2 branches missed.">		if (this.aboutDialogEventConverter == null) {</span>
<span class="nc" id="L168">			this.setAboutDialogEventConverter(new AboutDialogEventConverter(this.getExplorerFigure()));</span>
		}
<span class="nc" id="L170">		return this.aboutDialogEventConverter;</span>
	}

	private ListBoxFigure getActualListBoxFigure() {
<span class="nc" id="L174">		return this.actualListBoxFigure;</span>
	}

	private TextBoxFigure getActualTextBoxFigure() {
<span class="nc" id="L178">		return this.actualTextBoxFigure;</span>
	}

	private AttributePopupMenu getAttributePopupMenu() {
<span class="nc bnc" id="L182" title="All 2 branches missed.">		if (this.attributePopup == null) {</span>
<span class="nc" id="L183">			this.attributePopup = new AttributePopupMenu();</span>
		}
<span class="nc" id="L185">		return this.attributePopup;</span>
	}

	private ExplorerActionConverter getExplorerActionConverter() {
<span class="nc" id="L189">		return ExplorerActionConverter.getInstance();</span>
	}

	public ExplorerFigure getExplorerFigure() {
<span class="nc" id="L193">		return this.figure;</span>
	}

	private ExplorerManager getExplorerManager() {
<span class="nc" id="L197">		return ExplorerManager.INSTANCE;</span>
	}

	private ExplorerPopupActionConverter getExplorerPopupActionConverter() {
<span class="nc" id="L201">		return ExplorerPopupActionConverter.getInstance();</span>
	}

	public HeaderPopupMenu getHeaderPopupMenu() {
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">		if (this.headerPopup == null) {</span>
<span class="nc" id="L206">			this.headerPopup = new HeaderPopupMenu();</span>
		}
<span class="nc" id="L208">		return this.headerPopup;</span>
	}

	private Point getMouseDownAt() {
<span class="nc" id="L212">		return this.mouseDownAt;</span>
	}

	private ObjectCopyDialogEventConverter getObjectCopyDialogEventConverter() {
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if (this.objectCopyDialogEventConverter == null) {</span>
<span class="nc" id="L217">			this.setObjectCopyDialogEventConverter(new ObjectCopyDialogEventConverter(this.getExplorerFigure()));</span>
		}
<span class="nc" id="L219">		return this.objectCopyDialogEventConverter;</span>
	}

	private ObjectViewDialogEventConverter getObjectViewDialogEventConverter() {
<span class="nc bnc" id="L223" title="All 2 branches missed.">		if (this.objectViewDialogEventConverter == null) {</span>
<span class="nc" id="L224">			this.setObjectViewDialogEventConverter(new ObjectViewDialogEventConverter(this.getExplorerFigure()));</span>
		}
<span class="nc" id="L226">		return this.objectViewDialogEventConverter;</span>
	}

	private PopupMenu getPopup() {
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (!(this.getActualTextBoxFigure() == null)) {</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">			if ((this.getActualTextBoxFigure()).getModel().isObjectHeaderModel()) {</span>
<span class="nc" id="L232">				HeaderPopupMenu hPM = this.getHeaderPopupMenu();</span>
<span class="nc" id="L233">				hPM.initialize(((ObjectModel) this.getActualListBoxFigure().getModel()).getObjectViewManager());</span>
<span class="nc" id="L234">				return hPM;</span>
			}
<span class="nc bnc" id="L236" title="All 2 branches missed.">			else if ((this.getActualTextBoxFigure()).getModel().isAttributeModel()) {</span>
<span class="nc" id="L237">				AttributePopupMenu aPM = this.getAttributePopupMenu();</span>
<span class="nc" id="L238">				aPM.initialize((AttributeModel) this.getActualTextBoxFigure().getModel());</span>
<span class="nc" id="L239">				return aPM;</span>
			}
		}
<span class="nc" id="L242">		return null;</span>
	}

	private void handleUpdateObjects() {
<span class="nc" id="L246">		Vector&lt;?&gt; models = ((ExplorerModel) this.getExplorerFigure().getModel()).getObjectModels().getVector();</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">		for (int i = 0; i &lt; models.size(); i++) {</span>
<span class="nc" id="L248">			this.getExplorerActionConverter().updateAllAttributesOf((ListBoxFigure) ((ObjectModel) models.elementAt(i)).getFigure());</span>
		}
<span class="nc" id="L250">	}</span>

	private void initialize() {
		// HeaderPopup
<span class="pc bnc" id="L254" title="All 2 branches missed.">		for (int i = 0; i &lt; this.getHeaderPopupMenu().getItemCount(); i++) {</span>
<span class="nc" id="L255">			MenuItem item = this.getHeaderPopupMenu().getItem(i);</span>
			// ignore separators
			// a separator has a hyphen as its label
<span class="nc bnc" id="L258" title="All 2 branches missed.">			if (!(item.getLabel().equals(&quot;-&quot;))) {</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">				if (item instanceof CheckboxMenuItem) {</span>
<span class="nc" id="L260">					((CheckboxMenuItem) item).addItemListener(this);</span>
				}
				else {
<span class="nc" id="L263">					item.addActionListener(this);</span>
				}
			}
		}
<span class="nc" id="L267">		boolean isActualLIstBoxFigureNotNull = false;</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">		if (this.getActualListBoxFigure() != null) {</span>
<span class="nc" id="L269">			isActualLIstBoxFigureNotNull = true;</span>
		}
<span class="nc" id="L271">		final ExplorerDrawingPanel explorerFigurePanel = this.getExplorerFigure().getPanel();</span>
<span class="nc" id="L272">		explorerFigurePanel.add(this.getHeaderPopupMenu());</span>
<span class="nc" id="L273">		explorerFigurePanel.add(this.getAttributePopupMenu());</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">		if (!Explorer.isEmbedded()) {</span>
<span class="nc" id="L275">			final ExplorerFrame explorerFigureFrame = this.getExplorerFigure().getFrame();</span>
			// AttributePopup
<span class="nc bnc" id="L277" title="All 2 branches missed.">			for (int i = 0; i &lt; this.getAttributePopupMenu().getItemCount(); i++) {</span>
<span class="nc" id="L278">				this.getAttributePopupMenu().getItem(i).addActionListener(this);</span>
			}
			// mouse listener
<span class="nc" id="L281">			explorerFigureFrame.addKeyListener(this);</span>
<span class="nc" id="L282">			explorerFigureFrame.addWindowListener(this);</span>
			// menubar add action listener for about
<span class="nc" id="L284">			((JMenuItem) explorerFigureFrame.getJMenuBar().getMenu(0).getMenuComponent(0)).addActionListener(this);</span>
<span class="nc" id="L285">			((JMenuItem) explorerFigureFrame.getJMenuBar().getMenu(0).getMenuComponent(1)).addActionListener(this);</span>
<span class="nc" id="L286">			((JMenuItem) explorerFigureFrame.getJMenuBar().getMenu(1).getMenuComponent(0)).addActionListener(this);</span>
<span class="nc" id="L287">			((JMenuItem) explorerFigureFrame.getJMenuBar().getMenu(1).getMenuComponent(2)).addActionListener(this);</span>
<span class="nc" id="L288">			explorerFigureFrame.getMenuItemSave().setEnabled(isActualLIstBoxFigureNotNull);</span>
<span class="nc" id="L289">			explorerFigureFrame.getMenuItemObjectView().setEnabled(isActualLIstBoxFigureNotNull);</span>
<span class="nc" id="L290">			explorerFigureFrame.getMenuItemUpdateObjects().setEnabled(isActualLIstBoxFigureNotNull);</span>
		}
<span class="nc" id="L292">		explorerFigurePanel.addMouseMotionListener(this);</span>
<span class="nc" id="L293">		explorerFigurePanel.addMouseListener(this);</span>
<span class="nc" id="L294">		explorerFigurePanel.addKeyListener(this);</span>
		// ((ExplorerFigure)
		// this.getExplorerFigure()).getPanel().addKeyListener(this);
		// ((ExplorerFigure)
		// this.getExplorerFigure()).getFrame().getScrollPane().addKeyListener(
		// this);
<span class="nc" id="L300">	}</span>

	private boolean isObjectHeaderModelSelected() {
<span class="nc bnc" id="L303" title="All 2 branches missed.">		if (this.getActualTextBoxFigure() != null) {</span>
<span class="nc" id="L304">			return (this.getActualTextBoxFigure()).getModel().isObjectHeaderModel();</span>
		}
		else {
<span class="nc" id="L307">			return false;</span>
		}
	}

	public void itemStateChanged(ItemEvent event) {
<span class="nc" id="L312">		final String label = ((CheckboxMenuItem) event.getSource()).getLabel();</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		if (ProjectConstants4ObjectExplorer.getSHOW_ATTRIBUTES().equals(label)) {</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">			if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L315">				this.getExplorerPopupActionConverter().setAllAttributesVisibleOf(this.getActualListBoxFigure());</span>
			}
			else {
<span class="nc" id="L318">				this.getExplorerPopupActionConverter().setAllAttributesUnvisibleOf(this.getActualListBoxFigure());</span>
			}
		}
<span class="nc bnc" id="L321" title="All 2 branches missed.">		if (ProjectConstants4ObjectExplorer.getHIDE_NULL_ATTRIBUTES().equals(label)) {</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">			if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L323">				this.getExplorerPopupActionConverter().setNullAttributesUnvisibleOf(this.getActualListBoxFigure());</span>
			}
			else {
<span class="nc" id="L326">				this.getExplorerPopupActionConverter().setNullAttributesVisibleOf(this.getActualListBoxFigure());</span>
			}
		}
		// if
		// (ProjectConstants4ObjectExplorer.getREMOVE_DEPENDENCIES().equals(label))
		// {
		// if (event.getStateChange() == ItemEvent.SELECTED) {
		// this.setRemoveDependencies(true);
		// }
		// else {
		// this.setRemoveDependencies(false);
		// }
		// }
<span class="nc bnc" id="L339" title="All 2 branches missed.">		if (ProjectConstants4ObjectExplorer.getHIDE_STATIC_ATTRIBUTES().equals(label)) {</span>
<span class="nc bnc" id="L340" title="All 2 branches missed.">			if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L341">				this.getExplorerPopupActionConverter().setStaticAttributesUnvisibleOf(this.getActualListBoxFigure());</span>
			}
			else {
<span class="nc" id="L344">				this.getExplorerPopupActionConverter().setStaticAttributesVisibleOf(this.getActualListBoxFigure());</span>
			}
		}
<span class="nc bnc" id="L347" title="All 2 branches missed.">		if (ProjectConstants4ObjectExplorer.getHIDE_UNEXPLORED_ATTRIBUTES().equals(label)) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">			if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L349">				this.getExplorerPopupActionConverter().setAllUnexploredAttributesUnvisibleOf(this.getActualListBoxFigure());</span>
			}
			else {
<span class="nc" id="L352">				this.getExplorerPopupActionConverter().setAllUnexploredAttributesVisibleOf(this.getActualListBoxFigure());</span>
			}
		}
<span class="nc" id="L355">		this.getObjectViewDialogEventConverter().updateObjectFocusMousePressed(this.getActualListBoxFigure());</span>
		// this.setPopupMenuNotRequested();
<span class="nc" id="L357">	}</span>

	public void keyPressed(KeyEvent e) {
<span class="nc" id="L360">		Component c = KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();</span>
		// Object receiver = null;
<span class="nc bnc" id="L362" title="All 2 branches missed.">		if (this.getActualListBoxFigure() != null) {</span>
			// this.getObjectViewDialogEventConverter().updateObjectFocus(this.
			// getActualListBoxFigure());
<span class="nc bnc" id="L365" title="All 2 branches missed.">			if (c instanceof ExplorerDrawingPanel) {</span>
<span class="nc" id="L366">				this.getObjectViewDialogEventConverter().keyPressedVisibleList(e);</span>
			}
		}
		// if (KeyEvent.VK_SPACE == e.getKeyCode()) {
		// if (e.isControlDown()) {
		// // String prePattern = &quot;&quot;;
		// if ((this.getActualTextBoxFigure() != null) &amp;&amp;
		// (this.getActualTextBoxFigure().getModel() instanceof
		// de.paragon.explorer.model.StandardAttributeModel)) {
		// // receiver = ((StandardAttributeModel)
		// // this.getActualTextBoxFigure().getModel()).getValue();
		// // prePattern = receiver.getClass().getName();
		// }
		// else {
		// if (this.getActualListBoxFigure() != null) {
		// // receiver =
		// // this.getActualListBoxFigure().getModel().getObject();
		// // prePattern = receiver.getClass().getName();
		// }
		// }
		// }
		// }
<span class="nc" id="L388">	}</span>

	public void keyReleased(KeyEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; keyReleased&quot;);
		// }
<span class="nc" id="L394">	}</span>

	public void keyTyped(KeyEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; keyTyped&quot;);
		// }
<span class="nc" id="L400">	}</span>

	/*
	 * draw bedeutet, dass nur die im Argument angebene Figur gezeichnet wird.
	 * draw wird immer dann aufgerufen, wenn sich die Stelle der zu zeich-
	 * nenden Figure nicht geaendert hat.
	 */
	/**
	 * Kommentar: mouseClicked (d. h., wenn die Maus gedrueckt und wieder
	 * freigegeben wurde) bewirkt beim Explorer folgendes: Die ist die aktuell
	 * zwischengespeicherte TextFigur eine solche, die mit einem AttributeModel
	 * verknuepft ist, wird bei einmaligen Klick die gesamte ListBoxFigure neu
	 * in den Vordergrund gezeichnet. Bei einem zweimaligen Klick wird eine neue
	 * ListBoxFigure erstellt, die das Objekt darstellt, die das verknuepfte
	 * AttributeModel repraesentiert.
	 */
	public void mouseClicked(java.awt.event.MouseEvent event) {
<span class="nc bnc" id="L417" title="All 4 branches missed.">		if ((this.getActualTextBoxFigure() != null) &amp;&amp; this.getActualTextBoxFigure().getModel().isAttributeModel()) {</span>
<span class="nc bnc" id="L418" title="All 2 branches missed.">			if (event.getClickCount() == 1) {</span>
<span class="nc" id="L419">				this.getExplorerActionConverter().draw(this.getActualListBoxFigure());</span>
			}
<span class="nc bnc" id="L421" title="All 2 branches missed.">			if (event.getClickCount() == 2) {</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">				if (((AttributeModel) this.getActualTextBoxFigure().getModel()).getConnectionModel() != null) {</span>
<span class="nc" id="L423">					this.getExplorerPopupActionConverter().removeConnection(this.getActualTextBoxFigure());</span>
				}
				else {
<span class="nc" id="L426">					this.getExplorerActionConverter().showInForeground(this.getActualTextBoxFigure());</span>
				}
			}
		}
<span class="nc bnc" id="L430" title="All 2 branches missed.">		if (this.isObjectHeaderModelSelected()) {</span>
<span class="nc bnc" id="L431" title="All 2 branches missed.">			if (event.getClickCount() == 2) {</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">				if (((ObjectModel) this.getActualListBoxFigure().getModel()).getObjectViewManager().isAllAttributesVisible()) {</span>
<span class="nc" id="L433">					this.getExplorerPopupActionConverter().setAllAttributesUnvisibleOf(this.getActualListBoxFigure());</span>
				}
				else {
<span class="nc" id="L436">					this.getExplorerPopupActionConverter().setAllAttributesVisibleOf(this.getActualListBoxFigure());</span>
				}
<span class="nc" id="L438">				this.getObjectViewDialogEventConverter().updateObjectFocus(this.getActualListBoxFigure());</span>
			}
		}
<span class="nc" id="L441">	}</span>

	public void mouseDragged(MouseEvent e) {
<span class="nc bnc" id="L444" title="All 2 branches missed.">		if (this.shouldMoveCursorAppear(e)) {</span>
<span class="nc" id="L445">			ListBoxFigure liBoFi = this.getActualListBoxFigure();</span>
			int x;
			int y;
<span class="nc bnc" id="L448" title="All 2 branches missed.">			if (e.getX() &gt;= 0) {</span>
<span class="nc" id="L449">				x = e.getX() - this.getMouseDownAt().x;</span>
			}
			else {
				// x = 10 - this.getMouseDownAt().x;
<span class="nc" id="L453">				x = 0;</span>
			}
<span class="nc bnc" id="L455" title="All 2 branches missed.">			if (e.getY() &gt;= 0) {</span>
<span class="nc" id="L456">				y = e.getY() - this.getMouseDownAt().y;</span>
			}
			else {
				// y = 10 - this.getMouseDownAt().y;
<span class="nc" id="L460">				y = 0;</span>
			}
<span class="nc" id="L462">			this.getExplorerActionConverter().moveFigureBy(liBoFi, x, y);</span>
<span class="nc" id="L463">			this.getExplorerActionConverter().draw(liBoFi);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">			if (this.getExplorerFigure().getFrame() != null) {</span>
<span class="nc" id="L465">				this.getExplorerFigure().getFrame().setCursor(Cursor.getPredefinedCursor(Cursor.MOVE_CURSOR));</span>
			}
<span class="nc" id="L467">			this.setMouseDownAt(e.getPoint());</span>
		}
<span class="nc" id="L469">	}</span>

	/**
	 * Kommentar:
	 * 
	 * Falls kein popupmenu geoeffnet wurde, geschieht folgendes:
	 * 
	 * Wenn der Mauszeiger das Fenster beruehrt, werden die aktuell
	 * zwischengespeicherte List- und TextBoxFigure sowie der Punkt, wo die Maus
	 * gedrueckt wurde, geloescht.
	 * 
	 * In jedem Fall wird das Object wieder so gesetzt, dass das popupmenu nicht
	 * mehr als geoeffnet gilt.
	 */
	public void mouseEntered(MouseEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mouseEntered&quot;);
		// }
		/**
		 * if (!this.popupMenuIsRequested()) { this.setMouseDownAt(null);
		 * this.setActualTextBoxFigure(null); this.setActualListBoxFigure(null);
		 * } else { //
		 * System.out.println(&quot;mouse entered with popup menu requested &quot; +
		 * this.getActualListBoxFigure()); } //this.setPopupMenuNotReqested();
		 * //System.out.println(&quot;mouse entered, Popup reset&quot;);
		 */
<span class="nc" id="L495">	}</span>

	/**
	 * Kommentar: Wenn der Mauszeiger das Fenster verlaesst, werden die aktuell
	 * zwischengespeicherte List- und TextBoxFigure sowie der Punkt, wo die Maus
	 * gedrueckt wurde, geloescht
	 */
	/*
	 * Kommentar: zur Abfrage nach popupMenuIsRequested: In einigen
	 * Entwicklungsumgebungen ge- schieht beim Aufruf des Popup-Menus folgendes:
	 * Wenn ein MenuPunkt aus dem Popup-Menu ausgewaehlt wird und die Maustaste
	 * wied- der freigegeben wird, wird zuerst das Event &quot;mouseExited&quot; gefeuert,
	 * was ja dazu fuehrt, dass die zu bearbeitenden Text- und ListBoxFigures
	 * geloescht wer- den. Dies soll aber verhindert werden, wenn das Popup-Menu
	 * aufgerufen wurde. Wenn das Event MouseExited fertig ist, wird
	 * ActionPerformed, und danach MouseEntered aufgerufen.
	 */
	public void mouseExited(MouseEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mouseExited&quot;);
		// }
		/**
		 * if (!this.popupMenuIsRequested()) { this.setMouseDownAt(null);
		 * this.setActualTextBoxFigure(null); this.setActualListBoxFigure(null);
		 * } else { //
		 * System.out.println(&quot;mouse exited with popup menu requested&quot;); }
		 */
<span class="nc" id="L522">	}</span>

	/**
	 * Kommentar: Sobald eine Maustaste gedrueckt wird, werden die Text- und die
	 * ListBoxFigure, sofern sie getroffen sind, sowie der Punkt in den
	 * Zwischenspeicher gespeichert. Die getroffene ListBoxFigure wird in den
	 * Vordergrund gesetzt, sodass sie bei der naechsten Komplettzeichnung vorne
	 * erscheint.
	 */
	public void mouseMoved(MouseEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mouseMoved&quot;);
		// }
<span class="nc" id="L535">	}</span>

	/**
	 * Kommentar: Sobald eine Maustaste gedrueckt wird, werden die Text- und die
	 * ListBoxFigure, sofern sie getroffen sind, sowie der Punkt in den
	 * Zwischenspeicher gespeichert. Die getroffene ListBoxFigure wird in den
	 * Vordergrund gesetzt, sodass sie bei der naechsten Komplettzeichnung vorne
	 * erscheint.
	 */
	public void mousePressed(MouseEvent e) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mousePressed&quot;);
		// }
<span class="nc" id="L548">		this.setMouseDownAt(e.getPoint());</span>
<span class="nc bnc" id="L549" title="All 2 branches missed.">		if (e.getSource() instanceof ExplorerDrawingPanel) {</span>
<span class="nc" id="L550">			((ExplorerDrawingPanel) e.getSource()).requestFocus();</span>
<span class="nc" id="L551">			ListBoxFigure oldListBoxFigure = this.getActualListBoxFigure();</span>
			// TextBoxFigure oldTextBoxFigure = this.getActualTextBoxFigure();
<span class="nc" id="L553">			this.setActualTextBoxFigure(this.getExplorerFigure().getTextBoxFigureForPoint(this.getMouseDownAt()));</span>
<span class="nc" id="L554">			this.setActualListBoxFigure(this.getExplorerFigure().getListBoxFigureForPoint(this.getMouseDownAt()));</span>
			// hier muss object view inaktiv bzw aktiv gesetzt werden.....
<span class="nc bnc" id="L556" title="All 4 branches missed.">			if ((this.getActualListBoxFigure() != null) &amp;&amp; (this.getActualTextBoxFigure() != null)) {</span>
				// if (this.getActualListBoxFigure() instanceof ListBoxFigure) {
<span class="nc" id="L558">				this.getExplorerActionConverter().setInForeground(this.getActualListBoxFigure());</span>
				// }
<span class="nc" id="L560">				this.getObjectViewDialogEventConverter().updateObjectFocusMousePressed(this.getActualListBoxFigure());</span>
<span class="nc bnc" id="L561" title="All 2 branches missed.">				if (!this.getActualTextBoxFigure().getModel().isObjectHeaderModel()) {</span>
<span class="nc" id="L562">					this.getObjectViewDialogEventConverter().updateAttributeFocus(this.getActualTextBoxFigure());</span>
				}
<span class="nc bnc" id="L564" title="All 2 branches missed.">				else if (this.getActualListBoxFigure().equals(oldListBoxFigure)</span>
<span class="nc bnc" id="L565" title="All 2 branches missed.">						|| !((ObjectModel) this.getActualListBoxFigure().getModel()).getObjectViewManager().isAllAttributesVisible()) {</span>
<span class="nc" id="L566">					this.getExplorerFigure().getFocusManager().handleFocus(this.getActualTextBoxFigure(), true);</span>
				}
				/***************************************************************
				 * else if (oldTextBoxFigure != null) { if
				 * (oldTextBoxFigure.getModel().isObjectHeaderModel()) {
				 * this.getExplorerFigure ().getFocusManager().handleFocus(this.
				 * getActualTextBoxFigure ()); } }
				 **************************************************************/
			}
		}
<span class="nc" id="L576">	}</span>

	/*
	 * Kommentar: draw bedeutet, dass nur die im Argument angebene Figur
	 * gezeichnet wird. draw wird immer dann aufgerufen, wenn sich die Stelle
	 * der zu zeich- nenden Figure nicht geaendert hat. Da sich bei moveFigureBy
	 * die Stelle aendert, wird in der Methode moveFigureBy explitit ein anderes
	 * draw aufgerufen. Das draw dort loescht die gesammte Zeichnung, bevor die
	 * kom- plette Zeichnung neu gezeichnet wird. Bemerkung: zur Abfrage nach
	 * popupMenuIsRequested: In einigen Entwicklungsumgebungen geschieht beim
	 * Aufruf des Popup-Menus folgendes: Wenn ein MenuPunkt aus dem Popup-Menu
	 * ausgewaehlt wird und die Maustaste wieder freigegeben wird, wird zuerst
	 * das Event &quot;mouseExited&quot; gefeuert, was ja dazu fuehrt, dass die zu
	 * bearbeitenden Text- und ListBoxFigures geloescht werden. Dies soll aber
	 * verhindert werden, wenn das Popup-Menu aufgerufen wurde. Wenn das Event
	 * MouseExited fertig ist, wird ActionPerformed, und danach MouseEntered
	 * aufgerufen.
	 */
	/**
	 * Kommentar: Wird die Maustaste wieder freigegeben, wird entweder ein von
	 * der getroffenen Figur abhaengiges Popupmenu geoeffnet, oder die
	 * ListBoxFigure wird um die Differenz der Punkte, wo die Maus gedrueckt und
	 * wieder freigegeben wurde, verschoben und im Vordergrund gezeichnet.
	 */
	public void mouseReleased(MouseEvent event) {
		// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
		// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mouseReleased&quot;);
		// }
<span class="nc bnc" id="L604" title="All 2 branches missed.">		if (event.isPopupTrigger()) {</span>
<span class="nc bnc" id="L605" title="All 2 branches missed.">			if (this.getActualTextBoxFigure() != null) {</span>
				// if (this.getActualListBoxFigure() instanceof ListBoxFigure) {
<span class="nc" id="L607">				this.getExplorerActionConverter().draw(this.getActualListBoxFigure());</span>
				// if (ExplorerFrameEventConverter.logger.isDebugEnabled()) {
				// ExplorerFrameEventConverter.logger.debug(&quot;--&gt;&gt; mouseReleased, Popup requested&quot;);
				// }
				// this.setPopupMenuRequested();
				// }
<span class="nc" id="L613">				this.getPopup().show(this.getExplorerFigure().getPanel(), (int) this.getMouseDownAt().getX(), (int) this.getMouseDownAt().getY());</span>
			}
		}
		else {
<span class="nc bnc" id="L617" title="All 2 branches missed.">			if (this.getExplorerFigure().getFrame() != null) {</span>
<span class="nc" id="L618">				this.getExplorerFigure().getFrame().setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));</span>
			}
		}
<span class="nc" id="L621">	}</span>

	public void moveCursorShouldBeDisplayed(MouseEvent e) {
<span class="nc bnc" id="L624" title="All 2 branches missed.">		if (this.getMouseDownAt() != e.getPoint()) {</span>
<span class="nc bnc" id="L625" title="All 2 branches missed.">			if (e.getModifiers() == InputEvent.BUTTON1_MASK) {</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">				if (this.getActualTextBoxFigure() != null) {</span>
<span class="nc bnc" id="L627" title="All 2 branches missed.">					if ((this.getActualTextBoxFigure()).getModel().isObjectHeaderModel()) {</span>
<span class="nc" id="L628">						ListBoxFigure liBoFi = this.getActualListBoxFigure();</span>
						int x;
						int y;
<span class="nc bnc" id="L631" title="All 2 branches missed.">						if (e.getX() &gt;= 0) {</span>
<span class="nc" id="L632">							x = e.getX() - this.getMouseDownAt().x;</span>
						}
						else {
<span class="nc" id="L635">							x = ExplorerFrameEventConverter.NUMBER_10 - this.getMouseDownAt().x;</span>
						}
<span class="nc bnc" id="L637" title="All 2 branches missed.">						if (e.getY() &gt;= 0) {</span>
<span class="nc" id="L638">							y = e.getY() - this.getMouseDownAt().y;</span>
						}
						else {
<span class="nc" id="L641">							y = ExplorerFrameEventConverter.NUMBER_10 - this.getMouseDownAt().y;</span>
						}
<span class="nc" id="L643">						this.getExplorerActionConverter().moveFigureBy(liBoFi, x, y);</span>
<span class="nc" id="L644">						this.getExplorerActionConverter().draw(liBoFi);</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">						if (this.getExplorerFigure().getFrame() != null) {</span>
<span class="nc" id="L646">							this.getExplorerFigure().getFrame().setCursor(Cursor.getPredefinedCursor(Cursor.MOVE_CURSOR));</span>
						}
<span class="nc" id="L648">						this.setMouseDownAt(e.getPoint());</span>
					}
				}
			}
		}
<span class="nc" id="L653">	}</span>

	private void setAboutDialogEventConverter(AboutDialogEventConverter newAboutDialogEventConverter) {
<span class="nc" id="L656">		this.aboutDialogEventConverter = newAboutDialogEventConverter;</span>
<span class="nc" id="L657">	}</span>

	private void setActualListBoxFigure(Figure newFigure) {
<span class="nc" id="L660">		this.actualListBoxFigure = (ListBoxFigure) newFigure;</span>
<span class="nc" id="L661">		boolean isActualLIstBoxFigureNotNull = false;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">		if (newFigure != null) {</span>
<span class="nc" id="L663">			isActualLIstBoxFigureNotNull = true;</span>
		}
<span class="nc bnc" id="L665" title="All 2 branches missed.">		if (!Explorer.isEmbedded()) {</span>
<span class="nc" id="L666">			ExplorerFrame frame = this.getExplorerFigure().getFrame();</span>
<span class="nc" id="L667">			frame.getMenuItemSave().setEnabled(isActualLIstBoxFigureNotNull);</span>
<span class="nc" id="L668">			frame.getMenuItemObjectView().setEnabled(isActualLIstBoxFigureNotNull);</span>
<span class="nc" id="L669">			frame.getMenuItemUpdateObjects().setEnabled(isActualLIstBoxFigureNotNull);</span>
		}
<span class="nc" id="L671">	}</span>

	private void setActualTextBoxFigure(Figure newFigure) {
<span class="nc" id="L674">		this.actualTextBoxFigure = (TextBoxFigure) newFigure;</span>
<span class="nc" id="L675">	}</span>

	public void setCursorPosition(int pos) {
<span class="nc" id="L678">	}</span>

	public void setFigure(ExplorerFigure newFigure) {
<span class="fc" id="L681">		this.figure = newFigure;</span>
<span class="fc" id="L682">	}</span>

	private void setMouseDownAt(Point point) {
<span class="nc" id="L685">		this.mouseDownAt = point;</span>
<span class="nc" id="L686">	}</span>

	private void setObjectCopyDialogEventConverter(ObjectCopyDialogEventConverter newObjectCopyDialogEventConverter) {
<span class="nc" id="L689">		this.objectCopyDialogEventConverter = newObjectCopyDialogEventConverter;</span>
<span class="nc" id="L690">	}</span>

	private void setObjectViewDialogEventConverter(ObjectViewDialogEventConverter newObjectViewDialogEventConverter) {
<span class="nc" id="L693">		this.objectViewDialogEventConverter = newObjectViewDialogEventConverter;</span>
<span class="nc" id="L694">	}</span>

	private boolean shouldMoveCursorAppear(MouseEvent e) {
<span class="nc bnc" id="L697" title="All 6 branches missed.">		return (this.getMouseDownAt() != e.getPoint()) &amp;&amp; (e.getModifiers() == InputEvent.BUTTON1_MASK) &amp;&amp; this.isObjectHeaderModelSelected();</span>
	}

	private void updateObject() {
<span class="nc" id="L701">		this.getExplorerActionConverter().updateAllAttributesOf(this.getActualListBoxFigure());</span>
<span class="nc" id="L702">	}</span>

	@Override
	public void windowActivated(WindowEvent e) {
		// this.getObjectMoveFrameEventConverter().activeFrame(e.getSource());
<span class="nc" id="L707">	}</span>

	@Override
	public void windowClosing(WindowEvent e) {
<span class="nc" id="L711">		this.getExplorerManager().getExistingExplorerModels().remove(this.getExplorerFigure().getModel());</span>
<span class="nc" id="L712">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>