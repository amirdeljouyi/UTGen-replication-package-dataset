<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BinaryCalculate.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">82_ipcalculator</a> &gt; <a href="index.source.html" class="el_package">ipac</a> &gt; <span class="el_source">BinaryCalculate.java</span></div><h1>BinaryCalculate.java</h1><pre class="source lang-java linenums">package ipac;
import java.text.*;
import java.util.*;
import java.math.*;

/**
 *  Title: Binary Calculator
 *  &lt;br&gt;Description: Background binary calculator for the IPAC program
 *  &lt;br&gt;Copyright (c) 2006-7 Jason Wang
 *
 *  &lt;p&gt;This program is free software; you can redistribute it and/or
 *  &lt;br&gt;modify it under the terms of the GNU General Public License
 *  &lt;br&gt;as published by the Free Software Foundation; either version 2
 *  &lt;br&gt;of the License, or (at your option) any later version.
 *
 *  &lt;br&gt;This program is distributed in the hope that it will be useful,
 *  &lt;br&gt;but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  &lt;br&gt;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  &lt;br&gt;GNU General Public License for more details.
 *
 *  &lt;br&gt;You should have received a copy of the GNU General Public License
 *  &lt;br&gt;along with this program; if not, write to the Free Software
 *  &lt;br&gt;Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
 *                                                              02110-1301, USA.
 *
 *  @author      Jason Wang
 *  @version     v0.19
 */

<span class="fc" id="L30">public class BinaryCalculate{</span>
    
<span class="fc" id="L32">    boolean isIPv4 = false;</span>
<span class="fc" id="L33">    boolean isIPv6= false;</span>
<span class="fc" id="L34">    String currentIP = &quot;&quot;;</span>
<span class="fc" id="L35">    String fullReassembler = &quot;&quot;;</span>
<span class="fc" id="L36">    String DELIMITER = &quot;&quot;;</span>
<span class="fc" id="L37">    int lengthOfToken = 0;</span>
<span class="fc" id="L38">    String IPRangeAddress = &quot;&quot;;</span>
<span class="fc" id="L39">    String usableRange = &quot;&quot;;</span>
<span class="fc" id="L40">    int semiCol = 0;</span>
<span class="fc" id="L41">    String prefix = &quot;&quot;;</span>
    BigInteger totalIPAddresses;
<span class="fc" id="L43">    int MAXPREFIX = 0;</span>
    
    /**
     *  Calculates the sum of two binary numbers.
     *
     *  @param       num1    The starting binary number
     *  @param       num2    The binary number to be added to the starting binary
     *  @return      The sum of two binary numbers.
     */
    public String addBinary(String num1, String num2) {
<span class="fc" id="L53">        boolean carry = false;</span>
<span class="fc" id="L54">        int size1 = num1.length() - 1;</span>
<span class="fc" id="L55">        int size2 = num2.length() - 1;</span>
<span class="fc" id="L56">        String sum = &quot;&quot;;</span>
        
<span class="fc bfc" id="L58" title="All 2 branches covered.">        if (size2 &gt; size1) {</span>
<span class="fc" id="L59">            String s = num1;</span>
<span class="fc" id="L60">            num1 = num2;</span>
<span class="fc" id="L61">            num2 = s;</span>
<span class="fc" id="L62">            int n = size1;</span>
<span class="fc" id="L63">            size1 = size2;</span>
<span class="fc" id="L64">            size2 = n;</span>
        }
        
<span class="fc bfc" id="L67" title="All 2 branches covered.">        for (; size2 &gt;= 0 ; size1--, size2--) {</span>
<span class="fc bfc" id="L68" title="All 4 branches covered.">            if (num1.charAt(size1) == '0' &amp;&amp; num2.charAt(size2) == '0') {</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L70">                    sum = &quot;0&quot; + sum;</span>
                else
<span class="fc" id="L72">                    sum = &quot;1&quot; + sum;</span>
<span class="fc" id="L73">                carry = false;</span>
<span class="fc bfc" id="L74" title="All 4 branches covered.">            } else if (num1.charAt(size1) == '1' &amp;&amp; num2.charAt(size2) == '0') {</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L76">                    sum = &quot;1&quot; + sum;</span>
                else {
<span class="fc" id="L78">                    sum = &quot;0&quot; + sum;</span>
<span class="fc" id="L79">                    carry = true;</span>
                }
<span class="fc bfc" id="L81" title="All 4 branches covered.">            } else if (num1.charAt(size1) == '0' &amp;&amp; num2.charAt(size2) == '1') {</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L83">                    sum = &quot;1&quot; + sum;</span>
                else {
<span class="fc" id="L85">                    sum = &quot;0&quot; + sum;</span>
<span class="fc" id="L86">                    carry = true;</span>
                }
<span class="fc bfc" id="L88" title="All 4 branches covered.">            } else if (num1.charAt(size1) == '1' &amp;&amp; num2.charAt(size2) == '1') {</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L90">                    sum = &quot;0&quot; + sum;</span>
                else
<span class="fc" id="L92">                    sum = &quot;1&quot; + sum;</span>
<span class="fc" id="L93">                carry = true;</span>
            }
        }
        
<span class="fc bfc" id="L97" title="All 2 branches covered.">        for (; size1 &gt;= 0 ; size1--) {</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">            if (num1.charAt(size1) == '0') {</span>
<span class="fc bfc" id="L99" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L100">                    sum = &quot;0&quot; + sum;</span>
                else
<span class="fc" id="L102">                    sum = &quot;1&quot; + sum;</span>
<span class="fc" id="L103">                carry = false;</span>
<span class="fc bfc" id="L104" title="All 2 branches covered.">            } else if (num1.charAt(size1) == '1') {</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">                if (!carry)</span>
<span class="fc" id="L106">                    sum = &quot;1&quot; + sum;</span>
                else {
<span class="fc" id="L108">                    sum = &quot;0&quot; + sum;</span>
<span class="fc" id="L109">                    carry = true;</span>
                }
            }
        }
        
<span class="fc bfc" id="L114" title="All 2 branches covered.">        if (carry)</span>
<span class="fc" id="L115">            sum = &quot;1&quot; + sum;</span>
        
<span class="fc" id="L117">        return sum;</span>
    }
    
    /**
     *  Subtracts two binary numbers.
     *
     *  @param       num1    The starting binary number
     *  @param       num2    The binary number to be subtracted from the
     *                       starting binary
     *  @return      The difference of two binary numbers.
     */
    public String subBinary(String num1, String num2) {
        
<span class="fc" id="L130">        String diff = &quot;&quot;;</span>
<span class="fc" id="L131">        String twosComp = &quot;&quot;;</span>
<span class="fc" id="L132">        int size = num1.length() - 1;</span>
        
<span class="fc bfc" id="L134" title="All 2 branches covered.">        for (;  size&gt;= 0 ; size--) {</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">            if (num1.charAt(size) == '0')</span>
<span class="fc" id="L136">                twosComp = &quot;1&quot; + twosComp;</span>
            else
<span class="fc" id="L138">                twosComp = &quot;0&quot; + twosComp;</span>
        }
        
<span class="fc" id="L141">        twosComp = &quot;0&quot; + twosComp;</span>
<span class="fc" id="L142">        twosComp = addBinary(twosComp, &quot;1&quot;);</span>
        
<span class="fc" id="L144">        diff = addBinary(twosComp, num2);</span>
        
<span class="fc" id="L146">        return diff.substring(1);</span>
    }
    
    /**
     *  Calculates the IP Range from the provided IP address and number of IP
     *  addresses. The results are stored into an &lt;code&gt;string&lt;/code&gt; to be
     *  returned to the method that called it.
     *
     *  @param      IP          The starting IP address (subnet) in binary
     *  @param      IPPrefix    Number of IP addresses in binary
     *  @return     Results string
     */
    public String IPCalculate(String IP, String IPPrefix){
<span class="fc" id="L159">        String outputText = &quot;&quot;;</span>
<span class="fc" id="L160">        checkIPType(IP.length() - 1);</span>
<span class="fc" id="L161">        String subnet = convert(IP);</span>
        
<span class="fc" id="L163">        String netmask = getNetmask(IPPrefix);</span>
        
<span class="fc" id="L165">        calculate(IP, IPPrefix);</span>
<span class="fc" id="L166">        outputText += &quot;Total Range: &quot; + IPRangeAddress + &quot;\n&quot;;</span>
<span class="fc" id="L167">        outputText += &quot;Usable Range: &quot; + usableRange + &quot;\n&quot;;</span>
<span class="fc" id="L168">        NumberFormat formatter = new DecimalFormat(</span>
                &quot;###,###,###,###,###,###,###,###,###,###,###,###,###&quot;);
<span class="fc" id="L170">        outputText += &quot;\n&quot;;</span>
<span class="fc" id="L171">        outputText += &quot;Total usable IP Addresses : &quot; + formatter.format(</span>
                totalIPAddresses) + &quot;\n&quot;;
<span class="fc" id="L173">        outputText += &quot;Subnet: &quot; + subnet + &quot;\n&quot;;</span>
<span class="fc" id="L174">        outputText += &quot;Binary Subnet: &quot; + getBinaryIP(IP) + &quot;\n&quot;;</span>
<span class="fc" id="L175">        outputText += &quot;Broadcast Address: &quot; + currentIP + &quot;\n&quot;;</span>
<span class="fc" id="L176">        outputText += &quot;Prefix: &quot; + prefix + &quot;\n&quot;;</span>
<span class="fc" id="L177">        checkIPType(netmask.length() - 1);</span>
<span class="fc" id="L178">        String outputNetmask = convert(netmask);</span>
<span class="fc" id="L179">        outputText += &quot;Netmask: &quot; + outputNetmask + &quot;\n&quot;;</span>
<span class="fc" id="L180">        String binaryNetmask = getBinaryIP(netmask);</span>
<span class="fc" id="L181">        outputText += &quot;Binary Netmask: &quot; + binaryNetmask;</span>
        
<span class="fc" id="L183">        return outputText;</span>
    }
    
    /**
     *  Adds delimiters back into a given IP address
     *
     *  @param      binaryIP     binary IP address with no delimiters
     *  @return     binary IP address with delimiters
     */
    private String getBinaryIP(String binaryIP){
<span class="fc" id="L193">        String output = &quot;&quot;;</span>
<span class="fc" id="L194">        checkIPType(binaryIP.length() - 1);</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">        for (int i = 0; i &lt; MAXPREFIX; i++){</span>
<span class="fc" id="L196">            output += binaryIP.charAt(i);</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">            if (i == semiCol){</span>
<span class="fc bfc" id="L198" title="All 2 branches covered.">                if (i != (binaryIP.length() - 1))</span>
<span class="fc" id="L199">                    output += DELIMITER;</span>
<span class="fc" id="L200">                semiCol += lengthOfToken;</span>
            }
        }
<span class="fc" id="L203">        return output;</span>
    }
    
    /**
     *  Gets the netmask from a binary representation of number of IP addresses
     *
     *  @param      binaryIP     binary representation of number of IP addresses
     *  @return     netmask of &lt;code&gt;binaryIP&lt;/code&gt;
     */
    private String getNetmask(String binaryIP){
<span class="fc" id="L213">        String invertedIPPrefix = &quot;&quot;;</span>
<span class="fc bfc" id="L214" title="All 2 branches covered.">        for (int i = 0; i &lt; MAXPREFIX; i++){</span>
<span class="pc bpc" id="L215" title="1 of 2 branches missed.">            if (binaryIP.charAt(i) == '0')</span>
<span class="nc" id="L216">                invertedIPPrefix += &quot;1&quot;;</span>
            else
<span class="fc" id="L218">                invertedIPPrefix += &quot;0&quot;;</span>
        }
<span class="fc" id="L220">        return invertedIPPrefix;</span>
    }
    
    /**
     *  Calculates the IP Range from the provided IP address and number of IP
     *  addresses. The results are stored as declared global variables for many
     *  other methods to manipulate or use.
     *  &lt;br&gt;This method also detects if the provided of number of IP addresses
     *  to be calculate exceeds past these IP addresses: 255.255.255.255 and
     *  FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF, as further IP addresses exceeds
     *  the IP addressing bounds.
     *  &lt;br&gt;This method also calculates the prefix size needed to accomodate all
     *  the IP Addresses to be listed and stores it as a global variable for use
     *  in other methods.
     *
     *  @param       subnet              The starting IP address (subnet)
     *  @param       noOfIPAddresses     Number of IP addresses
     */
    private void calculate(String subnet, String noOfIPAddresses) {
<span class="fc" id="L239">        currentIP = &quot;&quot;;</span>
<span class="fc" id="L240">        String number1 = subnet;</span>
<span class="fc" id="L241">        String usableIP = &quot;&quot;;</span>
        
<span class="fc" id="L243">        String IP = addBinary(subnet, noOfIPAddresses);</span>
<span class="fc" id="L244">        checkIPType(subnet.length() - 1);</span>
<span class="fc" id="L245">        String addSubBinary = &quot;&quot;;</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">        for (int i = 0; i &lt; (MAXPREFIX - 1); i++){</span>
<span class="fc" id="L247">            addSubBinary += &quot;0&quot;;</span>
        }
<span class="fc" id="L249">        addSubBinary += &quot;1&quot;;</span>
<span class="fc" id="L250">        subnet = addBinary(addSubBinary, subnet);</span>
<span class="fc" id="L251">        usableIP = convert (subnet);</span>
<span class="fc" id="L252">        subnet = subBinary(addSubBinary, subnet);</span>
<span class="fc" id="L253">        checkIPType(subnet.length() - 1);</span>
<span class="fc" id="L254">        currentIP = convert(subnet);</span>
<span class="fc" id="L255">        fullReassembler = &quot;&quot;;</span>
        
<span class="fc" id="L257">        semiCol = lengthOfToken - 1;</span>
<span class="fc" id="L258">        IPRangeAddress = currentIP + &quot; -- &quot;;</span>
<span class="fc" id="L259">        usableRange = usableIP + &quot; -- &quot;;</span>
<span class="fc" id="L260">        currentIP = &quot;&quot;;</span>
        
<span class="fc" id="L262">        String currentIPString = &quot;&quot;;</span>
        
<span class="fc bfc" id="L264" title="All 2 branches covered.">        if (IP.length() &gt; 128){</span>
<span class="fc" id="L265">            IPRangeAddress = IPRangeAddress +</span>
                    &quot;FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF&quot;;
<span class="fc" id="L267">            currentIP = &quot;FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF&quot;;</span>
<span class="fc bfc" id="L268" title="All 4 branches covered.">        }else if(IP.length() &gt; 32 &amp;&amp; IP.length() &lt; 128){</span>
<span class="fc" id="L269">            IPRangeAddress = IPRangeAddress + &quot;255.255.255.255&quot;;</span>
<span class="fc" id="L270">            currentIP = &quot;255.255.255.255&quot;;</span>
        }else{
<span class="fc" id="L272">            String IPRangeEnd = subBinary(addSubBinary, IP);</span>
<span class="fc" id="L273">            String endIP = convert(IPRangeEnd);</span>
<span class="fc" id="L274">            usableRange = usableRange + endIP;</span>
<span class="fc" id="L275">            checkIPType(subnet.length() - 1);</span>
<span class="fc" id="L276">            currentIP = convert(IP);</span>
<span class="fc" id="L277">            IPRangeAddress = IPRangeAddress + currentIP;</span>
        }
        
<span class="fc" id="L280">        currentIPString = subBinary(number1, convertToBinary(currentIP));</span>
<span class="fc" id="L281">        totalIPAddresses = new BigInteger(currentIPString, 2);</span>
<span class="fc" id="L282">        totalIPAddresses = totalIPAddresses.add(new BigInteger(&quot;1&quot;));</span>
<span class="fc" id="L283">        int prefixInt = 0;</span>
<span class="fc bfc" id="L284" title="All 2 branches covered.">        if (totalIPAddresses.doubleValue() &lt; 2)</span>
<span class="fc" id="L285">            prefixInt = MAXPREFIX;</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">        else if (totalIPAddresses.doubleValue() == 2)</span>
<span class="fc" id="L287">            prefixInt = MAXPREFIX - 2;</span>
        else {
<span class="fc bfc" id="L289" title="All 2 branches covered.">            if (isIPv6){</span>
<span class="fc" id="L290">                String currentIPString1 = currentIPString.substring(0, 64);</span>
<span class="fc" id="L291">                BigInteger totalIPAddresses1 = new BigInteger(currentIPString1,</span>
                        2);
<span class="fc" id="L293">                double prefixInt1 = 0;</span>
                
<span class="fc bfc" id="L295" title="All 2 branches covered.">                if (totalIPAddresses1.doubleValue() &gt; 0)</span>
<span class="fc" id="L296">                    prefixInt1 = Math.log(totalIPAddresses1.doubleValue())/</span>
<span class="fc" id="L297">                            Math.log(2.0);</span>
                
<span class="fc" id="L299">                String currentIPString2 = currentIPString.substring(64,128);</span>
<span class="fc" id="L300">                BigInteger totalIPAddresses2 = new BigInteger(currentIPString2,</span>
                        2);
<span class="fc" id="L302">                double prefixInt2 = Math.log(totalIPAddresses2.doubleValue())/</span>
<span class="fc" id="L303">                        Math.log(2.0);</span>
                
<span class="fc" id="L305">                prefixInt = MAXPREFIX - (int)Math.ceil(prefixInt1) -</span>
<span class="fc" id="L306">                        (int)Math.round(prefixInt2);</span>
<span class="fc bfc" id="L307" title="All 2 branches covered.">            } else if (isIPv4)</span>
<span class="fc" id="L308">                prefixInt = MAXPREFIX - (int)Math.ceil(Math.log(</span>
<span class="fc" id="L309">                        totalIPAddresses.doubleValue())/Math.log(2.0));</span>
        }
<span class="fc" id="L311">        prefix = &quot;/&quot; + prefixInt;</span>
<span class="fc" id="L312">        totalIPAddresses = totalIPAddresses.subtract(new BigInteger(&quot;2&quot;));</span>
<span class="fc" id="L313">    }</span>
    
    /**
     *  Calculates the IP Range from the provided IP address and number of IP
     *  addresses from the smaller prefix. The results are stored into an array
     *  to be printed using &lt;code&gt;&lt;b&gt;Output.java&lt;/b&gt;&lt;/code&gt;.
     *
     *  @param       IP          The starting IP address (subnet)
     *  @param       IPPrefix    Number of IP addresses for smaller prefix
     *  @param       noPrefix    Number of smaller prefixes within the total
     *                           prefix
     *  @param       endPrefix   Prefix of total number of IP Addresses
     */
    public void prefixInPrefixCalculate(String IP, String IPPrefix,
            int noPrefix, String endPrefix){
        try {
<span class="fc" id="L329">            String [] [] output = new String [noPrefix + 8] [2];</span>
            
<span class="fc" id="L331">            checkIPType(IP.length() - 1);</span>
<span class="fc" id="L332">            String subnet = convert(IP);</span>
            
<span class="fc" id="L334">            String netmask = getNetmask(IPPrefix);</span>
<span class="fc" id="L335">            calculate(IP, IPPrefix);</span>
            
<span class="fc bfc" id="L337" title="All 2 branches covered.">            for (int i = 0; i &lt; noPrefix; i++){</span>
<span class="fc" id="L338">                calculate(IP, IPPrefix);</span>
<span class="fc" id="L339">                output [i] [0] = getStartIP() + &quot; &quot; + prefix;</span>
<span class="fc" id="L340">                output [i] [1] = IPRangeAddress;</span>
<span class="fc" id="L341">                IP = addBinary(fullReassembler.substring(MAXPREFIX, fullReassembler.length()), Integer.toBinaryString(1));</span>
<span class="fc" id="L342">                fullReassembler = &quot;&quot;;</span>
            }
<span class="fc" id="L344">            output [noPrefix + 1] [0] = &quot;Total usable IP Addresses :&quot;;</span>
<span class="fc" id="L345">            NumberFormat formatter = new DecimalFormat(</span>
                &quot;###,###,###,###,###,###,###,###,###,###,###,###,###&quot;);
<span class="fc" id="L347">            output [noPrefix + 1] [1] = formatter.format(totalIPAddresses.multiply(new BigInteger(</span>
                    noPrefix + &quot;&quot;))) + &quot; &quot;;
<span class="fc" id="L349">            output [noPrefix + 2] [0] = &quot;Subnet:&quot;;</span>
<span class="fc" id="L350">            output [noPrefix + 2] [1] = subnet;</span>
            
<span class="fc" id="L352">            StringTokenizer subnetTokens = new StringTokenizer(convertToBinary(subnet), DELIMITER);</span>
            
<span class="fc" id="L354">            String paddedSubnet = &quot;&quot;;</span>
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">            while (subnetTokens.hasMoreTokens()){</span>
<span class="nc" id="L356">                String unpaddedSubnet = subnetTokens.nextToken();</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">                while (unpaddedSubnet.length() &lt; lengthOfToken)</span>
<span class="nc" id="L358">                    unpaddedSubnet = &quot;0&quot; + unpaddedSubnet;</span>
<span class="nc" id="L359">                paddedSubnet += unpaddedSubnet;</span>
<span class="nc" id="L360">            }</span>
            
<span class="fc" id="L362">            output [noPrefix + 3] [0] = &quot;Binary Subnet:&quot;;</span>
<span class="fc" id="L363">            output [noPrefix + 3] [1] = getBinaryIP(paddedSubnet);</span>
<span class="fc" id="L364">            output [noPrefix + 4] [0] = &quot;Broadcast Address:&quot;;</span>
<span class="fc" id="L365">            output [noPrefix + 4] [1] = currentIP;</span>
<span class="fc" id="L366">            output [noPrefix + 5] [0] = &quot;Prefix:&quot;;</span>
<span class="fc" id="L367">            output [noPrefix + 5] [1] = endPrefix;</span>
<span class="fc" id="L368">            checkIPType(netmask.length() - 1);</span>
<span class="fc" id="L369">            output [noPrefix + 6] [0] = &quot;Netmask&quot;;</span>
<span class="fc" id="L370">            output [noPrefix + 6] [1] = convert(netmask);</span>
<span class="fc" id="L371">            output [noPrefix + 7] [0] = &quot;Binary Netmask:&quot;;</span>
<span class="fc" id="L372">            output [noPrefix + 7] [1] = getBinaryIP(netmask);</span>
<span class="nc" id="L373">            new Output(output);</span>
<span class="nc" id="L374">        } catch (OutOfMemoryError e) {</span>
<span class="nc" id="L375">            new IPv4().displayError(&quot;Your computer does not have sufficent &quot; +</span>
                    &quot;memory to process this query.&quot;);
<span class="nc" id="L377">        }</span>
<span class="nc" id="L378">    }</span>
    
    /**
     *  Determines whether an IP Address provided in binary form is an IPv4 or
     *  an IPv6 by the length of the binary string.
     *
     *  @param       size1    Length of binary string
     */
    private void checkIPType(int size1){
<span class="fc bfc" id="L387" title="All 2 branches covered.">        if (size1 == 31) {</span>
<span class="fc" id="L388">            isIPv4 = true;</span>
<span class="fc" id="L389">            lengthOfToken = 8;</span>
<span class="fc" id="L390">            DELIMITER = &quot;.&quot;;</span>
<span class="fc" id="L391">            MAXPREFIX = 32;</span>
<span class="pc bpc" id="L392" title="1 of 2 branches missed.">        } else if (size1 == 127) {</span>
<span class="nc" id="L393">            isIPv6 = true;</span>
<span class="nc" id="L394">            lengthOfToken = 16;</span>
<span class="nc" id="L395">            DELIMITER = &quot;:&quot;;</span>
<span class="nc" id="L396">            MAXPREFIX = 128;</span>
        }
<span class="fc" id="L398">        semiCol = lengthOfToken - 1;</span>
<span class="fc" id="L399">    }</span>
    
    /**
     *  Reconstructs the dotted-decimal or hexidecimal IP address with
     *  seperators from an given binary IP Address. The reconstructed IP address
     *  is stored as a global declared variable, &lt;code&gt;currentIP&lt;/code&gt;.
     *
     *  @param   IP  An binary IP Address to be converted back into
     *               dotted-decimal or hexidecimal format
     */
    private String convert(String binaryIP){
<span class="fc" id="L410">        String outputIP = &quot;&quot;;</span>
<span class="fc" id="L411">        String reassembler = &quot;&quot;;</span>
<span class="fc bfc" id="L412" title="All 2 branches covered.">        for (int i = 0; i &lt; binaryIP.length(); i++){</span>
<span class="fc" id="L413">            reassembler += binaryIP.charAt(i);</span>
<span class="fc" id="L414">            fullReassembler += binaryIP.charAt(i);</span>
<span class="fc bfc" id="L415" title="All 2 branches covered.">            if (i == semiCol){</span>
<span class="fc bfc" id="L416" title="All 2 branches covered.">                if (isIPv4){</span>
<span class="fc" id="L417">                    outputIP += Integer.parseInt(reassembler, 2);</span>
<span class="fc" id="L418">                    reassembler = &quot;&quot;;</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">                } else if (isIPv6) {</span>
<span class="fc" id="L420">                    outputIP += Integer.toHexString(Integer.parseInt(</span>
                            reassembler, 2));
<span class="fc" id="L422">                    reassembler = &quot;&quot;;</span>
                }
                
<span class="fc bfc" id="L425" title="All 2 branches covered.">                if (i != (binaryIP.length() - 1))</span>
<span class="fc" id="L426">                    outputIP += DELIMITER;</span>
<span class="fc" id="L427">                semiCol = semiCol + lengthOfToken;</span>
            }
        }
<span class="fc" id="L430">        return outputIP;</span>
    }
    
    /**
     *  Converts an given IPv4 or IPv6 address into binary format.
     *
     *  @param   IP  An IP Address to be converted back into binary format
     *  @return  Binary representation of given IP Address.
     */
    private String convertToBinary(String IP){
<span class="fc" id="L440">        StringTokenizer octetToken = new StringTokenizer(IP);</span>
<span class="fc" id="L441">        String output = &quot;&quot;;</span>
<span class="fc" id="L442">        int radix = 0;</span>
<span class="fc bfc" id="L443" title="All 2 branches covered.">        if (isIPv4)</span>
<span class="fc" id="L444">            radix = 10;</span>
<span class="fc bfc" id="L445" title="All 2 branches covered.">        else if (isIPv6)</span>
<span class="fc" id="L446">            radix = 16;</span>
<span class="fc bfc" id="L447" title="All 2 branches covered.">        while (octetToken.hasMoreTokens()){</span>
<span class="fc" id="L448">            String out = Integer.toBinaryString(Integer.parseInt(</span>
<span class="fc" id="L449">                    octetToken.nextToken(&quot;.:&quot;), radix));</span>
<span class="fc bfc" id="L450" title="All 2 branches covered.">            while (out.length() &lt; lengthOfToken)</span>
<span class="fc" id="L451">                out = &quot;0&quot; + out;</span>
<span class="fc" id="L452">            output += out;</span>
<span class="fc" id="L453">        }</span>
<span class="fc" id="L454">        return output;</span>
    }
    
    /**
     *  Gets the starting IP of an IP range.
     *
     *  @return     Starting IP of IP range
     */
    private String getStartIP(){
<span class="fc" id="L463">        StringTokenizer tokens = new StringTokenizer(IPRangeAddress, &quot; -&quot;);</span>
<span class="fc" id="L464">        return tokens.nextToken();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>