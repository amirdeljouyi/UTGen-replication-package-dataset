<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InternalGmHeroFrame.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">12_dsachat</a> &gt; <a href="index.source.html" class="el_package">dsachat.gm.gui</a> &gt; <span class="el_source">InternalGmHeroFrame.java</span></div><h1>InternalGmHeroFrame.java</h1><pre class="source lang-java linenums">package dsachat.gm.gui;

import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.util.Vector;

import javax.swing.ButtonGroup;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JInternalFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.JTree;
import javax.swing.SpinnerModel;
import javax.swing.SpinnerNumberModel;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.TreePath;
import javax.swing.tree.TreeSelectionModel;

import dsachat.share.hero.Hero;
import dsachat.share.hero.Weapon;

/**
 * this displays the heros or the enemies
 * it can send challenges or challenge requests.
 * @author bernshausen
 *
 */
public class InternalGmHeroFrame extends JInternalFrame implements TreeSelectionListener{
	
	/**
	 * 
	 */
	private static final long serialVersionUID = -8647088721012280920L;
	private GmFrame parent;
	private JTree tree;
	private JButton btnExec;
	private JSpinner spnMod;
	private MultiHeroTreeModel model;
	private JComboBox cmbUsers;
	private JRadioButton radAttack;
	private JRadioButton radDefense;
	private String frameName;
	
	/**
	 * set up a new window
	 * @param parent the parent component and action listener
	 * @param heros the data to display in tree
	 * @param name the name and caption of this frame 
	 */
	public InternalGmHeroFrame(GmFrame parent, Vector&lt;Hero&gt; heros, String name)  {
<span class="nc" id="L58">	    super(name,</span>
	          true, //resizable
	          true, //closable
	          true, //maximizable
	          true);//iconifiable
<span class="nc" id="L63">	    frameName=name;</span>
<span class="nc" id="L64">	    this.parent=parent;</span>
	    //...Create the GUI and put it in the window...
	    //...Then set the window size or call pack...
<span class="nc" id="L67">	    model = new MultiHeroTreeModel(name, heros);</span>
<span class="nc" id="L68">	    createGUI();</span>
	    //Set the window's location.
<span class="nc" id="L70">	    Dimension drawSize = parent.getSize();</span>
<span class="nc" id="L71">		setSize(400,drawSize.height-55);</span>
<span class="nc" id="L72">	    setLocation(drawSize.width-405, 0);</span>
<span class="nc" id="L73">	}</span>
	
	/**
	 * create the components that can be viewed and used
	 */
	private void createGUI() {
<span class="nc" id="L79">		setLayout(new GridBagLayout());</span>
<span class="nc" id="L80">		GridBagConstraints c = new GridBagConstraints();</span>
		
		//the tree
<span class="nc" id="L83">		tree = new JTree(model);</span>
<span class="nc" id="L84">		tree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);</span>
<span class="nc" id="L85">		tree.addTreeSelectionListener(this);</span>
		
<span class="nc" id="L87">		JScrollPane scrTree = new JScrollPane(tree);</span>
		
<span class="nc" id="L89">		c.gridx=0;</span>
<span class="nc" id="L90">		c.gridy=0;</span>
<span class="nc" id="L91">		c.fill=GridBagConstraints.BOTH;</span>
<span class="nc" id="L92">		c.weightx=1.0;</span>
<span class="nc" id="L93">		c.weighty=0.8;</span>
<span class="nc" id="L94">		c.insets=new Insets(0,0,5,0);</span>
<span class="nc" id="L95">		add(scrTree,c);</span>
		
		//the rest is done in a panel
<span class="nc" id="L98">		JPanel pnlConfigure = new JPanel(new GridBagLayout());</span>
		
		//enemies can execute attacks and defenses
<span class="nc bnc" id="L101" title="All 2 branches missed.">		if(!frameName.equals(&quot;Heros&quot;)){</span>
			//button if attack or not.
<span class="nc" id="L103">			radAttack = new JRadioButton(&quot;attack&quot;);</span>
<span class="nc" id="L104">			radAttack.setEnabled(false);</span>
<span class="nc" id="L105">			c.gridx=0;</span>
<span class="nc" id="L106">			c.gridy=0;</span>
<span class="nc" id="L107">			c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L108">			c.weightx=0.0;</span>
<span class="nc" id="L109">			c.weighty=0.0;</span>
<span class="nc" id="L110">			c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L111">			pnlConfigure.add(radAttack,c);</span>
			
<span class="nc" id="L113">			radDefense = new JRadioButton(&quot;defense&quot;);</span>
<span class="nc" id="L114">			radDefense.setEnabled(false);</span>
<span class="nc" id="L115">			c.gridx++;</span>
<span class="nc" id="L116">			c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L117">			c.weightx=0.0;</span>
<span class="nc" id="L118">			c.weighty=0.0;</span>
<span class="nc" id="L119">			c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L120">			pnlConfigure.add(radDefense,c);</span>
			
<span class="nc" id="L122">			ButtonGroup bg = new ButtonGroup();</span>
<span class="nc" id="L123">			bg.add(radAttack);</span>
<span class="nc" id="L124">			bg.add(radDefense);</span>
			
<span class="nc" id="L126">			JLabel lblUser = new JLabel(&quot;To user&quot;);</span>
<span class="nc" id="L127">			c.gridx=0;</span>
<span class="nc" id="L128">			c.gridy++;</span>
<span class="nc" id="L129">			c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L130">			c.weightx=0.0;</span>
<span class="nc" id="L131">			c.weighty=0.0;</span>
<span class="nc" id="L132">			c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L133">			pnlConfigure.add(lblUser,c);</span>
			
<span class="nc" id="L135">			cmbUsers = new JComboBox();</span>
<span class="nc" id="L136">			cmbUsers.addItem(&quot;All&quot;);</span>
<span class="nc" id="L137">			c.gridx++;</span>
<span class="nc" id="L138">			c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L139">			c.weightx=0.0;</span>
<span class="nc" id="L140">			c.weighty=0.0;</span>
<span class="nc" id="L141">			c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L142">			pnlConfigure.add(cmbUsers,c);</span>
		}
		
		//set a difficulty for the challenge
<span class="nc" id="L146">		JLabel lblMod = new JLabel(&quot;Modification&quot;);</span>
<span class="nc" id="L147">		c.gridx=0;</span>
<span class="nc" id="L148">		c.gridy++;</span>
<span class="nc" id="L149">		c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L150">		c.weightx=0.0;</span>
<span class="nc" id="L151">		c.weighty=0.0;</span>
<span class="nc" id="L152">		c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L153">		pnlConfigure.add(lblMod,c);</span>
		
		
<span class="nc" id="L156">		SpinnerModel model =</span>
	        new SpinnerNumberModel(0, //initial value
	                               -20, //min
	                               20, //max
	                               1);//step
<span class="nc" id="L161">		spnMod = new JSpinner(model);</span>
<span class="nc" id="L162">		c.gridx++;</span>
<span class="nc" id="L163">		c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L164">		c.weightx=0.0;</span>
<span class="nc" id="L165">		c.weighty=0.0;</span>
<span class="nc" id="L166">		c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L167">		pnlConfigure.add(spnMod,c);</span>
		
		//execute the challenge or challenge request
<span class="nc" id="L170">		btnExec = new JButton(&quot;roll&quot;);</span>
<span class="nc" id="L171">		btnExec.setActionCommand(&quot;challenge&quot;);</span>
<span class="nc" id="L172">		btnExec.addActionListener(parent);</span>
<span class="nc" id="L173">		btnExec.setEnabled(true);</span>
<span class="nc" id="L174">		c.gridx=0;</span>
<span class="nc" id="L175">		c.gridy++;</span>
<span class="nc" id="L176">		c.fill=GridBagConstraints.NONE;</span>
<span class="nc" id="L177">		c.weightx=0.0;</span>
<span class="nc" id="L178">		c.weighty=0.0;</span>
<span class="nc" id="L179">		c.insets=new Insets(5,5,5,5);</span>
<span class="nc" id="L180">		pnlConfigure.add(btnExec,c);</span>
		
<span class="nc" id="L182">		c.gridx=0;</span>
<span class="nc" id="L183">		c.gridy=1;</span>
<span class="nc" id="L184">		c.fill=GridBagConstraints.BOTH;</span>
<span class="nc" id="L185">		c.weightx=1.0;</span>
<span class="nc" id="L186">		c.weighty=0.2;</span>
<span class="nc" id="L187">		c.insets=new Insets(5,0,0,0);</span>
<span class="nc" id="L188">		add(pnlConfigure,c);</span>
		
		//TODO Button for initiative
		
<span class="nc" id="L192">		setVisible(true);</span>
<span class="nc" id="L193">	}</span>
	
	/**
	 * get the selected path from the tree
	 * @return the selected tree path
	 */
	public TreePath getSelectedPath(){
<span class="nc bnc" id="L200" title="All 2 branches missed.">		if(tree.getSelectionPath() != null){</span>
<span class="nc" id="L201">			return tree.getSelectionPath();</span>
		}
<span class="nc" id="L203">		return null;</span>
	}
	
	/**
	 * get the name of the receiver for a challenge request or the
	 * result of a challenge
	 * @return the receiver
	 */
	public String getReceiver(){
<span class="nc" id="L212">		return (String)cmbUsers.getSelectedItem();</span>
	}
	
	/**
	 * get the difficulty for the challenge
	 * @return the difficulty
	 */
	public int getMod(){
<span class="nc" id="L220">		return (Integer)spnMod.getValue();</span>
	}
	
	/**
	 * enable the execution button
	 */
	public void enableButton(){
<span class="nc" id="L227">		btnExec.setEnabled(true);</span>
<span class="nc" id="L228">	}</span>
	
	/**
	 * update the combobox for sending data to
	 * when a user connects or disconnects
	 * @param userlist
	 */
	public void updateUsers(String[] userlist){
<span class="nc" id="L236">		cmbUsers.removeAllItems();</span>
<span class="nc" id="L237">		cmbUsers.addItem(&quot;All&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">		for(int i=0; i&lt;userlist.length; i++){</span>
<span class="nc" id="L239">			cmbUsers.addItem(userlist[i]);</span>
		}
<span class="nc" id="L241">	}</span>
	
	/**
	 * the game master should not use silent mode.
	 * He has to know all results 
	 * @return false
	 */
	public boolean silent(){
<span class="nc" id="L249">		return false;			</span>
	}

	public void valueChanged(TreeSelectionEvent e) {
		//do not select anything when the user doesn't select a leaf
		//GM can't execute fights for the clients
<span class="nc bnc" id="L255" title="All 2 branches missed.">		if(!model.isLeaf(e.getPath().getLastPathComponent()) ||</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">				( e.getPath().getLastPathComponent().getClass().equals(Weapon.class)) &amp;&amp;</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">					frameName.equals(&quot;Heros&quot;)){</span>
<span class="nc" id="L258">			tree.getSelectionModel().clearSelection();</span>
<span class="nc" id="L259">			btnExec.setEnabled(false);</span>
		}else{
			//let the GM execute a challenge 
<span class="nc" id="L262">			btnExec.setEnabled(true);</span>
		}
		//enable attack of defense when the GM selected a weapon of an enemy
<span class="nc bnc" id="L265" title="All 2 branches missed.">		if(!frameName.equals(&quot;Heros&quot;)){</span>
			try{
<span class="nc" id="L267">				if(tree.getSelectionPath().getLastPathComponent().getClass()</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">						.equals(Weapon.class)){</span>
<span class="nc" id="L269">					radDefense.setEnabled(true);</span>
<span class="nc" id="L270">					radAttack.setEnabled(true);</span>
				}else{
<span class="nc" id="L272">					radDefense.setEnabled(false);</span>
<span class="nc" id="L273">					radAttack.setEnabled(false);</span>
				}
<span class="nc" id="L275">			}catch(Exception e1){</span>
				//not so bad
<span class="nc" id="L277">				radDefense.setEnabled(false);</span>
<span class="nc" id="L278">				radAttack.setEnabled(false);</span>
<span class="nc" id="L279">				return;</span>
<span class="nc" id="L280">			}</span>
		}
<span class="nc" id="L282">	}</span>
	
	/**
	 * Update the view of this tree
	 * @param h the new data
	 */
	public void updateHero(Vector&lt;Hero&gt; h){
<span class="nc" id="L289">		model.fireTreeStructureChanged(h);</span>
<span class="nc" id="L290">	}</span>
	
	/**
	 * get the frame name (Heros|Enemies)
	 * @return the type of the loaded heros
	 */
	public String getFrameName() {
<span class="nc" id="L297">		return frameName;</span>
	}

	/**
	 * return if this challenge is a attack or defense
	 * @return true if it is an attack
	 */
	public boolean isAttack(){
<span class="nc" id="L305">		return radAttack.isSelected();</span>
	}
	
	/**
	 * get the data of tree
	 * @return the heros stored in the tree
	 */
	public Vector&lt;Hero&gt; getData(){
<span class="nc" id="L313">		return model.heros;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>