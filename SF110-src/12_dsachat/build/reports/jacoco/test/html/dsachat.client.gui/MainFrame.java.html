<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MainFrame.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">12_dsachat</a> &gt; <a href="index.source.html" class="el_package">dsachat.client.gui</a> &gt; <span class="el_source">MainFrame.java</span></div><h1>MainFrame.java</h1><pre class="source lang-java linenums">package dsachat.client.gui;

import java.awt.Dimension;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.net.MalformedURLException;
import java.io.IOException;
import java.io.PrintStream;
import java.net.UnknownHostException;
import java.security.GeneralSecurityException;

import javax.swing.JButton;
import javax.swing.JDesktopPane;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JLayeredPane;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JRootPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextField;
import javax.swing.KeyStroke;
import javax.swing.filechooser.FileFilter;

import org.dom4j.Document;
import org.dom4j.DocumentException;
import org.dom4j.io.SAXReader;

import dsachat.Main;
import dsachat.client.net.SecClient;
import dsachat.share.ChallReq;
import dsachat.share.Challenge;
import dsachat.share.ConnectionEndpoint;
import dsachat.share.InputEvent;
import dsachat.share.InputListener;
import dsachat.share.UserEvent;
import dsachat.share.hero.Attribute;
import dsachat.share.hero.Hero;
import dsachat.share.hero.Spell;
import dsachat.share.hero.Talent;
import dsachat.share.hero.Weapon;

public class MainFrame extends JFrame implements ActionListener, InputListener{

	/**
	 * 
	 */
	private static final long serialVersionUID = 8378774179863177398L;
	
	JDesktopPane desktop;
	SecClient cl;
<span class="nc" id="L60">	Hero hero = null;</span>
	private InternalChatFrame icf;
	private InternalHeroFrame ihf;
	
	public MainFrame(){
<span class="nc" id="L65">		super(&quot;DSA Chat Client&quot;);</span>

        //Make the big window be indented 50 pixels from each edge
        //of the screen.
<span class="nc" id="L69">        int inset = 50;</span>
<span class="nc" id="L70">        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();</span>
<span class="nc" id="L71">        setBounds(inset, inset,</span>
                  screenSize.width -inset*2,
                  screenSize.height - inset*2);

        //Set up the GUI.
<span class="nc" id="L76">        desktop = new JDesktopPane(); //a specialized layered pane</span>
<span class="nc" id="L77">        setContentPane(desktop);</span>
<span class="nc" id="L78">        setJMenuBar(createMenuBar());</span>
<span class="nc" id="L79">        setDefaultLookAndFeelDecorated(true);</span>
        //Make dragging a little faster but perhaps uglier.
//        desktop.setDragMode(JDesktopPane.OUTLINE_DRAG_MODE);
<span class="nc" id="L82">        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>
<span class="nc" id="L83">        createInternalFrames();</span>
<span class="nc" id="L84">	}</span>
	
	private void createInternalFrames() {
<span class="nc" id="L87">		icf = new InternalChatFrame(this);</span>
<span class="nc" id="L88">		icf.setVisible(true);</span>
<span class="nc" id="L89">		desktop.add(icf);</span>
		try {
<span class="nc" id="L91">            icf.setSelected(true);</span>
<span class="nc" id="L92">        } catch (java.beans.PropertyVetoException e) {}</span>
<span class="nc" id="L93">	}</span>

	protected JMenuBar createMenuBar() {
<span class="nc" id="L96">        JMenuBar menuBar = new JMenuBar();</span>

        //Set up the file menu.
<span class="nc" id="L99">        JMenu menu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L100">        menu.setMnemonic(KeyEvent.VK_F);</span>
<span class="nc" id="L101">        menuBar.add(menu);</span>
        
        //load hero item
<span class="nc" id="L104">        JMenuItem menuItem = new JMenuItem(&quot;Load hero&quot;);</span>
<span class="nc" id="L105">        menuItem.setMnemonic(KeyEvent.VK_L);</span>
<span class="nc" id="L106">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
        		KeyEvent.VK_L, ActionEvent.ALT_MASK));
<span class="nc" id="L108">        menuItem.setActionCommand(&quot;load&quot;);</span>
<span class="nc" id="L109">        menuItem.addActionListener(this);</span>
<span class="nc" id="L110">        menu.add(menuItem);</span>
        
        //save chat log
<span class="nc" id="L113">        menuItem = new JMenuItem(&quot;Save Chat Log&quot;);</span>
<span class="nc" id="L114">        menuItem.setMnemonic(KeyEvent.VK_S);</span>
<span class="nc" id="L115">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
                KeyEvent.VK_S, ActionEvent.ALT_MASK));
<span class="nc" id="L117">        menuItem.setActionCommand(&quot;save&quot;);</span>
<span class="nc" id="L118">        menuItem.addActionListener(this);</span>
<span class="nc" id="L119">        menu.add(menuItem);</span>

        //Set up the quit menu item.
<span class="nc" id="L122">        menuItem = new JMenuItem(&quot;Quit&quot;);</span>
<span class="nc" id="L123">        menuItem.setMnemonic(KeyEvent.VK_Q);</span>
<span class="nc" id="L124">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
                KeyEvent.VK_Q, ActionEvent.ALT_MASK));
<span class="nc" id="L126">        menuItem.setActionCommand(&quot;quit&quot;);</span>
<span class="nc" id="L127">        menuItem.addActionListener(this);</span>
<span class="nc" id="L128">        menu.add(menuItem);</span>
        
        
<span class="nc" id="L131">        JMenu connectMenu = new JMenu(&quot;Connection&quot;);</span>
<span class="nc" id="L132">        connectMenu.setMnemonic(KeyEvent.VK_O);</span>
<span class="nc" id="L133">        menuBar.add(connectMenu);</span>
        
        //Set up the connect menu item.
<span class="nc" id="L136">        menuItem = new JMenuItem(&quot;Connect&quot;);</span>
<span class="nc" id="L137">        menuItem.setMnemonic(KeyEvent.VK_C);</span>
<span class="nc" id="L138">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
        		KeyEvent.VK_C, ActionEvent.ALT_MASK));
<span class="nc" id="L140">        menuItem.setActionCommand(&quot;connect&quot;);</span>
<span class="nc" id="L141">        menuItem.addActionListener(this);</span>
<span class="nc" id="L142">        connectMenu.add(menuItem);</span>
        
        //help section
<span class="nc" id="L145">        menu = new JMenu(&quot;Help&quot;);</span>
<span class="nc" id="L146">        menu.setMnemonic(KeyEvent.VK_H);</span>
<span class="nc" id="L147">        menuBar.add(menu);</span>
        
<span class="nc" id="L149">        menuItem = new JMenuItem(&quot;Help&quot;);</span>
<span class="nc" id="L150">        menuItem.setMnemonic(KeyEvent.VK_H);</span>
<span class="nc" id="L151">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
        		KeyEvent.VK_H, ActionEvent.ALT_MASK));
<span class="nc" id="L153">        menuItem.setActionCommand(&quot;help&quot;);</span>
<span class="nc" id="L154">        menuItem.addActionListener(this);</span>
<span class="nc" id="L155">        menu.add(menuItem);</span>
        
<span class="nc" id="L157">        menuItem = new JMenuItem(&quot;About&quot;);</span>
<span class="nc" id="L158">        menuItem.setMnemonic(KeyEvent.VK_A);</span>
<span class="nc" id="L159">        menuItem.setAccelerator(KeyStroke.getKeyStroke(</span>
        		KeyEvent.VK_A, ActionEvent.ALT_MASK));
<span class="nc" id="L161">        menuItem.setActionCommand(&quot;about&quot;);</span>
<span class="nc" id="L162">        menuItem.addActionListener(this);</span>
<span class="nc" id="L163">        menu.add(menuItem);</span>
        

<span class="nc" id="L166">        return menuBar;</span>
    }

	public void actionPerformed(ActionEvent e) {
		/*
		 * switch action types
		 * most actions will send something to server
		 */
		//connect client to server
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;connect&quot;)){</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">			if(hero == null){</span>
				//no hero loaded. User has to do this before connecting
<span class="nc" id="L178">				JOptionPane.showMessageDialog(this,</span>
						&quot;You have to load a hero first&quot;, &quot;No hero found&quot;,
						JOptionPane.WARNING_MESSAGE);
<span class="nc" id="L181">				return;</span>
			}
<span class="nc" id="L183">    		cl = new SecClient();</span>
    		try {
    			//ask user to calculate parameters
<span class="nc" id="L186">    			String[] options = {&quot;Yes&quot;,&quot;No&quot;};</span>
<span class="nc" id="L187">    			int res = JOptionPane.showOptionDialog(this,</span>
    					&quot;Calculate new DH Parameters?\n&quot; +
    					&quot;This can take VERY long&quot;, &quot;new parameters&quot;,
    					JOptionPane.YES_NO_OPTION,
    					JOptionPane.QUESTION_MESSAGE,
    					null, options , options[1]);
<span class="nc bnc" id="L193" title="All 2 branches missed.">    			boolean calcparam = (res==JOptionPane.YES_OPTION)?true:false;</span>
<span class="nc" id="L194">				cl.initialize(calcparam);</span>
				//connect. when we can't connect ask user again
<span class="nc bnc" id="L196" title="All 2 branches missed.">				if(!connect(null))</span>
<span class="nc" id="L197">					return;</span>
<span class="nc" id="L198">				cl.addInputListener(this);</span>
<span class="nc" id="L199">				cl.start();</span>
				//exchange DH public keys
<span class="nc" id="L201">				cl.exchange();</span>
				//wait for connection
<span class="nc bnc" id="L203" title="All 2 branches missed.">				while(!cl.isConnected()){</span>
<span class="nc" id="L204">					continue;</span>
				}
				//send the loaded hero
<span class="nc" id="L207">				send(hero);</span>
				//after we have a hero sent we can use the challenges
<span class="nc" id="L209">				enableExecButtons();</span>
<span class="nc" id="L210">			} catch (GeneralSecurityException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L212">				e1.printStackTrace();</span>
<span class="nc" id="L213">			} catch (UnknownHostException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L215">				e1.printStackTrace();</span>
<span class="nc" id="L216">			} catch (IOException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L218">				e1.printStackTrace();</span>
<span class="nc" id="L219">			} </span>
		}
		//disconnect and quit
<span class="nc bnc" id="L222" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;quit&quot;)){</span>
			try {
<span class="nc" id="L224">				cl.disconnect();</span>
<span class="nc" id="L225">			} catch (IOException e1) {</span>
				// exit anyway
<span class="nc" id="L227">			}</span>
<span class="nc" id="L228">			System.exit(0);</span>
		}
		//load a hero from xml file
<span class="nc bnc" id="L231" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;load&quot;)){</span>
			//get hero as xml
			//get file from user
			File input; 
<span class="nc" id="L235">			JFileChooser chooser = new JFileChooser(</span>
<span class="nc" id="L236">					new File(System.getProperty(&quot;user.home&quot;, &quot;.&quot;)));</span>
<span class="nc" id="L237">		    FileFilter ff = new FileFilter(){</span>

				@Override
				public boolean accept(File arg0) {
<span class="nc bnc" id="L241" title="All 2 branches missed.">					if(arg0.getAbsolutePath().endsWith(&quot;.xml&quot;));</span>
<span class="nc" id="L242">					return false;</span>
				}
				
				public String getDescription(){
<span class="nc" id="L246">					return &quot;XML Files&quot;;</span>
				}
		    	
		    };
<span class="nc" id="L250">		    chooser.setFileFilter(ff);</span>
<span class="nc" id="L251">		    int returnVal = chooser.showOpenDialog(this);</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		    if(returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L253">		       input = chooser.getSelectedFile();</span>
		    }else{
<span class="nc" id="L255">		    	return; //do nothing when user doesn't want to</span>
		    }
		    //parse document
<span class="nc" id="L258">    		SAXReader reader = new SAXReader();</span>
    	    Document doc;
			try {
<span class="nc" id="L261">				doc = reader.read(input);</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">				if(hero == null){</span>
<span class="nc" id="L263">					hero = new Hero(doc);</span>
					//open new frame
<span class="nc" id="L265">					ihf = new InternalHeroFrame(this,hero);</span>
<span class="nc" id="L266">					ihf.setVisible(true);</span>
<span class="nc" id="L267">					desktop.add(ihf);</span>
				}else{//just update
<span class="nc" id="L269">					Hero h = new Hero(doc);</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">					if(h.getName().equals(hero.getName())){</span>
<span class="nc" id="L271">						ihf.updateHero(h);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">						if(cl.isAlive()){</span>
<span class="nc" id="L273">							send(hero);</span>
						}
					}else{
<span class="nc" id="L276">						JOptionPane.showMessageDialog(this,</span>
								&quot;The name of this Hero ist not the same as the old Hero&quot;,
								&quot;Wrong hero loaded&quot;,
								JOptionPane.ERROR_MESSAGE);
					}
				}
<span class="nc" id="L282">			} catch (MalformedURLException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L284">				e1.printStackTrace();			</span>
<span class="nc" id="L285">			} catch (DocumentException e1) {//Hero could not be parsed</span>
				// TODO Auto-generated catch block
<span class="nc" id="L287">				e1.printStackTrace();</span>
<span class="nc" id="L288">			}</span>
		}
		//send chat message to server
<span class="nc bnc" id="L291" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;sendInput&quot;)){</span>
<span class="nc" id="L292">			JTextField source = (JTextField)e.getSource();</span>
<span class="nc" id="L293">			source.select(0, source.getText().length());</span>
<span class="nc" id="L294">			send(source.getText());</span>
		}
		//send a challenge and let the server execute it
<span class="nc bnc" id="L297" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;challenge&quot;)){</span>
			//get the frame where the data can be found through component tree
<span class="nc" id="L299">			InternalHeroFrame fr = (InternalHeroFrame)((JRootPane)((JLayeredPane)</span>
					((JPanel)((JTabbedPane)((JPanel)
<span class="nc" id="L301">					((JPanel)((JButton)e.getSource()).getParent()).getParent())</span>
<span class="nc" id="L302">					.getParent()).getParent()).getParent()).getParent()).getParent();</span>
			//get selected item of that frame
<span class="nc" id="L304">			Object o = fr.getSelectedItem();</span>
<span class="nc bnc" id="L305" title="All 2 branches missed.">			if(o == null){</span>
				//signal user that he has to select an item
<span class="nc" id="L307">				JOptionPane.showInternalMessageDialog(fr,</span>
						&quot;No Item selected, nothing sent&quot;, &quot;Warning&quot;,
						JOptionPane.INFORMATION_MESSAGE);
				//do not send a challenge
<span class="nc" id="L311">				return;</span>
			}
			//get global challenge informations
<span class="nc" id="L314">			Hero h = fr.getHero();</span>
<span class="nc" id="L315">			String to = fr.getReceiver();</span>
<span class="nc" id="L316">			int mod = fr.getMod();</span>
<span class="nc" id="L317">			boolean silent = fr.silent();</span>
<span class="nc bnc" id="L318" title="All 2 branches missed.">			if(to.equals(h.getName())) silent=true;</span>
			Challenge c;
			//Talent and Spell are quite the same
<span class="nc bnc" id="L321" title="All 4 branches missed.">			if (o.getClass().equals(Talent.class)||o.getClass().equals(Spell.class)){</span>
<span class="nc" id="L322">				Talent t = (Talent)o;</span>
<span class="nc" id="L323">				String talName = t.getName();</span>
<span class="nc" id="L324">				c = new Challenge(talName,mod,h,silent,</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">						(to.equals(&quot;All&quot;)?null:to));</span>
			//an attribute is handled different
<span class="nc bnc" id="L327" title="All 2 branches missed.">			}else if(o.getClass().equals(Attribute.class)){</span>
<span class="nc" id="L328">				Attribute a = (Attribute)o;</span>
<span class="nc" id="L329">				String shortc = a.getShortcut();</span>
				//Note that the order is lightly changed
<span class="nc" id="L331">				c = new Challenge(shortc,h,mod,silent,</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">						(to.equals(&quot;All&quot;)?null:to));</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">			}else if(o.getClass().equals(Weapon.class)){</span>
<span class="nc" id="L334">				Weapon w = (Weapon)o;</span>
<span class="nc" id="L335">				System.out.println(w.getType().toString());</span>
<span class="nc" id="L336">				c=new Challenge(w,fr.isAttack(),h,mod,silent,</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">						(to.equals(&quot;All&quot;)?null:to));</span>
<span class="nc" id="L338">			}else{</span>
				//Add new extensions here
<span class="nc" id="L340">				System.out.println(o.getClass());</span>
<span class="nc" id="L341">				return;</span>
			}
<span class="nc" id="L343">			send(c);</span>
		}
		//save Chat Log
<span class="nc bnc" id="L346" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;save&quot;)){</span>
			File outFile; 
<span class="nc" id="L348">			JFileChooser chooser = new JFileChooser(</span>
<span class="nc" id="L349">					new File(System.getProperty(&quot;user.home&quot;, &quot;.&quot;)));</span>
<span class="nc" id="L350">		    int returnVal = chooser.showSaveDialog(this);</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		    if(returnVal == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L352">		    	outFile = chooser.getSelectedFile();</span>
		    }else{
<span class="nc" id="L354">		    	return; //do nothing when user doesn't want to</span>
		    }
		    try {
<span class="nc" id="L357">		    	outFile.createNewFile();</span>
<span class="nc" id="L358">				PrintStream out = new PrintStream(new FileOutputStream(outFile));</span>
<span class="nc" id="L359">				out.println(icf.getChatlog());</span>
<span class="nc" id="L360">			} catch (FileNotFoundException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L362">				e1.printStackTrace();</span>
<span class="nc" id="L363">			} catch (IOException e1) {</span>
				// TODO Auto-generated catch block
<span class="nc" id="L365">				e1.printStackTrace();</span>
<span class="nc" id="L366">			}</span>
		}
<span class="nc bnc" id="L368" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;about&quot;)){</span>
<span class="nc" id="L369">			String about = &quot;Version: &quot;+Main.version;</span>
<span class="nc" id="L370">			JOptionPane.showMessageDialog(this, about, &quot;About&quot;,</span>
					JOptionPane.INFORMATION_MESSAGE);
		}
<span class="nc bnc" id="L373" title="All 2 branches missed.">		if(e.getActionCommand().equals(&quot;help&quot;)){</span>
<span class="nc" id="L374">			String help = &quot;A Hero has to be created with \&quot;Helden\&quot; Software.\n&quot; +</span>
				&quot;Then the hero hat to be exported to a xml-file\n&quot; +
				&quot;which you can load to this program\n\n&quot; +
				&quot;Chat:\n&quot; +
				&quot;\&quot;/w &lt;user&gt; &lt;text&gt;\&quot;\t whisper to another user\n&quot; +
				&quot;\&quot;/d &lt;num&gt;w&lt;sides&gt;\&quot;\t roll dices\n&quot; +
				&quot;\n&quot; +
				&quot;You can also change the color of the users in your text-view\n&quot; +
				&quot;and the background color of the text view. (by right click)\n&quot;;
<span class="nc" id="L383">			JOptionPane.showMessageDialog(this, help, &quot;Help&quot;,</span>
					JOptionPane.INFORMATION_MESSAGE);
		}
<span class="nc" id="L386">	}</span>

	private boolean connect(String msg) {
<span class="nc bnc" id="L389" title="All 2 branches missed.">		String message = (msg==null)?</span>
				&quot;Specify the location of the chat server\n&quot;+
                &quot;This must be in form of host:port\n&quot; +
                &quot;where host is either a name or an IPv4-Address.&quot;:
                &quot;Something went wrong:\n&quot; +
                msg+&quot;\n&quot;+
                &quot;Please specify Server in form of\n&quot; +
                &quot;\&quot;host:port\&quot; where host is a name or an IPv4-address\n&quot; +
                &quot;and port is a number between 1 and 65535&quot;;
<span class="nc" id="L398">		String title = &quot;Server address&quot;;</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">		int type = (msg==null)?JOptionPane.PLAIN_MESSAGE:JOptionPane.ERROR_MESSAGE;</span>
<span class="nc" id="L400">		String s = (String)JOptionPane.showInputDialog(</span>
                this,
                message,
                title,
                type,
                null,
                null,
                &quot;localhost:20001&quot;);
<span class="nc bnc" id="L408" title="All 2 branches missed.">		if(s==null){</span>
<span class="nc" id="L409">			return false; //user canceled</span>
		}
		try {
<span class="nc" id="L412">			String[] addr = s.split(&quot;:&quot;);</span>
			//check IP not possible because it could be a hostname
<span class="nc" id="L414">			String ip = addr[0];</span>
<span class="nc" id="L415">			int port = Integer.parseInt(addr[1]);</span>
<span class="nc bnc" id="L416" title="All 4 branches missed.">			if(port &lt; 1 || port &gt; 65535)</span>
<span class="nc" id="L417">				throw new Exception(&quot;Port not in range 1 to 65535&quot;);</span>
<span class="nc" id="L418">			cl.connect(ip, port);</span>
<span class="nc" id="L419">		} catch (Exception e) {</span>
			//do connect again until connection succeeded or user cancels
<span class="nc" id="L421">			return connect(e.getMessage());</span>
<span class="nc" id="L422">		}</span>
<span class="nc" id="L423">		return true;</span>
	}

	private void enableExecButtons() {
<span class="nc" id="L427">		ihf.enableButton();</span>
<span class="nc" id="L428">	}</span>

	public void handleInput(InputEvent e) {
		// TODO Auto-generated method stub
<span class="nc" id="L432">		Object o = e.getData();</span>
<span class="nc" id="L433">		ConnectionEndpoint ce = e.getSource();</span>
<span class="nc" id="L434">		ce.toString();//TODO just for warning. please delete</span>
<span class="nc bnc" id="L435" title="All 2 branches missed.">		if(o.getClass().equals(String.class)){</span>
<span class="nc" id="L436">			String s = (String)o;</span>
<span class="nc" id="L437">			icf.addText(s);</span>
		}
<span class="nc bnc" id="L439" title="All 2 branches missed.">		if(o.getClass().equals(UserEvent.class)){</span>
<span class="nc" id="L440">			UserEvent ev = (UserEvent)o;</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">			if(ev.isDisconnect()){</span>
<span class="nc" id="L442">				icf.deleteUser(ev.getName());</span>
			}else{
<span class="nc" id="L444">				icf.addUser(ev.getName());</span>
			}
<span class="nc" id="L446">			ihf.updateUsers(icf.getUserlist());</span>
		}
<span class="nc bnc" id="L448" title="All 2 branches missed.">		if(o.getClass().equals(ChallReq.class)){</span>
<span class="nc" id="L449">			ChallReq cr = (ChallReq)o;</span>
			Challenge c;
<span class="nc" id="L451">			boolean silent = true;</span>
<span class="nc" id="L452">			int mod =cr.getMod();</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">			if(cr.getCh().getClass().equals(Talent.class)){</span>
<span class="nc" id="L454">				Talent t = (Talent)cr.getCh();</span>
<span class="nc" id="L455">				c = new Challenge(t.getName(),mod,hero,silent,</span>
<span class="nc" id="L456">						cr.getResponseTo());</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">			}else if(cr.getCh().getClass().equals(Attribute.class)){</span>
<span class="nc" id="L458">				Attribute a = (Attribute)cr.getCh();</span>
<span class="nc" id="L459">				c = new Challenge(a.getShortcut(),hero,mod,silent,</span>
<span class="nc" id="L460">						cr.getResponseTo());</span>
<span class="nc" id="L461">			}else{</span>
				//maybe fight here
<span class="nc" id="L463">				return;</span>
			}
<span class="nc" id="L465">			send(c);</span>
		}
<span class="nc" id="L467">	}</span>
	
	private void send(Object o){
		try {
<span class="nc" id="L471">			cl.send(o);</span>
<span class="nc" id="L472">		} catch (IOException e1) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L474">			e1.printStackTrace();</span>
<span class="nc" id="L475">		}</span>
<span class="nc" id="L476">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>