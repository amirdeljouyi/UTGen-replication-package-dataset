<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Challenge.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">12_dsachat</a> &gt; <a href="index.source.html" class="el_package">dsachat.share</a> &gt; <span class="el_source">Challenge.java</span></div><h1>Challenge.java</h1><pre class="source lang-java linenums">package dsachat.share;

import java.io.Serializable;
import java.util.Vector;

import dsachat.share.hero.Hero;
import dsachat.share.hero.Talent;
import dsachat.share.hero.Weapon;

/**
 * This class represents a challenge.&lt;br&gt;
 * It is created by a client and sent to the server which executes the internal task.
 * &lt;br&gt;
 * A challenge can be a talent, spell, attribute or weapon.
 * @author bernshausen
 *
 */
public class Challenge implements Serializable{
//IDEA return lep,asp,aup loss	
	
	private static final long serialVersionUID = 6777899032409172338L;
<span class="nc" id="L22">	private Talent t = null;</span>
	private int attrib1;
	private int attrib2;
	private int attrib3;
	private int mod;
	private String to;
	private boolean silent;
<span class="nc" id="L29">	private String attrib = null;</span>
	private int attrValue;
<span class="nc" id="L31">	private Weapon w = null;</span>
<span class="nc" id="L32">	private boolean attack=false;</span>
	private int dmgkk;
	
	/**
	 * generate new challenge for spells and talents
	 * @param tal the talents or spells name
	 * @param modification difficulty
	 * @param h the hero to get the parameters
	 * @param silent response to sender?
	 * @param response the receiver of the results
	 */
<span class="nc" id="L43">	public Challenge(String tal,int modification, Hero h,boolean silent,String response){</span>
<span class="nc" id="L44">		t = getTalent(tal,h);</span>
<span class="nc" id="L45">		mod = modification;</span>
<span class="nc" id="L46">		to=response;</span>
<span class="nc" id="L47">		this.silent = silent;</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">		if(t!=null){</span>
<span class="nc" id="L49">			getAttrib(h);</span>
		}
<span class="nc" id="L51">	}</span>
	
	/**
	 * create new attribute challenge
	 * @param attrShortcut the shortcut for the attribute
	 * @param h the hero to get the value
	 * @param modification the difficulty
	 * @param silent response to sender?
	 * @param response the receiver
	 */
	public Challenge(String attrShortcut,Hero h,int modification,
<span class="nc" id="L62">			boolean silent,String response){</span>
<span class="nc" id="L63">		this.silent=silent;</span>
<span class="nc" id="L64">		mod =modification;</span>
<span class="nc" id="L65">		to =response;</span>
<span class="nc" id="L66">		attrib = attrShortcut;</span>
<span class="nc" id="L67">		attrValue = h.getAttrValue(attrShortcut);</span>
<span class="nc" id="L68">	}</span>
	
	/**
	 * create a new challenge for a fight
	 * @param w the weapon
	 * @param attack is attack? else defense
	 * @param h the hero
	 * @param modification difficulty
	 * @param silent response to sender?
	 * @param response the receiver
	 */
	public Challenge(Weapon w,boolean attack,
<span class="nc" id="L80">			Hero h,int modification,boolean silent, String response){</span>
<span class="nc" id="L81">		this.w = w;</span>
<span class="nc" id="L82">		this.mod=modification;</span>
<span class="nc" id="L83">		this.silent=silent;</span>
<span class="nc" id="L84">		this.to=response;</span>
<span class="nc" id="L85">		this.attack = attack;</span>
<span class="nc" id="L86">		dmgkk = 0;</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">		if(h.getAttrValue(&quot;KK&quot;) &gt; w.getKkMin()){</span>
<span class="nc" id="L88">			dmgkk = (h.getAttrValue(&quot;KK&quot;)-w.getKkMin())/w.getKkStep();</span>
		}
		
<span class="nc" id="L91">	}</span>
	
	/**
	 * get the named talent from hero
	 * @param tal the name
	 * @param h the hero
	 * @return the talent (or spell)
	 */
	private Talent getTalent(String tal,Hero h) {
<span class="nc" id="L100">		Vector&lt;Talent&gt; v = h.getTalents();</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		for(int i=0; i&lt;v.size(); i++){</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">			if(v.elementAt(i).getName().equalsIgnoreCase(tal)){</span>
<span class="nc" id="L103">				return v.elementAt(i);</span>
			}
		}
<span class="nc" id="L106">		return null;</span>
	}
	
	/**
	 * Set the attributes for a talent (spell) challenge
	 * @param h the hero to get the values from
	 */
	private void getAttrib(Hero h) {
<span class="nc" id="L114">		String[] ch = t.getChallenge().split(&quot;/&quot;);</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">		if(ch.length!=3){</span>
<span class="nc" id="L116">			return;</span>
		}
<span class="nc" id="L118">		attrib1=getAttribFromHero(h,ch[0]);</span>
<span class="nc" id="L119">		attrib2=getAttribFromHero(h,ch[1]);</span>
<span class="nc" id="L120">		attrib3=getAttribFromHero(h,ch[2]);</span>
<span class="nc" id="L121">	}</span>
	
	/**
	 * return the value of the attribute
	 * @param h the hero
	 * @param attr the shortcut of the attribute
	 * @return the attributes value
	 */
	private int getAttribFromHero(Hero h, String attr){
<span class="nc" id="L130">		return h.getAttrValue(attr);</span>
	}
	
	/**
	 * execute this challenge
	 * differ between talents, attributes or fight
	 * @return the result as string
	 */
	public String roll(){
<span class="nc bnc" id="L139" title="All 2 branches missed.">		if(t!=null)</span>
<span class="nc" id="L140">			return rollTalent();</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">		if(attrib != null)</span>
<span class="nc" id="L142">			return rollAttr();</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">		if(w!=null){</span>
<span class="nc" id="L144">			return rollFight();</span>
		}
<span class="nc" id="L146">		return &quot; missing Talent, Spell, ...&quot;;</span>
	}
	
	/**
	 * roll the attack or defense with the given weapon
	 * @return the results as string
	 */
	private String rollFight() {
<span class="nc" id="L154">		int dices = w.getDices();</span>
<span class="nc" id="L155">		int sides = w.getSides();</span>
<span class="nc" id="L156">		int dmgMod=w.getDmgMod();</span>
<span class="nc" id="L157">		int at = w.getAt();</span>
<span class="nc" id="L158">		int damage =0;</span>
		//set up possible responses
<span class="nc bnc" id="L160" title="All 2 branches missed.">		String good = &quot;good &quot;+ (attack?&quot;attack (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;: &quot;+</span>
				&quot;Enemy's defense is cut in half. Would make &quot; :
<span class="nc" id="L162">				&quot;defense (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;: You gain one action.&quot;);</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">		String bumbler = &quot;bumbler in &quot;+(attack?&quot;attack &quot;:&quot;defense &quot;)+ &quot; (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;&quot;;</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">		String success = &quot;successful &quot;+(attack?&quot;attack (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;. Would make &quot;:</span>
<span class="nc" id="L165">			&quot;defense (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;.&quot;);</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">		String fail = &quot;failed &quot;+(attack?&quot;attack (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;.&quot;:</span>
<span class="nc" id="L167">			&quot;defense (Mod: &quot;+mod+&quot;) with \&quot;&quot;+w.getName()+&quot;\&quot;.&quot;);;</span>
		//calculate damage
<span class="nc bnc" id="L169" title="All 2 branches missed.">		for(int i=0; i&lt;dices; i++){</span>
<span class="nc" id="L170">			damage += Challenge.dice(sides);</span>
		}
<span class="nc" id="L172">		damage +=dmgMod;</span>
		//roll dices
<span class="nc" id="L174">		int roll = Challenge.dice(20);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if(roll == 1){</span>
<span class="nc" id="L176">			roll = Challenge.dice(20);</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">			if(roll + mod &lt;= at ){</span>
<span class="nc" id="L178">				damage *=2;</span>
<span class="nc" id="L179">				damage += dmgkk;</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">				return good +(attack?damage+&quot; damage.&quot;:&quot;&quot;);</span>
			}else{
<span class="nc" id="L182">				damage +=dmgkk;</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">				return success +(attack?damage+&quot; damage.&quot;:&quot;&quot;);</span>
			}
		}
<span class="nc bnc" id="L186" title="All 2 branches missed.">		if(roll == 20){</span>
<span class="nc" id="L187">			roll = Challenge.dice(20);</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">			if(roll + mod &gt; at ){</span>
				//FIXME Patzertabelle
<span class="nc" id="L190">				int bumblerCode = Challenge.dice(6)+Challenge.dice(6);</span>
<span class="nc" id="L191">				String bumblerTxt = &quot;&quot;;</span>
<span class="nc bnc" id="L192" title="All 12 branches missed.">				switch(bumblerCode){</span>
<span class="nc" id="L193">				case  2: bumblerTxt=&quot;Code: &quot;+2;break;</span>
<span class="nc" id="L194">				case  3: bumblerTxt=&quot;Code: &quot;+3;break;</span>
<span class="nc" id="L195">				case  4: bumblerTxt=&quot;Code: &quot;+4;break;</span>
<span class="nc" id="L196">				case  5: bumblerTxt=&quot;Code: &quot;+5;break;</span>
<span class="nc" id="L197">				case  6: bumblerTxt=&quot;Code: &quot;+6;break;</span>
<span class="nc" id="L198">				case  7: bumblerTxt=&quot;Code: &quot;+7;break;</span>
<span class="nc" id="L199">				case  8: bumblerTxt=&quot;Code: &quot;+8;break;</span>
<span class="nc" id="L200">				case  9: bumblerTxt=&quot;Code: &quot;+9;break;</span>
<span class="nc" id="L201">				case 10: bumblerTxt=&quot;Code: &quot;+10;break; </span>
<span class="nc" id="L202">				case 11: bumblerTxt=&quot;Code: &quot;+11;break;</span>
<span class="nc" id="L203">				case 12: bumblerTxt=&quot;Code: &quot;+12;break;</span>
				default :
				}
<span class="nc" id="L206">				return bumbler + bumblerTxt;</span>
			}else{
<span class="nc" id="L208">				return fail;</span>
			}
		}
<span class="nc bnc" id="L211" title="All 2 branches missed.">		if(roll +mod &lt;=at){</span>
<span class="nc" id="L212">			damage +=dmgkk;</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">			return success +(attack?damage+&quot; damage.&quot;:&quot;&quot;);</span>
		}
<span class="nc bnc" id="L215" title="All 2 branches missed.">		if(roll+mod&gt;at){</span>
<span class="nc" id="L216">			return fail;</span>
		}
<span class="nc" id="L218">		return null;</span>
	}

	/**
	 * execute talent challenge
	 * @return results as string
	 */
	private String rollTalent(){
		//set leading result
<span class="nc bnc" id="L227" title="All 4 branches missed.">		String ch=&quot; &quot;+t.getName()+&quot; (&quot;+t.getChallenge()+&quot;) &quot;+</span>
<span class="nc" id="L228">			((mod!=0)?( (mod&gt;0)?&quot;+&quot;+mod:mod ):&quot;&quot;)+&quot;:\t&quot;;</span>
		//roll dices
<span class="nc" id="L230">		int f = Challenge.dice(20);</span>
<span class="nc" id="L231">		int s = Challenge.dice(20);</span>
<span class="nc" id="L232">		int tr = Challenge.dice(20);</span>
		//tell what was rolled
<span class="nc" id="L234">		ch +=&quot;rolled: &quot;+ f+&quot;|&quot;+s+&quot;|&quot;+tr+&quot; &quot;;</span>
		//calculate result
<span class="nc bnc" id="L236" title="All 6 branches missed.">		if(f==1&amp;&amp;s==1&amp;&amp;tr==1){</span>
<span class="nc" id="L237">			ch += &quot;successed!!!!!(YEAH)&quot;;</span>
<span class="nc bnc" id="L238" title="All 12 branches missed.">		}else if( (f==1 &amp;&amp; s==1)||(f==1&amp;&amp;tr==1)||(s==1&amp;&amp;tr==1)){</span>
			//good roll
<span class="nc" id="L240">			ch += &quot;automatic success&quot;;</span>
<span class="nc bnc" id="L241" title="All 6 branches missed.">		}else if(f==20&amp;&amp;s==20&amp;&amp;tr==20){</span>
			//really bad
<span class="nc" id="L243">			ch += &quot;FAILED!!!&quot;;</span>
<span class="nc bnc" id="L244" title="All 12 branches missed.">		}else if( (f==20 &amp;&amp; s==20)||(f==20&amp;&amp;tr==20)||(s==20&amp;&amp;tr==20)){</span>
			//good roll
<span class="nc" id="L246">			ch += &quot;automatic fail&quot;;</span>
		}else{
<span class="nc" id="L248">			int over =0;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">			if(f &gt; attrib1) over += f-attrib1;</span>
<span class="nc bnc" id="L250" title="All 2 branches missed.">			if(s &gt; attrib2) over += s-attrib2;</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">			if(tr &gt; attrib3) over += tr-attrib3;</span>
<span class="nc" id="L252">			int talPoints = t.getValue() - mod;</span>
<span class="nc" id="L253">			talPoints -= over;</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">			if(talPoints &gt; 0)</span>
<span class="nc" id="L255">				ch += &quot;successed (TaP* &quot;+talPoints+&quot;)&quot;;</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">			if(talPoints ==0){</span>
<span class="nc" id="L257">				ch += &quot;successed (TaP* 1)&quot;;</span>
			}
<span class="nc bnc" id="L259" title="All 2 branches missed.">			if(talPoints &lt; 0){</span>
<span class="nc" id="L260">				ch += &quot;failed&quot;;</span>
			}
		}
<span class="nc" id="L263">		return ch;</span>
	}
	
	/**
	 * execute attribute challenge
	 * @return result as string
	 */
	private String rollAttr(){
		//intro
<span class="nc bnc" id="L272" title="All 4 branches missed.">		String ch=&quot; &quot;+attrib+</span>
<span class="nc" id="L273">			((mod!=0)?( (mod&gt;0)?&quot;+&quot;+mod:mod ):&quot;&quot;)+&quot;:\t&quot;;</span>
		//roll
<span class="nc" id="L275">		int f = Challenge.dice(20);</span>
<span class="nc" id="L276">		ch += &quot;rolled: &quot;+f;</span>
		//calculate
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if(f==1){</span>
			//good roll
<span class="nc" id="L280">			ch += &quot;automatic success&quot;;</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">		}else if(f==20){</span>
			//bad roll
<span class="nc" id="L283">			ch += &quot;automatic fail&quot;;</span>
		}else{
<span class="nc" id="L285">			int over =attrValue - (f+mod);</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">			ch+=(over &lt; 0)?&quot;  failed:  missing &quot;+Math.abs(over)+&quot; points&quot;:</span>
						&quot;  success:  left over &quot;+ over +&quot; points&quot;;
		}
<span class="nc" id="L289">		return ch;</span>
	}
	
	/**
	 * represents this challenge
	 */
	public String toString(){
<span class="nc" id="L296">		String ret = &quot;&quot;;</span>
<span class="nc" id="L297">		ret += t.toString()+&quot;\n&quot;;</span>
<span class="nc" id="L298">		ret += &quot;att: &quot;+attrib1+&quot; &quot; + attrib2+&quot; &quot;+ attrib3+&quot;\n&quot;;</span>
<span class="nc" id="L299">		ret += &quot;mod: &quot;+mod+&quot;\n&quot;;</span>
<span class="nc" id="L300">		ret += &quot;to: &quot;+to;</span>
<span class="nc" id="L301">		return ret;</span>
	}
	
	/**
	 * roll a dice with variable sides
	 * @param sides the sides this dice should have
	 * @return a random number n between 1&lt;=n&lt;=sides
	 */
	public static int dice(int sides){
<span class="nc" id="L310">		int ret =-1;</span>
<span class="nc" id="L311">		ret = (int)Math.rint((Math.random()*sides))%sides+1;</span>
<span class="nc" id="L312">		return ret;</span>
	}

	/**
	 * return the receiver of the results
	 * @return the receiver
	 */
	public String getTo() {
<span class="nc" id="L320">		return to;</span>
	}

	/**
	 * return the silent mode
	 * @return the silent value
	 */
	public boolean isSilent() {
<span class="nc" id="L328">		return silent;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>