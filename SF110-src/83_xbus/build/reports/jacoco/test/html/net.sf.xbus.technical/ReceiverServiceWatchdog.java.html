<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReceiverServiceWatchdog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.technical</a> &gt; <span class="el_source">ReceiverServiceWatchdog.java</span></div><h1>ReceiverServiceWatchdog.java</h1><pre class="source lang-java linenums">package net.sf.xbus.technical;

import java.util.Iterator;
import java.util.Set;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.config.Configuration;
import net.sf.xbus.base.core.trace.Trace;
import net.sf.xbus.base.notifyerror.NotifyError;
import net.sf.xbus.base.xbussystem.XBUSSystem;

/**
 * The &lt;code&gt;ReceiverServiceWatchdog&lt;/code&gt; checks in a configurable interval,
 * whether all started {@link net.sf.xbus.technical.ReceiverThreadBase}s are
 * still running. If a thread is not running anymore and it has not been stopped
 * on demand, it is started again.
 */
<span class="nc" id="L19">public class ReceiverServiceWatchdog implements Runnable</span>
{
	private static final int INTERVAL_DEFAULT = 5;
<span class="nc" id="L22">	private boolean mRunning = true;</span>

	/**
	 * Checks in a configurable interval, whether all started
	 * {@link net.sf.xbus.technical.ReceiverThreadBase}s are still running. If
	 * a thread is not running anymore and it has not been stopped on demand, it
	 * is started again.
	 */
	public void run()
	{
		/*
		 * Read the interval time between the checks out of the configuration.
		 * If not specified, a default is used.
		 */
<span class="nc" id="L36">		int intervalTime = 0;</span>
		try
		{
<span class="nc" id="L39">			intervalTime = Configuration.getInstance().getValueAsIntOptional(</span>
					Constants.CHAPTER_BASE, &quot;Watchdog&quot;, &quot;Interval&quot;);
		}
<span class="nc" id="L42">		catch (Exception e)</span>
		{
			// Explicitly do nothing, default will be set later.
<span class="nc" id="L45">		}</span>

<span class="nc bnc" id="L47" title="All 2 branches missed.">		if (intervalTime == 0)</span>
		{
<span class="nc" id="L49">			Trace.warn(&quot;Watchdog running with default interval &quot;</span>
					+ INTERVAL_DEFAULT + &quot; seconds&quot;);
<span class="nc" id="L51">			intervalTime = INTERVAL_DEFAULT;</span>
		}

<span class="nc bnc" id="L54" title="All 2 branches missed.">		while (mRunning)</span>
		{
			/*
			 * Check whether all started threads are still running. If a thread
			 * is not running anymore, throw it out of the list of started
			 * systems and start a new instance of this thread.
			 */
<span class="nc" id="L61">			ReceiverThreadManager manager = ReceiverThreadManager.getInstance();</span>
<span class="nc" id="L62">			Set runningThreads = manager.getRunningReceiverThreads();</span>
<span class="nc" id="L63">			Set allThreads = manager.getAllReceiverThreads();</span>
<span class="nc" id="L64">			Set stoppedThreads = manager.getStoppedSystems();</span>

<span class="nc" id="L66">			String system = null;</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">			for (Iterator it1 = allThreads.iterator(); it1.hasNext();)</span>
			{
<span class="nc" id="L69">				system = (String) it1.next();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">				if ((!runningThreads.contains(system))</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">						&amp;&amp; (!stoppedThreads.contains(system)))</span>
				{
<span class="nc" id="L73">					Trace.always(&quot;ReceiverThread &quot; + system</span>
							+ &quot; will be restarted&quot;);
					try
					{
<span class="nc" id="L77">						manager.startReceiverThread(system);</span>
					}
<span class="nc" id="L79">					catch (XException e)</span>
					{
<span class="nc" id="L81">						Trace.always(&quot;Error wile restarting ReceiverThread &quot;</span>
								+ system);
						try
						{
<span class="nc" id="L85">							NotifyError.notifyError(null,</span>
<span class="nc" id="L86">									new XBUSSystem(system), e.getMessage(),</span>
									null, null);
						}
<span class="nc" id="L89">						catch (XException e1)</span>
						{
							// do nothing
<span class="nc" id="L92">						}</span>
<span class="nc" id="L93">					}</span>
				}
			}

			try
			{
<span class="nc" id="L99">				Thread.sleep(intervalTime * 1000);</span>
			}
<span class="nc" id="L101">			catch (InterruptedException e)</span>
			{
				// explicitly do nothing
<span class="nc" id="L104">			}</span>
<span class="nc" id="L105">		}</span>

<span class="nc" id="L107">	}</span>

	/**
	 * Tells the watchdog that it should stop.
	 */
	public void stopWatchdog()
	{
<span class="nc" id="L114">		mRunning = false;</span>
<span class="nc" id="L115">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>