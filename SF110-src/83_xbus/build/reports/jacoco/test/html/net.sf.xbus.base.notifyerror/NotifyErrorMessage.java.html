<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NotifyErrorMessage.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.base.notifyerror</a> &gt; <span class="el_source">NotifyErrorMessage.java</span></div><h1>NotifyErrorMessage.java</h1><pre class="source lang-java linenums">package net.sf.xbus.base.notifyerror;

import java.util.Enumeration;
import java.util.Hashtable;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.config.Configuration;
import net.sf.xbus.base.xbussystem.XBUSSystem;
import net.sf.xbus.protocol.Message;
import net.sf.xbus.protocol.TextMessage;

/**
 * @author Fleckenstein
 * 
 * To change this generated comment edit the template variable &quot;typecomment&quot;:
 * Window&gt;Preferences&gt;Java&gt;Templates. To enable and disable the creation of type
 * comments go to Window&gt;Preferences&gt;Java&gt;Code Generation.
 */
public class NotifyErrorMessage extends Message implements TextMessage
{
	private String mRequestText;
	private String mResponseText;
	private String mErrorMessage;
	private Object mErrorRequest;
	private String mClassName;
	private Hashtable mAdditionalInfo;

	/**
	 * Creates the &lt;code&gt;NotifyErrorMessage&lt;/code&gt; with the given source.
	 */
	public NotifyErrorMessage(XBUSSystem source)
	{
<span class="nc" id="L34">		super(source);</span>
<span class="nc" id="L35">		setShortname(&quot;NotifyErrorMessage&quot;);</span>
<span class="nc" id="L36">	}</span>

	/**
	 * This constructor initializes the new &lt;code&gt;NotifyErrorMessage&lt;/code&gt;
	 * with the given parameters. It is used when constructing a new
	 * &lt;code&gt;NotifyErrorMessage&lt;/code&gt; by converting it from another
	 * &lt;code&gt;Message&lt;/code&gt;.
	 */
	public NotifyErrorMessage(String function, XBUSSystem source, String id)
	{
<span class="nc" id="L46">		super(function, source, id);</span>
<span class="nc" id="L47">		setShortname(&quot;NotifyErrorMessage&quot;);</span>
<span class="nc" id="L48">	}</span>

	public void setData(String className, String errorMessage,
			Object errorRequest, Hashtable additionalInfo) throws XException
	{
		/**
		 * Get the exception information first, before other errors may occur
		 */
<span class="nc" id="L56">		String stackTrace = XException.getExceptionInformation();</span>

		/*
		 * Set some internal fields
		 */
<span class="nc" id="L61">		mErrorMessage = errorMessage;</span>
<span class="nc" id="L62">		mErrorRequest = errorRequest;</span>
<span class="nc" id="L63">		mAdditionalInfo = additionalInfo;</span>
<span class="nc" id="L64">		mClassName = className;</span>

<span class="nc" id="L66">		Configuration config = Configuration.getInstance();</span>

<span class="nc" id="L68">		String sourceName = &quot;&lt;null&gt;&quot;;</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">		if (getSource() != null)</span>
		{
<span class="nc" id="L71">			sourceName = getSource().getCompleteName();</span>
		}

		/**
		 * Build up error message
		 */
<span class="nc" id="L77">		StringBuffer errorText = new StringBuffer()</span>
<span class="nc" id="L78">				.append(&quot;Unrecoverable error while receiving message!&quot;)</span>
<span class="nc" id="L79">				.append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L80">				.append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L81">				.append(&quot;Class          : &quot;)</span>
<span class="nc" id="L82">				.append(mClassName)</span>
<span class="nc" id="L83">				.append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L84">				.append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L85">				.append(&quot;Date            : &quot;)</span>
<span class="nc" id="L86">				.append(Constants.getDateFormat().format(getRequestTimestamp()))</span>
<span class="nc" id="L87">				.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L88">						Constants.LINE_SEPERATOR).append(&quot;Receiving system: &quot;)</span>
<span class="nc" id="L89">				.append(sourceName).append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L90">						Constants.LINE_SEPERATOR).append(&quot;Error message:    &quot;)</span>
<span class="nc" id="L91">				.append(mErrorMessage).append(Constants.LINE_SEPERATOR);</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (mErrorRequest != null)</span>
		{
<span class="nc" id="L95">			int length = config.getValueAsInt(&quot;Base&quot;, &quot;NotifyError&quot;,</span>
					&quot;MessageLength&quot;);
<span class="nc bnc" id="L97" title="All 2 branches missed.">			if (length &gt; 0)</span>
			{
<span class="nc" id="L99">				String errorRequestString = mErrorRequest.toString();</span>
<span class="nc bnc" id="L100" title="All 2 branches missed.">				if (errorRequestString.length() &gt; length)</span>
				{
<span class="nc" id="L102">					errorRequestString = mErrorRequest.toString().substring(</span>
							length);
				}

<span class="nc" id="L106">				errorText.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L107">						&quot;Request message:  &quot;).append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L108">						.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L109">								errorRequestString).append(</span>
								Constants.LINE_SEPERATOR);
<span class="nc" id="L111">			}</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">			else if (length &lt; 0)</span>
			{
<span class="nc" id="L114">				errorText.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L115">						&quot;Request message:  &quot;).append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L116">						.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L117">								mErrorRequest.toString()).append(</span>
								Constants.LINE_SEPERATOR);
			}
		}

<span class="nc" id="L122">		Object key = null;</span>
<span class="nc" id="L123">		Object value = null;</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (additionalInfo != null)</span>
		{
<span class="nc" id="L126">			errorText.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L127">					&quot;Additional information:&quot;).append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L128">					.append(Constants.LINE_SEPERATOR);</span>

<span class="nc bnc" id="L130" title="All 2 branches missed.">			for (Enumeration e = additionalInfo.keys(); e.hasMoreElements();)</span>
			{
<span class="nc" id="L132">				key = e.nextElement();</span>
<span class="nc" id="L133">				value = additionalInfo.get(key);</span>
<span class="nc" id="L134">				errorText.append(key.toString()).append(&quot;: &quot;).append(</span>
<span class="nc" id="L135">						value.toString()).append(Constants.LINE_SEPERATOR);</span>
			}
		}

<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (stackTrace != null)</span>
		{
<span class="nc" id="L141">			errorText.append(Constants.LINE_SEPERATOR).append(</span>
<span class="nc" id="L142">					&quot;Exception caught:&quot;).append(Constants.LINE_SEPERATOR)</span>
<span class="nc" id="L143">					.append(Constants.LINE_SEPERATOR).append(stackTrace)</span>
<span class="nc" id="L144">					.append(Constants.LINE_SEPERATOR);</span>
		}

<span class="nc" id="L147">		setRequestText(errorText.toString(), null);</span>
<span class="nc" id="L148">	}</span>

	/*
	 * @see TextMessage#setRequestText(String)
	 */
	public void setRequestText(String text, XBUSSystem source)
	{
<span class="nc" id="L155">		mRequestText = text;</span>
<span class="nc" id="L156">		setFunction(&quot;Error&quot;);</span>
<span class="nc" id="L157">	}</span>

	/*
	 * @see TextMessage#setResponseText(String)
	 */
	public void setResponseText(String text, XBUSSystem destination)
	{
<span class="nc" id="L164">		mResponseText = text;</span>
<span class="nc" id="L165">		setReturncode(Constants.RC_OK);</span>
<span class="nc" id="L166">	}</span>

	/*
	 * @see TextMessage#getRequestText()
	 */
	public String getRequestText(XBUSSystem system)
	{
<span class="nc" id="L173">		return mRequestText;</span>
	}

	/*
	 * @see TextMessage#getResponseText()
	 */
	public String getResponseText()
	{
<span class="nc" id="L181">		return mResponseText;</span>
	}

	/**
	 * Returns the additionalInfo.
	 * 
	 * @return Hashtable
	 */
	public Hashtable getAdditionalInfo()
	{
<span class="nc" id="L191">		return mAdditionalInfo;</span>
	}

	/**
	 * Returns the errorMessage.
	 * 
	 * @return String
	 */
	public String getErrorMessage()
	{
<span class="nc" id="L201">		return mErrorMessage;</span>
	}

	/**
	 * Returns the errorRequest.
	 * 
	 * @return Object
	 */
	public Object getErrorRequest()
	{
<span class="nc" id="L211">		return mErrorRequest;</span>
	}

	/**
	 * Returns the className.
	 * 
	 * @return String
	 */
	public String getClassName()
	{
<span class="nc" id="L221">		return mClassName;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>