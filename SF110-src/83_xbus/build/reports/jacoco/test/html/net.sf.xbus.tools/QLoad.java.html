<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>QLoad.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.tools</a> &gt; <span class="el_source">QLoad.java</span></div><h1>QLoad.java</h1><pre class="source lang-java linenums">package net.sf.xbus.tools;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.Enumeration;
import java.util.Vector;

import javax.jms.JMSException;
import javax.jms.QueueSender;
import javax.jms.TextMessage;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.xbussystem.XBUSSystem;
import net.sf.xbus.technical.mq.MQConnection;

/**
 * The &lt;code&gt;QLoad&lt;/code&gt; removes all separators between the messages and,
 * using a &lt;code&gt;QueueSender&lt;/code&gt; interface, sends these messages in their
 * initial form to a queue.
 */
<span class="nc" id="L22">public class QLoad</span>
{
	/**
	 * The &lt;code&gt;main&lt;/code&gt; method reads, using BufferedReader, text from a
	 * character-input stream, writes it to the StringBuffer, removes all
	 * separators between the messages and sends these messages in their initial
	 * form to a queue.
	 */
	public static void main(String args[]) throws Exception
	{
<span class="nc bnc" id="L32" title="All 2 branches missed.">		if (args.length != 1)</span>
		{
<span class="nc" id="L34">			System.err.println(&quot;Usage: java QLoad Queuename&quot;);</span>
<span class="nc" id="L35">			System.exit(1);</span>
		}
<span class="nc" id="L37">		String logQueuename = args[0];</span>

<span class="nc" id="L39">		StringBuffer messages = new StringBuffer();</span>
		String zeile;

		try
		{
<span class="nc" id="L44">			BufferedReader instream = new BufferedReader(new InputStreamReader(</span>
					System.in));
<span class="nc bnc" id="L46" title="All 2 branches missed.">			while ((zeile = instream.readLine()) != null)</span>
			{
<span class="nc" id="L48">				messages.append(zeile);</span>
			}
<span class="nc" id="L50">			instream.close();</span>
		}
<span class="nc" id="L52">		catch (IOException e)</span>
		{
<span class="nc" id="L54">			System.out.println(&quot;Exception gefangen!&quot;);</span>
<span class="nc" id="L55">			e.printStackTrace();</span>
<span class="nc" id="L56">			System.exit(1);</span>
<span class="nc" id="L57">		}</span>

<span class="nc" id="L59">		Vector messageVec = new Vector();</span>

<span class="nc" id="L61">		String tmp = new String(messages);</span>
		int i;
<span class="nc bnc" id="L63" title="All 2 branches missed.">		while ((i = tmp.indexOf(Constants.QUEUE_DUMP_DELIMITER)) &gt;= 0)</span>
		{
<span class="nc" id="L65">			messageVec.add(tmp.substring(0, i));</span>
<span class="nc" id="L66">			messages.delete(0, i + Constants.QUEUE_DUMP_DELIMITER.length());</span>
<span class="nc" id="L67">			tmp = new String(messages);</span>
		}
		/*
		 * StringTokenizer st = new StringTokenizer(new String(messages),
		 * DELIMITER); while (st.hasMoreTokens()) { String mes = st.nextToken();
		 * System.out.println(mes);
		 * System.out.println(&quot;------------------------------------------------------------&quot;);
		 * messageVec.add(mes); }
		 */
		try
		{
			// Use the static MQConnection.newInstance() method to instantiate a
			// new connection
			// for messagequeues and creates a JMS QueueSender for the given
			// queue.
<span class="nc" id="L82">			MQConnection mqCon = MQConnection.getInstance();</span>
<span class="nc" id="L83">			QueueSender qs = mqCon.getSender(new XBUSSystem(logQueuename));</span>

			// Create a JMS-TextMessage for each element of the vector and send
			// this message to the queue.
			// Use the QueueSender's default delivery mode, timeToLive and
			// priority.
<span class="nc bnc" id="L89" title="All 2 branches missed.">			for (Enumeration e = messageVec.elements(); e.hasMoreElements();)</span>
			{
				try
				{
<span class="nc" id="L93">					TextMessage message = mqCon.createTextMessage();</span>
<span class="nc" id="L94">					message.setText((String) e.nextElement());</span>
<span class="nc" id="L95">					qs.send(message);</span>
				}
<span class="nc" id="L97">				catch (JMSException ex)</span>
				{
<span class="nc" id="L99">					System.out.println(&quot;Exception gefangen!&quot;);</span>
<span class="nc" id="L100">					ex.printStackTrace();</span>
<span class="nc" id="L101">					System.exit(1);</span>
<span class="nc" id="L102">				}</span>
			}

<span class="nc" id="L105">			mqCon.commit();</span>
<span class="nc" id="L106">			mqCon.close();</span>
		}
<span class="nc" id="L108">		catch (Exception exc)</span>
		{
<span class="nc" id="L110">			System.out.println(&quot;Exception gefangen!&quot;);</span>
<span class="nc" id="L111">			exc.printStackTrace();</span>
<span class="nc" id="L112">			System.exit(1);</span>
<span class="nc" id="L113">		}</span>

<span class="nc" id="L115">		System.exit(0);</span>
<span class="nc" id="L116">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>