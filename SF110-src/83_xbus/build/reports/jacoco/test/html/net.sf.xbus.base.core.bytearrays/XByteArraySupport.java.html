<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XByteArraySupport.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.base.core.bytearrays</a> &gt; <span class="el_source">XByteArraySupport.java</span></div><h1>XByteArraySupport.java</h1><pre class="source lang-java linenums">package net.sf.xbus.base.core.bytearrays;

import java.io.IOException;
import java.io.InputStream;
import java.util.Vector;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;

/**
 * &lt;code&gt;XByteArraySupport&lt;/code&gt; gives some support in manipulating byte
 * arrays.
 * 
 * @author Stephan Duwel
 */
<span class="nc" id="L16">public class XByteArraySupport</span>
{

	/**
	 * &lt;code&gt;subArray&lt;/code&gt; extracts a byte array from another.
	 * 
	 * @param array the complete byte array
	 * @param pos the starting position for extracting
	 * @param length the length of extracted sub-array
	 * @return the extracted sub-array
	 * @throws XException in case of unpossible &lt;code&gt;pos&lt;/code&gt; or
	 *             &lt;code&gt;length&lt;/code&gt; values
	 */
	public static byte[] subArray(byte[] array, int pos, int length)
			throws XException
	{
<span class="nc" id="L32">		byte[] retArray = new byte[length];</span>
		try
		{
<span class="nc bnc" id="L35" title="All 2 branches missed.">			for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L36">				retArray[i] = array[pos + i];</span>
		} // try
<span class="nc" id="L38">		catch (IndexOutOfBoundsException e)</span>
		{
<span class="nc" id="L40">			Vector params = new Vector(3);</span>
<span class="nc" id="L41">			params.add(new Integer(pos));</span>
<span class="nc" id="L42">			params.add(new Integer(length));</span>
<span class="nc" id="L43">			params.add(new Integer(array.length));</span>
<span class="nc" id="L44">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_BASE,
					Constants.PACKAGE_COREBASE_BYTEARRAYS, &quot;1&quot;);
<span class="nc" id="L47">		} // catch (IndexOutOfBoundsException e)</span>
<span class="nc" id="L48">		return retArray;</span>
	} // subArray(byte[] array, int pos, int length)

	/**
	 * @param inObject must be an &lt;code&gt;InputStream&lt;/code&gt;
	 * @return the content of the InputStread as a byte array
	 */
	static public byte[] transformToByteArray(Object inObject)
			throws XException
	{
<span class="nc" id="L58">		InputStream is = (InputStream) inObject;</span>

		// The stream content is read in block of size:
<span class="nc" id="L61">		final int blocksize = 1024;</span>
		// Number of bytes read in one block.
<span class="nc" id="L63">		int bytesRead = 0;</span>
		// Total number of bytes read.
<span class="nc" id="L65">		int byteArrayLength = 0;</span>

		// The list of read blocks - content and length for each block.
<span class="nc" id="L68">		Vector blocks = new Vector();</span>
		// Content and length for a single block.
<span class="nc" id="L70">		Object[] block = null;</span>

		// Byte butter for reading a block.
<span class="nc" id="L73">		byte[] ba = new byte[blocksize];</span>

		try
		// For casting to XException.
		{ // Reading first block
<span class="nc" id="L78">			bytesRead = is.read(ba);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">			while (bytesRead != -1)</span>
			{ // Loop until end of stream.
				// The read block.
<span class="nc" id="L82">				block = new Object[2];</span>
<span class="nc" id="L83">				block[0] = ba;</span>
<span class="nc" id="L84">				block[1] = new Integer(bytesRead);</span>
<span class="nc" id="L85">				byteArrayLength += bytesRead;</span>
<span class="nc" id="L86">				blocks.add(block);</span>
				// Read next block.
<span class="nc" id="L88">				ba = new byte[blocksize];</span>
<span class="nc" id="L89">				bytesRead = is.read(ba);</span>
			} // while (bytesRead!=-1)
		} // try
<span class="nc" id="L92">		catch (IOException e)</span>
		{
<span class="nc" id="L94">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_BASE,
					Constants.PACKAGE_COREBASE_BYTEARRAYS, &quot;0&quot;, e);
<span class="nc" id="L97">		} // catch</span>

		// Put everything together into one byte array.
<span class="nc" id="L100">		ba = new byte[byteArrayLength];</span>
<span class="nc" id="L101">		int offset = 0;</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">		for (int i = 0; i &lt; blocks.size(); i++)</span>
		{
<span class="nc" id="L104">			bytesRead = ((Integer) ((Object[]) blocks.get(i))[1]).intValue();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">			for (int j = 0; j &lt; bytesRead; j++)</span>
<span class="nc" id="L106">				ba[offset + j] = ((byte[]) ((Object[]) blocks.get(i))[0])[j];</span>
<span class="nc" id="L107">			offset += bytesRead;</span>
		} // for (int i=0; i&lt;blocks.size(); i++)

<span class="nc" id="L110">		return ba;</span>

	} // transformToByteArray(Object inObject)

} // XByteArraySupport
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>