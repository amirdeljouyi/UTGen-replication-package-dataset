<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MessageHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.base.core</a> &gt; <span class="el_source">MessageHandler.java</span></div><h1>MessageHandler.java</h1><pre class="source lang-java linenums">package net.sf.xbus.base.core;

import java.io.File;
import java.io.FileInputStream;
import java.io.FilenameFilter;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Properties;

import net.sf.xbus.base.core.config.Configuration;
import net.sf.xbus.base.core.strings.XStringSupport;
import net.sf.xbus.base.core.trace.Trace;

/**
 * A &lt;code&gt;Message&lt;/code&gt; is selected from a properties file.
 * &lt;p&gt;
 * The message result is a String.&lt;br&gt;
 * The clear regulation of the message is reached by a key. The key is described
 * in * {@link net.sf.xbus.base.core.XException XException} documentation page.
 * &lt;/p&gt;
 * 
 * @author Lars Messner
 */
public class MessageHandler
{

<span class="fc" id="L30">	private static Hashtable mInstances = new Hashtable();</span>

<span class="fc" id="L32">	private static final Object classLock = Configuration.class;</span>

<span class="fc" id="L34">	private Hashtable mMessages = null;</span>

	/**
	 * On the basis of the key get the message of the properties file.
	 * 
	 * @param key contain char and/or int for the definitly designation of the
	 *            message
	 * @param params contain a list of the inspected parameters
	 * @return messageText contain the message from the properties file
	 */
	public String getMessage(String key, List params)
	{
<span class="fc" id="L46">		String messageText = null;</span>
<span class="fc" id="L47">		messageText = getMessageOptional(key, params);</span>

<span class="pc bpc" id="L49" title="1 of 2 branches missed.">		if (messageText == null)</span>
		{
<span class="fc" id="L51">			messageText = &quot;Key: &quot; + key + &quot; not found in message file&quot;;</span>
<span class="nc" id="L52">			Trace.error(messageText);</span>
		} // if (messageText == null)

<span class="nc" id="L55">		return messageText;</span>
	}

	/**
	 * On the basis of the key get the message of the properties file.
	 * 
	 * @param key contain char and/or int for the definitly designation of the
	 *            message
	 * @param params contain a list of the inspected parameters
	 * @return messageText contain the message from the properties file
	 */
	public String getMessageOptional(String key, List params)
	{

<span class="fc" id="L69">		String messageText = null;</span>

<span class="pc bpc" id="L71" title="1 of 2 branches missed.">		if (mMessages == null)</span>
		{
<span class="nc" id="L73">			return null;</span>
		} // if (mMessages == null)

		// gets the message of the key
<span class="fc" id="L77">		messageText = (String) mMessages.get(key);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">		if (messageText == null)</span>
		{
<span class="fc" id="L80">			return null;</span>
		}

<span class="nc" id="L83">		int counter = 1;</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">		if (params != null)</span>
		{
<span class="nc" id="L86">			String paramText = null;</span>
<span class="nc" id="L87">			Object paramObject = null;</span>
			// if there is a type of &quot;$x$&quot;
<span class="nc bnc" id="L89" title="All 2 branches missed.">			for (Iterator it = params.iterator(); it.hasNext();)</span>
			{
<span class="nc" id="L91">				paramObject = it.next();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">				if (paramObject != null)</span>
				{
<span class="nc" id="L94">					paramText = paramObject.toString();</span>
				}
				else
				{
<span class="nc" id="L98">					paramText = &quot;&lt;null&gt;&quot;;</span>
				}
<span class="nc" id="L100">				String paramCounter = &quot;$&quot; + counter + &quot;$&quot;;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">				if (messageText.indexOf(paramCounter) &gt;= 0)</span>
				{
<span class="nc" id="L103">					messageText = XStringSupport.replaceAll(messageText,</span>
							paramCounter, paramText);
<span class="nc" id="L105">					counter++;</span>
				} // if (messageText.indexOf(paramCounter) &gt;= 0)
<span class="nc" id="L107">			} // for (Iterator it = params.iterator(); it.hasNext();)</span>
		} // if (params != null)
<span class="nc" id="L109">		return messageText;</span>
	}

	/**
	 * Returns a named instance of the &lt;code&gt;Message&lt;/code&gt;.
	 * &lt;p&gt;
	 * The first call creates a new &lt;code&gt;Message&lt;/code&gt; and reads all
	 * entries. Following calls will return the object, that has been created by
	 * the first call.
	 * 
	 * @param basename the basename of the properties file.
	 * @return MessageHandler - instance of&lt;code&gt;MessageHandler&lt;/code&gt;
	 */
	public static MessageHandler getInstance(String basename)
	{
<span class="fc" id="L124">		synchronized (classLock)</span>
		{
<span class="fc" id="L126">			MessageHandler instance = (MessageHandler) mInstances.get(basename);</span>
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">			if (instance == null)</span>
			{
<span class="fc" id="L129">				instance = new MessageHandler(basename);</span>
<span class="fc" id="L130">				mInstances.put(basename, instance);</span>
			} // if (instance == null)
<span class="fc" id="L132">			return instance;</span>
		}
	}

	/**
	 * The constructor is private. Instances of &lt;code&gt;Message&lt;/code&gt; can only
	 * be accessed via the method &lt;code&gt;getInstance()&lt;/code&gt;.
	 * 
	 * @param basename the name of the properties.
	 */
	private MessageHandler(String basename)
<span class="fc" id="L143">	{</span>
<span class="fc" id="L144">		mMessages = new Hashtable();</span>

<span class="fc" id="L146">		addMessages(basename, Constants.XBUS_ETC);</span>
<span class="fc" id="L147">		addMessages(basename, Constants.XBUS_PLUGIN_ETC);</span>
<span class="fc" id="L148">	}</span>

	private void addMessages(String basename, String dir)
	{
		// the language for the properties file is english
<span class="fc" id="L153">		Locale locale = Locale.ENGLISH;</span>
<span class="fc" id="L154">		String prefix = basename;</span>
<span class="fc" id="L155">		String postfix = &quot;_&quot; + locale.toString() + &quot;.properties&quot;;</span>

<span class="fc" id="L157">		File dirFile = new File(dir);</span>
<span class="fc" id="L158">		String[] messagesFiles = dirFile.list(new MessagesFilter(prefix,</span>
				postfix));

<span class="pc bpc" id="L161" title="3 of 4 branches missed.">		for (int i = 0; (messagesFiles != null) &amp;&amp; (i &lt; messagesFiles.length); i++)</span>
		{
			FileInputStream instream;
<span class="nc" id="L164">			Properties newProps = new Properties();</span>

			try
			{
<span class="nc" id="L168">				instream = new FileInputStream(dir + messagesFiles[i]);</span>
<span class="nc" id="L169">				newProps.load(instream);</span>
<span class="nc" id="L170">				instream.close();</span>
			}
<span class="nc" id="L172">			catch (java.io.FileNotFoundException e)</span>
			{
<span class="nc" id="L174">				System.out.println(&quot;Cannot find messagefile&quot;);</span>
<span class="nc" id="L175">				System.exit(1);</span>
			}
<span class="nc" id="L177">			catch (java.io.IOException e)</span>
			{
<span class="nc" id="L179">				System.out.println(&quot;Cannot find messagefile&quot;);</span>
<span class="nc" id="L180">				System.exit(1);</span>
<span class="nc" id="L181">			}</span>

			/*
			 * Move all elements of currently loaded properties to the complete
			 * set
			 */
<span class="nc" id="L187">			String key = null;</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">			for (Enumeration keys = newProps.keys(); keys.hasMoreElements();)</span>
			{
<span class="nc" id="L190">				key = (String) keys.nextElement();</span>

<span class="nc" id="L192">				mMessages.put(key, newProps.get(key));</span>
			}
		}
<span class="fc" id="L195">	}</span>

	/**
	 * The internal class &lt;code&gt;MessagesFilter&lt;/code&gt; checks wether files are
	 * wanted Messages or not.
	 */
	static private class MessagesFilter implements FilenameFilter
	{
<span class="fc" id="L203">		private String mPrefix = null;</span>
<span class="fc" id="L204">		private String mPostfix = null;</span>

		public MessagesFilter(String prefix, String postfix)
<span class="fc" id="L207">		{</span>
<span class="fc" id="L208">			mPrefix = prefix;</span>
<span class="fc" id="L209">			mPostfix = postfix;</span>
<span class="fc" id="L210">		}</span>

		/*
		 * (non-Javadoc)
		 * 
		 * @see java.io.FilenameFilter#accept(java.io.File, java.lang.String)
		 */
		public boolean accept(File dir, String filename)
		{
<span class="nc bnc" id="L219" title="All 4 branches missed.">			if ((filename.startsWith(mPrefix)) &amp;&amp; (filename.endsWith(mPostfix)))</span>
			{
<span class="nc" id="L221">				return true;</span>
			}
			else
			{
<span class="nc" id="L225">				return false;</span>
			}
		}

	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>