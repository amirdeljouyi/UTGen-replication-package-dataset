<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AS400Connection.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.technical.as400</a> &gt; <span class="el_source">AS400Connection.java</span></div><h1>AS400Connection.java</h1><pre class="source lang-java linenums">package net.sf.xbus.technical.as400;

import java.beans.PropertyVetoException;
import java.util.Hashtable;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.config.Configuration;

import com.ibm.as400.access.AS400;

/**
 * &lt;code&gt;AS400Connection&lt;/code&gt; manages connections to AS400 machines.
 * &lt;p&gt;
 * 
 * It implements the &lt;b&gt;Singleton&lt;/b&gt;-Design-Pattern: Named instances of
 * &lt;code&gt;AS400Connection&lt;/code&gt; are created for every thread.
 * &lt;p&gt;
 * 
 * &lt;b&gt;Configuration:&lt;/b&gt;
 * &lt;p&gt;
 * &lt;table border&gt;
 * &lt;tr&gt;
 * &lt;th&gt;Chapter&lt;/th&gt;
 * &lt;th&gt;Section&lt;/th&gt;
 * &lt;th&gt;Key&lt;/th&gt;
 * &lt;th&gt;Content&lt;/th&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td&gt;AS400Connection&lt;/td&gt;
 * &lt;td&gt;&lt;i&gt;name&lt;/i&gt;&lt;/td&gt;
 * &lt;td&gt;SystemName&lt;/td&gt;
 * &lt;td&gt;System name or IP-address of the AS400&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td&gt;AS400Connection&lt;/td&gt;
 * &lt;td&gt;&lt;i&gt;name&lt;/i&gt;&lt;/td&gt;
 * &lt;td&gt;User&lt;/td&gt;
 * &lt;td&gt;User for accessing the AS400&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;tr&gt;
 * &lt;td&gt;AS400Connection&lt;/td&gt;
 * &lt;td&gt;&lt;i&gt;name&lt;/i&gt;&lt;/td&gt;
 * &lt;td&gt;Password&lt;/td&gt;
 * &lt;td&gt;Password for the user&lt;/td&gt;
 * &lt;/tr&gt;
 * &lt;/table&gt;
 */
public class AS400Connection
{
	private static final String AS400CONNECTION = &quot;AS400Connection&quot;;
	private static final String SYSTEMNAME = &quot;SystemName&quot;;
	private static final String USER = &quot;User&quot;;
	private static final String PASSWORD = &quot;Password&quot;;
	private static final String TEST_SYSTEM = &quot;XBUS_TEST&quot;;

<span class="nc" id="L57">	private static Hashtable mAS400Connections = new Hashtable();</span>
<span class="nc" id="L58">	private static final Object classLock = AS400Connection.class;</span>

<span class="nc" id="L60">	private AS400 mSystem = null;</span>
	private boolean mIsTestSystem;

	/**
	 * The constructor is private, instances of &lt;code&gt;AS400Connection&lt;/code&gt;
	 * can only be generated via the method &lt;code&gt;getInstance()&lt;/code&gt;. Each
	 * instance is put in a &lt;code&gt;Hashtable&lt;/code&gt; with the name of the thread
	 * and the name of the connection as the key.
	 * 
	 * @param name more than one AS400 can be connected, differenced by their
	 *            name
	 * @throws XException if something goes wrong
	 */
	private AS400Connection(String name) throws XException
<span class="nc" id="L74">	{</span>
<span class="nc" id="L75">		Configuration config = Configuration.getInstance();</span>
<span class="nc" id="L76">		String systemName = config.getValue(AS400CONNECTION, name, SYSTEMNAME);</span>
<span class="nc" id="L77">		String user = config.getValue(AS400CONNECTION, name, USER);</span>
<span class="nc" id="L78">		String password = config.getValue(AS400CONNECTION, name, PASSWORD);</span>

<span class="nc" id="L80">		mIsTestSystem = TEST_SYSTEM.equals(systemName);</span>

<span class="nc bnc" id="L82" title="All 2 branches missed.">		if (!mIsTestSystem)</span>
		{
<span class="nc" id="L84">			mSystem = new AS400(systemName, user, password);</span>

			try
			{
<span class="nc" id="L88">				mSystem.setGuiAvailable(false);</span>
			}
<span class="nc" id="L90">			catch (PropertyVetoException e)</span>
			{
<span class="nc" id="L92">				throw new XException(Constants.LOCATION_EXTERN,</span>
						Constants.LAYER_TECHNICAL,
						Constants.PACKAGE_TECHNICAL_AS400, &quot;0&quot;, e);
<span class="nc" id="L95">			}</span>
		}
<span class="nc" id="L97">		mAS400Connections.put(getKey(name), this);</span>
<span class="nc" id="L98">	}</span>

	/**
	 * Delivers an instance of &lt;code&gt;AS400Connection&lt;/code&gt;.
	 * &lt;p&gt;
	 * 
	 * If it is the first call with the given name for the actual thread, a new
	 * &lt;code&gt;AS400Connection&lt;/code&gt;-object gets created. Subsequent calls
	 * with the given name in this thread will deliver the object, that has been
	 * created by the first call.
	 * 
	 * @param name more than one AS400 can be connected, differenced by their
	 *            name
	 * @throws XException if any error occurs
	 */
	public static AS400Connection getInstance(String name) throws XException
	{
<span class="nc" id="L115">		synchronized (classLock)</span>
		{
<span class="nc" id="L117">			AS400Connection as400Connection = (AS400Connection) mAS400Connections</span>
<span class="nc" id="L118">					.get(getKey(name));</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">			if (as400Connection == null)</span>
			{
<span class="nc" id="L122">				as400Connection = new AS400Connection(name);</span>
			}
<span class="nc" id="L124">			return as400Connection;</span>
		}
	}

	/**
	 * Returns the &lt;code&gt;AS400&lt;/code&gt; object for the connection.
	 * 
	 * @return &lt;code&gt;AS400&lt;/code&gt; object for the connection
	 */
	public AS400 getSystem()
	{
<span class="nc" id="L135">		return mSystem;</span>
	}

	/**
	 * Helper method for writing testdrivers when no AS400 is available.
	 * 
	 * @return &lt;code&gt;true&lt;/code&gt; if this is not a real AS400
	 */
	public boolean isTestSystem()
	{
<span class="nc" id="L145">		return mIsTestSystem;</span>
	}

	static private String getKey(String name)
	{
<span class="nc" id="L150">		return new StringBuffer().append(Thread.currentThread().getName())</span>
<span class="nc" id="L151">				.append(name).toString();</span>
	}

	static public void clear()
	{
<span class="nc" id="L156">		mAS400Connections.clear();</span>
<span class="nc" id="L157">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>