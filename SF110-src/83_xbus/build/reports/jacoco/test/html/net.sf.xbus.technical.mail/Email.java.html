<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Email.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.technical.mail</a> &gt; <span class="el_source">Email.java</span></div><h1>Email.java</h1><pre class="source lang-java linenums">package net.sf.xbus.technical.mail;

import java.util.Date;
import java.util.Iterator;
import java.util.List;
import java.util.Vector;

import javax.mail.internet.InternetAddress;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.xml.XMLHelper;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.Text;

/**
 * &lt;p&gt;
 * Description: An instance of that class will store an manupulate the email
 * receive by the POP3XMLReceiver.
 * &lt;/p&gt;
 * 
 * @author Dominique Boivin
 * @version 1.3
 */

public class Email
{
	private String mSystem;
	private InternetAddress mFromAddress;
	private List mToAddresses;
	private List mCCAddresses;
	private List mBCCAddresses;
	private String mSubject;
	private String mContent;
	private Date mSentDate;
	private String mContentType;

	public Email(String system)
<span class="nc" id="L42">	{</span>
<span class="nc" id="L43">		mSystem = system;</span>
<span class="nc" id="L44">	}</span>

	public String toString()
	{
		try
		{
<span class="nc" id="L50">			return XMLHelper.serializeXML(getXML(), null);</span>
		}
<span class="nc" id="L52">		catch (XException e)</span>
		{
<span class="nc" id="L54">			return e.getMessage();</span>
		}
	}

	public Document getXML() throws XException
	{
<span class="nc bnc" id="L60" title="All 2 branches missed.">		if (isEmpty())</span>
		{
<span class="nc" id="L62">			return null;</span>
		}

<span class="nc" id="L65">		Document doc = XMLHelper.getDocumentBuilder(&quot;Default&quot;, null)</span>
<span class="nc" id="L66">				.newDocument();</span>

<span class="nc" id="L68">		Element root = doc.createElement(mSystem);</span>
<span class="nc" id="L69">		doc.appendChild(root);</span>

<span class="nc" id="L71">		Element emailElement = null;</span>
<span class="nc" id="L72">		Text emailNode = null;</span>

<span class="nc bnc" id="L74" title="All 2 branches missed.">		if (mFromAddress != null)</span>
		{
<span class="nc" id="L76">			root.appendChild(createAddressNode(doc, &quot;From&quot;, mFromAddress));</span>
		}

<span class="nc bnc" id="L79" title="All 4 branches missed.">		if ((mToAddresses != null) &amp;&amp; (!mToAddresses.isEmpty()))</span>
		{
<span class="nc bnc" id="L81" title="All 2 branches missed.">			for (Iterator it = mToAddresses.iterator(); it.hasNext();)</span>
			{
<span class="nc" id="L83">				root.appendChild(createAddressNode(doc, &quot;To&quot;,</span>
<span class="nc" id="L84">						(InternetAddress) it.next()));</span>
			}
		}

<span class="nc bnc" id="L88" title="All 4 branches missed.">		if ((mCCAddresses != null) &amp;&amp; (!mCCAddresses.isEmpty()))</span>
		{
<span class="nc bnc" id="L90" title="All 2 branches missed.">			for (Iterator it = mCCAddresses.iterator(); it.hasNext();)</span>
			{
<span class="nc" id="L92">				root.appendChild(createAddressNode(doc, &quot;CC&quot;,</span>
<span class="nc" id="L93">						(InternetAddress) it.next()));</span>
			}
		}

<span class="nc bnc" id="L97" title="All 4 branches missed.">		if ((mBCCAddresses != null) &amp;&amp; (!mBCCAddresses.isEmpty()))</span>
		{
<span class="nc bnc" id="L99" title="All 2 branches missed.">			for (Iterator it = mBCCAddresses.iterator(); it.hasNext();)</span>
			{
<span class="nc" id="L101">				root.appendChild(createAddressNode(doc, &quot;BCC&quot;,</span>
<span class="nc" id="L102">						(InternetAddress) it.next()));</span>
			}
		}

<span class="nc bnc" id="L106" title="All 2 branches missed.">		if (mSentDate != null)</span>
		{
<span class="nc" id="L108">			emailElement = doc.createElement(&quot;SentDate&quot;);</span>
<span class="nc" id="L109">			emailNode = doc.createTextNode(Constants.getDateFormat().format(</span>
					mSentDate));
<span class="nc" id="L111">			emailElement.appendChild(emailNode);</span>
<span class="nc" id="L112">			root.appendChild(emailElement);</span>
		}

<span class="nc bnc" id="L115" title="All 2 branches missed.">		if (mContentType != null)</span>
		{
<span class="nc" id="L117">			emailElement = doc.createElement(&quot;ContentType&quot;);</span>
<span class="nc" id="L118">			emailNode = doc.createTextNode(mContentType);</span>
<span class="nc" id="L119">			emailElement.appendChild(emailNode);</span>
<span class="nc" id="L120">			root.appendChild(emailElement);</span>
		}

<span class="nc bnc" id="L123" title="All 2 branches missed.">		if (mSubject != null)</span>
		{
<span class="nc" id="L125">			emailElement = doc.createElement(&quot;Subject&quot;);</span>
<span class="nc" id="L126">			emailNode = doc.createTextNode(mSubject);</span>
<span class="nc" id="L127">			emailElement.appendChild(emailNode);</span>
<span class="nc" id="L128">			root.appendChild(emailElement);</span>
		}

<span class="nc bnc" id="L131" title="All 4 branches missed.">		if (mContent != null &amp;&amp; !mContent.trim().equals(&quot;&quot;))</span>
		{
<span class="nc" id="L133">			emailElement = doc.createElement(&quot;Content&quot;);</span>
<span class="nc" id="L134">			emailNode = doc.createTextNode(mContent);</span>
<span class="nc" id="L135">			emailElement.appendChild(emailNode);</span>
<span class="nc" id="L136">			root.appendChild(emailElement);</span>

<span class="nc" id="L138">			emailElement = doc.createElement(&quot;IsHTMLMessage&quot;);</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">			if (isHTMLMessage())</span>
			{
<span class="nc" id="L141">				emailNode = doc.createTextNode(&quot;true&quot;);</span>
			}
			else
			{
<span class="nc" id="L145">				emailNode = doc.createTextNode(&quot;false&quot;);</span>
			}
<span class="nc" id="L147">			emailElement.appendChild(emailNode);</span>
<span class="nc" id="L148">			root.appendChild(emailElement);</span>

		}

<span class="nc" id="L152">		return doc;</span>
	}

	public boolean isEmpty()
	{
<span class="nc bnc" id="L157" title="All 4 branches missed.">		return ((mContent == null) || (mContent.trim().equals(&quot;&quot;)));</span>
	}

	public InternetAddress getFromAddress()
	{
<span class="nc" id="L162">		return mFromAddress;</span>
	}

	public void setFromAddress(InternetAddress fromAddress)
	{
<span class="nc" id="L167">		mFromAddress = fromAddress;</span>
<span class="nc" id="L168">	}</span>

	public void setToAddress(InternetAddress toAddress)
	{
<span class="nc bnc" id="L172" title="All 2 branches missed.">		if (mToAddresses == null)</span>
		{
<span class="nc" id="L174">			mToAddresses = new Vector();</span>
		}
<span class="nc" id="L176">		mToAddresses.add(toAddress);</span>
<span class="nc" id="L177">	}</span>

	public List getToAddresses()
	{
<span class="nc" id="L181">		return mToAddresses;</span>
	}

	public void setCCAddress(InternetAddress ccAddress)
	{
<span class="nc bnc" id="L186" title="All 2 branches missed.">		if (mCCAddresses == null)</span>
		{
<span class="nc" id="L188">			mCCAddresses = new Vector();</span>
		}
<span class="nc" id="L190">		mCCAddresses.add(ccAddress);</span>
<span class="nc" id="L191">	}</span>

	public List getCCAddresses()
	{
<span class="nc" id="L195">		return mCCAddresses;</span>
	}

	public void setBCCAddress(InternetAddress bccAddress)
	{
<span class="nc bnc" id="L200" title="All 2 branches missed.">		if (mBCCAddresses == null)</span>
		{
<span class="nc" id="L202">			mBCCAddresses = new Vector();</span>
		}
<span class="nc" id="L204">		mBCCAddresses.add(bccAddress);</span>
<span class="nc" id="L205">	}</span>

	public List getBCCAddresses()
	{
<span class="nc" id="L209">		return mBCCAddresses;</span>
	}

	public void setSubject(String subject)
	{
<span class="nc" id="L214">		mSubject = subject;</span>
<span class="nc" id="L215">	}</span>

	public String getSubject()
	{
<span class="nc" id="L219">		return mSubject;</span>
	}

	public void setContent(String content)
	{
<span class="nc" id="L224">		mContent = content;</span>
<span class="nc" id="L225">	}</span>

	public String getContent()
	{
<span class="nc" id="L229">		return mContent;</span>
	}

	public void setSentDate(Date sentDate)
	{
<span class="nc" id="L234">		mSentDate = sentDate;</span>
<span class="nc" id="L235">	}</span>

	public Date getSentDate()
	{
<span class="nc" id="L239">		return mSentDate;</span>
	}

	public String getContentType()
	{
<span class="nc" id="L244">		return mContentType;</span>
	}

	public void setContentType(String contentType)
	{
<span class="nc" id="L249">		mContentType = contentType;</span>
<span class="nc" id="L250">	}</span>

	private Node createAddressNode(Document doc, String tag,
			InternetAddress internetAddress)
	{
<span class="nc" id="L255">		Node retNode = doc.createElement(tag);</span>
<span class="nc" id="L256">		String name = internetAddress.getPersonal();</span>
<span class="nc" id="L257">		String address = internetAddress.getAddress();</span>

<span class="nc" id="L259">		Node tmpNode = null;</span>

<span class="nc bnc" id="L261" title="All 2 branches missed.">		if (name != null)</span>
		{
<span class="nc" id="L263">			tmpNode = doc.createElement(&quot;Name&quot;);</span>
<span class="nc" id="L264">			tmpNode.appendChild(doc.createTextNode(name));</span>
<span class="nc" id="L265">			retNode.appendChild(tmpNode);</span>
		}
<span class="nc bnc" id="L267" title="All 2 branches missed.">		if (address != null)</span>
		{
<span class="nc" id="L269">			tmpNode = doc.createElement(&quot;Address&quot;);</span>
<span class="nc" id="L270">			tmpNode.appendChild(doc.createTextNode(address));</span>
<span class="nc" id="L271">			retNode.appendChild(tmpNode);</span>
		}

<span class="nc" id="L274">		return retNode;</span>
	}

	private boolean isHTMLMessage()
	{
		/*
		 * Whe cannot use directly the &lt;/HTML&gt; tag because the &lt;&gt; can be
		 * converted to &amp;lt;/HTML&amp;gt;
		 */
<span class="nc bnc" id="L283" title="All 4 branches missed.">		return ((mContent != null) &amp;&amp; (mContent.toUpperCase().indexOf(&quot;/HTML&quot;) != -1));</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>