<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecordTypeSerializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.protocol.records</a> &gt; <span class="el_source">RecordTypeSerializer.java</span></div><h1>RecordTypeSerializer.java</h1><pre class="source lang-java linenums">package net.sf.xbus.protocol.records;

import java.util.Hashtable;
import java.util.List;
import java.util.Vector;

import net.sf.xbus.base.bytearraylist.ByteArrayConverter;
import net.sf.xbus.base.bytearraylist.ByteArrayConverterFactory;
import net.sf.xbus.base.bytearraylist.ByteArrayList;
import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.xml.XDomSupport;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

/**
 * &lt;code&gt;RecordTypeSerializer&lt;/code&gt; serves for serializing records stored in
 * a DOM tree according to a record type structure.
 * &lt;p&gt;
 * The DOM tree structure is described in the
 * {@link net.sf.xbus.protocol.records.RecordTypeParser RecordTypeParser}
 * documentation.
 * &lt;/p&gt;
 * &lt;p&gt;
 * The serialization result is a String. &lt;br&gt;
 * The string structure is described by a xml file - in particular the contained
 * record types. Such describing files are of document type
 * &lt;code&gt;InterfaceSpec&lt;/code&gt; declared in &quot;InterfaceSpec.dtd&quot;. The structure
 * of the internal DOM tree to serialise is described on the
 * {@link net.sf.xbus.protocol.records.RecordTypeParser RecordTypeParser}
 * documentation page.
 * &lt;/p&gt;
 * 
 * @author Lars Messner, Stehan Duwel
 */
public class RecordTypeSerializer extends RecordTypeManipulator
{

	// //////////////////////
	// Static fields
	// //////////////////////

	/**
	 * &lt;code&gt;instances&lt;/code&gt; stores the instances by thread and the interface
	 * type.
	 */
<span class="nc" id="L50">	private static Hashtable instances = new Hashtable();</span>
<span class="nc" id="L51">	private static final Object classLock = RecordTypeSerializer.class;</span>

	// //////////////////////
	// Constructors
	// //////////////////////

	/**
	 * Just the standard constructor.
	 */
	private RecordTypeSerializer() throws XException
	{
		super();
	} // RecordTypeParser()

	// //////////////////////
	// Static methods
	// //////////////////////

	/**
	 * &lt;code&gt;getInstance()&lt;/code&gt; retrieves the an instance of
	 * &lt;code&gt;RecordTypeSerializer&lt;/code&gt;.
	 * 
	 * @param sourceType the name for the parsed structure as it is derived from
	 *            the DOM tree with the interface content
	 * @throws XException in case of missing &lt;code&gt;sourceType&lt;/code&gt;
	 */
	public static RecordTypeSerializer getInstance(String sourceType,
			int interfaceContentClass) throws XException
	{
<span class="nc" id="L80">		synchronized (classLock)</span>
		{
<span class="nc bnc" id="L82" title="All 4 branches missed.">			if (sourceType == null || sourceType.length() == 0)</span>
<span class="nc" id="L83">				throw new XException(Constants.LOCATION_INTERN,</span>
						Constants.LAYER_PROTOCOL,
						Constants.PACKAGE_PROTOCOL_RECORDS, &quot;68&quot;);

<span class="nc" id="L87">			RecordTypeSerializer instance = (RecordTypeSerializer) instances</span>
<span class="nc" id="L88">					.get(Thread.currentThread().getName() + sourceType</span>
							+ interfaceContentClass);
<span class="nc bnc" id="L90" title="All 2 branches missed.">			if (instance == null)</span>
			{ // no suitable instance available yet
<span class="nc" id="L92">				instance = new RecordTypeSerializer();</span>
<span class="nc" id="L93">				instances.put(Thread.currentThread().getName() + sourceType</span>
						+ interfaceContentClass, instance);
			} // if (instance==null)
<span class="nc" id="L96">			return instance;</span>
		}
	} // getInstance(String sourceType)

	/**
	 * Method getByteArrayConverter.
	 * 
	 * @return ByteArrayConverter
	 */
	protected ByteArrayConverter getByteArrayConverter() throws XException
	{
<span class="nc" id="L107">		return ByteArrayConverterFactory.getConverter(sourceType);</span>
	}

	// /////////////////////////////////////////
	// Serializing the contents
	// /////////////////////////////////////////

	/**
	 * &lt;code&gt;serialize&lt;/code&gt; serializes the specified DOM tree due to the
	 * record type definition.
	 * 
	 * @param docContent the DOM tree with the interface content
	 * @return the serialized string
	 * @throws XException in case of an unexpected value
	 */
	public Object serialize(Document docContent) throws XException
	{
<span class="nc bnc" id="L124" title="All 2 branches missed.">		if (interfaceStructure == null)</span>
<span class="nc" id="L125">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;99&quot;);

		// The root element has the content type as xml tag.
<span class="nc" id="L130">		Element root = docContent.getDocumentElement();</span>
<span class="nc bnc" id="L131" title="All 4 branches missed.">		if (contentType == null || !contentType.equals(root.getNodeName()))</span>
<span class="nc" id="L132">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;120&quot;);

<span class="nc" id="L136">		Node node = root.getFirstChild();</span>
<span class="nc" id="L137">		Object result = null;</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
		{
<span class="nc" id="L140">			result = &quot;&quot;;</span>
		}
<span class="nc bnc" id="L142" title="All 2 branches missed.">		else if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
		{
<span class="nc" id="L144">			result = new ByteArrayList();</span>
		}
		else
		{
<span class="nc" id="L148">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;100&quot;);
		}

<span class="nc bnc" id="L153" title="All 2 branches missed.">		if (node == null)</span>
		{
<span class="nc" id="L155">			return result;</span>
		}

<span class="nc bnc" id="L158" title="All 2 branches missed.">		if (!node.getNodeName().equals(&quot;Records&quot;))</span>
		{ // not the records section - thus a header
<span class="nc bnc" id="L160" title="All 2 branches missed.">			if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L161">				result = serializeHeader(node) + Constants.LINE_SEPERATOR;</span>
			else
<span class="nc" id="L163">				((ByteArrayList) result).add((byte[]) serializeHeader(node));</span>
			// Go to the records section
<span class="nc" id="L165">			node = node.getNextSibling();</span>
		} // if (!node.getNodeName().equals(&quot;Records&quot;))

		// Now the records section
<span class="nc bnc" id="L169" title="All 4 branches missed.">		if (node == null || !node.getNodeName().equals(&quot;Records&quot;))</span>
		{
<span class="nc" id="L171">			List params = new Vector();</span>
<span class="nc" id="L172">			params.add(&quot;Records expected&quot;);</span>
<span class="nc" id="L173">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;122&quot;, params);
		} // if (node == null || !node.getNodeName().equals(&quot;Records&quot;))
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L178">			result = result + (String) serializeRecords(node);</span>
		else
<span class="nc" id="L180">			((ByteArrayList) result)</span>
<span class="nc" id="L181">					.addAll((ByteArrayList) serializeRecords(node));</span>

		// Go to trailer or end
<span class="nc" id="L184">		node = node.getNextSibling();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">		if (node != null)</span>
		{ // trailer found
<span class="nc bnc" id="L187" title="All 2 branches missed.">			if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L188">				result = result + (String) serializeTrailer(node);</span>
			else
<span class="nc" id="L190">				((ByteArrayList) result).add((byte[]) serializeTrailer(node));</span>
			// Go to end
<span class="nc" id="L192">			node = node.getNextSibling();</span>
		} // if (node!=null)
<span class="nc bnc" id="L194" title="All 4 branches missed.">		else if (result != null</span>
				&amp;&amp; interfaceContentClass == Constants.IFCONTENTCLASS_STRING
<span class="nc bnc" id="L196" title="All 2 branches missed.">				&amp;&amp; ((String) result).length() &gt; 0)</span>
			// no trailer
			// Cut off the line separator after the last record.
<span class="nc" id="L199">			result = ((String) result).substring(0, ((String) result).length()</span>
<span class="nc" id="L200">					- Constants.LINE_SEPERATOR.length());</span>

		// Must be the end.
<span class="nc bnc" id="L203" title="All 2 branches missed.">		if (node != null)</span>
		{
<span class="nc" id="L205">			List params = new Vector();</span>
<span class="nc" id="L206">			params.add(node.getNodeName());</span>
<span class="nc" id="L207">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;123&quot;, params);
		} // if (node != null)

<span class="nc" id="L212">		return result;</span>
	} // serialize(Document docContent)

	/**
	 * &lt;code&gt;serializeHeader&lt;/code&gt; parses the header.
	 * 
	 * @param headerNode the header in the content DOM tree
	 * @return the serialized header as {@link java.lang.String string}
	 * @throws XException in case of an unexpected value
	 */
	private Object serializeHeader(Node headerNode) throws XException
	{ // Easy: no record type identification necessary
		// Jump directly to contained fields.
<span class="nc" id="L225">		return serializeFieldsAndGroups(headerNode, headerSpec);</span>
	} // serializeHeader(Node headerNode)

	/**
	 * &lt;code&gt;serializeRecords&lt;/code&gt; serializes the records section.
	 * 
	 * @param recordsNode
	 * @return String
	 */
	private Object serializeRecords(Node recordsNode) throws XException
	{
<span class="nc" id="L236">		String tag = recordsNode.getNodeName();</span>
<span class="nc bnc" id="L237" title="All 4 branches missed.">		if (tag == null || !tag.equals(&quot;Records&quot;))</span>
		{
<span class="nc" id="L239">			List params = new Vector();</span>
<span class="nc" id="L240">			params.add(&quot;Records expected&quot;);</span>
<span class="nc" id="L241">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;122&quot;, params);
		} // if (tag == null || !tag.equals(&quot;Records&quot;))
<span class="nc" id="L245">		Object result = null;</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">		if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L247">			result = &quot;&quot;;</span>
		else
<span class="nc" id="L249">			result = new ByteArrayList();</span>
<span class="nc" id="L250">		Node recordGroup = recordsNode.getFirstChild();</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">		while (recordGroup != null)</span>
		{ // Loop over the record groups or just a dummy loop
			// Two possibilities: directly first record or first record group
<span class="nc" id="L254">			Node record = recordGroup;</span>
<span class="nc bnc" id="L255" title="All 2 branches missed.">			if (recordGroup.getNodeName().equals(&quot;RecordGroup&quot;))</span>
				// In case of a record group go one level deeper to the first
				// record of the group
<span class="nc" id="L258">				record = recordGroup.getFirstChild();</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">			while (record != null)</span>
			{ // loop over the records in the group - or all if no record
				// groups are present
				// The record type is identified by the xml tag.
				// Get it and jum to the contained fields.
<span class="nc bnc" id="L264" title="All 2 branches missed.">				if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L265">					result = result</span>
<span class="nc" id="L266">							+ (String) serializeFieldsAndGroups(record,</span>
<span class="nc" id="L267">									getRecordTypeSpec(record.getNodeName()))</span>
							+ Constants.LINE_SEPERATOR;
				else
<span class="nc" id="L270">					((ByteArrayList) result)</span>
<span class="nc" id="L271">							.add((byte[]) serializeFieldsAndGroups(record,</span>
<span class="nc" id="L272">									getRecordTypeSpec(record.getNodeName())));</span>
				// Go to next record
<span class="nc" id="L274">				record = record.getNextSibling();</span>
			} // while (record!=null)
<span class="nc bnc" id="L276" title="All 2 branches missed.">			if (recordGroup.getNodeName().equals(&quot;RecordGroup&quot;))</span>
			{ // Go to next record group
<span class="nc" id="L278">				recordGroup = recordGroup.getNextSibling();</span>
			} // if (recordGroup.getNodeName().equals(&quot;RecordGroup&quot;))
			else
				// no record groups, simply end the loop
<span class="nc" id="L282">				recordGroup = null;</span>
<span class="nc" id="L283">		} // while (recordGroup!=null)</span>
<span class="nc" id="L284">		return result;</span>
	} // serializeRecords(Node recordsNode)

	/**
	 * &lt;code&gt;serializeTrailer&lt;/code&gt; parses the header.
	 * 
	 * @param trailerNode the trailer in the content DOM tree
	 * @return the serialized trailer as {@link java.lang.String string}
	 * @throws XException in case of an unexpected value
	 */
	private Object serializeTrailer(Node trailerNode) throws XException
	{ // Easy: no record type identification necessary
		// Jump directly to contained fields.
<span class="nc" id="L297">		return serializeFieldsAndGroups(trailerNode, trailerSpec);</span>
	} // serializeTrailer(Node trailerNode)

	/**
	 * &lt;code&gt;serializeFieldsAndGroups&lt;/code&gt; serializes the fields and group
	 * references within a record type - including header and trailer.
	 * 
	 * @param recordNode the record node in the result DOM tree
	 * @param recordType the record type specification node in the structure
	 *            descrition to get the field specs from
	 * @return the serialized records as {@link java.lang.String string}
	 * @throws XException in case of an unexpected value
	 */
	private Object serializeFieldsAndGroups(Node recordNode, Node recordType)
			throws XException
	{ // To avoid permanent string manipulations, a StringBuffer is used.
<span class="nc" id="L313">		int length = RecordTypeDescriptionChecker.computeRecordLength(</span>
				recordType, groupsSpec);
		// Length for the buffer.
<span class="nc" id="L316">		int pos = 0;</span>
		// Position in the buffer to put the next field.
<span class="nc" id="L318">		Object buffer = null;</span>
<span class="nc bnc" id="L319" title="All 2 branches missed.">		if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L320">			buffer = new StringBuffer(length);</span>
		else
<span class="nc" id="L322">			buffer = new byte[length];</span>

		try
		// for casting to XException
		{
<span class="nc" id="L327">			NodeList fieldSpecs = recordType.getChildNodes();</span>
			// The next available field node in the content DOM tree.
			// array for call by reference
<span class="nc" id="L330">			Node[] fieldNode = new Node[1];</span>
			// the first field
<span class="nc" id="L332">			fieldNode[0] = recordNode.getFirstChild();</span>

<span class="nc bnc" id="L334" title="All 2 branches missed.">			for (int i = 0; i &lt; fieldSpecs.getLength(); i++)</span>
			{ // Loop over all fields and group references in the sturcture
				// description
<span class="nc" id="L337">				Element fieldSpec = (Element) fieldSpecs.item(i);</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">				if (fieldSpec.getNodeName().equals(&quot;Field&quot;))</span>

					// a single field
<span class="nc" id="L341">					pos = serializeField(fieldSpec, buffer, pos, fieldNode);</span>
				// May have moved the actual field node in the content DOM tree

<span class="nc bnc" id="L344" title="All 2 branches missed.">				else if (fieldSpec.getNodeName().equals(&quot;Group&quot;))</span>

					// a field group
<span class="nc" id="L347">					pos = serializeGroup(fieldSpec, buffer, pos, fieldNode);</span>
				// May have moved the actual field node in the content DOM tree

			} // for (int i=0; i&lt;fieldSpecs.getLength(); i++)

			// All record fields in the content DOM tree should be serialized.
<span class="nc bnc" id="L353" title="All 2 branches missed.">			if (fieldNode[0] != null)</span>
			{
<span class="nc" id="L355">				List params = new Vector();</span>
<span class="nc" id="L356">				params.add(fieldNode[0].getNodeName());</span>
<span class="nc" id="L357">				throw new XException(Constants.LOCATION_INTERN,</span>
						Constants.LAYER_PROTOCOL,
						Constants.PACKAGE_PROTOCOL_RECORDS, &quot;125&quot;, params);
			}
		} // try
<span class="nc" id="L362">		catch (ClassCastException e)</span>
		{
<span class="nc" id="L364">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;0&quot;, e);
<span class="nc" id="L367">		} // catch</span>
<span class="nc bnc" id="L368" title="All 2 branches missed.">		if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L369">			return new String((StringBuffer) buffer);</span>
		else
<span class="nc" id="L371">			return buffer;</span>
	} // serializeFieldsAndGroups(Node recordNode, Node recordType)

	/**
	 * &lt;code&gt;serializeGroup&lt;/code&gt; serializes the fields of a field group
	 * defined in the interface structure description.
	 * 
	 * @param groupRef the group reference in the structure description
	 * @param buffer the buffer to fill with the serialized field contents
	 * @param pos the position in the buffer to start the filling
	 * @param fieldNode the next available field node in the content DOM tree -
	 *            array for call by reference
	 * @return the buffer position to start the next filling at
	 * @throws XException in case of an unexpected value
	 */
	private int serializeGroup(Element groupRef, Object buffer, int pos,
			Node[] fieldNode) throws XException
	{
		try
		// for casting to XException
		{
<span class="nc" id="L392">			NodeList fieldSpecs = RecordTypeDescriptionChecker.getGroupSpec(</span>
<span class="nc" id="L393">					groupRef.getAttribute(&quot;Name&quot;), groupsSpec).getChildNodes();</span>
			// fields in the group
<span class="nc bnc" id="L395" title="All 2 branches missed.">			for (int i = 0; i &lt; fieldSpecs.getLength(); i++)</span>
<span class="nc" id="L396">				pos = serializeField((Element) fieldSpecs.item(i), buffer, pos,</span>
						fieldNode);
		} // try
<span class="nc" id="L399">		catch (ClassCastException e)</span>
		{
<span class="nc" id="L401">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;0&quot;, e);
<span class="nc" id="L404">		} // catch</span>
<span class="nc" id="L405">		return pos;</span>
	} // serializeGroup(Element groupRef,StringBuffer buffer,int pos,Node[]
	// fieldNode)

	/**
	 * &lt;code&gt;serializeField&lt;/code&gt; serializes the fields of a field group
	 * defined in the interface structure description.
	 * 
	 * @param fieldSpec the field specification in the structure description
	 * @param buffer the buffer to fill with the serialized field contents
	 * @param pos the position in the buffer to start the filling
	 * @param fieldNode the next available field node in the content DOM tree -
	 *            array for call by reference
	 * @return the buffer position to start the next filling at
	 * @throws XException in case of an unexpected value
	 */
	private int serializeField(Element fieldSpec, Object buffer, int pos,
			Node[] fieldNode) throws XException
	{
		try
		// for casting to XException
		{
<span class="nc" id="L427">			String fieldFormat = fieldSpec.getAttribute(&quot;Format&quot;);</span>
<span class="nc bnc" id="L428" title="All 4 branches missed.">			if (fieldFormat == null || fieldFormat.length() == 0)</span>
			{
<span class="nc" id="L430">				List params = new Vector();</span>
<span class="nc" id="L431">				params.add(&quot;Format&quot;);</span>
<span class="nc" id="L432">				params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L433">						.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L434">				params.add(fieldSpec.toString());</span>
<span class="nc" id="L435">				throw new XException(Constants.LOCATION_INTERN,</span>
						Constants.LAYER_PROTOCOL,
						Constants.PACKAGE_PROTOCOL_RECORDS, &quot;82&quot;, params);
			}

			// How many characters?
<span class="nc" id="L441">			int length = Integer.parseInt(fieldSpec.getAttribute(&quot;Length&quot;));</span>

<span class="nc bnc" id="L443" title="All 2 branches missed.">			if (fieldFormat.equals(&quot;blank&quot;))</span>
			{ // only filler - no corresponding node in the content DOM tree
<span class="nc bnc" id="L445" title="All 2 branches missed.">				if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">					for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L447">						((StringBuffer) buffer).insert(pos + i, ' ');</span>
				else
<span class="nc" id="L449">					fillByteArray((byte[]) buffer, pos, length, &quot;&quot;);</span>
			} // then (fieldFormat.equals(&quot;blank&quot;))
			else
			{ // Not just filler
<span class="nc" id="L453">				String fieldName = fieldSpec.getAttribute(&quot;Name&quot;);</span>
<span class="nc" id="L454">				String nodeName = null;</span>
<span class="nc bnc" id="L455" title="All 2 branches missed.">				if (fieldNode[0] != null)</span>
<span class="nc" id="L456">					nodeName = fieldNode[0].getNodeName();</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">				if (fieldName == null)</span>
				{
<span class="nc" id="L459">					List params = new Vector();</span>
<span class="nc" id="L460">					params.add(&quot;Name&quot;);</span>
<span class="nc" id="L461">					params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L462">							.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L463">					params.add(fieldSpec.toString());</span>
<span class="nc" id="L464">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_PROTOCOL,
							Constants.PACKAGE_PROTOCOL_RECORDS, &quot;82&quot;, params);
				} // if (fieldName == null)

				// The field value may be stored in the content DOM tree or
				// a standard value may be used.
<span class="nc" id="L471">				String value = &quot;&quot;;</span>
				// standard for alphanumeric fields
<span class="nc bnc" id="L473" title="All 2 branches missed.">				if (fieldFormat.equals(&quot;num&quot;))</span>
<span class="nc" id="L474">					value = &quot;0&quot;;</span>
				// standard for numeric fields

<span class="nc bnc" id="L477" title="All 2 branches missed.">				if (fieldName.equals(nodeName))</span>
				{ // The value is given in the content DOM tree.
<span class="nc" id="L479">					value = XDomSupport.getNodeText(fieldNode[0]);</span>
					// Set the next available field in the content DOM tree one
					// further
<span class="nc" id="L482">					fieldNode[0] = fieldNode[0].getNextSibling();</span>
				} // if (fieldName.equals(nodeName))

				// Now a value - read from the content DOM tree or standard - is
				// given.
<span class="nc bnc" id="L487" title="All 2 branches missed.">				if (fieldFormat.equals(&quot;const&quot;))</span>
				{
<span class="nc" id="L489">					String constValue = fieldSpec.getAttribute(&quot;Value&quot;);</span>
					// value specified in the interface description
<span class="nc" id="L491">					byte[] constValueBytes = null;</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">					if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
					{
<span class="nc" id="L494">						constValueBytes = byteArrayConverter</span>
<span class="nc" id="L495">								.stringToByteArray(constValue);</span>
					} // if (interfaceContentClass ==
					// Constants.IFCONTENTCLASS_BYTEARRAYLIST)
<span class="nc bnc" id="L498" title="All 2 branches missed.">					if (!constValue.equals(value))</span>
					{ // The interface description must specify a value of
						// correct
						// length.
						// If the content DOM tree has a value, they must be
						// identical (after triming).
<span class="nc" id="L504">						List params = new Vector();</span>
<span class="nc" id="L505">						params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L506">								.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L507">						params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L508">						params.add(&quot;?&quot;);</span>
<span class="nc" id="L509">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_RECORDS, &quot;106&quot;,
								params);
					} // if (constValue == null || constValueLength != length
						// ||
					// value.length() &gt; 0 &amp;&amp; !constTrimed.equals(value))

<span class="nc bnc" id="L517" title="All 2 branches missed.">					if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L518">						((StringBuffer) buffer).insert(pos, constValue);</span>
					else
<span class="nc bnc" id="L520" title="All 2 branches missed.">						for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L521">							((byte[]) buffer)[pos + i] = constValueBytes[i];</span>
<span class="nc" id="L522">				} // then (fieldFormat.equals(&quot;const&quot;))</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">				else if (fieldFormat.equals(&quot;alpha&quot;))</span>
				{
<span class="nc" id="L525">					int valueLength = value.length();</span>
<span class="nc" id="L526">					byte[] valueBytes = null;</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">					if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
					{
<span class="nc" id="L529">						valueBytes = byteArrayConverter</span>
<span class="nc" id="L530">								.stringToByteArray(value);</span>
<span class="nc" id="L531">						valueLength = valueBytes.length;</span>
					}
<span class="nc bnc" id="L533" title="All 2 branches missed.">					if (length &lt; valueLength)</span>
					{
<span class="nc" id="L535">						value = value.trim();</span>
<span class="nc" id="L536">						valueLength = value.length();</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">						if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
						{
<span class="nc" id="L539">							valueBytes = byteArrayConverter</span>
<span class="nc" id="L540">									.stringToByteArray(value);</span>
<span class="nc" id="L541">							valueLength = valueBytes.length;</span>
						}
<span class="nc bnc" id="L543" title="All 2 branches missed.">						if (length &lt; valueLength)</span>
						{
<span class="nc bnc" id="L545" title="All 2 branches missed.">							if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
							{
<span class="nc" id="L547">								List params = new Vector();</span>
<span class="nc" id="L548">								params</span>
<span class="nc" id="L549">										.add(((Element) fieldSpec</span>
<span class="nc" id="L550">												.getParentNode())</span>
<span class="nc" id="L551">												.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L552">								params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L553">								params.add(value);</span>
<span class="nc" id="L554">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_PROTOCOL,
										Constants.PACKAGE_PROTOCOL_RECORDS,
										&quot;131&quot;, params);
							} // if (interfaceContentClass ==
							// Constants.IFCONTENTCLASS_STRING)
							else
							{
<span class="nc" id="L562">								valueBytes = byteArrayConverter</span>
<span class="nc" id="L563">										.stringToByteArray(value, length);</span>
<span class="nc" id="L564">								valueLength = valueBytes.length;</span>
							}
						}
					}
<span class="nc bnc" id="L568" title="All 2 branches missed.">					if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
					{
<span class="nc" id="L570">						((StringBuffer) buffer).insert(pos, value);</span>
						// Fill in blanks if the value is to short.
<span class="nc bnc" id="L572" title="All 2 branches missed.">						for (int i = 0; i &lt; length - value.length(); i++)</span>
<span class="nc" id="L573">							((StringBuffer) buffer).insert(pos + value.length()</span>
									+ i, ' ');
					}
					else
<span class="nc" id="L577">						fillByteArray((byte[]) buffer, pos, length, value);</span>
<span class="nc" id="L578">				} // then (fieldFormat.equals(&quot;alpha&quot;))</span>
<span class="nc bnc" id="L579" title="All 2 branches missed.">				else if (fieldFormat.equals(&quot;num&quot;))</span>
				{ // First look for a leading sign
<span class="nc" id="L581">					int start = 0;</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">					if (value.length() &gt; 0)</span>
					{
<span class="nc" id="L584">						char sign = value.charAt(0);</span>
<span class="nc bnc" id="L585" title="All 4 branches missed.">						if (sign == '+' || sign == '-')</span>
						{
<span class="nc bnc" id="L587" title="All 2 branches missed.">							if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
							{
<span class="nc" id="L589">								((StringBuffer) buffer).insert(pos, sign);</span>
<span class="nc" id="L590">								start = 1;</span>
							}
							else
							{
<span class="nc" id="L594">								byte[] signBytes = byteArrayConverter</span>
<span class="nc" id="L595">										.stringToByteArray(&quot;&quot; + sign);</span>
<span class="nc" id="L596">								start = signBytes.length;</span>
<span class="nc bnc" id="L597" title="All 2 branches missed.">								for (int i = 0; i &lt; start; i++)</span>
<span class="nc" id="L598">									((byte[]) buffer)[pos + i] = signBytes[i];</span>
							}
<span class="nc" id="L600">							value = value.substring(1).trim();</span>
						} // if (sign=='+' || sign=='-')
					} // if (value.length()&gt;0)

					// Look for a decimal point
<span class="nc" id="L605">					String decimalPoint = fieldSpec</span>
<span class="nc" id="L606">							.getAttribute(&quot;DecimalPoint&quot;);</span>
<span class="nc" id="L607">					int decPointPos = -1;</span>
<span class="nc bnc" id="L608" title="All 4 branches missed.">					if (decimalPoint != null &amp;&amp; decimalPoint.length() &gt; 0)</span>
					{
<span class="nc" id="L610">						char decimalP = '.';</span>
<span class="nc bnc" id="L611" title="All 2 branches missed.">						if (decimalPoint.equals(&quot;comma&quot;))</span>
<span class="nc" id="L612">							decimalP = ',';</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">						else if (!decimalPoint.equals(&quot;dot&quot;))</span>
						{
<span class="nc" id="L615">							List params = new Vector();</span>
<span class="nc" id="L616">							params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L617">									.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L618">							params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L619">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_RECORDS, &quot;107&quot;,
									params);
						} // if (!decimalPoint.equals(&quot;dot&quot;))
<span class="nc" id="L624">						decPointPos = value.indexOf(decimalP);</span>
					} // if (decimalPoint!=null &amp;&amp; decimalPoint.length()&gt;0)

					// Check digits
<span class="nc" id="L628">					int zeroBegin = -1;</span>
<span class="nc" id="L629">					int zeroEnd = value.length();</span>
<span class="nc" id="L630">					boolean onlyZeros = true;</span>
<span class="nc bnc" id="L631" title="All 2 branches missed.">					if (decPointPos &gt; -1)</span>
					{ // Check digits before decimal point
<span class="nc bnc" id="L633" title="All 2 branches missed.">						for (int i = 0; i &lt; decPointPos; i++)</span>
						{
<span class="nc bnc" id="L635" title="All 2 branches missed.">							if (!Character.isDigit(value.charAt(i)))</span>
							{
<span class="nc" id="L637">								List params = new Vector();</span>
<span class="nc" id="L638">								params</span>
<span class="nc" id="L639">										.add(((Element) fieldSpec</span>
<span class="nc" id="L640">												.getParentNode())</span>
<span class="nc" id="L641">												.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L642">								params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L643">								params.add(&quot;?&quot;);</span>
<span class="nc" id="L644">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_PROTOCOL,
										Constants.PACKAGE_PROTOCOL_RECORDS,
										&quot;108&quot;, params);
							} // if
							// (!Character.isDigit(valueWithoutSign.charAt(i)))
<span class="nc bnc" id="L650" title="All 4 branches missed.">							if (onlyZeros &amp;&amp; value.charAt(i) == '0')</span>
<span class="nc" id="L651">								zeroBegin = i;</span>
							else
<span class="nc" id="L653">								onlyZeros = false;</span>
						} // for (int i=0; i&lt;decPointPos; i++)
						// Check digits behind decimal point
<span class="nc" id="L656">						onlyZeros = true;</span>
<span class="nc bnc" id="L657" title="All 2 branches missed.">						for (int i = value.length() - 1; i &gt; decPointPos; i--)</span>
						{
<span class="nc bnc" id="L659" title="All 2 branches missed.">							if (!Character.isDigit(value.charAt(i)))</span>
							{
<span class="nc" id="L661">								List params = new Vector();</span>
<span class="nc" id="L662">								params</span>
<span class="nc" id="L663">										.add(((Element) fieldSpec</span>
<span class="nc" id="L664">												.getParentNode())</span>
<span class="nc" id="L665">												.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L666">								params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L667">								params.add(&quot;?&quot;);</span>
<span class="nc" id="L668">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_PROTOCOL,
										Constants.PACKAGE_PROTOCOL_RECORDS,
										&quot;108&quot;, params);
							} // if
							// (!Character.isDigit(valueWithoutSign.charAt(i)))
<span class="nc bnc" id="L674" title="All 4 branches missed.">							if (onlyZeros &amp;&amp; value.charAt(i) == '0')</span>
<span class="nc" id="L675">								zeroEnd = i;</span>
							else
<span class="nc" id="L677">								onlyZeros = false;</span>
						} // for (int i=valueWithoutSign.length()-1;
						// i&gt;decPointPos; i--)
					} // then (decPointPos&gt;-1)
					else
						// no decimal point
<span class="nc bnc" id="L683" title="All 2 branches missed.">						for (int i = 0; i &lt; value.length(); i++)</span>
						{
<span class="nc bnc" id="L685" title="All 2 branches missed.">							if (!Character.isDigit(value.charAt(i)))</span>
							{
<span class="nc" id="L687">								List params = new Vector();</span>
<span class="nc" id="L688">								params</span>
<span class="nc" id="L689">										.add(((Element) fieldSpec</span>
<span class="nc" id="L690">												.getParentNode())</span>
<span class="nc" id="L691">												.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L692">								params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L693">								params.add(&quot;?&quot;);</span>
<span class="nc" id="L694">								params.add(value);</span>
<span class="nc" id="L695">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_PROTOCOL,
										Constants.PACKAGE_PROTOCOL_RECORDS,
										&quot;108&quot;, params);
							} // if
							// (!Character.isDigit(valueWithoutSign.charAt(i)))
<span class="nc bnc" id="L701" title="All 4 branches missed.">							if (onlyZeros &amp;&amp; value.charAt(i) == '0')</span>
<span class="nc" id="L702">								zeroBegin = i;</span>
							else
<span class="nc" id="L704">								onlyZeros = false;</span>
						} // for (int i=0; i&lt;valueWithoutSign.length(); i++)

<span class="nc" id="L707">					String valueWithoutSignZeros = value.substring(</span>
							zeroBegin + 1, zeroEnd);
<span class="nc" id="L709">					int valueWithoutSignZerosLength = valueWithoutSignZeros</span>
<span class="nc" id="L710">							.length();</span>
<span class="nc" id="L711">					byte[] valueWithoutSignZerosBytes = null;</span>
<span class="nc bnc" id="L712" title="All 2 branches missed.">					if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
					{
<span class="nc" id="L714">						valueWithoutSignZerosBytes = byteArrayConverter</span>
<span class="nc" id="L715">								.stringToByteArray(value);</span>
<span class="nc" id="L716">						valueWithoutSignZerosLength = valueWithoutSignZerosBytes.length;</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">						if (valueWithoutSignZerosLength &gt; length - start)</span>
						{ // Too long - even if zeros are deleted.
<span class="nc" id="L719">							List params = new Vector();</span>
<span class="nc" id="L720">							params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L721">									.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L722">							params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L723">							params.add(value);</span>
<span class="nc" id="L724">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_RECORDS, &quot;131&quot;,
									params);
						} // if (valueWithoutSignZerosLength &gt; length - start)
<span class="nc" id="L729">						byte[] zero = byteArrayConverter.stringToByteArray(&quot;0&quot;);</span>
<span class="nc bnc" id="L730" title="All 2 branches missed.">						if (decPointPos &gt; -1)</span>
						{
<span class="nc" id="L732">							int offset = pos + start;</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">							for (int i = 0; i &lt; valueWithoutSignZerosLength; i++)</span>
<span class="nc" id="L734">								((byte[]) buffer)[offset + i] = valueWithoutSignZerosBytes[i];</span>
<span class="nc" id="L735">							offset += valueWithoutSignZerosLength;</span>
<span class="nc bnc" id="L736" title="All 2 branches missed.">							for (int i = 0; i &lt; (length - start - valueWithoutSignZerosLength)</span>
<span class="nc" id="L737">									/ zero.length; i++)</span>
							{
<span class="nc bnc" id="L739" title="All 2 branches missed.">								for (int j = 0; j &lt; zero.length; j++)</span>
<span class="nc" id="L740">									((byte[]) buffer)[offset + j] = zero[j];</span>
<span class="nc" id="L741">								offset += zero.length;</span>
							}
<span class="nc bnc" id="L743" title="All 2 branches missed.">							for (int i = offset; i &lt; length; i++)</span>
<span class="nc" id="L744">								((byte[]) buffer)[i] = 0;</span>
<span class="nc" id="L745">						}</span>
						else
						{
<span class="nc" id="L748">							int offset = pos + start;</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">							for (int i = 0; i &lt; (length - start - valueWithoutSignZerosLength)</span>
<span class="nc" id="L750">									/ zero.length; i++)</span>
							{
<span class="nc bnc" id="L752" title="All 2 branches missed.">								for (int j = 0; j &lt; zero.length; j++)</span>
<span class="nc" id="L753">									((byte[]) buffer)[offset + j] = zero[j];</span>
<span class="nc" id="L754">								offset += zero.length;</span>
							}
<span class="nc bnc" id="L756" title="All 2 branches missed.">							for (int i = 0; i &lt; valueWithoutSignZerosLength; i++)</span>
<span class="nc" id="L757">								((byte[]) buffer)[offset + i] = valueWithoutSignZerosBytes[i];</span>
<span class="nc" id="L758">							offset += valueWithoutSignZerosLength;</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">							for (int i = offset; i &lt; length; i++)</span>
<span class="nc" id="L760">								((byte[]) buffer)[i] = 0;</span>
						}
<span class="nc" id="L762">					}</span>
					else
					{
<span class="nc bnc" id="L765" title="All 2 branches missed.">						if (zeroEnd - zeroBegin - 1 &gt; length - start)</span>
						{
<span class="nc" id="L767">							List params = new Vector();</span>
<span class="nc" id="L768">							params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L769">									.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L770">							params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L771">							params.add(value);</span>
<span class="nc" id="L772">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_RECORDS, &quot;131&quot;,
									params);
						} // if (zeroEnd - zeroBegin - 1 &gt; length - start)
<span class="nc bnc" id="L777" title="All 2 branches missed.">						if (length - start + zeroBegin + 1 &lt; value.length())</span>
							// Delete zeros at the end after the decimal point
							// but only to that extend that the necessary length
							// is achieved by delelting leading zeros.
<span class="nc" id="L781">							value = value.substring(0, length - start</span>
									+ zeroBegin + 1);
<span class="nc bnc" id="L783" title="All 2 branches missed.">						if (zeroBegin &gt; -1)</span>
							// Delete zeros at beginning
<span class="nc" id="L785">							value = value.substring(zeroBegin + 1);</span>
						// Fill in zeros at beginning if necessary
<span class="nc bnc" id="L787" title="All 2 branches missed.">						for (int i = 0; i &lt; length - value.length() - start; i++)</span>
<span class="nc" id="L788">							((StringBuffer) buffer)</span>
<span class="nc" id="L789">									.insert(pos + start + i, '0');</span>

						// Put value into buffer - sign is already there.
<span class="nc" id="L792">						((StringBuffer) buffer).insert(pos + length</span>
<span class="nc" id="L793">								- value.length(), value);</span>
					}
<span class="nc" id="L795">				} // (fieldFormat.equals(&quot;num&quot;))</span>
<span class="nc bnc" id="L796" title="All 2 branches missed.">				else if (fieldFormat.equals(&quot;date&quot;))</span>
				{
<span class="nc bnc" id="L798" title="All 2 branches missed.">					if (value.length() == 0)</span>
						// Blanks allowed.
<span class="nc bnc" id="L800" title="All 2 branches missed.">						if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">							for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L802">								((StringBuffer) buffer).insert(pos + i, ' ');</span>
						else
<span class="nc" id="L804">							fillByteArray((byte[]) buffer, pos, length, &quot;&quot;);</span>
					else
					{
<span class="nc" id="L807">						int valueLength = value.length();</span>
<span class="nc" id="L808">						byte[] valueBytes = null;</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">						if (interfaceContentClass == Constants.IFCONTENTCLASS_BYTEARRAYLIST)</span>
						{
<span class="nc" id="L811">							valueBytes = byteArrayConverter</span>
<span class="nc" id="L812">									.stringToByteArray(value);</span>
<span class="nc" id="L813">							valueLength = valueBytes.length;</span>
						}
<span class="nc bnc" id="L815" title="All 2 branches missed.">						if (length != valueLength)</span>
						{ // Otherwise length must be correct.
<span class="nc" id="L817">							List params = new Vector();</span>
<span class="nc" id="L818">							params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L819">									.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L820">							params.add(fieldSpec.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L821">							params.add(value);</span>
<span class="nc" id="L822">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_RECORDS, &quot;138&quot;,
									params);
						}
<span class="nc bnc" id="L827" title="All 2 branches missed.">						if (interfaceContentClass == Constants.IFCONTENTCLASS_STRING)</span>
<span class="nc" id="L828">							((StringBuffer) buffer).insert(pos, value);</span>
						else
<span class="nc bnc" id="L830" title="All 2 branches missed.">							for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L831">								((byte[]) buffer)[pos + i] = valueBytes[i];</span>
<span class="nc" id="L832">					}</span>
				} // then (fieldFormat.equals(&quot;date&quot;))
				else
				{
<span class="nc" id="L836">					List params = new Vector();</span>
<span class="nc" id="L837">					params.add(((Element) fieldSpec.getParentNode())</span>
<span class="nc" id="L838">							.getAttribute(&quot;Name&quot;));</span>
<span class="nc" id="L839">					params.add(fieldFormat);</span>
<span class="nc" id="L840">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_PROTOCOL,
							Constants.PACKAGE_PROTOCOL_RECORDS, &quot;139&quot;, params);
				} // else (fieldFormat.equals(&quot;date&quot;))
			} // else (fieldFormat.equals(&quot;blank&quot;))

<span class="nc" id="L846">			return pos + length;</span>
		} // try
<span class="nc" id="L848">		catch (NumberFormatException e)</span>
		{
<span class="nc" id="L850">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL,
					Constants.PACKAGE_PROTOCOL_RECORDS, &quot;0&quot;, e);
		} // catch
	} // serializeField(Element fieldSpec,StringBuffer buffer,int pos,Node[]
	// fieldNode)

	/**
	 * Method fillByteArray.
	 * 
	 * @param b
	 * @param pos
	 * @param length
	 * @param constValue
	 */
	private void fillByteArray(byte[] arr, int pos, int length, String value)
			throws XException
	{
<span class="nc" id="L868">		byte[] fill = byteArrayConverter.stringToByteArray(value, length);</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">		for (int i = 0; i &lt; length; i++)</span>
<span class="nc" id="L870">			arr[pos + i] = fill[i];</span>
<span class="nc" id="L871">	}</span>

	/**
	 * Serializes one record.
	 * 
	 * @param doc
	 * @return a byte array containing one record
	 */
	public byte[] serializeSingleRecord(Document doc) throws XException
	{
<span class="nc" id="L881">		Element record = doc.getDocumentElement();</span>
<span class="nc" id="L882">		return (byte[]) serializeFieldsAndGroups(record,</span>
<span class="nc" id="L883">				getRecordTypeSpec(record.getNodeName()));</span>
	}

} // RecordTypeSerializer
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>