<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminDispatcherServlet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.admin.html</a> &gt; <span class="el_source">AdminDispatcherServlet.java</span></div><h1>AdminDispatcherServlet.java</h1><pre class="source lang-java linenums">package net.sf.xbus.admin.html;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import net.sf.xbus.admin.Administrator;
import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.trace.Trace;

/**
 * The &lt;code&gt;AdminDispatcherServlet&lt;/code&gt; determines the Workflow. This class
 * causes the adjustment of the Models due to a user Requests. Its function
 * exists in the sense of a Controllers in the selection and the co-ordination
 * of the Worker Beans. It is responsible for the fact that all components are
 * initialized.
 */

<span class="nc" id="L25">public class AdminDispatcherServlet</span>
{
	private static final String configurationPage = &quot;/admin/jsp/ConfigurationPage.jsp&quot;;
	private static final String mRefreshPage = &quot;/admin/jsp/ConfigurationRefresh.jsp&quot;;
	private static final String mReceiverServiceStatusViewPage = &quot;/admin/jsp/ReceiverServiceStatusView.jsp&quot;;
	private static final String mReceiverThreadStopPage = &quot;/admin/jsp/ReceiverThreadStop.jsp&quot;;
	private static final String mResultPage = &quot;/admin/jsp/Result.jsp&quot;;
	private static final String mReceiverThreadStartPage = &quot;/admin/jsp/ReceiverThreadStart.jsp&quot;;
	private static final String mResendDeletedMessagePage = &quot;/admin/jsp/DeletedMessageResend.jsp&quot;;
	private static final String mJVMStatusViewPage = &quot;/admin/jsp/JVMStatusView.jsp&quot;;
	private static final String mTraceViewPage = &quot;/admin/jsp/TraceView.jsp&quot;;

	/**
	 * Forwards the HttpRequest to the appropriate jsp.
	 * 
	 * @param url URL from jsp
	 * @param request HttpServletRequest
	 * @param response HttpServletResponse
	 * @exception XException
	 */

	private void forwardTo(String url, HttpServlet servlet,
			HttpServletRequest request, HttpServletResponse response)
			throws XException
	{
		try
		{
<span class="nc" id="L52">			RequestDispatcher dispatcher = servlet.getServletContext()</span>
<span class="nc" id="L53">					.getRequestDispatcher(url);</span>
<span class="nc" id="L54">			dispatcher.forward(request, response);</span>
		}
<span class="nc" id="L56">		catch (IOException e)</span>
		{
<span class="nc" id="L58">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_ADMIN, Constants.PACKAGE_ADMIN_ADMIN, &quot;0&quot;,
					e);
		}
<span class="nc" id="L62">		catch (ServletException e)</span>
		{
<span class="nc" id="L64">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_ADMIN, Constants.PACKAGE_ADMIN_ADMIN, &quot;0&quot;,
					e);
<span class="nc" id="L67">		}</span>

<span class="nc" id="L69">	}</span>

	/**
	 * &lt;code&gt;doPost&lt;/code&gt; is called in response to an HTTP POST request.
	 * Depending on the parameter of the HttpServletRequest sets
	 * &lt;code&gt;doPost()&lt;/code&gt; the necessary data in form of the
	 * &lt;code&gt;ConfigurationBean&lt;/code&gt; or &lt;code&gt;AdministrationBean&lt;/code&gt; to
	 * the HttpSesson and resends the HttpRequest by means of the
	 * &lt;code&gt;forwardTo()&lt;/code&gt; method to the appropriate jsp.
	 * 
	 * @param request HttpServletRequest
	 * @param response HttpServletResponse
	 */

	public void doPost(HttpServlet servlet, HttpServletRequest request,
			HttpServletResponse response)
	{

		try
		{

<span class="nc" id="L90">			String command = request.getParameter(&quot;parameter&quot;);</span>
<span class="nc" id="L91">			HttpSession session = request.getSession(true);</span>

<span class="nc bnc" id="L93" title="All 2 branches missed.">			if (command != null)</span>
			{
<span class="nc bnc" id="L95" title="All 2 branches missed.">				if (command.equals(&quot;configuration&quot;))</span>
				{
					// creates configurationBean, sets the Session and forward
					// to the configurationPage.
<span class="nc" id="L99">					ConfigurationBean configurationBean = new ConfigurationBean();</span>
<span class="nc" id="L100">					session.setAttribute(&quot;configuration&quot;, configurationBean);</span>
<span class="nc" id="L101">					forwardTo(configurationPage, servlet, request, response);</span>
<span class="nc" id="L102">				}</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">				else if (command.equals(&quot;refreshConfiguration&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.

<span class="nc bnc" id="L110" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L112">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L113">						admin.restartReceiverService();</span>
<span class="nc" id="L114">						session.setAttribute(&quot;admin&quot;, admin);</span>
<span class="nc" id="L115">					}</span>
					else
					{
<span class="nc" id="L118">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L119">								.getAttribute(&quot;admin&quot;);</span>
<span class="nc" id="L120">						admin.restartReceiverService();</span>
					}

<span class="nc" id="L123">					forwardTo(mRefreshPage, servlet, request, response);</span>
				}
<span class="nc bnc" id="L125" title="All 2 branches missed.">				else if (command.equals(&quot;viewReceiverServiceStatus&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L131" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L133">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L134">					}</span>
					else
					{
<span class="nc" id="L137">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L138">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L141">					forwardTo(mReceiverServiceStatusViewPage, servlet, request,</span>
							response);
				}
<span class="nc bnc" id="L144" title="All 2 branches missed.">				else if (command.equals(&quot;stopReceiverThread&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L150" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L152">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L153">					}</span>
					else
					{
<span class="nc" id="L156">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L157">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L160">					forwardTo(mReceiverThreadStopPage, servlet, request,</span>
							response);
				}
<span class="nc bnc" id="L163" title="All 2 branches missed.">				else if (command.equals(&quot;startReceiverThread&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L169" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L171">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L172">					}</span>
					else
					{
<span class="nc" id="L175">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L176">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L179">					forwardTo(mReceiverThreadStartPage, servlet, request,</span>
							response);
				}
<span class="nc bnc" id="L182" title="All 2 branches missed.">				else if (command.equals(&quot;resendDeletedMessage&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L188" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L190">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L191">					}</span>
					else
					{
<span class="nc" id="L194">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L195">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L198">					forwardTo(mResendDeletedMessagePage, servlet, request,</span>
							response);
				}
<span class="nc bnc" id="L201" title="All 2 branches missed.">				else if (command.equals(&quot;viewJVMStatus&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L207" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L209">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L210">					}</span>
					else
					{
<span class="nc" id="L213">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L214">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L217">					forwardTo(mJVMStatusViewPage, servlet, request, response);</span>
				}
<span class="nc bnc" id="L219" title="All 2 branches missed.">				else if (command.equals(&quot;viewTrace&quot;))</span>
				{
					// creates or gets the administrationBean (dependent on this
					// presence
					// in the HttpSession), sets the property and forward to the
					// refreshPage.
<span class="nc bnc" id="L225" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L227">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L228">					}</span>
					else
					{
<span class="nc" id="L231">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L232">								.getAttribute(&quot;admin&quot;);</span>
					}

<span class="nc" id="L235">					forwardTo(mTraceViewPage, servlet, request, response);</span>
				}
			}
			else
			{
<span class="nc" id="L240">				String threadName = null;</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">				if ((threadName = request.getParameter(&quot;stopReceiverThread&quot;)) != null)</span>
				{
<span class="nc bnc" id="L243" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L245">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L246">						admin.setTitle(&quot;Stop ReceiverThread&quot;);</span>
<span class="nc" id="L247">						admin.setResult(new Administrator()</span>
<span class="nc" id="L248">								.demandStopBackgroundReceiver(threadName));</span>
<span class="nc" id="L249">						session.setAttribute(&quot;admin&quot;, admin);</span>
<span class="nc" id="L250">					}</span>
					else
					{
<span class="nc" id="L253">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L254">								.getAttribute(&quot;admin&quot;);</span>
<span class="nc" id="L255">						admin.setTitle(&quot;Stop ReceiverThread&quot;);</span>
<span class="nc" id="L256">						admin.setResult(new Administrator()</span>
<span class="nc" id="L257">								.demandStopBackgroundReceiver(threadName));</span>
					}

<span class="nc" id="L260">					forwardTo(mResultPage, servlet, request, response);</span>
				}
<span class="nc" id="L262">				else if ((threadName = request</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">						.getParameter(&quot;startReceiverThread&quot;)) != null)</span>
				{
<span class="nc bnc" id="L265" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L267">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L268">						admin.setTitle(&quot;Start ReceiverThread&quot;);</span>
<span class="nc" id="L269">						admin.setResult(new Administrator()</span>
<span class="nc" id="L270">								.startBackgroundReceiver(threadName));</span>
<span class="nc" id="L271">						session.setAttribute(&quot;admin&quot;, admin);</span>
<span class="nc" id="L272">					}</span>
					else
					{
<span class="nc" id="L275">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L276">								.getAttribute(&quot;admin&quot;);</span>
<span class="nc" id="L277">						admin.setTitle(&quot;Start ReceiverThread&quot;);</span>
<span class="nc" id="L278">						admin.setResult(new Administrator()</span>
<span class="nc" id="L279">								.startBackgroundReceiver(threadName));</span>
					}

<span class="nc" id="L282">					forwardTo(mResultPage, servlet, request, response);</span>
				}
<span class="nc bnc" id="L284" title="All 2 branches missed.">				else if ((threadName = request.getParameter(&quot;resend&quot;)) != null)</span>
				{
<span class="nc bnc" id="L286" title="All 2 branches missed.">					if (session.getAttribute(&quot;admin&quot;) == null)</span>
					{
<span class="nc" id="L288">						AdministrationBean admin = new AdministrationBean();</span>
<span class="nc" id="L289">						admin.setTitle(&quot;Resend Deleted Message&quot;);</span>
<span class="nc" id="L290">						admin.setResult(new Administrator()</span>
<span class="nc" id="L291">								.resendDeletedMessage(threadName));</span>
<span class="nc" id="L292">						session.setAttribute(&quot;admin&quot;, admin);</span>
<span class="nc" id="L293">					}</span>
					else
					{
<span class="nc" id="L296">						AdministrationBean admin = (AdministrationBean) session</span>
<span class="nc" id="L297">								.getAttribute(&quot;admin&quot;);</span>
<span class="nc" id="L298">						admin.setTitle(&quot;Resend Deletet Message&quot;);</span>
<span class="nc" id="L299">						admin.setResult(new Administrator()</span>
<span class="nc" id="L300">								.resendDeletedMessage(threadName));</span>
					}

<span class="nc" id="L303">					forwardTo(mResultPage, servlet, request, response);</span>
				}
			}
		}
<span class="nc" id="L307">		catch (Exception ex)</span>
		{
<span class="nc" id="L309">			Trace.error(ex);</span>

<span class="nc" id="L311">			response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);</span>
			// ex.printStackTrace();
<span class="nc" id="L313">		}</span>

<span class="nc" id="L315">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>