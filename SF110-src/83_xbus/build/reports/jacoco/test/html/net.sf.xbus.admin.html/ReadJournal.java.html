<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ReadJournal.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.admin.html</a> &gt; <span class="el_source">ReadJournal.java</span></div><h1>ReadJournal.java</h1><pre class="source lang-java linenums">package net.sf.xbus.admin.html;

import java.sql.ResultSet;
import java.util.HashMap;
import java.util.List;
import java.util.Vector;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.config.Configuration;
import net.sf.xbus.technical.database.DBConnection;

/**
 * &lt;code&gt;ReadJournal&lt;/code&gt; reads information about the activities of the
 * middleware from the database and handles the information which is stored in
 * the database-table &lt;code&gt;journal&lt;/code&gt;. An instance of
 * {@link net.sf.xbus.technical.database.DBConnection} is used for handling the
 * database-connection.
 */
<span class="nc" id="L20">public class ReadJournal</span>
{

	private int mNumber;
	private char mType;
	private String mSystem;
	private String mFunction;
	private String mMessageId;
	private String mRequestMessage;
	private String mRequestTimestamp;
	private String mResponseMessage;
	private String mResponseTimestamp;
	private String mReturncode;
	private int mErrorcode;
	private String mErrormessage;

	/**
	 * Gets the number from the journal
	 */
	public int getNumber()
	{
<span class="nc" id="L41">		return mNumber;</span>
	}

	/**
	 * Allows you to set the number in the journal
	 */
	public void setNumber(int number)
	{
<span class="nc" id="L49">		mNumber = number;</span>
<span class="nc" id="L50">	}</span>

	/**
	 * Gets the type of the message from the journal
	 */
	public char getType()
	{
<span class="nc" id="L57">		return mType;</span>
	}

	/**
	 * Allows you to set the type of the message
	 */
	public void setType(char type)
	{
<span class="nc" id="L65">		mType = type;</span>
<span class="nc" id="L66">	}</span>

	/**
	 * Gets the system from the journal
	 */
	public String getSystem()
	{
<span class="nc" id="L73">		return mSystem;</span>
	}

	/**
	 * Allows you to set the system
	 */
	public void setSystem(String system)
	{
<span class="nc" id="L81">		mSystem = system;</span>
<span class="nc" id="L82">	}</span>

	/**
	 * Gets the function from the journal
	 */
	public String getFunction()
	{
<span class="nc" id="L89">		return mFunction;</span>
	}

	/**
	 * Allows you to set the function
	 */
	public void setFunction(String function)
	{
<span class="nc" id="L97">		mFunction = function;</span>
<span class="nc" id="L98">	}</span>

	/**
	 * Gets the message id from the journal
	 */
	public String getMessageId()
	{
<span class="nc" id="L105">		return mMessageId;</span>
	}

	/**
	 * Allows you to set the message id
	 */
	public void setMessageId(String messageId)
	{
<span class="nc" id="L113">		mMessageId = messageId;</span>
<span class="nc" id="L114">	}</span>

	/**
	 * Gets the request message from the journal
	 */
	public String getRequestMessage()
	{
<span class="nc" id="L121">		return mRequestMessage;</span>
	}

	/**
	 * Allows you to set the request message
	 */
	public void setRequestMessage(String requestMessage)
	{
<span class="nc" id="L129">		mRequestMessage = requestMessage;</span>
<span class="nc" id="L130">	}</span>

	/**
	 * Gets the request timestamp from the journal
	 */
	public String getRequestTimestamp()
	{
<span class="nc" id="L137">		return mRequestTimestamp;</span>
	}

	/**
	 * Allows you to set the request timestamp
	 */
	public void setRequestTimestamp(String requestTimestamp)
	{
<span class="nc" id="L145">		mRequestTimestamp = requestTimestamp;</span>
<span class="nc" id="L146">	}</span>

	/**
	 * Gets the response message from the journal
	 */
	public String getResponseMessage()
	{
<span class="nc" id="L153">		return mResponseMessage;</span>
	}

	public void setResponseMessage(String responseMessage)
	/**
	 * Allows you to set the response message
	 */
	{
<span class="nc" id="L161">		mResponseMessage = responseMessage;</span>
<span class="nc" id="L162">	}</span>

	/**
	 * Gets the response timestamp from the journal
	 */
	public String getResponseTimestamp()
	{
<span class="nc" id="L169">		return mResponseTimestamp;</span>
	}

	/**
	 * Allows you to set the response timestamp
	 */
	public void setResponseTimestamp(String responseTimestamp)
	{
<span class="nc" id="L177">		mResponseTimestamp = responseTimestamp;</span>
<span class="nc" id="L178">	}</span>

	/**
	 * Gets the return code from the journal
	 */
	public String getReturncode()
	{
<span class="nc" id="L185">		return mReturncode;</span>
	}

	/**
	 * Allows you to set the returncode
	 */
	public void setReturncode(String returncode)
	{
<span class="nc" id="L193">		mReturncode = returncode;</span>
<span class="nc" id="L194">	}</span>

	/**
	 * Gets the error code from the journal
	 */
	public int getErrorcode()
	{
<span class="nc" id="L201">		return mErrorcode;</span>
	}

	/**
	 * Allows you to set the error code
	 */
	public void setErrorcode(int errorcode)
	{
<span class="nc" id="L209">		mErrorcode = errorcode;</span>
<span class="nc" id="L210">	}</span>

	/**
	 * Gets the error message from the journal
	 */
	public String getErrormessage()
	{
<span class="nc" id="L217">		return mErrormessage;</span>
	}

	/**
	 * Allows you to set the error message
	 */
	public void setErrormessage(String errormessage)
	{
<span class="nc" id="L225">		mErrormessage = errormessage;</span>
<span class="nc" id="L226">	}</span>

	/**
	 * &lt;code&gt;readSelected(HashMap, String, String)&lt;/code&gt; builds the SQL
	 * statement, connects to the database and executes it. All data from the
	 * &lt;code&gt;ResultSet&lt;/code&gt; strore erst in the &lt;code&gt;ReadJournal&lt;/code&gt;
	 * object and then in the List.
	 * 
	 * @param selectionMap - HashMap with items should be selected
	 * @param orderBy - String (by wich data should be ordered)
	 * @param sorting -String (descending or not)
	 * @return List with the ReadJournal objects
	 */
	static public List readSelected(HashMap selectionMap, String orderBy,
			String sorting) throws XException
	{
<span class="nc" id="L242">		String sqlBefehl = &quot;SELECT * FROM journal &quot;;</span>

<span class="nc bnc" id="L244" title="All 2 branches missed.">		if (!selectionMap.isEmpty())</span>
		{

<span class="nc" id="L247">			sqlBefehl += &quot;WHERE &quot;;</span>
<span class="nc" id="L248">			List keyList = new Vector();</span>
<span class="nc" id="L249">			keyList.addAll(selectionMap.keySet());</span>

<span class="nc bnc" id="L251" title="All 2 branches missed.">			for (int i = 0; i &lt; keyList.size(); i++)</span>
			{
<span class="nc" id="L253">				String fieldName = (String) keyList.get(i);</span>
<span class="nc" id="L254">				String fieldValue = (String) selectionMap.get(fieldName);</span>

<span class="nc bnc" id="L256" title="All 2 branches missed.">				if (fieldName.equals(&quot;RequestTimeMin&quot;))</span>
				{
<span class="nc" id="L258">					sqlBefehl += &quot;jo_request_timestamp &gt;='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L260" title="All 2 branches missed.">				else if (fieldName.equals(&quot;RequestTimeMax&quot;))</span>
				{
<span class="nc" id="L262">					sqlBefehl += &quot;jo_request_timestamp &lt;='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L264" title="All 2 branches missed.">				else if (fieldName.equals(&quot;RequestMessage&quot;))</span>
				{
<span class="nc" id="L266">					sqlBefehl += &quot;jo_request_message LIKE '%&quot; + fieldValue</span>
							+ &quot;%'&quot;;
				}
<span class="nc bnc" id="L269" title="All 2 branches missed.">				else if (fieldName.equals(&quot;ResponseMessage&quot;))</span>
				{
<span class="nc" id="L271">					sqlBefehl += &quot;jo_response_message LIKE '%&quot; + fieldValue</span>
							+ &quot;%'&quot;;
				}
<span class="nc bnc" id="L274" title="All 2 branches missed.">				else if (fieldName.equals(&quot;Type&quot;))</span>
				{
<span class="nc" id="L276">					sqlBefehl += &quot;jo_type ='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L278" title="All 2 branches missed.">				else if (fieldName.equals(&quot;Returncode&quot;))</span>
				{
<span class="nc" id="L280">					sqlBefehl += &quot;jo_returncode ='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L282" title="All 2 branches missed.">				else if (fieldName.equals(&quot;System&quot;))</span>
				{
<span class="nc" id="L284">					sqlBefehl += &quot;jo_system ='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L286" title="All 2 branches missed.">				else if (fieldName.equals(&quot;Function&quot;))</span>
				{
<span class="nc" id="L288">					sqlBefehl += &quot;jo_function ='&quot; + fieldValue + &quot;' &quot;;</span>
				}
<span class="nc bnc" id="L290" title="All 2 branches missed.">				else if (fieldName.equals(&quot;MessageId&quot;))</span>
				{
<span class="nc" id="L292">					sqlBefehl += &quot;jo_message_id ='&quot; + fieldValue + &quot;' &quot;;</span>
				}
				else
				{
<span class="nc" id="L296">					List params = new Vector();</span>
<span class="nc" id="L297">					params.add(fieldName);</span>
<span class="nc" id="L298">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_ADMIN,
							Constants.PACKAGE_ADMIN_ADMIN, &quot;3&quot;, params);
				}

<span class="nc bnc" id="L303" title="All 2 branches missed.">				if (i &lt; (keyList.size() - 1))</span>
				{
<span class="nc" id="L305">					sqlBefehl += &quot;AND &quot;;</span>
				}
			}

		}

		String order;
<span class="nc bnc" id="L312" title="All 2 branches missed.">		if (orderBy.equals(&quot;Number&quot;))</span>
		{
<span class="nc" id="L314">			order = &quot;jo_id&quot;;</span>
		}
<span class="nc bnc" id="L316" title="All 2 branches missed.">		else if (orderBy.equals(&quot;Returncode&quot;))</span>
		{
<span class="nc" id="L318">			order = &quot;jo_returncode&quot;;</span>
		}
<span class="nc bnc" id="L320" title="All 2 branches missed.">		else if (orderBy.equals(&quot;System&quot;))</span>
		{
<span class="nc" id="L322">			order = &quot;jo_system&quot;;</span>
		}
<span class="nc bnc" id="L324" title="All 2 branches missed.">		else if (orderBy.equals(&quot;Function&quot;))</span>
		{
<span class="nc" id="L326">			order = &quot;jo_function&quot;;</span>
		}
<span class="nc bnc" id="L328" title="All 2 branches missed.">		else if (orderBy.equals(&quot;MessageId&quot;))</span>
		{
<span class="nc" id="L330">			order = &quot;jo_message_id&quot;;</span>
		}
<span class="nc bnc" id="L332" title="All 2 branches missed.">		else if (orderBy.equals(&quot;type&quot;))</span>
		{
<span class="nc" id="L334">			order = &quot;jo_type&quot;;</span>
		}
<span class="nc bnc" id="L336" title="All 2 branches missed.">		else if (orderBy.equals(&quot;RequestTimestamp&quot;))</span>
		{
<span class="nc" id="L338">			order = &quot;jo_request_timestamp&quot;;</span>
		}
		else
		{
<span class="nc" id="L342">			List params = new Vector();</span>
<span class="nc" id="L343">			params.add(orderBy);</span>
<span class="nc" id="L344">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_ADMIN, Constants.PACKAGE_ADMIN_ADMIN, &quot;4&quot;,
					params);
		}

<span class="nc" id="L349">		sqlBefehl += &quot;ORDER BY &quot; + order;</span>

<span class="nc bnc" id="L351" title="All 2 branches missed.">		if (sorting.equals(&quot;Descending&quot;))</span>
		{
<span class="nc" id="L353">			sqlBefehl += &quot; DESC&quot;;</span>
		}

		try
		{
<span class="nc" id="L358">			String dbConnectionName = Configuration.getInstance()</span>
<span class="nc" id="L359">					.getValueOptional(&quot;Base&quot;, &quot;Journal&quot;, &quot;DBConnection&quot;);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">			if (dbConnectionName == null)</span>
			{
<span class="nc" id="L362">				dbConnectionName = DBConnection.UNNAMED;</span>
			}
<span class="nc" id="L364">			DBConnection dbCon = DBConnection.getInstance(dbConnectionName);</span>

<span class="nc" id="L366">			ResultSet result = dbCon.executeRead(sqlBefehl);</span>
<span class="nc" id="L367">			Vector list = new Vector();</span>

<span class="nc bnc" id="L369" title="All 2 branches missed.">			while (result.next())</span>
			{
<span class="nc" id="L371">				ReadJournal journal = new ReadJournal();</span>
<span class="nc" id="L372">				journal.setNumber(result.getInt(&quot;jo_id&quot;));</span>
<span class="nc bnc" id="L373" title="All 2 branches missed.">				if ((result.getString(&quot;jo_type&quot;) == null)</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">						|| (result.getString(&quot;jo_type&quot;).length() == 0))</span>
				{
<span class="nc" id="L376">					journal.setType(' ');</span>
				}
				else
				{
<span class="nc" id="L380">					journal.setType(result.getString(&quot;jo_type&quot;).charAt(0));</span>
				}
<span class="nc" id="L382">				journal.setSystem(result.getString(&quot;jo_system&quot;));</span>
<span class="nc" id="L383">				journal.setFunction(result.getString(&quot;jo_function&quot;));</span>
<span class="nc" id="L384">				journal.setMessageId(result.getString(&quot;jo_message_id&quot;));</span>
<span class="nc" id="L385">				journal.setRequestMessage(result</span>
<span class="nc" id="L386">						.getString(&quot;jo_request_message&quot;));</span>
<span class="nc" id="L387">				journal.setRequestTimestamp(result</span>
<span class="nc" id="L388">						.getString(&quot;jo_request_timestamp&quot;));</span>
<span class="nc" id="L389">				journal.setResponseMessage(result</span>
<span class="nc" id="L390">						.getString(&quot;jo_response_message&quot;));</span>
<span class="nc" id="L391">				journal.setResponseTimestamp(result</span>
<span class="nc" id="L392">						.getString(&quot;jo_response_timestamp&quot;));</span>
<span class="nc" id="L393">				journal.setReturncode(result.getString(&quot;jo_returncode&quot;));</span>
<span class="nc" id="L394">				journal.setErrorcode(result.getInt(&quot;jo_errorcode&quot;));</span>
<span class="nc" id="L395">				journal.setErrormessage(result.getString(&quot;jo_errormessage&quot;));</span>

<span class="nc" id="L397">				list.add(journal);</span>
<span class="nc" id="L398">			}</span>

<span class="nc" id="L400">			return list;</span>
		}
<span class="nc" id="L402">		catch (Exception e)</span>
		{
<span class="nc" id="L404">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_ADMIN, Constants.PACKAGE_ADMIN_ADMIN, &quot;0&quot;,
					e);
		}

	}

	/**
	 * Gets all necessary information from the journal as one String in the
	 * following format:
	 * 
	 * &lt;pre&gt;
	 * number | messageId | function | type | system | requestTimestamp
	 * 		| ResponseTimestamp | Returncode
	 * &lt;/pre&gt;
	 * 
	 * @return String
	 */
	public String toString()
	{
<span class="nc" id="L424">		return mNumber + &quot; | &quot; + mMessageId + &quot; | &quot; + mFunction + &quot; | &quot; + mType</span>
				+ &quot; | &quot; + mSystem + &quot; | &quot; + mRequestTimestamp + &quot; | &quot;
				+ mResponseTimestamp + &quot; | &quot; + mReturncode;
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>