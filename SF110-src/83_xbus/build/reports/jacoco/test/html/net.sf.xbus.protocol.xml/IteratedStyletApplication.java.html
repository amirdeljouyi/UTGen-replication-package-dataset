<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>IteratedStyletApplication.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.protocol.xml</a> &gt; <span class="el_source">IteratedStyletApplication.java</span></div><h1>IteratedStyletApplication.java</h1><pre class="source lang-java linenums">/*
 * Created on 04.10.2004
 * 
 * To change the template for this generated file go to
 * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
 */
package net.sf.xbus.protocol.xml;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Hashtable;
import java.util.List;
import java.util.Vector;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.config.Configuration;
import net.sf.xbus.base.xbussystem.AdditionalAddress;
import net.sf.xbus.base.xbussystem.XBUSSystem;
import net.sf.xbus.base.xml.IteratedNodeOperation;
import net.sf.xbus.protocol.Message;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;

/**
 * @author Duewel
 * 
 * To change the template for this generated type comment go to
 * Window&gt;Preferences&gt;Java&gt;Code Generation&gt;Code and Comments
 */
class IteratedStyletApplication implements IteratedNodeOperation
{

	/**
	 * The XML document, in which the stylets are applied. Used for node
	 * creation.
	 */
	private Document mDoc;

	/**
	 * The message, in which the stylet application takes place. Used for
	 * pasting message information into the result document.
	 */
	private Message mMessage;

	/**
	 * Key/value pairs for mapping values.
	 */
	private Hashtable mStyletValues;

	/**
	 * Construct an object for stylet application.
	 * 
	 * @param xmlNew the XML document, in which the stylets are applied.
	 * @param message the message, in which the stylet application takes place.
	 */
	public IteratedStyletApplication(Document xmlNew, Message message,
			Hashtable styletValues)
<span class="nc" id="L61">	{</span>
<span class="nc" id="L62">		mDoc = xmlNew;</span>
<span class="nc" id="L63">		mMessage = message;</span>
<span class="nc" id="L64">		mStyletValues = styletValues;</span>
<span class="nc" id="L65">	} // IteratedStyletApplication(Document xmlNew, Message message)</span>

	/**
	 * @see net.sf.xbus.base.xml.IteratedNodeOperation#iteratedProcedure(org.w3c.dom.Node)
	 */
	public void iteratedProcedure(Node node) throws XException
	{
		try
		{
<span class="nc bnc" id="L74" title="All 2 branches missed.">			if (node.getNodeType() == Node.ELEMENT_NODE</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">					&amp;&amp; node.getNodeName().equals(&quot;XBUS_Stylet&quot;))</span>
			{
<span class="nc" id="L77">				Node parent = node.getParentNode();</span>

<span class="nc" id="L79">				String styletName = ((Element) node).getAttribute(&quot;Name&quot;);</span>
<span class="nc bnc" id="L80" title="All 4 branches missed.">				if ((styletName == null) || (styletName.length() == 0))</span>
				{
<span class="nc" id="L82">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_PROTOCOL,
							Constants.PACKAGE_PROTOCOL_XML, &quot;18&quot;);
				} // if ((styletName == null) || (styletName.length() == 0))
<span class="nc" id="L86">				String tagName = ((Element) node).getAttribute(&quot;Tag&quot;);</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">				if ((tagName == null) || (tagName.length() == 0)</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">						&amp;&amp; !styletName.equals(&quot;Value&quot;)</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">						&amp;&amp; !styletName.equals(&quot;AddressMapping&quot;)</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">						&amp;&amp; !styletName.equals(&quot;FormatDate&quot;)</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">						&amp;&amp; !styletName.equals(&quot;DateComparison&quot;))</span>
				{
<span class="nc" id="L93">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_PROTOCOL,
							Constants.PACKAGE_PROTOCOL_XML, &quot;19&quot;);
				} // if ((tagName == null) || (tagName.length() == 0) ...

<span class="nc bnc" id="L98" title="All 2 branches missed.">				if (styletName.equals(&quot;Id&quot;))</span>
				{
<span class="nc" id="L100">					insertValue(tagName, mMessage.getId(), parent, node);</span>
				} // then (styletName.equals(&quot;Id&quot;))

<span class="nc bnc" id="L103" title="All 2 branches missed.">				else if (styletName.equals(&quot;Source&quot;))</span>
				{
<span class="nc" id="L105">					insertValue(tagName, mMessage.getSource().getName(),</span>
							parent, node);
				} // then (styletName.equals(&quot;Source&quot;))

<span class="nc bnc" id="L109" title="All 2 branches missed.">				else if (styletName.equals(&quot;RequestTimestamp&quot;))</span>
				{
<span class="nc" id="L111">					insertValue(tagName, Constants.getDateFormat().format(</span>
<span class="nc" id="L112">							mMessage.getRequestTimestamp()), parent, node);</span>
				} // then (styletName.equals(&quot;RequestTimestamp&quot;))

<span class="nc bnc" id="L115" title="All 2 branches missed.">				else if (styletName.equals(&quot;Value&quot;))</span>
				{
<span class="nc" id="L117">					String section = ((Element) node).getAttribute(&quot;Section&quot;);</span>
<span class="nc" id="L118">					String keyName = ((Element) node).getAttribute(&quot;Key&quot;);</span>
<span class="nc bnc" id="L119" title="All 4 branches missed.">					if ((keyName == null) || (keyName.length() == 0))</span>
					{
<span class="nc" id="L121">						List params = new Vector();</span>
<span class="nc" id="L122">						params.add(styletName);</span>
<span class="nc" id="L123">						params.add(section);</span>
<span class="nc" id="L124">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;20&quot;, params);
					} // if ((keyName == null) || (keyName.length() == 0))

<span class="nc" id="L129">					String value = null;</span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">					if (section == null || section.length() == 0)</span>
					{
<span class="nc" id="L132">						value = (String) mStyletValues.get(keyName);</span>
					} // then (section == null || section.length() == 0)
					else
					{
<span class="nc" id="L136">						value = Configuration.getMappingOptional(section,</span>
								keyName);
<span class="nc bnc" id="L138" title="All 2 branches missed.">						if (value == null)</span>
						{
							try
							{
<span class="nc" id="L142">								value = Configuration</span>
<span class="nc" id="L143">										.getMappingDefault(section);</span>
							}
<span class="nc" id="L145">							catch (XException e)</span>
							{ // Catch XException to past the missing key
								// value into
								// the (second) error message.
<span class="nc" id="L149">								List params = new Vector();</span>
<span class="nc" id="L150">								params.add(section);</span>
<span class="nc" id="L151">								params.add(keyName);</span>
<span class="nc" id="L152">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_PROTOCOL,
										Constants.PACKAGE_PROTOCOL_XML, &quot;24&quot;,
										params);
<span class="nc" id="L156">							} // catch (XException e)</span>
						} // if (value==null)
					} // else (section == null || section.length() == 0)
<span class="nc bnc" id="L159" title="All 2 branches missed.">					if (value == null)</span>
					{
<span class="nc" id="L161">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;21&quot;);
					} // if (value == null)

					// replace the stylet node in the DOM tree
<span class="nc" id="L167">					insertValue(tagName, value, parent, node);</span>

<span class="nc" id="L169">				} // then (styletName.equals(&quot;Value&quot;))</span>

<span class="nc bnc" id="L171" title="All 2 branches missed.">				else if (styletName.equals(&quot;CDATA&quot;))</span>
				{
<span class="nc" id="L173">					String keyName = ((Element) node).getAttribute(&quot;Key&quot;);</span>
<span class="nc bnc" id="L174" title="All 4 branches missed.">					if ((keyName == null) || (keyName.length() == 0))</span>
					{
<span class="nc" id="L176">						List params = new Vector();</span>
<span class="nc" id="L177">						params.add(styletName);</span>
<span class="nc" id="L178">						params.add(&quot;&quot;);</span>
<span class="nc" id="L179">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;20&quot;, params);
					} // if ((keyName == null) || (keyName.length() == 0))
<span class="nc" id="L183">					String value = (String) mStyletValues.get(keyName);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">					if (value == null)</span>
					{
<span class="nc" id="L186">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;21&quot;);
					} // if (value == null)
<span class="nc" id="L190">					Element newElement = mDoc.createElement(tagName);</span>
<span class="nc" id="L191">					newElement.appendChild(mDoc.createCDATASection(value));</span>
<span class="nc" id="L192">					parent.replaceChild(newElement, node);</span>
<span class="nc" id="L193">				} // then (styletName.equals(&quot;CDATA&quot;))</span>

<span class="nc bnc" id="L195" title="All 2 branches missed.">				else if (styletName.equals(&quot;FormatDate&quot;))</span>
				{
<span class="nc" id="L197">					String oldFormat = ((Element) node)</span>
<span class="nc" id="L198">							.getAttribute(&quot;SourceFormat&quot;);</span>
<span class="nc" id="L199">					String newFormat = ((Element) node)</span>
<span class="nc" id="L200">							.getAttribute(&quot;DestinationFormat&quot;);</span>
<span class="nc bnc" id="L201" title="All 4 branches missed.">					if (newFormat == null || newFormat.length() == 0)</span>
					{
<span class="nc" id="L203">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;22&quot;);
					} // if (newFormat==null || newFormat.length()==0)

<span class="nc" id="L208">					String keyName = ((Element) node).getAttribute(&quot;Key&quot;);</span>
<span class="nc bnc" id="L209" title="All 4 branches missed.">					if (oldFormat == null || oldFormat.length() == 0)</span>
					{
<span class="nc bnc" id="L211" title="All 4 branches missed.">						if (keyName != null &amp;&amp; keyName.length() &gt; 0)</span>
						{
<span class="nc" id="L213">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_XML, &quot;22&quot;);
						} // if (keyName != null &amp;&amp; keyName.length() &gt; 0)
					} // then (oldFormat==null || oldFormat.length()==0)
<span class="nc bnc" id="L218" title="All 4 branches missed.">					else if ((keyName == null) || (keyName.length() == 0))</span>
					{
<span class="nc" id="L220">						List params = new Vector();</span>
<span class="nc" id="L221">						params.add(styletName);</span>
<span class="nc" id="L222">						params.add(&quot;&quot;);</span>
<span class="nc" id="L223">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;20&quot;, params);
					} // if ((keyName == null) || (keyName.length() == 0))

<span class="nc" id="L228">					Date date = null;</span>
<span class="nc" id="L229">					SimpleDateFormat formater = null;</span>
<span class="nc bnc" id="L230" title="All 4 branches missed.">					if (oldFormat == null || oldFormat.length() == 0)</span>
					{
<span class="nc" id="L232">						date = new Date();</span>
<span class="nc" id="L233">						formater = new SimpleDateFormat(newFormat);</span>
					} // then (oldFormat == null || oldFormat.length() == 0)
					else
					{
<span class="nc" id="L237">						formater = new SimpleDateFormat(oldFormat);</span>
<span class="nc" id="L238">						date = formater.parse(keyName);</span>
<span class="nc" id="L239">						formater.applyPattern(newFormat);</span>
					} // else (oldFormat == null || oldFormat.length() == 0)
<span class="nc" id="L241">					String value = formater.format(date);</span>

<span class="nc" id="L243">					insertValue(tagName, value, parent, node);</span>
<span class="nc" id="L244">				} // then (styletName.equals(&quot;FormatDate&quot;))</span>

<span class="nc bnc" id="L246" title="All 2 branches missed.">				else if (styletName.equals(&quot;AddressMapping&quot;))</span>
				{ // for value mapping from the AddtionalAddressImplementation
					// the originating value type
<span class="nc" id="L249">					String section = ((Element) node).getAttribute(&quot;Section&quot;);</span>
					// the destination value type
<span class="nc" id="L251">					String toSection = ((Element) node)</span>
<span class="nc" id="L252">							.getAttribute(&quot;toSection&quot;);</span>
					// the key to map
<span class="nc" id="L254">					String keyName = ((Element) node).getAttribute(&quot;Key&quot;);</span>
<span class="nc bnc" id="L255" title="All 4 branches missed.">					if ((keyName == null) || (keyName.length() == 0))</span>
					{
<span class="nc" id="L257">						List params = new Vector();</span>
<span class="nc" id="L258">						params.add(styletName);</span>
<span class="nc" id="L259">						params.add(section);</span>
<span class="nc" id="L260">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;20&quot;, params);
					} // if ((keyName == null) || (keyName.length() == 0))
<span class="nc bnc" id="L264" title="All 6 branches missed.">					if ((section == null) || (section.length() == 0)</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">							|| (toSection == null) || (toSection.length() == 0))</span>
					{
<span class="nc" id="L267">						List params = new Vector();</span>
<span class="nc" id="L268">						params.add(styletName);</span>
<span class="nc" id="L269">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;23&quot;, params);
					} // if ((section == null) || (section.length() == 0) ||
						// (toSection == null) || (toSection.length() == 0))

<span class="nc" id="L275">					AdditionalAddress addressImpl = XBUSSystem</span>
<span class="nc" id="L276">							.getAdditionalAddressImplementation(mMessage</span>
<span class="nc" id="L277">									.getSource().getName());</span>
					// the mapped value
<span class="nc" id="L279">					String value = addressImpl.getValue(section, toSection,</span>
							keyName);

<span class="nc bnc" id="L282" title="All 2 branches missed.">					if (value == null)</span>
					{
<span class="nc" id="L284">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;21&quot;);
					} // if (value == null)

					// replace the stylet node in the DOM tree
<span class="nc" id="L290">					insertValue(tagName, value, parent, node);</span>
<span class="nc" id="L291">				} // if (styletName.equals(&quot;AddressMapping&quot;))</span>

<span class="nc bnc" id="L293" title="All 2 branches missed.">				else if (styletName.equals(&quot;DateComparison&quot;))</span>
				{ // Compare a given or the actual date against an time
					// interval
					// or a single date.

					// Begin of the interval or single date to compare against.
<span class="nc" id="L299">					String beginString = ((Element) node)</span>
<span class="nc" id="L300">							.getAttribute(&quot;BeginDate&quot;);</span>
<span class="nc" id="L301">					Date beginDate = null;</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">					if (beginString.length() &gt; 0)</span>
					{ // Begin date is specified. Get it as date object.
<span class="nc" id="L304">						String beginFormat = ((Element) node)</span>
<span class="nc" id="L305">								.getAttribute(&quot;BeginFormat&quot;);</span>
<span class="nc" id="L306">						SimpleDateFormat formater = new SimpleDateFormat(</span>
								beginFormat);
<span class="nc" id="L308">						beginDate = formater.parse(beginString);</span>
						// Any problem in date handling is handled at the end of
						// the procedure.
<span class="nc" id="L311">					} // then (beginString.length()&gt;0)</span>
					else
					{ // The begin date is mandatory.
<span class="nc" id="L314">						List params = new Vector();</span>
<span class="nc" id="L315">						params.add(beginString);</span>
<span class="nc" id="L316">						throw new XException(Constants.LOCATION_INTERN,</span>
								Constants.LAYER_PROTOCOL,
								Constants.PACKAGE_PROTOCOL_XML, &quot;26&quot;, params);
					} // else (beginString.length()&gt;0)

					// The end date of the interval to comaper against.
					// Or empty if comaprison is done date-to-date.
<span class="nc" id="L323">					String endString = ((Element) node).getAttribute(&quot;EndDate&quot;);</span>
<span class="nc" id="L324">					Date endDate = null;</span>
<span class="nc bnc" id="L325" title="All 2 branches missed.">					if (endString.length() &gt; 0)</span>
					{ // The end date is specified. Get it as date object.
<span class="nc" id="L327">						String endFormat = ((Element) node)</span>
<span class="nc" id="L328">								.getAttribute(&quot;EndFormat&quot;);</span>
<span class="nc" id="L329">						SimpleDateFormat formater = new SimpleDateFormat(</span>
								endFormat);
<span class="nc" id="L331">						endDate = formater.parse(endString);</span>
						// Any problem in date handling is handled at the end of
						// the procedure.
					} // if (endString.length()&gt;0)

					// The date to compare against begin and end date or begin
					// date
					// alone.
					// If the compare date is empty, the current date is used
					// for
					// the comparison.
<span class="nc" id="L342">					String compareString = ((Element) node)</span>
<span class="nc" id="L343">							.getAttribute(&quot;CompareDate&quot;);</span>
<span class="nc" id="L344">					Date compareDate = null;</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">					if (compareString.length() &gt; 0)</span>
					{ // The compare date is specified. Get it as date object.
<span class="nc" id="L347">						String compareFormat = ((Element) node)</span>
<span class="nc" id="L348">								.getAttribute(&quot;CompareFormat&quot;);</span>
<span class="nc" id="L349">						SimpleDateFormat formater = new SimpleDateFormat(</span>
								compareFormat);
<span class="nc" id="L351">						compareDate = formater.parse(compareString);</span>
						// Any problem in date handling is handled at the end of
						// the procedure.
<span class="nc" id="L354">					} // if (compareString.length()&gt;0)</span>
					else
					{ // The compare date was not specified. Use the actual
						// date.
<span class="nc" id="L358">						SimpleDateFormat formater = new SimpleDateFormat(</span>
								&quot;yyyyMMdd&quot;);
<span class="nc" id="L360">						compareDate = formater.parse(formater</span>
<span class="nc" id="L361">								.format(new Date()));</span>
					} // else (compareString.length()&gt;0)

					// First comparison against the begin date.
<span class="nc" id="L365">					int comparison = compareDate.compareTo(beginDate);</span>

<span class="nc bnc" id="L367" title="All 4 branches missed.">					if (comparison &gt; -1 &amp;&amp; endDate != null)</span>
					{ // The compared date lies not before the begin date and
						// there is an end date.
<span class="nc bnc" id="L370" title="All 2 branches missed.">						if (beginDate.compareTo(endDate) == 1)</span>
						{ // Check the begin-end-date interval.
<span class="nc" id="L372">							List params = new Vector();</span>
<span class="nc" id="L373">							params.add(beginString);</span>
<span class="nc" id="L374">							params.add(endString);</span>
<span class="nc" id="L375">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_PROTOCOL,
									Constants.PACKAGE_PROTOCOL_XML, &quot;25&quot;,
									params);
						} // then (beginDate.compareTo(endDate)==1)
						else
						{ // Begin and end date form a sensilbe interval.
							// Compare against the end date.
							// Already sure: the compare date is not before the
							// begin date.
<span class="nc" id="L385">							comparison = compareDate.compareTo(endDate);</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">							if (comparison == -1)</span>
								// Before end date means that it is in the
								// interval.
<span class="nc" id="L389">								comparison = 0;</span>
						} // else (beginDate.compareTo(endDate)==1)
					} // if (comparison&gt;-1 &amp;&amp; endDate!=null)

					// Convert the comparison value into one of the specified
					// keys.
<span class="nc" id="L395">					String value = null;</span>
<span class="nc bnc" id="L396" title="All 4 branches missed.">					switch (comparison)</span>
					{
						case -1 :
<span class="nc" id="L399">							value = ((Element) node)</span>
<span class="nc" id="L400">									.getAttribute(&quot;BeforeValue&quot;);</span>
<span class="nc" id="L401">							break;</span>
						case 0 :
<span class="nc" id="L403">							value = ((Element) node)</span>
<span class="nc" id="L404">									.getAttribute(&quot;StrikeValue&quot;);</span>
<span class="nc" id="L405">							break;</span>
						case 1 :
<span class="nc" id="L407">							value = ((Element) node).getAttribute(&quot;AfterValue&quot;);</span>
							break;
					} // switch (comparison)

					// Insert the value into the DOM tree according to the
					// specified
					// tag name.
<span class="nc" id="L414">					insertValue(tagName, value, parent, node);</span>
<span class="nc" id="L415">				} // if (styletName.equals(&quot;DateComparison&quot;))</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">				else if (styletName.equals(&quot;Max&quot;))</span>
				{ // Calculate the maximum of two integer values.
					// The values are stored in the attributes &quot;Key&quot; and
					// &quot;Value&quot;.
					// This stylet is only needed to combine stylet results
					// after
					// the XSLT transformation.
					// Usual comparison is possible in XSLT directly.
<span class="nc" id="L425">					String keyString = ((Element) node).getAttribute(&quot;Key&quot;);</span>
<span class="nc" id="L426">					int key = Integer.parseInt(keyString);</span>
<span class="nc" id="L427">					String value = ((Element) node).getAttribute(&quot;Value&quot;);</span>
<span class="nc" id="L428">					int val = Integer.parseInt(value);</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">					if (val &lt; key)</span>
<span class="nc" id="L430">						value = keyString;</span>
<span class="nc" id="L431">					insertValue(tagName, value, parent, node);</span>
<span class="nc" id="L432">				} // if (styletName.equals(&quot;Max&quot;))</span>

				else
				{
<span class="nc" id="L436">					List params = new Vector();</span>
<span class="nc" id="L437">					params.add(styletName);</span>
<span class="nc" id="L438">					throw new XException(Constants.LOCATION_INTERN,</span>
							Constants.LAYER_PROTOCOL,
							Constants.PACKAGE_PROTOCOL_XML, &quot;27&quot;, params);
				} // else - name attribute unknown

			} // if (node.getNodeType() != Node.ELEMENT_NODE)
		} // try
<span class="nc" id="L445">		catch (XException e)</span>
		{
<span class="nc" id="L447">			throw e;</span>
		} // catch (XException e)
<span class="nc" id="L449">		catch (Exception e)</span>
		{
<span class="nc" id="L451">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_PROTOCOL, Constants.PACKAGE_PROTOCOL_XML,
					&quot;0&quot;, e);
<span class="nc" id="L454">		} // catch</span>
<span class="nc" id="L455">	} // IteratedStyletApplication(Document xmlNew, Message message)</span>

	/**
	 * &lt;code&gt;insertValue&lt;/code&gt; replaces the stlyet node of a value mapping or
	 * generation within the DOM tree. The new value may be placed
	 * &lt;ul&gt;
	 * &lt;li&gt;into the node where the stylet node was in,&lt;/li&gt;
	 * &lt;li&gt;into a new node labelled &lt;code&gt;tagname&lt;/code&gt;&lt;/li&gt;, which itself
	 * replaces the stylet node,
	 * &lt;li&gt;into a attribute node labelled &lt;code&gt;tagname&lt;/code&gt; if
	 * &lt;code&gt;tagname&lt;/code&gt; starts with '@' and the new attribute is linked to
	 * the node which surrounds the stylet node and the stylet node is deleted.
	 * 
	 * @param tagName tag for a new value node, &lt;code&gt;null&lt;/code&gt; to put the
	 *            value into the node where the stylet node was in, addressing
	 *            an attribute if beginning with '@'
	 * @param value the value to store into the DOM tree
	 * @param parent the node surrounding the stylet node
	 * @param child the stylet node
	 */
	private void insertValue(String tagName, String value, Node parent,
			Node child)
	{
<span class="nc bnc" id="L478" title="All 4 branches missed.">		if (tagName == null || tagName.length() == 0)</span>
		{ // No tag name - insert mapped value as value of &lt;parent&gt;
<span class="nc" id="L480">			Node valueNode = mDoc.createTextNode(value);</span>
<span class="nc" id="L481">			parent.replaceChild(valueNode, child);</span>
<span class="nc" id="L482">		} // then (tagName == null || tagName.length() == 0)</span>
		else
		{ // Tag name given - create new node for mapped value
<span class="nc bnc" id="L485" title="All 2 branches missed.">			if (tagName.charAt(0) == '@')</span>
			{ // Tag name indicates an attribute name.
<span class="nc" id="L487">				((Element) parent).setAttribute(tagName.substring(1), value);</span>
<span class="nc" id="L488">				parent.removeChild(child);</span>
			} // then (tagName.charAt(0)=='@')
			else
			{ // Tag name indicates an elemnet node name.
<span class="nc" id="L492">				Node valueNode = mDoc.createTextNode(value);</span>
<span class="nc" id="L493">				Node newNode = mDoc.createElement(tagName);</span>
<span class="nc" id="L494">				newNode.appendChild(valueNode);</span>
<span class="nc" id="L495">				parent.replaceChild(newNode, child);</span>
			} // else (tagName.charAt(0)=='@')
		} // else (tagName==null || tagName.length()==0)
<span class="nc" id="L498">	} // insertValue(String tagName, String value, Document xmlNew, Node</span>
		// parent, Node child)

} // IteratedStyletApplication
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>