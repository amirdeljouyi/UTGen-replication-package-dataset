<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Configuration.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">83_xbus</a> &gt; <a href="index.source.html" class="el_package">net.sf.xbus.base.core.config</a> &gt; <span class="el_source">Configuration.java</span></div><h1>Configuration.java</h1><pre class="source lang-java linenums">package net.sf.xbus.base.core.config;

import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;
import java.util.TreeSet;
import java.util.Vector;

import net.sf.xbus.base.core.Constants;
import net.sf.xbus.base.core.XException;
import net.sf.xbus.base.core.strings.XStringSupport;

/**
 * This class reads program parameters from different sources and makes them
 * accessible. The entries of the configuration are organized in a three-level
 * hierarchie:
 * &lt;p&gt;
 * &lt;ul&gt;
 * &lt;li&gt;The &lt;b&gt;chapter &lt;/b&gt; is the top level. Often you will find names of
 * components or classes at this level.&lt;/li&gt;
 * &lt;li&gt;Every chapter contains one or more &lt;b&gt;sections &lt;/b&gt;&lt;/li&gt;
 * &lt;li&gt;&lt;b&gt;Keys &lt;/b&gt; are at the bottom of the hierarchie, beyond the sections.
 * &lt;/ul&gt;
 * 
 * The &lt;code&gt;Configuration&lt;/code&gt; implements the &lt;b&gt;Singleton &lt;/b&gt;
 * Design-Pattern.
 * &lt;p&gt;
 * 
 * Up to now, only the Java- &lt;code&gt;Properties&lt;/code&gt; can be used as a source
 * for the configuration. Other sources like XML-files or a database are
 * prepared.
 */
public class Configuration
{
	public static final String STANDARD_CONFIG = &quot;standard&quot;;
	private static final String XBUS_HOME = &quot;$XBUS_HOME$&quot;;

	public static final String VARIABLE_PREFIX = &quot;$VARIABLE_&quot;;
	public static final String VARIABLE_END = &quot;$&quot;;
	public static final String MAPPING_DEFAULT = &quot;Default&quot;;

	// private static Configuration mSingleInstance = null;
<span class="fc" id="L47">	private static Hashtable mInstances = new Hashtable();</span>

<span class="fc" id="L49">	private static final Object classLock = Configuration.class;</span>

<span class="fc" id="L51">	private Hashtable mCache = null;</span>
<span class="fc" id="L52">	private ConfigSource mSource = null;</span>

	/**
	 * The constructor is private. Instances of &lt;code&gt;Configuration&lt;/code&gt; can
	 * only be accessed via the method &lt;code&gt;getInstance()&lt;/code&gt;.
	 * 
	 * @param source the source of the properties.
	 * @exception XException if any error occurs
	 */
	private Configuration(String source)
<span class="fc" id="L62">	{</span>
		/*
		 * Check if XBUS_HOME is set. This is done here, because loading the
		 * configuration will be the first point, where XBUS_HOME is used.
		 */
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">		if (Constants.XBUS_HOME == null)</span>
		{
<span class="fc" id="L69">			System.out.println(&quot;I_00_000_2 XBUS_HOME has not been set!&quot;);</span>
<span class="nc" id="L70">			System.exit(1);</span>
		}

		/*
		 * Initialize the source of the configuration entries.
		 */
<span class="nc" id="L76">		mSource = new PropertiesSource(source);</span>
<span class="nc" id="L77">	} // Configuration(String source)</span>

	/**
	 * Returns an instance of the standard &lt;code&gt;Configuration&lt;/code&gt;.
	 * &lt;p&gt;
	 * The first call creates a new &lt;code&gt;Configuration&lt;/code&gt; and reads all
	 * entries. Following calls will return the object, that has been created by
	 * the first call.
	 * 
	 * @return Configuration - instance of the standard
	 *         &lt;code&gt;Configuration&lt;/code&gt;
	 * @exception XException if any error occurs
	 */
	public static Configuration getInstance() throws XException
	{
<span class="nc" id="L92">		return getInstance(STANDARD_CONFIG);</span>
	} // getInstance()

	/**
	 * Returns a named instance of the &lt;code&gt;Configuration&lt;/code&gt;.
	 * &lt;p&gt;
	 * The first call creates a new &lt;code&gt;Configuration&lt;/code&gt; and reads all
	 * entries. Following calls will return the object, that has been created by
	 * the first call.
	 * 
	 * @param source the source of the properties.
	 * @return Configuration - instance of the standard
	 *         &lt;code&gt;Configuration&lt;/code&gt;
	 * @exception XException if any error occurs
	 */
	public static Configuration getInstance(String source) throws XException
	{
<span class="fc" id="L109">		synchronized (classLock)</span>
		{
<span class="fc" id="L111">			Configuration instance = (Configuration) mInstances.get(source);</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">			if (instance == null)</span>
			{
<span class="nc" id="L114">				instance = new Configuration(source);</span>
<span class="nc" id="L115">				instance.readCache();</span>
<span class="nc" id="L116">				mInstances.put(source, instance);</span>
			} // if (instance == null)
<span class="nc" id="L118">			return instance;</span>
		}
	} // getInstance(String source)

	/**
	 * Creates an updated instance of the standard &lt;code&gt;Configuration&lt;/code&gt;.
	 * 
	 * @exception XException if any error occurs
	 */
	public static void refresh() throws XException
	{
<span class="nc" id="L129">		refresh(STANDARD_CONFIG);</span>
<span class="nc" id="L130">	} // refresh()</span>

	/**
	 * Creates an updated instance of the named &lt;code&gt;Configuration&lt;/code&gt;.
	 * 
	 * @param source the source of the properties
	 * @exception XException if any error occurs
	 */
	public static void refresh(String source) throws XException
	{
<span class="nc" id="L140">		mInstances.remove(source);</span>
<span class="nc" id="L141">        getInstance(source);</span>
<span class="nc" id="L142">	} // refresh(String source)</span>

	/**
	 * Returns the value of an entry. All three parameters have to contain
	 * values.
	 * &lt;p&gt;
	 * If the desired entry can not be found, a &lt;code&gt;XException&lt;/code&gt; is
	 * thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as String for the given chapter, section and key
	 * @exception XException if the entry in configuration is not exist or any
	 *                error occurs
	 */
	public String getValue(String chapter, String section, String key)
			throws XException
	{
<span class="nc" id="L163">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L166">			List params = new Vector();</span>
<span class="nc" id="L167">			params.add(chapter);</span>
<span class="nc" id="L168">			params.add(section);</span>
<span class="nc" id="L169">			params.add(key);</span>
<span class="nc" id="L170">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;1&quot;, params);
		} // if (returnString == null)

<span class="nc" id="L175">		return returnString;</span>
	} // getValue(String chapter, String section, String key)

	/**
	 * Returns the value of an entry as an integer. All three parameters have to
	 * contain values.
	 * &lt;p&gt;
	 * If the desired entry can not be found or the value is not an integer, a
	 * &lt;code&gt;XException&lt;/code&gt; is thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as &lt;i&gt;int &lt;/i&gt; for the given chapter, section and key *
	 * @exception XException if the entry in configuratiuon is not exist or it
	 *                is not an integer
	 */
	public int getValueAsInt(String chapter, String section, String key)
			throws XException
	{
<span class="nc" id="L197">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L200">			List params = new Vector();</span>
<span class="nc" id="L201">			params.add(chapter);</span>
<span class="nc" id="L202">			params.add(section);</span>
<span class="nc" id="L203">			params.add(key);</span>
<span class="nc" id="L204">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;1&quot;, params);
		} // if (returnString == null)

		try
		// for casting to XException
		{
<span class="nc" id="L212">			int retInt = Integer.parseInt(returnString);</span>
<span class="nc" id="L213">			return retInt;</span>
		}
<span class="nc" id="L215">		catch (NumberFormatException e)</span>
		{
<span class="nc" id="L217">			List params = new Vector();</span>
<span class="nc" id="L218">			params.add(chapter);</span>
<span class="nc" id="L219">			params.add(section);</span>
<span class="nc" id="L220">			params.add(key);</span>
<span class="nc" id="L221">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;3&quot;, params);
		} // catch (NumberFormatException e)
	} // getValueAsInt(String chapter, String section, String key)

	/**
	 * Returns the optional value of an entry as an integer. All three
	 * parameters have to contain values.
	 * &lt;p&gt;
	 * If the desired entry is not an integer, a &lt;code&gt;XException&lt;/code&gt; is
	 * thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as &lt;i&gt;int &lt;/i&gt; for the given chapter, section and key &lt;br&gt;
	 *         If the entry in the configuration is not found, &lt;code&gt;0&lt;/code&gt;
	 *         is returned.
	 * @exception XException if the entry is not an integer
	 */
	public int getValueAsIntOptional(String chapter, String section, String key)
			throws XException
	{
<span class="nc" id="L247">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L248" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L250">			return 0;</span>
		} // if (returnString == null)

		try
		{
<span class="nc" id="L255">			int retInt = Integer.parseInt(returnString);</span>
<span class="nc" id="L256">			return retInt;</span>
		}
<span class="nc" id="L258">		catch (NumberFormatException e)</span>
		{
<span class="nc" id="L260">			List params = new Vector();</span>
<span class="nc" id="L261">			params.add(chapter);</span>
<span class="nc" id="L262">			params.add(section);</span>
<span class="nc" id="L263">			params.add(key);</span>
<span class="nc" id="L264">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;3&quot;, params);
		} // catch (NumberFormatException e)
	} // getValueAsIntOptional(String chapter, String section, String key)

	/**
	 * Returns the optional value of an entry as an long value. All three
	 * parameters have to contain values.
	 * &lt;p&gt;
	 * If the desired entry is not an long value, a &lt;code&gt;XException&lt;/code&gt; is
	 * thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as &lt;i&gt;int &lt;/i&gt; for the given chapter, section and key &lt;br&gt;
	 *         If the entry in the configuration is not found, &lt;code&gt;0&lt;/code&gt;
	 *         is returned.
	 * @exception XException if the entry is not an integer
	 */
	public long getValueAsLongOptional(String chapter, String section,
			String key) throws XException
	{
<span class="nc" id="L290">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L293">			return 0;</span>
		} // if (returnString == null)

		try
		{
<span class="nc" id="L298">			long retLong = Long.parseLong(returnString);</span>
<span class="nc" id="L299">			return retLong;</span>
		}
<span class="nc" id="L301">		catch (NumberFormatException e)</span>
		{
<span class="nc" id="L303">			List params = new Vector();</span>
<span class="nc" id="L304">			params.add(chapter);</span>
<span class="nc" id="L305">			params.add(section);</span>
<span class="nc" id="L306">			params.add(key);</span>
<span class="nc" id="L307">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;5&quot;, params);
		} // catch (NumberFormatException e)
	} // getValueAsLongOptional(String chapter, String section, String key)

	/**
	 * Returns the value of an entry as a boolean. All three parameters have to
	 * contain values.
	 * &lt;p&gt;
	 * If the desired entry can not be found or the value is not a boolean, a
	 * &lt;code&gt;XException&lt;/code&gt; is thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as &lt;i&gt;boolean &lt;/i&gt; for the given chapter, section and key
	 * @exception XException if the entry in the configuration is not exist or
	 *                it is not a boolean value
	 */
	public boolean getValueAsBoolean(String chapter, String section, String key)
			throws XException
	{
<span class="nc" id="L332">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L335">			List params = new Vector();</span>
<span class="nc" id="L336">			params.add(chapter);</span>
<span class="nc" id="L337">			params.add(section);</span>
<span class="nc" id="L338">			params.add(key);</span>
<span class="nc" id="L339">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;1&quot;, params);
		}

<span class="nc bnc" id="L344" title="All 2 branches missed.">		if (Constants.CONFIGURATION_TRUE.toUpperCase().equals(</span>
<span class="nc" id="L345">				returnString.toUpperCase()))</span>
		{
<span class="nc" id="L347">			return true;</span>
		} // then
		// (Constants.CONFIGURATION_TRUE.toUpperCase().equals(returnString.toUpperCase()))
<span class="nc bnc" id="L350" title="All 2 branches missed.">		else if (Constants.CONFIGURATION_FALSE.toUpperCase().equals(</span>
<span class="nc" id="L351">				returnString.toUpperCase()))</span>
		{
<span class="nc" id="L353">			return false;</span>
		} // else then
		// (Constants.CONFIGURATION_FALSE.toUpperCase().equals(returnString.toUpperCase()))
		else
		{
<span class="nc" id="L358">			List params = new Vector();</span>
<span class="nc" id="L359">			params.add(chapter);</span>
<span class="nc" id="L360">			params.add(section);</span>
<span class="nc" id="L361">			params.add(key);</span>
<span class="nc" id="L362">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;7&quot;, params);
		} // else
		// (Constants.CONFIGURATION_FALSE.toUpperCase().equals(returnString.toUpperCase()))
	} // getValueAsBoolean(String chapter,String section,String key)

	/**
	 * Returns the optional value of an entry as a boolean. All three parameters
	 * have to contain values.
	 * &lt;p&gt;
	 * If the desired entry can not be found, false is returned. If the value is
	 * not a boolean, a &lt;code&gt;XException&lt;/code&gt; is thrown.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as boolean for the given chapter, section and key. &lt;br&gt;
	 *         If the entry in the configuration is not found, false is
	 *         returned.
	 * @exception XException if the entry is not a boolean value or any error
	 *                occurs
	 */
	public boolean getValueAsBooleanOptional(String chapter, String section,
			String key) throws XException
	{
<span class="nc" id="L390">		String returnString = getValueInternal(chapter, section, key);</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">		if (returnString == null)</span>
		{
<span class="nc" id="L393">			return false;</span>
		}

<span class="nc bnc" id="L396" title="All 2 branches missed.">		if (Constants.CONFIGURATION_TRUE.toUpperCase().equals(</span>
<span class="nc" id="L397">				returnString.toUpperCase()))</span>
		{
<span class="nc" id="L399">			return true;</span>
		} // then
		// (Constants.CONFIGURATION_TRUE.toUpperCase().equals(returnString.toUpperCase()))
<span class="nc bnc" id="L402" title="All 2 branches missed.">		else if (Constants.CONFIGURATION_FALSE.toUpperCase().equals(</span>
<span class="nc" id="L403">				returnString.toUpperCase()))</span>
		{
<span class="nc" id="L405">			return false;</span>
		} // else then
		// (Constants.CONFIGURATION_FALSE.toUpperCase().equals(returnString.toUpperCase()))
		else
		{
<span class="nc" id="L410">			List params = new Vector();</span>
<span class="nc" id="L411">			params.add(chapter);</span>
<span class="nc" id="L412">			params.add(section);</span>
<span class="nc" id="L413">			params.add(key);</span>
<span class="nc" id="L414">			throw new XException(Constants.LOCATION_INTERN,</span>
					Constants.LAYER_COREBASE,
					Constants.PACKAGE_COREBASE_COREBASE, &quot;7&quot;, params);
		} // else
		// (Constants.CONFIGURATION_FALSE.toUpperCase().equals(returnString.toUpperCase()))
	} // getValueAsBooleanOptional(String chapter,String section,String key)

	/**
	 * Returns the value of an entry. All three parameters have to contain
	 * values.
	 * &lt;p&gt;
	 * If the desired entry is not in the configuration, &lt;code&gt;null&lt;/code&gt;
	 * will be returned.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as string for the given chapter,section and key or null if
	 *         the desired value is not found in the configuration
	 */
	public String getValueOptional(String chapter, String section, String key)
	{
<span class="nc" id="L438">		return getValueInternal(chapter, section, key);</span>
	} // getValueOptional(String chapter, String section, String key)

	/**
	 * Returns a list of all chapters.
	 * 
	 * @return List with chapters
	 * @exception XException if any error occurs
	 */
	public List getChapters()
	{
<span class="nc" id="L449">		TreeSet chapters = new TreeSet(mCache.keySet());</span>
<span class="nc" id="L450">		return new Vector(chapters);</span>
	} // getChapters()

	/**
	 * Returns a list of all sections for the given chapter
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @return List of all sections for the given chapter or null wenn no
	 *         sections are found
	 * @exception XException if any error occurs
	 */
	public List getSections(String chapter)
	{
<span class="nc" id="L463">		Hashtable sections = (Hashtable) mCache.get(chapter);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">		if (sections == null)</span>
		{
<span class="nc" id="L466">			return null;</span>
		} // if (sections == null)

<span class="nc" id="L469">		TreeSet sectionSet = new TreeSet(sections.keySet());</span>
<span class="nc" id="L470">		return new Vector(sectionSet);</span>
	} // getSections(String chapter)

	/**
	 * Returns a map of all keys and their values for the given chapter and
	 * section.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @return Map of all keys and their values for the given chapter and
	 *         section or &lt;i&gt;null &lt;/i&gt; wenn no keys are found
	 * @exception XException if any error occurs
	 */
	public Map getKeysAndValues(String chapter, String section)
	{
<span class="nc" id="L486">		Hashtable sections = (Hashtable) mCache.get(chapter);</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">		if (sections == null)</span>
		{
<span class="nc" id="L489">			return null;</span>
		} // if (sections == null)

<span class="nc" id="L492">		Hashtable keys = (Hashtable) sections.get(section);</span>

<span class="nc bnc" id="L494" title="All 2 branches missed.">		if (keys != null)</span>
		{
<span class="nc" id="L496">			return new TreeMap(keys);</span>
		}
		else
		{
<span class="nc" id="L500">			return null;</span>
		}
	} // getKeysAndValues(String chapter, String section)

	/**
	 * Returns a value for the given chapter, section and key.
	 * 
	 * @param chapter The first level from the three-level hierarchie hashtable
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to this chapter
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to these chapter and section
	 * @return Value as String for the given chapter, section and key
	 * @exception XException if any error occurs
	 */
	private String getValueInternal(String chapter, String section, String key)
	{
<span class="nc" id="L517">		Hashtable sectTable = (Hashtable) mCache.get(chapter);</span>
<span class="nc bnc" id="L518" title="All 2 branches missed.">		if (sectTable == null)</span>
		{
<span class="nc" id="L520">			return null;</span>
		} // if (sectTable == null)

<span class="nc" id="L523">		Hashtable keyTable = (Hashtable) sectTable.get(section);</span>
<span class="nc bnc" id="L524" title="All 2 branches missed.">		if (keyTable == null)</span>
		{
<span class="nc" id="L526">			return null;</span>
		} // if (keyTable == null)

<span class="nc" id="L529">		return (String) keyTable.get(key);</span>
	} // getValueInternal(String chapter, String section, String key)

	/**
	 * This method is used by {@link #getInstance()}and by
	 * {@link #getInstance(String)}for reading all entries from a source and
	 * filling a three-level hierarchie hashtable.
	 * 
	 * @see net.sf.xbus.base.core.config.PropertiesSource#readCache()
	 * @exception XException if any error occurs
	 */
	private void readCache() throws XException
	{
<span class="nc" id="L542">		mCache = mSource.readCache();</span>
<span class="nc" id="L543">		replaceVariables(mCache);</span>
<span class="nc" id="L544">	} // readCache()</span>

	/**
	 * Replaces XBUS_HOME and variables with the key
	 * &lt;code&gt;Base_Variable_xxx&lt;/code&gt; in all entries of the current
	 * configuration.
	 */
	private void replaceVariables(Hashtable cache) throws XException
	{
<span class="nc" id="L553">		Map variables = getVariables(cache);</span>

<span class="nc" id="L555">		for (Enumeration chapters = cache.elements(); chapters</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">				.hasMoreElements();)</span>
		{
<span class="nc" id="L558">			Hashtable chapter = (Hashtable) chapters.nextElement();</span>
<span class="nc" id="L559">			for (Enumeration sections = chapter.elements(); sections</span>
<span class="nc bnc" id="L560" title="All 2 branches missed.">					.hasMoreElements();)</span>
			{
<span class="nc" id="L562">				Hashtable section = (Hashtable) sections.nextElement();</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">				for (Enumeration keys = section.keys(); keys.hasMoreElements();)</span>
				{
<span class="nc" id="L565">					String key = (String) keys.nextElement();</span>
<span class="nc" id="L566">					String value = (String) section.get(key);</span>

					/*
					 * Replace further variables
					 */
<span class="nc" id="L571">					int variablePosNew = value.indexOf(VARIABLE_PREFIX);</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">					if (variablePosNew &gt;= 0)</span>
					{
<span class="nc" id="L574">						int variablePosOld = -99999;</span>
<span class="nc" id="L575">						String variable = null;</span>
<span class="nc" id="L576">						Set variablesKeySet = null;</span>
<span class="nc bnc" id="L577" title="All 4 branches missed.">						while ((variablePosNew &gt;= 0)</span>
								&amp;&amp; (variablePosOld != variablePosNew))
						{
<span class="nc" id="L580">							variablePosOld = variablePosNew;</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">							if (variables == null)</span>
							{
<span class="nc" id="L583">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_BASE,
										Constants.PACKAGE_BASE_XBUSSYSTEM, &quot;4&quot;);
							}
<span class="nc" id="L587">							variablesKeySet = variables.keySet();</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">							if (variablesKeySet == null)</span>
							{
<span class="nc" id="L590">								throw new XException(Constants.LOCATION_INTERN,</span>
										Constants.LAYER_BASE,
										Constants.PACKAGE_BASE_XBUSSYSTEM, &quot;4&quot;);
							}
<span class="nc" id="L594">							String variablesKey = null;</span>
<span class="nc" id="L595">							for (Iterator it = variablesKeySet.iterator(); it</span>
<span class="nc bnc" id="L596" title="All 2 branches missed.">									.hasNext();)</span>
							{
<span class="nc" id="L598">								variablesKey = (String) it.next();</span>
<span class="nc" id="L599">								variable = (String) variables.get(variablesKey);</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">								if (value.indexOf(variablesKey) &gt;= 0)</span>
								{
<span class="nc" id="L602">									value = XStringSupport.replaceAll(value,</span>
											variablesKey, variable);
								}
							}
<span class="nc" id="L606">							variablePosNew = value.indexOf(VARIABLE_PREFIX);</span>
<span class="nc" id="L607">						}</span>
<span class="nc bnc" id="L608" title="All 2 branches missed.">						if (variablePosOld == variablePosNew)</span>
						{
							/*
							 * Found same variable again =&gt; variable cannot be
							 * replaced
							 */
<span class="nc" id="L614">							List params = new Vector();</span>
<span class="nc" id="L615">							params.add(new Integer(variablePosOld));</span>
<span class="nc" id="L616">							params.add(value);</span>
<span class="nc" id="L617">							throw new XException(Constants.LOCATION_INTERN,</span>
									Constants.LAYER_BASE,
									Constants.PACKAGE_BASE_XBUSSYSTEM, &quot;3&quot;,
									params);
						}
					}

					/*
					 * Replace XBUS_HOME
					 */
<span class="nc bnc" id="L627" title="All 2 branches missed.">					if (value.indexOf(XBUS_HOME) &gt;= 0)</span>
					{
<span class="nc" id="L629">						value = XStringSupport.replaceAll(value, XBUS_HOME,</span>
								Constants.XBUS_HOME);
					}

<span class="nc" id="L633">					section.put(key, value);</span>
<span class="nc" id="L634">				}</span>
<span class="nc" id="L635">			}</span>
<span class="nc" id="L636">		}</span>

<span class="nc" id="L638">	}</span>

	private Map getVariables(Hashtable cache)
	{
<span class="nc" id="L642">		Hashtable sections = (Hashtable) cache.get(Constants.CHAPTER_BASE);</span>

<span class="nc" id="L644">		Map variablesConf = null;</span>
<span class="nc bnc" id="L645" title="All 2 branches missed.">		if (sections == null)</span>
		{
<span class="nc" id="L647">			return null;</span>
		} // if (sections == null)

<span class="nc" id="L650">		Hashtable keys = (Hashtable) sections.get(&quot;Variable&quot;);</span>

<span class="nc bnc" id="L652" title="All 2 branches missed.">		if (keys != null)</span>
		{
<span class="nc" id="L654">			variablesConf = new TreeMap(keys);</span>
		}
		else
		{
<span class="nc" id="L658">			return null;</span>
		}

<span class="nc" id="L661">		Map variablesNew = new Hashtable();</span>

<span class="nc bnc" id="L663" title="All 2 branches missed.">		if (variablesConf != null)</span>
		{
<span class="nc" id="L665">			String key = null;</span>
<span class="nc" id="L666">			String variable = null;</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">			for (Iterator it = variablesConf.keySet().iterator(); it.hasNext();)</span>
			{
<span class="nc" id="L669">				key = (String) it.next();</span>
<span class="nc" id="L670">				variable = (String) variablesConf.get(key);</span>
<span class="nc" id="L671">				key = new StringBuffer(VARIABLE_PREFIX).append(key).append(</span>
<span class="nc" id="L672">						VARIABLE_END).toString();</span>
<span class="nc" id="L673">				variablesNew.put(key, variable);</span>
			}
		}

<span class="nc" id="L677">		return variablesNew;</span>
	}
	/**
	 * Returns an entry of the class table.
	 * 
	 * @see #getValue(String, String, String)
	 * @param type The second level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Class &lt;/i&gt; &lt;/b&gt;
	 * @param name The bottom level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Class &lt;/i&gt; &lt;/b&gt; and this
	 *            section
	 * @return Value as String for the given type and name
	 * @exception XException if the entry is not found or any error occurs
	 */
	public static String getClass(String type, String name) throws XException
	{
<span class="nc" id="L693">		return Configuration.getInstance(&quot;xbus&quot;).getValue(&quot;Class&quot;, type, name);</span>
	} // getClass(String type, String name)

	/**
	 * Returns an entry of the mapping table.
	 * 
	 * @see #getValue(String, String, String)
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Mapping &lt;/i&gt; &lt;/b&gt;
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Mapping &lt;/i&gt; &lt;/b&gt; and this
	 *            section
	 * @return Value for the given section and key
	 * @exception XException if the entry is not found or any error occurs
	 */
	public static String getMapping(String section, String key)
			throws XException
	{
<span class="nc" id="L711">		return Configuration.getInstance(&quot;mapping&quot;).getValue(&quot;Mapping&quot;,</span>
				section, key);
	} // getMapping(String section, String key)

	/**
	 * Returns an entry of the mapping table or &lt;code&gt;null&lt;/code&gt; if it
	 * doesn't exist.
	 * 
	 * @param section The second level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Mapping &lt;/i&gt; &lt;/b&gt;
	 * @param key The bottom level from the three-level hierarchie hashtable
	 *            that belongs to the chapter: &lt;b&gt;&lt;i&gt;Mapping &lt;/i&gt; &lt;/b&gt; and this
	 *            section
	 * @return value for the given section and key
	 * @exception XException if the entry is not found or any error occurs
	 */
	public static String getMappingOptional(String section, String key)
			throws XException
	{
<span class="nc" id="L730">		return Configuration.getInstance(&quot;mapping&quot;).getValueOptional(&quot;Mapping&quot;,</span>
				section, key);
	}

	/**
	 * @param section
	 */
	public static String getMappingDefault(String section) throws XException
	{
<span class="nc" id="L739">		return getMapping(section, Configuration.MAPPING_DEFAULT);</span>
	} // getMapping(String section, String key)

} // Configuration
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>