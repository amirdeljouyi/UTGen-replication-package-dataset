<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CategoryMembersFull.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">23_jwbf</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.jwbf.mediawiki.actions.queries</a> &gt; <span class="el_source">CategoryMembersFull.java</span></div><h1>CategoryMembersFull.java</h1><pre class="source lang-java linenums">package net.sourceforge.jwbf.mediawiki.actions.queries;

import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_11;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_12;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_13;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_14;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_15;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_16;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;

import lombok.extern.slf4j.Slf4j;
import net.sourceforge.jwbf.core.actions.Get;
import net.sourceforge.jwbf.core.actions.util.ActionException;
import net.sourceforge.jwbf.core.actions.util.HttpAction;
import net.sourceforge.jwbf.core.actions.util.ProcessException;
import net.sourceforge.jwbf.core.bots.util.JwbfException;
import net.sourceforge.jwbf.mediawiki.actions.util.SupportedBy;
import net.sourceforge.jwbf.mediawiki.bots.MediaWikiBot;
import net.sourceforge.jwbf.mediawiki.contentRep.CategoryItem;

/**
 * A specialization of {@link CategoryMembers} with contains
 * {@link CategoryItem}s.
 * 
 * @author Thomas Stock
 */
<span class="nc" id="L30">@Slf4j</span>
@SupportedBy({ MW1_11, MW1_12, MW1_13, MW1_14, MW1_15, MW1_16 })
public class CategoryMembersFull extends CategoryMembers implements
    Iterable&lt;CategoryItem&gt;, Iterator&lt;CategoryItem&gt; {

  private Get msg;
  /**
   * Collection that will contain the result (titles of articles linking to the
   * target) after performing the action has finished.
   */
<span class="nc" id="L40">  private Collection&lt;CategoryItem&gt; titleCollection = new ArrayList&lt;CategoryItem&gt;();</span>
  private Iterator&lt;CategoryItem&gt; titleIterator;

  /**
   * 
   * @throws ActionException
   *           on any kind of http or version problems
   * @throws ProcessException
   *           on inner problems like a version mismatch
   */
  public CategoryMembersFull(MediaWikiBot bot, String categoryName,
      int... namespaces) throws ProcessException {
<span class="nc" id="L52">    super(bot, categoryName, namespaces);</span>
<span class="nc" id="L53">  }</span>

  /**
   * {@inheritDoc}
   */
  @Override
  protected void addCatItem(String title, int pageid, int ns) {
<span class="nc" id="L60">    CategoryItem ci = new CategoryItem();</span>
<span class="nc" id="L61">    ci.setTitle(title);</span>
<span class="nc" id="L62">    ci.setPageid(pageid);</span>
<span class="nc" id="L63">    ci.setNamespace(ns);</span>
<span class="nc" id="L64">    titleCollection.add(ci);</span>

<span class="nc" id="L66">  }</span>

  /**
   * {@inheritDoc}
   */
  public HttpAction getNextMessage() {
<span class="nc" id="L72">    return msg;</span>
  }

  /**
   * {@inheritDoc}
   */
  public Iterator&lt;CategoryItem&gt; iterator() {
<span class="nc" id="L79">    return this;</span>
  }

  /**
   * {@inheritDoc}
   */
  @Override
  protected Object clone() throws CloneNotSupportedException {
    try {
<span class="nc" id="L88">      return new CategoryMembersFull(bot, categoryName, namespace);</span>
<span class="nc" id="L89">    } catch (JwbfException e) {</span>
<span class="nc" id="L90">      throw new CloneNotSupportedException(e.getLocalizedMessage());</span>
    }
  }

  private void prepareCollection() {

<span class="nc bnc" id="L96" title="All 6 branches missed.">    if (init || (!titleIterator.hasNext() &amp;&amp; hasMoreResults)) {</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">      if (init) {</span>
<span class="nc" id="L98">        msg = generateFirstRequest();</span>
      } else {
<span class="nc" id="L100">        msg = generateContinueRequest(nextPageInfo);</span>
      }
<span class="nc" id="L102">      init = false;</span>
      try {

<span class="nc" id="L105">        bot.performAction(this);</span>
<span class="nc" id="L106">        setHasMoreMessages(true);</span>
<span class="nc" id="L107">        log.debug(&quot;preparing success&quot;);</span>
<span class="nc" id="L108">      } catch (ActionException e) {</span>
<span class="nc" id="L109">        e.printStackTrace();</span>
<span class="nc" id="L110">        setHasMoreMessages(false);</span>
<span class="nc" id="L111">      } catch (ProcessException e) {</span>
<span class="nc" id="L112">        e.printStackTrace();</span>
<span class="nc" id="L113">        setHasMoreMessages(false);</span>
<span class="nc" id="L114">      }</span>

    }
<span class="nc" id="L117">  }</span>

  /**
   * {@inheritDoc}
   */
  @Override
  public String processAllReturningText(String s) throws ProcessException {
<span class="nc" id="L124">    titleCollection.clear();</span>
<span class="nc" id="L125">    String buff = super.processAllReturningText(s);</span>

<span class="nc bnc" id="L127" title="All 2 branches missed.">    if (log.isDebugEnabled())</span>
<span class="nc" id="L128">      log.debug(titleCollection.toString());</span>
<span class="nc" id="L129">    return buff;</span>
  }

  /**
   * {@inheritDoc}
   */
  public boolean hasNext() {
<span class="nc" id="L136">    prepareCollection();</span>
<span class="nc" id="L137">    return titleIterator.hasNext();</span>
  }

  /**
   * {@inheritDoc}
   */
  public CategoryItem next() {
<span class="nc" id="L144">    prepareCollection();</span>
<span class="nc" id="L145">    return titleIterator.next();</span>
  }

  /**
   * {@inheritDoc}
   */
  public void remove() {
<span class="nc" id="L152">    titleIterator.remove();</span>

<span class="nc" id="L154">  }</span>

  @Override
  protected void finalizeParse() {
<span class="nc" id="L158">    titleIterator = titleCollection.iterator();</span>

<span class="nc" id="L160">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>