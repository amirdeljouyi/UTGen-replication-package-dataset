<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Siteinfo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">23_jwbf</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.jwbf.mediawiki.actions.meta</a> &gt; <span class="el_source">Siteinfo.java</span></div><h1>Siteinfo.java</h1><pre class="source lang-java linenums">package net.sourceforge.jwbf.mediawiki.actions.meta;

import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_11;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_12;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_13;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_14;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_15;
import static net.sourceforge.jwbf.mediawiki.actions.MediaWiki.Version.MW1_16;

import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

import net.sourceforge.jwbf.core.actions.Get;
import net.sourceforge.jwbf.core.actions.util.HttpAction;
import net.sourceforge.jwbf.mediawiki.actions.MediaWiki;
import net.sourceforge.jwbf.mediawiki.actions.util.SupportedBy;

import org.jdom.Element;
/**
 * Gets details from the given MediaWiki installation like installed version.
 * @author Thomas Stock
 * @see Siteinfo
 *
 */
@SupportedBy({ MW1_11, MW1_12, MW1_13, MW1_14, MW1_15, MW1_16 })
public class Siteinfo extends GetVersion {


  private Get msg;
<span class="nc" id="L33">  private Map&lt;Integer, String&gt; namespaces = new HashMap&lt;Integer, String&gt;();</span>
<span class="nc" id="L34">  private Map&lt;String, String&gt; interwiki = new HashMap&lt;String, String&gt;();</span>

  public static final String GENERAL = &quot;general&quot;;
  public static final String NAMESPACES = &quot;namespaces&quot;; // : A list of all namespaces
  //	# namespacealiases: A list of all namespace aliases
  //	# specialpagealiases: A list of all special page aliases
  //	# magicwords: A list of magic words and their aliases
  //	# statistics: Site statistics Ã  la Special:Statistics
  /**
   * @since {@link Version#MW1_11}
   */
  public static final String INTERWIKIMAP = &quot;interwikimap&quot;; // : A list of all interwiki prefixes and where they go
  //	# dbrepllag: Get information about the database server with the highest replication lag
  //	# usergroups: A list of all user groups and their permissions
  //	# extensions: A list of extensions installed on the wiki
  //	# fileextensions: A list of file extensions allowed to be uploaded
  //	# rightsinfo: Get information about the license governing the wiki's content
  /**
   *
   * inits with parameters {@link #GENERAL}, {@link #NAMESPACES}, {@link #INTERWIKIMAP}.
   */
  public Siteinfo() {
<span class="nc" id="L56">    this(GENERAL, NAMESPACES, INTERWIKIMAP);</span>
<span class="nc" id="L57">  }</span>
  /**
   *
   * @param types the, see {@link #GENERAL}, {@link #INTERWIKIMAP}, ...
   */
<span class="nc" id="L62">  public Siteinfo(String... types) {</span>
<span class="nc" id="L63">    StringBuffer x = new StringBuffer();</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">    for (int i = 0; i &lt; types.length; i++) {</span>
<span class="nc" id="L65">      x.append(types[i] + &quot;|&quot;);</span>
    }
<span class="nc" id="L67">    String result = x.substring(0, x.length() - 1);</span>
<span class="nc" id="L68">    msg = new Get(&quot;/api.php?action=query&amp;meta=siteinfo&quot; + &quot;&amp;siprop=&quot;</span>
<span class="nc" id="L69">        + MediaWiki.encode(result) + &quot;&amp;format=xml&quot;);</span>
<span class="nc" id="L70">  }</span>
  /**
   * {@inheritDoc}
   */
  @Override
  public HttpAction getNextMessage() {
<span class="nc" id="L76">    return msg;</span>
  }

  @Override
  @SuppressWarnings(&quot;unchecked&quot;)
  protected void findContent(final Element root) {
<span class="nc" id="L82">    super.findContent(root);</span>
<span class="nc" id="L83">    Iterator&lt;Element&gt; el = root.getChildren().iterator();</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">    while (el.hasNext()) {</span>
<span class="nc" id="L85">      Element element = el.next();</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">      if (element.getQualifiedName().equalsIgnoreCase(&quot;ns&quot;)) {</span>
<span class="nc" id="L87">        Integer id = Integer.parseInt(element.getAttributeValue(&quot;id&quot;));</span>
<span class="nc" id="L88">        String name = element.getText();</span>
<span class="nc" id="L89">        addNamespace(id, name);</span>

<span class="nc bnc" id="L91" title="All 2 branches missed.">      } else if (element.getQualifiedName().equalsIgnoreCase(&quot;iw&quot;)) {</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (element.getAttribute(&quot;prefix&quot;) != null) {</span>
<span class="nc" id="L93">          String prefix = element</span>
<span class="nc" id="L94">          .getAttributeValue(&quot;prefix&quot;);</span>
<span class="nc" id="L95">          String name = element.getAttributeValue(&quot;url&quot;);</span>
<span class="nc" id="L96">          addInterwiki(prefix, name);</span>
<span class="nc" id="L97">        }</span>
      } else {
<span class="nc" id="L99">        findContent(element);</span>
      }
<span class="nc" id="L101">    }</span>
<span class="nc" id="L102">  }</span>






  private void addNamespace(Integer id, String name) {
<span class="nc" id="L110">    namespaces.put(id, name);</span>

<span class="nc" id="L112">  }</span>
  /**
   *
   * @return of
   */
  public Map&lt;Integer, String&gt; getNamespaces() {
<span class="nc" id="L118">    return Collections.unmodifiableMap(namespaces);</span>
  }


  /**
   *
   * @return of
   */
  public int [] getNamespacesArray() {
<span class="nc" id="L127">    Set&lt;Integer&gt; ks = getNamespaces().keySet();</span>
<span class="nc" id="L128">    int [] x = new int [ks.size()];</span>
<span class="nc" id="L129">    int i = 0;</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">    for (int value : ks) {</span>
<span class="nc" id="L131">      x[i++] = value;</span>
<span class="nc" id="L132">    }</span>
<span class="nc" id="L133">    return x;</span>
  }

  private void addInterwiki(String prefix, String name) {
<span class="nc" id="L137">    interwiki.put(prefix, name);</span>
<span class="nc" id="L138">  }</span>
  /**
   *
   * @return of
   */
  public Map&lt;String, String&gt; getInterwikis() {
<span class="nc" id="L144">    return Collections.unmodifiableMap(interwiki);</span>
  }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>