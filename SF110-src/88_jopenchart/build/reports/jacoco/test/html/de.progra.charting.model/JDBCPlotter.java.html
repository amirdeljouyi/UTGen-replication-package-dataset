<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JDBCPlotter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">88_jopenchart</a> &gt; <a href="index.source.html" class="el_package">de.progra.charting.model</a> &gt; <span class="el_source">JDBCPlotter.java</span></div><h1>JDBCPlotter.java</h1><pre class="source lang-java linenums">/*
 JOpenChart Java Charting Library and Toolkit
 Copyright (C) 2001  Sebastian Mï¿½ller
 http://jopenchart.sourceforge.net

 This library is free software; you can redistribute it and/or
 modify it under the terms of the GNU Lesser General Public
 License as published by the Free Software Foundation; either
 version 2.1 of the License, or (at your option) any later version.

 This library is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 Lesser General Public License for more details.

 You should have received a copy of the GNU Lesser General Public
 License along with this library; if not, write to the Free Software
 Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

 JDBCPlotter.java
 Created on 9. October 2002
 Based on SQLPlotter.java, created on 29. December 2001
 
 */

package de.progra.charting.model;

import java.sql.*;
import java.util.ArrayList;


/**
 * The class is used to convert database queries into ChartDataModels.
 * You can initialize the Plotter with database parameters and afterwards
 * you can run consecutive queries resulting in a new database.
 */
public class JDBCPlotter {

    /** The SQL connection. */
    protected Connection conn;

    /**
     * Creates a new JDBCPlotter using the given driver and URL.
     * @param jdbcDriver the fully qualified classname of the SQL driver class.
     * @param jdbcURL the URL of the JDBC database to connect to.
     * @param username the username for the JDBC resource
     * @param password the user's password
     */
    public JDBCPlotter(String jdbcDriver, String jdbcURL, String username, String password) 
<span class="nc" id="L50">            throws JDBCPlotterException {</span>
        try {
<span class="nc" id="L52">            Class.forName( jdbcDriver);</span>
<span class="nc" id="L53">            conn = DriverManager.getConnection(jdbcURL, username, password);</span>
<span class="nc" id="L54">        } catch(Exception e) {</span>
<span class="nc" id="L55">            throw new JDBCPlotterException(&quot;Exception while creating a database connection.&quot;, e);</span>
<span class="nc" id="L56">        }</span>
<span class="nc" id="L57">    }</span>

    /** 
     * Given a SQL query and the row titles this method creates a DefaultChartDataModel.
     * The columns are initialized with values starting from 0.
     * @param sqlQuery the SQL query to be performed
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel and which
     * will be used as the DataSet titles.
     */
    public DefaultChartDataModel createChartDataModelInstance(String sqlQuery, String[] sqlRows) 
            throws JDBCPlotterException {
<span class="nc" id="L68">        return createChartDataModelInstance(sqlQuery, sqlRows, sqlRows);</span>
    }
    
    /** 
     * Given a SQL query and the row titles this method creates a DefaultChartDataModel.
     * The columns are initialized with values starting from 0.
     * @param sqlQuery the SQL query to be performed
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel
     * @param dataSets the DataSet titles which should be given to the ChartDataModel instead of the sqlRows titles
     */
    public DefaultChartDataModel createChartDataModelInstance(String sqlQuery, String[] sqlRows, String[] dataSets) 
            throws JDBCPlotterException {
        try {
<span class="nc" id="L81">            Statement stmt = conn.createStatement();</span>
<span class="nc" id="L82">            ResultSet sqlResult = stmt.executeQuery(sqlQuery);</span>

<span class="nc" id="L84">            ArrayList model[]   = new ArrayList[sqlRows.length];</span>
<span class="nc" id="L85">            ArrayList columnList = new ArrayList();</span>

<span class="nc bnc" id="L87" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++) {</span>
<span class="nc" id="L88">                model[i]=new ArrayList(); </span>
            }

<span class="nc" id="L91">            double x = 0.0;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            while(sqlResult.next()) {</span>

<span class="nc" id="L94">                columnList.add(new Double(x));</span>
<span class="nc" id="L95">                x += 1.0;</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">                for(int i = 0; i &lt; sqlRows.length; i++) {</span>
<span class="nc" id="L98">                    model[i].add(new Double(sqlResult.getDouble(sqlRows[i])));</span>

                }
            }

<span class="nc" id="L103">            Number[][] modelArray = new Number[model.length][];</span>
            
<span class="nc bnc" id="L105" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++)</span>
<span class="nc" id="L106">                modelArray[i] = (Number[])model[i].toArray(new Number[0]);</span>
            
<span class="nc" id="L108">            double[] columns = new double[columnList.size()];</span>
            
<span class="nc bnc" id="L110" title="All 2 branches missed.">            for(int i = 0; i &lt; columns.length; i++)</span>
<span class="nc" id="L111">                columns[i] = ((Double)columnList.get(i)).doubleValue();</span>
            
<span class="nc" id="L113">            return new DefaultChartDataModel(modelArray, columns, dataSets);</span>
            
<span class="nc" id="L115">        } catch( Exception e ) {</span>
<span class="nc" id="L116">            throw new JDBCPlotterException(&quot;Exception while performing task.&quot;, e);</span>
        }
    }

    /** 
     * Given a SQL query and the row titles this method creates a DefaultChartDataModel.
     * The columns are initialized with values from columnRow.
     * @param sqlQuery the SQL query to be performed
     * @param columnRow the row from the ResultSet which should be taken as the column (x-axis) values
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel and which
     * will be used as the DataSet titles.
     */
    public DefaultChartDataModel createChartDataModelInstance(String sqlQuery, String columnRow, String[] sqlRows) 
            throws JDBCPlotterException {
<span class="nc" id="L130">        return createChartDataModelInstance(sqlQuery, columnRow, sqlRows, sqlRows);</span>
    }
    
    /** 
     * Given a SQL query and the row titles this method creates a DefaultChartDataModel.
     * The columns are initialized with values from columnRow.
     * @param sqlQuery the SQL query to be performed
     * @param columnRow the row from the ResultSet which should be taken as the column (x-axis) values
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel
     * @param dataSets the DataSet titles which should be given to the ChartDataModel instead of the sqlRows titles
     */
    public DefaultChartDataModel createChartDataModelInstance(String sqlQuery, String columnRow, String[] sqlRows, String[] dataSets) 
            throws JDBCPlotterException {
        try {
<span class="nc" id="L144">            Statement stmt = conn.createStatement();</span>
<span class="nc" id="L145">            ResultSet sqlResult = stmt.executeQuery(sqlQuery);</span>

<span class="nc" id="L147">            ArrayList model[]   = new ArrayList[sqlRows.length];</span>
<span class="nc" id="L148">            ArrayList columnList = new ArrayList();</span>

<span class="nc bnc" id="L150" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++) {</span>
<span class="nc" id="L151">                model[i]=new ArrayList(); </span>
            }

<span class="nc bnc" id="L154" title="All 2 branches missed.">            while(sqlResult.next()) {</span>

<span class="nc" id="L156">                columnList.add(new Double(sqlResult.getDouble(columnRow)));</span>
                
<span class="nc bnc" id="L158" title="All 2 branches missed.">                for(int i = 0; i &lt; sqlRows.length; i++) {</span>
<span class="nc" id="L159">                    model[i].add(new Double(sqlResult.getDouble(sqlRows[i])));</span>

                }
            }

<span class="nc" id="L164">            Number[][] modelArray = new Number[model.length][];</span>
            
<span class="nc bnc" id="L166" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++)</span>
<span class="nc" id="L167">                modelArray[i] = (Number[])model[i].toArray(new Number[0]);</span>
            
<span class="nc" id="L169">            double[] columns = new double[columnList.size()];</span>
            
<span class="nc bnc" id="L171" title="All 2 branches missed.">            for(int i = 0; i &lt; columns.length; i++)</span>
<span class="nc" id="L172">                columns[i] = ((Double)columnList.get(i)).doubleValue();</span>
            
<span class="nc" id="L174">            return new DefaultChartDataModel(modelArray, columns, dataSets);</span>
<span class="nc" id="L175">        } catch( Exception e ) {</span>
<span class="nc" id="L176">            throw new JDBCPlotterException(&quot;Exception while performing task.&quot;, e);</span>
        }
    }

    /** 
     * Given a SQL query and the row titles this method creates a ObjectChartDataModel.
     * The columns are initialized with values from row columnRow.
     * @param sqlQuery the SQL query to be performed
     * @param columnRow the row from the ResultSet which should be taken as the column (x-axis) values
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel and which
     * will be used as the DataSet titles.
     */
    public ObjectChartDataModel createObjectChartDataModelInstance(String sqlQuery, String columnRow, String[] sqlRows) 
            throws JDBCPlotterException {
<span class="nc" id="L190">        return createObjectChartDataModelInstance(sqlQuery, columnRow, sqlRows, sqlRows);</span>
    }

    /** 
     * Given a SQL query and the row titles this method creates an ObjectChartDataModel.
     * The columns are initialized with values of row columnRow.
     * @param sqlQuery the SQL query to be performed
     * @param columnRow the row from the ResultSet which should be taken as the column (x-axis) values
     * @param sqlRows the rows from the ResultSet which should be included in the ChartDataModel
     * @param dataSets the DataSet titles which should be given to the ChartDataModel instead of the sqlRows titles
     */
    public ObjectChartDataModel createObjectChartDataModelInstance(String sqlQuery, String columnRow, String[] sqlRows, String[] dataSets) 
            throws JDBCPlotterException {
        try {
<span class="nc" id="L204">            Statement stmt = conn.createStatement();</span>
<span class="nc" id="L205">            ResultSet sqlResult = stmt.executeQuery(sqlQuery);</span>

<span class="nc" id="L207">            ArrayList model[]   = new ArrayList[sqlRows.length];</span>
<span class="nc" id="L208">            ArrayList columnList = new ArrayList();</span>

<span class="nc bnc" id="L210" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++) {</span>
<span class="nc" id="L211">                model[i]=new ArrayList(); </span>
            }

<span class="nc bnc" id="L214" title="All 2 branches missed.">            while(sqlResult.next()) {</span>

<span class="nc" id="L216">                columnList.add(sqlResult.getString(columnRow));</span>

<span class="nc bnc" id="L218" title="All 2 branches missed.">                for(int i = 0; i &lt; sqlRows.length; i++) {</span>
<span class="nc" id="L219">                    model[i].add(new Double(sqlResult.getDouble(sqlRows[i])));</span>

                }
            }

<span class="nc" id="L224">            Number[][] modelArray = new Number[model.length][];</span>
            
<span class="nc bnc" id="L226" title="All 2 branches missed.">            for(int i = 0; i &lt; model.length; i++)</span>
<span class="nc" id="L227">                modelArray[i] = (Number[])model[i].toArray(new Number[0]);</span>
            
<span class="nc" id="L229">            String[] columns = (String[])columnList.toArray(new String[0]);</span>
            
<span class="nc" id="L231">            return new ObjectChartDataModel(modelArray, columns, dataSets);</span>
<span class="nc" id="L232">        } catch( Exception e ) {</span>
<span class="nc" id="L233">            throw new JDBCPlotterException(&quot;Exception while performing task.&quot;, e);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>