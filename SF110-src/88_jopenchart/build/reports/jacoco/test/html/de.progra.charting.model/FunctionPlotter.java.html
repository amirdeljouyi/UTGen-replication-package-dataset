<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FunctionPlotter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">88_jopenchart</a> &gt; <a href="index.source.html" class="el_package">de.progra.charting.model</a> &gt; <span class="el_source">FunctionPlotter.java</span></div><h1>FunctionPlotter.java</h1><pre class="source lang-java linenums">/*
    JOpenChart Java Charting Library and Toolkit
    Copyright (C) 2001  Sebastian Mï¿½ller
    http://jopenchart.sourceforge.net

    This library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
    License as published by the Free Software Foundation; either
    version 2.1 of the License, or (at your option) any later version.

    This library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public
    License along with this library; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    FunctionPlotter.java
    Created on 7. September 2001, 17:14
*/

package de.progra.charting.model;

import org.nfunk.jep.JEP;

/**
 * This class can be used to create a ChartDataModel from a mathematical 
 * function. A Python interpreter implemented in Java is called to calculate
 * the function values. Therefore, I didn't need to implement a parsing
 * algorithm. Of course, you need to know the Python syntax for mathematical
 * functions. The quadratical function &lt;code&gt;5x&lt;sup&gt;2&lt;/sup&gt;-3x+4&lt;/code&gt; e.g. 
 * would be written as &lt;code&gt;5*x**2-3*x+4&lt;/code&gt;. Please note, that it takes
 * approx. 1 s to plot a quadratical function like this computing 2000 single
 * values.
 * @author  mueller
 * @version 1.0
 */
public class FunctionPlotter {

    /** Creates new FunctionPlot */
    private FunctionPlotter() {}
    
    /** This method creates a new ChartDataModel from the computed
     * function data. In order to compute the needed values, a Python script is
     * created using the provided parameters and is executed afterwards:&lt;p&gt;
       &lt;pre&gt;&lt;code&gt;
        String pyfile = &quot;&quot; +
        &quot;AMOUNT = &quot;+amount+&quot;\n&quot;+
        &quot;columns = []\n&quot;+
        &quot;model = []\n&quot;+
        &quot;lowrange = &quot;+lowrange+&quot;\n&quot;+
        &quot;highrange = &quot;+highrange+&quot;\n&quot;+
        &quot;for i in range(AMOUNT) :\n&quot;+
        &quot;   x = lowrange + i * (float(abs(highrange - lowrange)) / AMOUNT)\n&quot;+
        &quot;   columns.append(x)\n&quot;+
        &quot;   model.append(&quot;+function+&quot;)\n&quot;;
                
        interp.exec(pyfile);
       &lt;/code&gt;&lt;/pre&gt;
       Finally the values are extracted via the PythonInterpreter:&lt;p&gt;
       &lt;pre&gt;&lt;code&gt;
       pymodel[0] = (double[])interp.get(&quot;model&quot;, double[].class);
       pycolumns = (double[])interp.get(&quot;columns&quot;, double[].class);
       &lt;/code&gt;&lt;/pre&gt;
     * @param lowrange the lower x-value to begin from
     * @param highrange the highest x-value to reach
     * @param amount the amount of values that should be computed (2000 is
     * a good value for smooth curves)
     * @param function the mathematical function in Python notation
     * @param rows the array with the DataSet title
     * @throws IllegalArgumentException if the function contains more than 
     * one variable.
     */
    
    public static DefaultChartDataModel createChartDataModelInstance(double lowrange,
                                                              double highrange,
                                                              int amount,
                                                              String function,
                                                              String[] rows) {
<span class="nc" id="L82">        double x = 0.0;</span>
<span class="nc" id="L83">        JEP jep = new JEP();</span>
<span class="nc" id="L84">        jep.addStandardConstants();</span>
<span class="nc" id="L85">        jep.addStandardFunctions();</span>
        
<span class="nc" id="L87">        jep.parseExpression(function);</span>
        
<span class="nc" id="L89">        String[] vars = jep.getVariables();</span>
<span class="nc" id="L90">        String var = &quot;x&quot;;</span>
            
<span class="nc bnc" id="L92" title="All 2 branches missed.">        if(vars.length &gt; 1)</span>
<span class="nc" id="L93">            throw new IllegalArgumentException(&quot;The supplied function contains more than one variable.&quot;);</span>
        
<span class="nc bnc" id="L95" title="All 2 branches missed.">        if(vars.length == 1)</span>
<span class="nc" id="L96">            var = vars[0];</span>
        
<span class="nc" id="L98">        double[][] model = new double[1][amount];</span>
<span class="nc" id="L99">        double[] columns = new double[amount];</span>
                        
<span class="nc bnc" id="L101" title="All 2 branches missed.">        for(int i = 1; i &lt;= amount; i++) {</span>
<span class="nc" id="L102">            x = lowrange + i * ((double)Math.abs(highrange - lowrange) / amount);</span>
<span class="nc" id="L103">            columns[i-1] = x;</span>
<span class="nc" id="L104">            jep.addVariable(var, x);</span>
<span class="nc" id="L105">            model[0][i-1] = jep.getValue();            </span>
            //System.out.println(&quot;** Calc(&quot;+columns[i-1]+&quot;) = &quot;+model[0][i-1]);
        }
                
<span class="nc" id="L109">        return new DefaultChartDataModel(model, columns, rows);</span>
    }
    
    /** This method creates a new ChartDataModel from the computed
     * function data. This implementation automatically uses the function
     * as DataSet title.
     * @param lowrange the lower x-value to begin from
     * @param hirange the highest x-value to reach
     * @param amount the amount of values that should be computed (2000 is
     * a good value for smooth curves)
     * @param function the mathematical function in Python notation
     */
    
    public static DefaultChartDataModel createChartDataModelInstance(double lowrange,
                                                              double hirange,
                                                              int amount,
                                                              String function) {
<span class="nc" id="L126">            return createChartDataModelInstance(lowrange, hirange, </span>
                                                amount, function,
                                                new String[] {function});
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>