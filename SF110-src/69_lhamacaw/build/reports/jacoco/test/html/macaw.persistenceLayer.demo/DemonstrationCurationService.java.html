<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DemonstrationCurationService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.persistenceLayer.demo</a> &gt; <span class="el_source">DemonstrationCurationService.java</span></div><h1>DemonstrationCurationService.java</h1><pre class="source lang-java linenums">package macaw.persistenceLayer.demo;

import macaw.businessLayer.*;
import macaw.persistenceLayer.DummyDataProvider;
import macaw.system.*;

import java.util.ArrayList;


/**
 * Implements the {@link macaw.businessLayer.MacawCurationAPI} interface as a service which manages
 * all of its data in-memory instead of in a database.  This class allows Macaw to run in 
 * a demonstration mode off a pen drive without requiring the client machine to have MySQL
 * installed.  DemonstrationCurationService is useful in testing as well.  All of the classes
 * in the &lt;code&gt; macaw.test&lt;/code&gt; sub-packages can be applied to either in-memory or SQL
 * versions of Macaw services.  The difference in implementations make it easy to rapidly
 * isolate the causes of failed test cases.  In general, the in-memory implementation is
 * treated as the gold test standard.
 * 
 * &lt;p&gt;
 * DemonstrationCurationService delegates implementations of the API methods to manager
 * classes for major concepts.  All of these manager classes have names that are prefixed
 * with &quot;InMemory&quot;, eg: {@link macaw.persistenceLayer.demo.InMemoryVariableManager}.
 * 
 * &lt;p&gt;
 * The manager classes support persistence using the following policy
 * &lt;ul&gt;
 * &lt;li&gt;when an item is added to a collection, treat it as the stored copy &lt;/li&gt;
 * &lt;li&gt;when calling classes request the item, return a cloned version that serves
 * as a working copy.&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;
 * A more detailed description of how this works is given 
 * in {@link macaw.persistenceLayer.demo.InMemorySupportingDocumentsManager}.
 * 
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

public class DemonstrationCurationService implements MacawCurationAPI {

	// ==========================================
	// Section Constants
	// ==========================================

	// ==========================================
	// Section Properties
	// ==========================================
	protected InMemoryListChoiceManager listChoiceManager;
	protected InMemorySupportingDocumentsManager supportingDocumentsManager;
	protected InMemoryChangeEventManager changeEventManager;
	protected InMemoryVariableManager variableManager;
	protected InMemoryValueLabelManager valueLabelManager;
	protected InMemoryOntologyTermManager ontologyTermManager;
	protected InMemoryUserManager userManager;

	protected InMemoryVariableFilter variableFilter;
	protected InMemorySupportingDocumentFilter supportingDocumentFilter;
	protected InMemoryOntologyTermFilter ontologyTermFilter;

	protected MacawSecurityAPI securityValidationService;
	protected User admin;
	protected Log log;
	// ==========================================
	// Section Construction
	// ==========================================
<span class="fc" id="L101">	public DemonstrationCurationService() {</span>
<span class="fc" id="L102">		init(false);</span>
<span class="fc" id="L103">	}</span>
	
<span class="fc" id="L105">	public DemonstrationCurationService(boolean automatedTestingMode) {</span>
<span class="fc" id="L106">		init(automatedTestingMode);</span>
<span class="fc" id="L107">	}</span>
	
	private void init(boolean automatedTestingMode) {
		
<span class="fc" id="L111">		admin = new User(&quot;admin&quot;, &quot;admin&quot;);</span>
<span class="fc" id="L112">		log = new Log();</span>
<span class="fc" id="L113">		changeEventManager = new InMemoryChangeEventManager();	</span>
<span class="fc" id="L114">		userManager = new InMemoryUserManager(changeEventManager,</span>
											  log,
											  admin);
<span class="fc" id="L117">		securityValidationService = userManager;</span>
		
<span class="fc" id="L119">		ontologyTermManager</span>
			= new InMemoryOntologyTermManager(changeEventManager);

<span class="fc" id="L122">		supportingDocumentsManager </span>
			= new InMemorySupportingDocumentsManager(changeEventManager);
<span class="fc" id="L124">		listChoiceManager </span>
			= new InMemoryListChoiceManager(changeEventManager);
<span class="fc" id="L126">		variableManager</span>
			= new InMemoryVariableManager(changeEventManager,
										  listChoiceManager,
										  ontologyTermManager,
										  supportingDocumentsManager);	
<span class="fc" id="L131">		valueLabelManager</span>
			= new InMemoryValueLabelManager(changeEventManager);

<span class="fc" id="L134">		variableFilter</span>
			= new InMemoryVariableFilter();
<span class="fc" id="L136">		supportingDocumentFilter </span>
			= new InMemorySupportingDocumentFilter();
<span class="fc" id="L138">		ontologyTermFilter</span>
			= new InMemoryOntologyTermFilter();
		
		try {
<span class="fc" id="L142">			User jsmith = new User(&quot;jsmith&quot;, &quot;cool&quot;);</span>
		
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">			if (automatedTestingMode == false) {</span>
<span class="fc" id="L145">				DummyDataProvider dummyDataProvider</span>
					= new DummyDataProvider(this, admin);
<span class="fc" id="L147">				dummyDataProvider.populateDatabase(jsmith);</span>
				
			}
		}
<span class="nc" id="L151">		catch(MacawException exception) {</span>
<span class="nc" id="L152">			exception.printErrors();</span>
<span class="nc" id="L153">			Log log = new Log();</span>
<span class="nc" id="L154">			log.logException(exception);			</span>
<span class="fc" id="L155">		}</span>
<span class="fc" id="L156">	}</span>
	
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================

	// ==========================================
	// Section Errors and Validation
	// ==========================================

	
	// ==========================================
	// Section Interfaces
	// ==========================================

	//Interface: MacawDatabase
	
	public void addRawVariable(User user,
			   				   RawVariable rawVariable) throws MacawException {
<span class="fc" id="L175">		checkValidUser(user);</span>
<span class="fc" id="L176">		variableManager.addRawVariable(user, rawVariable);</span>
<span class="fc" id="L177">	}</span>

	public void deleteRawVariables(User user,
								   ArrayList&lt;RawVariable&gt; rawVariables) throws MacawException {
<span class="nc" id="L181">		checkValidUser(user);</span>
<span class="nc" id="L182">		variableManager.deleteRawVariables(user, rawVariables);</span>
<span class="nc" id="L183">	}</span>

	public void updateRawVariable(User user,
								  RawVariable rawVariable) throws MacawException {

<span class="nc" id="L188">		checkValidUser(user);</span>
<span class="nc" id="L189">		variableManager.updateRawVariable(user, rawVariable);</span>
<span class="nc" id="L190">	}</span>

	public void addDerivedVariable(User user,
								   DerivedVariable derivedVariable) throws MacawException {
<span class="fc" id="L194">		checkValidUser(user);</span>
<span class="fc" id="L195">		variableManager.addDerivedVariable(user, derivedVariable);</span>
<span class="fc" id="L196">	}</span>

	public void deleteDerivedVariables(User user,
									   ArrayList&lt;DerivedVariable&gt; derivedVariables) throws MacawException {
<span class="nc" id="L200">		checkValidUser(user);</span>
<span class="nc" id="L201">		variableManager.deleteDerivedVariables(user, derivedVariables);</span>
<span class="nc" id="L202">	}</span>

	public void updateDerivedVariable(User user,
									  DerivedVariable derivedVariable) throws MacawException {
<span class="nc" id="L206">		checkValidUser(user);</span>
<span class="nc" id="L207">		variableManager.updateDerivedVariable(user, derivedVariable);</span>
<span class="nc" id="L208">	}</span>

	public int getRawVariableIdentifier(User user,
										RawVariable rawVariable) throws MacawException {
<span class="nc" id="L212">		checkValidUser(user);</span>
<span class="nc" id="L213">		return variableManager.getRawVariableIdentifier(user, rawVariable);</span>
	}
	
	public int getDerivedVariableIdentifier(User user,
											DerivedVariable derivedVariable) throws MacawException {
<span class="nc" id="L218">		checkValidUser(user);</span>
<span class="nc" id="L219">		return variableManager.getDerivedVariableIdentifier(user, derivedVariable);		</span>
	}
	
	public Variable getVariable(User user,
							  	String variableName) throws MacawException {
<span class="nc" id="L224">		checkValidUser(user);</span>
<span class="nc" id="L225">		return variableManager.getVariable(user, variableName);</span>
	}
	
	public ArrayList&lt;Variable&gt; getSourceVariables(User user,
												  DerivedVariable derivedVariable) throws MacawException {
<span class="nc" id="L230">		checkValidUser(user);</span>
<span class="nc" id="L231">		return variableManager.getSourceVariables(user, derivedVariable);</span>
	}
	
	public void associateSourceVariables(User user,
										 DerivedVariable derivedVariable,
										 ArrayList&lt;Variable&gt; sourceVariablesToAdd) throws MacawException {

<span class="fc" id="L238">		checkValidUser(user);</span>
<span class="fc" id="L239">		variableManager.associateSourceVariables(user, </span>
												 derivedVariable,
												 sourceVariablesToAdd);		
<span class="fc" id="L242">	}</span>

	public void disassociateSourceVariables(User user,
											DerivedVariable derivedVariable,
											ArrayList&lt;Variable&gt; sourceVariablesToDelete) throws MacawException {
		
<span class="nc" id="L248">		checkValidUser(user);</span>
<span class="nc" id="L249">		variableManager.disassociateSourceVariables(user, </span>
											  		derivedVariable, 
											  		sourceVariablesToDelete);
<span class="nc" id="L252">	}</span>

	public ArrayList&lt;ValueLabel&gt; getValueLabels(User user,
			   				   					Variable variable) throws MacawException {
<span class="nc" id="L256">		checkValidUser(user);</span>
<span class="nc" id="L257">		Variable originalVariable</span>
<span class="nc" id="L258">			= variableManager.getOriginalVariable(variable);</span>
<span class="nc" id="L259">		return valueLabelManager.getValueLabels(user,</span>
												originalVariable);
	}
	
	public void addValueLabels(User user,
			   				   Variable variable,
			   				   ArrayList&lt;ValueLabel&gt; valueLabels) throws MacawException {
<span class="fc" id="L266">		checkValidUser(user);</span>
<span class="fc" id="L267">		Variable originalVariable</span>
<span class="fc" id="L268">			= variableManager.getOriginalVariable(variable);</span>
<span class="fc" id="L269">		valueLabelManager.addValueLabels(user,</span>
										 originalVariable,
									   	 valueLabels);
<span class="fc" id="L272">	}</span>
	
	public void updateValueLabels(User user,
				  				  Variable variable,
				  				  ArrayList&lt;ValueLabel&gt; valueLabels) throws MacawException {
<span class="nc" id="L277">		checkValidUser(user);</span>
<span class="nc" id="L278">		Variable originalVariable</span>
<span class="nc" id="L279">			= variableManager.getOriginalVariable(variable);</span>
<span class="nc" id="L280">		valueLabelManager.updateValueLabels(user,</span>
										   originalVariable,
										   valueLabels);
<span class="nc" id="L283">	}</span>
	
	public void deleteValueLabels(User user,
				  				  Variable variable,
				  				  ArrayList&lt;ValueLabel&gt; valueLabels) throws MacawException {
<span class="nc" id="L288">		checkValidUser(user);</span>
<span class="nc" id="L289">		checkVariableExists(variable);</span>
		
<span class="nc" id="L291">		Variable originalVariable</span>
<span class="nc" id="L292">			= variableManager.getOriginalVariable(variable);</span>
<span class="nc" id="L293">		valueLabelManager.deleteValueLabels(user,</span>
											originalVariable,
				  						  	valueLabels);
<span class="nc" id="L296">	}</span>
	
	public int getValueLabelIdentifier(User user,
									   Variable variable,
									   ValueLabel valueLabel) {
<span class="nc" id="L301">		return valueLabelManager.getValueLabelIdentifier(variable, valueLabel);</span>
	}
	
	public String[] getStudyYears(User user) throws MacawException {
<span class="nc" id="L305">		checkValidUser(user);</span>
<span class="nc" id="L306">		return variableManager.getStudyYears(user);</span>
	}

	public ArrayList&lt;VariableSummary&gt; getSummaryDataForAllVariables(User user) throws MacawException {
<span class="nc" id="L310">		checkValidUser(user);</span>
<span class="nc" id="L311">		return variableManager.getSummaryDataForAllVariables(user);</span>
	}
	
	public Variable getCompleteVariableData(User user, VariableSummary variableSummary) throws MacawException {
<span class="nc" id="L315">		checkValidUser(user);</span>
<span class="nc" id="L316">		return variableManager.getCompleteVariableData(user,</span>
													   variableSummary);
	}

	public Variable getOriginalVariable(User user, Variable variable) throws MacawException {
<span class="nc" id="L321">		checkValidUser(user);</span>
<span class="nc" id="L322">		return variableManager.getOriginalVariable(variable);</span>
	}
	
	public ArrayList&lt;SupportingDocument&gt; getAllSupportingDocuments(User user) throws MacawException {
<span class="nc" id="L326">		checkValidUser(user);</span>
		
<span class="nc" id="L328">		ArrayList&lt;SupportingDocument&gt; allSupportingDocuments</span>
<span class="nc" id="L329">			= supportingDocumentsManager.getAllSupportingDocuments(user);</span>
<span class="nc" id="L330">		return allSupportingDocuments;</span>
	}
	
	public ArrayList&lt;SupportingDocument&gt; getSupportingDocuments(User user, 
																Variable variable) throws MacawException {
<span class="nc" id="L335">		checkValidUser(user);</span>
<span class="nc" id="L336">		checkVariableExists(variable);</span>
		
<span class="nc" id="L338">		ArrayList&lt;SupportingDocument&gt; results</span>
<span class="nc" id="L339">			= variableManager.getSupportingDocuments(user,</span>
													 variable);
<span class="nc" id="L341">		return results;</span>
	}
	
	public void addSupportingDocument(User user,
									  SupportingDocument supportingDocument) throws MacawException {

<span class="fc" id="L347">		checkValidUser(user);</span>
<span class="fc" id="L348">		supportingDocumentsManager.addSupportingDocument(user,</span>
														 supportingDocument);
<span class="fc" id="L350">	}</span>
		
	public void updateSupportingDocument(User user,
										 SupportingDocument revisedSupportingDocument) throws MacawException {		

<span class="nc" id="L355">		checkValidUser(user);</span>
<span class="nc" id="L356">		supportingDocumentsManager.updateSupportingDocument(user,</span>
															revisedSupportingDocument);	
<span class="nc" id="L358">	}</span>
	
	public void deleteSupportingDocuments(User user,
										  ArrayList&lt;SupportingDocument&gt; supportingDocuments) throws MacawException {

<span class="nc" id="L363">		checkValidUser(user);</span>
<span class="nc" id="L364">		supportingDocumentsManager.deleteSupportingDocuments(user,</span>
															 supportingDocuments);
<span class="nc" id="L366">	}</span>

	public int getSupportingDocumentIdentifier(User user,
											   SupportingDocument supportingDocument) throws MacawException {
<span class="fc" id="L370">		return supportingDocumentsManager.getSupportingDocumentIdentifier(supportingDocument);</span>
	}

	public void associateSupportingDocumentsWithVariable(User user,
											 			 Variable variable,
											 			 ArrayList&lt;SupportingDocument&gt; supportingDocuments) throws MacawException {

<span class="fc" id="L377">		checkValidUser(user);</span>
<span class="fc" id="L378">		variableManager.associateSupportingDocuments(user,</span>
													 variable,	
													 supportingDocuments);
<span class="fc" id="L381">	}	</span>

	public void disassociateSupportingDocumentsFromVariable(User user,
															Variable variable,
															ArrayList&lt;SupportingDocument&gt; supportingDocuments) throws MacawException {

<span class="nc" id="L387">		checkValidUser(user);</span>
<span class="nc" id="L388">		variableManager.disassociateSupportingDocuments(user,</span>
														variable, 
														supportingDocuments);
<span class="nc" id="L391">	}</span>
	
	public ArrayList&lt;Category&gt; getCategories(User user) throws MacawException {
<span class="nc" id="L394">		checkValidUser(user);</span>
<span class="nc" id="L395">		return listChoiceManager.getCategories(user);</span>
	}
		
	/**
	 * methods for managing categories
	 */
	public void addCategory(User user, 
							Category dataLibrary) throws MacawException {
<span class="fc" id="L403">		checkValidUser(user);</span>
<span class="fc" id="L404">		listChoiceManager.addCategory(user, dataLibrary);</span>
<span class="fc" id="L405">	}</span>

	public void updateCategory(User user, 
							   Category dataLibrary) throws MacawException {
<span class="nc" id="L409">		checkValidUser(user);</span>
<span class="nc" id="L410">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L411">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L412">		listChoiceManager.updateCategory(user,</span>
										 dataLibrary,
										 variables);		
<span class="nc" id="L415">	}</span>

	public void deleteCategories(User user, 
								 ArrayList&lt;Category&gt; categories) throws MacawException {
<span class="nc" id="L419">		checkValidUser(user);</span>
<span class="nc" id="L420">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L421">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L422">		listChoiceManager.deleteCategories(user, </span>
										   categories, 
										   variables);		
<span class="nc" id="L425">	}	</span>

	public int getCategoryIdentifier(User user,
									 Variable variable,
			 						 Category category) throws MacawException {
<span class="nc" id="L430">		checkValidUser(user);</span>
<span class="nc" id="L431">		return listChoiceManager.getCategoryIdentifier(category, variable);</span>
	}
	
	/**
	 * Methods for managing cleaning states
	 */
	public ArrayList&lt;CleaningState&gt; getCleaningStates(User user) throws MacawException {		
<span class="nc" id="L438">		checkValidUser(user);</span>
<span class="nc" id="L439">		return listChoiceManager.getCleaningStates(user);</span>
	}

	public void addCleaningState(User user, 
			 						 CleaningState cleaningState) throws MacawException {
<span class="fc" id="L444">		checkValidUser(user);</span>
<span class="fc" id="L445">		listChoiceManager.addCleaningState(user, cleaningState);</span>
<span class="fc" id="L446">	}</span>
	
	public void updateCleaningState(User user, 
										CleaningState cleaningState) throws MacawException {
<span class="nc" id="L450">		checkValidUser(user);</span>
<span class="nc" id="L451">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L452">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L453">		listChoiceManager.updateCleaningState(user, cleaningState, variables);		</span>
<span class="nc" id="L454">	}</span>
	
	public void deleteCleaningStates(User user, 
				 						 ArrayList&lt;CleaningState&gt; cleaningStates) throws MacawException {
<span class="nc" id="L458">		checkValidUser(user);</span>
<span class="nc" id="L459">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L460">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L461">		listChoiceManager.deleteCleaningStates(user, </span>
											   cleaningStates,
											   variables);		
<span class="nc" id="L464">	}</span>

	public int getCleaningStateIdentifier(User user,
										  Variable variable,
									 	  CleaningState cleaningState) throws MacawException {
<span class="nc" id="L469">		checkValidUser(user);</span>
<span class="nc" id="L470">		return listChoiceManager.getCleaningStateIdentifier(cleaningState, variable);</span>
	}

	/**
	 * Methods for managing availability states
	 */
	public ArrayList&lt;AvailabilityState&gt; getAvailabilityStates(User user) throws MacawException {
<span class="nc" id="L477">		checkValidUser(user);</span>
<span class="nc" id="L478">		return listChoiceManager.getAvailabilityStates(user);</span>
	}

	public void addAvailabilityState(User user, 
			 						 AvailabilityState availabilityState) throws MacawException {
<span class="fc" id="L483">		checkValidUser(user);</span>
<span class="fc" id="L484">		listChoiceManager.addAvailabilityState(user, </span>
											   availabilityState);
<span class="fc" id="L486">	}</span>
	
	public void updateAvailabilityState(User user, 
										AvailabilityState availabilityState) throws MacawException {

<span class="nc" id="L491">		checkValidUser(user);</span>
<span class="nc" id="L492">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L493">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L494">		listChoiceManager.updateAvailabilityState(user, </span>
												  availabilityState,
												  variables);		
<span class="nc" id="L497">	}</span>
	
	public void deleteAvailabilityStates(User user, 
				 						 ArrayList&lt;AvailabilityState&gt; availabilityStatesToDelete) throws MacawException {

<span class="nc" id="L502">		checkValidUser(user);</span>
<span class="nc" id="L503">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L504">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L505">		listChoiceManager.deleteAvailabilityStates(user, </span>
												   availabilityStatesToDelete,
												   variables);		
<span class="nc" id="L508">	}</span>

	public int getAvailabilityStateIdentifier(User user,
										      Variable variable,
											  AvailabilityState availabilityState) throws MacawException {
<span class="nc" id="L513">		checkValidUser(user);</span>
<span class="nc" id="L514">		return listChoiceManager.getAvailabilityStateIdentifier(availabilityState, variable);</span>
	}

	/**
	 * Methods for data libraries
	 */
	public ArrayList&lt;AliasFilePath&gt; getAliasFilePaths(User user) throws MacawException {		
<span class="nc" id="L521">		checkValidUser(user);</span>
<span class="nc" id="L522">		return listChoiceManager.getAliasFilePaths(user);</span>
	}

	public void addAliasFilePath(User user, 
							     AliasFilePath aliasFilePath) throws MacawException {
<span class="fc" id="L527">		checkValidUser(user);</span>
<span class="fc" id="L528">		listChoiceManager.addAliasFilePath(user, aliasFilePath);</span>
<span class="fc" id="L529">	}</span>
	
	public void updateAliasFilePath(User user, 
									AliasFilePath aliasFilePath) throws MacawException {
<span class="nc" id="L533">		checkValidUser(user);</span>
<span class="nc" id="L534">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L535">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L536">		listChoiceManager.updateAliasFilePath(user, </span>
											  aliasFilePath,
											  variables);		
<span class="nc" id="L539">	}</span>
	
	public void deleteAliasFilePaths(User user, 
				 					 ArrayList&lt;AliasFilePath&gt; aliasFilePaths) throws MacawException {

<span class="nc" id="L544">		checkValidUser(user);</span>
<span class="nc" id="L545">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L546">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L547">		listChoiceManager.deleteAliasFilePaths(user, </span>
											   aliasFilePaths,
											   variables);		
<span class="nc" id="L550">	}</span>

	public int getAliasFilePathIdentifier(User user,
										  Variable variable,
										  AliasFilePath aliasFilePath) throws MacawException {
<span class="nc" id="L555">		checkValidUser(user);</span>
<span class="nc" id="L556">		return listChoiceManager.getAliasFilePathIdentifier(aliasFilePath, variable);</span>
	}

	public ArrayList&lt;VariableSummary&gt; filterVariableSummaries(User user,
			   								   				  String searchText,
			   								   				  String year,
			   								   				  String category,
			   								   				  VariableTypeFilter variableTypeFilter) throws MacawException {
				
<span class="nc" id="L565">		checkValidUser(user);				</span>
<span class="nc" id="L566">		InMemoryVariableFilter inMemoryVariableFilter</span>
			= new InMemoryVariableFilter();
<span class="nc" id="L568">		ArrayList&lt;Variable&gt; variables </span>
<span class="nc" id="L569">			= variableManager.getOriginalVariables(user);</span>
<span class="nc" id="L570">		inMemoryVariableFilter.setVariables(variables);</span>
<span class="nc" id="L571">		ArrayList&lt;VariableSummary&gt; results</span>
<span class="nc" id="L572">			= inMemoryVariableFilter.filterVariableSummaries(user,</span>
													 		 searchText,
													 		 year,
													 		 category,
													 		 variableTypeFilter);
<span class="nc" id="L577">		return results;				</span>
	}

	public String getFilePathFromAlias(User user,
									   String currentAlias) throws MacawException {

<span class="nc" id="L583">		checkValidUser(user);</span>
<span class="nc" id="L584">		return listChoiceManager.getFilePathFromAlias(currentAlias);</span>
	}

	public ArrayList&lt;SupportingDocument&gt; filterSupportingDocuments(User user,
			   													   String documentTitleFilter,
			   													   String documentCodeFilter) throws MacawException {
<span class="nc" id="L590">		checkValidUser(user);</span>
<span class="nc" id="L591">		ArrayList&lt;SupportingDocument&gt; allSupportingDocuments</span>
<span class="nc" id="L592">			= supportingDocumentsManager.getAllSupportingDocuments(user);</span>
<span class="nc" id="L593">		supportingDocumentFilter.setSupportingDocuments(allSupportingDocuments);</span>
<span class="nc" id="L594">		return supportingDocumentFilter.filterSupportingDocuments(user, </span>
																  documentTitleFilter, 
																  documentCodeFilter);
	}
	
	public ArrayList&lt;OntologyTerm&gt; filterOntologyTerms(User user,
													   String termFilter,
													   String descriptionFilter) throws MacawException {
<span class="nc" id="L602">		ArrayList&lt;OntologyTerm&gt; results = new ArrayList&lt;OntologyTerm&gt;();</span>
		
<span class="nc" id="L604">		checkValidUser(user);</span>
<span class="nc" id="L605">		ArrayList&lt;OntologyTerm&gt; allOntologyTerms</span>
<span class="nc" id="L606">			= ontologyTermManager.getAllOntologyTerms(user);</span>
<span class="nc" id="L607">		ontologyTermFilter.setOntologyTerms(allOntologyTerms);</span>
<span class="nc" id="L608">		return ontologyTermFilter.filterOntologyTerms(user, </span>
													  termFilter, 
													  descriptionFilter);
	}

	
	public ArrayList&lt;OntologyTerm&gt; getAllOntologyTerms(User user) throws MacawException {
<span class="nc" id="L615">		checkValidUser(user);</span>
<span class="nc" id="L616">		return ontologyTermManager.getAllOntologyTerms(user);</span>
	}

	public ArrayList&lt;OntologyTerm&gt; getOntologyTerms(User user,
													Variable variable) throws MacawException {
<span class="nc" id="L621">		checkValidUser(user);</span>
<span class="nc" id="L622">		return variableManager.getAssociatedOntologyTerms(user, variable);</span>
	}
	
	public void addOntologyTerm(User user,
								OntologyTerm ontologyTerm) throws MacawException {
<span class="fc" id="L627">		checkValidUser(user);</span>
<span class="fc" id="L628">		ontologyTermManager.addOntologyTerm(user,</span>
											ontologyTerm);
<span class="fc" id="L630">	}</span>
	
	public void updateOntologyTerm(User user,
								   OntologyTerm ontologyTerm) throws MacawException {
<span class="nc" id="L634">		checkValidUser(user);</span>
<span class="nc" id="L635">		ontologyTermManager.updateOntologyTerm(user,</span>
											   ontologyTerm);		
<span class="nc" id="L637">		variableManager.updateOntologyTermReferences(ontologyTerm);</span>
<span class="nc" id="L638">	}</span>
	
	public void deleteOntologyTerms(User user,
								    ArrayList&lt;OntologyTerm&gt; ontologyTerms) throws MacawException {
<span class="nc" id="L642">		checkValidUser(user);</span>
<span class="nc" id="L643">		ontologyTermManager.deleteOntologyTerms(user,</span>
											    ontologyTerms);		
<span class="nc" id="L645">		variableManager.deleteOntologyTermReferences(ontologyTerms);</span>
<span class="nc" id="L646">	}</span>

	public int getOntologyTermIdentifier(User user,
										OntologyTerm ontologyTerm) throws MacawException {
<span class="fc" id="L650">		checkValidUser(user);</span>
<span class="fc" id="L651">		return ontologyTermManager.getOntologyTermIdentifier(ontologyTerm);</span>
	}

	public void associateOntologyTermsWithVariable(User user,
										   		   Variable variable,
										   		   ArrayList&lt;OntologyTerm&gt; ontologyTerms) throws MacawException {
<span class="fc" id="L657">		checkValidUser(user);</span>
<span class="fc" id="L658">		variableManager.associateOntologyTerms(user,</span>
											   variable,
											   ontologyTerms);		
<span class="fc" id="L661">	}</span>
	
	public void disassociateOntologyTermsFromVariable(User user,
	   	  											  Variable variable,
	   	  											  ArrayList&lt;OntologyTerm&gt; ontologyTerms) throws MacawException {
<span class="nc" id="L666">		checkValidUser(user);</span>
<span class="nc" id="L667">		variableManager.disassociateOntologyTerms(user,</span>
												variable,
												ontologyTerms);		
<span class="nc" id="L670">	}</span>

	public ArrayList&lt;MacawChangeEvent&gt; getChangeHistoryForVariable(User user,
		  	   													   Variable variable) throws MacawException {
<span class="nc" id="L674">		checkValidUser(user);</span>
<span class="nc" id="L675">		return changeEventManager.getChangeHistoryForVariable(user, variable);		</span>
	}
	public ArrayList&lt;MacawChangeEvent&gt; getChangeHistoryForSupportingDocument(User user,
																			 SupportingDocument supportingDocument) throws MacawException {
<span class="nc" id="L679">		checkValidUser(user);</span>
<span class="nc" id="L680">		return changeEventManager.getChangeHistoryForSupportingDocument(user, supportingDocument);		</span>
	}
	
	public ArrayList&lt;MacawChangeEvent&gt; getChangeHistoryForValueLabels(User user,
																	  Variable variable) throws MacawException {
<span class="nc" id="L685">		checkValidUser(user);</span>
<span class="nc" id="L686">		return changeEventManager.getChangeHistoryForValueLabels(user, variable);		</span>
	}
	
	public ArrayList&lt;MacawChangeEvent&gt; getChangeHistoryForListChoices(User user) throws MacawException {
<span class="nc" id="L690">		checkValidUser(user);</span>
<span class="nc" id="L691">		return changeEventManager.getChangeHistoryForListChoices();				</span>
	}

	public ArrayList&lt;MacawChangeEvent&gt; getChangeHistoryByUser(User user) throws MacawException {
<span class="nc" id="L695">		checkValidUser(user);</span>
<span class="nc" id="L696">		return changeEventManager.getChangeHistoryByUser(user);</span>
	}

	public void addChangeEvents(MacawChangeEvent changeEvent) throws MacawException {
<span class="nc" id="L700">		ArrayList&lt;MacawChangeEvent&gt; changeEvents = new ArrayList&lt;MacawChangeEvent&gt;();</span>
<span class="nc" id="L701">		changeEvents.add(changeEvent);</span>
<span class="nc" id="L702">		changeEventManager.registerChangeEvents(changeEvents);</span>
<span class="nc" id="L703">	}</span>

	//admin features for management of users.
	public ArrayList&lt;User&gt; getUsers(User admin) throws MacawException {
<span class="nc" id="L707">		return userManager.getUsers(admin);</span>
	}
	
	public void addUser(User admin, User user) throws MacawException {
<span class="nc" id="L711">		userManager.addUser(admin, user);</span>
<span class="nc" id="L712">	}</span>
	
	public void updateUser(User admin, User user) throws MacawException {
<span class="nc" id="L715">		userManager.updateUser(admin, user);		</span>
<span class="nc" id="L716">	}</span>
	
	public void deleteUsers(User admin, ArrayList&lt;User&gt; usersToDelete) throws MacawException {
<span class="nc" id="L719">		userManager.deleteUsers(admin, usersToDelete);		</span>
<span class="nc" id="L720">	}</span>

	public int getUserIdentifier(User admin,
								 User user) throws MacawException {
<span class="nc" id="L724">		return userManager.getUserIdentifier(user);</span>
	}

	public void checkValidUser(User user) throws MacawException {
<span class="fc" id="L728">		securityValidationService.validateUser(user);</span>
<span class="fc" id="L729">	}</span>
	
	private void checkVariableExists(Variable variable) throws MacawException {
<span class="nc" id="L732">		variableManager.checkVariableExists(variable);</span>
<span class="nc" id="L733">	}</span>
	
	public void checkValidAdministrator(User administrator) throws MacawException {
<span class="nc" id="L736">		securityValidationService.validateAdministrator(administrator);</span>
<span class="nc" id="L737">	}</span>

	public void clear(User admin) throws MacawException {
<span class="nc" id="L740">		userManager.validateAdministrator(admin);</span>
<span class="nc" id="L741">		listChoiceManager.clear();</span>
<span class="nc" id="L742">		supportingDocumentsManager.clear();</span>
<span class="nc" id="L743">		changeEventManager.clear();	</span>
<span class="nc" id="L744">		variableManager.clear();</span>
<span class="nc" id="L745">		valueLabelManager.clear();</span>
<span class="nc" id="L746">		ontologyTermManager.clear();</span>
<span class="nc" id="L747">		userManager.clear();</span>
<span class="nc" id="L748">	}</span>
	
	public void clearAllChanges(User admin) throws MacawException {
<span class="fc" id="L751">		userManager.validateAdministrator(admin);</span>
<span class="fc" id="L752">		changeEventManager.clear();</span>
<span class="fc" id="L753">	}</span>
	
	public ArrayList&lt;MacawChangeEvent&gt; getAllChanges(User admin) throws MacawException {
<span class="nc" id="L756">		userManager.validateAdministrator(admin);</span>
<span class="nc" id="L757">		return changeEventManager.getAllChanges();</span>
	}

	public Variable getAlternativeVariable(User user,
										   Variable targetVariable) throws MacawException {
<span class="nc" id="L762">		return variableManager.getAlternativeVariable(targetVariable);</span>
	}

	public void setAlternativeVariable(User user, 
									   Variable targetVariable,
									   Variable alternativeVariable) throws MacawException {

<span class="nc" id="L769">		variableManager.setAlternativeVariable(user,</span>
											   targetVariable,
											   alternativeVariable);
<span class="nc" id="L772">	}</span>

	
	// ==========================================
	// Section Overload
	// ==========================================

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>