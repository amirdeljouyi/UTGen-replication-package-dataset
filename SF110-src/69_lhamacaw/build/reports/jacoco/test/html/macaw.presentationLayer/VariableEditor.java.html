<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VariableEditor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.presentationLayer</a> &gt; <span class="el_source">VariableEditor.java</span></div><h1>VariableEditor.java</h1><pre class="source lang-java linenums">package macaw.presentationLayer;

import macaw.businessLayer.*;
import macaw.system.*;
import macaw.util.*;

import javax.swing.*;
import javax.swing.border.LineBorder;

import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.GridBagConstraints;
import java.awt.Insets;
import java.util.*;

/**
 * &lt;p&gt;&lt;/p&gt;
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

abstract public class VariableEditor implements ActionListener,
												DisplayableListParentForm {

	// ==========================================
	// Section Constants
	// ==========================================

	// ==========================================
	// Section Properties
	// ==========================================
	protected SessionProperties sessionProperties;
	protected UserInterfaceFactory userInterfaceFactory;
	protected User currentUser;
	protected String currentUserID;
	protected Log log;

	protected MacawCurationAPI database;
	protected JDialog dialog;
	
	protected JTextArea instructionsTextArea;
	
	protected String isCodedText;
	protected JCheckBox isCodedField;
	
	protected String nameLabelText;
	protected JTextField nameField;

	protected String labelLabelText;
	protected JTextField labelField;	

	protected String categoryLabelText;
	protected JComboBox categoryChoicesField;

	protected CleaningStatePanel cleaningStatePanel;

	protected String yearLabelText;
	protected JTextField yearField;

	private String formLabelText;
	private JTextField formField;

	private String questionNumberLabelText;
	private JTextField questionNumberField;	

	protected OntologyTermsPanel ontologyTermsPanel;
	protected SupportingDocumentsPanel supportingDocumentsPanel;

	protected String availabilityLabelText;
	protected JComboBox availabilityChoicesField;

	protected String aliasFilePathLabelText;
	protected JComboBox aliasFilePathChoicesField;

	private JTextField codeBookNumberField;
	private JTextField columnStartField;
	private JTextField columnEndField;

	protected String filePathLabelText;
	protected JTextField filePathField;

	protected JTextArea notesField;

	protected AlternativeVariableSelectionPanel alternativeVariableSelectionPanel;
	
	protected JButton showChangeHistory;
	protected JButton editLabelValues;
	
	protected OKClosePanel okCancelPanel;
	protected JButton save;
	protected JButton close;
	
	protected boolean committedChanges;
	
	private Variable variable;

	protected boolean allowWriteAccess;
	
	// ==========================================
	// Section Construction
	// ==========================================
	public VariableEditor(SessionProperties sessionProperties,
<span class="nc" id="L137">						  boolean allowWriteAccess) {</span>
<span class="nc" id="L138">		this.sessionProperties = sessionProperties;</span>
<span class="nc" id="L139">		this.allowWriteAccess = allowWriteAccess;</span>
<span class="nc" id="L140">		userInterfaceFactory</span>
<span class="nc" id="L141">			= sessionProperties.getUserInterfaceFactory();</span>
<span class="nc" id="L142">		database</span>
<span class="nc" id="L143">			= (MacawCurationAPI) sessionProperties.getProperty(SessionProperties.DATABASE);</span>
<span class="nc" id="L144">		currentUser</span>
<span class="nc" id="L145">			= (User) sessionProperties.getProperty(SessionProperties.CURRENT_USER);</span>
<span class="nc" id="L146">		currentUserID = currentUser.getUserID();</span>
<span class="nc" id="L147">		log</span>
<span class="nc" id="L148">			= (Log) sessionProperties.getProperty(SessionProperties.LOG);</span>
		
		
<span class="nc" id="L151">		instructionsTextArea</span>
<span class="nc" id="L152">			= userInterfaceFactory.createImmutableTextArea(3, 30);</span>
<span class="nc" id="L153">		String instructionsAreaText</span>
<span class="nc" id="L154">			= MacawMessages.getMessage(&quot;variableLabelEditor.instructions&quot;);</span>
<span class="nc" id="L155">		instructionsTextArea.setText(instructionsAreaText);</span>
<span class="nc" id="L156">		instructionsTextArea.setBorder(LineBorder.createGrayLineBorder());</span>
		
<span class="nc" id="L158">		nameLabelText</span>
<span class="nc" id="L159">			= MacawMessages.getMessage(&quot;variable.name.label&quot;);</span>
<span class="nc" id="L160">		nameField </span>
<span class="nc" id="L161">			= userInterfaceFactory.createTextField(10);</span>
<span class="nc" id="L162">		nameField.setEditable(allowWriteAccess);</span>
		
<span class="nc" id="L164">		labelLabelText</span>
<span class="nc" id="L165">			= MacawMessages.getMessage(&quot;variable.label.label&quot;); </span>
<span class="nc" id="L166">		labelField </span>
<span class="nc" id="L167">			= userInterfaceFactory.createTextField(30);</span>
<span class="nc" id="L168">		labelField.setEditable(allowWriteAccess);</span>
		
<span class="nc" id="L170">		categoryLabelText</span>
<span class="nc" id="L171">			= MacawMessages.getMessage(&quot;variable.category.label&quot;); </span>
		
<span class="nc" id="L173">		String[] categoryChoices = new String[0];</span>
		try {
<span class="nc" id="L175">			ArrayList&lt;Category&gt; categories</span>
<span class="nc" id="L176">				= database.getCategories(currentUser);		</span>
<span class="nc" id="L177">			categoryChoices</span>
<span class="nc" id="L178">				= ConstantConverter.getCategoryChoices(categories);</span>
		}
<span class="nc" id="L180">		catch(MacawException exception) {</span>
<span class="nc" id="L181">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L182">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L183">		}</span>
		
<span class="nc" id="L185">		categoryChoicesField </span>
<span class="nc" id="L186">			= userInterfaceFactory.createComboBox(categoryChoices);</span>
<span class="nc" id="L187">		categoryChoicesField.setEnabled(allowWriteAccess);</span>
		
<span class="nc" id="L189">		yearLabelText</span>
<span class="nc" id="L190">			= MacawMessages.getMessage(&quot;variable.year.label&quot;); </span>
<span class="nc" id="L191">		yearField = userInterfaceFactory.createTextField(5);</span>
<span class="nc" id="L192">		yearField.setEditable(allowWriteAccess);</span>

<span class="nc" id="L194">		isCodedText</span>
<span class="nc" id="L195">			= MacawMessages.getMessage(&quot;variable.isCoded.label&quot;);</span>
<span class="nc" id="L196">		isCodedField = userInterfaceFactory.createCheckBox(isCodedText);</span>
		
<span class="nc" id="L198">		ontologyTermsPanel</span>
			= new OntologyTermsPanel(sessionProperties,
									 this,
								     allowWriteAccess);
		
<span class="nc" id="L203">		supportingDocumentsPanel </span>
			= new SupportingDocumentsPanel(sessionProperties, 
										   this,
										   allowWriteAccess);
		
<span class="nc" id="L208">		alternativeVariableSelectionPanel</span>
			= new AlternativeVariableSelectionPanel(sessionProperties);

<span class="nc" id="L211">		availabilityLabelText</span>
<span class="nc" id="L212">			= MacawMessages.getMessage(&quot;variable.availability.label&quot;);</span>
<span class="nc" id="L213">		String[] availabilityChoices = new String[0];</span>
		try {
<span class="nc" id="L215">			ArrayList&lt;AvailabilityState&gt; availabilityStates</span>
<span class="nc" id="L216">				= database.getAvailabilityStates(currentUser);		</span>
<span class="nc" id="L217">			availabilityChoices</span>
<span class="nc" id="L218">				= ConstantConverter.getAvailabilityStatusChoices(availabilityStates);</span>
		}
<span class="nc" id="L220">		catch(MacawException exception) {</span>
<span class="nc" id="L221">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L222">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L223">		}</span>
		
<span class="nc" id="L225">		availabilityChoicesField </span>
<span class="nc" id="L226">			= userInterfaceFactory.createComboBox(availabilityChoices);</span>
<span class="nc" id="L227">		availabilityChoicesField.setEnabled(allowWriteAccess);</span>
		
<span class="nc" id="L229">		aliasFilePathLabelText</span>
<span class="nc" id="L230">			= MacawMessages.getMessage(&quot;variable.alias.label&quot;);</span>
		
<span class="nc" id="L232">		String[] aliasFilePathChoices = new String[0];</span>
		try {
<span class="nc" id="L234">			ArrayList&lt;AliasFilePath&gt; aliasFilePaths</span>
<span class="nc" id="L235">				= database.getAliasFilePaths(currentUser);		</span>
<span class="nc" id="L236">			aliasFilePathChoices</span>
<span class="nc" id="L237">				= ConstantConverter.getAliasFilePathChoices(aliasFilePaths);</span>
		}
<span class="nc" id="L239">		catch(MacawException exception) {</span>
<span class="nc" id="L240">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L241">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L242">		}		</span>
<span class="nc" id="L243">		aliasFilePathChoicesField </span>
<span class="nc" id="L244">			= userInterfaceFactory.createComboBox(aliasFilePathChoices);</span>
<span class="nc" id="L245">		aliasFilePathChoicesField.setEnabled(allowWriteAccess);</span>

<span class="nc" id="L247">		filePathLabelText</span>
<span class="nc" id="L248">			= MacawMessages.getMessage(&quot;variable.filePath.label&quot;);</span>
<span class="nc" id="L249">		filePathField = userInterfaceFactory.createTextField(5);</span>
<span class="nc" id="L250">		filePathField.setEditable(false);</span>
		

<span class="nc" id="L253">		String showChangeHistoryText</span>
<span class="nc" id="L254">			= MacawMessages.getMessage(&quot;general.buttons.showChangeHistory&quot;);</span>
<span class="nc" id="L255">		showChangeHistory</span>
<span class="nc" id="L256">			= userInterfaceFactory.createButton(showChangeHistoryText);</span>
<span class="nc" id="L257">		editLabelValues</span>
<span class="nc" id="L258">			= userInterfaceFactory.createButton(&quot;&quot;);</span>

<span class="nc" id="L260">		okCancelPanel</span>
			= new OKClosePanel(userInterfaceFactory,
										 this);
<span class="nc" id="L263">		okCancelPanel.addButton(showChangeHistory);</span>
<span class="nc" id="L264">		okCancelPanel.addButton(editLabelValues);		</span>
<span class="nc" id="L265">		okCancelPanel.setAllowWriteAccess(allowWriteAccess);</span>

<span class="nc" id="L267">		save = okCancelPanel.getSaveButton();</span>
<span class="nc" id="L268">		close = okCancelPanel.getCloseButton();</span>
		
<span class="nc" id="L270">		committedChanges = false;</span>
				
<span class="nc" id="L272">		dialog = userInterfaceFactory.createDialog();</span>
	
<span class="nc" id="L274">		WindowSizeListener windowSizeListener</span>
			= new WindowSizeListener();
<span class="nc" id="L276">		dialog.addComponentListener(windowSizeListener);	</span>

<span class="nc" id="L278">		aliasFilePathChoicesField.addActionListener(this);</span>
<span class="nc" id="L279">	}</span>
	
	protected JPanel createYearFormQuestionNumberPanel() {
<span class="nc" id="L282">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L283">		GridBagConstraints panelGC</span>
<span class="nc" id="L284">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L285">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L286">		panelGC.weightx = 0.0;</span>
<span class="nc" id="L287">		panelGC.ipadx = 10;</span>
<span class="nc" id="L288">		JLabel yearLabel = userInterfaceFactory.createLabel(yearLabelText);		</span>
<span class="nc" id="L289">		panel.add(yearLabel, panelGC);</span>
<span class="nc" id="L290">		panelGC.gridx++;</span>
<span class="nc" id="L291">		panelGC.weightx = 0.3;</span>
<span class="nc" id="L292">		panel.add(yearField, panelGC);</span>
<span class="nc" id="L293">		panelGC.gridx++;</span>
<span class="nc" id="L294">		formLabelText</span>
<span class="nc" id="L295">			= MacawMessages.getMessage(&quot;rawVariableLabelEditor.form&quot;);</span>
<span class="nc" id="L296">		JLabel formLabel = userInterfaceFactory.createLabel(formLabelText);</span>
<span class="nc" id="L297">		panelGC.weightx = 0.0;</span>
<span class="nc" id="L298">		panel.add(formLabel, panelGC);</span>
<span class="nc" id="L299">		panelGC.gridx++;</span>
<span class="nc" id="L300">		panelGC.weightx = 0.3;</span>
<span class="nc" id="L301">		formField = userInterfaceFactory.createTextField(10);</span>
<span class="nc" id="L302">		formField.setEditable(allowWriteAccess);</span>
<span class="nc" id="L303">		panel.add(formField, panelGC);</span>
<span class="nc" id="L304">		panelGC.gridx++;</span>
		
<span class="nc" id="L306">		questionNumberLabelText</span>
<span class="nc" id="L307">			= MacawMessages.getMessage(&quot;rawVariableLabelEditor.questionNumber&quot;);</span>
<span class="nc" id="L308">		JLabel questionNumberLabel</span>
<span class="nc" id="L309">			= userInterfaceFactory.createLabel(questionNumberLabelText);</span>
<span class="nc" id="L310">		panelGC.weightx = 0.0;</span>
<span class="nc" id="L311">		panel.add(questionNumberLabel, panelGC);</span>
<span class="nc" id="L312">		panelGC.gridx++;</span>
<span class="nc" id="L313">		questionNumberField = userInterfaceFactory.createTextField(10);</span>
<span class="nc" id="L314">		questionNumberField.setEditable(allowWriteAccess);</span>
<span class="nc" id="L315">		panelGC.weightx = 0.3;</span>
<span class="nc" id="L316">		panel.add(questionNumberField, panelGC);</span>
		
<span class="nc" id="L318">		return panel;</span>
	}	

	
	protected JPanel createNameLabelPanel() {
<span class="nc" id="L323">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L324">		GridBagConstraints panelGC	</span>
<span class="nc" id="L325">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L326">		panelGC.ipadx = 5;</span>

<span class="nc" id="L328">		JLabel nameFieldLabel</span>
<span class="nc" id="L329">			= userInterfaceFactory.createLabel(nameLabelText);</span>
<span class="nc" id="L330">		panel.add(nameFieldLabel, panelGC);</span>
<span class="nc" id="L331">		panelGC.gridx++;</span>
<span class="nc" id="L332">		panel.add(nameField, panelGC);</span>
<span class="nc" id="L333">		panelGC.gridx++;</span>
<span class="nc" id="L334">		JLabel labelLabel</span>
<span class="nc" id="L335">			= userInterfaceFactory.createLabel(labelLabelText);</span>
<span class="nc" id="L336">		panel.add(labelLabel, panelGC);</span>
<span class="nc" id="L337">		panelGC.gridx++;</span>
<span class="nc" id="L338">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L339">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L340">		panel.add(labelField, panelGC);</span>
		
<span class="nc" id="L342">		return panel;</span>
	}

	protected JPanel createRubricCardPanel() {
<span class="nc" id="L346">		JPanel panel</span>
<span class="nc" id="L347">			= userInterfaceFactory.createPanel();</span>
<span class="nc" id="L348">		GridBagConstraints panelGC</span>
<span class="nc" id="L349">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L350">		panelGC.insets = new Insets(5, 0, 5, 0);</span>
		
<span class="nc" id="L352">		String panelTitleText</span>
<span class="nc" id="L353">			= MacawMessages.getMessage(&quot;rawVariableLabelEditor.rubricCardData.title&quot;);</span>
<span class="nc" id="L354">		JLabel panelTitleLabel </span>
<span class="nc" id="L355">			= userInterfaceFactory.createLabel(panelTitleText);</span>
<span class="nc" id="L356">		panel.add(panelTitleLabel, panelGC);</span>
<span class="nc" id="L357">		panelGC.gridy++;</span>
<span class="nc" id="L358">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L359">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L360">		panel.add(createRubricCardFields(), panelGC);</span>
<span class="nc" id="L361">		panel.setBorder(LineBorder.createGrayLineBorder());</span>
<span class="nc" id="L362">		return panel;</span>
	}
	
	protected JPanel createRubricCardFields() {
<span class="nc" id="L366">		JPanel panel</span>
<span class="nc" id="L367">			= userInterfaceFactory.createPanel();</span>
<span class="nc" id="L368">		GridBagConstraints panelGC</span>
<span class="nc" id="L369">			= userInterfaceFactory.createGridBagConstraints();</span>

		//adding code book number field
<span class="nc" id="L372">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L373">		panelGC.weightx = 0;</span>
<span class="nc" id="L374">		panelGC.gridx++;		</span>
<span class="nc" id="L375">		String codeBookNumberLabelText</span>
<span class="nc" id="L376">			= MacawMessages.getMessage(&quot;variable.codeBookNumber.label&quot;);</span>
<span class="nc" id="L377">		JLabel codeBookNumberLabel</span>
<span class="nc" id="L378">			= userInterfaceFactory.createLabel(codeBookNumberLabelText);</span>
<span class="nc" id="L379">		panel.add(codeBookNumberLabel, panelGC);</span>
<span class="nc" id="L380">		panelGC.gridx++;</span>
<span class="nc" id="L381">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L382">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L383">		codeBookNumberField = userInterfaceFactory.createTextField(20);</span>
<span class="nc" id="L384">		codeBookNumberField.setEditable(allowWriteAccess);</span>
<span class="nc" id="L385">		panel.add(codeBookNumberField, panelGC);</span>
		
		//adding column start field
<span class="nc" id="L388">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L389">		panelGC.weightx = 0;</span>
<span class="nc" id="L390">		panelGC.gridx++;</span>
<span class="nc" id="L391">		String columnStartLabelText</span>
<span class="nc" id="L392">			= MacawMessages.getMessage(&quot;variable.columnStart.label&quot;);</span>
<span class="nc" id="L393">		JLabel columnStartLabel</span>
<span class="nc" id="L394">			= userInterfaceFactory.createLabel(columnStartLabelText);</span>
<span class="nc" id="L395">		panel.add(columnStartLabel, panelGC);</span>
<span class="nc" id="L396">		panelGC.gridx++;</span>
<span class="nc" id="L397">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L398">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L399">		columnStartField </span>
<span class="nc" id="L400">			= userInterfaceFactory.createTextField(20);</span>
<span class="nc" id="L401">		columnStartField.setEditable(allowWriteAccess);</span>
<span class="nc" id="L402">		panel.add(columnStartField, panelGC);</span>
		
		//adding column end field
<span class="nc" id="L405">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L406">		panelGC.weightx = 0;</span>
<span class="nc" id="L407">		panelGC.gridx++;</span>
<span class="nc" id="L408">		String columnEndLabelText</span>
<span class="nc" id="L409">			= MacawMessages.getMessage(&quot;variable.columnEnd.label&quot;);</span>
<span class="nc" id="L410">		JLabel columnEndLabel</span>
<span class="nc" id="L411">			= userInterfaceFactory.createLabel(columnEndLabelText);</span>
<span class="nc" id="L412">		panel.add(columnEndLabel, panelGC);</span>
<span class="nc" id="L413">		panelGC.gridx++;</span>
<span class="nc" id="L414">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L415">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L416">		columnEndField</span>
<span class="nc" id="L417">			= userInterfaceFactory.createTextField(20);</span>
<span class="nc" id="L418">		columnEndField.setEditable(allowWriteAccess);</span>
<span class="nc" id="L419">		panel.add(columnEndField, panelGC);</span>
		
<span class="nc" id="L421">		return panel;</span>
	}

	protected JPanel createDataLibraryAndFilePanel() {
<span class="nc" id="L425">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L426">		GridBagConstraints panelGC	</span>
<span class="nc" id="L427">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L428">		panelGC.ipadx = 5;</span>
		
<span class="nc" id="L430">		JLabel dataLibraryLabel</span>
<span class="nc" id="L431">			= userInterfaceFactory.createLabel(aliasFilePathLabelText);</span>
<span class="nc" id="L432">		panel.add(dataLibraryLabel, panelGC);</span>
<span class="nc" id="L433">		panelGC.gridx++;</span>
<span class="nc" id="L434">		panel.add(aliasFilePathChoicesField, panelGC);</span>
<span class="nc" id="L435">		panelGC.gridx++;</span>

<span class="nc" id="L437">		panelGC.gridy++;</span>
<span class="nc" id="L438">		panelGC.gridx = 0;</span>
<span class="nc" id="L439">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L440">		panelGC.weightx = 0;</span>
<span class="nc" id="L441">		JLabel filePathLabel</span>
<span class="nc" id="L442">			= userInterfaceFactory.createLabel(filePathLabelText);</span>
<span class="nc" id="L443">		panel.add(filePathLabel, panelGC);</span>
<span class="nc" id="L444">		panelGC.gridx++;</span>
<span class="nc" id="L445">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L446">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L447">		panel.add(filePathField, panelGC);</span>
		
<span class="nc" id="L449">		return panel;</span>
	}

	protected JPanel createNotesFieldPanel() {
<span class="nc" id="L453">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L454">		GridBagConstraints panelGC	</span>
<span class="nc" id="L455">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L456">		panelGC.ipadx = 5;</span>
		
<span class="nc" id="L458">		String notesFieldText</span>
<span class="nc" id="L459">			= MacawMessages.getMessage(&quot;variable.notes.label&quot;);</span>
<span class="nc" id="L460">		JLabel notesFieldLabel</span>
<span class="nc" id="L461">			= userInterfaceFactory.createLabel(notesFieldText);</span>
<span class="nc" id="L462">		panel.add(notesFieldLabel, panelGC);</span>
		
<span class="nc" id="L464">		panelGC.gridy++;</span>
<span class="nc" id="L465">		panelGC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L466">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L467">		panelGC.weighty = 1.0;</span>
<span class="nc" id="L468">		notesField = userInterfaceFactory.createTextArea(2, 10);</span>
<span class="nc" id="L469">		JScrollPane notesScrollPane </span>
<span class="nc" id="L470">			= userInterfaceFactory.createScrollPane(notesField);</span>
<span class="nc" id="L471">		panel.add(notesScrollPane, panelGC);</span>
	
<span class="nc" id="L473">		return panel;</span>
	}
	
	protected void addField(String fieldName,
						  	JComponent editingComponent,
						  	JPanel parentPanel,
						  	GridBagConstraints parentPanelGC) {

<span class="nc" id="L481">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L482">		GridBagConstraints panelGC</span>
<span class="nc" id="L483">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L484">		panelGC.ipadx = 5;</span>
<span class="nc" id="L485">		panelGC.ipady = 5;</span>

<span class="nc" id="L487">		JLabel label = userInterfaceFactory.createLabel(fieldName);</span>
<span class="nc" id="L488">		panel.add(label, panelGC);</span>
<span class="nc" id="L489">		panelGC.gridx++;</span>
<span class="nc" id="L490">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L491">		panelGC.weightx = 100;</span>
<span class="nc" id="L492">		panel.add(editingComponent, panelGC);</span>

<span class="nc" id="L494">		parentPanel.add(panel, parentPanelGC);	</span>
<span class="nc" id="L495">	}</span>
	
	protected JPanel createIsCleanedPanel() {
<span class="nc" id="L498">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L499">		GridBagConstraints panelGC	</span>
<span class="nc" id="L500">			= userInterfaceFactory.createGridBagConstraints();</span>

<span class="nc" id="L502">		String[] cleaningStateChoices = new String[0];</span>
		try {
<span class="nc" id="L504">			ArrayList&lt;CleaningState&gt; cleaningStates</span>
<span class="nc" id="L505">				= database.getCleaningStates(currentUser);		</span>
<span class="nc" id="L506">			cleaningStateChoices</span>
<span class="nc" id="L507">				= ConstantConverter.getCleaningStatusChoices(cleaningStates);</span>
		}
<span class="nc" id="L509">		catch(MacawException exception) {</span>
<span class="nc" id="L510">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L511">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L512">		}</span>
		
<span class="nc" id="L514">		cleaningStatePanel </span>
			= new CleaningStatePanel(sessionProperties,
									 cleaningStateChoices,
									 allowWriteAccess);
<span class="nc" id="L518">		panel.add(cleaningStatePanel.getCheckBox(), panelGC);</span>

<span class="nc" id="L520">		panelGC.gridy++;</span>
<span class="nc" id="L521">		panelGC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L522">		panelGC.weightx = 100;</span>
<span class="nc" id="L523">		panelGC.weighty = 100;</span>
	
<span class="nc" id="L525">		panel.add(cleaningStatePanel.getPanel(), panelGC);</span>

<span class="nc" id="L527">		return panel;</span>
	}
	
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================
	public boolean isCancelled() {
<span class="nc" id="L534">		return committedChanges;</span>
	}
	
	public void show() {
<span class="nc" id="L538">		dialog.setVisible(true);</span>
<span class="nc" id="L539">	}</span>
	
	private void updateEditLabelValuesButton() {
		try {			
<span class="nc" id="L543">			int numberOfValues = 0;</span>
<span class="nc bnc" id="L544" title="All 2 branches missed.">			if (variable.isNewRecord() == false) {				</span>
<span class="nc" id="L545">				ArrayList&lt;ValueLabel&gt; valueLabels </span>
<span class="nc" id="L546">					= database.getValueLabels(currentUser, variable);</span>
<span class="nc" id="L547">				numberOfValues = valueLabels.size();</span>
			}

<span class="nc bnc" id="L550" title="All 2 branches missed.">			if (allowWriteAccess == true) {</span>
<span class="nc" id="L551">				String editLabelValuesText</span>
<span class="nc" id="L552">					= MacawMessages.getMessage(&quot;rawVariableLabelEditor.editLabelValues&quot;,</span>
<span class="nc" id="L553">												String.valueOf(numberOfValues));</span>
<span class="nc" id="L554">				editLabelValues.setText(editLabelValuesText);</span>
<span class="nc" id="L555">			}</span>
			else {
<span class="nc" id="L557">				String viewLabelValuesText</span>
<span class="nc" id="L558">					= MacawMessages.getMessage(&quot;rawVariableLabelEditor.viewLabelValues&quot;,</span>
<span class="nc" id="L559">												String.valueOf(numberOfValues));</span>
<span class="nc" id="L560">				editLabelValues.setText(viewLabelValuesText);</span>
			}		
		}
<span class="nc" id="L563">		catch(MacawException exception) {</span>
<span class="nc" id="L564">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L565">		}</span>
<span class="nc" id="L566">	}</span>
	
	protected void setData(Variable variable, boolean isNewRecord) {
<span class="nc" id="L569">		this.variable = variable;</span>
<span class="nc" id="L570">		ontologyTermsPanel.setData(variable);		</span>
<span class="nc" id="L571">		supportingDocumentsPanel.setData(variable);</span>
<span class="nc" id="L572">		updateEditLabelValuesButton();</span>
<span class="nc" id="L573">		alternativeVariableSelectionPanel.setData(variable);	</span>
<span class="nc" id="L574">		cleaningStatePanel.initialise(variable);</span>
<span class="nc" id="L575">	}</span>
		
	protected void saveVariableFields(Variable variable) {
<span class="nc" id="L578">		this.variable = variable;</span>
		
<span class="nc bnc" id="L580" title="All 2 branches missed.">		if (allowWriteAccess == false) {</span>
<span class="nc" id="L581">			return;</span>
		}
		
<span class="nc" id="L584">		variable.setName(nameField.getText().trim());</span>
<span class="nc" id="L585">		variable.setLabel(labelField.getText().trim());</span>
<span class="nc" id="L586">		variable.setYear(yearField.getText().trim());</span>
		
<span class="nc" id="L588">		variable.setForm(formField.getText().trim());</span>
		
<span class="nc" id="L590">		variable.setQuestionNumber(questionNumberField.getText().trim());</span>
<span class="nc" id="L591">		variable.setCategory((String) categoryChoicesField.getSelectedItem());</span>
<span class="nc" id="L592">		variable.setCoded(isCodedField.isSelected());</span>

		//save state managed by cleaning state panel
<span class="nc" id="L595">		cleaningStatePanel.save();</span>
<span class="nc" id="L596">		boolean isCleaned = cleaningStatePanel.isCleaned();</span>
<span class="nc" id="L597">		variable.setCleaned(isCleaned);</span>
<span class="nc bnc" id="L598" title="All 2 branches missed.">		if (isCleaned == false) {</span>
<span class="nc" id="L599">			variable.setCleaningStatus(&quot;&quot;);</span>
<span class="nc" id="L600">			variable.setCleaningDescription(&quot;&quot;);</span>
		} 
		else {
<span class="nc" id="L603">			variable.setCleaningStatus(cleaningStatePanel.getCleaningStatus());</span>
<span class="nc" id="L604">			variable.setCleaningDescription(cleaningStatePanel.getCleaningDescription());			</span>
		}
		
<span class="nc" id="L607">		ArrayList&lt;SupportingDocument&gt; supportingDocuments</span>
<span class="nc" id="L608">			= supportingDocumentsPanel.getSupportingDocuments();</span>
<span class="nc" id="L609">		variable.setSupportingDocuments(supportingDocuments);</span>

<span class="nc" id="L611">		String selectedAvailability</span>
<span class="nc" id="L612">			= (String) availabilityChoicesField.getSelectedItem();</span>

<span class="nc" id="L614">		variable.setAvailability((String) availabilityChoicesField.getSelectedItem());</span>
		
<span class="nc" id="L616">		variable.setCodeBookNumber(codeBookNumberField.getText().trim());</span>
<span class="nc" id="L617">		variable.setColumnStart(columnStartField.getText().trim());</span>
<span class="nc" id="L618">		variable.setColumnEnd(columnEndField.getText().trim());</span>
		
<span class="nc" id="L620">		variable.setAlias((String) aliasFilePathChoicesField.getSelectedItem());</span>
<span class="nc" id="L621">		variable.setFilePath(filePathField.getText().trim());</span>
<span class="nc" id="L622">		variable.setNotes(notesField.getText().trim());</span>
		
<span class="nc" id="L624">		Variable alternativeVariable</span>
<span class="nc" id="L625">			= alternativeVariableSelectionPanel.getAlternativeVariable();</span>
<span class="nc" id="L626">		variable.setAlternativeVariable(alternativeVariable);</span>
<span class="nc" id="L627">		alternativeVariableSelectionPanel.setData(variable);</span>
		
		//assumes that change events have already been recorded
<span class="nc" id="L630">		cleaningStatePanel.clearChanges();</span>

<span class="nc" id="L632">	}</span>
	
	protected void restoreVariableFields(Variable variable) {
<span class="nc" id="L635">		nameField.setText(variable.getName());</span>
<span class="nc" id="L636">		labelField.setText(variable.getLabel());</span>
<span class="nc" id="L637">		yearField.setText(variable.getYear());</span>
<span class="nc" id="L638">		formField.setText(variable.getForm());</span>
		
<span class="nc" id="L640">		questionNumberField.setText(variable.getQuestionNumber());</span>

<span class="nc" id="L642">		isCodedField.setSelected(variable.isCoded());</span>
<span class="nc" id="L643">		String category = variable.getCategory();</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">		if (category.equals(&quot;&quot;) == true) {</span>
<span class="nc" id="L645">			category </span>
<span class="nc" id="L646">				= MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;);</span>
		}
<span class="nc" id="L648">		categoryChoicesField.setSelectedItem(category);</span>
		
<span class="nc" id="L650">		cleaningStatePanel.restore();</span>
	
<span class="nc" id="L652">		supportingDocumentsPanel.setData(variable);</span>

<span class="nc" id="L654">		String availability = variable.getAvailability();</span>

<span class="nc bnc" id="L656" title="All 2 branches missed.">		if (availability.equals(&quot;&quot;) == true) {</span>
<span class="nc" id="L657">			availability </span>
<span class="nc" id="L658">				= MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;);</span>
		}
<span class="nc" id="L660">		availabilityChoicesField.setSelectedItem(availability);</span>

<span class="nc" id="L662">		String alias</span>
<span class="nc" id="L663">			= variable.getAlias();</span>
<span class="nc bnc" id="L664" title="All 2 branches missed.">		if (alias.equals(&quot;&quot;) == true) {</span>
<span class="nc" id="L665">			alias</span>
<span class="nc" id="L666">				= MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;);</span>
		}		
<span class="nc" id="L668">		aliasFilePathChoicesField.setSelectedItem(alias);</span>

<span class="nc" id="L670">		updateFilePath();</span>
		
<span class="nc" id="L672">		codeBookNumberField.setText(variable.getCodeBookNumber());</span>
<span class="nc" id="L673">		columnStartField.setText(variable.getColumnStart());</span>
<span class="nc" id="L674">		columnEndField.setText(variable.getColumnEnd());	</span>
		
<span class="nc" id="L676">		notesField.setText(variable.getNotes());</span>
<span class="nc" id="L677">		alternativeVariableSelectionPanel.setData(variable);</span>
<span class="nc" id="L678">	}</span>
	
	protected void close() {
<span class="nc" id="L681">		dialog.setVisible(false);</span>
<span class="nc" id="L682">	}</span>
	
	protected void editLabelValues() {
		try {			
<span class="nc" id="L686">			VariableLabelValueEditor variableLabelValueEditor</span>
				= new VariableLabelValueEditor(sessionProperties,
											   allowWriteAccess);
<span class="nc" id="L689">			variableLabelValueEditor.setData(variable);</span>
<span class="nc" id="L690">			variableLabelValueEditor.show();</span>
	
<span class="nc" id="L692">			updateEditLabelValuesButton();	</span>
		}
<span class="nc" id="L694">		catch(MacawException exception) {</span>
<span class="nc" id="L695">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L696">		}</span>

<span class="nc" id="L698">	}</span>
		
	protected void showChangeHistory() {
		try {
<span class="nc" id="L702">			ChangeHistoryViewer changeHistoryViewer</span>
				= new ChangeHistoryViewer(sessionProperties);
<span class="nc" id="L704">			changeHistoryViewer.showHistoryForVariable(variable);</span>
		}
<span class="nc" id="L706">		catch(MacawException exception) {</span>
<span class="nc" id="L707">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L708">		}</span>
<span class="nc" id="L709">	}</span>
	
	abstract public Displayable getData();
	
	
	protected void updateFilePath() {
		try {
<span class="nc" id="L716">			String currentAlias</span>
<span class="nc" id="L717">				= (String) aliasFilePathChoicesField.getSelectedItem();</span>

<span class="nc" id="L719">			String filePath</span>
<span class="nc" id="L720">				= database.getFilePathFromAlias(currentUser, currentAlias);</span>
<span class="nc" id="L721">			filePathField.setText(filePath);</span>
		}
<span class="nc" id="L723">		catch(MacawException exception) {</span>
<span class="nc" id="L724">			log.logException(exception);</span>
<span class="nc" id="L725">		}</span>
<span class="nc" id="L726">	}</span>
	
	protected void updateValueLabelsButtonState(Variable rawVariable) {
<span class="nc bnc" id="L729" title="All 2 branches missed.">		if (rawVariable.isNewRecord() == true) {</span>
<span class="nc" id="L730">			editLabelValues.setEnabled(false);</span>
		}
		else {
<span class="nc" id="L733">			editLabelValues.setEnabled(true);</span>
		}
<span class="nc" id="L735">	}</span>
	
	// ==========================================
	// Section Errors and Validation
	// ==========================================
	
	// ==========================================
	// Section Interfaces
	// ==========================================
	abstract public void actionPerformed(ActionEvent event);
	abstract public void commitChanges() throws MacawException;
	
	// ==========================================
	// Section Overload
	// ==========================================

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>