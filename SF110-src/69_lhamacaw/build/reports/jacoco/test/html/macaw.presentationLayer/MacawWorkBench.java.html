<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MacawWorkBench.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.presentationLayer</a> &gt; <span class="el_source">MacawWorkBench.java</span></div><h1>MacawWorkBench.java</h1><pre class="source lang-java linenums">package macaw.presentationLayer;


import macaw.persistenceLayer.demo.DemonstrationCurationService;
import macaw.persistenceLayer.demo.DemonstrationRetrievalService;
import macaw.persistenceLayer.production.ProductionCurationService;
import macaw.persistenceLayer.production.ProductionRetrievalService;
import macaw.system.SessionProperties;
import macaw.system.StartupOptions;
import macaw.system.UserInterfaceFactory;
import macaw.system.MacawMessages;
import macaw.businessLayer.User;
import macaw.io.ExportVariablesToMacawXML;


import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.*;
import java.awt.*;
import javax.swing.border.LineBorder;

/**
 * &lt;p&gt;&lt;/p&gt;
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

public class MacawWorkBench implements ActionListener {

	public static void main(String[] arguments) {

<span class="fc" id="L66">		String dbUser = null;</span>
<span class="fc" id="L67">		String dbPassword = null;</span>
		try {
			
<span class="fc" id="L70">			SessionProperties sessionProperties = new SessionProperties();</span>
<span class="fc" id="L71">			StartupOptions startupOptions</span>
<span class="fc" id="L72">				= (StartupOptions) sessionProperties.getProperty(SessionProperties.STARTUP_OPTIONS);			</span>
<span class="fc" id="L73">			startupOptions.processCommandLineArguments(arguments);</span>

			/*
			if (dbUser != null) {
				sessionProperties.setProperty(SessionProperties.DB_USER, dbUser);
				sessionProperties.setProperty(SessionProperties.DB_PASSWORD, dbPassword);
			}
			*/
			
<span class="fc" id="L82">			User currentUser = new User(&quot;jsmith&quot;, &quot;cool&quot;);		</span>
<span class="fc" id="L83">			sessionProperties.setProperty(SessionProperties.CURRENT_USER, currentUser);</span>
		
<span class="fc bfc" id="L85" title="All 2 branches covered.">			if (startupOptions.useDemo() == true) {</span>
<span class="fc" id="L86">				DemonstrationCurationService database = new DemonstrationCurationService(false);</span>
<span class="fc" id="L87">				DemonstrationRetrievalService demonstratinRetrievalService</span>
					= new DemonstrationRetrievalService(sessionProperties);
<span class="fc" id="L89">				sessionProperties.setProperty(SessionProperties.RETRIEVAL_SERVICE,</span>
											  demonstratinRetrievalService);
<span class="fc" id="L91">				sessionProperties.setProperty(SessionProperties.DATABASE, database);</span>
<span class="fc" id="L92">			}</span>
			else {
<span class="fc" id="L94">				ProductionCurationService database = new ProductionCurationService(sessionProperties);</span>
<span class="fc" id="L95">				ProductionRetrievalService macawRetrievalAPI</span>
					= new ProductionRetrievalService(sessionProperties);	
<span class="fc" id="L97">				sessionProperties.setProperty(SessionProperties.RETRIEVAL_SERVICE,</span>
				  		  macawRetrievalAPI);
<span class="fc" id="L99">				sessionProperties.setProperty(SessionProperties.DATABASE, database);				</span>
			}
			
<span class="fc" id="L102">			int numberOfAttempts = 0;</span>
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">			for (numberOfAttempts = 0; numberOfAttempts &lt; 3; numberOfAttempts++) {			</span>
<span class="nc" id="L104">				LoginDialog loginDialog </span>
					= new LoginDialog(sessionProperties,
									  numberOfAttempts);
<span class="nc" id="L107">				loginDialog.show();</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">				if (loginDialog.isLoginSuccessful() == true) {</span>
<span class="nc" id="L109">					break;</span>
				}
<span class="nc bnc" id="L111" title="All 2 branches missed.">				else if (loginDialog.isCancelled() == true) {</span>
<span class="nc" id="L112">					System.exit(0);</span>
				}
			}
		
<span class="nc bnc" id="L116" title="All 2 branches missed.">			if (numberOfAttempts == LoginDialog.MAXIMUM_ATTEMPTS) {</span>
<span class="nc" id="L117">				System.exit(0);</span>
			}

<span class="nc" id="L120">			MacawWorkBench macawWorkBench </span>
				= new MacawWorkBench(sessionProperties);
<span class="nc" id="L122">			macawWorkBench.show();</span>
		}
<span class="fc" id="L124">		catch(Exception exception) {</span>
<span class="fc" id="L125">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L126">		}</span>
<span class="fc" id="L127">	}</span>

	
	
	
	// ==========================================
	// Section Constants
	// ==========================================

	// ==========================================
	// Section Properties
	// ==========================================
	private SessionProperties sessionProperties;
	
	private JDialog dialog;
	private JButton editConstants;
	private JButton editVariables;
	private JButton exportVariableData;
	private JButton exit;
	
	// ==========================================
	// Section Construction
	// ==========================================
<span class="fc" id="L150">	public MacawWorkBench(SessionProperties sessionProperties) {</span>
<span class="fc" id="L151">		this.sessionProperties = sessionProperties;</span>
<span class="fc" id="L152">		UserInterfaceFactory userInterfaceFactory</span>
<span class="fc" id="L153">			= sessionProperties.getUserInterfaceFactory();</span>
<span class="nc" id="L154">		dialog = userInterfaceFactory.createDialog();</span>
<span class="nc" id="L155">		String dialogTitle</span>
<span class="nc" id="L156">			= MacawMessages.getMessage(&quot;macawWorkBench.title&quot;);</span>
<span class="nc" id="L157">		dialog.setTitle(dialogTitle);</span>
		
<span class="nc" id="L159">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L160">		GridBagConstraints panelGC </span>
<span class="nc" id="L161">			= userInterfaceFactory.createGridBagConstraints();</span>

<span class="nc" id="L163">		panelGC.anchor = GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L164">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L165">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L166">		JTextArea instructionsArea</span>
<span class="nc" id="L167">			= userInterfaceFactory.createImmutableTextArea(3, 20);</span>
<span class="nc" id="L168">		String instructionsText</span>
<span class="nc" id="L169">			= MacawMessages.getMessage(&quot;macawWorkBench.instructions&quot;);</span>
<span class="nc" id="L170">		instructionsArea.setText(instructionsText);</span>
<span class="nc" id="L171">		instructionsArea.setBorder(LineBorder.createGrayLineBorder());</span>
<span class="nc" id="L172">		panel.add(instructionsArea, panelGC);</span>
		
<span class="nc" id="L174">		panelGC.gridy++;</span>
<span class="nc" id="L175">		panelGC.anchor = GridBagConstraints.CENTER;</span>
<span class="nc" id="L176">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L177">		panelGC.weightx = 0;</span>
<span class="nc" id="L178">		panel.add(createButtonPanel(userInterfaceFactory), </span>
				  panelGC);
		
<span class="nc" id="L181">		dialog.getContentPane().add(panel);</span>
<span class="nc" id="L182">		dialog.setModal(true);</span>
<span class="nc" id="L183">		dialog.setSize(300, 300);</span>
<span class="nc" id="L184">	}</span>
	
	private JPanel createButtonPanel(UserInterfaceFactory userInterfaceFactory) {
<span class="nc" id="L187">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L188">		GridBagConstraints panelGC </span>
<span class="nc" id="L189">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L190">		panelGC.ipady = 10;</span>
<span class="nc" id="L191">		panelGC.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L192">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L193">		panelGC.weightx = 1.0;</span>
		
<span class="nc" id="L195">		String editConstantsText</span>
<span class="nc" id="L196">			= MacawMessages.getMessage(&quot;macawWorkBench.editConstants&quot;);</span>
<span class="nc" id="L197">		editConstants = userInterfaceFactory.createButton(editConstantsText);</span>
<span class="nc" id="L198">		String editConstantsInformationText</span>
<span class="nc" id="L199">			= MacawMessages.getMessage(&quot;macawWorkBench.editConstants.instructions&quot;);</span>
<span class="nc" id="L200">		editConstants.setToolTipText(editConstantsInformationText);		</span>
<span class="nc" id="L201">		editConstants.addActionListener(this);</span>
<span class="nc" id="L202">		panel.add(editConstants, panelGC);</span>
		
<span class="nc" id="L204">		panelGC.gridy++;</span>
<span class="nc" id="L205">		String editVariablesText</span>
<span class="nc" id="L206">			= MacawMessages.getMessage(&quot;macawWorkBench.editVariables&quot;);		</span>
<span class="nc" id="L207">		editVariables = userInterfaceFactory.createButton(editVariablesText);</span>
<span class="nc" id="L208">		editVariables.addActionListener(this);</span>
<span class="nc" id="L209">		String editVariablesInformationText</span>
<span class="nc" id="L210">			= MacawMessages.getMessage(&quot;macawWorkBench.editVariables.instructions&quot;);</span>
<span class="nc" id="L211">		editVariables.setToolTipText(editVariablesInformationText);</span>
<span class="nc" id="L212">		panel.add(editVariables, panelGC);</span>
		
<span class="nc" id="L214">		panelGC.gridy++;</span>
<span class="nc" id="L215">		String exportVariableText</span>
<span class="nc" id="L216">			= MacawMessages.getMessage(&quot;macawWorkBench.exportVariableData&quot;);</span>
<span class="nc" id="L217">		exportVariableData </span>
<span class="nc" id="L218">			= userInterfaceFactory.createButton(exportVariableText);</span>
<span class="nc" id="L219">		exportVariableData.addActionListener(this);</span>
<span class="nc" id="L220">		String exportVariableInformationText</span>
<span class="nc" id="L221">			= MacawMessages.getMessage(&quot;macawWorkBench.exportVariableData.instructions&quot;);</span>
<span class="nc" id="L222">		exportVariableData.setToolTipText(exportVariableInformationText);</span>
<span class="nc" id="L223">		panel.add(exportVariableData, panelGC);</span>
		
<span class="nc" id="L225">		panelGC.gridy++;</span>
<span class="nc" id="L226">		String exitText</span>
<span class="nc" id="L227">			= MacawMessages.getMessage(&quot;general.buttons.exit&quot;);</span>
<span class="nc" id="L228">		exit = userInterfaceFactory.createButton(exitText);</span>
<span class="nc" id="L229">		exit.addActionListener(this);</span>
<span class="nc" id="L230">		panel.add(exit, panelGC);</span>
		
<span class="nc" id="L232">		return panel;</span>
	}
	
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================

	public void show() {
<span class="nc" id="L240">		dialog.setVisible(true);</span>
<span class="nc" id="L241">	}</span>
	
	private void editConstants() {
<span class="nc" id="L244">		VariableConstantsEditor variableConstantsEditor</span>
			= new VariableConstantsEditor(sessionProperties, true);
<span class="nc" id="L246">		variableConstantsEditor.show();</span>
<span class="nc" id="L247">	}</span>
	
	private void editVariables() {
<span class="nc" id="L250">		MacawVariableBrowser macawVariableBrowser </span>
			= new MacawVariableBrowser(sessionProperties);
<span class="nc" id="L252">		macawVariableBrowser.show();</span>
<span class="nc" id="L253">	}</span>
	
	private void exportVariableData() {
		/*
		ExportVariablesToMacawXML exportVariablesToMacawXML
			= new ExportVariablesToMacawXML(sessionProperties);
		exportVariablesToMacawXML.exportVariablesToMacawXMLFormat();
		*/
<span class="nc" id="L261">		ExportVariablesToMacawXML exportToDSSFormat</span>
			= new ExportVariablesToMacawXML(sessionProperties);
<span class="nc" id="L263">		exportToDSSFormat.export();</span>
<span class="nc" id="L264">	}</span>
	
	private void exit() {
<span class="nc" id="L267">		System.exit(0);</span>
<span class="nc" id="L268">	}</span>
	
	
	// ==========================================
	// Section Errors and Validation
	// ==========================================

	// ==========================================
	// Section Interfaces
	// ==========================================

	//Interface: ActionListener
	public void actionPerformed(ActionEvent event) {
<span class="nc" id="L281">		Object button = event.getSource();</span>
		
<span class="nc bnc" id="L283" title="All 2 branches missed.">		if (button == editConstants) {</span>
<span class="nc" id="L284">			editConstants();</span>
		}
<span class="nc bnc" id="L286" title="All 2 branches missed.">		else if (button == editVariables) {</span>
<span class="nc" id="L287">			editVariables();</span>
		}
<span class="nc bnc" id="L289" title="All 2 branches missed.">		else if (button == exportVariableData) {</span>
<span class="nc" id="L290">			exportVariableData();</span>
		}
		else {
<span class="nc" id="L293">			exit();</span>
		}
<span class="nc" id="L295">	}</span>

	// ==========================================
	// Section Overload
	// ==========================================

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>