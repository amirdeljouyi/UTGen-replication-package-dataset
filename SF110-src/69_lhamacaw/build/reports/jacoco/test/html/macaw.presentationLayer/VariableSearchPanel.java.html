<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VariableSearchPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.presentationLayer</a> &gt; <span class="el_source">VariableSearchPanel.java</span></div><h1>VariableSearchPanel.java</h1><pre class="source lang-java linenums">package macaw.presentationLayer;

import macaw.system.*;
import macaw.businessLayer.*;


import javax.swing.*;
import javax.swing.table.JTableHeader;
import javax.swing.event.*;

import java.awt.*;
import javax.swing.border.LineBorder;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;

/**
 * &lt;p&gt;&lt;/p&gt;
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

public class VariableSearchPanel implements ActionListener, 
									ListSelectionListener,
									TableModelListener {

	// ==========================================
	// Section Constants
	// ==========================================

	// ==========================================
	// Section Properties
	// ==========================================
	private SessionProperties sessionProperties;
	private MacawCurationAPI database;
	private User currentUser;
	private UserInterfaceFactory userInterfaceFactory;
	
	private JPanel panel;

	private String allChoicesText;
	private VariableSearchTableModel variableSearchTableModel;
	private JTable searchTable;
	
	private JTextField searchField;
	private JRadioButton filterByRawVariables;
	private JRadioButton filterByDerivedVariables;
	private JRadioButton showRawAndDerivedVariables;
	
	private JComboBox filterByCategory;
	private JComboBox filterByYear;
	
	private JButton applySearch;
	private JButton reset;
	
	private ChangeListener changeListener;
	
	// ==========================================
	// Section Construction
	// ==========================================
<span class="nc" id="L95">	public VariableSearchPanel(SessionProperties sessionProperties) {</span>
<span class="nc" id="L96">		this.sessionProperties = sessionProperties;</span>
<span class="nc" id="L97">		userInterfaceFactory = sessionProperties.getUserInterfaceFactory();</span>
<span class="nc" id="L98">		database = (MacawCurationAPI) sessionProperties.getProperty(SessionProperties.DATABASE);</span>
<span class="nc" id="L99">		currentUser = (User) sessionProperties.getProperty(SessionProperties.CURRENT_USER);</span>
		
<span class="nc" id="L101">		allChoicesText</span>
<span class="nc" id="L102">			= MacawMessages.getMessage(&quot;general.fieldValue.allChoices&quot;);</span>
<span class="nc" id="L103">		panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L104">		GridBagConstraints panelGC = userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L105">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L106">		panelGC.weightx = 1.0;</span>
		
<span class="nc" id="L108">		panelGC.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L109">		JPanel filterCriteriaPanel </span>
<span class="nc" id="L110">			= createFilterCriteriaPanel();</span>
<span class="nc" id="L111">		filterCriteriaPanel.setBorder(LineBorder.createGrayLineBorder());</span>
<span class="nc" id="L112">		panel.add(filterCriteriaPanel, panelGC);</span>

<span class="nc" id="L114">		panelGC.gridy++;		</span>
<span class="nc" id="L115">		panelGC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L116">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L117">		panelGC.weighty = 1.0;</span>
<span class="nc" id="L118">		panel.add(createResultPanel(), panelGC);		</span>
<span class="nc" id="L119">	}</span>
	
	private JPanel createResultPanel() {
<span class="nc" id="L122">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L123">		GridBagConstraints panelGC</span>
<span class="nc" id="L124">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L125">		panelGC.insets = new Insets(2, 2, 2, 2);		</span>

<span class="nc" id="L127">		String searchResultsTitleLabelText</span>
<span class="nc" id="L128">			= MacawMessages.getMessage(&quot;general.labels.searchResults&quot;);</span>
<span class="nc" id="L129">		JLabel searchResultsTitleLabel</span>
<span class="nc" id="L130">			= userInterfaceFactory.createLabel(searchResultsTitleLabelText);</span>
<span class="nc" id="L131">		panel.add(searchResultsTitleLabel, panelGC);</span>
		
<span class="nc" id="L133">		panelGC.gridy++;</span>
<span class="nc" id="L134">		panelGC.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L135">		panelGC.weightx = 100;</span>
<span class="nc" id="L136">		panelGC.weighty = 100;</span>

<span class="nc" id="L138">		variableSearchTableModel</span>
			= new VariableSearchTableModel(database);
<span class="nc" id="L140">		searchTable = userInterfaceFactory.createTable(variableSearchTableModel);		</span>
<span class="nc" id="L141">		JTableHeader header = searchTable.getTableHeader();</span>
<span class="nc" id="L142">		header.setReorderingAllowed(false);				</span>
<span class="nc" id="L143">		JScrollPane filterPane </span>
<span class="nc" id="L144">			= userInterfaceFactory.createScrollPane(searchTable);</span>
		
<span class="nc" id="L146">		ListSelectionModel listSelectionModel</span>
<span class="nc" id="L147">			= searchTable.getSelectionModel();</span>
<span class="nc" id="L148">		listSelectionModel.addListSelectionListener(this);</span>
<span class="nc" id="L149">		variableSearchTableModel.addTableModelListener(this);</span>
		
<span class="nc" id="L151">		panel.add(filterPane, panelGC);</span>
				
		try {
<span class="nc" id="L154">			variableSearchTableModel.showAllVariableSummaries(currentUser);			</span>
		}
<span class="nc" id="L156">		catch(MacawException exception) {</span>
<span class="nc" id="L157">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L158">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L159">		}		</span>
		
<span class="nc" id="L161">		return panel;</span>
	}
	
	private JPanel createFilterCriteriaPanel() {
<span class="nc" id="L165">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L166">		GridBagConstraints panelGC</span>
<span class="nc" id="L167">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L168">		panelGC.insets = new Insets(2, 2, 2, 2);		</span>
<span class="nc" id="L169">		panelGC.ipadx = 5;</span>
<span class="nc" id="L170">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L171">		panelGC.weightx = 1.0;</span>
		
<span class="nc" id="L173">		panel.add(createSearchFieldFilterPanel(), panelGC);</span>
<span class="nc" id="L174">		panelGC.gridy++;</span>
<span class="nc" id="L175">		panel.add(createYearAndCategoryFieldFilterPanel(), panelGC);</span>
<span class="nc" id="L176">		panelGC.gridy++;</span>
<span class="nc" id="L177">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L178">		panelGC.weightx = 0.0;</span>

<span class="nc" id="L180">		panel.add(createVariableTypeFilterPanel(), panelGC);</span>
		
<span class="nc" id="L182">		panelGC.gridy++;</span>
<span class="nc" id="L183">		panelGC.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L184">		panelGC.weightx = 0;</span>
<span class="nc" id="L185">		panelGC.weighty = 0;</span>
<span class="nc" id="L186">		panelGC.anchor = GridBagConstraints.SOUTHEAST;</span>
<span class="nc" id="L187">		panel.add(createButtonPanel(), panelGC);</span>
<span class="nc" id="L188">		return panel;</span>
	}

	private JPanel createButtonPanel() {
<span class="nc" id="L192">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L193">		GridBagConstraints panelGC</span>
<span class="nc" id="L194">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L195">		panelGC.insets = new Insets(2, 2, 2, 2);</span>
<span class="nc" id="L196">		panelGC.anchor = GridBagConstraints.SOUTHEAST;</span>
		
<span class="nc" id="L198">		String searchLabelText</span>
<span class="nc" id="L199">			= MacawMessages.getMessage(&quot;general.labels.search&quot;);</span>
<span class="nc" id="L200">		applySearch</span>
<span class="nc" id="L201">			= userInterfaceFactory.createButton(searchLabelText);</span>
<span class="nc" id="L202">		applySearch.addActionListener(this);</span>
<span class="nc" id="L203">		panel.add(applySearch, panelGC);</span>
		
<span class="nc" id="L205">		panelGC.gridx++;</span>
<span class="nc" id="L206">		String resetLabelText</span>
<span class="nc" id="L207">			= MacawMessages.getMessage(&quot;general.buttons.reset&quot;);		</span>
<span class="nc" id="L208">		reset</span>
<span class="nc" id="L209">			= userInterfaceFactory.createButton(resetLabelText);</span>
<span class="nc" id="L210">		reset.addActionListener(this);</span>
<span class="nc" id="L211">		panel.add(reset, panelGC);</span>
		
<span class="nc" id="L213">		return panel;</span>
	}

	private JPanel createSearchFieldFilterPanel() {
<span class="nc" id="L217">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L218">		GridBagConstraints panelGC</span>
<span class="nc" id="L219">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L220">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L221">		panelGC.ipadx = 5;</span>

<span class="nc" id="L223">		String searchFieldLabelText</span>
<span class="nc" id="L224">			= MacawMessages.getMessage(&quot;general.labels.searchPhrase&quot;);</span>
<span class="nc" id="L225">		JLabel searchFieldLabel</span>
<span class="nc" id="L226">			= userInterfaceFactory.createLabel(searchFieldLabelText);</span>
<span class="nc" id="L227">		panel.add(searchFieldLabel, panelGC);		</span>

<span class="nc" id="L229">		panelGC.gridx++;</span>
<span class="nc" id="L230">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L231">		searchField = userInterfaceFactory.createTextField(40);		</span>
<span class="nc" id="L232">		panel.add(searchField, panelGC);</span>

<span class="nc" id="L234">		return panel;</span>
	}
	
	private JPanel createVariableTypeFilterPanel() {
<span class="nc" id="L238">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L239">		GridBagConstraints panelGC</span>
<span class="nc" id="L240">			= userInterfaceFactory.createGridBagConstraints();</span>
<span class="nc" id="L241">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L242">		panelGC.ipadx = 5;</span>

<span class="nc" id="L244">		ButtonGroup buttonGroup = new ButtonGroup();</span>
<span class="nc" id="L245">		String filterbyTypeLabelText</span>
<span class="nc" id="L246">			= MacawMessages.getMessage(&quot;variableSearchPanel.variableType&quot;);</span>
<span class="nc" id="L247">		JLabel filterByTypeLabel</span>
<span class="nc" id="L248">			= userInterfaceFactory.createLabel(filterbyTypeLabelText);</span>
<span class="nc" id="L249">		panel.add(filterByTypeLabel, panelGC);</span>
<span class="nc" id="L250">		panelGC.gridx++;</span>
<span class="nc" id="L251">		String filterByRawVariablesText</span>
<span class="nc" id="L252">			= MacawMessages.getMessage(&quot;variableSearchPanel.rawVariables&quot;);</span>
<span class="nc" id="L253">		filterByRawVariables </span>
<span class="nc" id="L254">			= userInterfaceFactory.createRadioButton(filterByRawVariablesText);</span>
<span class="nc" id="L255">		buttonGroup.add(filterByRawVariables);</span>
<span class="nc" id="L256">		panel.add(filterByRawVariables, panelGC);</span>
<span class="nc" id="L257">		panelGC.gridx++;</span>
<span class="nc" id="L258">		String filterByDerivedVariablesText</span>
<span class="nc" id="L259">			= MacawMessages.getMessage(&quot;variableSearchPanel.derivedVariables&quot;);</span>
<span class="nc" id="L260">		filterByDerivedVariables </span>
<span class="nc" id="L261">			= userInterfaceFactory.createRadioButton(filterByDerivedVariablesText);</span>
<span class="nc" id="L262">		buttonGroup.add(filterByDerivedVariables);</span>
<span class="nc" id="L263">		panel.add(filterByDerivedVariables, panelGC);	</span>
		
<span class="nc" id="L265">		panelGC.gridx++;</span>
<span class="nc" id="L266">		String showRawAndDerivedVariablesText</span>
<span class="nc" id="L267">			= MacawMessages.getMessage(&quot;variableSearchPanel.rawAndDerivedVariables&quot;);</span>
<span class="nc" id="L268">		showRawAndDerivedVariables</span>
<span class="nc" id="L269">			= userInterfaceFactory.createRadioButton(showRawAndDerivedVariablesText);</span>
<span class="nc" id="L270">		buttonGroup.add(showRawAndDerivedVariables);</span>
<span class="nc" id="L271">		panel.add(showRawAndDerivedVariables, panelGC);	</span>
		
<span class="nc" id="L273">		showRawAndDerivedVariables.setSelected(true);</span>
		
<span class="nc" id="L275">		filterByRawVariables.addActionListener(this);</span>
<span class="nc" id="L276">		filterByDerivedVariables.addActionListener(this);</span>
<span class="nc" id="L277">		showRawAndDerivedVariables.addActionListener(this);		</span>
		
<span class="nc" id="L279">		return panel;</span>
	}

	private JPanel createYearAndCategoryFieldFilterPanel() {
<span class="nc" id="L283">		JPanel panel = userInterfaceFactory.createPanel();</span>
<span class="nc" id="L284">		GridBagConstraints panelGC</span>
<span class="nc" id="L285">			= userInterfaceFactory.createGridBagConstraints();	</span>
<span class="nc" id="L286">		panelGC.ipadx = 5;</span>
		
<span class="nc" id="L288">		panelGC.gridy++;</span>
<span class="nc" id="L289">		panelGC.gridx = 0;</span>
<span class="nc" id="L290">		panelGC.weightx = 0;</span>
<span class="nc" id="L291">		String yearFieldLabelText</span>
<span class="nc" id="L292">			= MacawMessages.getMessage(&quot;general.fields.year&quot;);</span>
<span class="nc" id="L293">		JLabel yearFieldLabel = userInterfaceFactory.createLabel(yearFieldLabelText);</span>
<span class="nc" id="L294">		panel.add(yearFieldLabel, panelGC);</span>
<span class="nc" id="L295">		panelGC.gridx++;</span>
<span class="nc" id="L296">		String[] availableYears = getYearChoices();</span>
<span class="nc" id="L297">		filterByYear = userInterfaceFactory.createComboBox(availableYears);</span>
<span class="nc" id="L298">		panel.add(filterByYear, panelGC);</span>
		
		//add the filter by category criteria
<span class="nc" id="L301">		panelGC.gridx++;</span>
<span class="nc" id="L302">		String categoryLabelText</span>
<span class="nc" id="L303">			= MacawMessages.getMessage(&quot;general.fields.category&quot;);</span>
<span class="nc" id="L304">		JLabel categoryLabel</span>
<span class="nc" id="L305">			= userInterfaceFactory.createLabel(categoryLabelText);</span>
<span class="nc" id="L306">		panel.add(categoryLabel, panelGC);</span>
<span class="nc" id="L307">		panelGC.gridx++;</span>
<span class="nc" id="L308">		panelGC.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L309">		panelGC.weightx = 1.0;</span>
<span class="nc" id="L310">		String[] categoryChoices = new String[0];</span>
		try {
<span class="nc" id="L312">			ArrayList&lt;Category&gt; categories </span>
<span class="nc" id="L313">				= database.getCategories(currentUser);</span>
			//here, insert the category key word &quot;All&quot;
<span class="nc" id="L315">			String allText</span>
<span class="nc" id="L316">				= MacawMessages.getMessage(&quot;general.fieldValue.allChoices&quot;);</span>
<span class="nc" id="L317">			Category allCategories = new Category(allText);</span>
<span class="nc" id="L318">			categories.add(0, allCategories);</span>
<span class="nc" id="L319">			categoryChoices </span>
<span class="nc" id="L320">				= ConstantConverter.getCategoryChoices(categories);</span>
		}
<span class="nc" id="L322">		catch(MacawException exception) {</span>
<span class="nc" id="L323">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L324">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L325">		}	</span>
<span class="nc" id="L326">		filterByCategory</span>
<span class="nc" id="L327">			= userInterfaceFactory.createComboBox(categoryChoices);</span>
<span class="nc" id="L328">		panel.add(filterByCategory, panelGC);</span>
		
<span class="nc" id="L330">		return panel;</span>
	}

	private String[] getYearChoices() {
		try {
<span class="nc" id="L335">			String[] years </span>
<span class="nc" id="L336">				= database.getStudyYears(currentUser);</span>
<span class="nc" id="L337">			String[] results = new String[years.length + 1];</span>
	
			//add the &quot;All&quot; choice to allow all choices to be selected
<span class="nc" id="L340">			results[0] = allChoicesText;</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">			for (int i = 1; i &lt; results.length; i++) {</span>
<span class="nc" id="L342">				results[i] = years[i - 1];</span>
			}
<span class="nc" id="L344">			return results;		</span>
		}
<span class="nc" id="L346">		catch(MacawException exception) {</span>
<span class="nc" id="L347">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L348">			log.displayErrorDialog(exception);</span>
		}

<span class="nc" id="L351">		return(new String[0]);</span>
	}
			
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================

	
	public void deleteSelectedItems() throws MacawException {
<span class="nc" id="L360">		ArrayList&lt;RawVariable&gt; selectedRawVariables </span>
			= new ArrayList&lt;RawVariable&gt;();
<span class="nc" id="L362">		ArrayList&lt;DerivedVariable&gt; selectedDerivedVariables </span>
			= new ArrayList&lt;DerivedVariable&gt;();
<span class="nc" id="L364">		int[] selectedRowIndices</span>
<span class="nc" id="L365">			= searchTable.getSelectedRows();</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">		for (int i = 0; i &lt; selectedRowIndices.length; i++) {</span>
<span class="nc" id="L367">			VariableSummary variableSummary</span>
<span class="nc" id="L368">				= variableSearchTableModel.getVariableSummary(selectedRowIndices[i]);</span>
<span class="nc" id="L369">			Variable selectedVariable</span>
<span class="nc" id="L370">				= database.getCompleteVariableData(currentUser,</span>
												   variableSummary);
<span class="nc bnc" id="L372" title="All 2 branches missed.">			if (selectedVariable instanceof RawVariable) {</span>
<span class="nc" id="L373">				selectedRawVariables.add((RawVariable) selectedVariable);</span>
			}
			else {
<span class="nc" id="L376">				selectedDerivedVariables.add((DerivedVariable) selectedVariable);				</span>
			}
		}	
		
<span class="nc" id="L380">		database.deleteRawVariables(currentUser, selectedRawVariables);</span>
<span class="nc" id="L381">		database.deleteDerivedVariables(currentUser, selectedDerivedVariables);	</span>
<span class="nc" id="L382">		searchTable.clearSelection();</span>
<span class="nc" id="L383">	}</span>
	
	public JPanel getPanel() {
<span class="nc" id="L386">		return panel;</span>
	}
	
	public ArrayList&lt;Variable&gt; getSelectedVariables() throws MacawException {
<span class="nc" id="L390">		ArrayList&lt;Variable&gt; selectedVariables = new ArrayList&lt;Variable&gt;();</span>
<span class="nc" id="L391">		int[] selectedRowIndices</span>
<span class="nc" id="L392">			= searchTable.getSelectedRows();</span>
<span class="nc bnc" id="L393" title="All 2 branches missed.">		for (int i = 0; i &lt; selectedRowIndices.length; i++) {</span>
<span class="nc" id="L394">			VariableSummary variableSummary</span>
<span class="nc" id="L395">				= variableSearchTableModel.getVariableSummary(selectedRowIndices[i]);</span>
<span class="nc" id="L396">			Variable variable </span>
<span class="nc" id="L397">				= database.getCompleteVariableData(currentUser,</span>
												   variableSummary);
<span class="nc" id="L399">			selectedVariables.add(variable);</span>
		}
		
		//XXXX convert summaries into real values
		
<span class="nc" id="L404">		return selectedVariables;</span>
	}
	
	
	
	public Variable getSelectedVariable() throws MacawException {
<span class="nc" id="L410">		int selectedIndex</span>
<span class="nc" id="L411">			= searchTable.getSelectedRow();</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">		if (selectedIndex == -1) {</span>
<span class="nc" id="L413">			return null;</span>
		}
		else {
<span class="nc" id="L416">			VariableSummary variableSummary</span>
<span class="nc" id="L417">				= variableSearchTableModel.getVariableSummary(selectedIndex);</span>
<span class="nc" id="L418">			Variable variable </span>
<span class="nc" id="L419">				= database.getCompleteVariableData(currentUser,</span>
												   variableSummary);
<span class="nc" id="L421">			return variable;</span>
		}
	}
	
	public void applySearch() {
<span class="nc" id="L426">		String searchPhrase</span>
<span class="nc" id="L427">			= searchField.getText().trim();</span>
<span class="nc" id="L428">		String selectedCategory</span>
<span class="nc" id="L429">			= (String) filterByCategory.getSelectedItem();</span>
<span class="nc" id="L430">		String selectedYear</span>
<span class="nc" id="L431">			= (String) filterByYear.getSelectedItem();</span>
		
		try {
<span class="nc bnc" id="L434" title="All 2 branches missed.">			if (showRawAndDerivedVariables.isSelected() == true) {</span>
<span class="nc" id="L435">				variableSearchTableModel.filterVariables(currentUser, </span>
										 		 		searchPhrase, 
										 		 		selectedYear, 
										 		 		selectedCategory);
			}
<span class="nc bnc" id="L440" title="All 2 branches missed.">			else if (filterByDerivedVariables.isSelected() == true) {</span>
<span class="nc" id="L441">				variableSearchTableModel.filterVariables(currentUser, </span>
														searchPhrase, 
														selectedYear, 
														selectedCategory,
														true);
			}
			else {
<span class="nc" id="L448">				variableSearchTableModel.filterVariables(currentUser, </span>
														searchPhrase, 
														selectedYear, 
														selectedCategory,
														false);			
			}			
		}
<span class="nc" id="L455">		catch(MacawException exception) {</span>
<span class="nc" id="L456">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L457">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L458">		}</span>
<span class="nc" id="L459">	}</span>
	
	public void refreshList() {
		try {
<span class="nc" id="L463">			variableSearchTableModel.refreshList();</span>
		}
<span class="nc" id="L465">		catch(MacawException exception) {</span>
<span class="nc" id="L466">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L467">			log.displayErrorDialog(exception);			</span>
<span class="nc" id="L468">		}</span>
<span class="nc" id="L469">	}</span>
	
	public void reset() {
		//reset the search field
<span class="nc" id="L473">		searchField.setText(&quot;&quot;);</span>
<span class="nc" id="L474">		filterByYear.setSelectedItem(allChoicesText);</span>
<span class="nc" id="L475">		filterByCategory.setSelectedItem(allChoicesText);</span>
<span class="nc" id="L476">		showRawAndDerivedVariables.setSelected(true);</span>

		try {
<span class="nc" id="L479">			variableSearchTableModel.showAllVariableSummaries(currentUser);			</span>
		}
<span class="nc" id="L481">		catch(MacawException exception) {</span>
<span class="nc" id="L482">			Log log = sessionProperties.getLog();</span>
<span class="nc" id="L483">			log.displayErrorDialog(exception);</span>
<span class="nc" id="L484">		}</span>
<span class="nc" id="L485">	}</span>
	
	public void setChangeListener(ChangeListener changeListener) {
<span class="nc" id="L488">		this.changeListener = changeListener;</span>
<span class="nc" id="L489">	}</span>
	
	public void setSelectionMode(int selectionMode) {
<span class="nc" id="L492">		ListSelectionModel listSelectionModel</span>
<span class="nc" id="L493">			= searchTable.getSelectionModel();</span>
<span class="nc" id="L494">		listSelectionModel.setSelectionMode(selectionMode);</span>
<span class="nc" id="L495">	}</span>
	
	public boolean showRawVariables() {
<span class="nc bnc" id="L498" title="All 2 branches missed.">		if (filterByRawVariables.isSelected() == true) {</span>
<span class="nc" id="L499">			return true;</span>
		}
<span class="nc bnc" id="L501" title="All 2 branches missed.">		else if (showRawAndDerivedVariables.isSelected() == true) {</span>
<span class="nc" id="L502">			return true;</span>
		}
		else {
<span class="nc" id="L505">			return false;</span>
		}
	}
	
	public boolean showDerivedVariables() {
<span class="nc bnc" id="L510" title="All 2 branches missed.">		if (filterByDerivedVariables.isSelected() == true) {</span>
<span class="nc" id="L511">			return true;</span>
		}
<span class="nc bnc" id="L513" title="All 2 branches missed.">		else if (showRawAndDerivedVariables.isSelected() == true) {</span>
<span class="nc" id="L514">			return true;</span>
		}
		else {
<span class="nc" id="L517">			return false;</span>
		}
	}

	public void selectVariable(Variable variable) {
<span class="nc" id="L522">		int selectionRow = variableSearchTableModel.getRow(variable.createVariableSummary());</span>
<span class="nc bnc" id="L523" title="All 2 branches missed.">		if (selectionRow != -1) {</span>
<span class="nc" id="L524">			Rectangle selectionArea </span>
<span class="nc" id="L525">				= searchTable.getCellRect(selectionRow, </span>
										  0, 
										  true);
<span class="nc" id="L528">			searchTable.scrollRectToVisible(selectionArea);			</span>
		}
<span class="nc" id="L530">	}</span>
	
	public boolean hasSearchResults() {
<span class="nc bnc" id="L533" title="All 2 branches missed.">		if (variableSearchTableModel.getRowCount() &gt; 0) {</span>
<span class="nc" id="L534">			return true;</span>
		}
		else {
<span class="nc" id="L537">			return false;</span>
		}
	}
	// ==========================================
	// Section Errors and Validation
	// ==========================================

	// ==========================================
	// Section Interfaces
	// ==========================================

	//Interface: ActionListener
	public void actionPerformed(ActionEvent event) {
<span class="nc" id="L550">		Object button = event.getSource();</span>
		
<span class="nc bnc" id="L552" title="All 2 branches missed.">		if (button == applySearch) {</span>
<span class="nc" id="L553">			applySearch();</span>
		}
<span class="nc bnc" id="L555" title="All 2 branches missed.">		else if (button == reset) {</span>
<span class="nc" id="L556">			reset();</span>
		}		
<span class="nc" id="L558">	}</span>

	//Interface: List Selection Listener
	 public void valueChanged(ListSelectionEvent event) {
<span class="nc bnc" id="L562" title="All 4 branches missed.">		 if ((event.getValueIsAdjusting() == false) &amp;&amp;</span>
			 (changeListener != null) ){
<span class="nc" id="L564">			 ChangeEvent changeEvent = new ChangeEvent(this);</span>
<span class="nc" id="L565">			 changeListener.stateChanged(changeEvent);</span>
		 }
<span class="nc" id="L567">	 }</span>
	
	 //Interface: Table Model Listener
	 public void tableChanged(TableModelEvent event) {
<span class="nc bnc" id="L571" title="All 2 branches missed.">		 if (changeListener != null){</span>
<span class="nc" id="L572">			 ChangeEvent changeEvent = new ChangeEvent(this);</span>
<span class="nc" id="L573">			 changeListener.stateChanged(changeEvent);</span>
		 }		 
<span class="nc" id="L575">	 }</span>
	 
	 // ==========================================
	// Section Overload
	// ==========================================

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>