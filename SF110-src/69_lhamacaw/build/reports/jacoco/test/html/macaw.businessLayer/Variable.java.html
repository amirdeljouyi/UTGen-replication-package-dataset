<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Variable.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.businessLayer</a> &gt; <span class="el_source">Variable.java</span></div><h1>Variable.java</h1><pre class="source lang-java linenums">package macaw.businessLayer;

import macaw.system.*;
import macaw.util.Displayable;
import macaw.util.ValidationUtility;

import java.util.ArrayList;

/**
 * A concept related to the NSHD study.  
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

abstract public class Variable implements Cloneable, Displayable {

	// ==========================================
	// Section Constants
	// ==========================================

	// ==========================================
	// Section Properties
	// ==========================================
	private int identifier;
	private String category;
	private String name;
	private String label;
	private boolean isCleaned;
	private String year;
	private String cleaningStatus;
	private String cleaningDescription;
	private ArrayList&lt;ValueLabel&gt; valueLabels;
	private String availability;
	private String alias;
	private String filePath;
	private boolean isCoded;
	protected String form;
	protected String questionNumber;
	
	protected String codeBookNumber;
	protected String columnStart;
	protected String columnEnd;
	protected String notes;
		
	private ArrayList&lt;SupportingDocument&gt; supportingDocuments;
	private ArrayList&lt;OntologyTerm&gt; ontologyTerms;
	private boolean isNewRecord;
	
	private Variable alternativeVariable;
	
	// ==========================================
	// Section Construction
	// ==========================================
<span class="fc" id="L88">	public Variable() {	</span>
<span class="fc" id="L89">		String unknownMessage</span>
<span class="fc" id="L90">			= MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;);</span>

<span class="fc" id="L92">		identifier = 0;</span>
<span class="fc" id="L93">		category = unknownMessage;</span>
<span class="fc" id="L94">		name = &quot;&quot;;</span>
<span class="fc" id="L95">		year = &quot;&quot;;</span>
<span class="fc" id="L96">		label = &quot;&quot;;</span>
<span class="fc" id="L97">		isCleaned = false;</span>
<span class="fc" id="L98">		cleaningStatus = unknownMessage;</span>
<span class="fc" id="L99">		cleaningDescription = &quot;&quot;;</span>
<span class="fc" id="L100">		valueLabels = new ArrayList&lt;ValueLabel&gt;();</span>
<span class="fc" id="L101">		availability = unknownMessage;</span>
<span class="fc" id="L102">		alias = &quot;&quot;;</span>
<span class="fc" id="L103">		filePath = &quot;&quot;;	</span>
<span class="fc" id="L104">		supportingDocuments = new ArrayList&lt;SupportingDocument&gt;();</span>
<span class="fc" id="L105">		ontologyTerms = new ArrayList&lt;OntologyTerm&gt;();</span>
<span class="fc" id="L106">		isCoded = false;</span>
<span class="fc" id="L107">		isNewRecord = false;</span>
		
<span class="fc" id="L109">		codeBookNumber = &quot;&quot;;</span>
<span class="fc" id="L110">		columnStart = &quot;&quot;;</span>
<span class="fc" id="L111">		columnEnd = &quot;&quot;;</span>
		
<span class="fc" id="L113">		form = &quot;&quot;;</span>
<span class="fc" id="L114">		questionNumber = &quot;&quot;;</span>
<span class="fc" id="L115">		notes = &quot;&quot;;		</span>
		
<span class="fc" id="L117">		alternativeVariable = null;</span>
<span class="fc" id="L118">	}</span>
	
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================
	
	/**
	 * produces a variable summary suitable for showing in a collection
	 * of search results.
	 */
	public VariableSummary createVariableSummary() {
<span class="nc" id="L129">		VariableSummary variableSummary = new VariableSummary();</span>
<span class="nc" id="L130">		variableSummary.setIdentifier(identifier);</span>
<span class="nc" id="L131">		variableSummary.setName(name);</span>
<span class="nc" id="L132">		variableSummary.setLabel(label);</span>
<span class="nc" id="L133">		variableSummary.setYear(year);</span>
<span class="nc" id="L134">		return variableSummary;</span>
	}
	
	/**
	 * an integer which uniquely identifies an instance in the database.  
	 * All primary key values in the database use a single auto-incremented 
	 * auto-generated value.
	 * @return the identifier
	 */
	public int getIdentifier() {
<span class="fc" id="L144">		return identifier;</span>
	}

	/**
	 * @param identifier the identifier to set
	 */
	public void setIdentifier(int identifier) {
<span class="fc" id="L151">		this.identifier = identifier;</span>
<span class="fc" id="L152">	}</span>

	/**
	 * variable name, as specified using the NSHD variable naming convention
	 * @return the name
	 */
	public String getName() {
<span class="fc" id="L159">		return name;</span>
	}

	/**
	 * @param name the name to set
	 */
	public void setName(String name) {
<span class="fc" id="L166">		this.name = name;</span>
<span class="fc" id="L167">	}</span>

	/**
	 * a one-line description of the variable
	 * @return the label
	 */
	public String getLabel() {
<span class="nc" id="L174">		return label;</span>
	}

	/**
	 * @param label the label to set
	 */
	public void setLabel(String label) {
<span class="fc" id="L181">		this.label = label;</span>
<span class="fc" id="L182">	}</span>

	/**
	 * sweep in which the variable was collected
	 * @return the year
	 */
	public String getYear() {
<span class="nc" id="L189">		return year;</span>
	}

	/**
	 * @param year the year to set
	 */
	public void setYear(String year) {
<span class="fc" id="L196">		this.year = year;</span>
<span class="fc" id="L197">	}</span>
	
	/**
	 * @return the category
	 */
	public String getCategory() {
<span class="fc" id="L203">		return category;</span>
	}

	/**
	 * @param category the category to set
	 */
	public void setCategory(String category) {
<span class="fc" id="L210">		this.category = category;</span>
<span class="fc" id="L211">	}</span>
	
	/**
	 * flag for whether the variable has been cleaned in some way
	 * @return the isCleaned
	 */
	public boolean isCleaned() {
<span class="fc" id="L218">		return isCleaned;</span>
	}

	/**
	 * @param isCleaned the isCleaned to set
	 */
	public void setCleaned(boolean isCleaned) {
<span class="fc" id="L225">		this.isCleaned = isCleaned;</span>
<span class="fc" id="L226">	}</span>

	/**
	 * @return the cleaningStatus
	 */
	public String getCleaningStatus() {
<span class="fc" id="L232">		return cleaningStatus;</span>
	}

	/**
	 * @param cleaningStatus the cleaningStatus to set
	 */
	public void setCleaningStatus(String cleaningStatus) {
<span class="fc" id="L239">		this.cleaningStatus = cleaningStatus;</span>
<span class="fc" id="L240">	}</span>

	/**
	 * free text description of how the variable data were cleaned.
	 * @return the cleaningDescription
	 */
	public String getCleaningDescription() {
<span class="nc" id="L247">		return cleaningDescription;</span>
	}

	/**
	 * @param cleaningDescription the cleaningDescription to set
	 */
	public void setCleaningDescription(String cleaningDescription) {
<span class="fc" id="L254">		this.cleaningDescription = cleaningDescription;</span>
<span class="fc" id="L255">	}</span>
	
	public ArrayList&lt;ValueLabel&gt; getValueLabels() {
<span class="fc" id="L258">		return valueLabels;</span>
	}
	
	public void setValueLabels(ArrayList&lt;ValueLabel&gt; valueLabels) {
<span class="nc" id="L262">		this.valueLabels = valueLabels;</span>
<span class="nc" id="L263">	}</span>
	
	public void addValueLabel(ValueLabel valueLabel) {
<span class="fc" id="L266">		valueLabels.add(valueLabel);</span>
<span class="fc" id="L267">	}</span>
	
	public void removeValueLabel(ValueLabel valueLabel) {
<span class="nc" id="L270">		valueLabels.remove(valueLabel);</span>
<span class="nc" id="L271">	}</span>
	
	public ArrayList&lt;SupportingDocument&gt; getSupportingDocuments() {
<span class="fc" id="L274">		return supportingDocuments;</span>
	}

	public boolean containsSupportingDocument(SupportingDocument targetSupportingDocument) {
<span class="fc" id="L278">		int targetIdentifier = targetSupportingDocument.getIdentifier();</span>
<span class="pc bpc" id="L279" title="1 of 2 branches missed.">		for (SupportingDocument currentSupportingDocument : supportingDocuments) {</span>
<span class="fc" id="L280">			int currentIdentifier</span>
<span class="fc" id="L281">				= currentSupportingDocument.getIdentifier();</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">			if (targetIdentifier == currentIdentifier) {</span>
<span class="fc" id="L283">				return true;</span>
			}
<span class="fc" id="L285">		}</span>
		
<span class="nc" id="L287">		return false;</span>
	}

	public void setSupportingDocuments(ArrayList&lt;SupportingDocument&gt; supportingDocuments) {
<span class="nc" id="L291">		this.supportingDocuments = supportingDocuments;</span>
<span class="nc" id="L292">	}</span>
	public void addSupportingDocuments(ArrayList&lt;SupportingDocument&gt; supportingDocumentsToAdd) {
<span class="fc" id="L294">		supportingDocuments.addAll(supportingDocumentsToAdd);</span>
<span class="fc" id="L295">	}</span>
	
	public void addSupportingDocument(SupportingDocument supportingDocument) {
<span class="nc" id="L298">		supportingDocuments.add(supportingDocument);</span>
<span class="nc" id="L299">	}</span>
	
	public void removeSupportingDocument(SupportingDocument supportingDocument) {
<span class="nc" id="L302">		supportingDocuments.remove(supportingDocument);		</span>
<span class="nc" id="L303">	}</span>
	
	public void removeSupportingDocuments(ArrayList&lt;SupportingDocument&gt; supportingDocumentsToDelete) {
<span class="nc bnc" id="L306" title="All 2 branches missed.">		for (SupportingDocument targetVariable : supportingDocumentsToDelete) {</span>
<span class="nc" id="L307">			supportingDocuments.remove(targetVariable);</span>
<span class="nc" id="L308">		}</span>
<span class="nc" id="L309">	}</span>

	public ArrayList&lt;OntologyTerm&gt; getOntologyTerms() {
<span class="nc" id="L312">		return ontologyTerms;</span>
	}

	public boolean containsOntologyTerm(OntologyTerm targetOntologyTerm) {
<span class="fc" id="L316">		int targetIdentifier = targetOntologyTerm.getIdentifier();</span>
<span class="pc bpc" id="L317" title="1 of 2 branches missed.">		for (OntologyTerm currentOntologyTerm : ontologyTerms) {</span>
<span class="nc" id="L318">			int currentIdentifier</span>
<span class="nc" id="L319">				= currentOntologyTerm.getIdentifier();</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">			if (targetIdentifier == currentIdentifier) {</span>
<span class="nc" id="L321">				return true;</span>
			}
<span class="nc" id="L323">		}</span>
		
<span class="fc" id="L325">		return false;</span>
	}
	
	public void setOntologyTerms(ArrayList&lt;OntologyTerm&gt; ontologyTerms) {
<span class="nc" id="L329">		this.ontologyTerms = ontologyTerms;</span>
<span class="nc" id="L330">	}</span>
	public void addOntologyTerms(ArrayList&lt;OntologyTerm&gt; ontologyTermsToAdd) {
<span class="nc" id="L332">		ontologyTerms.addAll(ontologyTermsToAdd);</span>
<span class="nc" id="L333">	}</span>
	
	public void addOntologyTerm(OntologyTerm ontologyTerm) {
<span class="fc" id="L336">		ontologyTerms.add(ontologyTerm);</span>
<span class="fc" id="L337">	}</span>
	
	public void removeOntologyTerm(OntologyTerm copyOfOntologyTermToDelete) {
<span class="nc" id="L340">		OntologyTerm itemToDelete = findOntologyTerm(copyOfOntologyTermToDelete);</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">		if (itemToDelete != null) {</span>
<span class="nc" id="L342">			ontologyTerms.remove(itemToDelete);			</span>
		}
<span class="nc" id="L344">	}</span>
	
	public void removeOntologyTerms(ArrayList&lt;OntologyTerm&gt; ontologyTermsToDelete) {
<span class="nc bnc" id="L347" title="All 2 branches missed.">		for (OntologyTerm targetOntologyTerm : ontologyTermsToDelete) {</span>
<span class="nc" id="L348">			removeOntologyTerm(targetOntologyTerm);</span>
<span class="nc" id="L349">		}</span>
<span class="nc" id="L350">	}</span>

	public void updateOntologyTerm(OntologyTerm revisedOntologyTerm) {
<span class="nc" id="L353">		OntologyTerm itemToUpdate = findOntologyTerm(revisedOntologyTerm);</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">		if (itemToUpdate != null) {</span>
<span class="nc" id="L355">			int numberOfTerms = ontologyTerms.size();			</span>
<span class="nc" id="L356">			int index = ontologyTerms.indexOf(itemToUpdate);			</span>
<span class="nc" id="L357">			ontologyTerms.remove(itemToUpdate);</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">			if (index == numberOfTerms -1) {</span>
				//item to update was at the end
<span class="nc" id="L360">				ontologyTerms.add(revisedOntologyTerm);</span>
			}
			else {
<span class="nc" id="L363">				ontologyTerms.add(index, revisedOntologyTerm);</span>
			}
		}	
<span class="nc" id="L366">	}</span>

	private OntologyTerm findOntologyTerm(OntologyTerm copyofOntologyTerm) {
<span class="nc" id="L369">		int targetIdentifier = copyofOntologyTerm.getIdentifier();</span>
<span class="nc bnc" id="L370" title="All 2 branches missed.">		for (OntologyTerm currentOntologyTerm : ontologyTerms) {</span>
<span class="nc bnc" id="L371" title="All 2 branches missed.">			if (currentOntologyTerm.getIdentifier() == targetIdentifier) {</span>
				//found the item to delete
<span class="nc" id="L373">				return currentOntologyTerm;</span>
			}
<span class="nc" id="L375">		}		</span>
<span class="nc" id="L376">		return null;</span>
	}
	
	/**
	 * @return the availability
	 */
	public String getAvailability() {
<span class="fc" id="L383">		return availability;</span>
	}

	/**
	 * @param availability the availability to set
	 */
	public void setAvailability(String availability) {
<span class="fc" id="L390">		this.availability = availability;</span>
<span class="fc" id="L391">	}</span>

	/**
	 * @return the codeBookNumber
	 */
	public String getCodeBookNumber() {
<span class="nc" id="L397">		return codeBookNumber;</span>
	}

	/**
	 * reference to the physical code book entry
	 * @param codeBookNumber the codeBookNumber to set
	 */
	public void setCodeBookNumber(String codeBookNumber) {
<span class="fc" id="L405">		this.codeBookNumber = codeBookNumber;</span>
<span class="fc" id="L406">	}</span>
	
	/**
	 * starting column in library file for this variable
	 * @return the columnStart
	 */
	public String getColumnStart() {
<span class="nc" id="L413">		return columnStart;</span>
	}

	/** 
	 * @param columnStart the columnStart to set
	 */
	public void setColumnStart(String columnStart) {
<span class="fc" id="L420">		this.columnStart = columnStart;</span>
<span class="fc" id="L421">	}</span>

	/**
	 * ending column in library file for this variable
	 * @return the columnEnd
	 */
	public String getColumnEnd() {
<span class="nc" id="L428">		return columnEnd;</span>
	}

	/**
	 * @param columnEnd the columnEnd to set
	 */
	public void setColumnEnd(String columnEnd) {
<span class="fc" id="L435">		this.columnEnd = columnEnd;</span>
<span class="fc" id="L436">	}</span>

	
	/**
	 * @return the alias
	 */
	public String getAlias() {
<span class="fc" id="L443">		return alias;</span>
	}

	/**
	 * @param alias the alias to set
	 */
	public void setAlias(String alias) {
<span class="fc" id="L450">		this.alias = alias;</span>
<span class="fc" id="L451">	}</span>
	
	/**
	 * @return the file Name
	 */
	public String getFilePath() {
<span class="fc" id="L457">		return filePath;</span>
	}

	/**
	 * @param filePath the dataLibraryFileName to set
	 */
	public void setFilePath(String filePath) {
<span class="fc" id="L464">		this.filePath = filePath;</span>
<span class="fc" id="L465">	}</span>

	/**
	 * flag for whether the variable has been coded electronically (or not)
	 * @return the isCoded
	 */
	public boolean isCoded() {
<span class="nc" id="L472">		return isCoded;</span>
	}

	/**
	 * @param isCoded the isCoded to set
	 */
	public void setCoded(boolean isCoded) {
<span class="fc" id="L479">		this.isCoded = isCoded;</span>
<span class="fc" id="L480">	}</span>
	
	public boolean isNewRecord() {
<span class="nc" id="L483">		return isNewRecord;</span>
	}

	public void setIsNewRecord(boolean isNewRecord) {
<span class="fc" id="L487">		this.isNewRecord = isNewRecord;</span>
<span class="fc" id="L488">	}</span>
	
	/**
	 * questionnaire form containing the question whose response is stored in the variable
	 * @return the form
	 */
	public String getForm() {
<span class="nc" id="L495">		return form;</span>
	}

	/**
	 * @param form the form to set
	 */
	public void setForm(String form) {
<span class="fc" id="L502">		this.form = form;</span>
<span class="fc" id="L503">	}</span>

	/**
	 * question number from the questionnaire for this variable
	 * @return the questionNumber
	 */
	public String getQuestionNumber() {
<span class="nc" id="L510">		return questionNumber;</span>
	}

	/**
	 * @param questionNumber the questionNumber to set
	 */
	public void setQuestionNumber(String questionNumber) {
<span class="fc" id="L517">		this.questionNumber = questionNumber;</span>
<span class="fc" id="L518">	}</span>

	public String getNotes() {
<span class="nc" id="L521">		return notes;</span>
	}
	
	public void setNotes(String notes) {
<span class="nc" id="L525">		this.notes = notes;</span>
<span class="nc" id="L526">	}</span>

	public Variable getAlternativeVariable() {
<span class="nc" id="L529">		return alternativeVariable;</span>
	}
	
	public void setAlternativeVariable(Variable alterativeVariable) {
<span class="nc" id="L533">		this.alternativeVariable = alterativeVariable;</span>
<span class="nc" id="L534">	}</span>
	
	// ==========================================
	// Section Errors and Validation
	// ==========================================
	static protected ArrayList&lt;String&gt; validateFields(Variable variable) {
<span class="fc" id="L540">		ArrayList&lt;String&gt; errorMessages = new ArrayList&lt;String&gt;();</span>
		
		//specify a name
<span class="pc bpc" id="L543" title="1 of 2 branches missed.">		if (ValidationUtility.isBlank(variable.getName()) == true) {</span>
<span class="nc" id="L544">			String nameLabelText</span>
<span class="nc" id="L545">				= MacawMessages.getMessage(&quot;variable.name.label&quot;);</span>
<span class="nc" id="L546">			String errorMessage</span>
<span class="nc" id="L547">				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,</span>
										   nameLabelText);
<span class="nc" id="L549">			errorMessages.add(errorMessage);</span>
		}
		
		//specify a label
		/**
		if (ValidationUtility.isBlank(variable.getLabel()) == true) {
			String labelLabelText
				= MacawMessages.getMessage(&quot;variable.label.label&quot;); 
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,
									   		labelLabelText);
			errorMessages.add(errorMessage);
		}
		*/
		
		//specify a category
		
		/*
		if (ValidationUtility.isBlank(variable.getCategory()) == true) {
			String categoryLabelText
				= MacawMessages.getMessage(&quot;variable.category.label&quot;);
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,
											categoryLabelText);	
			errorMessages.add(errorMessage);
		}
		
		if (ValidationUtility.isUnknown(variable.getCategory()) == true) {
			String categoryLabelText
				= MacawMessages.getMessage(&quot;variable.category.label&quot;);
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.unselectedItem&quot;,
											categoryLabelText);	
			errorMessages.add(errorMessage);
		}
		*/
		
		//specify an availability
<span class="pc bpc" id="L587" title="1 of 2 branches missed.">		if (ValidationUtility.isBlank(variable.getAvailability()) == true) {</span>
<span class="nc" id="L588">			String availabilityLabelText</span>
<span class="nc" id="L589">				= MacawMessages.getMessage(&quot;variable.availability.label&quot;);</span>
<span class="nc" id="L590">			String errorMessage</span>
<span class="nc" id="L591">				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,</span>
											availabilityLabelText);	
<span class="nc" id="L593">			errorMessages.add(errorMessage);</span>
		}

		/**
		if (ValidationUtility.isUnknown(variable.getAvailability()) == true) {
			String availabilityLabelText
				= MacawMessages.getMessage(&quot;variable.availability.label&quot;);
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.unselectedItem&quot;,
											availabilityLabelText);	
			errorMessages.add(errorMessage);
		}
		*/

		//specify cleaning status
<span class="fc bfc" id="L608" title="All 2 branches covered.">		if (variable.isCleaned() == true) {</span>
<span class="pc bpc" id="L609" title="1 of 2 branches missed.">			if (ValidationUtility.isBlank(variable.getCleaningStatus()) == true) {</span>
<span class="nc" id="L610">				String cleaningStatusLabelText</span>
<span class="nc" id="L611">					= MacawMessages.getMessage(&quot;variable.cleaningStatus.label&quot;);</span>
<span class="nc" id="L612">				String errorMessage</span>
<span class="nc" id="L613">					= MacawMessages.getMessage(&quot;general.error.blankField&quot;,</span>
												cleaningStatusLabelText);	
<span class="nc" id="L615">				errorMessages.add(errorMessage);</span>
			}
			
			/**
			if (ValidationUtility.isUnknown(variable.getCleaningStatus()) == true) {
				String cleaningStatusLabelText
					= MacawMessages.getMessage(&quot;variable.cleaningStatus.label&quot;);
				String errorMessage
					= MacawMessages.getMessage(&quot;general.error.unselectedItem&quot;,
												cleaningStatusLabelText);	
				errorMessages.add(errorMessage);
			}	
			*/		
		}
		
		//specify a year
		/**
		if (ValidationUtility.isBlank(variable.getYear()) == true) {
			String yearLabelText
				= MacawMessages.getMessage(&quot;variable.year.label&quot;); 
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,
									   		yearLabelText);
			errorMessages.add(errorMessage);
		}
		else {
			//make sure year is numeric
			String yearValue = variable.getYear();
		
			try {
				Date currentDate = new Date();
				GregorianCalendar gregorianCalendar = new GregorianCalendar();
				gregorianCalendar.setTime(currentDate);
				int currentYearNumber = gregorianCalendar.get(Calendar.YEAR);
			
				int calendarYear = new Integer(yearValue).intValue();
				if (calendarYear &lt; 1946) {
					String errorMessage
						= MacawMessages.getMessage(&quot;variable.year.error.tooOld&quot;,
												   yearValue);
					errorMessages.add(errorMessage);
				}
				else if (calendarYear &gt; currentYearNumber) {
					String errorMessage
						= MacawMessages.getMessage(&quot;variable.year.error.tooNew&quot;,
												   yearValue);
					errorMessages.add(errorMessage);
				}
			}
			catch(NumberFormatException exception) {
				String illegalNumberFormatException
					= MacawMessages.getMessage(&quot;variable.year.error.illegalYear&quot;,
											   yearValue);
				errorMessages.add(illegalNumberFormatException); 
			}
		}
		*/
		
		/**
		String columnStart = variable.getColumnStart();
		if (ValidationUtility.isBlank(columnStart) == false) {
			//check that column start is an integer
			try {
				//ensure that values are integers
				Integer.valueOf(columnStart);
			}
			catch(Exception exception) {
				String columnStartLabelText
					= MacawMessages.getMessage(&quot;variable.columnStart.label&quot;);
				String errorMessage
					= MacawMessages.getMessage(&quot;general.error.illegalNumber&quot;,
										       columnStart,
										       columnStartLabelText);
				errorMessages.add(errorMessage);
			}			
		}

		String columnEnd = variable.getColumnEnd();
		if (ValidationUtility.isBlank(columnEnd) == false) {
			//check that column end is an integer
			try {
				//ensure that values are integers
				Integer.valueOf(columnEnd);
			}
			catch(Exception exception) {
				String columnEndLabelText
					= MacawMessages.getMessage(&quot;variable.columnEnd.label&quot;);
				String errorMessage
					= MacawMessages.getMessage(&quot;general.error.illegalNumber&quot;,
												columnEnd,
												columnEndLabelText);
				errorMessages.add(errorMessage);
			}			
		}
		*/
		
		//specify an alias
		/**
		if (ValidationUtility.isBlank(variable.getAlias()) == true) {
			String aliasLabelText
				= MacawMessages.getMessage(&quot;variable.alias.label&quot;);
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,
											aliasLabelText);
			errorMessages.add(errorMessage);			
		}
		*/
		
		//specify a file name
		/**
		if (ValidationUtility.isBlank(variable.getFilePath()) == true) {
			String filePathLabelText
				= MacawMessages.getMessage(&quot;variable.filePath.label&quot;);
			String errorMessage
				= MacawMessages.getMessage(&quot;general.error.blankField&quot;,
											filePathLabelText);
			errorMessages.add(errorMessage);			
		}
		*/
				
<span class="fc" id="L735">		return errorMessages;</span>
	}

	static public ArrayList&lt;MacawChangeEvent&gt; detectFieldChanges(User user,
			 													 Variable originalVariable,
			 													 Variable revisedVariable) {
<span class="nc" id="L741">		String userID = user.getUserID();</span>
<span class="nc" id="L742">		ArrayList&lt;MacawChangeEvent&gt; changeEvents = new ArrayList&lt;MacawChangeEvent&gt;();</span>
<span class="nc" id="L743">		String ownerVariableName = originalVariable.getDisplayName();</span>
		
		//detect changes in name
<span class="nc" id="L746">		String oldName = originalVariable.getName();</span>
<span class="nc" id="L747">		String newName = revisedVariable.getName();</span>
<span class="nc bnc" id="L748" title="All 2 branches missed.">		if (oldName.equals(newName) == false) {</span>
<span class="nc" id="L749">			oldName</span>
<span class="nc" id="L750">				= ValidationUtility.convertEmptyValueToBlank(oldName);</span>
<span class="nc" id="L751">			newName</span>
<span class="nc" id="L752">				= ValidationUtility.convertEmptyValueToBlank(newName);</span>

<span class="nc" id="L754">			String nameLabelText</span>
<span class="nc" id="L755">				= MacawMessages.getMessage(&quot;variable.name.label&quot;);</span>
<span class="nc" id="L756">			String fieldChangedMessage</span>
<span class="nc" id="L757">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   nameLabelText,
										   oldName,
										   newName);
<span class="nc" id="L762">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L766">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L767">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L768">			changeEvents.add(changeEvent);</span>
		}

		//=Changed variable {0}, field {1}, from {2} to {3}
		
		//detect changes in label
<span class="nc" id="L774">		String oldLabel = originalVariable.getLabel();</span>
<span class="nc" id="L775">		String newLabel = revisedVariable.getLabel();</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">		if (oldLabel.equals(newLabel) == false) {</span>
<span class="nc" id="L777">			oldLabel</span>
<span class="nc" id="L778">				= ValidationUtility.convertEmptyValueToBlank(oldName);</span>
<span class="nc" id="L779">			newLabel</span>
<span class="nc" id="L780">				= ValidationUtility.convertEmptyValueToBlank(newLabel);</span>

<span class="nc" id="L782">			String labelLabelText</span>
<span class="nc" id="L783">				= MacawMessages.getMessage(&quot;variable.label.label&quot;);</span>
<span class="nc" id="L784">			String fieldChangedMessage</span>
<span class="nc" id="L785">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   labelLabelText,
										   oldLabel,
										   newLabel);
<span class="nc" id="L790">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L794">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L795">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L796">			changeEvents.add(changeEvent);			</span>
		}
		
		//detect changes in year
<span class="nc" id="L800">		String oldYear = originalVariable.getYear();</span>
<span class="nc" id="L801">		String newYear = revisedVariable.getYear();</span>
<span class="nc bnc" id="L802" title="All 2 branches missed.">		if (oldYear.equals(newYear) == false) {</span>
<span class="nc" id="L803">			oldYear</span>
<span class="nc" id="L804">				= ValidationUtility.convertEmptyValueToBlank(oldYear);</span>
<span class="nc" id="L805">			newYear</span>
<span class="nc" id="L806">				= ValidationUtility.convertEmptyValueToBlank(newYear);</span>
<span class="nc" id="L807">			String yearLabelText</span>
<span class="nc" id="L808">				= MacawMessages.getMessage(&quot;variable.year.label&quot;); </span>
<span class="nc" id="L809">			String fieldChangedMessage</span>
<span class="nc" id="L810">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   yearLabelText,
										   oldYear,
										   newYear);
<span class="nc" id="L815">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L819">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L820">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L821">			changeEvents.add(changeEvent);						</span>
		}

		//detect changes in category
<span class="nc" id="L825">		String originalCategory = originalVariable.getCategory();</span>
<span class="nc" id="L826">		String revisedCategory = revisedVariable.getCategory();</span>
<span class="nc bnc" id="L827" title="All 2 branches missed.">		if (originalCategory.equals(revisedCategory) == false) {</span>
<span class="nc" id="L828">			originalCategory</span>
<span class="nc" id="L829">				= ValidationUtility.convertEmptyValueToBlank(originalCategory);</span>
<span class="nc" id="L830">			revisedCategory</span>
<span class="nc" id="L831">				= ValidationUtility.convertEmptyValueToBlank(revisedCategory);</span>
			
<span class="nc" id="L833">			String categoryLabelText</span>
<span class="nc" id="L834">				= MacawMessages.getMessage(&quot;variable.category.label&quot;); </span>
<span class="nc" id="L835">			String fieldChangedMessage</span>
<span class="nc" id="L836">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
									   	   categoryLabelText,
									   	   originalCategory,
									   	   revisedCategory);
<span class="nc" id="L841">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
			
<span class="nc" id="L846">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L847">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L848">			changeEvents.add(changeEvent);									</span>
		}
						
<span class="nc" id="L851">		boolean originalIsCleaned = originalVariable.isCleaned();</span>
<span class="nc" id="L852">		boolean revisedIsCleaned = revisedVariable.isCleaned();</span>
		
<span class="nc bnc" id="L854" title="All 4 branches missed.">		if ( (originalIsCleaned != revisedIsCleaned) &amp;&amp; </span>
			 (revisedIsCleaned == false)) {		
<span class="nc" id="L856">				String changedToNotCleaned</span>
<span class="nc" id="L857">					= MacawMessages.getMessage(&quot;variable.isCleaned.saveChanges.changedToNotClean&quot;,</span>
											   ownerVariableName);
<span class="nc" id="L859">				MacawChangeEvent changeEvent</span>
					= new MacawChangeEvent(ChangeEventType.VARIABLE,
										   changedToNotCleaned, 
										   userID);
<span class="nc" id="L863">				changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L864">				changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L865">				changeEvents.add(changeEvent);			</span>
<span class="nc" id="L866">		}</span>
		else {
							
<span class="nc" id="L869">			String oldCleaningChoice = originalVariable.getCleaningStatus();</span>
<span class="nc" id="L870">			String revisedCleaningChoice = revisedVariable.getCleaningStatus();</span>

				
<span class="nc bnc" id="L873" title="All 2 branches missed.">			if (oldCleaningChoice.equals(revisedCleaningChoice) == false) {</span>
<span class="nc" id="L874">				oldCleaningChoice</span>
<span class="nc" id="L875">					= ValidationUtility.convertEmptyValueToBlank(oldCleaningChoice);</span>
<span class="nc" id="L876">				revisedCleaningChoice</span>
<span class="nc" id="L877">					= ValidationUtility.convertEmptyValueToBlank(revisedCleaningChoice);</span>
					
<span class="nc" id="L879">				String cleaningStatusText</span>
<span class="nc" id="L880">					= MacawMessages.getMessage(&quot;variable.cleaningStatus.label&quot;); </span>
<span class="nc" id="L881">				String fieldChangedMessage</span>
<span class="nc" id="L882">					= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
											   ownerVariableName,
											   cleaningStatusText,
											   oldCleaningChoice,
											   revisedCleaningChoice);
<span class="nc" id="L887">				MacawChangeEvent changeEvent</span>
					= new MacawChangeEvent(ChangeEventType.VARIABLE,
										   fieldChangedMessage, 
										   userID);
<span class="nc" id="L891">				changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L892">				changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L893">				changeEvents.add(changeEvent);													</span>
			}
			
<span class="nc" id="L896">			String oldCleaningDescription = originalVariable.getCleaningDescription();</span>
<span class="nc" id="L897">			String revisedCleaningDescription = originalVariable.getCleaningDescription();</span>

<span class="nc bnc" id="L899" title="All 2 branches missed.">			if (oldCleaningDescription.equals(revisedCleaningDescription) == false) {</span>
<span class="nc" id="L900">				oldCleaningDescription</span>
<span class="nc" id="L901">					= ValidationUtility.convertEmptyValueToBlank(oldCleaningDescription);</span>
<span class="nc" id="L902">				revisedCleaningDescription</span>
<span class="nc" id="L903">					= ValidationUtility.convertEmptyValueToBlank(revisedCleaningDescription);</span>

<span class="nc" id="L905">				String cleaningDescriptionText</span>
<span class="nc" id="L906">					= MacawMessages.getMessage(&quot;variable.cleaningDescription.label&quot;); </span>
<span class="nc" id="L907">				String fieldChangedMessage</span>
<span class="nc" id="L908">					= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   	   ownerVariableName,
										   	   cleaningDescriptionText,
										   	   oldCleaningDescription,
										   	   revisedCleaningDescription);

<span class="nc" id="L914">				MacawChangeEvent changeEvent</span>
					= new MacawChangeEvent(ChangeEventType.VARIABLE,
										   fieldChangedMessage, 
										   userID);
<span class="nc" id="L918">				changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L919">				changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L920">				changeEvents.add(changeEvent);													</span>
			}
		}
		
		//detect changes in code book number
<span class="nc" id="L925">		String originalCodeBookNumber</span>
<span class="nc" id="L926">			= originalVariable.getCodeBookNumber();</span>
<span class="nc" id="L927">		String revisedCodeBookNumber</span>
<span class="nc" id="L928">			= revisedVariable.getCodeBookNumber();</span>
<span class="nc bnc" id="L929" title="All 2 branches missed.">		if (originalCodeBookNumber.equals(revisedCodeBookNumber) == false) {</span>
<span class="nc" id="L930">			originalCodeBookNumber</span>
<span class="nc" id="L931">				= ValidationUtility.convertEmptyValueToBlank(originalCodeBookNumber);</span>
<span class="nc" id="L932">			revisedCodeBookNumber</span>
<span class="nc" id="L933">				= ValidationUtility.convertEmptyValueToBlank(revisedCodeBookNumber);</span>

<span class="nc" id="L935">			String formLabelText</span>
<span class="nc" id="L936">				= MacawMessages.getMessage(&quot;variable.codeBookNumber.label&quot;); </span>
<span class="nc" id="L937">			String fieldChangedMessage</span>
<span class="nc" id="L938">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
											ownerVariableName,
											formLabelText,
											originalCodeBookNumber,
											revisedCodeBookNumber);
<span class="nc" id="L943">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
										fieldChangedMessage, 
										userID);
<span class="nc" id="L947">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L948">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L949">			changeEvents.add(changeEvent);														</span>
		}
		
		//detect changes in column start
<span class="nc" id="L953">		String columnStartLabelText</span>
<span class="nc" id="L954">			= MacawMessages.getMessage(&quot;variable.columnStart.label&quot;);</span>
<span class="nc" id="L955">		String originalColumnStart = originalVariable.getColumnStart();</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">		if (originalColumnStart == null) {</span>
<span class="nc" id="L957">			originalColumnStart</span>
<span class="nc" id="L958">				= MacawMessages.getMessage(&quot;general.fieldValue.blank&quot;); 			</span>
		}
		
<span class="nc" id="L961">		String revisedColumnStart = revisedVariable.getColumnStart();</span>
<span class="nc bnc" id="L962" title="All 2 branches missed.">		if (revisedColumnStart == null) {</span>
<span class="nc" id="L963">			revisedColumnStart</span>
<span class="nc" id="L964">				= MacawMessages.getMessage(&quot;general.fieldValue.blank&quot;); </span>
		}

<span class="nc bnc" id="L967" title="All 2 branches missed.">		if (originalColumnStart.equals(revisedColumnStart) == false) {</span>
			//change occured
<span class="nc" id="L969">			String fieldChangedMessage</span>
<span class="nc" id="L970">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   columnStartLabelText,
										   originalColumnStart,
										   revisedColumnStart);
<span class="nc" id="L975">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);

<span class="nc" id="L980">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L981">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L982">			changeEvents.add(changeEvent);			</span>
		}
		
		//detect changes in column end
<span class="nc" id="L986">		String columnEndLabelText</span>
<span class="nc" id="L987">			= MacawMessages.getMessage(&quot;variable.columnEnd.label&quot;);</span>
<span class="nc" id="L988">		String originalColumnEnd = originalVariable.getColumnEnd();</span>
<span class="nc bnc" id="L989" title="All 2 branches missed.">		if (originalColumnEnd.equals(&quot;&quot;) == true) {</span>
<span class="nc" id="L990">			originalColumnEnd</span>
<span class="nc" id="L991">				= MacawMessages.getMessage(&quot;general.fieldValue.blank&quot;);</span>
		}

<span class="nc" id="L994">		String revisedColumnEnd = revisedVariable.getColumnEnd();</span>
<span class="nc bnc" id="L995" title="All 2 branches missed.">		if (revisedColumnEnd.equals(&quot;&quot;) == true) {</span>
<span class="nc" id="L996">			revisedColumnEnd</span>
<span class="nc" id="L997">				= MacawMessages.getMessage(&quot;general.fieldValue.blank&quot;); </span>
		}


<span class="nc bnc" id="L1001" title="All 2 branches missed.">		if (originalColumnEnd.equals(revisedColumnEnd) == false) {			</span>
			//change occured
<span class="nc" id="L1003">			String fieldChangedMessage</span>
<span class="nc" id="L1004">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   columnEndLabelText,
										   originalColumnEnd,
										   revisedColumnEnd);
<span class="nc" id="L1009">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);

<span class="nc" id="L1014">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1015">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1016">			changeEvents.add(changeEvent);			</span>
		}

		//check alias
<span class="nc" id="L1020">		String oldAlias = originalVariable.getAlias();</span>
<span class="nc" id="L1021">		String newAlias = revisedVariable.getAlias();</span>
<span class="nc bnc" id="L1022" title="All 2 branches missed.">		if (oldAlias.equals(newAlias) == false) {</span>
<span class="nc" id="L1023">			oldAlias</span>
<span class="nc" id="L1024">				= ValidationUtility.convertEmptyValueToBlank(oldAlias);</span>
<span class="nc" id="L1025">			newAlias</span>
<span class="nc" id="L1026">				= ValidationUtility.convertEmptyValueToBlank(newAlias);</span>

<span class="nc" id="L1028">			String aliasText</span>
<span class="nc" id="L1029">				= MacawMessages.getMessage(&quot;variable.alias.label&quot;);</span>
<span class="nc" id="L1030">			String fieldChangedMessage</span>
<span class="nc" id="L1031">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   aliasText,
										   oldAlias,
										   newAlias);
<span class="nc" id="L1036">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1040">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1041">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1042">			changeEvents.add(changeEvent);										</span>
		}

		//check file name
		/**
		String oldFilePath = originalVariable.getFilePath();
		String newFilePath = revisedVariable.getFilePath();
		if (oldFilePath.equals(newFilePath) == false) {
			oldFilePath
				= ValidationUtility.convertEmptyValueToBlank(oldFilePath);
			newFilePath
				= ValidationUtility.convertEmptyValueToBlank(newFilePath);

			String filePathText
				= MacawMessages.getMessage(&quot;variable.filePath.label&quot;);
			String fieldChangedMessage
				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,
										   ownerVariableName,
										   filePathText,
										   oldFilePath,
										   newFilePath);
			MacawChangeEvent changeEvent
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());
			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());
			changeEvents.add(changeEvent);										
		}
	 	*/
		
<span class="nc" id="L1073">		String oldAvailability = originalVariable.getAvailability();</span>
<span class="nc" id="L1074">		String revisedAvailability = revisedVariable.getAvailability();</span>
<span class="nc bnc" id="L1075" title="All 2 branches missed.">		if (oldAvailability.equals(revisedAvailability) == false) {</span>
<span class="nc" id="L1076">			oldAvailability</span>
<span class="nc" id="L1077">				= ValidationUtility.convertEmptyValueToBlank(oldAvailability);</span>
<span class="nc" id="L1078">			revisedAvailability</span>
<span class="nc" id="L1079">				= ValidationUtility.convertEmptyValueToBlank(revisedAvailability);</span>

<span class="nc" id="L1081">			String availabilityText</span>
<span class="nc" id="L1082">				= MacawMessages.getMessage(&quot;variable.availability.label&quot;);</span>
<span class="nc" id="L1083">			String fieldChangedMessage</span>
<span class="nc" id="L1084">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   availabilityText,
										   oldAvailability,
										   revisedAvailability);
<span class="nc" id="L1089">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1093">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1094">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1095">			changeEvents.add(changeEvent);										</span>
		}
			
<span class="nc" id="L1098">		boolean originalIsCoded = originalVariable.isCoded();</span>
<span class="nc" id="L1099">		boolean revisedIsCoded = revisedVariable.isCoded();</span>
<span class="nc bnc" id="L1100" title="All 2 branches missed.">		if (originalIsCoded != revisedIsCoded) {</span>
<span class="nc" id="L1101">			String oldIsCodedValue</span>
<span class="nc" id="L1102">				= Boolean.toString(originalIsCoded);</span>
<span class="nc" id="L1103">			String revisedIsCodedValue</span>
<span class="nc" id="L1104">				= Boolean.toString(revisedIsCoded);</span>
			
<span class="nc" id="L1106">			String isCodedLabel</span>
<span class="nc" id="L1107">				= MacawMessages.getMessage(&quot;variable.isCoded.label&quot;);</span>
<span class="nc" id="L1108">			String fieldChangedMessage</span>
<span class="nc" id="L1109">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
											ownerVariableName,
											isCodedLabel,
											oldIsCodedValue,
											revisedIsCodedValue);
			
<span class="nc" id="L1115">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1119">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1120">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1121">			changeEvents.add(changeEvent);			</span>
		}

<span class="nc" id="L1124">		String originalForm = originalVariable.getForm();</span>
<span class="nc" id="L1125">		String revisedForm = revisedVariable.getForm();</span>
<span class="nc bnc" id="L1126" title="All 2 branches missed.">		if (originalForm.equals(revisedForm) == false) {</span>
<span class="nc" id="L1127">			originalForm</span>
<span class="nc" id="L1128">				= ValidationUtility.convertEmptyValueToBlank(originalForm);</span>
<span class="nc" id="L1129">			revisedForm</span>
<span class="nc" id="L1130">				= ValidationUtility.convertEmptyValueToBlank(revisedForm);</span>

<span class="nc" id="L1132">			String formLabelText</span>
<span class="nc" id="L1133">				= MacawMessages.getMessage(&quot;variable.form.label&quot;); </span>
<span class="nc" id="L1134">			String fieldChangedMessage</span>
<span class="nc" id="L1135">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
									   	   formLabelText,
									   	   originalForm,
									   	   revisedForm);
<span class="nc" id="L1140">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1144">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1145">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1146">			changeEvents.add(changeEvent);											</span>
		}
		
<span class="nc" id="L1149">		String originalQuestionNumber = originalVariable.getQuestionNumber();</span>
<span class="nc" id="L1150">		String revisedQuestionNumber = revisedVariable.getQuestionNumber();</span>
<span class="nc bnc" id="L1151" title="All 2 branches missed.">		if (originalQuestionNumber.equals(revisedQuestionNumber) == false) {</span>
<span class="nc" id="L1152">			originalQuestionNumber</span>
<span class="nc" id="L1153">				= ValidationUtility.convertEmptyValueToBlank(originalQuestionNumber);</span>
<span class="nc" id="L1154">			revisedQuestionNumber</span>
<span class="nc" id="L1155">				= ValidationUtility.convertEmptyValueToBlank(revisedQuestionNumber);</span>

<span class="nc" id="L1157">			String formLabelText</span>
<span class="nc" id="L1158">				= MacawMessages.getMessage(&quot;variable.questionNumber.label&quot;); </span>
<span class="nc" id="L1159">			String fieldChangedMessage</span>
<span class="nc" id="L1160">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   formLabelText,
										   originalQuestionNumber,
										   revisedQuestionNumber);
<span class="nc" id="L1165">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1169">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1170">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1171">			changeEvents.add(changeEvent);														</span>
		}
		
<span class="nc" id="L1174">		String originalNotes = originalVariable.getNotes();</span>
<span class="nc" id="L1175">		String revisedNotes = revisedVariable.getNotes();</span>
<span class="nc bnc" id="L1176" title="All 2 branches missed.">		if (originalNotes.equals(revisedNotes) == false) {</span>
<span class="nc" id="L1177">			originalNotes</span>
<span class="nc" id="L1178">				= ValidationUtility.convertEmptyValueToBlank(originalNotes);</span>
<span class="nc" id="L1179">			revisedNotes</span>
<span class="nc" id="L1180">				= ValidationUtility.convertEmptyValueToBlank(revisedNotes);</span>

<span class="nc" id="L1182">			String notesLabelText</span>
<span class="nc" id="L1183">				= MacawMessages.getMessage(&quot;variable.notes.label&quot;); </span>
<span class="nc" id="L1184">			String fieldChangedMessage</span>
<span class="nc" id="L1185">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
										   ownerVariableName,
										   notesLabelText,
										   originalNotes,
										   revisedNotes);
<span class="nc" id="L1190">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
									   fieldChangedMessage, 
									   userID);
<span class="nc" id="L1194">			changeEvent.setVariableOwnerID(originalVariable.getIdentifier());</span>
<span class="nc" id="L1195">			changeEvent.setChangedObjectIdentifier(originalVariable.getIdentifier());</span>
<span class="nc" id="L1196">			changeEvents.add(changeEvent);														</span>
		}
		
		/**
		MacawChangeEvent changeEvent
			= detectChangesInAlternativeVariable(user,
												 originalVariable,
												 revisedVariable);
		if (changeEvent != null) {
			changeEvents.add(changeEvent);
		}
		*/
		
<span class="nc" id="L1209">		return changeEvents;		</span>
	}

	static public MacawChangeEvent detectChangesInAlternativeVariable(User user,
																	  Variable originalVariable,
																	  Variable revisedAlternativeVariable) {

<span class="nc" id="L1216">		Variable oldAlternativeVariable </span>
<span class="nc" id="L1217">			= originalVariable.getAlternativeVariable();</span>
<span class="nc" id="L1218">		boolean alternativeVariableChanged = false;</span>
<span class="nc bnc" id="L1219" title="All 4 branches missed.">		if ((oldAlternativeVariable == null) &amp;&amp; (revisedAlternativeVariable == null) ) {</span>
<span class="nc" id="L1220">			alternativeVariableChanged = false;		</span>
		}
<span class="nc bnc" id="L1222" title="All 4 branches missed.">		else if ((oldAlternativeVariable == null) || (revisedAlternativeVariable == null)) {</span>
<span class="nc" id="L1223">			alternativeVariableChanged = true;</span>
		}
		else {
			//both are non-null
<span class="nc bnc" id="L1227" title="All 2 branches missed.">			if (oldAlternativeVariable.getIdentifier() == revisedAlternativeVariable.getIdentifier()) {</span>
<span class="nc" id="L1228">				alternativeVariableChanged = true;				</span>
			}
			else {
<span class="nc" id="L1231">				alternativeVariableChanged = false;</span>
			}
		}

<span class="nc bnc" id="L1235" title="All 2 branches missed.">		if (alternativeVariableChanged == true) {</span>
<span class="nc" id="L1236">			String blankFieldValue</span>
<span class="nc" id="L1237">				= MacawMessages.getMessage(&quot;general.fieldValue.blank&quot;);</span>
<span class="nc" id="L1238">			String fieldName</span>
<span class="nc" id="L1239">				= MacawMessages.getMessage(&quot;variable.alternativeVariable.label&quot;);</span>
<span class="nc" id="L1240">			String oldAlternativeVariableName = blankFieldValue;</span>
<span class="nc bnc" id="L1241" title="All 2 branches missed.">			if (oldAlternativeVariable != null) {</span>
<span class="nc" id="L1242">				oldAlternativeVariableName = oldAlternativeVariable.getDisplayName();</span>
			}
	
<span class="nc" id="L1245">			String revisedAlternativeVariableName = blankFieldValue;</span>
<span class="nc bnc" id="L1246" title="All 2 branches missed.">			if ( revisedAlternativeVariable != null) {</span>
<span class="nc" id="L1247">				revisedAlternativeVariableName = revisedAlternativeVariable.getDisplayName();</span>
			}
	
<span class="nc" id="L1250">			String changeMessage</span>
<span class="nc" id="L1251">				= MacawMessages.getMessage(&quot;variable.saveChanges.valueChanged&quot;,</span>
											fieldName,
											oldAlternativeVariableName,
											revisedAlternativeVariableName);
	
<span class="nc" id="L1256">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.VARIABLE,
							   			changeMessage,
<span class="nc" id="L1259">							   			user.getUserID());</span>
	
<span class="nc" id="L1261">			int targetVariableID = originalVariable.getIdentifier();</span>
<span class="nc" id="L1262">			changeEvent.setVariableOwnerID(targetVariableID);</span>
<span class="nc" id="L1263">			changeEvent.setChangedObjectIdentifier(targetVariableID);</span>
<span class="nc" id="L1264">			return changeEvent;</span>
		}
		
<span class="nc" id="L1267">		return null;</span>
	}
	
	// ==========================================
	// Section Interfaces
	// ==========================================
	//Interface: Displayable
	public String getDisplayName() {
<span class="fc" id="L1275">		return getName();</span>
	}

	public String getDisplayItemIdentifier() {
<span class="nc" id="L1279">		return String.valueOf(identifier);</span>
	}

	//Interface: Clonable
	abstract public Object clone();

	// ==========================================
	// Section Overload
	// ==========================================

	protected void cloneAttributes(Variable cloneVariable) {
<span class="nc" id="L1290">		cloneVariable.setIdentifier(identifier);</span>
<span class="nc" id="L1291">		cloneVariable.setCategory(category);</span>
<span class="nc" id="L1292">		cloneVariable.setName(name);</span>
<span class="nc" id="L1293">		cloneVariable.setLabel(label);</span>
		
<span class="nc" id="L1295">		cloneVariable.setForm(form);</span>
<span class="nc" id="L1296">		cloneVariable.setQuestionNumber(questionNumber);</span>

<span class="nc" id="L1298">		cloneVariable.setYear(year);</span>
<span class="nc" id="L1299">		cloneVariable.setCleaned(isCleaned);</span>
<span class="nc" id="L1300">		cloneVariable.setCoded(isCoded);</span>
<span class="nc" id="L1301">		cloneVariable.setCleaningStatus(cleaningStatus);</span>
<span class="nc" id="L1302">		cloneVariable.setCleaningDescription(cleaningDescription);		</span>
		
<span class="nc" id="L1304">		cloneVariable.setCodeBookNumber(codeBookNumber);</span>
<span class="nc" id="L1305">		cloneVariable.setColumnStart(columnStart);</span>
<span class="nc" id="L1306">		cloneVariable.setColumnEnd(columnEnd);</span>

<span class="nc" id="L1308">		cloneVariable.setAvailability(availability);</span>
		
<span class="nc bnc" id="L1310" title="All 2 branches missed.">		for (ValueLabel valueLabel : valueLabels) {</span>
<span class="nc" id="L1311">			ValueLabel clonedValueLabel</span>
<span class="nc" id="L1312">				= (ValueLabel) valueLabel.clone();</span>
<span class="nc" id="L1313">			cloneVariable.addValueLabel(clonedValueLabel);</span>
<span class="nc" id="L1314">		}</span>
		
<span class="nc" id="L1316">		cloneVariable.setAlias(alias);</span>
<span class="nc" id="L1317">		cloneVariable.setFilePath(filePath);</span>
<span class="nc" id="L1318">		cloneVariable.setIsNewRecord(isNewRecord);</span>
		
		//make copies of references to supporting documents
<span class="nc" id="L1321">		ArrayList&lt;SupportingDocument&gt; cloneSupportingDocuments </span>
			= new ArrayList&lt;SupportingDocument&gt;();
<span class="nc bnc" id="L1323" title="All 2 branches missed.">		for(SupportingDocument supportingDocument : supportingDocuments) {</span>
<span class="nc" id="L1324">			cloneSupportingDocuments.add((SupportingDocument) supportingDocument.clone());</span>
<span class="nc" id="L1325">		}</span>
<span class="nc" id="L1326">		cloneVariable.setSupportingDocuments(cloneSupportingDocuments);</span>

<span class="nc" id="L1328">		ArrayList&lt;OntologyTerm&gt; cloneOntologyTerms </span>
			= new ArrayList&lt;OntologyTerm&gt;();
<span class="nc bnc" id="L1330" title="All 2 branches missed.">		for(OntologyTerm ontologyTerm : ontologyTerms) {</span>
<span class="nc" id="L1331">			cloneOntologyTerms.add((OntologyTerm) ontologyTerm.clone());</span>
<span class="nc" id="L1332">		}</span>
<span class="nc" id="L1333">		cloneVariable.setOntologyTerms(cloneOntologyTerms);</span>

		//we don't need 
<span class="nc bnc" id="L1336" title="All 2 branches missed.">		if (alternativeVariable != null) {</span>
<span class="nc" id="L1337">			Variable cloneAlternativeVariable</span>
<span class="nc" id="L1338">				= (Variable) alternativeVariable.clone();</span>
<span class="nc" id="L1339">			cloneVariable.setAlternativeVariable(cloneAlternativeVariable);</span>
		}
		
<span class="nc" id="L1342">		cloneVariable.setNotes(notes);</span>
<span class="nc" id="L1343">	}</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>