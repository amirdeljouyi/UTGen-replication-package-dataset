<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLListChoiceManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">69_lhamacaw</a> &gt; <a href="index.source.html" class="el_package">macaw.persistenceLayer.production</a> &gt; <span class="el_source">SQLListChoiceManager.java</span></div><h1>SQLListChoiceManager.java</h1><pre class="source lang-java linenums">package macaw.persistenceLayer.production;

import macaw.businessLayer.*;

import macaw.system.*;

import java.util.*;
import java.sql.*;

/**
 * &lt;p&gt;&lt;/p&gt;
 * &lt;hr&gt;
 * Copyright 2010 Medical Research Council Unit for Lifelong Health and Ageing
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *      http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software 
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.  
 * &lt;hr&gt;
 * @author Kevin Garwood (kgarwood@users.sourceforge.net)
 * @version 1.0	
 */

/*
 * Code Road Map:
 * --------------
 * Code is organised into the following sections.  Wherever possible, 
 * methods are classified based on an order of precedence described in 
 * parentheses (..).  For example, if you're trying to find a method 
 * 'getName(...)' that is both an interface method and an accessor 
 * method, the order tells you it should appear under interface.
 * 
 * Order of 
 * Precedence     Section
 * ==========     ======
 * (1)            Section Constants
 * (2)            Section Properties
 * (3)            Section Construction
 * (7)            Section Accessors and Mutators
 * (6)            Section Errors and Validation
 * (5)            Section Interfaces
 * (4)            Section Overload
 *
 */

public class SQLListChoiceManager extends SQLCurationConceptManager {

	// ==========================================
	// Section Constants
	// ==========================================
<span class="nc" id="L55">	private enum ListChoiceType {CATEGORY, CLEANING_STATE, AVAILABILITY_STATE, ALIAS_FILE_PATH};</span>
	
	// ==========================================
	// Section Properties
	// ==========================================
	
	// ==========================================
	// Section Construction
	// ==========================================
	public SQLListChoiceManager(SQLChangeEventManager changeEventManager) {
<span class="fc" id="L65">		super(changeEventManager);</span>
<span class="fc" id="L66">	}</span>
		
	public void createTables(Connection connection) throws MacawException {
		try {
<span class="nc" id="L70">			createCategoriesTable(connection);</span>
<span class="nc" id="L71">			createCleaningStatesTable(connection);</span>
<span class="nc" id="L72">			createAvailabilityStatesTable(connection);</span>
<span class="nc" id="L73">			createAliasFilePathTable(connection);					</span>
		}
<span class="nc" id="L75">		catch(SQLException exception) {</span>
<span class="nc" id="L76">			log.logException(exception);</span>
<span class="nc" id="L77">			String errorMessage</span>
<span class="nc" id="L78">				= MacawMessages.getMessage(&quot;sql.error.unableToCreateTables&quot;);</span>
<span class="nc" id="L79">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_CREATE_TABLES,
									 errorMessage);
<span class="nc" id="L82">			throw macawException;</span>
<span class="nc" id="L83">		}</span>
<span class="nc" id="L84">	}</span>
	
	/**
	 * creates table used to store data from {@link macaw.businessLayer.Category} objects.
	 */
	private void createCategoriesTable(Connection connection) throws  SQLException {
<span class="nc" id="L90">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L91">		query.append(&quot;CREATE TABLE categories ( &quot;);</span>
<span class="nc" id="L92">		query.append(&quot;identifier INT AUTO_INCREMENT NOT NULL,&quot;);</span>
<span class="nc" id="L93">		query.append(&quot;name VARCHAR(255),&quot;);</span>
<span class="nc" id="L94">		query.append(&quot;deleted_at DATETIME,&quot;);</span>
<span class="nc" id="L95">		query.append(&quot;PRIMARY KEY(identifier));&quot;);</span>
<span class="nc" id="L96">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L98">			statement</span>
<span class="nc" id="L99">				= connection.prepareStatement(query.toString());</span>
<span class="nc" id="L100">			statement.executeUpdate();							</span>
		}
		finally {
<span class="nc bnc" id="L103" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L104">				statement.close();</span>
			}
		}		
<span class="nc" id="L107">	}</span>

	/**
	 * creates table used to store data from {@link macaw.businessLayer.CleaningState} objects.
	 */
	private void createCleaningStatesTable(Connection connection) throws  SQLException {
<span class="nc" id="L113">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L114">		query.append(&quot;CREATE TABLE cleaning_states (&quot;);</span>
<span class="nc" id="L115">		query.append(&quot;identifier INT AUTO_INCREMENT NOT NULL,&quot;);</span>
<span class="nc" id="L116">		query.append(&quot;name VARCHAR(255),&quot;);</span>
<span class="nc" id="L117">		query.append(&quot;deleted_at DATETIME,&quot;);</span>
<span class="nc" id="L118">		query.append(&quot;PRIMARY KEY(identifier));&quot;);</span>
		
<span class="nc" id="L120">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L122">			statement</span>
<span class="nc" id="L123">				= connection.prepareStatement(query.toString());</span>
<span class="nc" id="L124">			statement.executeUpdate();							</span>
		}
		finally {
<span class="nc bnc" id="L127" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L128">				statement.close();</span>
			}
		}		
<span class="nc" id="L131">	}</span>
	
	/**
	 * creates table used to store data from {@link macaw.businessLayer.AvailabilityState} objects.
	 */
	private void createAvailabilityStatesTable(Connection connection) throws  SQLException {
<span class="nc" id="L137">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L138">		query.append(&quot;CREATE TABLE availability_states(&quot;);</span>
<span class="nc" id="L139">		query.append(&quot;identifier INT AUTO_INCREMENT NOT NULL,&quot;);		</span>
<span class="nc" id="L140">		query.append(&quot;name VARCHAR(255),&quot;);</span>
<span class="nc" id="L141">		query.append(&quot;deleted_at DATETIME,&quot;);</span>
<span class="nc" id="L142">		query.append(&quot;PRIMARY KEY(identifier));&quot;);</span>
		
<span class="nc" id="L144">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L146">			statement</span>
<span class="nc" id="L147">				= connection.prepareStatement(query.toString());</span>
<span class="nc" id="L148">			statement.executeUpdate();							</span>
		}
		finally {
<span class="nc bnc" id="L151" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L152">				statement.close();</span>
			}
		}		
<span class="nc" id="L155">	}</span>

	/**
	 * creates table used to store data from {@link macaw.model.DataLibrary} objects.
	 */
	private void createAliasFilePathTable(Connection connection) throws  SQLException {
<span class="nc" id="L161">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L162">		query.append(&quot;CREATE TABLE alias_file_paths(&quot;);</span>
<span class="nc" id="L163">		query.append(&quot;identifier INT AUTO_INCREMENT NOT NULL,&quot;);</span>
<span class="nc" id="L164">		query.append(&quot;alias VARCHAR(255),&quot;);</span>
<span class="nc" id="L165">		query.append(&quot;file_path VARCHAR(255),&quot;);</span>
<span class="nc" id="L166">		query.append(&quot;deleted_at DATETIME,&quot;);</span>
<span class="nc" id="L167">		query.append(&quot;PRIMARY KEY(identifier));&quot;);</span>

<span class="nc" id="L169">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L171">			statement</span>
<span class="nc" id="L172">				= connection.prepareStatement(query.toString());</span>
<span class="nc" id="L173">			statement.executeUpdate();							</span>
		}
		finally {
<span class="nc bnc" id="L176" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L177">				statement.close();</span>
			}
		}		
<span class="nc" id="L180">	}</span>
	
	// ==========================================
	// Section Accessors and Mutators
	// ==========================================
	public String getCategoryName(Connection connection, 
								  Variable variable,
								  int categoryID) throws MacawException {
		
<span class="nc bnc" id="L189" title="All 2 branches missed.">		if (categoryID == 0) {</span>
<span class="nc" id="L190">			String unknownValue </span>
<span class="nc" id="L191">				= MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;);</span>
<span class="nc" id="L192">			return unknownValue;</span>
		}
		
<span class="nc" id="L195">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L196">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L197">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L198">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L199">		query.append(&quot;identifier = ?;&quot;);</span>
		try {
<span class="nc" id="L201">			return getMacawListChoice(connection,</span>
									  variable,
									  ListChoiceType.CATEGORY,
									  categoryID, 
<span class="nc" id="L205">									  query.toString());</span>
		}
<span class="nc" id="L207">		catch(SQLException exception) {</span>
<span class="nc" id="L208">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L209">			String errorMessage </span>
<span class="nc" id="L210">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCategoryName&quot;);</span>
<span class="nc" id="L211">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CATEGORY_NAME,
									 errorMessage);
<span class="nc" id="L214">			throw macawException;</span>
		}
	}

	public ArrayList&lt;Category&gt; getCategories(Connection connection,
											 User user) throws MacawException {
<span class="nc" id="L220">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L221">		query.append(&quot;SELECT identifier, name &quot;);</span>
<span class="nc" id="L222">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L223">		query.append(&quot;WHERE deleted_at IS NULL &quot;);</span>
<span class="nc" id="L224">		query.append(&quot;ORDER BY name ASC;&quot;);</span>
		
<span class="nc" id="L226">		ResultSet resultSet = null;</span>
<span class="nc" id="L227">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L230">			ArrayList&lt;Category&gt; categories = new ArrayList&lt;Category&gt;();</span>
			
<span class="nc" id="L232">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L233">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">			while (resultSet.next() == true) {</span>
<span class="nc" id="L235">				Category category = new Category();</span>
<span class="nc" id="L236">				category.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L237">				category.setName(resultSet.getString(2));</span>
<span class="nc" id="L238">				categories.add(category);</span>
<span class="nc" id="L239">			}</span>
<span class="nc" id="L240">			return categories;</span>
		}
<span class="nc" id="L242">		catch(SQLException exception) {</span>
<span class="nc" id="L243">			exception.printStackTrace(System.out);</span>

<span class="nc" id="L245">			log.logException(exception);</span>
<span class="nc" id="L246">			String errorMessage</span>
<span class="nc" id="L247">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCategories&quot;);</span>
<span class="nc" id="L248">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CATEGORIES,
									 errorMessage);
<span class="nc" id="L251">			throw macawException;</span>
		}	
		finally {			
<span class="nc" id="L254">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}
	
	public void addCategory(Connection connection,
							User user,
							Category category) throws MacawException {
		
		//Part I: Validate parameters
<span class="nc" id="L263">		Category.validateFields(category);</span>
<span class="nc" id="L264">		checkCategoryDuplicates(connection, category);</span>

		//Part II: Perform the add category
<span class="nc" id="L267">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L268">		query.append(&quot;INSERT INTO categories (name, deleted_at) &quot;);</span>
<span class="nc" id="L269">		query.append(&quot;VALUES (?, ?);&quot;);</span>
		
		try {
<span class="nc" id="L272">			addListChoice(connection, </span>
<span class="nc" id="L273">						  query.toString(), </span>
<span class="nc" id="L274">						  category.getName());</span>
		}
<span class="nc" id="L276">		catch(SQLException exception) {</span>
<span class="nc" id="L277">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L278">			log.logException(exception);</span>
<span class="nc" id="L279">			String errorMessage</span>
<span class="nc" id="L280">				= MacawMessages.getMessage(&quot;sql.error.unableToAddCategory&quot;,</span>
<span class="nc" id="L281">											category.getDisplayName());</span>
<span class="nc" id="L282">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_CREATE_CATEGORY,
									 errorMessage);
<span class="nc" id="L285">			throw macawException;</span>
<span class="nc" id="L286">		}</span>
<span class="nc" id="L287">	}</span>
	
	public void updateCategory(Connection connection, 
							   User user,
			   				   Category revisedCategory) throws MacawException {

		
		//Part I: Validate parameters
<span class="nc" id="L295">		Category.validateFields(revisedCategory);</span>
<span class="nc" id="L296">		checkCategoryExists(connection, revisedCategory);</span>
<span class="nc" id="L297">		checkCategoryDuplicates(connection, revisedCategory);</span>
			
		//make sure that there are at least some changes
<span class="nc" id="L300">		Category originalCategory</span>
<span class="nc" id="L301">			= getOriginalCategory(connection, revisedCategory);		</span>
<span class="nc" id="L302">		ArrayList&lt;MacawChangeEvent&gt; changeEvents</span>
<span class="nc" id="L303">			= Category.detectFieldChanges(user,</span>
										  originalCategory,
										  revisedCategory);
<span class="nc bnc" id="L306" title="All 2 branches missed.">		if (changeEvents.size() == 0) {</span>
<span class="nc" id="L307">			return;</span>
		}

<span class="nc" id="L310">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L311">		query.append(&quot;UPDATE categories &quot;);</span>
<span class="nc" id="L312">		query.append(&quot;SET name=? &quot;);</span>
<span class="nc" id="L313">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L314">		query.append(&quot;identifier=?;&quot;);</span>
		
		try {
<span class="nc" id="L317">			updateListChoice(connection,</span>
<span class="nc" id="L318">			  		 		 query.toString(),</span>
<span class="nc" id="L319">			  		 		 revisedCategory.getIdentifier(),</span>
<span class="nc" id="L320">			  		 		 revisedCategory.getName());			</span>
		}
<span class="nc" id="L322">		catch(SQLException exception) {</span>
<span class="nc" id="L323">			log.logException(exception);</span>
<span class="nc" id="L324">			String errorMessage</span>
<span class="nc" id="L325">				= MacawMessages.getMessage(&quot;sql.error.unableToUpdateCategory&quot;,</span>
<span class="nc" id="L326">											revisedCategory.getDisplayName());</span>
<span class="nc" id="L327">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_UPDATE_CATEGORY,
									 errorMessage);
<span class="nc" id="L330">			throw macawException;</span>
<span class="nc" id="L331">		}		</span>
<span class="nc" id="L332">	}</span>
	
	public void deleteCategories(Connection connection, 
								 User user,
				 				 ArrayList&lt;Category&gt; categoriesToDelete) throws MacawException {
		
		//Part I: Validate parameters
<span class="nc bnc" id="L339" title="All 2 branches missed.">		if (categoriesToDelete.size() == 0) {</span>
<span class="nc" id="L340">			return;			</span>
		}
<span class="nc bnc" id="L342" title="All 2 branches missed.">		for (Category currentCategory : categoriesToDelete) {</span>
<span class="nc" id="L343">			checkCategoryExists(connection, currentCategory);</span>
<span class="nc" id="L344">		}</span>
		
		//Part II: Perform the delete categories operation		
<span class="nc" id="L347">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L348">		query.append(&quot;UPDATE categories &quot;);</span>
<span class="nc" id="L349">		query.append(&quot;SET deleted_at=NOW() &quot;);</span>
<span class="nc" id="L350">		query.append(&quot;WHERE identifier=?;&quot;);</span>
		
		try {
<span class="nc bnc" id="L353" title="All 2 branches missed.">			for (Category currentCategory : categoriesToDelete) {</span>
<span class="nc" id="L354">				deleteListChoice(connection, </span>
<span class="nc" id="L355">								 query.toString(), </span>
<span class="nc" id="L356">								 currentCategory.getIdentifier());</span>
<span class="nc" id="L357">			}</span>
		}
<span class="nc" id="L359">		catch(SQLException exception) {</span>
<span class="nc" id="L360">			log.logException(exception);</span>
<span class="nc" id="L361">			String errorMessage</span>
<span class="nc" id="L362">				= MacawMessages.getMessage(&quot;sql.error.unableToDeleteCategories&quot;);</span>
<span class="nc" id="L363">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_DELETE_CATEGORY,
									 errorMessage);
<span class="nc" id="L366">			throw macawException;</span>
<span class="nc" id="L367">		}</span>
<span class="nc" id="L368">	}</span>

	public String getCleaningStateName(Connection connection,
									   Variable variable,
									   int cleaningStateID) throws MacawException {

<span class="nc" id="L374">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L375">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L376">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L377">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L378">		query.append(&quot;identifier = ?;&quot;);</span>
		
		try {
<span class="nc" id="L381">			return getMacawListChoice(connection, </span>
									  variable,
									  ListChoiceType.CLEANING_STATE,
									  cleaningStateID, 
<span class="nc" id="L385">									  query.toString());</span>
		}
<span class="nc" id="L387">		catch(SQLException exception) {</span>
<span class="nc" id="L388">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L389">			String errorMessage </span>
<span class="nc" id="L390">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCleaningStateName&quot;);</span>
<span class="nc" id="L391">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CLEANING_STATE_NAME,
									 errorMessage);
<span class="nc" id="L394">			throw macawException;</span>
		}
	}
	
	public ArrayList&lt;CleaningState&gt; getCleaningStates(Connection connection,
													  User user) throws MacawException {
<span class="nc" id="L400">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L401">		query.append(&quot;SELECT identifier, name &quot;);</span>
<span class="nc" id="L402">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L403">		query.append(&quot;WHERE deleted_at IS NULL &quot;);</span>
<span class="nc" id="L404">		query.append(&quot;ORDER BY name ASC;&quot;);</span>
		
<span class="nc" id="L406">		ResultSet resultSet = null;</span>
<span class="nc" id="L407">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L410">			ArrayList&lt;CleaningState&gt; cleaningStates = new ArrayList&lt;CleaningState&gt;();</span>
			
<span class="nc" id="L412">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L413">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L414" title="All 2 branches missed.">			while (resultSet.next() == true) {</span>
<span class="nc" id="L415">				CleaningState cleaningState = new CleaningState();</span>
<span class="nc" id="L416">				cleaningState.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L417">				cleaningState.setName(resultSet.getString(2));</span>
<span class="nc" id="L418">				cleaningStates.add(cleaningState);</span>
<span class="nc" id="L419">			}</span>
<span class="nc" id="L420">			return cleaningStates;</span>
		}
<span class="nc" id="L422">		catch(SQLException exception) {</span>
<span class="nc" id="L423">			log.logException(exception);</span>
<span class="nc" id="L424">			String errorMessage</span>
<span class="nc" id="L425">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCleaningStates&quot;);</span>
<span class="nc" id="L426">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CLEANING_STATES,
									 errorMessage);
<span class="nc" id="L429">			throw macawException;</span>
		}
		finally {
<span class="nc" id="L432">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}

	public void addCleaningState(Connection connection,
								 CleaningState cleaningState) throws MacawException {

		//Part I: Validate parameters
<span class="nc" id="L440">		CleaningState.validateFields(cleaningState);</span>
<span class="nc" id="L441">		checkCleaningStateDuplicates(connection, cleaningState);</span>

<span class="nc" id="L443">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L444">		query.append(&quot;INSERT INTO cleaning_states (name, deleted_at) &quot;);</span>
<span class="nc" id="L445">		query.append(&quot;VALUES (?, ?);&quot;);</span>
		
		try {
<span class="nc" id="L448">			addListChoice(connection, </span>
<span class="nc" id="L449">						  query.toString(),</span>
<span class="nc" id="L450">						  cleaningState.getName());</span>
		}
<span class="nc" id="L452">		catch(SQLException exception) {</span>
<span class="nc" id="L453">			log.logException(exception);</span>
<span class="nc" id="L454">			String errorMessage</span>
<span class="nc" id="L455">				= MacawMessages.getMessage(&quot;sql.error.unableToAddCleaningState&quot;,</span>
<span class="nc" id="L456">											cleaningState.getDisplayName());</span>
<span class="nc" id="L457">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_CREATE_CLEANING_STATE,
									 errorMessage);
<span class="nc" id="L460">			throw macawException;</span>
<span class="nc" id="L461">		}	</span>
<span class="nc" id="L462">	}</span>

	public void updateCleaningState(Connection connection, 
									User user,
			   				   	    CleaningState revisedCleaningState) throws MacawException {


		//Part I: Validate parameters
<span class="nc" id="L470">		CleaningState.validateFields(revisedCleaningState);</span>
<span class="nc" id="L471">		checkCleaningStateExists(connection, revisedCleaningState);</span>
<span class="nc" id="L472">		checkCleaningStateDuplicates(connection, revisedCleaningState);</span>

<span class="nc" id="L474">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L475">		query.append(&quot;UPDATE cleaning_states &quot;);</span>
<span class="nc" id="L476">		query.append(&quot;SET name=? &quot;);</span>
<span class="nc" id="L477">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L478">		query.append(&quot;identifier=?;&quot;);</span>
		try {			
<span class="nc" id="L480">			updateListChoice(connection,</span>
<span class="nc" id="L481">							 query.toString(),</span>
<span class="nc" id="L482">							 revisedCleaningState.getIdentifier(),</span>
<span class="nc" id="L483">							 revisedCleaningState.getName());</span>
		}
<span class="nc" id="L485">		catch(SQLException exception) {</span>
<span class="nc" id="L486">			log.logException(exception);</span>
<span class="nc" id="L487">			String errorMessage</span>
<span class="nc" id="L488">				= MacawMessages.getMessage(&quot;sql.error.unableToUpdateCleaningState&quot;,</span>
<span class="nc" id="L489">											revisedCleaningState.getDisplayName());</span>
<span class="nc" id="L490">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_UPDATE_CLEANING_STATE,
									 errorMessage);
<span class="nc" id="L493">			throw macawException;</span>
<span class="nc" id="L494">		}	</span>
<span class="nc" id="L495">	}</span>
	
	public void deleteCleaningStates(Connection connection, 
									 ArrayList&lt;CleaningState&gt; cleaningStatesToDelete) throws MacawException {

		
		//Part I: Validate parameters
<span class="nc bnc" id="L502" title="All 2 branches missed.">		if (cleaningStatesToDelete.size() == 0) {</span>
<span class="nc" id="L503">			return;			</span>
		}
<span class="nc bnc" id="L505" title="All 2 branches missed.">		for (CleaningState currentCleaningState : cleaningStatesToDelete) {</span>
<span class="nc" id="L506">			checkCleaningStateExists(connection, currentCleaningState);</span>
<span class="nc" id="L507">		}</span>

<span class="nc" id="L509">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L510">		query.append(&quot;UPDATE cleaning_states &quot;);</span>
<span class="nc" id="L511">		query.append(&quot;SET deleted_at=NOW() &quot;);</span>
<span class="nc" id="L512">		query.append(&quot;WHERE identifier=?;&quot;);</span>

		try {
<span class="nc bnc" id="L515" title="All 2 branches missed.">			for (CleaningState currentCleaningState : cleaningStatesToDelete) {</span>
<span class="nc" id="L516">				deleteListChoice(connection, </span>
<span class="nc" id="L517">								 query.toString(), </span>
<span class="nc" id="L518">								 currentCleaningState.getIdentifier());</span>
<span class="nc" id="L519">			}</span>
		}
<span class="nc" id="L521">		catch(SQLException exception) {</span>
<span class="nc" id="L522">			log.logException(exception);</span>
<span class="nc" id="L523">			String errorMessage</span>
<span class="nc" id="L524">				= MacawMessages.getMessage(&quot;sql.error.unableToDeleteCleaningStates&quot;);</span>
<span class="nc" id="L525">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_DELETE_CLEANING_STATE,
									 errorMessage);
<span class="nc" id="L528">			throw macawException;</span>
<span class="nc" id="L529">		}</span>
<span class="nc" id="L530">	}</span>

	public String getAvailabilityStateName(Connection connection, 
										   Variable variable,
										   int availabilityStateID) throws MacawException {
<span class="nc" id="L535">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L536">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L537">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L538">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L539">		query.append(&quot;identifier=?;&quot;);</span>
		
		try {
<span class="nc" id="L542">			return getMacawListChoice(connection, </span>
									  variable,
					  				  ListChoiceType.AVAILABILITY_STATE,
									  availabilityStateID, 
<span class="nc" id="L546">									  query.toString());</span>
		}
<span class="nc" id="L548">		catch(SQLException exception) {</span>
<span class="nc" id="L549">			String errorMessage </span>
<span class="nc" id="L550">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAvailabilityStateName&quot;);</span>
<span class="nc" id="L551">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_AVAILABILITY_STATE_NAME,
									 errorMessage);
<span class="nc" id="L554">			throw macawException;</span>
		}
	}

	public ArrayList&lt;AvailabilityState&gt; getAvailabilityStates(Connection connection) throws MacawException {
<span class="nc" id="L559">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L560">		query.append(&quot;SELECT identifier, name &quot;);</span>
<span class="nc" id="L561">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L562">		query.append(&quot;WHERE deleted_at IS NULL &quot;);</span>
<span class="nc" id="L563">		query.append(&quot;ORDER BY name ASC;&quot;);</span>
		
<span class="nc" id="L565">		ResultSet resultSet = null;</span>
<span class="nc" id="L566">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L569">			ArrayList&lt;AvailabilityState&gt; availabilityStates </span>
				= new ArrayList&lt;AvailabilityState&gt;();
			
<span class="nc" id="L572">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L573">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">			while (resultSet.next() == true) {</span>
<span class="nc" id="L575">				AvailabilityState availabilityState = new AvailabilityState();</span>
<span class="nc" id="L576">				availabilityState.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L577">				availabilityState.setName(resultSet.getString(2));</span>
<span class="nc" id="L578">				availabilityStates.add(availabilityState);</span>
<span class="nc" id="L579">			}</span>
<span class="nc" id="L580">			return availabilityStates;</span>
		}
<span class="nc" id="L582">		catch(SQLException exception) {</span>
<span class="nc" id="L583">			exception.printStackTrace(System.out);</span>
			//log.logException(exception);
<span class="nc" id="L585">			String errorMessage</span>
<span class="nc" id="L586">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAvailabilityStates&quot;);</span>
<span class="nc" id="L587">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_AVAILABILITY_STATES,
									 errorMessage);
<span class="nc" id="L590">			throw macawException;</span>
		}	
		finally {
<span class="nc" id="L593">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}
	
	public void addAvailabilityState(Connection connection,
									 User user,
			 					 	 AvailabilityState availabilityState) throws MacawException {

		//Part I: Validate parameters
<span class="nc" id="L602">		AvailabilityState.validateFields(availabilityState);</span>
<span class="nc" id="L603">		checkAvailabilityStateDuplicates(connection, availabilityState);</span>

<span class="nc" id="L605">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L606">		query.append(&quot;INSERT INTO availability_states (name, deleted_at) &quot;);</span>
<span class="nc" id="L607">		query.append(&quot;VALUES (?, ?);&quot;);</span>
		try {
<span class="nc" id="L609">			addListChoice(connection,</span>
<span class="nc" id="L610">						  query.toString(),</span>
<span class="nc" id="L611">						  availabilityState.getName());</span>
			
			//Part III: Record changes
<span class="nc" id="L614">			String changeMessage</span>
<span class="nc" id="L615">				= MacawMessages.getMessage(&quot;availabilityState.saveChanges.newRecord&quot;,</span>
<span class="nc" id="L616">										   availabilityState.getDisplayName() );</span>
<span class="nc" id="L617">			MacawChangeEvent changeEvent</span>
				= new MacawChangeEvent(ChangeEventType.LIST_CHOICE,
									   changeMessage,
<span class="nc" id="L620">									   user.getUserID() );</span>
<span class="nc" id="L621">			registerChangeEvent(connection,</span>
								changeEvent);
		}
<span class="nc" id="L624">		catch(SQLException exception) {</span>
<span class="nc" id="L625">			log.logException(exception);</span>
<span class="nc" id="L626">			String errorMessage</span>
<span class="nc" id="L627">				= MacawMessages.getMessage(&quot;sql.error.unableToAddAvailabilityState&quot;,</span>
<span class="nc" id="L628">											availabilityState.getDisplayName());</span>
<span class="nc" id="L629">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_CREATE_AVAILABILITY_STATE,
									 errorMessage);
<span class="nc" id="L632">			throw macawException;</span>
<span class="nc" id="L633">		}</span>
<span class="nc" id="L634">	}</span>

	public void updateAvailabilityState(Connection connection, 
		   	    						AvailabilityState revisedAvailabilityState) throws MacawException {


		//Part I: Validate parameters
<span class="nc" id="L641">		AvailabilityState.validateFields(revisedAvailabilityState);</span>
<span class="nc" id="L642">		checkAvailabilityStateExists(connection, revisedAvailabilityState);</span>
<span class="nc" id="L643">		checkAvailabilityStateDuplicates(connection, revisedAvailabilityState);</span>

<span class="nc" id="L645">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L646">		query.append(&quot;UPDATE availability_states &quot;);</span>
<span class="nc" id="L647">		query.append(&quot;SET name=? &quot;);</span>
<span class="nc" id="L648">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L649">		query.append(&quot;identifier=?;&quot;);</span>
		try {			
<span class="nc" id="L651">			updateListChoice(connection,</span>
<span class="nc" id="L652">							 query.toString(),</span>
<span class="nc" id="L653">							 revisedAvailabilityState.getIdentifier(),</span>
<span class="nc" id="L654">							 revisedAvailabilityState.getName());</span>
		}
<span class="nc" id="L656">		catch(SQLException exception) {</span>
<span class="nc" id="L657">			log.logException(exception);</span>
<span class="nc" id="L658">			String errorMessage</span>
<span class="nc" id="L659">				= MacawMessages.getMessage(&quot;sql.error.unableToUpdateAvailabilityState&quot;,</span>
<span class="nc" id="L660">											revisedAvailabilityState.getDisplayName());</span>
<span class="nc" id="L661">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_UPDATE_AVAILABILITY_STATE,
									 errorMessage);
<span class="nc" id="L664">			throw macawException;</span>
<span class="nc" id="L665">		}</span>
<span class="nc" id="L666">	}</span>

	public void deleteAvailabilityStates(Connection connection, 
										 ArrayList&lt;AvailabilityState&gt; availabilityStatesToDelete) throws MacawException {

		//Part I: Validate parameters
<span class="nc bnc" id="L672" title="All 2 branches missed.">		if (availabilityStatesToDelete.size() == 0) {</span>
<span class="nc" id="L673">			return;			</span>
		}
		
<span class="nc bnc" id="L676" title="All 2 branches missed.">		for (AvailabilityState currentAvailabilityState : availabilityStatesToDelete) {</span>
<span class="nc" id="L677">			checkAvailabilityStateExists(connection, currentAvailabilityState);</span>
<span class="nc" id="L678">		}</span>
				
<span class="nc" id="L680">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L681">		query.append(&quot;UPDATE availability_states &quot;);</span>
<span class="nc" id="L682">		query.append(&quot;SET deleted_at=NOW() &quot;);</span>
<span class="nc" id="L683">		query.append(&quot;WHERE identifier=?;&quot;);</span>
		
		try {
<span class="nc bnc" id="L686" title="All 2 branches missed.">			for (AvailabilityState currentAvailabilityState : availabilityStatesToDelete) {</span>
<span class="nc" id="L687">				deleteListChoice(connection, </span>
<span class="nc" id="L688">								 query.toString(), </span>
<span class="nc" id="L689">								 currentAvailabilityState.getIdentifier());</span>
<span class="nc" id="L690">			}</span>
		}
<span class="nc" id="L692">		catch(SQLException exception) {</span>
<span class="nc" id="L693">			log.logException(exception);</span>
<span class="nc" id="L694">			String errorMessage</span>
<span class="nc" id="L695">				= MacawMessages.getMessage(&quot;sql.error.unableToDeleteAvailabilityStates&quot;);</span>
<span class="nc" id="L696">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_DELETE_AVAILABILITY_STATE,
									 errorMessage);
<span class="nc" id="L699">			throw macawException;</span>
<span class="nc" id="L700">		}</span>
<span class="nc" id="L701">	}</span>

	public String getAliasFilePathName(Connection connection, 
									   Variable variable,
									   int dataLibraryID) throws MacawException {
<span class="nc" id="L706">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L707">		query.append(&quot;SELECT alias &quot;);</span>
<span class="nc" id="L708">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L709">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L710">		query.append(&quot;identifier=?;&quot;);</span>
		
		try {
<span class="nc" id="L713">			return getMacawListChoice(connection, </span>
									  variable,
	  				  				  ListChoiceType.ALIAS_FILE_PATH,
									  dataLibraryID, 
<span class="nc" id="L717">									  query.toString());</span>
		}
<span class="nc" id="L719">		catch(SQLException exception) {</span>
<span class="nc" id="L720">			String errorMessage </span>
<span class="nc" id="L721">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAliasFilePathName&quot;);</span>
<span class="nc" id="L722">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ALIAS_FILE_PATH_NAME,
									 errorMessage);
<span class="nc" id="L725">			throw macawException;</span>
		}
	}

	public ArrayList&lt;AliasFilePath&gt; getAliasFilePaths(Connection connection) throws MacawException {
<span class="nc" id="L730">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L731">		query.append(&quot;SELECT identifier,&quot;);</span>
<span class="nc" id="L732">		query.append(&quot;alias,&quot;);</span>
<span class="nc" id="L733">		query.append(&quot;file_path &quot;);</span>
<span class="nc" id="L734">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L735">		query.append(&quot;WHERE deleted_at IS NULL &quot;);</span>
<span class="nc" id="L736">		query.append(&quot;ORDER BY alias ASC;&quot;);</span>
		
<span class="nc" id="L738">		ResultSet resultSet = null;</span>
<span class="nc" id="L739">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L742">			ArrayList&lt;AliasFilePath&gt; aliasFilePaths </span>
				= new ArrayList&lt;AliasFilePath&gt;();
			
<span class="nc" id="L745">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L746">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L747" title="All 2 branches missed.">			while (resultSet.next() == true) {</span>
<span class="nc" id="L748">				AliasFilePath aliasFilePath = new AliasFilePath();</span>
<span class="nc" id="L749">				aliasFilePath.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L750">				aliasFilePath.setAlias(resultSet.getString(2));</span>
<span class="nc" id="L751">				aliasFilePath.setFilePath(resultSet.getString(3));</span>
<span class="nc" id="L752">				aliasFilePaths.add(aliasFilePath);</span>
<span class="nc" id="L753">			}</span>
<span class="nc" id="L754">			return aliasFilePaths;</span>
		}
<span class="nc" id="L756">		catch(SQLException exception) {</span>
<span class="nc" id="L757">			log.logException(exception);</span>
<span class="nc" id="L758">			String errorMessage</span>
<span class="nc" id="L759">				= MacawMessages.getMessage(&quot;sql.error.unableToGetDataLibraries&quot;);</span>
<span class="nc" id="L760">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L763">			throw macawException;</span>
		}	
		finally {
<span class="nc" id="L766">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}

	public AliasFilePath getAliasFilePath(Connection connection, String cardNumber) throws MacawException {
<span class="nc" id="L771">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L772">		query.append(&quot;SELECT identifier,&quot;);</span>
<span class="nc" id="L773">		query.append(&quot;file_path &quot;);</span>
<span class="nc" id="L774">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L775">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L776">		query.append(&quot;alias=? &quot;);</span>
<span class="nc" id="L777">		query.append(&quot;ORDER BY alias ASC;&quot;);</span>
		
<span class="nc" id="L779">		ResultSet resultSet = null;</span>
<span class="nc" id="L780">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L783">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L784">			statement.setString(1, cardNumber);</span>
<span class="nc" id="L785">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L787">				AliasFilePath aliasFilePath = new AliasFilePath();</span>
<span class="nc" id="L788">				aliasFilePath.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L789">				aliasFilePath.setFilePath(resultSet.getString(2));</span>
<span class="nc" id="L790">				aliasFilePath.setAlias(cardNumber);</span>
<span class="nc" id="L791">				return aliasFilePath;</span>
			}
			else {
<span class="nc" id="L794">				return null;</span>
			}
		}
<span class="nc" id="L797">		catch(SQLException exception) {		</span>
<span class="nc" id="L798">			log.logException(exception);</span>
<span class="nc" id="L799">			String errorMessage</span>
<span class="nc" id="L800">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAliasFilePaths&quot;);</span>
<span class="nc" id="L801">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L804">			throw macawException;</span>
		}	
		finally {
<span class="nc" id="L807">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}

	public ArrayList&lt;AliasFilePath&gt; getAliasFilePathsMatchingName(Connection connection, 
													 			  String cardNumberExpression) throws MacawException {
<span class="nc" id="L813">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L814">		query.append(&quot;SELECT identifier,&quot;);</span>
<span class="nc" id="L815">		query.append(&quot;alias,&quot;);</span>
<span class="nc" id="L816">		query.append(&quot;file_path &quot;);</span>
<span class="nc" id="L817">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L818">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L819">		query.append(&quot;alias LIKE ? &quot;);</span>
<span class="nc" id="L820">		query.append(&quot;ORDER BY alias ASC;&quot;);</span>
		
<span class="nc" id="L822">		ArrayList&lt;AliasFilePath&gt; aliasFilePaths = new ArrayList&lt;AliasFilePath&gt;();</span>
		
<span class="nc" id="L824">		ResultSet resultSet = null;</span>
<span class="nc" id="L825">		PreparedStatement statement = null;		</span>
		try {
			
<span class="nc" id="L828">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L829">			StringBuilder searchCriterion = new StringBuilder();</span>
<span class="nc" id="L830">			searchCriterion.append(&quot;%&quot;);</span>
<span class="nc" id="L831">			searchCriterion.append(cardNumberExpression);</span>
<span class="nc" id="L832">			searchCriterion.append(&quot;%&quot;);</span>
			
<span class="nc" id="L834">			statement.setString(1, searchCriterion.toString());</span>
<span class="nc" id="L835">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L836" title="All 2 branches missed.">			while (resultSet.next() == true) {</span>
<span class="nc" id="L837">				AliasFilePath aliasFilePath = new AliasFilePath();</span>
<span class="nc" id="L838">				aliasFilePath.setIdentifier(resultSet.getInt(1));</span>
<span class="nc" id="L839">				aliasFilePath.setAlias(resultSet.getString(2));</span>
<span class="nc" id="L840">				aliasFilePath.setFilePath(resultSet.getString(3));</span>
<span class="nc" id="L841">				aliasFilePaths.add(aliasFilePath);</span>
<span class="nc" id="L842">			}</span>
			
<span class="nc" id="L844">			return aliasFilePaths;</span>
		}
<span class="nc" id="L846">		catch(SQLException exception) {</span>
<span class="nc" id="L847">			log.logException(exception);</span>
<span class="nc" id="L848">			String errorMessage</span>
<span class="nc" id="L849">				= MacawMessages.getMessage(&quot;sql.error.unableToGetDataLibraries&quot;);</span>
<span class="nc" id="L850">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L853">			throw macawException;</span>
		}	
		finally {
<span class="nc" id="L856">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}

	public void addAliasFilePath(Connection connection,
		 	 				     AliasFilePath aliasFilePath) throws MacawException {

		//Part I: Validate parameters
<span class="nc" id="L864">		AliasFilePath.validateFields(aliasFilePath);</span>
<span class="nc" id="L865">		checkAliasFilePathDuplicates(connection, aliasFilePath);</span>

<span class="nc" id="L867">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L868">		query.append(&quot;INSERT INTO alias_file_paths (alias, file_path, deleted_at) &quot;);</span>
<span class="nc" id="L869">		query.append(&quot;VALUES (?, ?, ?);&quot;);</span>
<span class="nc" id="L870">		ResultSet resultSet = null;</span>
<span class="nc" id="L871">		PreparedStatement statement = null;		</span>
		try {
<span class="nc" id="L873">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L874">			statement.setString(1, aliasFilePath.getAlias());</span>
<span class="nc" id="L875">			statement.setString(2, aliasFilePath.getFilePath());</span>
<span class="nc" id="L876">			statement.setDate(3, null);</span>
<span class="nc" id="L877">			statement.executeUpdate();</span>
		}
<span class="nc" id="L879">		catch(SQLException exception) {</span>
<span class="nc" id="L880">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L881">			log.logException(exception);</span>
<span class="nc" id="L882">			String errorMessage</span>
<span class="nc" id="L883">				= MacawMessages.getMessage(&quot;sql.error.unableToAddAliasFilePath&quot;,</span>
<span class="nc" id="L884">											aliasFilePath.getDisplayName());</span>
<span class="nc" id="L885">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_CREATE_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L888">			throw macawException;</span>
		}
		finally {
<span class="nc" id="L891">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L893">	}</span>

	public void updateAliasFilePath(Connection connection, 
								    User user,
		   	    				  	AliasFilePath revisedAliasFilePath) throws MacawException {

		//Part I: Validate parameters
<span class="nc" id="L900">		AliasFilePath.validateFields(revisedAliasFilePath);</span>
<span class="nc" id="L901">		checkAliasFilePathExists(connection, revisedAliasFilePath);</span>
<span class="nc" id="L902">		checkAliasFilePathDuplicates(connection, revisedAliasFilePath);</span>

		//ensure there are at least some changes
<span class="nc" id="L905">		AliasFilePath originalAliasFilePath</span>
<span class="nc" id="L906">			= getOriginalAliasFilePath(connection, revisedAliasFilePath);		</span>
<span class="nc" id="L907">		ArrayList&lt;MacawChangeEvent&gt; changeEvents</span>
<span class="nc" id="L908">			= AliasFilePath.detectFieldChanges(user,</span>
											   originalAliasFilePath,
											   revisedAliasFilePath);
<span class="nc bnc" id="L911" title="All 2 branches missed.">		if (changeEvents.size() == 0) {</span>
<span class="nc" id="L912">			return;</span>
		}
		
<span class="nc" id="L915">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L916">		query.append(&quot;UPDATE alias_file_paths &quot;);</span>
<span class="nc" id="L917">		query.append(&quot;SET alias=?,file_path=? &quot;);</span>
<span class="nc" id="L918">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L919">		query.append(&quot;identifier=?;&quot;);</span>
		
<span class="nc" id="L921">		PreparedStatement statement = null;</span>
		
		try {
<span class="nc" id="L924">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L925">			statement.setString(1, revisedAliasFilePath.getAlias());</span>
<span class="nc" id="L926">			statement.setString(2, revisedAliasFilePath.getFilePath());</span>
<span class="nc" id="L927">			statement.setInt(3, revisedAliasFilePath.getIdentifier());</span>
<span class="nc" id="L928">			statement.executeUpdate();</span>
		}
<span class="nc" id="L930">		catch(SQLException exception) {</span>
<span class="nc" id="L931">			log.logException(exception);</span>
<span class="nc" id="L932">			String errorMessage</span>
<span class="nc" id="L933">				= MacawMessages.getMessage(&quot;sql.error.unableToUpdateAliasFilePath&quot;,</span>
<span class="nc" id="L934">											revisedAliasFilePath.getDisplayName());</span>
<span class="nc" id="L935">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_UPDATE_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L938">			throw macawException;</span>
<span class="nc" id="L939">		}</span>
<span class="nc" id="L940">	}</span>
	
	public void deleteAliasFilePaths(Connection connection, 
									 ArrayList&lt;AliasFilePath&gt; aliasFilePathsToDelete) throws MacawException {

		
		//Part I: Validate parameters
<span class="nc bnc" id="L947" title="All 2 branches missed.">		if (aliasFilePathsToDelete.size() == 0) {</span>
<span class="nc" id="L948">			return;			</span>
		}
<span class="nc bnc" id="L950" title="All 2 branches missed.">		for (AliasFilePath currentAliasFilePath : aliasFilePathsToDelete) {</span>
<span class="nc" id="L951">			checkAliasFilePathExists(connection, currentAliasFilePath);</span>
<span class="nc" id="L952">		}</span>

<span class="nc" id="L954">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L955">		query.append(&quot;UPDATE alias_file_paths &quot;);</span>
<span class="nc" id="L956">		query.append(&quot;SET deleted_at=NOW() &quot;);</span>
<span class="nc" id="L957">		query.append(&quot;WHERE identifier=?;&quot;);</span>
						
		try {
<span class="nc bnc" id="L960" title="All 2 branches missed.">			for (AliasFilePath currentAliasFilePath : aliasFilePathsToDelete) {</span>
<span class="nc" id="L961">				deleteListChoice(connection, </span>
<span class="nc" id="L962">								 query.toString(),				 </span>
<span class="nc" id="L963">								 currentAliasFilePath.getIdentifier());</span>
<span class="nc" id="L964">			}</span>
		}
<span class="nc" id="L966">		catch(SQLException exception) {</span>
<span class="nc" id="L967">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L968">			log.logException(exception);</span>
<span class="nc" id="L969">			String errorMessage</span>
<span class="nc" id="L970">				= MacawMessages.getMessage(&quot;sql.error.unableToDeleteAliasFilePaths&quot;);</span>
<span class="nc" id="L971">			MacawException macawException </span>
				= new MacawException(MacawErrorType.UNABLE_TO_DELETE_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L974">			throw macawException;</span>
<span class="nc" id="L975">		}</span>
<span class="nc" id="L976">	}</span>
	
	private String getMacawListChoice(Connection connection, 
									  Variable variable,
									  ListChoiceType listChoiceType,
									  int listChoiceIdentifier,
									  String query) throws SQLException, MacawException {
		
<span class="nc" id="L984">		String variableName </span>
<span class="nc" id="L985">			= MacawMessages.getMessage(&quot;listChoices.unknownVariableName&quot;);	</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">		if (variable != null) {</span>
<span class="nc" id="L987">			variableName = variable.getDisplayName();</span>
		}
				
<span class="nc bnc" id="L990" title="All 2 branches missed.">		if (listChoiceIdentifier == 0) {</span>
			//will be the case if someone hasn't assigned a category
<span class="nc" id="L992">			return(MacawMessages.getMessage(&quot;general.fieldValue.unknown&quot;));			</span>
		}
		
<span class="nc" id="L995">		ResultSet resultSet = null;</span>
<span class="nc" id="L996">		PreparedStatement statement = null;		</span>
		try {
<span class="nc" id="L998">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L999">			statement.setInt(1, listChoiceIdentifier);</span>
<span class="nc" id="L1000">			resultSet = statement.executeQuery();</span>
			//assume exactly one result comes back
<span class="nc bnc" id="L1002" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1003">				String name = resultSet.getString(1);</span>
<span class="nc" id="L1004">				return name;				</span>
			}
			else {
<span class="nc" id="L1007">				MacawException macawException = new MacawException();</span>
<span class="nc bnc" id="L1008" title="All 2 branches missed.">				if (listChoiceType == ListChoiceType.CATEGORY) {</span>
<span class="nc" id="L1009">					String errorMessage = MacawMessages.getMessage(&quot;category.error.nonExistent&quot;,</span>
																	variableName);
<span class="nc" id="L1011">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_CATEGORY,</span>
												   errorMessage);
<span class="nc" id="L1013">				}</span>
<span class="nc bnc" id="L1014" title="All 2 branches missed.">				else if (listChoiceType == ListChoiceType.AVAILABILITY_STATE) {</span>
<span class="nc" id="L1015">					String errorMessage = MacawMessages.getMessage(&quot;availability.error.nonExistent&quot;,</span>
																	variableName);
<span class="nc" id="L1017">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_AVAILABILITY_STATE,</span>
												   errorMessage);					
<span class="nc" id="L1019">				}</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">				else if (listChoiceType == ListChoiceType.CLEANING_STATE) {</span>
<span class="nc" id="L1021">					String errorMessage = MacawMessages.getMessage(&quot;cleaningState.error.nonExistent&quot;,</span>
																	variableName);
<span class="nc" id="L1023">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_CLEANING_STATE,</span>
												   errorMessage);					
<span class="nc" id="L1025">				}</span>
				else {
<span class="nc" id="L1027">					String errorMessage = MacawMessages.getMessage(&quot;dataLibrary.error.nonExistent&quot;,</span>
																	variableName);
<span class="nc" id="L1029">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_ALIAS_FILE_PATH,</span>
												   errorMessage);					
				}
<span class="nc" id="L1032">				throw macawException;</span>
			}
		}
		finally {
<span class="nc" id="L1036">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
	}

	private void addListChoice(Connection connection,
			  				   String query,
			  				   String name) throws SQLException, MacawException {

<span class="nc" id="L1044">		ResultSet resultSet = null;</span>
<span class="nc" id="L1045">		PreparedStatement statement = null;		</span>
		try {			
<span class="nc" id="L1047">			statement = connection.prepareStatement(query);</span>
<span class="nc" id="L1048">			statement.setString(1, name);</span>
<span class="nc" id="L1049">			statement.setDate(2, null);</span>
<span class="nc" id="L1050">			statement.executeUpdate();</span>
		}
		finally {
<span class="nc" id="L1053">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L1055">	}</span>

	private void deleteListChoice(Connection connection,
			   					  String query,
			   					  int listChoiceIdentifier) throws SQLException {

<span class="nc" id="L1061">		PreparedStatement statement = null;		</span>
		try {			
<span class="nc" id="L1063">			statement = connection.prepareStatement(query);</span>
			//Time deletionDate = new Time(System.currentTimeMillis());
			//statement.setTime(1, deletionDate);
<span class="nc" id="L1066">			statement.setInt(1, listChoiceIdentifier);</span>
<span class="nc" id="L1067">			statement.executeUpdate();</span>
		}
		finally {
<span class="nc bnc" id="L1070" title="All 2 branches missed.">			if (statement != null) {</span>
<span class="nc" id="L1071">				statement.close();</span>
			}
		}	
<span class="nc" id="L1074">	}</span>
	
	private void updateListChoice(Connection connection,
								  String query,
								  int identifier,
								  String name) throws SQLException {

<span class="nc" id="L1081">		ResultSet resultSet = null;</span>
<span class="nc" id="L1082">		PreparedStatement statement = null;		</span>
		try {			
<span class="nc" id="L1084">			statement = connection.prepareStatement(query);</span>
<span class="nc" id="L1085">			statement.setString(1, name);</span>
<span class="nc" id="L1086">			statement.setInt(2, identifier);</span>
<span class="nc" id="L1087">			statement.executeUpdate();</span>
		}
		finally {
<span class="nc" id="L1090">			SQLUtilities.closeStatementsWithoutCatch(statement, resultSet);</span>
		}	
<span class="nc" id="L1092">	}</span>

	public int getAvailabilityStateIdentifier(Connection connection,
											  Variable variable,
			  								  AvailabilityState availabilityState) throws MacawException {
		
<span class="nc" id="L1098">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1099">		query.append(&quot;SELECT identifier &quot;);</span>
<span class="nc" id="L1100">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L1101">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1102">		query.append(&quot;name=?;&quot;);</span>

		try {	
<span class="nc" id="L1105">			int identifier</span>
<span class="nc" id="L1106">				= getIdentifierFromName(connection,</span>
										variable,
										ListChoiceType.AVAILABILITY_STATE,
<span class="nc" id="L1109">										query.toString(),</span>
<span class="nc" id="L1110">										availabilityState.getName());</span>
<span class="nc" id="L1111">			return identifier;</span>
		}
<span class="nc" id="L1113">		catch(SQLException exception) {</span>
<span class="nc" id="L1114">			String errorMessage</span>
<span class="nc" id="L1115">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAvailabilityStateIdentifier&quot;,</span>
<span class="nc" id="L1116">											availabilityState.getDisplayName());</span>
<span class="nc" id="L1117">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_AVAILABILITY_STATE_IDENTIFIER,
									 errorMessage);
<span class="nc" id="L1120">			throw macawException;			</span>
		}
	}

	public int getCategoryIdentifier(Connection connection,
									 Variable variable,
								     Category category) throws MacawException {

<span class="nc" id="L1128">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1129">		query.append(&quot;SELECT identifier &quot;);</span>
<span class="nc" id="L1130">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L1131">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1132">		query.append(&quot;name=?;&quot;);</span>
		
		try {
<span class="nc" id="L1135">			int identifier</span>
<span class="nc" id="L1136">				= getIdentifierFromName(connection, </span>
										variable,
										ListChoiceType.CATEGORY,
<span class="nc" id="L1139">										query.toString(),</span>
<span class="nc" id="L1140">										category.getName());</span>
<span class="nc" id="L1141">			return identifier;</span>
		}
<span class="nc" id="L1143">		catch(SQLException exception) {</span>
<span class="nc" id="L1144">			String errorMessage</span>
<span class="nc" id="L1145">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCategoryIdentifier&quot;,</span>
<span class="nc" id="L1146">										   category.getDisplayName());</span>
<span class="nc" id="L1147">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CATEGORY_IDENTIFIER,
									 errorMessage);
<span class="nc" id="L1150">			throw macawException;			</span>
		}
	}

	public int getCleaningStateIdentifier(Connection connection,
										  Variable variable,
			  							  CleaningState cleaningState) throws MacawException {

<span class="nc" id="L1158">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1159">		query.append(&quot;SELECT identifier &quot;);</span>
<span class="nc" id="L1160">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L1161">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1162">		query.append(&quot;name=?;&quot;);</span>

		try {
<span class="nc" id="L1165">			int identifier</span>
<span class="nc" id="L1166">				= getIdentifierFromName(connection, </span>
										variable,
										ListChoiceType.CLEANING_STATE,
<span class="nc" id="L1169">										query.toString(),</span>
<span class="nc" id="L1170">										cleaningState.getName());</span>
<span class="nc" id="L1171">			return identifier;			</span>
		}
<span class="nc" id="L1173">		catch(SQLException exception) {</span>
<span class="nc" id="L1174">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L1175">			String errorMessage</span>
<span class="nc" id="L1176">				= MacawMessages.getMessage(&quot;sql.error.unableToGetCleaningStateIdentifier&quot;,</span>
<span class="nc" id="L1177">											cleaningState.getDisplayName());</span>
<span class="nc" id="L1178">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_CLEANING_STATE_IDENTIFIER,
									 errorMessage);
<span class="nc" id="L1181">			throw macawException;			</span>
		}
	}

	public int getAliasFilePathIdentifier(Connection connection,
										  Variable variable,
										  AliasFilePath aliasFilePath) throws MacawException {


<span class="nc" id="L1190">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1191">		query.append(&quot;SELECT identifier &quot;);</span>
<span class="nc" id="L1192">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L1193">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1194">		query.append(&quot;alias=?;&quot;);</span>

		try {
<span class="nc" id="L1197">			int identifier</span>
<span class="nc" id="L1198">				= getIdentifierFromName(connection, </span>
										variable,
										ListChoiceType.ALIAS_FILE_PATH,
<span class="nc" id="L1201">										query.toString(),</span>
<span class="nc" id="L1202">										aliasFilePath.getAlias());</span>
<span class="nc" id="L1203">			return identifier;			</span>
		}
<span class="nc" id="L1205">		catch(SQLException exception) {</span>
<span class="nc" id="L1206">			String errorMessage</span>
<span class="nc" id="L1207">				= MacawMessages.getMessage(&quot;sql.error.unableToGetAliasFilePathIdentifier&quot;,</span>
<span class="nc" id="L1208">											aliasFilePath.getDisplayName());</span>
<span class="nc" id="L1209">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ALIAS_FILE_PATH_IDENTIFIER,
									 errorMessage);
<span class="nc" id="L1212">			throw macawException;			</span>
		}

	}

	public int getIdentifierFromName(Connection connection,
									 Variable variable,
									 ListChoiceType listChoiceType,
									 String query,
									 String name) throws SQLException, MacawException {
		
<span class="nc" id="L1223">		String variableName</span>
<span class="nc" id="L1224">			= MacawMessages.getMessage(&quot;listChoices.unknownVariableName&quot;);</span>
<span class="nc bnc" id="L1225" title="All 2 branches missed.">		if (variable != null) {</span>
<span class="nc" id="L1226">			variableName = variable.getDisplayName();</span>
		}
		
<span class="nc" id="L1229">		ResultSet resultSet = null;</span>
<span class="nc" id="L1230">		PreparedStatement statement = null;		</span>
		try {			
<span class="nc" id="L1232">			statement = connection.prepareStatement(query);</span>
<span class="nc" id="L1233">			statement.setString(1, name);</span>
<span class="nc" id="L1234">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1235" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1236">				return resultSet.getInt(1);</span>
			}
			else {
<span class="nc" id="L1239">				MacawException macawException = new MacawException();</span>
<span class="nc bnc" id="L1240" title="All 2 branches missed.">				if (listChoiceType == ListChoiceType.CATEGORY) {</span>
<span class="nc" id="L1241">					return 0;</span>
				}
<span class="nc bnc" id="L1243" title="All 2 branches missed.">				else if (listChoiceType == ListChoiceType.AVAILABILITY_STATE) {</span>
<span class="nc" id="L1244">					String errorMessage = MacawMessages.getMessage(&quot;availabilityState.error.nonExistent&quot;,</span>
																   name,
																   variableName);
<span class="nc" id="L1247">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_AVAILABILITY_STATE,</span>
												   errorMessage);					
<span class="nc" id="L1249">				}</span>
<span class="nc bnc" id="L1250" title="All 2 branches missed.">				else if (listChoiceType == ListChoiceType.CLEANING_STATE) {</span>
<span class="nc" id="L1251">					String errorMessage = MacawMessages.getMessage(&quot;cleaningState.error.nonExistent&quot;,</span>
																   name,
																   variableName);
<span class="nc" id="L1254">					macawException.addErrorMessage(MacawErrorType.NON_EXISTENT_CLEANING_STATE,</span>
												   errorMessage);					
<span class="nc" id="L1256">				}</span>
				else {
<span class="nc" id="L1258">					return 0;				</span>
				}
<span class="nc" id="L1260">				throw macawException;</span>
			}
		}
		finally {
<span class="nc" id="L1264">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
	}

	public Category getOriginalCategory(Connection connection,
										Category revisedCategory) throws MacawException {
		
<span class="nc" id="L1271">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1272">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L1273">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L1274">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1275">		query.append(&quot;identifier=?;&quot;);</span>
		
		try {
<span class="nc" id="L1278">			Category originalCategory = new Category();</span>
<span class="nc" id="L1279">			setOriginalListChoiceValues(connection,</span>
<span class="nc" id="L1280">										query.toString(),</span>
										revisedCategory,
										originalCategory);
<span class="nc" id="L1283">			return originalCategory;</span>
		}
<span class="nc" id="L1285">		catch(SQLException exception) {</span>
<span class="nc" id="L1286">			String errorMessage</span>
<span class="nc" id="L1287">				= MacawMessages.getMessage(&quot;sql.error.unableToGetOriginalCategory&quot;);</span>
<span class="nc" id="L1288">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ORIGINAL_CATEGORY,
									 errorMessage);
<span class="nc" id="L1291">			throw macawException;			</span>
		}
	}

	public CleaningState getOriginalCleaningState(Connection connection,
												  CleaningState revisedCleaningState) throws MacawException {

<span class="nc" id="L1298">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1299">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L1300">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L1301">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1302">		query.append(&quot;identifier=?;&quot;);</span>

		try {
<span class="nc" id="L1305">			CleaningState originalCleaningState = new CleaningState();</span>
<span class="nc" id="L1306">			setOriginalListChoiceValues(connection,</span>
<span class="nc" id="L1307">										query.toString(),</span>
										revisedCleaningState,
										originalCleaningState);
<span class="nc" id="L1310">			return originalCleaningState;</span>
		}
<span class="nc" id="L1312">		catch(SQLException exception) {</span>
<span class="nc" id="L1313">			String errorMessage</span>
<span class="nc" id="L1314">				= MacawMessages.getMessage(&quot;sql.error.unableToGetOriginalCleaningState&quot;);</span>
<span class="nc" id="L1315">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ORIGINAL_CLEANING_STATE,
									 errorMessage);
<span class="nc" id="L1318">			throw macawException;			</span>
		}
	}

	public AvailabilityState getOriginalAvailabilityState(Connection connection,
			AvailabilityState revisedAvailabilityState) throws MacawException {

<span class="nc" id="L1325">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1326">		query.append(&quot;SELECT name &quot;);</span>
<span class="nc" id="L1327">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L1328">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1329">		query.append(&quot;identifier=?;&quot;);</span>

		try {
<span class="nc" id="L1332">			AvailabilityState originalAvailabilityState = new AvailabilityState();</span>
<span class="nc" id="L1333">			setOriginalListChoiceValues(connection,</span>
<span class="nc" id="L1334">										query.toString(),</span>
										revisedAvailabilityState,
										originalAvailabilityState);
<span class="nc" id="L1337">			return originalAvailabilityState;</span>
		}
<span class="nc" id="L1339">		catch(SQLException exception) {</span>
<span class="nc" id="L1340">			String errorMessage</span>
<span class="nc" id="L1341">				= MacawMessages.getMessage(&quot;sql.error.unableToGetOriginalAvailabilityState&quot;);</span>
<span class="nc" id="L1342">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ORIGINAL_AVAILABILITY_STATE,
									 errorMessage);
<span class="nc" id="L1345">			throw macawException;			</span>
		}
	}

	public AliasFilePath getOriginalAliasFilePath(Connection connection,
											  	  AliasFilePath revisedAliasFilePath) throws MacawException {

<span class="nc" id="L1352">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1353">		query.append(&quot;SELECT alias,&quot;);</span>
<span class="nc" id="L1354">		query.append(&quot;file_path &quot;);</span>
<span class="nc" id="L1355">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L1356">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1357">		query.append(&quot;identifier=?;&quot;);</span>

<span class="nc" id="L1359">		PreparedStatement statement = null;</span>
<span class="nc" id="L1360">		ResultSet resultSet = null;</span>
		
		try {
<span class="nc" id="L1363">			AliasFilePath originalAliasFilePath = new AliasFilePath();</span>
<span class="nc" id="L1364">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1365">			statement.setInt(1, revisedAliasFilePath.getIdentifier());</span>
<span class="nc" id="L1366">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1367" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1368">				originalAliasFilePath.setIdentifier(revisedAliasFilePath.getIdentifier());</span>
<span class="nc" id="L1369">				originalAliasFilePath.setAlias(resultSet.getString(1));</span>
<span class="nc" id="L1370">				originalAliasFilePath.setFilePath(resultSet.getString(2));</span>
			}
<span class="nc" id="L1372">			return originalAliasFilePath;</span>
		}
<span class="nc" id="L1374">		catch(SQLException exception) {</span>
<span class="nc" id="L1375">			String errorMessage</span>
<span class="nc" id="L1376">				= MacawMessages.getMessage(&quot;sql.error.unableToGetOriginalAliasFilePath&quot;);</span>
<span class="nc" id="L1377">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_GET_ORIGINAL_ALIAS_FILE_PATH,
									 errorMessage);
<span class="nc" id="L1380">			throw macawException;			</span>
		}
		finally {
<span class="nc" id="L1383">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
	}

	private void setOriginalListChoiceValues(Connection connection,
											 String query,
											 MacawListChoice currentListChoice,
											 MacawListChoice originalListChoice) throws SQLException, MacawException {
		
<span class="nc" id="L1392">		PreparedStatement statement = null;</span>
<span class="nc" id="L1393">		ResultSet resultSet = null;</span>
		
		try {	
<span class="nc" id="L1396">			int identifier = currentListChoice.getIdentifier();</span>
<span class="nc" id="L1397">			statement</span>
<span class="nc" id="L1398">				= connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1399">			statement.setInt(1, identifier);</span>
<span class="nc" id="L1400">			resultSet = statement.executeQuery();</span>
<span class="nc" id="L1401">			resultSet.next();</span>
<span class="nc" id="L1402">			originalListChoice.setIdentifier(identifier);</span>
<span class="nc" id="L1403">			originalListChoice.setName(resultSet.getString(1));</span>
		}
		finally {
<span class="nc" id="L1406">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
<span class="nc" id="L1408">	}</span>
	

	public String getFilePathFromAlias(Connection connection,
									   String currentAlias) throws MacawException {
<span class="nc" id="L1413">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1414">		query.append(&quot;SELECT file_path &quot;);</span>
<span class="nc" id="L1415">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L1416">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1417">		query.append(&quot;alias=?;&quot;);</span>
		
<span class="nc" id="L1419">		PreparedStatement statement = null;</span>
<span class="nc" id="L1420">		ResultSet resultSet = null;</span>
		try {
<span class="nc" id="L1422">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1423">			statement.setString(1, currentAlias);</span>
			
<span class="nc" id="L1425">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1426" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1427">				return (resultSet.getString(1));</span>
			}
			else {
				//non existent alias
<span class="nc" id="L1431">				String errorMessage </span>
<span class="nc" id="L1432">					= MacawMessages.getMessage(&quot;aliasFilePath.error.nonExistent&quot;,</span>
												currentAlias);
<span class="nc" id="L1434">				MacawException macawException </span>
					= new MacawException(MacawErrorType.NON_EXISTENT_ALIAS_FILE_PATH,
										 errorMessage);
<span class="nc" id="L1437">				throw macawException;</span>
			}
		}
<span class="nc" id="L1440">		catch(SQLException exception) {</span>
<span class="nc" id="L1441">			MacawException macawException = new MacawException();</span>
<span class="nc" id="L1442">			throw macawException;</span>
		}
		finally {
<span class="nc" id="L1445">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
	}

	// ==========================================
	// Section Errors and Validation
	// ==========================================

	private void checkCategoryExists(Connection connection, 
			 						 Category category) throws MacawException {

<span class="nc" id="L1456">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1457">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1458">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L1459">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1460">		query.append(&quot;identifier=?;&quot;);</span>

<span class="nc" id="L1462">		ResultSet resultSet = null;</span>
<span class="nc" id="L1463">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1465">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1466">			statement.setInt(1, category.getIdentifier());</span>
<span class="nc" id="L1467">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1468" title="All 2 branches missed.">			if (resultSet.next() == false) {				</span>
<span class="nc" id="L1469">				String errorMessage</span>
<span class="nc" id="L1470">					= MacawMessages.getMessage(&quot;general.error.nonExistentItem&quot;,</span>
<span class="nc" id="L1471">												category.getDisplayName());</span>
<span class="nc" id="L1472">				MacawException exception</span>
					= new MacawException(MacawErrorType.NON_EXISTENT_CATEGORY,
										 errorMessage);				
<span class="nc" id="L1475">				throw exception;				</span>
			}
		}
<span class="nc" id="L1478">		catch(SQLException exception) {</span>
<span class="nc" id="L1479">			String errorMessage</span>
<span class="nc" id="L1480">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckCategoryExists&quot;);</span>
<span class="nc" id="L1481">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_CATEGORY_EXISTS,
									 errorMessage);
<span class="nc" id="L1484">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1487">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L1489">	}</span>
	
	private void checkCategoryDuplicates(Connection connection, 
										 Category category) throws MacawException {

<span class="nc" id="L1494">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1495">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1496">		query.append(&quot;FROM categories &quot;);</span>
<span class="nc" id="L1497">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1498">		query.append(&quot;name=? AND &quot;);</span>
<span class="nc" id="L1499">		query.append(&quot;identifier != ?;&quot;);</span>

		
<span class="nc" id="L1502">		ResultSet resultSet = null;</span>
<span class="nc" id="L1503">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1505">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1506">			statement.setString(1, category.getName());</span>
<span class="nc" id="L1507">			statement.setInt(2, category.getIdentifier());</span>
<span class="nc" id="L1508">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1509" title="All 2 branches missed.">			if (resultSet.next() == true) {				</span>
<span class="nc" id="L1510">				String errorMessage</span>
<span class="nc" id="L1511">					= MacawMessages.getMessage(&quot;category.error.duplicateItem&quot;,</span>
<span class="nc" id="L1512">												category.getDisplayName());</span>
<span class="nc" id="L1513">				MacawException macawException</span>
					= new MacawException(MacawErrorType.DUPLICATE_CATEGORY,
										 errorMessage);
<span class="nc" id="L1516">				throw macawException;				</span>
			}
		}
<span class="nc" id="L1519">		catch(SQLException exception) {</span>
<span class="nc" id="L1520">			String errorMessage</span>
<span class="nc" id="L1521">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckCategoryDuplicate&quot;);</span>
<span class="nc" id="L1522">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_CATEGORY_DUPLICATE,
									 errorMessage);
<span class="nc" id="L1525">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1528">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}				
<span class="nc" id="L1530">	}</span>

	private void checkCleaningStateExists(Connection connection, 
										  CleaningState cleaningState) throws MacawException {

<span class="nc" id="L1535">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1536">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1537">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L1538">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1539">		query.append(&quot;identifier=?;&quot;);</span>

<span class="nc" id="L1541">		ResultSet resultSet = null;</span>
<span class="nc" id="L1542">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1544">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1545">			statement.setInt(1, cleaningState.getIdentifier());</span>
<span class="nc" id="L1546">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1547" title="All 2 branches missed.">			if (resultSet.next() == false) {</span>
<span class="nc" id="L1548">				String errorMessage</span>
<span class="nc" id="L1549">					= MacawMessages.getMessage(&quot;general.error.nonExistentItem&quot;,</span>
<span class="nc" id="L1550">												cleaningState.getDisplayName());</span>
<span class="nc" id="L1551">				MacawException exception</span>
					= new MacawException(MacawErrorType.NON_EXISTENT_CLEANING_STATE,
										 errorMessage);
<span class="nc" id="L1554">				throw exception;				</span>
			}
		}
<span class="nc" id="L1557">		catch(SQLException exception) {</span>
<span class="nc" id="L1558">			String errorMessage</span>
<span class="nc" id="L1559">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckCleaningStateExists&quot;);</span>
<span class="nc" id="L1560">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_CLEANING_STATE_EXISTS,
									 errorMessage);
<span class="nc" id="L1563">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1566">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L1568">	}</span>

	private void checkCleaningStateDuplicates(Connection connection, 
			  								  CleaningState cleaningState) throws MacawException {

<span class="nc" id="L1573">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1574">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1575">		query.append(&quot;FROM cleaning_states &quot;);</span>
<span class="nc" id="L1576">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1577">		query.append(&quot;name=? AND &quot;);</span>
<span class="nc" id="L1578">		query.append(&quot;identifier != ?;&quot;);</span>

<span class="nc" id="L1580">		ResultSet resultSet = null;</span>
<span class="nc" id="L1581">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1583">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1584">			statement.setString(1, cleaningState.getName());</span>
<span class="nc" id="L1585">			statement.setInt(2, cleaningState.getIdentifier());</span>
<span class="nc" id="L1586">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1587" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1588">				String errorMessage</span>
<span class="nc" id="L1589">					= MacawMessages.getMessage(&quot;category.error.duplicateItem&quot;,</span>
<span class="nc" id="L1590">												cleaningState.getDisplayName());</span>
<span class="nc" id="L1591">				MacawException macawException</span>
					= new MacawException(MacawErrorType.DUPLICATE_CLEANING_STATE,
										 errorMessage);
<span class="nc" id="L1594">				throw macawException;				</span>
			}
		}
<span class="nc" id="L1597">		catch(SQLException exception) {</span>
<span class="nc" id="L1598">			String errorMessage</span>
<span class="nc" id="L1599">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckCleaningStateDuplicate&quot;);</span>
<span class="nc" id="L1600">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_CLEANING_STATE_DUPLICATE,
									 errorMessage);
<span class="nc" id="L1603">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1606">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
<span class="nc" id="L1608">	}</span>

	private void checkAvailabilityStateExists(Connection connection, 
										  	  AvailabilityState availabilityState) throws MacawException {

<span class="nc" id="L1613">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1614">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1615">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L1616">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1617">		query.append(&quot;identifier=?;&quot;);</span>
		
<span class="nc" id="L1619">		ResultSet resultSet = null;</span>
<span class="nc" id="L1620">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1622">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1623">			statement.setInt(1, availabilityState.getIdentifier());</span>
<span class="nc" id="L1624">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1625" title="All 2 branches missed.">			if (resultSet.next() == false) {</span>
<span class="nc" id="L1626">				String errorMessage</span>
<span class="nc" id="L1627">					= MacawMessages.getMessage(&quot;general.error.nonExistentItem&quot;,</span>
<span class="nc" id="L1628">											   availabilityState.getDisplayName());</span>
<span class="nc" id="L1629">				MacawException exception</span>
					= new MacawException(MacawErrorType.NON_EXISTENT_AVAILABILITY_STATE,
										 errorMessage);
<span class="nc" id="L1632">				throw exception;</span>
			}
		}
<span class="nc" id="L1635">		catch(SQLException exception) {</span>
<span class="nc" id="L1636">			String errorMessage</span>
<span class="nc" id="L1637">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckAvailabilityStateExists&quot;);</span>
<span class="nc" id="L1638">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_AVAILABILITY_STATE_EXISTS,
									 errorMessage);
<span class="nc" id="L1641">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1644">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L1646">	}</span>
	
	private void checkAvailabilityStateDuplicates(Connection connection, 
												  AvailabilityState availabilityState) throws MacawException {

<span class="nc" id="L1651">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1652">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1653">		query.append(&quot;FROM availability_states &quot;);</span>
<span class="nc" id="L1654">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1655">		query.append(&quot;name=? AND &quot;);</span>
<span class="nc" id="L1656">		query.append(&quot;identifier != ?;&quot;);</span>

<span class="nc" id="L1658">		ResultSet resultSet = null;</span>
<span class="nc" id="L1659">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1661">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1662">			statement.setString(1, availabilityState.getName());</span>
<span class="nc" id="L1663">			statement.setInt(2, availabilityState.getIdentifier());</span>
<span class="nc" id="L1664">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1665" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1666">				String errorMessage</span>
<span class="nc" id="L1667">					= MacawMessages.getMessage(&quot;category.error.duplicateItem&quot;,</span>
<span class="nc" id="L1668">												availabilityState.getDisplayName());</span>
<span class="nc" id="L1669">				MacawException macawException</span>
					= new MacawException(MacawErrorType.DUPLICATE_AVAILABILITY_STATE,
										 errorMessage);
<span class="nc" id="L1672">				throw macawException;				</span>
			}
		}
<span class="nc" id="L1675">		catch(SQLException exception) {</span>
<span class="nc" id="L1676">			String errorMessage</span>
<span class="nc" id="L1677">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckAvailabilityStateDuplicate&quot;);</span>
<span class="nc" id="L1678">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_AVAILABILITY_STATE_DUPLICATE,
									 errorMessage);
<span class="nc" id="L1681">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1684">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
<span class="nc" id="L1686">	}</span>

	private void checkAliasFilePathExists(Connection connection, 
										  AliasFilePath aliasFilePath) throws MacawException {

<span class="nc" id="L1691">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1692">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1693">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L1694">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1695">		query.append(&quot;identifier=?;&quot;);</span>

<span class="nc" id="L1697">		ResultSet resultSet = null;</span>
<span class="nc" id="L1698">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1700">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1701">			statement.setInt(1, aliasFilePath.getIdentifier());</span>
<span class="nc" id="L1702">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1703" title="All 2 branches missed.">			if (resultSet.next() == false) {</span>
<span class="nc" id="L1704">				String errorMessage</span>
<span class="nc" id="L1705">					= MacawMessages.getMessage(&quot;general.error.nonExistentItem&quot;,</span>
<span class="nc" id="L1706">												aliasFilePath.getDisplayName());</span>
<span class="nc" id="L1707">				MacawException exception</span>
					= new MacawException(MacawErrorType.NON_EXISTENT_ALIAS_FILE_PATH,
										errorMessage);
<span class="nc" id="L1710">				throw exception;				</span>
			}
		}
<span class="nc" id="L1713">		catch(SQLException exception) {</span>
<span class="nc" id="L1714">			String errorMessage</span>
<span class="nc" id="L1715">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckAliasFilePathExists&quot;);</span>
<span class="nc" id="L1716">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_ALIAS_FILE_PATH_EXISTS,
									 errorMessage);
<span class="nc" id="L1719">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1722">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}
<span class="nc" id="L1724">	}</span>

	private void checkAliasFilePathDuplicates(Connection connection, 
											  AliasFilePath aliasFilePath) throws MacawException {

<span class="nc" id="L1729">		StringBuilder query = new StringBuilder();</span>
<span class="nc" id="L1730">		query.append(&quot;SELECT 1 &quot;);</span>
<span class="nc" id="L1731">		query.append(&quot;FROM alias_file_paths &quot;);</span>
<span class="nc" id="L1732">		query.append(&quot;WHERE deleted_at IS NULL AND &quot;);</span>
<span class="nc" id="L1733">		query.append(&quot;alias=? AND &quot;);</span>
<span class="nc" id="L1734">		query.append(&quot;identifier != ?;&quot;);</span>

<span class="nc" id="L1736">		ResultSet resultSet = null;</span>
<span class="nc" id="L1737">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1739">			statement = connection.prepareStatement(query.toString());</span>
<span class="nc" id="L1740">			statement.setString(1, aliasFilePath.getAlias());</span>
<span class="nc" id="L1741">			statement.setInt(2, aliasFilePath.getIdentifier());</span>
<span class="nc" id="L1742">			resultSet = statement.executeQuery();</span>
<span class="nc bnc" id="L1743" title="All 2 branches missed.">			if (resultSet.next() == true) {</span>
<span class="nc" id="L1744">				String errorMessage</span>
<span class="nc" id="L1745">					= MacawMessages.getMessage(&quot;aliasFilePath.error.duplicateItem&quot;,</span>
<span class="nc" id="L1746">												aliasFilePath.getDisplayName());</span>
<span class="nc" id="L1747">				MacawException macawException</span>
					= new MacawException(MacawErrorType.DUPLICATE_ALIAS_FILE_PATH,
										 errorMessage);
<span class="nc" id="L1750">				throw macawException;				</span>
			}
		}
<span class="nc" id="L1753">		catch(SQLException exception) {</span>
<span class="nc" id="L1754">			String errorMessage</span>
<span class="nc" id="L1755">				= MacawMessages.getMessage(&quot;sql.error.unableToCheckAliasFilePathDuplicate&quot;);</span>
<span class="nc" id="L1756">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CHECK_ALIAS_FILE_PATH_EXISTS,
									 errorMessage);
<span class="nc" id="L1759">			throw macawException;			</span>
		}		
		finally {
<span class="nc" id="L1762">			SQLUtilities.closeStatementsWithCatch(statement, resultSet);</span>
		}		
<span class="nc" id="L1764">	}</span>

	public void clear(Connection connection) throws MacawException {

<span class="nc" id="L1768">		PreparedStatement statement = null;</span>
		try {
<span class="nc" id="L1770">			statement</span>
<span class="nc" id="L1771">				= connection.prepareStatement(&quot;DELETE FROM categories;&quot;);</span>
<span class="nc" id="L1772">			statement.executeUpdate();</span>

<span class="nc" id="L1774">			statement</span>
<span class="nc" id="L1775">				= connection.prepareStatement(&quot;DELETE FROM cleaning_states;&quot;);</span>
<span class="nc" id="L1776">			statement.executeUpdate();</span>

<span class="nc" id="L1778">			statement</span>
<span class="nc" id="L1779">				= connection.prepareStatement(&quot;DELETE FROM availability_states;&quot;);</span>
<span class="nc" id="L1780">			statement.executeUpdate();</span>

<span class="nc" id="L1782">			statement</span>
<span class="nc" id="L1783">				= connection.prepareStatement(&quot;DELETE FROM alias_file_paths;&quot;);</span>
<span class="nc" id="L1784">			statement.executeUpdate();</span>
		}
<span class="nc" id="L1786">		catch(SQLException exception) {</span>
<span class="nc" id="L1787">			exception.printStackTrace(System.out);</span>
<span class="nc" id="L1788">			String errorMessage</span>
<span class="nc" id="L1789">				= MacawMessages.getMessage(&quot;sql.error.unableToClearTable&quot;);</span>
<span class="nc" id="L1790">			MacawException macawException</span>
				= new MacawException(MacawErrorType.UNABLE_TO_CLEAR_TABLE,
									 errorMessage);
<span class="nc" id="L1793">			throw macawException;</span>
		}
		finally {
<span class="nc" id="L1796">			SQLUtilities.closeStatementsWithCatch(statement, null);</span>
		}
<span class="nc" id="L1798">	}</span>

	// ==========================================
	// Section Interfaces
	// ==========================================

	// ==========================================
	// Section Overload
	// ==========================================

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>