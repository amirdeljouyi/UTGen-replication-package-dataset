<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Password.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">32_httpanalyzer</a> &gt; <a href="index.source.html" class="el_package">httpanalyzer</a> &gt; <span class="el_source">Password.java</span></div><h1>Password.java</h1><pre class="source lang-java linenums">package httpanalyzer;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author David Scott
 */
<span class="fc" id="L12">public class Password {</span>

    /**
     *	Password is a class to implement password encryption as used
     *	on Unix systems. It is compatible with the crypt(3c) system function.
     *	This version is a based on the DES encryption algorithm in
     *	Andrew Tanenbaum's book &quot;Computer Networks&quot;. It was rewritten
     *	in C and used in Perl release 4.035. This version was rewritten
     *	in Java by David Scott, Siemens Ltd., Australia.
     *
     *	For further details on the methods in this class, refer to the
     *	Unix man pages for crypt(3c).
     */
<span class="fc" id="L25">    private static byte[] InitialTr = {</span>
        58, 50, 42, 34, 26, 18, 10, 2, 60, 52, 44, 36, 28, 20, 12, 4,
        62, 54, 46, 38, 30, 22, 14, 6, 64, 56, 48, 40, 32, 24, 16, 8,
        57, 49, 41, 33, 25, 17, 9, 1, 59, 51, 43, 35, 27, 19, 11, 3,
        61, 53, 45, 37, 29, 21, 13, 5, 63, 55, 47, 39, 31, 23, 15, 7
    };
<span class="fc" id="L31">    private static byte[] FinalTr = {</span>
        40, 8, 48, 16, 56, 24, 64, 32, 39, 7, 47, 15, 55, 23, 63, 31,
        38, 6, 46, 14, 54, 22, 62, 30, 37, 5, 45, 13, 53, 21, 61, 29,
        36, 4, 44, 12, 52, 20, 60, 28, 35, 3, 43, 11, 51, 19, 59, 27,
        34, 2, 42, 10, 50, 18, 58, 26, 33, 1, 41, 9, 49, 17, 57, 25
    };
<span class="fc" id="L37">    private static byte[] swap = {</span>
        33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48,
        49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64,
        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,
        17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32
    };
<span class="fc" id="L43">    private static byte[] KeyTr1 = {</span>
        57, 49, 41, 33, 25, 17, 9, 1, 58, 50, 42, 34, 26, 18,
        10, 2, 59, 51, 43, 35, 27, 19, 11, 3, 60, 52, 44, 36,
        63, 55, 47, 39, 31, 23, 15, 7, 62, 54, 46, 38, 30, 22,
        14, 6, 61, 53, 45, 37, 29, 21, 13, 5, 28, 20, 12, 4
    };
<span class="fc" id="L49">    private static byte[] KeyTr2 = {</span>
        14, 17, 11, 24, 1, 5, 3, 28, 15, 6, 21, 10,
        23, 19, 12, 4, 26, 8, 16, 7, 27, 20, 13, 2,
        41, 52, 31, 37, 47, 55, 30, 40, 51, 45, 33, 48,
        44, 49, 39, 56, 34, 53, 46, 42, 50, 36, 29, 32
    };
<span class="fc" id="L55">    private static byte[] etr = {</span>
        32, 1, 2, 3, 4, 5, 4, 5, 6, 7, 8, 9,
        8, 9, 10, 11, 12, 13, 12, 13, 14, 15, 16, 17,
        16, 17, 18, 19, 20, 21, 20, 21, 22, 23, 24, 25,
        24, 25, 26, 27, 28, 29, 28, 29, 30, 31, 32, 1
    };
<span class="fc" id="L61">    private static byte[] ptr = {</span>
        16, 7, 20, 21, 29, 12, 28, 17, 1, 15, 23, 26, 5, 18, 31, 10,
        2, 8, 24, 14, 32, 27, 3, 9, 19, 13, 30, 6, 22, 11, 4, 25
    };
<span class="fc" id="L65">    private static byte s_boxes[][] = {</span>
        {
            14, 4, 13, 1, 2, 15, 11, 8, 3, 10, 6, 12, 5, 9, 0, 7,
            0, 15, 7, 4, 14, 2, 13, 1, 10, 6, 12, 11, 9, 5, 3, 8,
            4, 1, 14, 8, 13, 6, 2, 11, 15, 12, 9, 7, 3, 10, 5, 0,
            15, 12, 8, 2, 4, 9, 1, 7, 5, 11, 3, 14, 10, 0, 6, 13
        },
        {
            15, 1, 8, 14, 6, 11, 3, 4, 9, 7, 2, 13, 12, 0, 5, 10,
            3, 13, 4, 7, 15, 2, 8, 14, 12, 0, 1, 10, 6, 9, 11, 5,
            0, 14, 7, 11, 10, 4, 13, 1, 5, 8, 12, 6, 9, 3, 2, 15,
            13, 8, 10, 1, 3, 15, 4, 2, 11, 6, 7, 12, 0, 5, 14, 9
        },
        {
            10, 0, 9, 14, 6, 3, 15, 5, 1, 13, 12, 7, 11, 4, 2, 8,
            13, 7, 0, 9, 3, 4, 6, 10, 2, 8, 5, 14, 12, 11, 15, 1,
            13, 6, 4, 9, 8, 15, 3, 0, 11, 1, 2, 12, 5, 10, 14, 7,
            1, 10, 13, 0, 6, 9, 8, 7, 4, 15, 14, 3, 11, 5, 2, 12
        },
        {
            7, 13, 14, 3, 0, 6, 9, 10, 1, 2, 8, 5, 11, 12, 4, 15,
            13, 8, 11, 5, 6, 15, 0, 3, 4, 7, 2, 12, 1, 10, 14, 9,
            10, 6, 9, 0, 12, 11, 7, 13, 15, 1, 3, 14, 5, 2, 8, 4,
            3, 15, 0, 6, 10, 1, 13, 8, 9, 4, 5, 11, 12, 7, 2, 14
        },
        {
            2, 12, 4, 1, 7, 10, 11, 6, 8, 5, 3, 15, 13, 0, 14, 9,
            14, 11, 2, 12, 4, 7, 13, 1, 5, 0, 15, 10, 3, 9, 8, 6,
            4, 2, 1, 11, 10, 13, 7, 8, 15, 9, 12, 5, 6, 3, 0, 14,
            11, 8, 12, 7, 1, 14, 2, 13, 6, 15, 0, 9, 10, 4, 5, 3
        },
        {
            12, 1, 10, 15, 9, 2, 6, 8, 0, 13, 3, 4, 14, 7, 5, 11,
            10, 15, 4, 2, 7, 12, 9, 5, 6, 1, 13, 14, 0, 11, 3, 8,
            9, 14, 15, 5, 2, 8, 12, 3, 7, 0, 4, 10, 1, 13, 11, 6,
            4, 3, 2, 12, 9, 5, 15, 10, 11, 14, 1, 7, 6, 0, 8, 13
        },
        {
            4, 11, 2, 14, 15, 0, 8, 13, 3, 12, 9, 7, 5, 10, 6, 1,
            13, 0, 11, 7, 4, 9, 1, 10, 14, 3, 5, 12, 2, 15, 8, 6,
            1, 4, 11, 13, 12, 3, 7, 14, 10, 15, 6, 8, 0, 5, 9, 2,
            6, 11, 13, 8, 1, 4, 10, 7, 9, 5, 0, 15, 14, 2, 3, 12
        },
        {
            13, 2, 8, 4, 6, 15, 11, 1, 10, 9, 3, 14, 5, 0, 12, 7,
            1, 15, 13, 8, 10, 3, 7, 4, 12, 5, 6, 11, 0, 14, 9, 2,
            7, 11, 4, 1, 9, 12, 14, 2, 0, 6, 10, 13, 15, 3, 5, 8,
            2, 1, 14, 7, 4, 10, 8, 13, 15, 12, 9, 0, 3, 5, 6, 11
        },};
<span class="fc" id="L114">    private static int rots[] = {</span>
        1, 1, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 1
    };
<span class="fc" id="L117">    private static byte[] key = new byte[64];</span>
<span class="fc" id="L118">    private static byte[] EP = etr;</span>

    /* *** Methods start here *** */
    private static void transpose(byte[] data, byte[] t, int n) {
<span class="fc" id="L122">        byte[] x = new byte[64];</span>
<span class="fc" id="L123">        System.arraycopy(data, 0, x, 0, x.length);</span>

<span class="fc bfc" id="L125" title="All 2 branches covered.">        while (n-- &gt; 0) {</span>
<span class="fc" id="L126">            data[n] = x[t[n] - 1];</span>
        }
<span class="fc" id="L128">    }</span>

    private static void rotate(byte[] key) {
<span class="fc" id="L131">        byte[] x = new byte[64];</span>
<span class="fc" id="L132">        System.arraycopy(key, 0, x, 0, x.length);</span>

<span class="fc bfc" id="L134" title="All 2 branches covered.">        for (int i = 0; i &lt; 55; i++) {</span>
<span class="fc" id="L135">            x[i] = x[i + 1];</span>
        }
<span class="fc" id="L137">        x[27] = key[0];</span>
<span class="fc" id="L138">        x[55] = key[28];</span>
<span class="fc" id="L139">        System.arraycopy(x, 0, key, 0, key.length);</span>
<span class="fc" id="L140">    }</span>

    private static void f(int i, byte[] key, byte[] a, byte[] x) {
<span class="fc" id="L143">        byte[] e = new byte[64];</span>
<span class="fc" id="L144">        byte[] ikey = new byte[64];</span>
<span class="fc" id="L145">        byte[] y = new byte[64];</span>

<span class="fc" id="L147">        System.arraycopy(a, 0, e, 0, e.length);</span>
<span class="fc" id="L148">        transpose(e, EP, 48);</span>

<span class="fc bfc" id="L150" title="All 2 branches covered.">        for (int j = rots[i]; j &gt; 0; j--) {</span>
<span class="fc" id="L151">            rotate(key);</span>
        }

<span class="fc" id="L154">        System.arraycopy(key, 0, ikey, 0, ikey.length);</span>
<span class="fc" id="L155">        transpose(ikey, KeyTr2, 48);</span>

<span class="fc bfc" id="L157" title="All 2 branches covered.">        for (int j = 0; j &lt; 48; j++) {</span>
<span class="fc" id="L158">            y[j] = (byte) (e[j] ^ ikey[j]);</span>
        }

<span class="fc bfc" id="L161" title="All 2 branches covered.">        for (int j = 0; j &lt; 8; j++) {</span>
<span class="fc" id="L162">            int k = j + 1;</span>
<span class="fc" id="L163">            int r = 32 * y[6 * k - 6]</span>
                    + 8 * y[6 * k - 5]
                    + 4 * y[6 * k - 4]
                    + 2 * y[6 * k - 3]
                    + y[6 * k - 2]
                    + 16 * y[6 * k - 1];

<span class="fc" id="L170">            int xb = s_boxes[j][r];</span>

<span class="fc" id="L172">            x[4 * k - 4] = (byte) ((xb &gt;&gt; 3) &amp; 1);</span>
<span class="fc" id="L173">            x[4 * k - 3] = (byte) ((xb &gt;&gt; 2) &amp; 1);</span>
<span class="fc" id="L174">            x[4 * k - 2] = (byte) ((xb &gt;&gt; 1) &amp; 1);</span>
<span class="fc" id="L175">            x[4 * k - 1] = (byte) (xb &amp; 1);</span>
        }
<span class="fc" id="L177">        transpose(x, ptr, 32);</span>
<span class="fc" id="L178">    }</span>

    private static void definekey(byte[] k) {
<span class="fc" id="L181">        System.arraycopy(k, 0, key, 0, key.length);</span>
<span class="fc" id="L182">        transpose(key, KeyTr1, 56);</span>
<span class="fc" id="L183">    }</span>

    private static void encrypt(byte[] blck, int edflag) {
<span class="fc" id="L186">        byte[] p = blck;</span>

<span class="fc" id="L188">        transpose(p, InitialTr, 64);</span>

<span class="fc bfc" id="L190" title="All 2 branches covered.">        for (int i = 15; i &gt;= 0; i--) {</span>
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">            int j = edflag &gt; 0 ? i : 15 - i;</span>
<span class="fc" id="L192">            byte[] b = new byte[64];</span>
<span class="fc" id="L193">            System.arraycopy(p, 0, b, 0, b.length);</span>
<span class="fc" id="L194">            byte[] x = new byte[64];</span>

<span class="fc bfc" id="L196" title="All 2 branches covered.">            for (int k = 31; k &gt;= 0; k--) {</span>
<span class="fc" id="L197">                p[k] = b[k + 32];</span>
            }

<span class="fc" id="L200">            f(j, key, p, x);</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">            for (int k = 31; k &gt;= 0; k--) {</span>
<span class="fc" id="L202">                p[k + 32] = (byte) (b[k] ^ x[k]);</span>
            }
        }

<span class="fc" id="L206">        transpose(p, swap, 64);</span>
<span class="fc" id="L207">        transpose(p, FinalTr, 64);</span>
<span class="fc" id="L208">        blck = p;</span>
<span class="fc" id="L209">    }</span>

    /**
     *	Returns a String containing the encrypted passwd
     *
     *	@param	strpw	A String containing the un-encrypted password
     *	@param	strsalt	A 2 character String, containing the salt to
     *					encrypt the password with.
     *	@returns		String containing encrypted password.
     */
    public static String crypt(String strpw, String strsalt) {
<span class="fc" id="L220">        char[] pw = strpw.toCharArray();</span>
<span class="fc" id="L221">        char[] salt = strsalt.toCharArray();</span>
<span class="fc" id="L222">        byte[] pwb = new byte[66];</span>
<span class="fc" id="L223">        char[] result = new char[13];</span>
<span class="fc" id="L224">        byte[] new_etr = new byte[etr.length];</span>
<span class="fc" id="L225">        int n = 0;</span>
<span class="fc" id="L226">        int m = 0;</span>

<span class="fc bfc" id="L228" title="All 4 branches covered.">        while (m &lt; pw.length &amp;&amp; n &lt; 64) {</span>
<span class="fc bfc" id="L229" title="All 2 branches covered.">            for (int j = 6; j &gt;= 0; j--) {</span>
<span class="fc" id="L230">                pwb[n++] = (byte) ((pw[m] &gt;&gt; j) &amp; 1);</span>
            }
<span class="fc" id="L232">            m++; // Increment pw</span>
<span class="fc" id="L233">            pwb[n++] = 0;</span>
        }

<span class="fc bfc" id="L236" title="All 2 branches covered.">        while (n &lt; 64) {</span>
<span class="fc" id="L237">            pwb[n++] = 0;</span>
        }

<span class="fc" id="L240">        definekey(pwb);</span>

<span class="fc bfc" id="L242" title="All 2 branches covered.">        for (n = 0; n &lt; 66; n++) {</span>
<span class="fc" id="L243">            pwb[n] = 0;</span>
        }

<span class="fc" id="L246">        System.arraycopy(etr, 0, new_etr, 0, new_etr.length);</span>
<span class="fc" id="L247">        EP = new_etr;</span>

<span class="fc bfc" id="L249" title="All 2 branches covered.">        for (int i = 0; i &lt; 2; i++) {</span>
<span class="fc" id="L250">            char c = salt[i];</span>


<span class="fc" id="L253">            result[i] = c;</span>
<span class="fc bfc" id="L254" title="All 2 branches covered.">            if (c &gt; 'Z') {</span>
<span class="fc" id="L255">                c -= 6 + 7 + '.';	// c was a lowercase letter</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">            } else if (c &gt; '9') {</span>
<span class="fc" id="L257">                c -= 7 + '.';		// c was a uppercase letter</span>
            } else {
<span class="fc" id="L259">                c -= '.';			// c was a digit, '.' or '/'</span>
            }						// now, 0 &lt;= c &lt;= 63

<span class="fc bfc" id="L262" title="All 2 branches covered.">            for (int j = 0; j &lt; 6; j++) {</span>
<span class="fc bfc" id="L263" title="All 2 branches covered.">                if (((c &gt;&gt; j) &amp; 1) == 1) {</span>
<span class="fc" id="L264">                    byte t = (byte) (6 * i + j);</span>
<span class="fc" id="L265">                    byte temp = new_etr[t];</span>
<span class="fc" id="L266">                    new_etr[t] = new_etr[t + 24];</span>
<span class="fc" id="L267">                    new_etr[t + 24] = temp;</span>
                }
            }
        }

<span class="pc bpc" id="L272" title="1 of 2 branches missed.">        if (result[1] == 0) {</span>
<span class="nc" id="L273">            result[1] = result[0];</span>
        }

<span class="fc bfc" id="L276" title="All 2 branches covered.">        for (int i = 0; i &lt; 25; i++) {</span>
<span class="fc" id="L277">            encrypt(pwb, 0);</span>
        }
<span class="fc" id="L279">        EP = etr;</span>

<span class="fc" id="L281">        m = 2;</span>
<span class="fc" id="L282">        n = 0;</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">        while (n &lt; 66) {</span>
<span class="fc" id="L284">            int c = 0;</span>


<span class="fc bfc" id="L287" title="All 2 branches covered.">            for (int j = 6; j &gt; 0; j--) {</span>
<span class="fc" id="L288">                c &lt;&lt;= 1;</span>
<span class="fc" id="L289">                c |= pwb[n++];</span>
            }

<span class="fc" id="L292">            c += '.';			// becomes &gt;= '.'</span>
<span class="fc bfc" id="L293" title="All 2 branches covered.">            if (c &gt; '9') {</span>
<span class="fc" id="L294">                c += 7;		// not in [./0-9], becomes upper</span>
            }

<span class="fc bfc" id="L297" title="All 2 branches covered.">            if (c &gt; 'Z') {</span>
<span class="fc" id="L298">                c += 6;		// not in [A-Z], becomes lower</span>
            }

<span class="fc" id="L301">            result[m++] = (char) c;</span>
<span class="fc" id="L302">        }</span>
<span class="fc" id="L303">        return (new String(result));</span>
    }

    public static String hashMD5(String baseString) {
<span class="fc" id="L307">        MessageDigest digest = null;</span>
<span class="fc" id="L308">        StringBuffer hexString = new StringBuffer();</span>
        try {
<span class="fc" id="L310">            digest = java.security.MessageDigest.getInstance(&quot;MD5&quot;);</span>
            
<span class="fc" id="L312">            digest.update(baseString.getBytes());</span>
<span class="fc" id="L313">            byte[] hash = digest.digest();</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">            for (int i = 0; i &lt; hash.length; i++) {</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">                if ((0xff &amp; hash[i]) &lt; 0x10) {</span>
<span class="fc" id="L316">                    hexString.append(&quot;0&quot; + Integer.toHexString((0xFF &amp; hash[i])));</span>
                } else {
<span class="fc" id="L318">                    hexString.append(Integer.toHexString(0xFF &amp; hash[i]));</span>
                }
            }
<span class="nc" id="L321">        } catch (NoSuchAlgorithmException ex) {</span>
<span class="nc" id="L322">            Logger.getLogger(Password.class.getName()).log(Level.SEVERE, null, ex);</span>
<span class="fc" id="L323">        }</span>
<span class="fc" id="L324">        return hexString.toString();</span>
    }
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>