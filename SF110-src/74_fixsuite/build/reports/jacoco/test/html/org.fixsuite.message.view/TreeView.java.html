<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TreeView.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">74_fixsuite</a> &gt; <a href="index.source.html" class="el_package">org.fixsuite.message.view</a> &gt; <span class="el_source">TreeView.java</span></div><h1>TreeView.java</h1><pre class="source lang-java linenums">/**
 * TreeView.java 10:39:35 PM Apr 22, 2008
 * 
 * &lt;PRE&gt;
 * Copyright (c) 2008, Jan Amoyo
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 *     - Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     - Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS';
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 * &lt;/PRE&gt;
 */

package org.fixsuite.message.view;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextField;
import javax.swing.JToolBar;
import javax.swing.JTree;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeCellRenderer;
import javax.swing.tree.TreePath;

import org.fixsuite.message.Library;
import org.fixsuite.message.LibrarySuite;
import org.fixsuite.message.info.ComponentInfo;
import org.fixsuite.message.info.CompositeFixInfo;
import org.fixsuite.message.info.DictionaryInfo;
import org.fixsuite.message.info.FieldInfo;
import org.fixsuite.message.info.FixInfo;
import org.fixsuite.message.info.MessageInfo;

/**
 * @author jramoyo
 */
public class TreeView extends JPanel implements ActionListener, KeyListener,
        TreeSelectionListener {

    private static final long serialVersionUID = 1L;

    private JScrollPane mainScrollPane;

    private JTree fixTree;

    private JLabel searchLabel;

    private JTextField searchTextField;

    private JButton searchButton;

    private JButton clearButton;

    private JButton expandButton;

    private JButton collapseButton;

    private Library library;

    /**
     * Creates a new TreeView
     */
    public TreeView(Library library) {
<span class="fc" id="L95">        super();</span>
<span class="fc" id="L96">        this.library = library;</span>
<span class="fc" id="L97">        initGUI();</span>
<span class="fc" id="L98">    }</span>

    private void initGUI() {
        // Set the layout
<span class="fc" id="L102">        setLayout(new BorderLayout());</span>

        // Setup the main scroll pane
<span class="fc" id="L105">        mainScrollPane = new JScrollPane();</span>
<span class="fc" id="L106">        mainScrollPane.setPreferredSize(new Dimension(300, 400));</span>
<span class="fc" id="L107">        add(mainScrollPane, BorderLayout.CENTER);</span>

        // FIX Tree
<span class="fc" id="L110">        fixTree = new JTree(loadFIXTree());</span>
<span class="fc" id="L111">        fixTree.setCellRenderer(new FixInfoCellRenderer());</span>
<span class="fc" id="L112">        fixTree.addTreeSelectionListener(this);</span>
<span class="fc" id="L113">        mainScrollPane.getViewport().add(fixTree);</span>

        // Setup the top panel
<span class="fc" id="L116">        searchLabel = new JLabel(&quot;Search &quot;);</span>
<span class="fc" id="L117">        searchTextField = new JTextField(20);</span>
<span class="fc" id="L118">        searchTextField.setToolTipText(&quot;Search for Item (regex)&quot;);</span>
<span class="fc" id="L119">        searchTextField.addKeyListener(this);</span>
<span class="fc" id="L120">        searchButton = new JButton(&quot;Go&quot;);</span>
<span class="fc" id="L121">        searchButton.addActionListener(this);</span>
<span class="fc" id="L122">        searchButton.setToolTipText(&quot;Start Search&quot;);</span>
<span class="fc" id="L123">        clearButton = new JButton(new ImageIcon(&quot;.\\resources\\clear.gif&quot;));</span>
<span class="fc" id="L124">        clearButton.addActionListener(this);</span>
<span class="fc" id="L125">        clearButton.setToolTipText(&quot;Clear the Search Results&quot;);</span>
<span class="fc" id="L126">        expandButton = new JButton(new ImageIcon(&quot;.\\resources\\expand.gif&quot;));</span>
<span class="fc" id="L127">        expandButton.addActionListener(this);</span>
<span class="fc" id="L128">        expandButton.setToolTipText(&quot;Expand the Tree&quot;);</span>
<span class="fc" id="L129">        collapseButton = new JButton(</span>
                new ImageIcon(&quot;.\\resources\\collapse.gif&quot;));
<span class="fc" id="L131">        collapseButton.addActionListener(this);</span>
<span class="fc" id="L132">        collapseButton.setToolTipText(&quot;Collapse the Tree&quot;);</span>
<span class="fc" id="L133">        JToolBar toolbar = new JToolBar();</span>
<span class="fc" id="L134">        toolbar.setFloatable(false);</span>
<span class="fc" id="L135">        toolbar.add(clearButton);</span>
<span class="fc" id="L136">        toolbar.addSeparator();</span>
<span class="fc" id="L137">        toolbar.add(searchLabel);</span>
<span class="fc" id="L138">        toolbar.add(searchTextField);</span>
<span class="fc" id="L139">        toolbar.add(searchButton);</span>
<span class="fc" id="L140">        toolbar.addSeparator();</span>
<span class="fc" id="L141">        toolbar.add(expandButton);</span>
<span class="fc" id="L142">        toolbar.add(collapseButton);</span>
<span class="fc" id="L143">        add(toolbar, BorderLayout.NORTH);</span>
<span class="fc" id="L144">    }</span>

    private FixInfoTreeNode loadFIXTree() {
<span class="fc" id="L147">        FixInfoTreeNode root = new FixInfoTreeNode(&quot;Dictionaries&quot;);</span>
        FixInfoTreeNode node;
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        for (DictionaryInfo dictionary : library.getDictionaries()) {</span>
<span class="nc" id="L150">            node = new FixInfoTreeNode(dictionary.getVersion());</span>
<span class="nc" id="L151">            loadMessages(node, dictionary);</span>
<span class="nc" id="L152">            root.add(node);</span>
<span class="nc" id="L153">        }</span>

<span class="fc" id="L155">        return root;</span>
    }

    private void loadMessages(FixInfoTreeNode versionNode,
            DictionaryInfo dictionary) {
        FixInfoTreeNode node;
<span class="nc bnc" id="L161" title="All 2 branches missed.">        for (MessageInfo message : dictionary.getMessages()) {</span>
<span class="nc" id="L162">            node = new FixInfoTreeNode(message);</span>
<span class="nc" id="L163">            loadItems(node, message, 0);</span>
<span class="nc" id="L164">            versionNode.add(node);</span>
<span class="nc" id="L165">        }</span>
<span class="nc" id="L166">    }</span>

    private void loadItems(FixInfoTreeNode branchNode,
            CompositeFixInfo leafNode, int level) {
<span class="nc" id="L170">        level++;</span>
        FixInfoTreeNode node;
<span class="nc bnc" id="L172" title="All 2 branches missed.">        for (FixInfo info : leafNode.getItems()) {</span>
<span class="nc" id="L173">            node = new FixInfoTreeNode(info);</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">            if (info instanceof CompositeFixInfo) {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">                if (level &lt; 5) {</span>
<span class="nc" id="L176">                    loadItems(node, (CompositeFixInfo) info, level);</span>
                }
            }
<span class="nc" id="L179">            branchNode.add(node);</span>
<span class="nc" id="L180">        }</span>
<span class="nc" id="L181">    }</span>

    private void expandAll() {
<span class="nc" id="L184">        synchronized (fixTree) {</span>
<span class="nc" id="L185">            int row = 0;</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">            while (row &lt; fixTree.getRowCount()) {</span>
<span class="nc" id="L187">                fixTree.expandRow(row);</span>
<span class="nc" id="L188">                row++;</span>
            }
<span class="nc" id="L190">        }</span>
<span class="nc" id="L191">    }</span>

    private void collapseAll() {
<span class="nc" id="L194">        synchronized (fixTree) {</span>
<span class="nc" id="L195">            int row = fixTree.getRowCount() - 1;</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            while (row &gt;= 0) {</span>
<span class="nc" id="L197">                fixTree.collapseRow(row);</span>
<span class="nc" id="L198">                row--;</span>
            }
<span class="nc" id="L200">        }</span>
<span class="nc" id="L201">    }</span>

    private void search(FixInfoTreeNode node, String searchString) {
<span class="nc" id="L204">        int count = 0;</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (node.getUserObject() instanceof FixInfo) {</span>
<span class="nc" id="L207">            FixInfo info = (FixInfo) node.getUserObject();</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">            if (info instanceof MessageInfo) {</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                if (((MessageInfo) info).getName().matches(searchString)</span>
<span class="nc bnc" id="L210" title="All 2 branches missed.">                        || ((MessageInfo) info).getMessageType().matches(</span>
                                searchString)) {
<span class="nc" id="L212">                    node.setHighlighted(true);</span>
<span class="nc" id="L213">                    fixTree.expandPath(new TreePath(node.getPath()));</span>
                }
<span class="nc bnc" id="L215" title="All 2 branches missed.">            } else if (info instanceof ComponentInfo) {</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                if (((ComponentInfo) info).getName().matches(searchString)) {</span>
<span class="nc" id="L217">                    node.setHighlighted(true);</span>
<span class="nc" id="L218">                    fixTree.expandPath(new TreePath(node.getPath()));</span>
                }
<span class="nc bnc" id="L220" title="All 2 branches missed.">            } else if (info instanceof FieldInfo) {</span>
<span class="nc" id="L221">                String tagNumber = &quot;&quot; + ((FieldInfo) info).getTagNumber();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                if (((FieldInfo) info).getName().matches(searchString)</span>
<span class="nc bnc" id="L223" title="All 2 branches missed.">                        || tagNumber.matches(searchString)) {</span>
<span class="nc" id="L224">                    node.setHighlighted(true);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">                    if (node.getChildCount() &gt; 0) {</span>
<span class="nc" id="L226">                        fixTree.expandPath(new TreePath(node.getPath()));</span>
                    } else {
<span class="nc" id="L228">                        fixTree.expandPath(new TreePath(((FixInfoTreeNode) node</span>
<span class="nc" id="L229">                                .getParent()).getPath()));</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L234" title="All 2 branches missed.">        while (count &lt; node.getChildCount()) {</span>
<span class="nc" id="L235">            FixInfoTreeNode childNode = (FixInfoTreeNode) node</span>
<span class="nc" id="L236">                    .getChildAt(count);</span>
<span class="nc" id="L237">            search(childNode, searchString);</span>
<span class="nc" id="L238">            count++;</span>
<span class="nc" id="L239">        }</span>
<span class="nc" id="L240">    }</span>

    private void clear(FixInfoTreeNode node) {
<span class="nc" id="L243">        int count = 0;</span>
<span class="nc" id="L244">        node.setHighlighted(false);</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">        while (count &lt; node.getChildCount()) {</span>
<span class="nc" id="L246">            FixInfoTreeNode childNode = (FixInfoTreeNode) node</span>
<span class="nc" id="L247">                    .getChildAt(count);</span>
<span class="nc" id="L248">            clear(childNode);</span>
<span class="nc" id="L249">            count++;</span>
<span class="nc" id="L250">        }</span>
<span class="nc" id="L251">    }</span>

    public void valueChanged(TreeSelectionEvent event) {
<span class="fc" id="L254">        FixInfoTreeNode node = (FixInfoTreeNode) fixTree</span>
<span class="fc" id="L255">                .getLastSelectedPathComponent();</span>
<span class="pc bpc" id="L256" title="1 of 2 branches missed.">        if (node != null) {</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (node.getUserObject() instanceof FieldInfo) {</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if (((FixInfoTreeNode) node.getParent()).getUserObject() instanceof ComponentInfo) {</span>
<span class="nc" id="L259">                    LibrarySuite.getInstance().getDetailsPanel()</span>
<span class="nc" id="L260">                            .displayDetails(</span>
<span class="nc" id="L261">                                    (FieldInfo) node.getUserObject(),</span>
                                    (ComponentInfo) ((FixInfoTreeNode) node
<span class="nc" id="L263">                                            .getParent()).getUserObject());</span>
                } else {
<span class="nc" id="L265">                    LibrarySuite.getInstance().getDetailsPanel()</span>
<span class="nc" id="L266">                            .displayDetails(</span>
<span class="nc" id="L267">                                    (FieldInfo) node.getUserObject(),</span>
                                    (ComponentInfo) ((FixInfoTreeNode) node
<span class="nc" id="L269">                                            .getPath()[2]).getUserObject());</span>
                }
<span class="nc bnc" id="L271" title="All 2 branches missed.">            } else if (node.getUserObject() instanceof MessageInfo) {</span>
<span class="nc" id="L272">                LibrarySuite.getInstance().getDetailsPanel().displayDetails(</span>
<span class="nc" id="L273">                        (MessageInfo) node.getUserObject(), null);</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            } else if (node.getUserObject() instanceof ComponentInfo) {</span>
<span class="nc" id="L275">                LibrarySuite.getInstance().getDetailsPanel().displayDetails(</span>
<span class="nc" id="L276">                        (ComponentInfo) node.getUserObject(), null);</span>
            } else {
<span class="nc" id="L278">                LibrarySuite.getInstance().getDetailsPanel().clearDisplay();</span>
            }
        }
<span class="fc" id="L281">    }</span>

    public void actionPerformed(ActionEvent event) {
<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (event.getSource().equals(collapseButton)) {</span>
<span class="nc" id="L285">            collapseAll();</span>
<span class="nc bnc" id="L286" title="All 2 branches missed.">        } else if (event.getSource().equals(expandButton)) {</span>
<span class="nc" id="L287">            expandAll();</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">        } else if (event.getSource().equals(searchButton)) {</span>
<span class="nc" id="L289">            clear((FixInfoTreeNode) fixTree.getModel().getRoot());</span>
<span class="nc" id="L290">            collapseAll();</span>
<span class="nc" id="L291">            search((FixInfoTreeNode) fixTree.getModel().getRoot(),</span>
<span class="nc" id="L292">                    searchTextField.getText().trim());</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">        } else if (event.getSource().equals(clearButton)) {</span>
<span class="nc" id="L294">            clear((FixInfoTreeNode) fixTree.getModel().getRoot());</span>
<span class="nc" id="L295">            collapseAll();</span>
        }

<span class="nc" id="L298">    }</span>

    public void keyPressed(KeyEvent event) {
<span class="nc bnc" id="L301" title="All 2 branches missed.">        if (event.getKeyCode() == KeyEvent.VK_ENTER) {</span>
<span class="nc" id="L302">            searchButton.doClick();</span>
        }
<span class="nc" id="L304">    }</span>

    public void keyReleased(KeyEvent event) {
<span class="nc" id="L307">    }</span>

    public void keyTyped(KeyEvent event) {
<span class="nc" id="L310">    }</span>

    private class FixInfoTreeNode extends DefaultMutableTreeNode {

        private static final long serialVersionUID = 1L;

        private boolean isHighlighted;

<span class="fc" id="L318">        private FixInfoTreeNode(Object userObject) {</span>
<span class="fc" id="L319">            super(userObject);</span>
<span class="fc" id="L320">            isHighlighted = false;</span>
<span class="fc" id="L321">        }</span>

        private boolean isHighlighted() {
<span class="fc" id="L324">            return isHighlighted;</span>
        }

        private void setHighlighted(boolean isHighlighted) {
<span class="nc" id="L328">            this.isHighlighted = isHighlighted;</span>
<span class="nc" id="L329">        }</span>

    }

<span class="fc" id="L333">    private class FixInfoCellRenderer extends DefaultTreeCellRenderer {</span>

        private static final long serialVersionUID = 1L;

        public Component getTreeCellRendererComponent(JTree tree, Object value,
                boolean sel, boolean expanded, boolean leaf, int row,
                boolean hasFocus) {
<span class="fc" id="L340">            JLabel label = (JLabel) super.getTreeCellRendererComponent(tree,</span>
                    value, sel, expanded, leaf, row, hasFocus);
<span class="pc bpc" id="L342" title="1 of 2 branches missed.">            if (((FixInfoTreeNode) value).getUserObject() instanceof FieldInfo) {</span>
<span class="nc" id="L343">                FieldInfo field = (FieldInfo) ((FixInfoTreeNode) value)</span>
<span class="nc" id="L344">                        .getUserObject();</span>
<span class="nc" id="L345">                label.setText(field.getName() + &quot; (&quot; + field.getTagNumber()</span>
                        + &quot;)&quot;);
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">            } else if (((FixInfoTreeNode) value).getUserObject() instanceof MessageInfo) {</span>
<span class="nc" id="L348">                MessageInfo message = (MessageInfo) ((FixInfoTreeNode) value)</span>
<span class="nc" id="L349">                        .getUserObject();</span>
<span class="nc" id="L350">                label.setText(message.getName() + &quot; (&quot;</span>
<span class="nc" id="L351">                        + message.getMessageType() + &quot;)&quot;);</span>
<span class="pc bpc" id="L352" title="1 of 2 branches missed.">            } else if (((FixInfoTreeNode) value).getUserObject() instanceof ComponentInfo) {</span>
<span class="nc" id="L353">                ComponentInfo component = (ComponentInfo) ((FixInfoTreeNode) value)</span>
<span class="nc" id="L354">                        .getUserObject();</span>
<span class="nc" id="L355">                label.setText(&quot;[&quot; + component.getName() + &quot;]&quot;);</span>
            }
<span class="pc bpc" id="L357" title="1 of 2 branches missed.">            if (((FixInfoTreeNode) value).isHighlighted()) {</span>
<span class="nc" id="L358">                label.setForeground(Color.BLUE);</span>
            }

<span class="fc" id="L361">            return label;</span>
        }

    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>