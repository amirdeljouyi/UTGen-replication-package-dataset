<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">56_jhandballmoves</a> &gt; <a href="index.source.html" class="el_package">visu.handball.moves</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">/*
 * Created on 31.08.2006
 * Created by Richard Doerfler, Thomas Halm
 * Copyright (C) 2006  Richard Doerfler, Thomas Halm
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */

package visu.handball.moves;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.URL;

import javax.swing.ImageIcon;
import javax.swing.JDesktopPane;
import javax.swing.JFrame;
import javax.swing.JInternalFrame;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JToolBar;
import javax.swing.ListSelectionModel;
import javax.swing.UIManager;

import visu.handball.moves.actions.AboutAction;
import visu.handball.moves.actions.ChangeColorsAction;
import visu.handball.moves.actions.CloseAction;
import visu.handball.moves.actions.CreateMovePdfAction;
import visu.handball.moves.actions.DeleteEventAction;
import visu.handball.moves.actions.NewAction;
import visu.handball.moves.actions.NewMoveEventAction;
import visu.handball.moves.actions.NewPassEventAction;
import visu.handball.moves.actions.NewSequenceAction;
import visu.handball.moves.actions.OpenAction;
import visu.handball.moves.actions.PauseAnimationAction;
import visu.handball.moves.actions.PrintActualSequenzAction;
import visu.handball.moves.actions.PrintMoveAction;
import visu.handball.moves.actions.SaveAction;
import visu.handball.moves.actions.SetMoveNameAction;
import visu.handball.moves.actions.StartAnimationAction;
import visu.handball.moves.actions.StartOneSequenceAnimationAction;
import visu.handball.moves.actions.StopAnimationAction;
import visu.handball.moves.controller.CommentController;
import visu.handball.moves.controller.JMenuHelper;
import visu.handball.moves.controller.MouseController;
import visu.handball.moves.model.ColorModel;
import visu.handball.moves.model.HandballModel;
import visu.handball.moves.model.TableHandballModel;
import visu.handball.moves.model.TableSelectionListener;
import visu.handball.moves.resources.Resources;
import visu.handball.moves.views.CommentView;
import visu.handball.moves.views.EventTableCellDelayEditor;
import visu.handball.moves.views.EventTableCellRenderer;
import visu.handball.moves.views.Field;
import visu.handball.moves.views.PlayerToolBar;
import visu.handball.moves.views.StatusBar;

/**
 * Hauptklasse zum Starten der Anwendung plus den Zugriff auf die entsprechenden Objekt-Instanzen
 * @author tommy
 *
 */
<span class="nc" id="L86">public class Main {</span>

	private static SaveAction saveAction;

	private static CloseAction closeAction;
	
	private static SetMoveNameAction setNameAction;

	private static JFrame window;

	private static Field field;
	
	private static CommentView commentView;
	
	private static ColorModel colorModel;

	/**
	 * Liefert die Instanz des ColorModels
	 * 
	 * @return colorModel
	 */
	public static ColorModel getColorModel() {
<span class="nc" id="L108">		return colorModel;</span>
	}

	/**
	 * Main-Methode zum Starten der Anwendung
	 * 
	 * @param args
	 */
	public static void main(String[] args) {
		try {
<span class="nc" id="L118">			UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());</span>
<span class="nc" id="L119">		} catch (Exception e) {</span>
<span class="nc" id="L120">			System.out</span>
<span class="nc" id="L121">					.println(Resources.getString(&quot;error.lookAndFell&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L122">		}</span>

<span class="nc" id="L124">		window = new JFrame(Resources.getString(&quot;app.title&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L125">		window.setIconImage(createImageIcon(&quot;images/icon.gif&quot;, &quot;&quot;).getImage()); //$NON-NLS-1$ //$NON-NLS-2$</span>
<span class="nc" id="L126">		JPanel content = new JPanel(new BorderLayout());</span>
<span class="nc" id="L127">		JDesktopPane desktop = new JDesktopPane();</span>
<span class="nc" id="L128">		window.setContentPane(content);</span>

<span class="nc" id="L130">		content.add(desktop, BorderLayout.CENTER);</span>
<span class="nc" id="L131">		desktop.setBackground(new Color(255, 255, 174));</span>
<span class="nc" id="L132">		desktop.setDragMode(JDesktopPane.OUTLINE_DRAG_MODE);</span>

		// Create HandballModel
<span class="nc" id="L135">		HandballModel handballModel = createHandballModel();</span>

		// Create ColorModel
<span class="nc" id="L138">		colorModel = new ColorModel();</span>
		
		// Statusbar
<span class="nc" id="L141">		StatusBar statusBar = createStatusBar(handballModel);</span>
<span class="nc" id="L142">		content.add(statusBar, BorderLayout.SOUTH);</span>

		// Create Menu
<span class="nc" id="L145">		JMenuBar menu = createHandballMenu(handballModel);</span>
<span class="nc" id="L146">		window.setJMenuBar(menu);</span>

		// Create HandballField
<span class="nc" id="L149">		field = new Field(handballModel,colorModel);</span>
				
<span class="nc" id="L151">		JInternalFrame handballField = new JInternalFrame(Resources.getString(&quot;field.title&quot;), false, //$NON-NLS-1$</span>
				false, false, true);
<span class="nc" id="L153">		handballField.setLocation(10, 10);</span>
<span class="nc" id="L154">		handballField.add(field);</span>
<span class="nc" id="L155">		handballField.setVisible(true);</span>
<span class="nc" id="L156">		handballField.pack();</span>
<span class="nc" id="L157">		desktop.add(handballField);</span>

		// Create MouseController
<span class="nc" id="L160">		MouseController mouse = new MouseController(handballModel,</span>
				handballField);
<span class="nc" id="L162">		field.addMouseListener(mouse);</span>
<span class="nc" id="L163">		field.addMouseMotionListener(mouse);</span>
		// Add Statusbar as Listener
<span class="nc" id="L165">		field.addMouseMotionListener(statusBar);</span>

		// Create ToolBar
<span class="nc" id="L168">		PlayerToolBar playerBar = new PlayerToolBar(handballModel);</span>
<span class="nc" id="L169">		content.add(playerBar, BorderLayout.NORTH);</span>

		// Create EventView
<span class="nc" id="L172">		JPanel tablePanel = createTablePanel(handballModel);</span>
<span class="nc" id="L173">		JInternalFrame eventView = new JInternalFrame(Resources.getString(&quot;events.title&quot;), true, //$NON-NLS-1$</span>
				false, false, true);
<span class="nc" id="L175">		eventView.add(tablePanel);</span>
<span class="nc" id="L176">		eventView.setLocation(20 + handballField.getWidth(), 10);</span>
<span class="nc" id="L177">		eventView.setVisible(true);</span>
<span class="nc" id="L178">		eventView.setSize(450, 400);</span>
<span class="nc" id="L179">		desktop.add(eventView);</span>

		// Create CommentView
<span class="nc" id="L182">		commentView = new CommentView(Resources.getString(&quot;comment.title&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L183">		commentView.setLocation(20 + handballField.getWidth(),420);</span>
<span class="nc" id="L184">		commentView.setSize(450,handballField.getHeight()-eventView.getHeight()-10);</span>
<span class="nc" id="L185">		commentView.setVisible(true);</span>
		//Controller für CommentView erzeugen
<span class="nc" id="L187">		new CommentController(handballModel, commentView);</span>
<span class="nc" id="L188">		desktop.add(commentView);</span>
		
<span class="nc" id="L190">		window.setSize(1000, 700);</span>
<span class="nc" id="L191">		locateOnScreenCenter(window);</span>

<span class="nc" id="L193">		window.addWindowListener(new WindowAdapter() {</span>
			public void windowClosing(WindowEvent e) {
<span class="nc" id="L195">				Main.getCloseAction().actionPerformed(null);</span>
<span class="nc" id="L196">			}</span>
		});
<span class="nc" id="L198">		window.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L199">		window.setVisible(true);</span>
<span class="nc" id="L200">	}</span>

	private static JMenuBar createHandballMenu(HandballModel handballModel) {
		JMenuBar mbar;
		JMenu menuDatei, menuHilfe, menuEinstellungen;

		// Hauptmenue einrichten
<span class="nc" id="L207">		mbar = new JMenuBar();</span>
<span class="nc" id="L208">		menuDatei = JMenuHelper.addMenuBarItem(mbar, Resources.getString(&quot;menu.file&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L209">		menuEinstellungen = JMenuHelper.addMenuBarItem(mbar,Resources.getString(&quot;menu.settings&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L210">		menuHilfe = JMenuHelper.addMenuBarItem(mbar, Resources.getString(&quot;menu.about&quot;)); //$NON-NLS-1$</span>

		// Einträge fuer Datei
<span class="nc" id="L213">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, new NewAction( //$NON-NLS-1$</span>
				handballModel));
<span class="nc" id="L215">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;,  new OpenAction( //$NON-NLS-1$</span>
				handballModel));
		
		//Separator einfügen
<span class="nc" id="L219">		JMenuHelper.addMenuItem(menuDatei, &quot;-&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L220">		saveAction = new SaveAction(handballModel);</span>
<span class="nc" id="L221">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, saveAction); //$NON-NLS-1$</span>
		
		// Separator einfügen
<span class="nc" id="L224">		JMenuHelper.addMenuItem(menuDatei, &quot;-&quot;); //$NON-NLS-1$</span>
<span class="nc" id="L225">		setNameAction = new SetMoveNameAction(handballModel);</span>
<span class="nc" id="L226">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, setNameAction); //$NON-NLS-1$</span>
		
		//Separator einfügen
<span class="nc" id="L229">		JMenuHelper.addMenuItem(menuDatei, &quot;-&quot;); //$NON-NLS-1$</span>
		//Drucken einfügen
<span class="nc" id="L231">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, new PrintActualSequenzAction( //$NON-NLS-1$</span>
				handballModel));
<span class="nc" id="L233">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, new PrintMoveAction(handballModel)); //$NON-NLS-1$</span>
<span class="nc" id="L234">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, new CreateMovePdfAction(handballModel)); //$NON-NLS-1$</span>

		// Separator einfügen
<span class="nc" id="L237">		JMenuHelper.addMenuItem(menuDatei, &quot;-&quot;); //$NON-NLS-1$</span>

<span class="nc" id="L239">		closeAction = new CloseAction(handballModel);</span>
<span class="nc" id="L240">		JMenuHelper.addMenuItem(menuDatei, &quot;&quot;, closeAction); //$NON-NLS-1$</span>

		// Einträge für Einstellungen
<span class="nc" id="L243">		JMenuHelper.addMenuItem(menuEinstellungen, &quot;&quot;, new ChangeColorsAction()); //$NON-NLS-1$</span>
		
		// Einträge für Hilfe
<span class="nc" id="L246">		JMenuHelper.addMenuItem(menuHilfe, &quot;&quot;, //$NON-NLS-1$</span>
				new AboutAction());

<span class="nc" id="L249">		return mbar;</span>
	}

	private static JPanel createTablePanel(HandballModel handballModel) {
<span class="nc" id="L253">		TableHandballModel tableModel = new TableHandballModel(handballModel);</span>
<span class="nc" id="L254">		JTable table = new JTable(tableModel);</span>
<span class="nc" id="L255">		table.setDefaultRenderer(Object.class, new EventTableCellRenderer());</span>
<span class="nc" id="L256">		table.getColumnModel().getColumn(0).setPreferredWidth(100);</span>
<span class="nc" id="L257">		table.getColumnModel().getColumn(1).setPreferredWidth(200);</span>
<span class="nc" id="L258">		EventTableCellDelayEditor delayEditor = new EventTableCellDelayEditor();</span>
<span class="nc" id="L259">		table.getColumnModel().getColumn(3).setCellEditor(delayEditor);</span>
<span class="nc" id="L260">		table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L261">		table.getSelectionModel().addListSelectionListener(</span>
				new TableSelectionListener(tableModel));
<span class="nc" id="L263">		JPanel panel = new JPanel(new BorderLayout());</span>

<span class="nc" id="L265">		JToolBar toolBar = new JToolBar(Resources.getString(&quot;toolbar.title&quot;)); //$NON-NLS-1$</span>

<span class="nc" id="L267">		toolBar.add(new NewMoveEventAction(handballModel));</span>
<span class="nc" id="L268">		toolBar.add(new NewSequenceAction(handballModel));</span>
<span class="nc" id="L269">		toolBar.add(new NewPassEventAction(handballModel));</span>
<span class="nc" id="L270">		toolBar.add(new DeleteEventAction(handballModel));</span>
<span class="nc" id="L271">		toolBar.addSeparator();</span>

<span class="nc" id="L273">		toolBar.add(new StartOneSequenceAnimationAction(handballModel));</span>
<span class="nc" id="L274">		toolBar.add(new StartAnimationAction(handballModel));</span>
<span class="nc" id="L275">		toolBar.add(new PauseAnimationAction(handballModel));</span>
<span class="nc" id="L276">		toolBar.add(new StopAnimationAction(handballModel));</span>

<span class="nc" id="L278">		JScrollPane scroll = new JScrollPane(table);</span>
<span class="nc" id="L279">		panel.add(scroll, BorderLayout.CENTER);</span>
<span class="nc" id="L280">		panel.add(toolBar, BorderLayout.PAGE_START);</span>

<span class="nc" id="L282">		return panel;</span>
	}

	private static StatusBar createStatusBar(HandballModel model) {
<span class="nc" id="L286">		StatusBar statusBar = new StatusBar(model);</span>
<span class="nc" id="L287">		return statusBar;</span>
	}

	/**
	 * Basierend auf der relativen Pfad (relativ zum Ort dieser Klasse) und der Beschreibung
	 * wird ein Grafik geladen und ein ImageIcon-Objekt erstellt.
	 * @param path
	 * @param description
	 * 
	 * @return imageIcon
	 */
	public static ImageIcon createImageIcon(String path, String description) {
<span class="fc" id="L299">		URL url = Main.class.getResource(path);</span>
<span class="fc" id="L300">		return new ImageIcon(url, description);</span>
	}
	
 	/**
 	 * Erzeugt auf Basis eines relativen Pfads (relativ zum Ort dieser Klasse) eine URL.
 	 * @param path
 	 * 
 	 * @return url
 	 */
 	public static URL getResource(String path) {
<span class="nc" id="L310"> 		return Main.class.getResource(path);</span>
 	}

	/**
	 * Methode um Component-Objekte (z.B. Fenster) in der Mitte des Bildschirms zu positionieren
	 * @param component
	 */
	public static void locateOnScreenCenter(Component component) {
<span class="nc" id="L318">		Dimension paneSize = component.getSize();</span>
<span class="nc" id="L319">		Dimension screenSize = component.getToolkit().getScreenSize();</span>
<span class="nc" id="L320">		component.setLocation((screenSize.width - paneSize.width) / 2,</span>
				(screenSize.height - paneSize.height) / 2);
<span class="nc" id="L322">	}</span>

	private static HandballModel createHandballModel() {
<span class="nc" id="L325">		HandballModel model = new HandballModel();</span>

<span class="nc" id="L327">		return model;</span>
	}

	/**
	 * Die Instanz des Anwendungsfensters
	 * 
	 * @return window
	 */
	public static JFrame getWindow() {
<span class="fc" id="L336">		return window;</span>
	}

	/**
	 * Instanz des Spielfeld-Panels
	 * 
	 * @return panel
	 */
	public static Field getField() {
<span class="nc" id="L345">		return field;</span>
	}

	/**
	 * Instanz der Speichern-Aktion
	 * 
	 * @return saveAction
	 */
	public static SaveAction getSaveAction() {
<span class="nc" id="L354">		return saveAction;</span>
	}

	
	public static SetMoveNameAction getSetNameAction() {
<span class="nc" id="L359">		return setNameAction;</span>
	}

	/**
	 * Instanz der Schlie�en-Aktion
	 * 
	 * @return close Action
	 */
	public static CloseAction getCloseAction() {
<span class="nc" id="L368">		return closeAction;</span>
	}

	/**
	 * Methode um eine tiefe Objektkopie per Serialisierung zu erzeugen!
	 * 
	 * @param oldObj (muss Serializable implementieren)
	 * @return tiefe Kopie
	 * @throws Exception
	 */
	public static Object deepCopy(Object oldObj) throws Exception {
<span class="fc" id="L379">		Object clone = null;</span>
		try {
<span class="fc" id="L381">			ByteArrayOutputStream baos = new ByteArrayOutputStream();</span>
<span class="fc" id="L382">			ObjectOutputStream oos = new ObjectOutputStream(baos);</span>
<span class="fc" id="L383">			oos.writeObject(oldObj);</span>
<span class="fc" id="L384">			oos.flush();</span>
<span class="fc" id="L385">			ObjectInputStream ois = new ObjectInputStream(</span>
<span class="fc" id="L386">					new ByteArrayInputStream(baos.toByteArray()));</span>

<span class="fc" id="L388">			clone = ois.readObject();</span>

<span class="fc" id="L390">			oos.close();</span>
<span class="fc" id="L391">			ois.close();</span>

<span class="nc" id="L393">		} catch (Exception e) {</span>
<span class="nc" id="L394">			System.out.println(&quot;Exception in ObjectCloner = &quot; + e); //$NON-NLS-1$</span>
<span class="nc" id="L395">			throw (e);</span>
<span class="fc" id="L396">		}</span>
<span class="fc" id="L397">		return clone;</span>
	}
	
	/**
	 * Liefert die Version der Anwendung als String
	 * 
	 * @return version
	 */
	public static String getVersion() {
<span class="nc" id="L406">		return &quot;1.0.5&quot;; //$NON-NLS-1$</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>