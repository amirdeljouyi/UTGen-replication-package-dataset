<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MouseController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">56_jhandballmoves</a> &gt; <a href="index.source.html" class="el_package">visu.handball.moves.controller</a> &gt; <span class="el_source">MouseController.java</span></div><h1>MouseController.java</h1><pre class="source lang-java linenums">/*
 * Created on 31.08.2006
 * Created by Richard Doerfler, Thomas Halm
 * Copyright (C) 2006  Richard Doerfler, Thomas Halm
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */

package visu.handball.moves.controller;

import java.awt.Point;
import java.awt.event.MouseEvent;
import java.beans.PropertyVetoException;

import javax.swing.JInternalFrame;
import javax.swing.JOptionPane;
import javax.swing.event.MouseInputAdapter;

import visu.handball.moves.Main;
import visu.handball.moves.model.HandballModel;
import visu.handball.moves.model.MoveEvent;
import visu.handball.moves.model.PassEvent;
import visu.handball.moves.model.HandballModel.State;
import visu.handball.moves.model.player.Defender;
import visu.handball.moves.model.player.MovePoint;
import visu.handball.moves.model.player.Offender;
import visu.handball.moves.model.player.Player;

/**
 * Controller für Maus-Input auf dem Spielfeld
 * 
 * @author tommy
 */
public class MouseController extends MouseInputAdapter {

	private final static String playerInSixMeter = &quot;Spieler dürfen nicht im Sechsmeter-Raum positioniert werden&quot;;

	private final static String moveInSixMeter = &quot;Laufwege dürfen nicht im Sechsmeter-Raum enden&quot;;

	private HandballModel model;

<span class="nc" id="L54">	private Player actualPlayer = null;</span>

<span class="nc" id="L56">	private MovePoint acutalMovePoint = null;</span>

	private JInternalFrame frame;

	/**
	 * Konstruktor
	 * 
	 * @param model Model das auf dem Spielfeld angezeigt wird
	 * @param frame InternalFrame des Spielfelds
	 */
<span class="nc" id="L66">	public MouseController(HandballModel model, JInternalFrame frame) {</span>
<span class="nc" id="L67">		this.model = model;</span>
<span class="nc" id="L68">		this.frame = frame;</span>
<span class="nc" id="L69">	}</span>

	@Override
	public void mouseClicked(MouseEvent e) {
<span class="nc" id="L73">		State state = model.getState();</span>
<span class="nc bnc" id="L74" title="All 8 branches missed.">		switch (state) {</span>
		case INITIAL:
<span class="nc" id="L76">			break;</span>
		case PLACE_BALL:
<span class="nc bnc" id="L78" title="All 2 branches missed.">			if (e.getButton() == MouseEvent.BUTTON1) {</span>
<span class="nc" id="L79">				Offender ballOwner = model.getNearestOffender(e.getX(), e</span>
<span class="nc" id="L80">						.getY());</span>
<span class="nc" id="L81">				model.setFirstBallOwner(ballOwner);</span>
<span class="nc" id="L82">			}</span>
			break;
		case PLACE_OFFENDERS:
<span class="nc bnc" id="L85" title="All 2 branches missed.">			if (e.getButton() == MouseEvent.BUTTON1) {</span>
				// linker Mausknopf
<span class="nc bnc" id="L87" title="All 2 branches missed.">				if (isInsideSixMeter(e)) {</span>
<span class="nc" id="L88">					insideSixmeterMessage(playerInSixMeter);</span>
<span class="nc" id="L89">					return;</span>
				} else
<span class="nc" id="L91">					model.addOffender(e.getX(), e.getY());</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">			} else if (e.getButton() == MouseEvent.BUTTON3) {</span>
				// rechter Mausknopf
<span class="nc" id="L94">				Player player = model.getNearestPlayer(e.getX(), e.getY());</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">				if (player instanceof Offender) {</span>
<span class="nc" id="L96">					deletePlayer(player);</span>
				}
<span class="nc" id="L98">			}</span>
			break;
		case PLACE_DEFENDERS:
<span class="nc bnc" id="L101" title="All 2 branches missed.">			if (e.getButton() == MouseEvent.BUTTON1) {</span>
				// linker Mausknopf
<span class="nc bnc" id="L103" title="All 2 branches missed.">				if (isInsideSixMeter(e)) {</span>
<span class="nc" id="L104">					insideSixmeterMessage(playerInSixMeter);</span>
<span class="nc" id="L105">					return;</span>
				} else
<span class="nc" id="L107">					model.addDefender(e.getX(), e.getY());</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">			} else if (e.getButton() == MouseEvent.BUTTON3) {</span>
				// rechter Mausknopf
<span class="nc" id="L110">				Player player = model.getNearestPlayer(e.getX(), e.getY());</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">				if (player instanceof Defender) {</span>
<span class="nc" id="L112">					deletePlayer(player);</span>
				}
<span class="nc" id="L114">			}</span>
			break;
		case EDIT:
<span class="nc" id="L117">			model.setMarkedPlayer(model.getNearestPlayer(e.getX(), e.getY()));</span>
<span class="nc" id="L118">			break;</span>
		case EDIT_EVENT:
<span class="nc" id="L120">			MoveEvent event = model.getActualMoveEvent();</span>
			// PassEvent
<span class="nc bnc" id="L122" title="All 2 branches missed.">			if (event instanceof PassEvent) {</span>
<span class="nc" id="L123">				PassEvent pass = (PassEvent) event;</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">				if (!event.isDestinationPointSet()) {</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">					if (Main.getField().insideGoal(e.getX(), e.getY())) {</span>
<span class="nc" id="L126">						pass.setGoalPass(true);</span>
					} else {
<span class="nc" id="L128">						Player player = model.getNearestPlayer(e.getX(), e</span>
<span class="nc" id="L129">								.getY());</span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">						if (player != null &amp;&amp; player instanceof Offender) {</span>
<span class="nc" id="L131">							pass.setDestinationPlayer((Offender) player, false);</span>
						} else {
<span class="nc" id="L133">							pass.setDestinationPlayer(null, false);</span>
						}
<span class="nc" id="L135">						pass.setGoalPass(false);</span>
					}
<span class="nc" id="L137">					model.setState(State.EDIT);</span>
				}
<span class="nc" id="L139">			}</span>
			// MoveEvent
			else {
<span class="nc bnc" id="L142" title="All 4 branches missed.">				if (isInsideSixMeter(e) &amp;&amp; !event.isDestinationPointSet()) {</span>
<span class="nc" id="L143">					insideSixmeterMessage(moveInSixMeter);</span>
<span class="nc" id="L144">					return;</span>
				}
<span class="nc bnc" id="L146" title="All 2 branches missed.">				if (!event.isDestinationPointSet()) {</span>
<span class="nc" id="L147">					model.setDestinationPointForEvent(event, e.getX(),</span>
<span class="nc" id="L148">							e.getY(), false);</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">				} else if (!event.isControlPointSet()) {</span>
<span class="nc" id="L150">					model.setControlPointForEvent(event, e.getX(), e.getY(),</span>
							false);
<span class="nc" id="L152">					model.setState(State.EDIT);</span>
				}
			}
			break;
		case ANIMATION:
<span class="nc" id="L157">			break;</span>

		default:
			break;
		}
<span class="nc" id="L162">	}</span>

	private void deletePlayer(Player player) {
<span class="nc bnc" id="L165" title="All 2 branches missed.">		if (model.eventDefinedWithPlayer(player)) {</span>

			int returncode = JOptionPane
<span class="nc" id="L168">					.showConfirmDialog(</span>
<span class="nc" id="L169">							Main.getWindow(),</span>
							&quot;Der Spieler hat noch Events.\nWollen Sie Ihn und die zugeh�rigen/abh�ngigen Events l�schen?&quot;,
							&quot;Frage:&quot;, JOptionPane.YES_NO_OPTION);
<span class="nc bnc" id="L172" title="All 2 branches missed.">			switch (returncode) {</span>
			case JOptionPane.NO_OPTION:
			case JOptionPane.CLOSED_OPTION:
				// Benutzer will nicht l�schen. Daher nix zu tun.
<span class="nc" id="L176">				return;</span>
			}
		}
<span class="nc" id="L179">		model.removePlayer(player);</span>
<span class="nc" id="L180">	}</span>

	private static void insideSixmeterMessage(String message) {
<span class="nc" id="L183">		JOptionPane.showMessageDialog(Main.getWindow(), message, &quot;Fehler&quot;,</span>
				JOptionPane.ERROR_MESSAGE);

<span class="nc" id="L186">	}</span>

	private boolean isInsideSixMeter(MouseEvent e) {
<span class="nc" id="L189">		return Main.getField().insideSixMeter(e.getX(), e.getY());</span>
	}

	@Override
	public void mouseDragged(MouseEvent e) {
<span class="nc bnc" id="L194" title="All 2 branches missed.">		if (!Main.getField().contains(e.getX(), e.getY())) {</span>
<span class="nc" id="L195">			return;</span>
		}
<span class="nc bnc" id="L197" title="All 2 branches missed.">		if (acutalMovePoint != null) {</span>
<span class="nc" id="L198">			MoveEvent actual = model.getActualMoveEvent();</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">			if (actual instanceof PassEvent) {</span>
				// Torwurf?
<span class="nc bnc" id="L201" title="All 2 branches missed.">				if (Main.getField().insideGoal(e.getX(), e.getY())) {</span>
<span class="nc" id="L202">					Point middle = Main.getField().getGoalMiddle();</span>
<span class="nc" id="L203">					((PassEvent) actual).setGoalPass(true);</span>
<span class="nc" id="L204">					model.setMovePointTo(acutalMovePoint, middle.x, middle.y);</span>
<span class="nc" id="L205">				} else {</span>
					// Abfragen, ob weitere P�sse vorhanden, dann darf Punkt
					// nicht verschoben werden.
<span class="nc bnc" id="L208" title="All 2 branches missed.">					if (model.passEventDefinedAfter(actual.getSequenceNr())) {</span>
<span class="nc" id="L209">						return;</span>
					}
					// versuchen Spieler zu finden
<span class="nc" id="L212">					Player player = model.getNearestPlayer(e.getX(), e.getY());</span>
<span class="nc bnc" id="L213" title="All 4 branches missed.">					if (player != null &amp;&amp; player instanceof Offender</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">							&amp;&amp; !player.equals(actual.getPlayer())) {</span>
<span class="nc" id="L215">						((PassEvent) actual).setDestinationPlayer(</span>
								(Offender) player, false);
<span class="nc" id="L217">						model.setMovePointTo(acutalMovePoint, player</span>
<span class="nc" id="L218">								.getCurrent_x(), player.getCurrent_y());</span>
					} else {
<span class="nc" id="L220">						((PassEvent) actual).setDestinationPlayer(null, false);</span>
<span class="nc" id="L221">						model.setMovePointTo(acutalMovePoint, e.getX(), e</span>
<span class="nc" id="L222">								.getY());</span>
					}
<span class="nc" id="L224">					((PassEvent) actual).setGoalPass(false);</span>
<span class="nc" id="L225">				}</span>
			} else {
<span class="nc bnc" id="L227" title="All 2 branches missed.">				if (isInsideSixMeter(e)</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">						&amp;&amp; actual.getControlPoint() != acutalMovePoint) {</span>
<span class="nc" id="L229">					return;</span>
				}
<span class="nc" id="L231">				model.setMovePointTo(acutalMovePoint, e.getX(), e.getY());</span>
			}
<span class="nc bnc" id="L233" title="All 2 branches missed.">		} else if (actualPlayer != null</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">				&amp;&amp; !Main.getField().insideSixMeter(e.getX(), e.getY())) {</span>
<span class="nc" id="L235">			model.movePlayerTo(actualPlayer, e.getX(), e.getY());</span>
		}
<span class="nc" id="L237">	}</span>

	@Override
	public void mouseMoved(MouseEvent e) {
<span class="nc" id="L241">		checkSelectionOfFrame();</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">		switch (model.getState()) {</span>
		case EDIT_EVENT:
<span class="nc" id="L245">			MoveEvent event = model.getActualMoveEvent();</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">			if (event instanceof PassEvent) {</span>
				// Passereignis
<span class="nc bnc" id="L248" title="All 2 branches missed.">				if (!event.isDestinationPointSet()) {</span>
					// innerhalb des Tores
<span class="nc bnc" id="L250" title="All 2 branches missed.">					if (Main.getField().insideGoal(e.getX(), e.getY())) {</span>
<span class="nc" id="L251">						Point middle = Main.getField().getGoalMiddle();</span>
<span class="nc" id="L252">						model.setDestinationPointForEvent(event, middle.x,</span>
								middle.y, true);
<span class="nc" id="L254">					} else {</span>
<span class="nc" id="L255">						Player player = model.getNearestPlayer(e.getX(), e</span>
<span class="nc" id="L256">								.getY());</span>
<span class="nc bnc" id="L257" title="All 4 branches missed.">						if (player != null &amp;&amp; player instanceof Offender) {</span>
<span class="nc" id="L258">							model.setDestinationPointForEvent(event, player</span>
<span class="nc" id="L259">									.getCurrent_x(), player.getCurrent_y(),</span>
									true);
						} else {
<span class="nc" id="L262">							model.setDestinationPointForEvent(event, e.getX(),</span>
<span class="nc" id="L263">									e.getY(), true);</span>
						}
<span class="nc" id="L265">					}</span>
				}
<span class="nc bnc" id="L267" title="All 4 branches missed.">			} else if (isInsideSixMeter(e) &amp;&amp; !event.isDestinationPointSet()) {</span>
<span class="nc" id="L268">				return;</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">			} else if (!event.isDestinationPointSet()) {</span>
<span class="nc" id="L270">				model.setDestinationPointForEvent(event, e.getX(), e.getY(),</span>
						true);
<span class="nc bnc" id="L272" title="All 2 branches missed.">			} else if (!event.isControlPointSet()) {</span>
<span class="nc" id="L273">				model.setControlPointForEvent(event, e.getX(), e.getY(), true);</span>
			}
			break;

		default:
<span class="nc" id="L278">			model.setHighLightedItem(model.getNearestHighlightableItem(</span>
<span class="nc" id="L279">					e.getX(), e.getY()));</span>
			break;
		}

<span class="nc" id="L283">	}</span>

	private void checkSelectionOfFrame() {
<span class="nc bnc" id="L286" title="All 2 branches missed.">		if (!frame.isSelected()) {</span>
<span class="nc" id="L287">			frame.moveToFront();</span>
			try {
<span class="nc" id="L289">				frame.setSelected(true);</span>
<span class="nc" id="L290">			} catch (PropertyVetoException e1) {</span>
<span class="nc" id="L291">				e1.printStackTrace();</span>
<span class="nc" id="L292">			}</span>
		}
<span class="nc" id="L294">	}</span>

	@Override
	public void mousePressed(MouseEvent e) {
<span class="nc" id="L298">		acutalMovePoint = model.getNearestMovePoint(e.getX(), e.getY());</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">		if (acutalMovePoint == null) {</span>
<span class="nc" id="L300">			actualPlayer = model.getNearestPlayer(e.getX(), e.getY());</span>
		}
<span class="nc" id="L302">	}</span>

	@Override
	public void mouseReleased(MouseEvent e) {
<span class="nc" id="L306">		actualPlayer = null;</span>
<span class="nc" id="L307">		acutalMovePoint = null;</span>
<span class="nc" id="L308">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>