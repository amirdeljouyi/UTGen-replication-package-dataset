<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Convert.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">47_dvd-homevideo</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Convert.java</span></div><h1>Convert.java</h1><pre class="source lang-java linenums">import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.InputStreamReader;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;

import java.lang.StringIndexOutOfBoundsException;

import java.util.StringTokenizer;

/**
 * @author Shane Santner
 * This class is used to transcode the video captured
 * from the digital camcorder into mpeg4, the DVD compatible
 * format.  It explicitly calls the transcode command
 * after meticulously preparing the options that can be passed
 * to transcode.
 *
 * TODO - Break mplex out into its own class.
 *        Figure out how to calculate remaining time even if
 *        video was not captured from the camcorder during the
 *        current session.  
 *        Need to handle input, output and error streams
 *        more appropriatly.
 */
public class Convert implements Runnable
{
    /** 
     * Creates a new instance of Convert based on the video
     * format and aspect ratio specified.
     * @param   format      This specifies either PAL or NTSC
     * @param   aspectRatio This can be either 4:3 or 16:9
     * @param   DVD_GUI     This is the GUI object used to control the form
     */
    public Convert(String format, String aspectRatio, GUI DVD_GUI) 
<span class="fc" id="L37">    {</span>
<span class="fc bfc" id="L38" title="All 2 branches covered.">        if(format.equals(&quot;dvd-ntsc&quot;))</span>
<span class="fc" id="L39">            m_fps = 29.97;</span>
        else
<span class="fc" id="L41">            m_fps = 25;</span>
        
<span class="fc" id="L43">        m_GUI = DVD_GUI;</span>
<span class="fc" id="L44">        m_Format = format;</span>
<span class="fc" id="L45">        m_AspectRatio = aspectRatio;</span>
<span class="fc" id="L46">        thread_track = 0;</span>
<span class="fc" id="L47">    }</span>
    
    /** 
     * Overloaded Constructor - accounts for quality being selected 
     * @param   quality     The quality of the video compression
     * @param   format      This specifies either PAL or NTSC
     * @param   aspectRatio This can be either 4:3 or 16:9 
     * @param   DVD_GUI     This is the GUI object used to control the form
     */
    public Convert(int quality, String format, String aspectRatio, GUI DVD_GUI)
<span class="fc" id="L57">    {</span>
<span class="fc bfc" id="L58" title="All 2 branches covered.">        if(format.equals(&quot;dvd-ntsc&quot;))</span>
<span class="fc" id="L59">            m_fps = 29.97;</span>
        else
<span class="fc" id="L61">            m_fps = 25;</span>
        
<span class="fc" id="L63">        m_GUI = DVD_GUI;</span>
<span class="fc" id="L64">        m_Quality = quality;</span>
<span class="fc" id="L65">        m_Format = format;</span>
<span class="fc" id="L66">        m_AspectRatio = aspectRatio;</span>
<span class="fc" id="L67">        thread_track = 0;</span>
<span class="fc" id="L68">    }</span>
    
    /**
     * Convert Member Variables 
     */
    private int m_Quality;
    private double m_fps;
    private String m_Format;
    private String m_AspectRatio;
    private String m_flags;
<span class="fc" id="L78">    private String m_bitrate = &quot;8500&quot;;</span>
    protected String[] video_files;
    private GUI m_GUI;
    private Thread m_Thread;
    private boolean m_Error;
    private int thread_track;

<span class="fc" id="L85">    private String m_BaseErr = &quot;Transcoding Error - &quot;;</span>
<span class="fc" id="L86">    private String m_transcode = &quot;transcode -i dv/inp -m test1.ac3 -o test1 -w bitr -x dv,dv&quot; +</span>
                               &quot; -F flags -y mpeg2enc,raw -N 0x2000 -b 256 --encode_fields b&quot; +
                               &quot; -E 48000,16,2 -J resample&quot; +
                               &quot; --export_prof format --export_fps frames/s --export_asr aspectRatio&quot; +
                               &quot; -j 0,8,0,8 --print_status 30&quot;;   
    /* -i                 input video/audio files from the camcorder
       -m                 output .ac3 audio file
       -o                 output .m2v (mpeg2) video file
       -b                 audio bit rate - 256 should be sufficient
       -w                 maximum bit rate (audio + video) ~8500 kbps
       -x                 import module [video,audio]
       -F                 parameters passed to mpeg2enc
       -E                 audio output samplerate [Hz], bits per sample and channels
       -y                 export module [video,audio] - mpeg2enc and ffmpeg are similar in quality,
                                could use either
       --export_prof      either dvd_ntsc or dvd_pal
       --encode_fields    'b' means to encode bottom up - used for interlacing which is critical when
                                watching the video on television
       --export_asr       '2' gives an aspect ratio of 4:3 and '3' would give an aspect ratio of 16:9
       --export_fps       either 29.97 for NTSC or 25 for PAL
       --print_status     print the status of transcode every 30 frames ~1s for NTSC
       -j 0,8,0,8         clip off 8 pixels from the left and right sides of the screen to fit
                                the television screen correctly */
    
<span class="fc" id="L110">    private String mplex = &quot;mplex -f 8 -V -o inp.vob inp.m2v inp.ac3&quot;;</span>
    /* -f                 format - '8' equates to DVD
       -V                 needed to multiplex variable bit-rate video streams correctly
       -o                 output file created from the merged .m2v and .ac3 files */
    
    /**
     * Used to instantiate a new thread and to perform error checking.
     * @return  A boolean to determine if an error occurred in the function
     */
    public boolean init()
    {
<span class="nc bnc" id="L121" title="All 2 branches missed.">        if(m_GUI.menuChkThread.isSelected())</span>
        {
<span class="nc" id="L123">            m_Thread = new Thread(this);</span>
<span class="nc" id="L124">            m_Thread.start();</span>
            try 
            {
<span class="nc" id="L127">                m_Thread.join();</span>
            }
<span class="nc" id="L129">            catch (InterruptedException ex) </span>
            {
<span class="nc" id="L131">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);    </span>
<span class="nc" id="L132">                m_GUI.MessageBox(m_BaseErr + &quot;Could not join Convert.java thread\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L133">                ex.printStackTrace();</span>
<span class="nc" id="L134">                m_Error = true;                    </span>
<span class="nc" id="L135">            } </span>
        }
        else
<span class="nc" id="L138">            Transcode();        </span>
        
        /* 
         * Check transcode.log and mplex.log for any sign of an error.
         * If either file contains an error then return an error.  Also
         * check m_Error to see if it was set while executing the 
         * Transcode method.
         */
<span class="nc bnc" id="L146" title="All 2 branches missed.">	return (m_Error || </span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">                m_GUI.ErrorCheck(m_GUI.strOutputDir + &quot;/log/transcode.log&quot;) ||</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">                m_GUI.ErrorCheck(m_GUI.strOutputDir + &quot;/log/mplex.log&quot;)); </span>
    }
    
    /**
     * Implements the run() method of the Runnable interface.  Makes multi-threading
     * possible.
     */
    public void run()
    {
<span class="nc" id="L157">        Transcode();</span>
<span class="nc" id="L158">    }       </span>

    /**
     * Encodes dv files to mpeg using transcode, then uses mplex to combine
     * the .ac3 audio and .m2v video files into a DVD compatible .vob file
     */
    public void Transcode()
    {
        /* 
         * Get a list of all of the .dv files captured from the camcorder 
         * and stored in the dv directory
         */
<span class="nc" id="L170">	File ListDir = new File(m_GUI.strOutputDir + &quot;/dv/&quot;);</span>
       
        /* High quality, 80 min /DVD - slower encoding, classic MPEG2 */
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if(m_Quality == 0) </span>
<span class="nc" id="L174">	    m_flags=&quot;'8, -c -q 2 -4 1 -2 1 -H -K file=matrix.txt -R 2'&quot;; </span>
        /* High quality, 80 min DVD */    
<span class="nc bnc" id="L176" title="All 2 branches missed.">        else if(m_Quality == 1)</span>
<span class="nc" id="L177">	    m_flags=&quot;'8, -c -q 4 -4 2 -2 2 -K file=matrix.txt -R 1'&quot;; </span>
        /* OK quality, 120 min DVD -  slower encoding, classic MPEG2 */    
        else   
<span class="nc" id="L180">	    m_flags=&quot;'8, -c -q 6 -4 3 -2 3 -N 0.5 -E -10 -K tmpgenc -R 0'&quot;; </span>
	        
        /* Perform some String manipulation */
<span class="nc" id="L183">	m_transcode = m_transcode.replaceAll(&quot;flags&quot;,m_flags);</span>
<span class="nc" id="L184">	m_transcode = m_transcode.replaceAll(&quot;bitr&quot;,m_bitrate);</span>
<span class="nc" id="L185">        m_transcode = m_transcode.replaceAll(&quot;format&quot;,m_Format);</span>
<span class="nc" id="L186">        m_transcode = m_transcode.replaceAll(&quot;aspectRatio&quot;,m_AspectRatio);</span>
<span class="nc" id="L187">        m_transcode = m_transcode.replaceAll(&quot;frames/s&quot;,String.valueOf(m_fps));       </span>
        
        /* 
         * Write out matrix.txt which is a quantization table passed to 
         * mpeg2enc from transcode
         */
<span class="nc" id="L193">	matrix();</span>
        
        /* Enable the GUI widgets for the conversion */
<span class="nc" id="L196">	m_GUI.lblConvert.setEnabled(true);</span>
<span class="nc" id="L197">	m_GUI.prgConvert.setEnabled(true);</span>
<span class="nc" id="L198">	m_GUI.lblConvertProg.setEnabled(true);</span>

        /* 
         * Need to create doubles and ints to track the progess
         * of transcode.  The idea is that if we know the total
         * amount of capture time, and we also know the number of 
         * frames processed by transcode, then we can display a 
         * relatively accurate estimate of the amount of time left
         * to transcode.  Since this is the most time consuming part
         * of dvd-homevideo, I thought it was important.
         */
<span class="nc" id="L209">        double cummulative_time = 0;</span>
<span class="nc" id="L210">        double current_time = 0;</span>
<span class="nc" id="L211">        double[] average_fps = new double[5];</span>
<span class="nc" id="L212">        average_fps[4] = -1;</span>
        int hour, min, sec;
<span class="nc" id="L214">        int total_time = (((Integer)m_GUI.spnMinutes.getValue()).intValue() * 60) + ((Integer)m_GUI.spnSeconds.getValue()).intValue();</span>
        
        StringTokenizer st, time;   
<span class="nc bnc" id="L217" title="All 2 branches missed."> 	while(thread_track &lt; ListDir.list().length)</span>
	{
<span class="nc" id="L219">            video_files = ListDir.list();</span>
            try 
            {
                /* Insert the appropriate parameters into transcode */
<span class="nc bnc" id="L223" title="All 2 branches missed.">                if(thread_track == 0)</span>
                {
<span class="nc" id="L225">                    m_transcode = m_transcode.replaceAll(&quot;inp&quot;,video_files[thread_track]);</span>
<span class="nc" id="L226">                    m_transcode = m_transcode.replaceAll(&quot;test1&quot;,video_files[thread_track].substring(0,11));</span>
<span class="nc" id="L227">                    mplex = mplex.replaceAll(&quot;inp&quot;,video_files[thread_track].substring(0,11));</span>
                }
                else
                {
<span class="nc" id="L231">                    m_transcode = m_transcode.replaceAll(video_files[thread_track-1],video_files[thread_track]);</span>
<span class="nc" id="L232">                    m_transcode = m_transcode.replaceAll(video_files[thread_track-1].substring(0,11), video_files[thread_track].substring(0,11));</span>
<span class="nc" id="L233">                    mplex = mplex.replaceAll(video_files[thread_track-1].substring(0,11),video_files[thread_track].substring(0,11));</span>
                }
            } 
<span class="nc" id="L236">            catch(StringIndexOutOfBoundsException ex)</span>
            {
<span class="nc" id="L238">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);    </span>
<span class="nc" id="L239">                m_GUI.MessageBox(m_BaseErr + &quot;Are there non-standard (not .dv)&quot; +</span>
<span class="nc" id="L240">                                   &quot;\nfiles in the dv directory?\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L241">                ex.printStackTrace();</span>
<span class="nc" id="L242">                m_Error = true;                      </span>
<span class="nc" id="L243">            }</span>
            
            try
            {
                /* 
                 * transcode the .avi files from the camcorder into two separate 
                 * streams, one for audio and the other for video
                 */
<span class="nc" id="L251">                String[] transcode_cmd = {&quot;/bin/sh&quot;,&quot;-c&quot;, m_transcode};</span>
<span class="nc" id="L252">                Process p = Runtime.getRuntime().exec(transcode_cmd, null, new File(m_GUI.strOutputDir));</span>
                                                                       
                /* Create an input reader, an error reader and an output writer */
<span class="nc" id="L255">                BufferedReader in = new BufferedReader(new InputStreamReader(p.getInputStream()));</span>
<span class="nc" id="L256">                BufferedReader err_in = new BufferedReader(new InputStreamReader(p.getErrorStream()));</span>
                
<span class="nc" id="L258">                BufferedWriter out = new BufferedWriter(new FileWriter(m_GUI.strOutputDir + &quot;/log/transcode.log&quot;));</span>
<span class="nc" id="L259">                BufferedWriter err_out = new BufferedWriter(new FileWriter(m_GUI.strOutputDir + &quot;/log/transcode.err&quot;));</span>
                
                /* Write out the actual transcode command to the log file */
<span class="nc" id="L262">                out.write(m_transcode); out.newLine();</span>
                
                String line;
                /* 
                 * Check for the case where the necessary dependencies are not
                 * installed, but the user tries to run dvd-homevideo anyway
                 */
<span class="nc bnc" id="L269" title="All 2 branches missed.">                if(err_in.ready())</span>
                {
<span class="nc" id="L271">                    line = err_in.readLine();</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">                    if(line.equals(&quot;/bin/sh: transcode: command not found&quot;))</span>
                    {
<span class="nc" id="L274">                        m_GUI.MessageBox(&quot;Could not locate transcode in your path.&quot; + </span>
                                           &quot;\nPlease install all necessary dependencies&quot; +
                                           &quot;\nand rerun dvd-homevideo.&quot;, 0);
                        /* Close all open streams */
<span class="nc" id="L278">                        in.close();</span>
<span class="nc" id="L279">                        out.close();</span>
<span class="nc" id="L280">                        err_in.close();</span>
<span class="nc" id="L281">                        err_out.close();</span>

                        /* Indicate that there was an error */
<span class="nc" id="L284">                        m_Error = true;</span>
                    }
                    else
                    {
<span class="nc" id="L288">                        m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L289">                        out.write(line);  out.newLine();</span>
                    }
                }         
                
<span class="nc" id="L293">                int k = 0;                                      </span>
<span class="nc bnc" id="L294" title="All 2 branches missed.">                while((line = in.readLine()) != null)</span>
                {
<span class="nc" id="L296">                    st = new StringTokenizer(line);</span>
<span class="nc bnc" id="L297" title="All 2 branches missed.">                    if(st.hasMoreTokens())</span>
                    {
<span class="nc bnc" id="L299" title="All 2 branches missed.">                        if(st.nextToken().equals(&quot;encoding&quot;))</span>
                        {
<span class="nc" id="L301">                            st.nextToken(); st.nextToken(); </span>
<span class="nc" id="L302">                            average_fps[k%5] = Double.valueOf(st.nextToken()).doubleValue(); </span>
<span class="nc" id="L303">                            st.nextToken(); st.nextToken();</span>
                                  
<span class="nc" id="L305">                            time = new StringTokenizer(st.nextToken(), &quot;:,&quot;);</span>
<span class="nc bnc" id="L306" title="All 2 branches missed.">                            if(time.hasMoreTokens())</span>
                            {
                                /* Calculate the estimated time left for transcode */
<span class="nc" id="L309">                                hour = Integer.valueOf(time.nextToken()).intValue();</span>
<span class="nc" id="L310">                                min = Integer.valueOf(time.nextToken()).intValue();</span>
<span class="nc" id="L311">                                sec = Integer.valueOf(time.nextToken()).intValue();</span>
<span class="nc" id="L312">                                current_time = (hour * 3600) + (min * 60) + sec + cummulative_time;</span>
<span class="nc" id="L313">                                m_GUI.prgConvert.setValue((int)((current_time / total_time) * 100));</span>
<span class="nc" id="L314">                                m_GUI.lblConvertProg.setText(String.valueOf((int)((current_time / total_time) * 100)) + &quot;%&quot;);</span>
                                      
                                /*
                                 * Display to the user an approximation of the conversion time
                                 * left on the prgConvert progress bar using the tool tip (on mouse hover)
                                 */
<span class="nc" id="L320">                                double fps_sum = 0;</span>
                                int time_remaining;
                                /* If the array has been filled... */
<span class="nc bnc" id="L323" title="All 2 branches missed.">                                if(average_fps[4] != -1)</span>
                                {
<span class="nc bnc" id="L325" title="All 2 branches missed.">                                    for(int j = 0; j &lt; 5; j++)</span>
                                    {
<span class="nc" id="L327">                                        fps_sum += average_fps[j];</span>
                                    }
                                    
                                    /* Average the fps readings from transcode */
<span class="nc" id="L331">                                    fps_sum /= 5;</span>
                                    
                                    /* Added (int)m_fps to account for PAL (25 fps) and NTSC (29.97 fps) */
<span class="nc" id="L334">                                    time_remaining = (int)(((total_time - current_time) * (int)m_fps) / fps_sum);</span>

<span class="nc" id="L336">                                    int captureTipHour = (time_remaining / 3600);</span>
<span class="nc" id="L337">                                    int captureTipMinute = (time_remaining - 3600 * captureTipHour) / 60;</span>

<span class="nc bnc" id="L339" title="All 4 branches missed.">                                    if((captureTipHour == 0) &amp;&amp; (captureTipMinute &lt; 5))</span>
<span class="nc" id="L340">                                        m_GUI.prgConvert.setToolTipText(&quot;Less than 5 minutes remaining&quot;);</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">                                    else if(captureTipMinute &lt; 10)</span>
<span class="nc" id="L342">                                        m_GUI.prgConvert.setToolTipText(captureTipHour + &quot;:0&quot; + </span>
                                                                          captureTipMinute + &quot; Remaining&quot;);
                                    else
<span class="nc" id="L345">                                        m_GUI.prgConvert.setToolTipText(captureTipHour + &quot;:&quot; + captureTipMinute +</span>
                                                                          &quot; Remaining&quot;);
                                }
                                     
<span class="nc" id="L349">                                m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L350">                                m_GUI.txtAreaOutput.setCaretPosition(m_GUI.txtAreaOutput.getDocument().getLength());</span>
<span class="nc" id="L351">                                out.write(line); out.newLine();    </span>
<span class="nc" id="L352">                            }</span>
                            else
                            {
<span class="nc" id="L355">                                m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L356">                                m_GUI.txtAreaOutput.setCaretPosition(m_GUI.txtAreaOutput.getDocument().getLength());</span>
<span class="nc" id="L357">                                out.write(line); out.newLine();    </span>
                            }
<span class="nc" id="L359">                         k++;    </span>
                        }
                    }  
                }
                      
<span class="nc bnc" id="L364" title="All 2 branches missed.">                while((line = err_in.readLine()) != null)</span>
                {
<span class="nc" id="L366">                    m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L367">                    m_GUI.txtAreaOutput.setCaretPosition(m_GUI.txtAreaOutput.getDocument().getLength());                            </span>
<span class="nc" id="L368">                    out.write(line); out.newLine();                                                          </span>
                }
                                                
                /* Close all open streams */
<span class="nc" id="L372">                in.close();</span>
<span class="nc" id="L373">                out.close();</span>
<span class="nc" id="L374">                err_in.close();</span>
<span class="nc" id="L375">                err_out.close();</span>
                
                /*
                 * p.waitFor() throws an InterruptedException
                 */
                
                /* This now runs as a thread...need to fix this */
                //p.waitFor();
                
                
                /* Timekeeping */
<span class="nc" id="L386">                cummulative_time = current_time;</span>
                                
/*******************************************************
 * This is the separation between transcode and mplex. *
 * Need to break this out into a separate class.       * 
 *******************************************************/                

                /* 
                 * Combine the separate streams together into a .vob (DVD) file 
                 */                        
<span class="nc" id="L396">                String[] mplex_cmd = {&quot;/bin/sh&quot;, &quot;-c&quot;, mplex};</span>
<span class="nc" id="L397">                p = Runtime.getRuntime().exec(mplex_cmd, null, new File(m_GUI.strOutputDir));</span>

                /* Create an input reader, an error reader and an output writer */
<span class="nc" id="L400">                in = new BufferedReader(new InputStreamReader(p.getInputStream()));</span>
<span class="nc" id="L401">                err_in = new BufferedReader(new InputStreamReader(p.getErrorStream()));</span>
                
<span class="nc" id="L403">                out = new BufferedWriter(new FileWriter(m_GUI.strOutputDir + &quot;/log/mplex.log&quot;));</span>
<span class="nc" id="L404">                err_out = new BufferedWriter(new FileWriter(m_GUI.strOutputDir + &quot;/log/mplex.err&quot;));</span>
                         
                /* 
                 * Check for the case where the necessary dependencies are not
                 * installed, but the user tries to run dvd-homevideo anyway
                 */
<span class="nc bnc" id="L410" title="All 2 branches missed.">                if(err_in.ready())</span>
                {
<span class="nc" id="L412">                    line = err_in.readLine();</span>
<span class="nc bnc" id="L413" title="All 2 branches missed.">                    if(line.equals(&quot;/bin/sh: mplex: command not found&quot;))</span>
                    {
<span class="nc" id="L415">                        m_GUI.MessageBox(&quot;Could not locate mplex in your path.&quot; + </span>
                                           &quot;\nPlease install all necessary dependencies&quot; +
                                           &quot;\nand rerun dvd-homevideo.&quot;, 0);
                        /* Close all open streams */
<span class="nc" id="L419">                        in.close();</span>
<span class="nc" id="L420">                        out.close();</span>
<span class="nc" id="L421">                        err_in.close();</span>
<span class="nc" id="L422">                        err_out.close();</span>

                        /* Indicate that there was an error */
<span class="nc" id="L425">                        m_Error = true;</span>
                    }
                    else
                    {
<span class="nc" id="L429">                        m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L430">                        out.write(line);  out.newLine();</span>
                    }
                }         
                
<span class="nc bnc" id="L434" title="All 2 branches missed.">                while((line = err_in.readLine()) != null)</span>
                {                    
<span class="nc" id="L436">                    m_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L437">                    m_GUI.txtAreaOutput.setCaretPosition(m_GUI.txtAreaOutput.getDocument().getLength());</span>
<span class="nc" id="L438">                    out.write(line); out.newLine();    </span>
                }
                /* Close all open streams */
<span class="nc" id="L441">                in.close();</span>
<span class="nc" id="L442">                out.close();</span>
<span class="nc" id="L443">                err_in.close();</span>
<span class="nc" id="L444">                err_out.close();</span>
                
                /*
                 * p.waitFor() throws an InterruptedException
                 */
                
                /* This now runs as a thread...need to fix this */
                //p.waitFor();
                
                /* Put in a slight delay to ensure transcode.log and mplex.log closes */
<span class="nc" id="L454">                Thread.sleep(2000);        </span>
            }            
<span class="nc" id="L456">            catch(IOException ex)</span>
            {
<span class="nc" id="L458">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);    </span>
<span class="nc" id="L459">                m_GUI.MessageBox(m_BaseErr + &quot;IO Error\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L460">                ex.printStackTrace();</span>
<span class="nc" id="L461">                m_Error = true;                      </span>
            }
//            catch(InterruptedException ex)
//            {
//                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);
//                m_GUI.MessageBox(m_BaseErr + &quot;dvd-homevideo thread was interrupted\n&quot; + ex.toString(), 0);
//                ex.printStackTrace();
//                m_Error = true;
//            }
<span class="nc" id="L470">            catch(NullPointerException ex)</span>
            {
<span class="nc" id="L472">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);</span>
<span class="nc" id="L473">                m_GUI.MessageBox(m_BaseErr + &quot;Error executing Runtime.getRuntime().exec()\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L474">                ex.printStackTrace();</span>
<span class="nc" id="L475">                m_Error = true;</span>
            }
<span class="nc" id="L477">            catch(IllegalArgumentException ex)</span>
            {
<span class="nc" id="L479">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);</span>
<span class="nc" id="L480">                m_GUI.MessageBox(m_BaseErr + &quot;Illegal argument sent to Runtime.getRuntime().exec()\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L481">                ex.printStackTrace();</span>
<span class="nc" id="L482">                m_Error = true;</span>
            }
<span class="nc" id="L484">            catch(Exception ex)</span>
            {
<span class="nc" id="L486">                SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);</span>
<span class="nc" id="L487">                m_GUI.MessageBox(m_BaseErr + &quot;Unknown Error occurred\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L488">                ex.printStackTrace();</span>
<span class="nc" id="L489">                m_Error = true;            </span>
<span class="nc" id="L490">            }</span>
<span class="nc" id="L491">            thread_track++;</span>
	}
        /* Disable GUI widgets for the conversion */
<span class="nc" id="L494">        m_GUI.prgConvert.setValue(100);</span>
<span class="nc" id="L495">        m_GUI.lblConvertProg.setText(&quot;100%&quot;);</span>
                                      
<span class="nc" id="L497">	m_GUI.prgConvert.setEnabled(false);</span>
<span class="nc" id="L498">	m_GUI.lblConvert.setEnabled(false);</span>
<span class="nc" id="L499">	m_GUI.lblConvertProg.setEnabled(false);       </span>
<span class="nc" id="L500">    }</span>
    
    /**
     * Outputs a text file to be used by mpeg2enc for encoding
     * @param   m_GUI This is the GUI object used to control the form
     */
    public void matrix()
    {       
        try 
        {
<span class="nc" id="L510">            FileWriter fw = new FileWriter(m_GUI.strOutputDir + &quot;/&quot; + &quot;matrix.txt&quot;);</span>
<span class="nc" id="L511">            BufferedWriter wr = new BufferedWriter(fw);</span>
<span class="nc" id="L512">            wr.write(&quot;# High resolution INTRA table\n&quot;);</span>
<span class="nc" id="L513">            wr.write(&quot;8,16,18,20,24,25,26,30\n&quot;);</span>
<span class="nc" id="L514">            wr.write(&quot;16,16,20,23,25,26,30,30\n&quot;);</span>
<span class="nc" id="L515">            wr.write(&quot;18,20,22,24,26,28,29,31\n&quot;);</span>
<span class="nc" id="L516">            wr.write(&quot;20,21,23,24,26,28,31,31\n&quot;);</span>
<span class="nc" id="L517">            wr.write(&quot;21,23,24,25,28,30,30,33\n&quot;);</span>
<span class="nc" id="L518">            wr.write(&quot;23,24,25,28,30,30,33,36\n&quot;);</span>
<span class="nc" id="L519">            wr.write(&quot;24,25,26,29,29,31,34,38\n&quot;);</span>
<span class="nc" id="L520">            wr.write(&quot;25,26,28,29,31,34,38,42\n&quot;);</span>
<span class="nc" id="L521">            wr.write(&quot;# TMPEGEnc NON-INTRA table\n&quot;);</span>
<span class="nc" id="L522">            wr.write(&quot;16,17,18,19,20,21,22,23\n&quot;);</span>
<span class="nc" id="L523">            wr.write(&quot;17,18,19,20,21,22,23,24\n&quot;);</span>
<span class="nc" id="L524">            wr.write(&quot;18,19,20,21,22,23,24,25\n&quot;);</span>
<span class="nc" id="L525">            wr.write(&quot;19,20,21,22,23,24,26,27\n&quot;);</span>
<span class="nc" id="L526">            wr.write(&quot;20,21,22,23,25,26,27,28\n&quot;);</span>
<span class="nc" id="L527">            wr.write(&quot;21,22,23,24,26,27,28,30\n&quot;);</span>
<span class="nc" id="L528">            wr.write(&quot;22,23,24,26,27,28,30,31\n&quot;);</span>
<span class="nc" id="L529">            wr.write(&quot;23,24,25,27,28,30,31,33\n&quot;);</span>

<span class="nc" id="L531">            wr.close();</span>
<span class="nc" id="L532">            fw.close();</span>
        } 
<span class="nc" id="L534">        catch(IOException ex)</span>
        {
<span class="nc" id="L536">            SaveStackTrace.printTrace(m_GUI.strOutputDir, ex);    </span>
<span class="nc" id="L537">            m_GUI.MessageBox(m_BaseErr + &quot;IO Error\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L538">            ex.printStackTrace();</span>
<span class="nc" id="L539">            System.exit(1);                      </span>
<span class="nc" id="L540">        }</span>
<span class="nc" id="L541">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>