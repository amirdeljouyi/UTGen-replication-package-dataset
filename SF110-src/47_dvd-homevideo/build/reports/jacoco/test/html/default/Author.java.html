<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Author.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">47_dvd-homevideo</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Author.java</span></div><h1>Author.java</h1><pre class="source lang-java linenums">import java.io.File;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.InputStreamReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintStream;

import java.util.NoSuchElementException;
import java.util.StringTokenizer;

import java.lang.NullPointerException;
import java.lang.IllegalArgumentException;

/**
 *
 * @author Shane Santner
 * This class create the DVD filesystem that will be burned
 * to disc.
 *
 * TODO - Need to handle input, output and error streams
 *        more appropriatly.
 */
public class Author 
{
    /** Creates a new instance of Author */
    public Author() 
<span class="nc" id="L28">    {}</span>
        
    /* Author Member Variables */
<span class="nc" id="L31">    private String m_dvdauthor = &quot;dvdauthor -x vmgm.xml&quot;;</span>
<span class="nc" id="L32">    private String m_BaseErr = &quot;Authoring Error - &quot;;</span>

    /**
     * Create a DVD filestructure necessary to play in dvd player using dvdauthor
     * @param   DVD_GUI This is the GUI object used to control the form
     * @return  A boolean to determine if an error occurred in the function  
     */
    public boolean CreateDVDFileStructure(GUI DVD_GUI)
    {
        try
        {
            /* 
             * Set progress bar to 50% since we have completed dvd-menu.
             * In the future would like a better way to track progress, this
             * is not very precise.
             */
<span class="nc" id="L48">            DVD_GUI.prgAuthor.setValue(50);</span>
<span class="nc" id="L49">            DVD_GUI.lblAuthorProg.setText(&quot;50%&quot;);</span>
                
            /* Build up the dvdauthor_cmd string and execute dvd-author */
<span class="nc" id="L52">            String[] dvdauthor_cmd = {&quot;/bin/sh&quot;, &quot;-c&quot;, m_dvdauthor};</span>
           
            /*
             * exec(...) throws IOException, NullPointerException and
             *                  IllegalArgumentException.
             */
<span class="nc" id="L58">            Process p = Runtime.getRuntime().exec(dvdauthor_cmd, null, new File(DVD_GUI.strOutputDir));</span>
                    
            try
            {
                /* Instantiate input and output readers for dvd-author streams */
<span class="nc" id="L63">                BufferedReader in = new BufferedReader(new InputStreamReader(p.getInputStream()));</span>
<span class="nc" id="L64">                BufferedReader err_in = new BufferedReader(new InputStreamReader(p.getErrorStream()));</span>
                
<span class="nc" id="L66">                BufferedWriter out = new BufferedWriter(new FileWriter(DVD_GUI.strOutputDir + &quot;/log/dvdauthor.log&quot;));</span>
<span class="nc" id="L67">                BufferedWriter err_out = new BufferedWriter(new FileWriter(DVD_GUI.strOutputDir + &quot;/log/dvdauthor.err&quot;));</span>

                String line;
                /* 
                 * Check for the case where the necessary dependencies are not
                 * installed, but the user tries to run dvd-homevideo anyway
                 */
<span class="nc bnc" id="L74" title="All 2 branches missed.">                if(err_in.ready())</span>
                {
<span class="nc" id="L76">                    line = err_in.readLine();</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">                    if(line.equals(&quot;/bin/sh: dvdauthor: command not found&quot;))</span>
                    {
<span class="nc" id="L79">                        DVD_GUI.MessageBox(&quot;Could not locate dvdauthor in your path.&quot; + </span>
                                           &quot;\nPlease install all necessary dependencies&quot; +
                                           &quot;\nand rerun dvd-homevideo.&quot;, 0);
                        /* Close all open streams */
<span class="nc" id="L83">                        in.close();</span>
<span class="nc" id="L84">                        out.close();</span>
<span class="nc" id="L85">                        err_in.close();</span>
<span class="nc" id="L86">                        err_out.close();</span>

                        /* Indicate that there was an error */
<span class="nc" id="L89">                        return true;</span>
                    }
                }        
                               
                /*
                 * Lets look for indications of problems and display these to the user
                 * through the txtAreaOutput interface.
                 */
                StringTokenizer st;  
                                
                /*
                 * err_in.readLine() throws an IOException
                 */
<span class="nc bnc" id="L102" title="All 2 branches missed.">                while((line = err_in.readLine()) != null)</span>
                {  
<span class="nc" id="L104">                    st = new StringTokenizer(line,&quot;:&quot;);  </span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">                    if(st.hasMoreTokens())               </span>
                    {
                        /*
                         * st.nextToken() throws NoSuchElementException
                         */
<span class="nc bnc" id="L110" title="All 2 branches missed.">                        if(!st.nextToken().equals(&quot;WARN&quot;))</span>
                        {
<span class="nc" id="L112">                            DVD_GUI.txtAreaOutput.append(line + &quot;\n&quot;);</span>
<span class="nc" id="L113">                            DVD_GUI.txtAreaOutput.setCaretPosition(DVD_GUI.txtAreaOutput.getDocument().getLength());</span>
<span class="nc" id="L114">                            out.write(line);  out.newLine();</span>
                        }
                    }
                }
                /*
                 * close() throws an IOException
                 */
<span class="nc" id="L121">                in.close();</span>
<span class="nc" id="L122">                out.close();</span>
<span class="nc" id="L123">                err_in.close();</span>
<span class="nc" id="L124">                err_out.close();</span>
                
                /*
                 * p.waitFor() throws an InterruptedException
                 */
<span class="nc" id="L129">                p.waitFor();</span>
            } 
<span class="nc" id="L131">            catch(IOException ex)</span>
            {
<span class="nc" id="L133">                SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L134">                DVD_GUI.MessageBox(m_BaseErr + &quot;IO Error\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L135">                ex.printStackTrace();</span>
<span class="nc" id="L136">                return true;</span>
            } 
<span class="nc" id="L138">            catch(NoSuchElementException ex)</span>
            {
<span class="nc" id="L140">                SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L141">                DVD_GUI.MessageBox(m_BaseErr + &quot;Looked for a token that didn't exist\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L142">                ex.printStackTrace();</span>
<span class="nc" id="L143">                return true;</span>
            }
<span class="nc" id="L145">            catch(InterruptedException ex)</span>
            {
<span class="nc" id="L147">                SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L148">                DVD_GUI.MessageBox(m_BaseErr + &quot;dvd-homevideo thread was interrupted\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L149">                ex.printStackTrace();</span>
<span class="nc" id="L150">                return true;</span>
<span class="nc" id="L151">            }</span>
                          
            /* Set progress bar to 100% and disable it */
<span class="nc" id="L154">            DVD_GUI.prgAuthor.setIndeterminate(false);</span>
<span class="nc" id="L155">            DVD_GUI.prgAuthor.setValue(100);</span>
<span class="nc" id="L156">            DVD_GUI.lblAuthorProg.setText(&quot;100%&quot;);</span>
<span class="nc" id="L157">            DVD_GUI.lblAuthor.setEnabled(false);</span>
<span class="nc" id="L158">            DVD_GUI.lblAuthorProg.setEnabled(false);</span>
<span class="nc" id="L159">            DVD_GUI.prgAuthor.setEnabled(false);</span>
            
            /* Put in a slight delay to ensure author.log closes */
<span class="nc" id="L162">            Thread.sleep(2000);        </span>
	}
<span class="nc" id="L164">        catch(IOException ex)</span>
        {
<span class="nc" id="L166">            SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L167">            DVD_GUI.MessageBox(m_BaseErr + &quot;IO Error\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L168">            ex.printStackTrace();</span>
<span class="nc" id="L169">            return true;</span>
        }
<span class="nc" id="L171">        catch(NullPointerException ex)</span>
        {
<span class="nc" id="L173">            SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L174">            DVD_GUI.MessageBox(m_BaseErr + &quot;Error executing Runtime.getRuntime().exec()\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L175">            ex.printStackTrace();</span>
<span class="nc" id="L176">            return true;</span>
        }
<span class="nc" id="L178">        catch(IllegalArgumentException ex)</span>
        {
<span class="nc" id="L180">            SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L181">            DVD_GUI.MessageBox(m_BaseErr + &quot;Illegal argument sent to Runtime.getRuntime().exec()\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L182">            ex.printStackTrace();</span>
<span class="nc" id="L183">            return true;</span>
        }
<span class="nc" id="L185">	catch(Exception ex)</span>
	{
<span class="nc" id="L187">            SaveStackTrace.printTrace(DVD_GUI.strOutputDir, ex);</span>
<span class="nc" id="L188">            DVD_GUI.MessageBox(m_BaseErr + &quot;Unknown Error occurred\n&quot; + ex.toString(), 0);</span>
<span class="nc" id="L189">            ex.printStackTrace();</span>
<span class="nc" id="L190">            return true;            </span>
<span class="nc" id="L191">	}</span>
        
        /* Look for any indication of an error in the author log file */
<span class="nc" id="L194">	return DVD_GUI.ErrorCheck(DVD_GUI.strOutputDir + &quot;/log/dvdauthor.log&quot;); </span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>