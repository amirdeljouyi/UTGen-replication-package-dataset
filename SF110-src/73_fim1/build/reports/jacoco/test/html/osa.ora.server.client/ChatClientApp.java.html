<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChatClientApp.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">73_fim1</a> &gt; <a href="index.source.html" class="el_package">osa.ora.server.client</a> &gt; <span class="el_source">ChatClientApp.java</span></div><h1>ChatClientApp.java</h1><pre class="source lang-java linenums">/*
 * ChatClientApp.java
 *
 * Created on October 27, 2009, 1:45 PM
 *
 * To change this template, choose Tools | Template Manager
 * and open the template in the editor.
 */
package osa.ora.server.client;

import com.birosoft.liquid.LiquidLookAndFeel;
import java.applet.Applet;
import java.applet.AudioClip;
import java.awt.Dimension;
import java.awt.Image;
import java.awt.Toolkit;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.io.File;
import java.io.Serializable;
import java.net.InetAddress;
import java.net.MalformedURLException;
import java.net.URISyntaxException;
import java.rmi.RemoteException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.rmi.server.UnicastRemoteObject;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.Vector;
import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.SwingUtilities;
import javax.swing.UIManager;
import osa.ora.server.beans.BinaryMessage;
import osa.ora.server.beans.Group;
import osa.ora.server.beans.IConstant;
import osa.ora.server.beans.ResultBean;
import osa.ora.server.beans.Room;
import osa.ora.server.beans.Status;
import osa.ora.server.beans.TextMessage;
import osa.ora.server.beans.User;
import javax.swing.JDialog;
import javax.swing.JFileChooser;
import osa.ora.server.ServerClientInterface;
import osa.ora.server.beans.ClientSettingBean;
import osa.ora.server.beans.LoginBean;
import osa.ora.server.client.threads.PingServerThread;
import osa.ora.server.client.threads.ReceiveAnnouncementThread;
import osa.ora.server.client.threads.ReceiveFileThread;
import osa.ora.server.client.threads.SendAnnouncementThread;
import osa.ora.server.client.threads.SendMyStatusThread;
import osa.ora.server.client.ui.ChangePassPanel;
import osa.ora.server.client.ui.ChatFrame;
import osa.ora.server.client.ui.ChatSysTray;
import osa.ora.server.client.ui.ChatWindowPanel;
import osa.ora.server.client.ui.ContactsPanel;
import osa.ora.server.client.ui.EmotionPanel;
import osa.ora.server.client.ui.FontPanel;
import osa.ora.server.client.ui.LoginPanel;
import osa.ora.server.client.ui.SettingPanel;
import osa.ora.server.utils.FileEncrypter;
import osa.ora.server.utils.StringEncoder64;
import osa.ora.server.utils.StringEncrypter;

/**
 *
 * @author ooransa
 */
public class ChatClientApp extends UnicastRemoteObject implements ClientInterface, Serializable, Runnable, WindowListener {

    private ServerClientInterface serverInterface;
    private Vector&lt;Group&gt; groups;
    private Vector&lt;Room&gt; rooms;
    private Hashtable&lt;Integer, Status&gt; statusLookup;
    private Hashtable&lt;Integer, ChatWindowPanel&gt; openChatPanels;
    private Hashtable&lt;Integer, ChatWindowPanel&gt; openChatPanelsByIndex;
    private static Hashtable&lt;String, String&gt; emotionImages;
<span class="nc" id="L80">    private String lookString = &quot;com.birosoft.liquid.LiquidLookAndFeel&quot;;</span>
    private User user;
    private ChatSysTray chatSysTray;
    private LoginPanel loginPanel;
    private ContactsPanel contactsPanel;
    private ChatFrame chatClientFrame;
    private EmotionPanel emotionPanel;
    private FontPanel fontPanel;
    private JDialog emotionFrame;
    private JDialog fontFrame;
    private JDialog settingsFrame;
    private JDialog changePassFrame;
    private SettingPanel settingPanel;
    private ChangePassPanel changePassPanel;
<span class="nc" id="L94">    private static String path = &quot;&quot;;</span>
<span class="nc" id="L95">    private ImageIcon group_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/groups.png&quot;)).getScaledInstance(20, 20, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L96">    private ImageIcon room_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/room.png&quot;)).getScaledInstance(25, 25, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L97">    private ImageIcon online_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/online.png&quot;)).getScaledInstance(20, 20, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L98">    private ImageIcon offline_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/offline.png&quot;)).getScaledInstance(20, 20, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L99">    private ImageIcon busy_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/busy.png&quot;)).getScaledInstance(20, 20, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L100">    private ImageIcon away_icon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/away.png&quot;)).getScaledInstance(20, 20, Image.SCALE_SMOOTH));</span>
<span class="nc" id="L101">    private ImageIcon[] userStatusIcons = new ImageIcon[5];</span>
<span class="nc" id="L102">    private ImageIcon errorIcon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/error.png&quot;)));</span>
    //private ImageIcon chatIcon = new ImageIcon(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/chat.jpg&quot;)));
    private Thread th;
<span class="nc" id="L105">    private int number = 0;</span>
<span class="nc" id="L106">    private String title = &quot;&quot;;</span>
    private JFileChooser jfm;
    private AudioClip ac;
    private ClientSettingBean clientSettingBean;
    private InetAddress ownIP;
    private PingServerThread pingServerThread;
    private int securityMode;
    private String rootNode;
    private String securityToke;
    private StringEncrypter stringEnc;
    /** Creates a new instance of ChatClientApp */
<span class="nc" id="L117">    public ChatClientApp() throws RemoteException {</span>
<span class="nc" id="L118">        userStatusIcons[0] = offline_icon;</span>
<span class="nc" id="L119">        userStatusIcons[1] = offline_icon;</span>
<span class="nc" id="L120">        userStatusIcons[2] = online_icon;</span>
<span class="nc" id="L121">        userStatusIcons[3] = busy_icon;</span>
<span class="nc" id="L122">        userStatusIcons[4] = away_icon;</span>
<span class="nc" id="L123">        openChatPanels = new Hashtable&lt;Integer, ChatWindowPanel&gt;();</span>
<span class="nc" id="L124">        openChatPanelsByIndex = new Hashtable&lt;Integer, ChatWindowPanel&gt;();</span>
        try {
<span class="nc" id="L126">            path = ChatClientApp.class.getProtectionDomain().getCodeSource().getLocation().toURI().getPath();</span>
<span class="nc" id="L127">        } catch (URISyntaxException ex) {</span>
<span class="nc" id="L128">            ex.printStackTrace();</span>
<span class="nc" id="L129">        }</span>
<span class="nc" id="L130">        path = getPath().substring(0, getPath().lastIndexOf('/') + 1);</span>
        try{
<span class="nc" id="L132">          ownIP=InetAddress.getLocalHost();</span>
<span class="nc" id="L133">        }catch (Exception e){</span>
<span class="nc" id="L134">        }</span>
<span class="nc" id="L135">        clientSettingBean = new ClientSettingBean(path);</span>
<span class="nc" id="L136">        System.out.println(&quot;ServerIP=&quot; + clientSettingBean.getServerURL());</span>
<span class="nc" id="L137">        System.out.println(&quot;ServerPort=&quot; + clientSettingBean.getServerPort());</span>
<span class="nc" id="L138">        initSound();</span>
<span class="nc" id="L139">        jfm = new JFileChooser();</span>
<span class="nc" id="L140">        jfm.setMultiSelectionEnabled(false);</span>
<span class="nc" id="L141">        jfm.setFileSelectionMode(JFileChooser.FILES_ONLY);</span>
<span class="nc" id="L142">        jfm.setDialogTitle(&quot;Select File To Send&quot;);</span>
        try {
<span class="nc bnc" id="L144" title="All 2 branches missed.">            if (lookString instanceof String) {</span>
<span class="nc" id="L145">                LiquidLookAndFeel.setLiquidDecorations(true);</span>
<span class="nc" id="L146">                UIManager.setLookAndFeel((String) lookString);</span>
<span class="nc" id="L147">                SwingUtilities.updateComponentTreeUI(jfm);</span>
            }
<span class="nc" id="L149">        } catch (Exception e1) {</span>
<span class="nc" id="L150">            e1.printStackTrace();</span>
<span class="nc" id="L151">            JOptionPane.showMessageDialog(null, &quot;Error in applying look and feel!!&quot;);</span>
<span class="nc" id="L152">        }</span>
<span class="nc" id="L153">        loginPanel = new LoginPanel(this);</span>
<span class="nc" id="L154">        chatClientFrame = new ChatFrame(this);</span>
<span class="nc" id="L155">        chatClientFrame.getContactPanel().add(loginPanel, java.awt.BorderLayout.CENTER);</span>
<span class="nc" id="L156">        chatClientFrame.setTitle(&quot;Free Instant Messenger&quot;);</span>
<span class="nc" id="L157">        chatClientFrame.setIconImage(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/groups.png&quot;)));</span>
<span class="nc" id="L158">        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();</span>
<span class="nc" id="L159">        chatClientFrame.setSize(300, 500);</span>
<span class="nc" id="L160">        Dimension frameSize = chatClientFrame.getSize();</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">        if (frameSize.height &gt; screenSize.height) {</span>
<span class="nc" id="L162">            frameSize.height = screenSize.height;</span>
        }
<span class="nc bnc" id="L164" title="All 2 branches missed.">        if (frameSize.width &gt; screenSize.width) {</span>
<span class="nc" id="L165">            frameSize.width = screenSize.width;</span>
        }
<span class="nc" id="L167">        chatClientFrame.setLocation((screenSize.width - frameSize.width) / 2, (screenSize.height - frameSize.height) / 2);</span>
<span class="nc" id="L168">        chatClientFrame.repaint();</span>
<span class="nc" id="L169">        chatClientFrame.addWindowListener(this);</span>
<span class="nc" id="L170">        chatClientFrame.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L171">        chatClientFrame.setVisible(true);</span>
<span class="nc" id="L172">        emotionImages = new Hashtable&lt;String, String&gt;();</span>
<span class="nc" id="L173">        emotionImages.put(&quot;:)&quot;, &quot;smile.png&quot;);</span>
<span class="nc" id="L174">        emotionImages.put(&quot;:D&quot;, &quot;bigSmile.png&quot;);</span>
<span class="nc" id="L175">        emotionImages.put(&quot;;)&quot;, &quot;wink.png&quot;);</span>
<span class="nc" id="L176">        emotionImages.put(&quot;:|&quot;, &quot;shocked.png&quot;);</span>
<span class="nc" id="L177">        emotionImages.put(&quot;:(&quot;, &quot;sad.png&quot;);</span>
<span class="nc" id="L178">        emotionImages.put(&quot;:S&quot;, &quot;confused.png&quot;);</span>
<span class="nc" id="L179">        emotionImages.put(&quot;:P&quot;, &quot;evilSmile.png&quot;);</span>
<span class="nc" id="L180">        emotionImages.put(&quot;:E&quot;, &quot;lol.png&quot;);</span>
<span class="nc" id="L181">        emotionImages.put(&quot;:@&quot;, &quot;angery.png&quot;);</span>
<span class="nc" id="L182">        chatSysTray = new ChatSysTray(this);</span>
<span class="nc" id="L183">        emotionFrame = new JDialog(chatClientFrame, false);</span>
<span class="nc" id="L184">        emotionFrame.addMouseListener(new java.awt.event.MouseAdapter() {</span>
            public void mouseExited(java.awt.event.MouseEvent evt) {
<span class="nc" id="L186">                emotionFrame.setVisible(false);</span>
<span class="nc" id="L187">            }</span>
        });
<span class="nc" id="L189">        emotionFrame.setSize(100, 120);</span>
<span class="nc" id="L190">        emotionFrame.setAlwaysOnTop(true);</span>
<span class="nc" id="L191">        emotionFrame.setResizable(false);</span>
<span class="nc" id="L192">        emotionFrame.setUndecorated(true);</span>
<span class="nc" id="L193">        emotionPanel = new EmotionPanel(emotionFrame);</span>
<span class="nc" id="L194">        emotionFrame.getContentPane().add(emotionPanel);</span>
<span class="nc" id="L195">        fontFrame = new JDialog(chatClientFrame, &quot;Change Font And Color&quot;, true);</span>
<span class="nc" id="L196">        fontPanel = new FontPanel(fontFrame, this);</span>
<span class="nc" id="L197">        fontFrame.setSize(270, 200);</span>
<span class="nc" id="L198">        fontFrame.setAlwaysOnTop(true);</span>
<span class="nc" id="L199">        fontFrame.setResizable(false);</span>
<span class="nc" id="L200">        fontFrame.setLocationRelativeTo(chatClientFrame);</span>
<span class="nc" id="L201">        fontFrame.getContentPane().add(fontPanel);</span>
<span class="nc" id="L202">        settingsFrame = new JDialog(chatClientFrame, &quot;Change Settings&quot;, true);</span>
<span class="nc" id="L203">        settingPanel = new SettingPanel(settingsFrame, this);</span>
<span class="nc" id="L204">        settingsFrame.setSize(200, 450);</span>
<span class="nc" id="L205">        settingsFrame.setAlwaysOnTop(true);</span>
<span class="nc" id="L206">        settingsFrame.setResizable(false);</span>
<span class="nc" id="L207">        settingsFrame.getContentPane().add(settingPanel);</span>
<span class="nc" id="L208">        changePassFrame = new JDialog(chatClientFrame, &quot;Change Password&quot;, true);</span>
<span class="nc" id="L209">        changePassPanel = new ChangePassPanel(changePassFrame, this);</span>
<span class="nc" id="L210">        changePassFrame.setSize(190, 200);</span>
<span class="nc" id="L211">        changePassFrame.setAlwaysOnTop(true);</span>
<span class="nc" id="L212">        changePassFrame.setResizable(false);</span>
<span class="nc" id="L213">        changePassFrame.getContentPane().add(changePassPanel);</span>
<span class="nc" id="L214">        loadStatusLookup();</span>
<span class="nc" id="L215">        String[] statusList = new String[getStatusLookup().size()-1];</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">        for (int i = 1; i &lt; getStatusLookup().size(); i++) {</span>
<span class="nc" id="L217">            statusList[i-1] = getStatusLookup().get(i).getDesc();</span>
        }
<span class="nc" id="L219">        settingPanel.updateStatusList(statusList, Integer.parseInt(clientSettingBean.getDefaultStatus()));</span>
<span class="nc" id="L220">    }</span>

    public void initServer() throws Exception {
        //lookup for the server
<span class="nc" id="L224">        Registry reg = null;</span>
<span class="nc" id="L225">        System.out.println(&quot;Starting Client .....&quot;);</span>
<span class="nc" id="L226">        reg = LocateRegistry.getRegistry(clientSettingBean.getServerURL(), Integer.parseInt(clientSettingBean.getServerPort()));</span>
<span class="nc" id="L227">        System.out.println(&quot;trying to connect to the FIM server .....&quot;);</span>
        try {
<span class="nc" id="L229">            serverInterface = (ServerClientInterface) reg.lookup(&quot;ModernChatServer&quot;);</span>
<span class="nc" id="L230">            System.out.println(&quot;connected to the FIM server .....&quot;);</span>
<span class="nc" id="L231">        } catch (Exception ex) {</span>
            //ex.printStackTrace();
<span class="nc" id="L233">            throw new Exception(&quot;Can't find FIM Server at:&quot;+clientSettingBean.getServerURL()+&quot;:&quot;+clientSettingBean.getServerPort());</span>
<span class="nc" id="L234">        }</span>
<span class="nc" id="L235">    }</span>

    public void login(String userEmail, String password) throws Exception {
<span class="nc bnc" id="L238" title="All 2 branches missed.">        if (getServerInterface() == null) {</span>
<span class="nc" id="L239">            initServer();</span>
        }
<span class="nc" id="L241">        stringEnc=StringEncrypter.getInstance(password);</span>
<span class="nc" id="L242">        LoginBean loginBean=serverInterface.signIn(this, StringEncoder64.encodeStringUTF8(userEmail), stringEnc.encrypt(password),StringEncoder64.encodeStringUTF8(ownIP.getHostAddress()));</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">        if (loginBean == null) {</span>
<span class="nc" id="L244">            throw new Exception(&quot;Invalid User Email or Password!&quot;);</span>
        } else {
<span class="nc" id="L246">            user=loginBean.getUser();</span>
<span class="nc" id="L247">            securityToke=stringEnc.decrypt(loginBean.getSecureToken());</span>
<span class="nc" id="L248">            stringEnc=StringEncrypter.getInstance(securityToke);</span>
<span class="nc" id="L249">            FileEncrypter.getInstanceInit(securityToke.getBytes());</span>
<span class="nc" id="L250">            securityMode=serverInterface.getSecurityMode();</span>
<span class="nc" id="L251">            rootNode=serverInterface.getRootNode();</span>
<span class="nc" id="L252">            getChatClientFrame().setTitle(user.getName());</span>
<span class="nc" id="L253">            chatClientFrame.changeStatusEnabled(true);</span>
            try {
<span class="nc" id="L255">                groups = getServerInterface().loadGroupsAndUsers(loginBean.getAuthToken());</span>
<span class="nc" id="L256">            } catch (RemoteException ex) {</span>
<span class="nc" id="L257">                ex.printStackTrace();</span>
<span class="nc" id="L258">                throw new Exception(&quot;Error During Getting User Contacts List From FIM Server!&quot;);</span>
<span class="nc" id="L259">            }</span>
            try {
<span class="nc" id="L261">                setRooms(getServerInterface().getMyRooms(user,loginBean.getAuthToken()));</span>
<span class="nc" id="L262">            } catch (RemoteException ex) {</span>
<span class="nc" id="L263">                ex.printStackTrace();</span>
<span class="nc" id="L264">                throw new Exception(&quot;Error During Getting User Rooms List From FIM Server!&quot;);</span>
<span class="nc" id="L265">            }</span>
<span class="nc" id="L266">            String[] statusList = new String[getStatusLookup().size()];</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">            for (int i = 0; i &lt; getStatusLookup().size(); i++) {</span>
<span class="nc" id="L268">                statusList[i] = getStatusLookup().get(i).getDesc();</span>
            }
            //default status from setting file
<span class="nc" id="L271">            chatClientFrame.updateStatusList(statusList, Integer.parseInt(clientSettingBean.getDefaultStatus()));</span>
<span class="nc" id="L272">            updateMyStatus(Integer.parseInt(getClientSettingBean().getDefaultStatus()));</span>
<span class="nc" id="L273">            getChatSysTray().login();</span>
<span class="nc" id="L274">            clientSettingBean.setUserEmail(userEmail);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">            if(&quot;1&quot;.equals(clientSettingBean.getRememberPass())){</span>
<span class="nc" id="L276">                clientSettingBean.setPassword(password);</span>
            }
<span class="nc" id="L278">            clientSettingBean.updateSettings();</span>
<span class="nc" id="L279">            pingServerThread = new PingServerThread(this);</span>
<span class="nc" id="L280">            pingServerThread.start();</span>
        }
<span class="nc" id="L282">    }</span>
    public void kickOffByAdmin(String justification) throws RemoteException {
<span class="nc" id="L284">        chatClientFrame.changeStatusEnabled(false);</span>
<span class="nc" id="L285">        settingsFrame.setVisible(false);</span>
<span class="nc" id="L286">        fontFrame.setVisible(false);</span>
        //need to hide it also :)
        //jfm.setAcVisible(false);
<span class="nc" id="L289">        number = 20;</span>
<span class="nc" id="L290">        pingServerThread = null;</span>
        //if change status throws exception than also sign from the GUI , server may be down!
<span class="nc" id="L292">        getChatSysTray().logOut();</span>
        //adjust UI again
<span class="nc" id="L294">        showLoginAgain();</span>
<span class="nc" id="L295">        setUser(null);</span>
<span class="nc bnc" id="L296" title="All 4 branches missed.">        if(justification==null || justification.equals(&quot;&quot;)){</span>
<span class="nc" id="L297">            JOptionPane.showMessageDialog(getChatClientFrame(),&quot;You have been signed out by the Admin!&quot;,&quot;Admin Sign Out&quot;,JOptionPane.INFORMATION_MESSAGE);</span>
        }else{
<span class="nc" id="L299">            JOptionPane.showMessageDialog(getChatClientFrame(),&quot;You have been signed out off by the Admin for: &quot;+justification,&quot;Admin Sign Out&quot;,JOptionPane.INFORMATION_MESSAGE);</span>
        }
<span class="nc" id="L301">    }</span>
    public void kickOffByLogin(boolean sameMachine) throws RemoteException {
<span class="nc" id="L303">        chatClientFrame.changeStatusEnabled(false);</span>
<span class="nc" id="L304">        settingsFrame.setVisible(false);</span>
<span class="nc" id="L305">        fontFrame.setVisible(false);</span>
        //need to hide it also :)
        //jfm.setAcVisible(false);
<span class="nc" id="L308">        number = 20;</span>
<span class="nc" id="L309">        pingServerThread = null;</span>
        //if change status throws exception than also sign from the GUI , server may be down!
<span class="nc" id="L311">        getChatSysTray().logOut();</span>
        //adjust UI again
<span class="nc" id="L313">        showLoginAgain();</span>
<span class="nc" id="L314">        setUser(null);</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">        if(sameMachine){</span>
<span class="nc" id="L316">            JOptionPane.showMessageDialog(getChatClientFrame(),&quot;You have been logged off by login from client in the same machine!&quot;,&quot;Concurrent Login&quot;,JOptionPane.ERROR_MESSAGE,getErrorIcon());</span>
        }else{
<span class="nc" id="L318">            JOptionPane.showMessageDialog(getChatClientFrame(),&quot;You have been logged off by login from client in another machine!&quot;,&quot;Concurrent Login&quot;,JOptionPane.ERROR_MESSAGE,getErrorIcon());</span>
        }
<span class="nc" id="L320">    }</span>

    public void updateMyStatus(int statusNo){
<span class="nc bnc" id="L323" title="All 4 branches missed.">        if (statusNo != 0 &amp;&amp; user != null) {</span>
<span class="nc" id="L324">            user.setStatus_id(getStatusLookup().get(statusNo).getId());</span>
<span class="nc" id="L325">            SendMyStatusThread sendMyStatusThread = new SendMyStatusThread(this, SendMyStatusThread.UPDATE_STATUS);</span>
<span class="nc" id="L326">            sendMyStatusThread.start();</span>
<span class="nc" id="L327">        } else {</span>
<span class="nc" id="L328">            chatClientFrame.changeStatusEnabled(false);</span>
<span class="nc" id="L329">            settingsFrame.setVisible(false);</span>
<span class="nc" id="L330">            fontFrame.setVisible(false);</span>
            //need to hide it also :)
            //jfm.setAcVisible(false);
<span class="nc" id="L333">            number = 20;</span>
<span class="nc" id="L334">            pingServerThread = null;</span>
<span class="nc" id="L335">            SendMyStatusThread sendMyStatusThread = new SendMyStatusThread(this, SendMyStatusThread.SIGN_OUT);</span>
<span class="nc" id="L336">            sendMyStatusThread.start();</span>
        }
<span class="nc" id="L338">        System.gc();</span>
<span class="nc" id="L339">    }</span>

    public boolean ping() throws RemoteException {
<span class="nc" id="L342">        return true;</span>
    }

    public void receiveUpdatedUserStatus(User updatedUser) throws RemoteException {
<span class="nc bnc" id="L346" title="All 2 branches missed.">        if (updatedUser.getId() != user.getId()) {</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">            for (int i = 0; i &lt; groups.size(); i++) {</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">                if (updatedUser.getGroup_id() == groups.get(i).getId()) {</span>
<span class="nc" id="L349">                    Vector&lt;User&gt; tempUsers = groups.get(i).getUsers();</span>
<span class="nc bnc" id="L350" title="All 4 branches missed.">                    if (tempUsers != null &amp;&amp; tempUsers.size() &gt; 0) {</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">                        for (int n = 0; n &lt; tempUsers.size(); n++) {</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">                            if (updatedUser.getId() == tempUsers.get(n).getId()) {</span>
<span class="nc" id="L353">                                tempUsers.get(n).setStatus_id(updatedUser.getStatus_id());</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                                if (contactsPanel != null) {</span>
<span class="nc" id="L355">                                    contactsPanel.updateContactList();</span>
                                }
<span class="nc" id="L357">                                chatClientFrame.updateFrameIconForUser(updatedUser.getName(), userStatusIcons[updatedUser.getStatus_id()]);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L364">    }</span>
    public void refreshGroupsAndUsers(Vector&lt;Group&gt; groups) throws RemoteException {
<span class="nc" id="L366">        this.groups=groups;</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">        if (contactsPanel != null) {</span>
<span class="nc" id="L368">            closeAllChat();</span>
<span class="nc" id="L369">            contactsPanel.updateContactList();</span>
<span class="nc" id="L370">            JOptionPane.showMessageDialog(getChatClientFrame(),&quot;Your contact list is refreshed by the Admin!&quot;,&quot;Contact List Updated&quot;,JOptionPane.INFORMATION_MESSAGE);</span>
        }
<span class="nc" id="L372">    }</span>
    public void openChat(Group group, boolean fileTransfer, File file) {
        //check if group can have a chat room or not
<span class="nc" id="L375">        ChatWindowPanel temp = new ChatWindowPanel(this, group);</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">        if (getChatClientFrame().addNewFrame(group.getName(), group_icon, temp)) {</span>
<span class="nc" id="L377">            openChatPanels.put(group.getId(), temp);</span>
<span class="nc" id="L378">            getOpenChatPanelsByIndex().put(getChatClientFrame().getParentTabbedPane().getSelectedIndex() - 1, temp);</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">            if (fileTransfer) {</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">                if (file == null) {</span>
<span class="nc" id="L381">                    temp.openSendFileDialog();</span>
                } else {
<span class="nc" id="L383">                    temp.sendFileInit(file);</span>
                }
            }
        }
<span class="nc" id="L387">    }</span>

    public void openChat(Room room, boolean fileTransfer, File file) {
<span class="nc" id="L390">        ChatWindowPanel temp = new ChatWindowPanel(this, room);</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">        if (getChatClientFrame().addNewFrame(room.getName(), room_icon, temp)) {</span>
<span class="nc" id="L392">            openChatPanels.put(room.getId(), temp);</span>
<span class="nc" id="L393">            getOpenChatPanelsByIndex().put(getChatClientFrame().getParentTabbedPane().getSelectedIndex() - 1, temp);</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">            if (fileTransfer) {</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (file == null) {</span>
<span class="nc" id="L396">                    temp.openSendFileDialog();</span>
                } else {
<span class="nc" id="L398">                    temp.sendFileInit(file);</span>
                }
            }
        }
<span class="nc" id="L402">    }</span>

    public void openChat(User chatUser, boolean fileTransfer, File file) {
        //check if user can't accept chat or not
<span class="nc" id="L406">        ChatWindowPanel temp = new ChatWindowPanel(this, chatUser);</span>
        //if user status not exist , get it from the groups we have
<span class="nc bnc" id="L408" title="All 2 branches missed.">        for (int i = 0; i &lt; groups.size(); i++) {</span>
<span class="nc" id="L409">            Vector&lt;User&gt; tempUsers = groups.get(i).getUsers();</span>
<span class="nc bnc" id="L410" title="All 4 branches missed.">            if (tempUsers != null &amp;&amp; tempUsers.size() &gt; 0) {</span>
<span class="nc bnc" id="L411" title="All 2 branches missed.">                for (int n = 0; n &lt; tempUsers.size(); n++) {</span>
<span class="nc bnc" id="L412" title="All 2 branches missed.">                    if (chatUser.getId() == tempUsers.get(n).getId()) {</span>
<span class="nc" id="L413">                        chatUser.setStatus_id(tempUsers.get(n).getStatus_id());</span>
<span class="nc" id="L414">                        break;</span>
                    }
                }
            }
        }
<span class="nc bnc" id="L419" title="All 2 branches missed.">        if (chatClientFrame.addNewFrame(chatUser.getName(), userStatusIcons[chatUser.getStatus_id()], temp)) {</span>
<span class="nc" id="L420">            openChatPanels.put(chatUser.getId(), temp);</span>
<span class="nc" id="L421">            getOpenChatPanelsByIndex().put(getChatClientFrame().getParentTabbedPane().getSelectedIndex() - 1, temp);</span>
        }
<span class="nc bnc" id="L423" title="All 2 branches missed.">        if (fileTransfer) {</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">            if (file == null) {</span>
<span class="nc" id="L425">                temp.openSendFileDialog();</span>
            } else {
<span class="nc" id="L427">                temp.sendFileInit(file);</span>
            }
        }
<span class="nc" id="L430">    }</span>

    public void closeAllChat() {
<span class="nc" id="L433">        int n = getChatClientFrame().getParentTabbedPane().getTabCount() - 1;</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">        for (int i = n; i &gt; 0; i--) {</span>
<span class="nc" id="L435">            getChatClientFrame().removeFrame(i);</span>
        }
<span class="nc" id="L437">        openChatPanels = new Hashtable&lt;Integer, ChatWindowPanel&gt;();</span>
<span class="nc" id="L438">        openChatPanelsByIndex = new Hashtable&lt;Integer, ChatWindowPanel&gt;();</span>
<span class="nc" id="L439">    }</span>

    public void closeChatAtIndex(int index) {
<span class="nc" id="L442">        String name = getChatClientFrame().getParentTabbedPane().getTitleAt(index);</span>
<span class="nc" id="L443">        openChatPanelsByIndex.remove(index);</span>
<span class="nc" id="L444">        getChatClientFrame().removeFrame(index);</span>
<span class="nc" id="L445">        Enumeration en = openChatPanels.elements();</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">        while (en.hasMoreElements()) {</span>
<span class="nc" id="L447">            ChatWindowPanel obj = (ChatWindowPanel) en.nextElement();</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">            if (obj.getChat_type() == IConstant.USER_CHAT) {</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">                if (obj.getUser().getName().equals(name)) {</span>
<span class="nc" id="L450">                    openChatPanels.remove(obj.getUser().getId());</span>
                }
<span class="nc bnc" id="L452" title="All 2 branches missed.">            } else if (obj.getChat_type() == IConstant.GROUP_CHAT) {</span>
<span class="nc bnc" id="L453" title="All 2 branches missed.">                if (obj.getGroup().getName().equals(name)) {</span>
<span class="nc" id="L454">                    openChatPanels.remove(obj.getGroup().getId());</span>
                }
<span class="nc bnc" id="L456" title="All 2 branches missed.">            } else if (obj.getChat_type() == IConstant.ROOM_CHAT) {</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                if (obj.getRoom().getName().equals(name)) {</span>
<span class="nc" id="L458">                    openChatPanels.remove(obj.getRoom().getId());</span>
                }
            }
<span class="nc" id="L461">        }</span>
<span class="nc" id="L462">    }</span>
    public String changePassword(String oldPass, String newPass){
<span class="nc" id="L464">        ResultBean result = null;</span>
<span class="nc" id="L465">        oldPass=stringEnc.encrypt(oldPass);</span>
<span class="nc" id="L466">        newPass=stringEnc.encrypt(newPass);</span>
<span class="nc" id="L467">        String email=StringEncoder64.encodeStringUTF8(user.getEmail());</span>
        try {
<span class="nc" id="L469">            result = getServerInterface().changePassword(email, oldPass, newPass);</span>
<span class="nc" id="L470">        } catch (RemoteException ex) {</span>
<span class="nc" id="L471">            return &quot;Error:Failed to Connect To Server!&quot;;</span>
<span class="nc" id="L472">        }</span>
<span class="nc bnc" id="L473" title="All 2 branches missed.">        if (result.isSuccess()) {</span>
<span class="nc bnc" id="L474" title="All 2 branches missed.">            if(&quot;1&quot;.equals(clientSettingBean.getRememberPass())){</span>
<span class="nc" id="L475">                newPass=stringEnc.decrypt(newPass);</span>
<span class="nc" id="L476">                clientSettingBean.setPassword(newPass);</span>
<span class="nc" id="L477">                clientSettingBean.updateSettings();</span>
<span class="nc" id="L478">                loginPanel.updatePassword(newPass);</span>
            }
<span class="nc" id="L480">            return &quot;New Password Applied Successfully!&quot;;</span>
        } else {
<span class="nc bnc" id="L482" title="All 2 branches missed.">            if (result.getAction() == IConstant.ERROR) {</span>
                //set user status in the tab and list as offline !
<span class="nc" id="L484">                return result.getMessage();</span>
            } else {
<span class="nc" id="L486">                return &quot;Failed to Change Password!&quot;;</span>
            }
        }
    }
    public String sendTextMessage(TextMessage textMessage) {
<span class="nc" id="L491">        textMessage.setFromUserId(user.getId());</span>
<span class="nc" id="L492">        textMessage.setTitle(user.getName());</span>
<span class="nc" id="L493">        boolean result = false;</span>
        try {
<span class="nc bnc" id="L495" title="All 2 branches missed.">            if(getSecurityMode()==0) {</span>
<span class="nc" id="L496">                result = getServerInterface().sendTextMessage(textMessage);</span>
            }else{
<span class="nc" id="L498">                textMessage.setMessage(stringEnc.encrypt(textMessage.getMessage()));</span>
<span class="nc" id="L499">                textMessage.setTitle(stringEnc.encrypt(textMessage.getTitle()));</span>
<span class="nc" id="L500">                result = getServerInterface().sendSecureTextMessage(textMessage);</span>
            }
<span class="nc" id="L502">        } catch (RemoteException ex) {</span>
<span class="nc" id="L503">            return &quot;Error:Failed to Deliver This Message!&quot;;</span>
<span class="nc" id="L504">        }</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">        if (result) {</span>
<span class="nc" id="L506">            return null;</span>
        } else {
<span class="nc" id="L508">            return &quot;Error:Failed to Deliver This Message!&quot;;</span>
        }
    }

    public String sendBinaryMessage(BinaryMessage bm) {
<span class="nc" id="L513">        bm.setFromUserId(user.getId());</span>
<span class="nc" id="L514">        bm.setTitle(user.getName());</span>
<span class="nc" id="L515">        ResultBean result = null;</span>
        try {
<span class="nc bnc" id="L517" title="All 2 branches missed.">            if(getSecurityMode()==0){</span>
<span class="nc" id="L518">                result = getServerInterface().sendBinaryMessage(bm);</span>
            }else{
<span class="nc" id="L520">                bm.setDesc(stringEnc.encrypt(bm.getDesc()));</span>
<span class="nc" id="L521">                bm.setTitle(stringEnc.encrypt(bm.getTitle()));</span>
<span class="nc" id="L522">                result = getServerInterface().sendSecureBinaryMessage(bm);</span>
            }
<span class="nc" id="L524">        } catch (RemoteException ex) {</span>
<span class="nc" id="L525">            return &quot;Error:Failed to Deliver This File!&quot;;</span>
<span class="nc" id="L526">        }</span>
<span class="nc bnc" id="L527" title="All 2 branches missed.">        if (result.isSuccess()) {</span>
<span class="nc" id="L528">            return null;</span>
        } else {
<span class="nc bnc" id="L530" title="All 2 branches missed.">            if (result.getAction() == IConstant.REJECTED) {</span>
<span class="nc" id="L531">                return &quot;Rejected:File Transfer Declined by the User!&quot;;</span>
            }else {
<span class="nc" id="L533">                return &quot;Error:Failed to Deliver This File!&quot;;</span>
            }
        }
    }

    public void sendAnnouncement(TextMessage textMessage) {
<span class="nc" id="L539">        textMessage.setFromUserId(user.getId());</span>
<span class="nc" id="L540">        textMessage.setTitle(user.getName());</span>
<span class="nc" id="L541">        SendAnnouncementThread sendThread = new SendAnnouncementThread(this, textMessage);</span>
<span class="nc" id="L542">        sendThread.start();</span>
<span class="nc" id="L543">    }</span>

    public static void main(String[] args) {
        try {
<span class="nc" id="L547">            ChatClientApp clientApp = new ChatClientApp();</span>
<span class="nc" id="L548">        } catch (RemoteException ex) {</span>
<span class="nc" id="L549">            ex.printStackTrace();</span>
<span class="nc" id="L550">            System.out.println(&quot;Error in Running!&quot;);</span>
<span class="nc" id="L551">        }</span>
<span class="nc" id="L552">    }</span>

    public boolean receiveTextMessage(TextMessage msg) throws RemoteException {
<span class="nc" id="L555">        ChatWindowPanel tempPanel = null;</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">        if (msg.getTargetType() == IConstant.USER_CHAT) {</span>
<span class="nc" id="L557">            tempPanel = openChatPanels.get(msg.getFromUserId());</span>
<span class="nc bnc" id="L558" title="All 2 branches missed.">            if (tempPanel == null) {</span>
<span class="nc" id="L559">                User temp = new User();</span>
<span class="nc" id="L560">                temp.setId(msg.getFromUserId());</span>
<span class="nc" id="L561">                temp.setName(msg.getTitle());</span>
                //to gurantee user tab is exist.
<span class="nc" id="L563">                openChat(temp, false, null);</span>
<span class="nc" id="L564">                tempPanel = openChatPanels.get(msg.getFromUserId());</span>
<span class="nc" id="L565">            }</span>
<span class="nc bnc" id="L566" title="All 2 branches missed.">        } else if (msg.getTargetType() == IConstant.GROUP_CHAT) {</span>
<span class="nc" id="L567">            tempPanel = openChatPanels.get(msg.getToUserId());</span>
<span class="nc bnc" id="L568" title="All 2 branches missed.">            if (tempPanel == null) {</span>
<span class="nc" id="L569">                Group temp = new Group();</span>
<span class="nc" id="L570">                temp.setId(msg.getToUserId());</span>
<span class="nc bnc" id="L571" title="All 2 branches missed.">                for (int i = 0; i &lt; groups.size(); i++) {</span>
<span class="nc bnc" id="L572" title="All 2 branches missed.">                    if (groups.get(i).getId() == msg.getToUserId()) {</span>
<span class="nc" id="L573">                        temp.setName(groups.get(i).getName());</span>
                    }
                }
                //to gurantee user tab is exist.
<span class="nc" id="L577">                openChat(temp, false, null);</span>
<span class="nc" id="L578">                tempPanel = openChatPanels.get(msg.getToUserId());</span>
<span class="nc" id="L579">            }</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">        } else if (msg.getTargetType() == IConstant.ROOM_CHAT) {</span>
<span class="nc" id="L581">            tempPanel = openChatPanels.get(msg.getToUserId());</span>
<span class="nc bnc" id="L582" title="All 2 branches missed.">            if (tempPanel == null) {</span>
<span class="nc" id="L583">                Room temp = new Room();</span>
<span class="nc" id="L584">                temp.setId(msg.getToUserId());</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">                for (int i = 0; i &lt; rooms.size(); i++) {</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">                    if (rooms.get(i).getId() == msg.getToUserId()) {</span>
<span class="nc" id="L587">                        temp.setName(rooms.get(i).getName());</span>
                    }
                }
                //to gurantee user tab is exist.
<span class="nc" id="L591">                openChat(temp, false, null);</span>
<span class="nc" id="L592">                tempPanel = openChatPanels.get(msg.getToUserId());</span>
            }
        }
<span class="nc" id="L595">        tempPanel.addTextChat(msg);</span>
<span class="nc" id="L596">        title = msg.getTitle();</span>
<span class="nc" id="L597">        startThread();</span>
<span class="nc" id="L598">        return true;</span>
    }

    public ResultBean receiveBinaryMessageRequest(BinaryMessage msg) throws RemoteException {
<span class="nc" id="L602">        ChatWindowPanel tempPanel = openChatPanels.get(msg.getFromUserId());</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">        if (tempPanel == null) {</span>
<span class="nc" id="L604">            User temp = new User();</span>
<span class="nc" id="L605">            temp.setId(msg.getFromUserId());</span>
<span class="nc" id="L606">            temp.setName(msg.getTitle());</span>
            //to gurantee user tab is exist.
<span class="nc" id="L608">            openChat(temp, false, null);</span>
<span class="nc" id="L609">            tempPanel = openChatPanels.get(msg.getFromUserId());</span>
        }
<span class="nc" id="L611">        title = msg.getTitle();</span>
<span class="nc" id="L612">        startThread();</span>
<span class="nc" id="L613">        tempPanel.addTextChat(msg.getTitle() + &quot; want to send you the file [&quot; + msg.getDesc() + &quot;], Accept?&quot;);</span>
<span class="nc" id="L614">        int n = JOptionPane.showConfirmDialog(getChatClientFrame(), msg.getTitle() + &quot; : want to send you the file [&quot; + msg.getDesc() + &quot;], Accept?&quot;, &quot;Accept File Transfer&quot;, JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">        if (n == JOptionPane.OK_OPTION) {</span>
<span class="nc" id="L616">            return new ResultBean(true, IConstant.SUCCESS, null);</span>
        } else {
<span class="nc" id="L618">            tempPanel.addTextChat(&quot;File transfer rejected!&quot;);</span>
<span class="nc" id="L619">            TextMessage tm = new TextMessage();</span>
<span class="nc" id="L620">            tm.setTitle(user.getName());</span>
<span class="nc" id="L621">            tm.setFromUserId(user.getId());</span>
<span class="nc" id="L622">            tm.setMessage(&quot;File [&quot; + msg.getDesc() + &quot;] transfer rejected by &quot; + user.getName());</span>
<span class="nc" id="L623">            tm.setToUserId(msg.getFromUserId());</span>
<span class="nc" id="L624">            tm.setTargetType(IConstant.USER_CHAT);</span>
<span class="nc" id="L625">            getServerInterface().sendTextMessage(tm);</span>
<span class="nc" id="L626">            return new ResultBean(false, IConstant.REJECTED, null);</span>
        }
    }

    public void receiveBinaryMessageLoad(BinaryMessage msg) throws RemoteException {
<span class="nc" id="L631">        ChatWindowPanel tempPanel = openChatPanels.get(msg.getFromUserId());</span>
<span class="nc bnc" id="L632" title="All 2 branches missed.">        if (tempPanel == null) {</span>
<span class="nc" id="L633">            User temp = new User();</span>
<span class="nc" id="L634">            temp.setId(msg.getFromUserId());</span>
<span class="nc" id="L635">            temp.setName(msg.getTitle());</span>
            //to gurantee user tab is exist.
<span class="nc" id="L637">            openChat(temp, false, null);</span>
<span class="nc" id="L638">            tempPanel = openChatPanels.get(msg.getFromUserId());</span>
        }
<span class="nc" id="L640">        title = msg.getTitle();</span>
<span class="nc" id="L641">        startThread();</span>
<span class="nc" id="L642">        ReceiveFileThread receiveFileThread = new ReceiveFileThread(tempPanel, msg, this);</span>
<span class="nc" id="L643">        receiveFileThread.start();</span>
<span class="nc" id="L644">    }</span>

    public void receiveTextAnnouncement(TextMessage msg) throws RemoteException {
<span class="nc" id="L647">        ReceiveAnnouncementThread receiveThread = new ReceiveAnnouncementThread(this, msg);</span>
<span class="nc" id="L648">        receiveThread.start();</span>
<span class="nc" id="L649">        title = msg.getTitle();</span>
<span class="nc" id="L650">        startThread();</span>
<span class="nc" id="L651">    }</span>
    public void receiveSecureTextAnnouncement(TextMessage msg) throws RemoteException {
<span class="nc" id="L653">        msg.setMessage(stringEnc.decrypt(msg.getMessage()));</span>
<span class="nc" id="L654">        msg.setTitle(stringEnc.decrypt(msg.getTitle()));</span>
<span class="nc" id="L655">        receiveTextAnnouncement(msg);</span>
<span class="nc" id="L656">    }</span>
    public boolean receiveSecureTextMessage(TextMessage msg) throws RemoteException {
<span class="nc" id="L658">        msg.setMessage(stringEnc.decrypt(msg.getMessage()));</span>
<span class="nc" id="L659">        msg.setTitle(stringEnc.decrypt(msg.getTitle()));</span>
<span class="nc" id="L660">        return receiveTextMessage(msg);</span>
    }
    public ResultBean receiveSecureBinaryMessageRequest(BinaryMessage msg) throws RemoteException {
<span class="nc" id="L663">        msg.setDesc(stringEnc.decrypt(msg.getDesc()));</span>
<span class="nc" id="L664">        msg.setTitle(stringEnc.decrypt(msg.getTitle()));</span>
<span class="nc" id="L665">        return receiveBinaryMessageRequest(msg);</span>
    }
    public void receiveSecureBinaryMessageLoad(BinaryMessage msg) throws RemoteException {
<span class="nc" id="L668">        msg.setDesc(stringEnc.decrypt(msg.getDesc()));</span>
<span class="nc" id="L669">        msg.setTitle(stringEnc.decrypt(msg.getTitle()));</span>
<span class="nc" id="L670">        receiveBinaryMessageLoad(msg);</span>
<span class="nc" id="L671">    }</span>
    private void startThread() {
<span class="nc bnc" id="L673" title="All 2 branches missed.">        if (chatClientFrame.isVisible() == false) {</span>
<span class="nc" id="L674">            getChatSysTray().showMessage(title);</span>
        }
<span class="nc" id="L676">        chatClientFrame.setVisible(true);</span>
<span class="nc" id="L677">        chatClientFrame.toFront();</span>
<span class="nc" id="L678">        chatClientFrame.requestFocusInWindow();</span>
        //don't disturb me if in busy status
<span class="nc bnc" id="L680" title="All 2 branches missed.">        if(user.getStatus_id()!=IConstant.BUSY){</span>
<span class="nc bnc" id="L681" title="All 4 branches missed.">            if (number == 0 || number &gt;= 16) {</span>
<span class="nc" id="L682">                number = 0;</span>
<span class="nc bnc" id="L683" title="All 2 branches missed.">                if(ac!=null) ac.play();</span>
<span class="nc" id="L684">                th = new Thread(this);</span>
<span class="nc" id="L685">                th.start();</span>
            }
        }
<span class="nc" id="L688">    }</span>

    public void showChangePass() {
<span class="nc" id="L691">        changePassFrame.setLocationRelativeTo(settingsFrame);</span>
<span class="nc" id="L692">        changePassPanel.clearFields();</span>
<span class="nc" id="L693">        changePassFrame.setVisible(true);</span>
<span class="nc" id="L694">    }</span>

    public void showSettings() {
<span class="nc" id="L697">        settingsFrame.setLocationRelativeTo(getChatClientFrame());</span>
<span class="nc" id="L698">        settingPanel.updateSettings();</span>
<span class="nc" id="L699">        settingsFrame.setVisible(true);</span>
<span class="nc" id="L700">    }</span>
    public void showLoginAgain() {
<span class="nc" id="L702">        closeAllChat();</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">        if(&quot;1&quot;.equals(clientSettingBean.getRememberPass())){</span>
<span class="nc" id="L704">            loginPanel.updatePassword(clientSettingBean.getPassword());</span>
        }else{
<span class="nc" id="L706">            loginPanel.updatePassword(&quot;&quot;);</span>
        }
<span class="nc" id="L708">        getChatClientFrame().getContactPanel().remove(contactsPanel);</span>
<span class="nc" id="L709">        getChatClientFrame().changeStatusEnabled(false);</span>
<span class="nc" id="L710">        contactsPanel = new ContactsPanel(this);</span>
<span class="nc" id="L711">        getChatClientFrame().getContactPanel().add(loginPanel, java.awt.BorderLayout.CENTER);</span>
<span class="nc" id="L712">        getChatClientFrame().setIconAt(0, new javax.swing.ImageIcon(getClass().getResource(&quot;/images/login.gif&quot;)));</span>
<span class="nc" id="L713">        getChatClientFrame().setTitleAt(0, &quot;Login&quot;);</span>
<span class="nc" id="L714">        getChatClientFrame().setTitle(&quot;Free Instant Messenger&quot;);</span>
        //getChatClientFrame().setIconImage(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/groups.png&quot;)));
<span class="nc" id="L716">        getChatClientFrame().repaint();</span>
<span class="nc" id="L717">    }</span>

    public void showContactList() {
<span class="nc" id="L720">        getChatClientFrame().getContactPanel().remove(loginPanel);</span>
<span class="nc" id="L721">        contactsPanel = new ContactsPanel(this);</span>
<span class="nc" id="L722">        getChatClientFrame().getContactPanel().add(contactsPanel, java.awt.BorderLayout.CENTER);</span>
<span class="nc" id="L723">        getChatClientFrame().setIconAt(0, group_icon);</span>
<span class="nc" id="L724">        getChatClientFrame().setTitleAt(0, &quot;Contact List&quot;);</span>
<span class="nc" id="L725">        getChatClientFrame().repaint();</span>
<span class="nc" id="L726">    }</span>

    public void initSound() {
<span class="nc bnc" id="L729" title="All 4 branches missed.">        if (clientSettingBean.getSoundType() != null &amp;&amp; !&quot;0&quot;.equals(clientSettingBean.getSoundType())) {</span>
            try {
<span class="nc bnc" id="L731" title="All 2 branches missed.">                if (&quot;1&quot;.equals(getClientSettingBean().getSoundType())) {</span>
<span class="nc" id="L732">                    ac = Applet.newAudioClip(new File(path + &quot;/sound/alert.mid&quot;).toURI().toURL());</span>
                } else {
<span class="nc" id="L734">                    ac = Applet.newAudioClip(new File(path + &quot;/sound/bird.mid&quot;).toURI().toURL());</span>
                }
<span class="nc" id="L736">            } catch (MalformedURLException ex) {</span>
<span class="nc" id="L737">                ex.printStackTrace();</span>
<span class="nc" id="L738">            }</span>
        }else{
<span class="nc" id="L740">            ac=null;</span>
        }
<span class="nc" id="L742">    }</span>

    public void forcedSignOff() throws RemoteException {
<span class="nc" id="L745">    }</span>

    private void exitME() {
<span class="nc" id="L748">        chatClientFrame.setVisible(false);</span>
<span class="nc" id="L749">    }</span>

    public void run() {
<span class="nc bnc" id="L752" title="All 2 branches missed.">        while (number &lt; 16) {</span>
<span class="nc bnc" id="L753" title="All 2 branches missed.">            if (chatClientFrame.isVisible()) {</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">                if (number % 2 == 0) {</span>
<span class="nc" id="L755">                    chatClientFrame.setTitle(title + &quot; is talking!&quot;);</span>
<span class="nc" id="L756">                    chatClientFrame.setIconImage(java.awt.Toolkit.getDefaultToolkit().getImage(getClass().getResource(&quot;/images/chat.jpg&quot;)));</span>
                } else {
<span class="nc bnc" id="L758" title="All 2 branches missed.">                    if (user != null) {</span>
<span class="nc" id="L759">                        chatClientFrame.setTitle(user.getName());</span>
                    } else {
<span class="nc" id="L761">                        chatClientFrame.setTitle(&quot;Free Instant Messenger&quot;);</span>
                    }
<span class="nc" id="L763">                    chatClientFrame.setIconImage(getChatSysTray().getStatusImage());</span>
                }
            }
            try {
<span class="nc" id="L767">                number++;</span>
<span class="nc" id="L768">                th.sleep(1500);</span>
<span class="nc" id="L769">            } catch (Exception e) {</span>
<span class="nc" id="L770">            }</span>
        }
<span class="nc bnc" id="L772" title="All 2 branches missed.">        if (user != null) {</span>
<span class="nc" id="L773">            chatClientFrame.setTitle(user.getName());</span>
        } else {
<span class="nc" id="L775">            chatClientFrame.setTitle(&quot;Free Instant Messenger&quot;);</span>
        }
<span class="nc" id="L777">        chatClientFrame.setIconImage(getChatSysTray().getStatusImage());</span>
<span class="nc" id="L778">    }</span>

    public String getPath() {
<span class="nc" id="L781">        return path;</span>
    }

    public Vector&lt;Group&gt; getGroups() {
<span class="nc" id="L785">        return groups;</span>
    }

    public User getUser() {
<span class="nc" id="L789">        return user;</span>
    }

    public void setUser(User user) {
<span class="nc" id="L793">        this.user = user;</span>
<span class="nc" id="L794">    }</span>

    public Vector&lt;Room&gt; getRooms() {
<span class="nc" id="L797">        return rooms;</span>
    }

    public void setRooms(Vector&lt;Room&gt; rooms) {
<span class="nc" id="L801">        this.rooms = rooms;</span>
<span class="nc" id="L802">    }</span>

    public Hashtable&lt;Integer, ChatWindowPanel&gt; getOpenChatPanelsByIndex() {
<span class="nc" id="L805">        return openChatPanelsByIndex;</span>
    }

    public static Hashtable&lt;String, String&gt; getEmotionImages() {
<span class="nc" id="L809">        return emotionImages;</span>
    }

    public JFileChooser getJfm() {
<span class="nc" id="L813">        return jfm;</span>
    }

    public ChatFrame getChatClientFrame() {
<span class="nc" id="L817">        return chatClientFrame;</span>
    }

    public void windowOpened(WindowEvent arg0) {
        //about();
<span class="nc" id="L822">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowClosing(java.awt.event.WindowEvent)
     */

    public void windowClosing(WindowEvent arg0) {
<span class="nc" id="L828">        exitME();</span>
<span class="nc" id="L829">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowClosed(java.awt.event.WindowEvent)
     */

    public void windowClosed(WindowEvent arg0) {
<span class="nc" id="L835">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowIconified(java.awt.event.WindowEvent)
     */

    public void windowIconified(WindowEvent arg0) {
<span class="nc" id="L841">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowDeiconified(java.awt.event.WindowEvent)
     */

    public void windowDeiconified(WindowEvent arg0) {
<span class="nc" id="L847">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowActivated(java.awt.event.WindowEvent)
     */

    public void windowActivated(WindowEvent arg0) {
<span class="nc" id="L853">    }</span>
    /* (non-Javadoc)
     * @see java.awt.event.WindowListener#windowDeactivated(java.awt.event.WindowEvent)
     */

    public void windowDeactivated(WindowEvent arg0) {
<span class="nc" id="L859">    }</span>

    /**
     * @return the statusLookup
     */
    public Hashtable&lt;Integer, Status&gt; getStatusLookup() {
<span class="nc" id="L865">        return statusLookup;</span>
    }

    private void loadStatusLookup() {
<span class="nc" id="L869">        statusLookup = new Hashtable&lt;Integer, Status&gt;();</span>
<span class="nc" id="L870">        Status status0 = new Status();</span>
<span class="nc" id="L871">        status0.setId(0);</span>
<span class="nc" id="L872">        status0.setDesc(&quot;Sign Out&quot;);</span>
<span class="nc" id="L873">        Status status1 = new Status();</span>
<span class="nc" id="L874">        status1.setId(1);</span>
<span class="nc" id="L875">        status1.setDesc(&quot;Offline&quot;);</span>
<span class="nc" id="L876">        Status status2 = new Status();</span>
<span class="nc" id="L877">        status2.setId(2);</span>
<span class="nc" id="L878">        status2.setDesc(&quot;Online&quot;);</span>
<span class="nc" id="L879">        Status status3 = new Status();</span>
<span class="nc" id="L880">        status3.setId(3);</span>
<span class="nc" id="L881">        status3.setDesc(&quot;Busy&quot;);</span>
<span class="nc" id="L882">        Status status4 = new Status();</span>
<span class="nc" id="L883">        status4.setId(4);</span>
<span class="nc" id="L884">        status4.setDesc(&quot;Away&quot;);</span>
<span class="nc" id="L885">        statusLookup.put(IConstant.SIGN_OUT, status0);</span>
<span class="nc" id="L886">        statusLookup.put(IConstant.OFFLINE, status1);</span>
<span class="nc" id="L887">        statusLookup.put(IConstant.ONLINE, status2);</span>
<span class="nc" id="L888">        statusLookup.put(IConstant.BUSY, status3);</span>
<span class="nc" id="L889">        statusLookup.put(IConstant.AWAY, status4);</span>
<span class="nc" id="L890">    }</span>

    /**
     * @return the serverInterface
     */
    public ServerClientInterface getServerInterface() {
<span class="nc" id="L896">        return serverInterface;</span>
    }

    /**
     * @return the chatSysTray
     */
    public ChatSysTray getChatSysTray() {
<span class="nc" id="L903">        return chatSysTray;</span>
    }

    /**
     * @return the errorIcon
     */
    public ImageIcon getErrorIcon() {
<span class="nc" id="L910">        return errorIcon;</span>
    }

    /**
     * @return the emotionPanel
     */
    public EmotionPanel getEmotionPanel() {
<span class="nc" id="L917">        return emotionPanel;</span>
    }

    /**
     * @return the emotionFrame
     */
    public JDialog getEmotionFrame() {
<span class="nc" id="L924">        return emotionFrame;</span>
    }

    /**
     * @return the fontFrame
     */
    public JDialog getFontFrame() {
<span class="nc" id="L931">        return fontFrame;</span>
    }

    /**
     * @return the clientSettingBean
     */
    public ClientSettingBean getClientSettingBean() {
<span class="nc" id="L938">        return clientSettingBean;</span>
    }

    /**
     * @return the securityMode
     */
    public int getSecurityMode() {
<span class="nc" id="L945">        return securityMode;</span>
    }
    public String getRootNode(){
<span class="nc" id="L948">        return rootNode;</span>
    }

    /**
     * @return the stringEnc
     */
    public StringEncrypter getStringEnc() {
<span class="nc" id="L955">        return stringEnc;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>