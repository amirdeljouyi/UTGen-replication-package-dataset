<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ChatWindowPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">73_fim1</a> &gt; <a href="index.source.html" class="el_package">osa.ora.server.client.ui</a> &gt; <span class="el_source">ChatWindowPanel.java</span></div><h1>ChatWindowPanel.java</h1><pre class="source lang-java linenums">/*
 * ChatWindowPanel.java
 *
 * Created on October 29, 2009, 7:33 PM
 */
package osa.ora.server.client.ui;

import java.awt.Color;
import java.awt.Cursor;
import java.awt.Desktop;
import java.awt.Font;
import java.awt.Toolkit;
import java.awt.datatransfer.DataFlavor;
import java.awt.datatransfer.StringSelection;
import java.awt.datatransfer.Transferable;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.io.File;
import java.io.FileOutputStream;
import java.net.URI;
import java.util.Calendar;
import javax.swing.JEditorPane;
import javax.swing.JFileChooser;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPopupMenu;
import javax.swing.event.HyperlinkEvent;
import javax.swing.event.HyperlinkListener;
import javax.swing.text.Document;
import javax.swing.text.EditorKit;
import javax.swing.text.html.HTMLDocument;
import javax.swing.text.html.HTMLEditorKit;
import javax.swing.text.html.HTMLFrameHyperlinkEvent;
import osa.ora.server.beans.BinaryMessage;
import osa.ora.server.beans.Group;
import osa.ora.server.beans.IConstant;
import osa.ora.server.beans.Room;
import osa.ora.server.beans.TextMessage;
import osa.ora.server.beans.User;
import osa.ora.server.client.*;
import osa.ora.server.client.threads.SendChatThread;
import osa.ora.server.client.threads.SendFileThread;
import osa.ora.server.client.ui.utils.FileTransferHandler;

/**
 *
 * @author  ooransa
 */
public class ChatWindowPanel extends ParentPanel {

    ChatClientApp chatApp;
    private User user;
    private Group group;
    private Room room;
    private int chat_type;
    private JPopupMenu editPopupMenu;
    private JMenuItem copyMenuItem;
    private JMenuItem cutMenuItem;
    private JMenuItem pasteMenuItem;
    private JMenuItem selectAllMenuItem;
    private JMenuItem sendMenuItem;
    private JPopupMenu savePopupMenu;
    private JMenuItem copyFormattedMenuItem;
    private JMenuItem saveFormattedMenuItem;
    private JMenuItem saveUnFormattedMenuItem;
    private JMenuItem clearChatMenuItem;
    private JMenuItem clearChatMenuItem1;
    private HTMLEditorKit editorHTMLKit;
    Font sourceFont;
    Font destFont;
    Color sourceColor;
    Color destColor;
    String sourceFontStyleOpen;
    String destFontStyleOpen;
    String sourceFontStyleClose;
    String destFontStyleClose;

<span class="nc" id="L80">    public ChatWindowPanel(ChatClientApp chatApp, Group group) {</span>
<span class="nc" id="L81">        this.group = group;</span>
<span class="nc" id="L82">        this.chatApp = chatApp;</span>
<span class="nc" id="L83">        this.chat_type = IConstant.GROUP_CHAT;</span>
<span class="nc" id="L84">        initComponents();</span>
<span class="nc" id="L85">        initSettings(true);</span>
<span class="nc" id="L86">    }</span>

<span class="nc" id="L88">    public ChatWindowPanel(ChatClientApp chatApp, User user) {</span>
<span class="nc" id="L89">        this.user = user;</span>
<span class="nc" id="L90">        this.chatApp = chatApp;</span>
<span class="nc" id="L91">        this.chat_type = IConstant.USER_CHAT;</span>
<span class="nc" id="L92">        initComponents();</span>
<span class="nc" id="L93">        initSettings(true);</span>
<span class="nc" id="L94">    }</span>

<span class="nc" id="L96">    public ChatWindowPanel(ChatClientApp chatApp, Room room) {</span>
<span class="nc" id="L97">        this.room = room;</span>
<span class="nc" id="L98">        this.chatApp = chatApp;</span>
<span class="nc" id="L99">        this.chat_type = IConstant.ROOM_CHAT;</span>
<span class="nc" id="L100">        initComponents();</span>
<span class="nc" id="L101">        initSettings(true);</span>
<span class="nc" id="L102">    }</span>
    private void initSettings(boolean firstTime){
<span class="nc" id="L104">        sourceFont=new Font(chatApp.getClientSettingBean().getSourceFontName(),Integer.parseInt(chatApp.getClientSettingBean().getSourceFontStyle()),Integer.parseInt(chatApp.getClientSettingBean().getSourceFontSize()));</span>
<span class="nc" id="L105">        destFont=new Font(chatApp.getClientSettingBean().getDestFontName(),Integer.parseInt(chatApp.getClientSettingBean().getDestFontStyle()),Integer.parseInt(chatApp.getClientSettingBean().getDestFontSize()));</span>
<span class="nc" id="L106">        sourceColor=new Color(Integer.parseInt(chatApp.getClientSettingBean().getSourceFontColor()));</span>
<span class="nc" id="L107">        destColor=new Color(Integer.parseInt(chatApp.getClientSettingBean().getDestFontColor()));</span>
<span class="nc" id="L108">        jEditorPane2.setFont(sourceFont);</span>
<span class="nc" id="L109">        jEditorPane1.setFont(destFont);</span>
<span class="nc" id="L110">        jEditorPane2.setForeground(sourceColor);</span>
<span class="nc" id="L111">        jEditorPane1.setForeground(destColor);</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">        if(sourceFont.getStyle()==3){</span>
<span class="nc" id="L113">            sourceFontStyleOpen=&quot;&lt;B&gt;&lt;I&gt;&quot;;</span>
<span class="nc" id="L114">            sourceFontStyleClose=&quot;&lt;/B&gt;&lt;/I&gt;&quot;;</span>
<span class="nc bnc" id="L115" title="All 2 branches missed.">        }else if(sourceFont.getStyle()==2){</span>
<span class="nc" id="L116">            sourceFontStyleOpen=&quot;&lt;I&gt;&quot;;</span>
<span class="nc" id="L117">            sourceFontStyleClose=&quot;&lt;/I&gt;&quot;;</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        }else if(sourceFont.getStyle()==1){</span>
<span class="nc" id="L119">            sourceFontStyleOpen=&quot;&lt;B&gt;&quot;;</span>
<span class="nc" id="L120">            sourceFontStyleClose=&quot;&lt;/B&gt;&quot;;</span>
        }else{
<span class="nc" id="L122">            sourceFontStyleOpen=&quot;&quot;;</span>
<span class="nc" id="L123">            sourceFontStyleClose=&quot;&quot;;</span>
        }
<span class="nc bnc" id="L125" title="All 2 branches missed.">        if(destFont.getStyle()==3){</span>
<span class="nc" id="L126">            destFontStyleOpen=&quot;&lt;B&gt;&lt;I&gt;&quot;;</span>
<span class="nc" id="L127">            destFontStyleClose=&quot;&lt;/B&gt;&lt;/I&gt;&quot;;</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">        }else if(destFont.getStyle()==2){</span>
<span class="nc" id="L129">            destFontStyleOpen=&quot;&lt;I&gt;&quot;;</span>
<span class="nc" id="L130">            destFontStyleClose=&quot;&lt;/I&gt;&quot;;</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">        }else if(destFont.getStyle()==1){</span>
<span class="nc" id="L132">            destFontStyleOpen=&quot;&lt;B&gt;&quot;;</span>
<span class="nc" id="L133">            destFontStyleClose=&quot;&lt;/B&gt;&quot;;</span>
        }else{
<span class="nc" id="L135">            destFontStyleOpen=&quot;&quot;;</span>
<span class="nc" id="L136">            destFontStyleClose=&quot;&quot;;</span>
        }
<span class="nc bnc" id="L138" title="All 2 branches missed.">        if(firstTime){</span>
<span class="nc" id="L139">            Calendar cal=Calendar.getInstance();</span>
<span class="nc" id="L140">            int month=cal.get(Calendar.MONTH)+1;</span>
<span class="nc" id="L141">            String today=&quot;Chat window open at &quot;+cal.get(Calendar.HOUR_OF_DAY)+&quot;:&quot;+cal.get(Calendar.MINUTE)+&quot; &quot;+cal.get(Calendar.DATE)+&quot;/&quot;+month+&quot;/&quot;+cal.get(Calendar.YEAR);</span>
<span class="nc" id="L142">            addTextChat(today);</span>
        }
<span class="nc" id="L144">    }</span>
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // &lt;editor-fold defaultstate=&quot;collapsed&quot; desc=&quot;Generated Code&quot;&gt;//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

<span class="nc" id="L154">        jPanel1 = new javax.swing.JPanel();</span>
<span class="nc" id="L155">        jPanel3 = new javax.swing.JPanel();</span>
<span class="nc" id="L156">        sendEmotionButton = new javax.swing.JButton();</span>
<span class="nc" id="L157">        setFontColorButton = new javax.swing.JButton();</span>
<span class="nc" id="L158">        saveButton = new javax.swing.JButton();</span>
<span class="nc" id="L159">        sendFileButton = new javax.swing.JButton();</span>
<span class="nc" id="L160">        jScrollPane2 = new javax.swing.JScrollPane();</span>
<span class="nc" id="L161">        jEditorPane2 = new javax.swing.JEditorPane();</span>
<span class="nc" id="L162">        jEditorPane2.setTransferHandler(new FileTransferHandler(this));</span>
<span class="nc" id="L163">        jPanel2 = new javax.swing.JPanel();</span>
<span class="nc" id="L164">        jScrollPane1 = new javax.swing.JScrollPane();</span>
<span class="nc" id="L165">        jEditorPane1 = new javax.swing.JEditorPane();</span>

<span class="nc" id="L167">        setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L169">        jPanel1.setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L171">        jPanel3.setMaximumSize(new java.awt.Dimension(100, 35));</span>
<span class="nc" id="L172">        jPanel3.setMinimumSize(new java.awt.Dimension(100, 35));</span>
<span class="nc" id="L173">        jPanel3.setPreferredSize(new java.awt.Dimension(100, 30));</span>
<span class="nc" id="L174">        jPanel3.setLayout(new java.awt.GridBagLayout());</span>

<span class="nc" id="L176">        sendEmotionButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/images/smile.png&quot;))); // NOI18N</span>
<span class="nc" id="L177">        sendEmotionButton.setToolTipText(&quot;Add Emoticons&quot;);</span>
<span class="nc" id="L178">        sendEmotionButton.setBorderPainted(false);</span>
<span class="nc" id="L179">        sendEmotionButton.setContentAreaFilled(false);</span>
<span class="nc" id="L180">        sendEmotionButton.setFocusPainted(false);</span>
<span class="nc" id="L181">        sendEmotionButton.setPreferredSize(new java.awt.Dimension(25, 25));</span>
<span class="nc" id="L182">        sendEmotionButton.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L184">                sendEmotionButtonActionPerformed(evt);</span>
<span class="nc" id="L185">            }</span>
        });
<span class="nc" id="L187">        gridBagConstraints = new java.awt.GridBagConstraints();</span>
<span class="nc" id="L188">        gridBagConstraints.gridx = 0;</span>
<span class="nc" id="L189">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L190">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L191">        gridBagConstraints.insets = new java.awt.Insets(0, 10, 2, 0);</span>
<span class="nc" id="L192">        jPanel3.add(sendEmotionButton, gridBagConstraints);</span>

<span class="nc" id="L194">        setFontColorButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/images/font.jpg&quot;))); // NOI18N</span>
<span class="nc" id="L195">        setFontColorButton.setToolTipText(&quot;Change Font and Color&quot;);</span>
<span class="nc" id="L196">        setFontColorButton.setBorderPainted(false);</span>
<span class="nc" id="L197">        setFontColorButton.setContentAreaFilled(false);</span>
<span class="nc" id="L198">        setFontColorButton.setFocusPainted(false);</span>
<span class="nc" id="L199">        setFontColorButton.setPreferredSize(new java.awt.Dimension(25, 25));</span>
<span class="nc" id="L200">        setFontColorButton.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L202">                setFontColorButtonActionPerformed(evt);</span>
<span class="nc" id="L203">            }</span>
        });
<span class="nc" id="L205">        gridBagConstraints = new java.awt.GridBagConstraints();</span>
<span class="nc" id="L206">        gridBagConstraints.gridx = 1;</span>
<span class="nc" id="L207">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L208">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L209">        gridBagConstraints.insets = new java.awt.Insets(0, 5, 2, 0);</span>
<span class="nc" id="L210">        jPanel3.add(setFontColorButton, gridBagConstraints);</span>

<span class="nc" id="L212">        saveButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/images/save.jpg&quot;))); // NOI18N</span>
<span class="nc" id="L213">        saveButton.setToolTipText(&quot;Save Chat&quot;);</span>
<span class="nc" id="L214">        saveButton.setBorderPainted(false);</span>
<span class="nc" id="L215">        saveButton.setContentAreaFilled(false);</span>
<span class="nc" id="L216">        saveButton.setFocusPainted(false);</span>
<span class="nc" id="L217">        saveButton.setPreferredSize(new java.awt.Dimension(25, 25));</span>
<span class="nc" id="L218">        saveButton.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L220">                saveButtonActionPerformed(evt);</span>
<span class="nc" id="L221">            }</span>
        });
<span class="nc" id="L223">        jPanel3.add(saveButton, new java.awt.GridBagConstraints());</span>

<span class="nc" id="L225">        sendFileButton.setIcon(new javax.swing.ImageIcon(getClass().getResource(&quot;/images/send.jpg&quot;))); // NOI18N</span>
<span class="nc" id="L226">        sendFileButton.setToolTipText(&quot;Send File&quot;);</span>
<span class="nc" id="L227">        sendFileButton.setBorderPainted(false);</span>
<span class="nc" id="L228">        sendFileButton.setContentAreaFilled(false);</span>
<span class="nc" id="L229">        sendFileButton.setFocusPainted(false);</span>
<span class="nc" id="L230">        sendFileButton.setPreferredSize(new java.awt.Dimension(25, 25));</span>
<span class="nc" id="L231">        sendFileButton.addActionListener(new java.awt.event.ActionListener() {</span>
            public void actionPerformed(java.awt.event.ActionEvent evt) {
<span class="nc" id="L233">                sendFileButtonActionPerformed(evt);</span>
<span class="nc" id="L234">            }</span>
        });
<span class="nc" id="L236">        gridBagConstraints = new java.awt.GridBagConstraints();</span>
<span class="nc" id="L237">        gridBagConstraints.gridx = 2;</span>
<span class="nc" id="L238">        gridBagConstraints.gridy = 0;</span>
<span class="nc" id="L239">        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;</span>
<span class="nc" id="L240">        gridBagConstraints.insets = new java.awt.Insets(0, 5, 2, 93);</span>
<span class="nc" id="L241">        jPanel3.add(sendFileButton, gridBagConstraints);</span>

<span class="nc" id="L243">        jPanel1.add(jPanel3, java.awt.BorderLayout.NORTH);</span>

<span class="nc" id="L245">        jScrollPane2.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);</span>
<span class="nc" id="L246">        jScrollPane2.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</span>

<span class="nc" id="L248">        jEditorPane2.setDragEnabled(true);</span>
        //jEditorPane2.setLineWrap(true);
<span class="nc" id="L250">        jEditorPane2.setMaximumSize(new java.awt.Dimension(106, 50));</span>
<span class="nc" id="L251">        jEditorPane2.setMinimumSize(new java.awt.Dimension(106, 50));</span>
<span class="nc" id="L252">        jEditorPane2.setPreferredSize(new java.awt.Dimension(106, 50));</span>
<span class="nc" id="L253">        jEditorPane2.addKeyListener(new java.awt.event.KeyAdapter() {</span>
            public void keyReleased(java.awt.event.KeyEvent evt) {
<span class="nc" id="L255">                jEditorPane2KeyReleased(evt);</span>
<span class="nc" id="L256">            }</span>
        });
<span class="nc" id="L258">        jScrollPane2.setViewportView(jEditorPane2);</span>

<span class="nc" id="L260">        jPanel1.add(jScrollPane2, java.awt.BorderLayout.CENTER);</span>

<span class="nc" id="L262">        add(jPanel1, java.awt.BorderLayout.SOUTH);</span>

<span class="nc" id="L264">        jPanel2.setLayout(new java.awt.BorderLayout());</span>

<span class="nc" id="L266">        jScrollPane1.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);</span>
<span class="nc" id="L267">        jScrollPane1.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</span>

<span class="nc" id="L269">        jEditorPane1.setEditable(false);</span>
<span class="nc" id="L270">        editorHTMLKit=new HTMLEditorKit();</span>
<span class="nc" id="L271">        jEditorPane1.setEditorKit(editorHTMLKit);</span>
<span class="nc" id="L272">        jEditorPane1.setDoubleBuffered(true);</span>
<span class="nc" id="L273">        jEditorPane1.setMinimumSize(new java.awt.Dimension(106, 250));</span>
<span class="nc" id="L274">        jEditorPane1.setPreferredSize(new java.awt.Dimension(106, 250));</span>
<span class="nc" id="L275">        jEditorPane1.setRequestFocusEnabled(false);</span>
<span class="nc" id="L276">        jEditorPane1.addHyperlinkListener(new ActiveLink());</span>
<span class="nc" id="L277">        jScrollPane1.setViewportView(jEditorPane1);</span>

<span class="nc" id="L279">        jPanel2.add(jScrollPane1, java.awt.BorderLayout.CENTER);</span>

<span class="nc" id="L281">        add(jPanel2, java.awt.BorderLayout.CENTER);</span>
<span class="nc" id="L282">        copyMenuItem = new JMenuItem(&quot;Copy Selected&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/copy.png&quot;)));</span>
<span class="nc" id="L283">        copyMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
                try {
<span class="nc" id="L286">                    String selection = getJEditorPane2().getSelectedText();</span>
<span class="nc" id="L287">                    StringSelection data = new StringSelection(selection);</span>
<span class="nc" id="L288">                    Toolkit.getDefaultToolkit().getSystemClipboard().setContents(data, data);</span>
<span class="nc" id="L289">                } catch (Exception ex) {</span>
<span class="nc" id="L290">                    System.out.println(&quot;Copy error!&quot;);</span>
<span class="nc" id="L291">                }</span>
<span class="nc" id="L292">            }</span>
        });
<span class="nc" id="L294">        cutMenuItem = new JMenuItem(&quot;Cut Selected&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/cut.png&quot;)));</span>
<span class="nc" id="L295">        cutMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
                try {
<span class="nc" id="L298">                    String selection = getJEditorPane2().getSelectedText();</span>
<span class="nc" id="L299">                    StringSelection data = new StringSelection(selection);</span>
<span class="nc" id="L300">                    Toolkit.getDefaultToolkit().getSystemClipboard().setContents(data, data);</span>
<span class="nc" id="L301">                    cutText();</span>
<span class="nc" id="L302">                } catch (Exception ex) {</span>
<span class="nc" id="L303">                    System.out.println(&quot;Cut error!&quot;+ex.getMessage());</span>
<span class="nc" id="L304">                }</span>
<span class="nc" id="L305">            }</span>
        });
<span class="nc" id="L307">        pasteMenuItem = new JMenuItem(&quot;Paste&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/paste.png&quot;)));</span>
<span class="nc" id="L308">        pasteMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
                try {
<span class="nc" id="L311">					Transferable clipData=Toolkit.getDefaultToolkit().getSystemClipboard().getContents(Toolkit.getDefaultToolkit().getSystemClipboard());</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">					if(clipData!=null){</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">					    	if(clipData.isDataFlavorSupported(DataFlavor.stringFlavor)){</span>
<span class="nc" id="L314">			      				String s=(String)clipData.getTransferData(DataFlavor.stringFlavor);</span>
<span class="nc" id="L315">					      		getJEditorPane2().replaceSelection(s);</span>
<span class="nc" id="L316">					      	}else{</span>
<span class="nc" id="L317">					      		System.out.println(&quot;No thing to Paste!&quot;);</span>
							}
					}
<span class="nc" id="L320">                } catch (Exception ex) {</span>
<span class="nc" id="L321">                    System.out.println(&quot;Paste error!&quot;);</span>
<span class="nc" id="L322">                }</span>
<span class="nc" id="L323">            }</span>
        });
<span class="nc" id="L325">        selectAllMenuItem = new JMenuItem(&quot;Select All&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/selectAll.png&quot;)));</span>
<span class="nc" id="L326">        selectAllMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
                try {
<span class="nc" id="L329">                    getJEditorPane2().selectAll();</span>
<span class="nc" id="L330">                } catch (Exception ex) {</span>
<span class="nc" id="L331">                    System.out.println(&quot;select All error!&quot;);</span>
<span class="nc" id="L332">                }</span>
<span class="nc" id="L333">            }</span>
        });
<span class="nc" id="L335">        sendMenuItem = new JMenuItem(&quot;Send&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/submit.png&quot;)));</span>
<span class="nc" id="L336">        sendMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L338">                sendChat();</span>
<span class="nc" id="L339">            }</span>
        });
<span class="nc" id="L341">        clearChatMenuItem1=new JMenuItem(&quot;Clear&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/trash.png&quot;)));</span>
<span class="nc" id="L342">        clearChatMenuItem1.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L344">				jEditorPane2.setText(&quot;&quot;);</span>
<span class="nc" id="L345">            }</span>
        });
<span class="nc" id="L347">        editPopupMenu=new JPopupMenu();</span>
<span class="nc" id="L348">        editPopupMenu.add(copyMenuItem);</span>
<span class="nc" id="L349">        editPopupMenu.add(cutMenuItem);</span>
<span class="nc" id="L350">        editPopupMenu.add(pasteMenuItem);</span>
<span class="nc" id="L351">        editPopupMenu.add(clearChatMenuItem1);</span>
<span class="nc" id="L352">        editPopupMenu.add(selectAllMenuItem);</span>
<span class="nc" id="L353">        editPopupMenu.addSeparator();</span>
<span class="nc" id="L354">        editPopupMenu.add(sendMenuItem);</span>
<span class="nc" id="L355">        jEditorPane2.addMouseListener(new MouseAdapter() {</span>
            public void mouseClicked(java.awt.event.MouseEvent e) {
<span class="nc bnc" id="L357" title="All 2 branches missed.">                if (e.getButton() == MouseEvent.BUTTON3) {</span>
<span class="nc" id="L358">                    editPopupMenu.show(jEditorPane2, e.getX(), e.getY());</span>
                }
<span class="nc" id="L360">            }</span>
        });
<span class="nc" id="L362">        savePopupMenu=new JPopupMenu();</span>
<span class="nc" id="L363">        saveFormattedMenuItem=new JMenuItem(&quot;Save Chat Formated Text&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/save.png&quot;)));</span>
<span class="nc" id="L364">        saveUnFormattedMenuItem=new JMenuItem(&quot;Save Chat Text&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/save.png&quot;)));</span>
<span class="nc" id="L365">        saveFormattedMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L367">                openSaveChatDialog(true);</span>
<span class="nc" id="L368">            }</span>
        });
<span class="nc" id="L370">        saveUnFormattedMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L372">                openSaveChatDialog(false);</span>
<span class="nc" id="L373">            }</span>
        });
<span class="nc" id="L375">        copyFormattedMenuItem=new JMenuItem(&quot;Copy Chat Text&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/copy.png&quot;)));</span>
<span class="nc" id="L376">        copyFormattedMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
                try {
<span class="nc" id="L379">                    String selection = jEditorPane1.getDocument().getText(0,jEditorPane1.getDocument().getLength());</span>
<span class="nc" id="L380">                    StringSelection data = new StringSelection(selection);</span>
<span class="nc" id="L381">                    Toolkit.getDefaultToolkit().getSystemClipboard().setContents(data, data);</span>
<span class="nc" id="L382">                } catch (Exception ex) {</span>
<span class="nc" id="L383">                    System.out.println(&quot;Copy error!&quot;);</span>
<span class="nc" id="L384">                }</span>
<span class="nc" id="L385">            }</span>
        });
<span class="nc" id="L387">        clearChatMenuItem=new JMenuItem(&quot;Clear&quot;,new javax.swing.ImageIcon(getClass().getResource(&quot;/images/trash.png&quot;)));</span>
<span class="nc" id="L388">        clearChatMenuItem.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L390">				jEditorPane1.setText(&quot;&quot;);</span>
<span class="nc" id="L391">            }</span>
        });
<span class="nc" id="L393">        savePopupMenu.add(copyFormattedMenuItem);</span>
<span class="nc" id="L394">        savePopupMenu.add(clearChatMenuItem);</span>
<span class="nc" id="L395">        savePopupMenu.addSeparator();</span>
<span class="nc" id="L396">        savePopupMenu.add(saveUnFormattedMenuItem);</span>
<span class="nc" id="L397">        savePopupMenu.add(saveFormattedMenuItem);</span>
<span class="nc" id="L398">        jEditorPane1.addMouseListener(new MouseAdapter() {</span>
            public void mouseClicked(java.awt.event.MouseEvent e) {
<span class="nc bnc" id="L400" title="All 2 branches missed.">                if (e.getButton() == MouseEvent.BUTTON3) {</span>
<span class="nc" id="L401">                    savePopupMenu.show(jEditorPane1, e.getX(), e.getY());</span>
                }
<span class="nc" id="L403">            }</span>
        });
<span class="nc" id="L405">		sendEmotionButton.setFocusable(false);</span>
<span class="nc" id="L406">		setFontColorButton.setFocusable(false);</span>
<span class="nc" id="L407">		sendFileButton.setFocusable(false);</span>
<span class="nc" id="L408">		saveButton.setFocusable(false);</span>

<span class="nc" id="L410">    }// &lt;/editor-fold&gt;//GEN-END:initComponents</span>

    public void cutText() {
<span class="nc" id="L413">        int start = jEditorPane2.getSelectionStart();</span>
<span class="nc" id="L414">        int end = jEditorPane2.getSelectionEnd();</span>
<span class="nc bnc" id="L415" title="All 4 branches missed.">        if (start &gt;= 0 &amp;&amp; end &gt; 0) {</span>
<span class="nc" id="L416">            String content = jEditorPane2.getText();</span>
<span class="nc" id="L417">            jEditorPane2.setText(content.substring(0, start) + content.substring(end, content.length()));</span>
        }
<span class="nc" id="L419">    }</span>

    private String replaceLinks(String input, int startPos) {
<span class="nc" id="L422">        int start = input.indexOf(&quot;http://&quot;, startPos);</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">        if (start == -1) {</span>
<span class="nc" id="L424">            return input;</span>
        } else {
<span class="nc" id="L426">            int end = input.indexOf(' ', start);</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">            if (end == -1) {</span>
<span class="nc" id="L428">                end = input.length();</span>
            }
<span class="nc" id="L430">            String link = input.substring(start, end);</span>
<span class="nc" id="L431">            input = input.substring(0, start) + &quot;&lt;a href='&quot; + link + &quot;'&gt;&quot; + link + &quot;&lt;/a&gt;&quot; + input.substring(end, input.length());</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">            if (input.indexOf(&quot;http://&quot;, start + (2 * link.length()) + 14) == -1) {</span>
<span class="nc" id="L433">                return input;</span>
            } else {
<span class="nc" id="L435">                return replaceLinks(input, start + (2 * link.length()) + 14);</span>
            }
        }
    }

    private String replaceEmotionsAndLinks(String input) {
<span class="nc" id="L441">        input = replaceLinks(input, 0);</span>
<span class="nc" id="L442">        boolean loop = true;</span>
<span class="nc" id="L443">        int c = input.indexOf(':', 0);</span>
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (c == -1) {</span>
<span class="nc" id="L445">            loop = false;</span>
        }
<span class="nc bnc" id="L447" title="All 2 branches missed.">        while (loop) {</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">            if (c &lt; input.length()) {</span>
<span class="nc" id="L449">                String obj = (String) ChatClientApp.getEmotionImages().get(input.substring(c, c + 2));</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">                if (obj != null) {</span>
<span class="nc" id="L451">                    String newPart = &quot;&lt;img width=24 height=24 src='file://&quot; + chatApp.getPath() + &quot;images/&quot; + obj + &quot;'&gt;&quot;;</span>
<span class="nc" id="L452">                    input = input.substring(0, c) + newPart + input.substring(c + 2, input.length());</span>
                }
            }
<span class="nc bnc" id="L455" title="All 2 branches missed.">            if (c + 1 &lt; input.length()) {</span>
<span class="nc" id="L456">                c = input.indexOf(':', c + 1);</span>
            }
<span class="nc bnc" id="L458" title="All 2 branches missed.">            if (c == -1) {</span>
<span class="nc" id="L459">                loop = false;</span>
            }
        }
<span class="nc" id="L462">        loop = true;</span>
<span class="nc" id="L463">        c = input.indexOf(&quot;;)&quot;, 0);</span>
<span class="nc bnc" id="L464" title="All 2 branches missed.">        if (c == -1) {</span>
<span class="nc" id="L465">            loop = false;</span>
        }
<span class="nc bnc" id="L467" title="All 2 branches missed.">        while (loop) {</span>
<span class="nc bnc" id="L468" title="All 2 branches missed.">            if (c &lt; input.length()) {</span>
<span class="nc" id="L469">                String obj = (String) ChatClientApp.getEmotionImages().get(input.substring(c, c + 2));</span>
<span class="nc bnc" id="L470" title="All 2 branches missed.">                if (obj != null) {</span>
<span class="nc" id="L471">                    String newPart = &quot;&lt;img width=24 height=24 src='file://&quot; + chatApp.getPath() + &quot;images/&quot; + obj + &quot;'&gt;&quot;;</span>
<span class="nc" id="L472">                    input = input.substring(0, c) + newPart + input.substring(c + 2, input.length());</span>
                }
            }
<span class="nc bnc" id="L475" title="All 2 branches missed.">            if (c + 1 &lt; input.length()) {</span>
<span class="nc" id="L476">                c = input.indexOf(&quot;;)&quot;, c + 1);</span>
            }
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if (c == -1) {</span>
<span class="nc" id="L479">                loop = false;</span>
            }
        }
<span class="nc" id="L482">        return input;</span>
    }
    private void jEditorPane2KeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jEditorPane2KeyReleased
<span class="nc bnc" id="L485" title="All 6 branches missed.">        if (evt.getKeyCode() == 10 &amp;&amp; !evt.isShiftDown() &amp;&amp; jEditorPane2.getCaretPosition() &gt;= jEditorPane2.getDocument().getLength()) {</span>
<span class="nc" id="L486">            sendChat();</span>
        }
<span class="nc" id="L488">    }//GEN-LAST:event_jEditorPane2KeyReleased</span>
    public void sendChat() {
<span class="nc" id="L490">        String result = getJEditorPane2().getText();</span>
<span class="nc bnc" id="L491" title="All 4 branches missed.">        if (result != null &amp;&amp; !result.equals(&quot;&quot;)) {</span>
<span class="nc" id="L492">            addTextChatForMe(result);</span>
<span class="nc" id="L493">            TextMessage textMessage = new TextMessage();</span>
<span class="nc" id="L494">            textMessage.setMessage(result);</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">            if (getChat_type() == IConstant.USER_CHAT) {</span>
<span class="nc" id="L496">                textMessage.setToUserId(user.getId());</span>
<span class="nc" id="L497">                textMessage.setTargetType(IConstant.USER_CHAT);</span>
<span class="nc bnc" id="L498" title="All 2 branches missed.">            } else if (getChat_type() == IConstant.GROUP_CHAT) {</span>
<span class="nc" id="L499">                textMessage.setToUserId(group.getId());</span>
<span class="nc" id="L500">                textMessage.setTargetType(IConstant.GROUP_CHAT);</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">            } else if (getChat_type() == IConstant.ROOM_CHAT) {</span>
<span class="nc" id="L502">                textMessage.setToUserId(room.getId());</span>
<span class="nc" id="L503">                textMessage.setTargetType(IConstant.ROOM_CHAT);</span>
            }
<span class="nc" id="L505">            SendChatThread sendChatThread = new SendChatThread(this, textMessage, chatApp);</span>
<span class="nc" id="L506">            sendChatThread.start();</span>
        }
<span class="nc" id="L508">    }</span>

    public void addTextChat(TextMessage msg) {
        try {
<span class="nc" id="L512">            Document doc = jEditorPane1.getDocument();</span>
<span class="nc" id="L513">            EditorKit ek = jEditorPane1.getEditorKit();</span>
<span class="nc" id="L514">            ((HTMLEditorKit) ek).insertHTML((HTMLDocument) doc,</span>
<span class="nc" id="L515">                            doc.getEndPosition().getOffset() - 1,</span>
<span class="nc" id="L516">                            &quot;&lt;font face=&quot;+destFont.getFamily()+&quot; size=&quot;+destFont.getSize()+&quot;pt' color=&quot;+Integer.toHexString( destColor.getRGB() &amp; 0x00ffffff )+&quot;&gt;&quot;+destFontStyleOpen + msg.getTitle() + &quot;: &quot; + replaceEmotionsAndLinks(msg.getMessage()) + destFontStyleClose+&quot;&lt;/font&gt;&lt;br&gt;&quot;,</span>
                            /*int popDepth*/ 1,
                            /*int pushDepth*/ 0,
                            null /* javax.swing.text.html.HTML.Tag.CONTENT**/);
<span class="nc" id="L520">        } catch (Exception e) {</span>
            //e.printStackTrace();
<span class="nc" id="L522">        }</span>
<span class="nc" id="L523">        jEditorPane1.setCaretPosition(jEditorPane1.getDocument().getLength() - 1);</span>
<span class="nc" id="L524">    }</span>

    public void addTextChatForMe(String result) {
        try {
<span class="nc" id="L528">            Document doc = jEditorPane1.getDocument();</span>
<span class="nc" id="L529">            EditorKit ek = jEditorPane1.getEditorKit();</span>
<span class="nc" id="L530">            ((HTMLEditorKit) ek).insertHTML((HTMLDocument) doc,</span>
<span class="nc" id="L531">                            doc.getEndPosition().getOffset() - 1,</span>
<span class="nc" id="L532">                            &quot;&lt;font face=&quot;+sourceFont.getFamily()+&quot; size='&quot;+sourceFont.getSize()+&quot;pt' color=&quot;+Integer.toHexString( sourceColor.getRGB() &amp; 0x00ffffff )+&quot;&gt;&quot;+ sourceFontStyleOpen+ chatApp.getUser().getName() + &quot;: &quot; + replaceEmotionsAndLinks(result) + sourceFontStyleClose+ &quot;&lt;/font&gt;&lt;br&gt;&quot;,</span>
                            /*int popDepth*/ 1,
                            /*int pushDepth*/ 0,
                            null /* javax.swing.text.html.HTML.Tag.CONTENT**/);
<span class="nc" id="L536">        } catch (Exception e) {</span>
            //e.printStackTrace();
<span class="nc" id="L538">        }</span>
<span class="nc" id="L539">        jEditorPane1.setCaretPosition(jEditorPane1.getDocument().getLength() - 1);</span>
<span class="nc" id="L540">        getJEditorPane2().setText(&quot;&quot;);</span>
<span class="nc" id="L541">    }</span>

    public void addTextChat(String msg) {
        try {
<span class="nc" id="L545">            Document doc = jEditorPane1.getDocument();</span>
<span class="nc" id="L546">            EditorKit ek = jEditorPane1.getEditorKit();</span>
<span class="nc" id="L547">            ((HTMLEditorKit) ek).insertHTML((HTMLDocument) doc,</span>
<span class="nc" id="L548">                            doc.getEndPosition().getOffset() - 1,</span>
<span class="nc" id="L549">                            &quot;&lt;font face=&quot;+destFont.getFamily()+&quot; size='&quot;+destFont.getSize()+&quot;pt' color=&quot;+Integer.toHexString( destColor.getRGB() &amp; 0x00ffffff )+&quot;&gt;&quot; + destFontStyleOpen+ msg +destFontStyleClose+ &quot;&lt;/font&gt;&lt;br&gt;&quot;,</span>
                            /*int popDepth*/ 1,
                            /*int pushDepth*/ 0,
                            null /* javax.swing.text.html.HTML.Tag.CONTENT**/);
<span class="nc" id="L553">        } catch (Exception e) {</span>
            //e.printStackTrace();
<span class="nc" id="L555">        }</span>
<span class="nc" id="L556">        jEditorPane1.setCaretPosition(jEditorPane1.getDocument().getLength() - 1);</span>
<span class="nc" id="L557">    }</span>

    public void saveBinaryFile(BinaryMessage msg) {
        try {
<span class="nc" id="L561">            Document doc = jEditorPane1.getDocument();</span>
<span class="nc" id="L562">            EditorKit ek = jEditorPane1.getEditorKit();</span>
<span class="nc" id="L563">            ((HTMLEditorKit) ek).insertHTML((HTMLDocument) doc,</span>
<span class="nc" id="L564">                            doc.getEndPosition().getOffset() - 1,</span>
<span class="nc" id="L565">                            &quot;&lt;font face=&quot;+destFont.getFamily()+&quot; size='&quot;+destFont.getSize()+&quot;pt' color=&quot;+Integer.toHexString( destColor.getRGB() &amp; 0x00ffffff )+&quot;&gt;&quot; + destFontStyleOpen+ msg.getTitle() + &quot;: &quot; + msg.getDesc() + destFontStyleClose+&quot;&lt;/font&gt;&quot;,</span>
                            /*int popDepth*/ 1,
                            /*int pushDepth*/ 0,
                            null /* javax.swing.text.html.HTML.Tag.CONTENT**/);
<span class="nc" id="L569">        } catch (Exception e) {</span>
            //e.printStackTrace();
<span class="nc" id="L571">        }</span>
<span class="nc" id="L572">        jEditorPane1.setCaretPosition(jEditorPane1.getDocument().getLength() - 1);</span>
<span class="nc" id="L573">    }</span>

    public User getUser() {
<span class="nc" id="L576">        return user;</span>
    }

    public Group getGroup() {
<span class="nc" id="L580">        return group;</span>
    }

    public Room getRoom() {
<span class="nc" id="L584">        return room;</span>
    }

    public int getChat_type() {
<span class="nc" id="L588">        return chat_type;</span>
    }

    public javax.swing.JEditorPane getJEditorPane2() {
<span class="nc" id="L592">        return jEditorPane2;</span>
    }

    public javax.swing.JEditorPane getJEditorPane1() {
<span class="nc" id="L596">        return jEditorPane1;</span>
    }
    private void saveButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveButtonActionPerformed
<span class="nc" id="L599">        openSaveChatDialog(true);</span>
<span class="nc" id="L600">    }//GEN-LAST:event_saveButtonActionPerformed</span>
    public void openSendFileDialog() {
<span class="nc" id="L602">        int resultValue = chatApp.getJfm().showOpenDialog(this);</span>
<span class="nc bnc" id="L603" title="All 2 branches missed.">        if (resultValue == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L604">            File temp = chatApp.getJfm().getSelectedFile();</span>
<span class="nc" id="L605">            sendFileInit(temp);</span>
        }
<span class="nc" id="L607">    }</span>

    private void openSaveChatDialog(boolean formatted) {
<span class="nc" id="L610">        chatApp.getJfm().setDialogTitle(&quot;Select File To Save Chat Log In&quot;);</span>
<span class="nc" id="L611">        int resultValue = chatApp.getJfm().showSaveDialog(this);</span>
<span class="nc" id="L612">        chatApp.getJfm().setDialogTitle(&quot;Select File To Send&quot;);</span>
<span class="nc bnc" id="L613" title="All 2 branches missed.">        if (resultValue == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L614">            File temp = chatApp.getJfm().getSelectedFile();</span>
<span class="nc" id="L615">            saveChatInFile(temp, formatted);</span>
        }
<span class="nc" id="L617">    }</span>

    private void saveChatInFile(File temp, boolean formatted) {
<span class="nc" id="L620">        FileOutputStream fos = null;</span>
        try {
<span class="nc bnc" id="L622" title="All 2 branches missed.">            if(temp.exists()){</span>
<span class="nc" id="L623">                int n = JOptionPane.showConfirmDialog(this, &quot;File Already Exist!, Overwrite it?&quot;, &quot;Warning&quot;, JOptionPane.OK_CANCEL_OPTION);</span>
<span class="nc bnc" id="L624" title="All 2 branches missed.">                if (n != JOptionPane.OK_OPTION) {</span>
<span class="nc" id="L625">                    return;</span>
                }
            }
<span class="nc" id="L628">            temp.createNewFile();</span>
<span class="nc" id="L629">            fos = new FileOutputStream(temp);</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">            if (formatted) {</span>
<span class="nc" id="L631">                fos.write(jEditorPane1.getText().getBytes());</span>
            } else {
<span class="nc" id="L633">                fos.write(jEditorPane1.getDocument().getText(0, jEditorPane1.getDocument().getLength()).getBytes());</span>
            }
<span class="nc" id="L635">            JOptionPane.showMessageDialog(this, &quot;Chat Log Saved Successfully!&quot;, &quot;Chat Log Saving&quot;, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L636">        } catch (Exception ex) {</span>
<span class="nc" id="L637">            ex.printStackTrace();</span>
<span class="nc" id="L638">            JOptionPane.showMessageDialog(this, &quot;Failed To Save Chat Log!&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE, chatApp.getErrorIcon());</span>
        } finally {
            try {
<span class="nc bnc" id="L641" title="All 2 branches missed.">                if (fos != null) {</span>
<span class="nc" id="L642">                    fos.close();</span>
                }
<span class="nc" id="L644">            } catch (Exception e) {</span>
<span class="nc" id="L645">                e.printStackTrace();</span>
<span class="nc" id="L646">            }</span>
        }
<span class="nc" id="L648">    }</span>

    public void sendFileInit(File temp) {
<span class="nc bnc" id="L651" title="All 2 branches missed.">        if (chat_type == IConstant.USER_CHAT) {</span>
<span class="nc" id="L652">            BinaryMessage bm = new BinaryMessage();</span>
<span class="nc" id="L653">            bm.setToUserId(user.getId());</span>
<span class="nc" id="L654">            bm.setTargetType(IConstant.USER_CHAT);</span>
<span class="nc" id="L655">            bm.setDesc(temp.getName());</span>
<span class="nc" id="L656">            addTextChatForMe(&quot;Request sending the file [&quot; + temp.getName() + &quot;], sent.&quot;);</span>
<span class="nc" id="L657">            SendFileThread sendFileThread = new SendFileThread(temp, this, bm, chatApp);</span>
<span class="nc" id="L658">            sendFileThread.start();</span>
<span class="nc bnc" id="L659" title="All 2 branches missed.">        } else if (chat_type == IConstant.GROUP_CHAT) {</span>
<span class="nc" id="L660">            Group targetGroup = null;</span>
<span class="nc" id="L661">            for (int l = 0; l &lt;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">                    chatApp.getGroups().size(); l++) {</span>
<span class="nc bnc" id="L663" title="All 2 branches missed.">                if (chatApp.getGroups().get(l).getId() == group.getId()) {</span>
<span class="nc" id="L664">                    targetGroup = chatApp.getGroups().get(l);</span>
<span class="nc" id="L665">                    break;</span>
                }
            }
<span class="nc bnc" id="L668" title="All 2 branches missed.">            if (targetGroup != null) {</span>
<span class="nc" id="L669">                for (int i = 0; i &lt;</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">                        targetGroup.getUsers().size(); i++) {</span>
<span class="nc bnc" id="L671" title="All 2 branches missed.">                    if (((User) targetGroup.getUsers().get(i)).getId() != chatApp.getUser().getId()) {</span>
<span class="nc" id="L672">                        User childUser = (User) targetGroup.getUsers().get(i);</span>
<span class="nc" id="L673">                        BinaryMessage bm = new BinaryMessage();</span>
<span class="nc" id="L674">                        bm.setToUserId(childUser.getId());</span>
<span class="nc" id="L675">                        bm.setTargetType(IConstant.USER_CHAT);</span>
<span class="nc" id="L676">                        bm.setDesc(temp.getName());</span>
<span class="nc" id="L677">                        addTextChatForMe(&quot;Request sending the file [&quot; + temp.getName() + &quot;] sent.&quot;);</span>
<span class="nc" id="L678">                        SendFileThread sendFileThread = new SendFileThread(temp, this, bm, chatApp);</span>
<span class="nc" id="L679">                        sendFileThread.start();</span>
                    }
                }
            }
        }
        //no send file to Room
<span class="nc" id="L685">    }</span>
    private void setFontColorButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_setFontColorButtonActionPerformed
<span class="nc" id="L687">        chatApp.getFontFrame().setLocationRelativeTo(setFontColorButton);</span>
<span class="nc" id="L688">        chatApp.getFontFrame().setVisible(true);</span>
<span class="nc" id="L689">        initSettings(false);</span>
<span class="nc" id="L690">    }//GEN-LAST:event_setFontColorButtonActionPerformed</span>

    private void sendEmotionButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sendEmotionButtonActionPerformed
<span class="nc" id="L693">        chatApp.getEmotionPanel().setChatWindowPanel(this);</span>
<span class="nc" id="L694">        chatApp.getEmotionFrame().setLocationRelativeTo(sendEmotionButton);</span>
<span class="nc" id="L695">        chatApp.getEmotionFrame().setVisible(true);</span>
<span class="nc" id="L696">    }//GEN-LAST:event_sendEmotionButtonActionPerformed</span>

    private void sendFileButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_sendFileButtonActionPerformed
<span class="nc" id="L699">        openSendFileDialog();</span>
<span class="nc" id="L700">    }//GEN-LAST:event_sendFileButtonActionPerformed</span>
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JEditorPane jEditorPane1;
    private javax.swing.JEditorPane jEditorPane2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JButton saveButton;
    private javax.swing.JButton sendEmotionButton;
    private javax.swing.JButton sendFileButton;
    private javax.swing.JButton setFontColorButton;
    // End of variables declaration//GEN-END:variables

<span class="nc" id="L715">    class ActiveLink implements HyperlinkListener {</span>

        public void hyperlinkUpdate(HyperlinkEvent e) {
<span class="nc bnc" id="L718" title="All 2 branches missed.">            if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED) {</span>
<span class="nc" id="L719">                JEditorPane pane = (JEditorPane) e.getSource();</span>
<span class="nc bnc" id="L720" title="All 2 branches missed.">                if (e instanceof HTMLFrameHyperlinkEvent) {</span>
<span class="nc" id="L721">                    HTMLFrameHyperlinkEvent evt = (HTMLFrameHyperlinkEvent) e;</span>
<span class="nc" id="L722">                    HTMLDocument doc = (HTMLDocument) pane.getDocument();</span>
<span class="nc" id="L723">                    doc.processHTMLFrameHyperlinkEvent(evt);</span>
<span class="nc" id="L724">                } else {</span>
<span class="nc" id="L725">                    setCursor(new Cursor(Cursor.WAIT_CURSOR));</span>
<span class="nc" id="L726">                    Runtime rm = Runtime.getRuntime();</span>
<span class="nc" id="L727">                    String temp = &quot;&quot;;</span>
<span class="nc bnc" id="L728" title="All 2 branches missed.">                    if (e.getDescription().toString().indexOf('@') != -1) {</span>
<span class="nc" id="L729">                        temp = &quot;mailto:&quot; + (e.getDescription().toString());</span>
<span class="nc" id="L730">                        Desktop desktop = null;</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">                        if (Desktop.isDesktopSupported()) {</span>
                            try {
<span class="nc" id="L733">                                desktop = Desktop.getDesktop();</span>
<span class="nc" id="L734">                                desktop.mail(new URI(temp));</span>
<span class="nc" id="L735">                            } catch (Exception ex) {</span>
<span class="nc" id="L736">                            }</span>
                        }
<span class="nc" id="L738">                    } else {</span>
<span class="nc" id="L739">                        temp = e.getDescription().toString();</span>
<span class="nc" id="L740">                        Desktop desktop = null;</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">                        if (Desktop.isDesktopSupported()) {</span>
<span class="nc" id="L742">                            desktop = Desktop.getDesktop();</span>
                            try {
<span class="nc" id="L744">                                desktop = Desktop.getDesktop();</span>
<span class="nc" id="L745">                                desktop.browse(new URI(temp));</span>
<span class="nc" id="L746">                            } catch (Exception ex) {</span>
<span class="nc" id="L747">                            }</span>
                        }
                    }
<span class="nc" id="L750">                    setCursor(new Cursor(Cursor.DEFAULT_CURSOR));</span>
                }
<span class="nc bnc" id="L752" title="All 2 branches missed.">            } else if (e.getEventType() == HyperlinkEvent.EventType.ENTERED) {</span>
<span class="nc" id="L753">                setCursor(new Cursor(Cursor.HAND_CURSOR));</span>
<span class="nc bnc" id="L754" title="All 2 branches missed.">            } else if (e.getEventType() == HyperlinkEvent.EventType.EXITED) {</span>
<span class="nc" id="L755">                setCursor(new Cursor(Cursor.DEFAULT_CURSOR));</span>
            }
<span class="nc" id="L757">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>