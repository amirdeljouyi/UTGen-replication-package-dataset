<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StringEncoder64.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">73_fim1</a> &gt; <a href="index.source.html" class="el_package">osa.ora.server.utils</a> &gt; <span class="el_source">StringEncoder64.java</span></div><h1>StringEncoder64.java</h1><pre class="source lang-java linenums">package osa.ora.server.utils;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.UnsupportedEncodingException;

<span class="nc" id="L8">public class StringEncoder64 {</span>
    
<span class="nc" id="L10">    static final char[] charTab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;.toCharArray();</span>
    
    public static String encodeStringUTF8(String data){
        try {
<span class="nc" id="L14">            return encode(data.getBytes(&quot;UTF8&quot;));</span>
<span class="nc" id="L15">        } catch (UnsupportedEncodingException ex) {</span>
<span class="nc" id="L16">            ex.printStackTrace();</span>
        }
<span class="nc" id="L18">        return null;</span>
    }
    public static String decodeStringUTF8(String data){
        try {
<span class="nc" id="L22">            return new String(decode(data),&quot;UTF8&quot;);</span>
<span class="nc" id="L23">        } catch (UnsupportedEncodingException ex) {</span>
<span class="nc" id="L24">            ex.printStackTrace();</span>
        }
<span class="nc" id="L26">        return null;</span>
    }
    public static String encode(byte[] data) {
<span class="nc" id="L29">        ByteArrayOutputStream byteArrayOutputStream= new ByteArrayOutputStream();</span>
<span class="nc" id="L30">        String ret = null;</span>
<span class="nc bnc" id="L31" title="All 2 branches missed.">        if (encode(data, 0, data.length, byteArrayOutputStream))</span>
<span class="nc" id="L32">            ret = new String(byteArrayOutputStream.toByteArray());</span>
<span class="nc" id="L33">        return ret;</span>
    }
    
    public static String encode(byte[]data,int start,int len){
<span class="nc" id="L37">        StringBuffer buffer=null;</span>
<span class="nc" id="L38">        return encode(data,start,len,buffer).toString();</span>
    }
    
    /**
     * Encodes the part of the given byte array denoted by start and len to the StringEncoder64 format. The encoded data is
     * appended to the given StringBuffer. If no StringBuffer is given, a new one is created automatically. The
     * StringBuffer is the return value of this method.
     */
    
    public static StringBuffer encode(byte[] data, int start, int len, StringBuffer buf) {
        
<span class="nc bnc" id="L49" title="All 2 branches missed.">        if (buf == null)</span>
<span class="nc" id="L50">            buf = new StringBuffer(data.length * 3 / 2);</span>
        
<span class="nc" id="L52">        int end = len - 3;</span>
<span class="nc" id="L53">        int i = start;</span>
        // int n = 0;
        
<span class="nc bnc" id="L56" title="All 2 branches missed.">        while (i &lt;= end) {</span>
<span class="nc" id="L57">            int d = ((((int) data[i]) &amp; 0x0ff) &lt;&lt; 16) | ((((int) data[i + 1]) &amp; 0x0ff) &lt;&lt; 8) | (((int) data[i + 2]) &amp; 0x0ff);</span>
            
<span class="nc" id="L59">            buf.append(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L60">            buf.append(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L61">            buf.append(charTab[(d &gt;&gt; 6) &amp; 63]);</span>
<span class="nc" id="L62">            buf.append(charTab[d &amp; 63]);</span>
            
<span class="nc" id="L64">            i += 3;</span>
            
            // if (n++ &gt;= 14) {
            // n = 0;
            // buf.append(&quot;\r\n&quot;);
            // }
<span class="nc" id="L70">        }</span>
        
<span class="nc bnc" id="L72" title="All 2 branches missed.">        if (i == start + len - 2) {</span>
<span class="nc" id="L73">            int d = ((((int) data[i]) &amp; 0x0ff) &lt;&lt; 16) | ((((int) data[i + 1]) &amp; 255) &lt;&lt; 8);</span>
            
<span class="nc" id="L75">            buf.append(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L76">            buf.append(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L77">            buf.append(charTab[(d &gt;&gt; 6) &amp; 63]);</span>
<span class="nc" id="L78">            buf.append(&quot;=&quot;);</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">        } else if (i == start + len - 1) {</span>
<span class="nc" id="L80">            int d = (((int) data[i]) &amp; 0x0ff) &lt;&lt; 16;</span>
            
<span class="nc" id="L82">            buf.append(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L83">            buf.append(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L84">            buf.append(&quot;==&quot;);</span>
        }
        
<span class="nc" id="L87">        return buf;</span>
    }
    /**
     * Encodes the part of the given byte array denoted by start and len to the StringEncoder64 format. The encoded data is
     * written to the given {@link OutputStream}. If no OutputStream is given, a {@link NullPointerException} is thrown.
     *
     * @return true if succeded to encode, false otherwise
     * @throws NullPointerException if outputStream is null.
     */
    
    public static boolean encode(byte[] data, int start, int len, OutputStream outputStream) {
        
        try {
<span class="nc bnc" id="L100" title="All 2 branches missed.">            if (outputStream == null)</span>
<span class="nc" id="L101">                throw new NullPointerException();</span>
            
<span class="nc" id="L103">            int end = len - 3;</span>
<span class="nc" id="L104">            int i = start;</span>
<span class="nc" id="L105">            int n = 0;</span>
            
<span class="nc bnc" id="L107" title="All 2 branches missed.">            while (i &lt;= end) {</span>
<span class="nc" id="L108">                int d = ((((int) data[i]) &amp; 0x0ff) &lt;&lt; 16) | ((((int) data[i + 1]) &amp; 0x0ff) &lt;&lt; 8) | (((int) data[i + 2]) &amp; 0x0ff);</span>
                
<span class="nc" id="L110">                outputStream.write(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L111">                outputStream.write(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L112">                outputStream.write(charTab[(d &gt;&gt; 6) &amp; 63]);</span>
<span class="nc" id="L113">                outputStream.write(charTab[d &amp; 63]);</span>
                
<span class="nc" id="L115">                i += 3;</span>
                
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (n++ &gt;= 14) {</span>
<span class="nc" id="L118">                    n = 0;</span>
<span class="nc" id="L119">                    outputStream.write('\r');</span>
<span class="nc" id="L120">                    outputStream.write('\n');</span>
                }
<span class="nc" id="L122">            }</span>
            
<span class="nc bnc" id="L124" title="All 2 branches missed.">            if (i == start + len - 2) {</span>
<span class="nc" id="L125">                int d = ((((int) data[i]) &amp; 0x0ff) &lt;&lt; 16) | ((((int) data[i + 1]) &amp; 255) &lt;&lt; 8);</span>
                
<span class="nc" id="L127">                outputStream.write(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L128">                outputStream.write(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L129">                outputStream.write(charTab[(d &gt;&gt; 6) &amp; 63]);</span>
<span class="nc" id="L130">                outputStream.write('=');</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">            } else if (i == start + len - 1) {</span>
<span class="nc" id="L132">                int d = (((int) data[i]) &amp; 0x0ff) &lt;&lt; 16;</span>
                
<span class="nc" id="L134">                outputStream.write(charTab[(d &gt;&gt; 18) &amp; 63]);</span>
<span class="nc" id="L135">                outputStream.write(charTab[(d &gt;&gt; 12) &amp; 63]);</span>
<span class="nc" id="L136">                outputStream.write('=');</span>
<span class="nc" id="L137">                outputStream.write('=');</span>
            }
<span class="nc" id="L139">        } catch (IOException e) {</span>
<span class="nc" id="L140">            e.printStackTrace();</span>
<span class="nc" id="L141">            return false;</span>
<span class="nc" id="L142">        }</span>
        
<span class="nc" id="L144">        return true;</span>
    }
    
    static int decode(char c) {
<span class="nc bnc" id="L148" title="All 4 branches missed.">        if (c &gt;= 'A' &amp;&amp; c &lt;= 'Z')</span>
<span class="nc" id="L149">            return ((int) c) - 65;</span>
<span class="nc bnc" id="L150" title="All 4 branches missed.">        else if (c &gt;= 'a' &amp;&amp; c &lt;= 'z')</span>
<span class="nc" id="L151">            return ((int) c) - 97 + 26;</span>
<span class="nc bnc" id="L152" title="All 4 branches missed.">        else if (c &gt;= '0' &amp;&amp; c &lt;= '9')</span>
<span class="nc" id="L153">            return ((int) c) - 48 + 26 + 26;</span>
        else
<span class="nc bnc" id="L155" title="All 4 branches missed.">            switch (c) {</span>
                case '+':
<span class="nc" id="L157">                    return 62;</span>
                case '/':
<span class="nc" id="L159">                    return 63;</span>
                case '=':
<span class="nc" id="L161">                    return 0;</span>
                default:
<span class="nc" id="L163">                    System.out.println(&quot;C=&quot;+c);</span>
<span class="nc" id="L164">                    throw new RuntimeException(&quot;unexpected code: &quot; + c);</span>
            }
    }
    
    /**
     * Decodes the given StringEncoder64 encoded String to a new byte array. The byte array holding the decoded data is returned.
     */
    
    public static byte[] decode(String s) {
        //System.out.println(&quot;decode String s=&quot;+s);
<span class="nc" id="L174">        ByteArrayOutputStream bos = new ByteArrayOutputStream();</span>
        try {
<span class="nc" id="L176">            decode(s, bos);</span>
<span class="nc" id="L177">        } catch (IOException e) {</span>
<span class="nc" id="L178">            throw new RuntimeException();</span>
<span class="nc" id="L179">        }</span>
<span class="nc" id="L180">        return bos.toByteArray();</span>
    }
    
    public static void decode(String s, OutputStream os) throws IOException {
<span class="nc" id="L184">        int i = 0;</span>
        
<span class="nc" id="L186">        int len = s.length();</span>
        
        while (true) {
<span class="nc bnc" id="L189" title="All 4 branches missed.">            while (i &lt; len &amp;&amp; s.charAt(i) &lt;= ' ')</span>
<span class="nc" id="L190">                i++;</span>
            
<span class="nc bnc" id="L192" title="All 2 branches missed.">            if (i+3 &gt;= len)</span>
<span class="nc" id="L193">                break;</span>
            
<span class="nc" id="L195">            int tri = (decode(s.charAt(i)) &lt;&lt; 18) + (decode(s.charAt(i + 1)) &lt;&lt; 12) + (decode(s.charAt(i + 2)) &lt;&lt; 6)</span>
<span class="nc" id="L196">            + (decode(s.charAt(i + 3)));</span>
            
<span class="nc" id="L198">            os.write((tri &gt;&gt; 16) &amp; 255);</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (s.charAt(i + 2) == '=')</span>
<span class="nc" id="L200">                break;</span>
<span class="nc" id="L201">            os.write((tri &gt;&gt; 8) &amp; 255);</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">            if (s.charAt(i + 3) == '=')</span>
<span class="nc" id="L203">                break;</span>
<span class="nc" id="L204">            os.write(tri &amp; 255);</span>
            
<span class="nc" id="L206">            i += 4;</span>
<span class="nc" id="L207">        }</span>
<span class="nc" id="L208">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>