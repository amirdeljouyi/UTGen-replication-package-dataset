<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JCLO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">94_jclo</a> &gt; <a href="index.source.html" class="el_package">edu.mscd.cs.jclo</a> &gt; <span class="el_source">JCLO.java</span></div><h1>JCLO.java</h1><pre class="source lang-java linenums">package edu.mscd.cs.jclo;

import java.lang.reflect.Field;
import java.lang.reflect.Array;
import java.lang.reflect.Modifier;

/**
 * This class is used to parse command-line arguments based on a the
 * variables with an object.  Each variable in the class specifies a
 * command-line argument that can be accepted; the name of the variable
 * becomes the name of the command-line argument.  As Java does not allow
 * dashes '-' in variables, use two underscores '__' if you want a dash in
 * an argument.  Also, if you want to have a numeric argument (e.g.: '-1'),
 * start the variable name with a single underscore.  JCLO uses reflection
 * to determine the type of each variable in the passed object and sets the
 * values in the object passed to it via parsing the command line.  If you
 * include a String array named &quot;additional&quot;, all non-dashed arguments will
 * be placed in it.
 *
 * @author		Steve Beaty (beatys@mscd.edu) @version	$Id:
 * JCLO.java,v 1.5 2007/11/01 16:43:12 beaty Exp beaty $
 */

public class JCLO
{
    private Field fields[];
    private Object object;
    private boolean doubleDashes;
    private boolean hasEquals;
<span class="nc" id="L30">    private String prefix = &quot;&quot;;</span>
    private String aliases[][];

    /**
     *	A constructor that takes the Object that contains the variables
     *	acceptable on a command line.  Call parse (String) to do the actual
     *	parsing.
     *
     *	@param	object	where the variables/arguments are
     */
    public JCLO (Object object)
    {
<span class="nc" id="L42">        this ((String) null, object, null);</span>
<span class="nc" id="L43">    }</span>

    public JCLO (Object object, String[][] aliases)
    {
<span class="nc" id="L47">        this ((String) null, object, aliases);</span>
<span class="nc" id="L48">    }</span>

    public JCLO (String prefix, Object object)
    {
<span class="nc" id="L52">        this (prefix, object, null);</span>
<span class="nc" id="L53">    }</span>

    /**
     *	A constructor that takes an Object, a prefix, and a boolean that
     *	specifies whether to accept single or double dashes; call parse
     *	(String) to do the actual parsing.
     *
     *	@param	object	where the variables/arguments are
     *	@param	prefix	the String CLO's start with, if any
     */
    public JCLO (String prefix, Object object, String[][] aliases)
<span class="nc" id="L64">    {</span>
<span class="nc" id="L65">	this.object = object;</span>
<span class="nc" id="L66">	this.prefix = prefix;</span>
<span class="nc" id="L67">	this.aliases = aliases;</span>

<span class="nc" id="L69">	fields = object.getClass().getDeclaredFields();</span>

<span class="nc bnc" id="L71" title="All 2 branches missed.">	for (int i = 0; i &lt; fields.length; i++)</span>
	{
<span class="nc" id="L73">	    fields[i].setAccessible (true);</span>
	}
<span class="nc" id="L75">    }</span>


    /**
     *	Just a simple method to put the try/catch in one place.
     *
     *	@param	f	the Field to get the value of
     *	@return		the Object with the value
     */
    private Object getObject (Field f)
    {
	try
	{
<span class="nc" id="L88">	    return (f.get (object));</span>
	}
<span class="nc" id="L90">	catch (java.lang.IllegalAccessException iae)</span>
	{
<span class="nc" id="L92">	    iae.printStackTrace();</span>
<span class="nc" id="L93">	    System.exit (1);</span>
	}

<span class="nc" id="L96">	return (null);</span>
    }

    private Field getField (String key)
    {
<span class="nc" id="L101">	Field f = null;</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">	if (prefix != null)</span>
<span class="nc" id="L103">	    key = prefix + key;</span>

<span class="nc bnc" id="L105" title="All 2 branches missed.">	for (int i = 0; i &lt; fields.length; i++)</span>
	{
<span class="nc" id="L107">	    String name = fields[i].getName();</span>

<span class="nc bnc" id="L109" title="All 2 branches missed.">	    if (name.equals (key))</span>
<span class="nc" id="L110">	        return (fields[i]);</span>
	}

<span class="nc" id="L113">	return (null);</span>
    }

    /**
     *	Get the current value of the variable in the object
     *
     *	@param	key	the variable name
     *	@return		an Object with the value
     */
    public Object getValue (String key)
    {
<span class="nc" id="L124">	Field f = getField (key);</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">	if (f == null)</span>
	{
<span class="nc" id="L128">	    System.out.println (&quot;Field not found: &quot; + key);</span>
<span class="nc" id="L129">	    return (null);</span>
	}

<span class="nc" id="L132">	return (getObject (f));</span>
    }

    /**
     *	Just a simple method to put the try/catch in one place.
     *
     *	@param	f	the Field to set the value of
     *	@param	o	the Object with the value
     */
    private void setObject (Field f, Object o)
    {
	try
	{
<span class="nc" id="L145">	    f.set (object, o);</span>
	}
<span class="nc" id="L147">	catch (java.lang.IllegalAccessException iae)</span>
	{
<span class="nc" id="L149">	    iae.printStackTrace();</span>
<span class="nc" id="L150">	}</span>
<span class="nc" id="L151">    }</span>

    private String getArrayType (Class type)
    {
<span class="nc" id="L155">	return (type.getComponentType().toString().replaceFirst</span>
<span class="nc" id="L156">	    (&quot;class.*\\.&quot;, &quot;&quot;));</span>
    }

    /**
     *	An external representation of the object
     *
     *	@return		a formatted version of this object
     */
    public String toString()
    {
<span class="nc" id="L166">	String r = &quot;&quot;;</span>
<span class="nc" id="L167">	boolean first = true;</span>

<span class="nc bnc" id="L169" title="All 2 branches missed.">	for (int i = 0; i &lt; fields.length; i++)</span>
	{
<span class="nc" id="L171">	    Field field = fields[i];</span>
<span class="nc" id="L172">	    String key = field.getName();</span>
<span class="nc" id="L173">	    Class type = field.getType();</span>
<span class="nc" id="L174">	    Object object = getObject (field);</span>

<span class="nc bnc" id="L176" title="All 2 branches missed.">	    if (!first) r += &quot;\n&quot;;</span>
<span class="nc" id="L177">	    first = false;</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">	    if (type.isArray())</span>
	    {
<span class="nc" id="L181">		r += getArrayType (type) + &quot;[]&quot; + &quot;: &quot; + key + &quot; = &quot;;</span>
<span class="nc" id="L182">	        r += java.util.Arrays.toString ((Object []) object);</span>
	    }
	    else
	    {
<span class="nc" id="L186">		r += type.toString().replaceFirst (&quot;class java.lang.&quot;, &quot;&quot;) +</span>
		    &quot;: &quot; + key + &quot; = &quot; + object;
	    }
	}

<span class="nc" id="L191">	return (r);</span>
    }

    private String getUsageType (Class type)
    {
<span class="nc bnc" id="L196" title="All 2 branches missed.">	if (type.getName().equals (&quot;boolean&quot;))</span>
	{
<span class="nc bnc" id="L198" title="All 2 branches missed.">	   return (doubleDashes ? &quot;[=boolean]&quot; : &quot;&quot;);</span>
	}
<span class="nc bnc" id="L200" title="All 2 branches missed.">	else if (type.isArray())</span>
	{
<span class="nc bnc" id="L202" title="All 2 branches missed.">	    return ((doubleDashes ? &quot;=&quot; : &quot; &quot;) + getArrayType (type) + &quot;...&quot;);</span>
	}
	else
	{
<span class="nc bnc" id="L206" title="All 2 branches missed.">	    return ((doubleDashes ? &quot;=&quot; : &quot; &quot; ) +</span>
<span class="nc" id="L207">	        type.getName().replaceFirst (&quot;java.lang.&quot;, &quot;&quot;));</span>
	}
    }
    
    /**
     * Create and usage message for the acceptable command line variables.
     *
     *	@return		a String that specifies acceptable options
     */
    public String usage()
    {
<span class="nc" id="L218">	boolean additional = false;</span>

<span class="nc" id="L220">	String a[] = new String[fields.length];</span>
<span class="nc" id="L221">	int count = 0;</span>

<span class="nc bnc" id="L223" title="All 2 branches missed.">	for (int i = 0; i &lt; fields.length; i++)</span>
	{
<span class="nc" id="L225">	    Field field = fields[i];</span>
<span class="nc" id="L226">	    String key = field.getName();</span>
<span class="nc" id="L227">	    Class type = field.getType();</span>

<span class="nc bnc" id="L229" title="All 2 branches missed.">	    if (key.equals (&quot;additional&quot;))</span>
<span class="nc" id="L230">		continue;</span>

<span class="nc bnc" id="L232" title="All 2 branches missed.">	    if (prefix != null)</span>
	    {
<span class="nc bnc" id="L234" title="All 2 branches missed.">	        if (! key.startsWith (prefix))</span>
<span class="nc" id="L235">		    continue;</span>
		else
<span class="nc" id="L237">		    key = key.replaceFirst (&quot;^&quot; + prefix, &quot;&quot;);</span>
	    }

<span class="nc bnc" id="L240" title="All 2 branches missed.">	    if (Modifier.isFinal (field.getModifiers()))</span>
<span class="nc" id="L241">	        continue;</span>

<span class="nc" id="L243">	    key = key.replaceFirst (&quot;^_([0-9])&quot;, &quot;$1&quot;);</span>
<span class="nc" id="L244">	    key = key.replaceAll (&quot;__&quot;, &quot;-&quot;);</span>
<span class="nc" id="L245">	    key = key.replaceAll (&quot;_\\$&quot;, &quot;.&quot;);</span>

<span class="nc bnc" id="L247" title="All 2 branches missed.">	    a[count++] = (doubleDashes ? &quot;--&quot; : &quot;-&quot;) + key +</span>
<span class="nc" id="L248">	        getUsageType (type) + &quot;\n&quot;;</span>
	}

<span class="nc" id="L251">	String r = &quot;&quot;;</span>

<span class="nc" id="L253">	java.util.Arrays.sort (a, 0, count);</span>

<span class="nc bnc" id="L255" title="All 2 branches missed.">	for (int i = 0; i &lt; a.length; i++)</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">	    if (a[i] != null)</span>
<span class="nc" id="L257">	        r += a[i];</span>

<span class="nc" id="L259">	return (r);</span>
    }

    private void parseAdditional (String args[], int i)
    {
<span class="nc" id="L264">	int number = args.length - i;</span>
<span class="nc" id="L265">	String add[] = new String[number];</span>

<span class="nc bnc" id="L267" title="All 2 branches missed.">	for (int j = 0; j &lt; number; j++, i++)</span>
	{
<span class="nc" id="L269">	    add[j] = args[i];</span>
	}

<span class="nc" id="L272">	Field f = getField (&quot;additional&quot;);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">	if (f != null)</span>
	{
<span class="nc" id="L275">	    setObject (f, add);</span>
	}
	else
	{
<span class="nc" id="L279">	    System.err.println (&quot;No varible 'additional' found&quot;);</span>
	}
<span class="nc" id="L281">    }</span>

    /**
     *	Add to object o to the end of the array contained in field and
     *	return the resulting array.
     *
     *	@param	field	the field in the object
     *	@param	o	the new object to be placed at the end
     *	@return		a formatted version of this object
     */
    private Object addToArray (Field field, Object o)
    {
	Object ret;
<span class="nc" id="L294">	Object orig = getObject (field);</span>
<span class="nc" id="L295">	Class componentType = field.getType().getComponentType();</span>

<span class="nc bnc" id="L297" title="All 2 branches missed.">	if (orig == null)	// the array is empty</span>
	{
<span class="nc" id="L299">	    ret = Array.newInstance (componentType, 1);</span>
<span class="nc" id="L300">	    Array.set (ret, 0, o);</span>
	}
	else
	{
<span class="nc" id="L304">	    int length = Array.getLength (orig);</span>

<span class="nc" id="L306">	    ret = Array.newInstance (componentType, length + 1);</span>

	    int j;
<span class="nc bnc" id="L309" title="All 2 branches missed.">	    for (j = 0; j &lt; length; j++)</span>
	    {
<span class="nc" id="L311">		Array.set (ret, j, Array.get (orig, j));</span>
	    }

<span class="nc" id="L314">	    Array.set (ret, j, o);</span>
	}

<span class="nc" id="L317">	return (ret);</span>
    }

    private String getKey (String arg)
    {
<span class="nc bnc" id="L322" title="All 2 branches missed.">	if (hasEquals)</span>
<span class="nc" id="L323">	    arg = arg.replaceFirst (&quot;=.*&quot;, &quot;&quot;);</span>

<span class="nc bnc" id="L325" title="All 2 branches missed.">        if (doubleDashes)</span>
<span class="nc" id="L326">	    arg = arg.substring (2);</span>
	else
<span class="nc" id="L328">	    arg = arg.substring (1);</span>

	// variables can't start with a number and can't have a dash
<span class="nc" id="L331">	arg = arg.replaceAll (&quot;^([0-9])&quot;, &quot;_$1&quot;);</span>
<span class="nc" id="L332">	arg = arg.replaceAll (&quot;-&quot;, &quot;__&quot;);</span>
<span class="nc" id="L333">	arg = arg.replaceAll (&quot;\\.&quot;, &quot;_\\$&quot;);</span>

<span class="nc bnc" id="L335" title="All 2 branches missed.">	if (aliases != null)</span>
	{
<span class="nc bnc" id="L337" title="All 2 branches missed.">	    for (int i = 0; i &lt; aliases.length; i++)</span>
	    {
<span class="nc bnc" id="L339" title="All 2 branches missed.">		if (aliases[i][0].equals (arg))</span>
<span class="nc" id="L340">		    arg = aliases[i][1];</span>
	    }
	}

<span class="nc" id="L344">	return (arg);</span>
    }

    private String getBooleanValue (String arg)
    {
<span class="nc bnc" id="L349" title="All 2 branches missed.">	if (hasEquals)</span>
	{
<span class="nc" id="L351">	    arg = arg.replaceFirst (&quot;[^=]*=&quot;, &quot;&quot;);</span>

<span class="nc bnc" id="L353" title="All 4 branches missed.">	    if (arg.equalsIgnoreCase (&quot;true&quot;) || arg.equalsIgnoreCase (&quot;yes&quot;))</span>
<span class="nc" id="L354">	        return (&quot;true&quot;);</span>
	    else
<span class="nc" id="L356">	        return (&quot;false&quot;);</span>
	}
	else
	{
<span class="nc" id="L360">	    return (&quot;true&quot;);</span>
	}
    }

    /**
     *	Make an Object of the correct type for the field, using a String
     *	version of the value to create it.
     *
     *	@param	type	a String representing the base (or String) type
     *	@param	val	the value
     *	@return		an Object of the correct type and value
     */
    private Object makeObject (String type, String val)
    {
<span class="nc bnc" id="L374" title="All 2 branches missed.">	if (type.equals (&quot;boolean&quot;))		{ return (new Boolean (val)); }</span>
<span class="nc bnc" id="L375" title="All 2 branches missed.">	if (type.equals (&quot;byte&quot;))		{ return (new Byte (val)); }</span>
<span class="nc bnc" id="L376" title="All 2 branches missed.">	if (type.equals (&quot;short&quot;))		{ return (new Short (val)); }</span>
<span class="nc bnc" id="L377" title="All 2 branches missed.">	if (type.equals (&quot;int&quot;))		{ return (new Integer (val)); }</span>
<span class="nc bnc" id="L378" title="All 2 branches missed.">	if (type.equals (&quot;float&quot;))		{ return (new Float (val)); }</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">	if (type.equals (&quot;double&quot;))		{ return (new Double (val)); }</span>
<span class="nc bnc" id="L380" title="All 2 branches missed.">	if (type.equals (&quot;long&quot;))		{ return (new Long (val)); }</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">	if (type.equals (&quot;java.lang.String&quot;))	{ return (val); }</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">	if (type.equals (&quot;char&quot;))</span>
	{
<span class="nc" id="L384">	    return (new Character (val.charAt (0)));</span>
	}

<span class="nc" id="L387">	return (null);</span>
    }

    private String getEqualsValue (String arg)
    {
<span class="nc bnc" id="L392" title="All 2 branches missed.">	if (arg.indexOf (&quot;=&quot;) == -1)</span>
	{
<span class="nc" id="L394">	    throw (new IllegalArgumentException</span>
		(&quot;'&quot; + arg + &quot;' requires '=VALUE'&quot;));
	}
	else
	{
<span class="nc" id="L399">	    return (arg.replaceFirst (&quot;[^=]*=&quot;, &quot;&quot;));</span>
	}
    }

    /**
     *	Parse a command line.
     *
     *	@param	args	the arguments to be parsed
     */
    public void parse (String args[])
    {
<span class="nc bnc" id="L410" title="All 2 branches missed.">	for (int i = 0; i &lt; args.length; i++)</span>
	{
<span class="nc bnc" id="L412" title="All 2 branches missed.">	    if (! args[i].startsWith (&quot;-&quot;))</span>
	    {
<span class="nc" id="L414">		parseAdditional (args, i);</span>
<span class="nc" id="L415">		return;</span>
	    }

<span class="nc" id="L418">	    doubleDashes = args[i].startsWith (&quot;--&quot;);</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">	    hasEquals = args[i].indexOf (&quot;=&quot;) != -1;</span>

<span class="nc" id="L421">	    String key = getKey (args[i]);</span>


<span class="nc" id="L424">	    Field field = getField (key);</span>

<span class="nc bnc" id="L426" title="All 2 branches missed.">	    if (field == null)</span>
	    {
<span class="nc" id="L428">		throw (new IllegalArgumentException</span>
		    (&quot;No such option: \&quot;&quot; + key + &quot;\&quot;&quot;));
	    }

<span class="nc" id="L432">	    Class type = field.getType();</span>
<span class="nc" id="L433">	    String name = type.getName();</span>

<span class="nc bnc" id="L435" title="All 2 branches missed.">	    if (type.isArray())</span>
<span class="nc" id="L436">		name = type.getComponentType().getName();</span>

<span class="nc" id="L438">	    String value = null;</span>

<span class="nc bnc" id="L440" title="All 2 branches missed.">	    if (name.equals (&quot;boolean&quot;))</span>
<span class="nc" id="L441">		value = getBooleanValue (args[i]);</span>
<span class="nc bnc" id="L442" title="All 4 branches missed.">	    else if (doubleDashes || hasEquals)</span>
<span class="nc" id="L443">		value = getEqualsValue (args[i]);</span>
	    else
<span class="nc" id="L445">		value = args[++i];</span>
	    
<span class="nc" id="L447">	    Object o = makeObject (name, value);</span>

<span class="nc bnc" id="L449" title="All 2 branches missed.">	    if (o == null)</span>
<span class="nc" id="L450">		continue;</span>

<span class="nc bnc" id="L452" title="All 2 branches missed.">	    if (type.isArray())</span>
<span class="nc" id="L453">		o = addToArray (field, o);</span>

<span class="nc" id="L455">	    setObject (field, o);</span>
	}
<span class="nc" id="L457">    }</span>

    /**
     * Get a boolean value from the object after parsing.
     */
    public boolean getBoolean (String key)
<span class="nc" id="L463">	{ return (((Boolean) getValue (key)).booleanValue()); }</span>
    /**
     * Get a byte value from the object after parsing.
     */
    public byte getByte (String key)
<span class="nc" id="L468">	{ return (((Byte) getValue (key)).byteValue()); }</span>
    /**
     * Get a character value from the object after parsing.
     */
    public char getChar (String key)
<span class="nc" id="L473">	{ return (((Character) getValue (key)).charValue()); }</span>
    /**
     * Get a short value from the object after parsing.
     */
    public short getShort (String key)
<span class="nc" id="L478">	{ return (((Short) getValue (key)).shortValue()); }</span>
    /**
     * Get an integer value from the object after parsing.
     */
    public int getInt (String key)
<span class="nc" id="L483">	{ return (((Integer) getValue (key)).intValue()); }</span>
    /**
     * Get a float value from the object after parsing.
     */
    public float getFloat (String key)
<span class="nc" id="L488">	{ return (((Float) getValue (key)).floatValue()); }</span>
    /**
     * Get a double value from the object after parsing.
     */
    public double getDouble (String key)
<span class="nc" id="L493">	{ return (((Double) getValue (key)).doubleValue()); }</span>
    /**
     * Get a long value from the object after parsing.
     */
    public long getLong (String key)
<span class="nc" id="L498">	{ return (((Long) getValue (key)).longValue()); }</span>
    /**
     * Get a String from the object after parsing.
     */
    public String getString (String key)
<span class="nc" id="L503">	{ return ((String) getValue (key)); }</span>

    /**
     * Get an array of bytes from the object after parsing.
     */
<span class="nc" id="L508">    public byte[] getBytes (String key) { return ((byte[]) getValue (key)); }</span>
    /**
     * Get an array of characaters from the object after parsing.
     */
<span class="nc" id="L512">    public char[] getChars (String key) { return ((char[]) getValue (key)); }</span>
    /**
     * Get an array of shorts from the object after parsing.
     */
<span class="nc" id="L516">    public short[] getShorts (String key) { return ((short[]) getValue (key)); }</span>
    /**
     * Get an array of integers from the object after parsing.
     */
<span class="nc" id="L520">    public int[] getInts (String key) { return ((int[]) getValue (key)); }</span>
    /**
     * Get an array of floats from the object after parsing.
     */
<span class="nc" id="L524">    public float[] getFloats (String key) { return ((float[]) getValue (key)); }</span>
    /**
     * Get an array of doubles from the object after parsing.
     */
    public double[] getDoubles (String key)
<span class="nc" id="L529">	{ return ((double[]) getValue (key)); }</span>
    /**
     * Get an array of longs from the object after parsing.
     */
<span class="nc" id="L533">    public long[] getLongs (String key) { return ((long[]) getValue (key)); }</span>
    /**
     * Get an array of Strings from the object after parsing.
     */
    public String[] getStrings (String key)
<span class="nc" id="L538">	{ return ((String[]) getValue (key)); }</span>

    public static void main (String args[])
    {
	// cheesy, i know...
<span class="nc bnc" id="L543" title="All 4 branches missed.">	if (args.length == 1 &amp;&amp; args[0].equalsIgnoreCase (&quot;--version&quot;))</span>
	{
<span class="nc" id="L545">	    System.out.println (&quot;1.3.4&quot;);</span>
	}
<span class="nc" id="L547">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>