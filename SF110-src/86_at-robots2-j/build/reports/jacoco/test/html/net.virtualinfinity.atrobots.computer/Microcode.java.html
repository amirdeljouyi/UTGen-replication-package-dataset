<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Microcode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">86_at-robots2-j</a> &gt; <a href="index.source.html" class="el_package">net.virtualinfinity.atrobots.computer</a> &gt; <span class="el_source">Microcode.java</span></div><h1>Microcode.java</h1><pre class="source lang-java linenums">package net.virtualinfinity.atrobots.computer;

import net.virtualinfinity.atrobots.atsetup.AtRobotMicrocodes;

import java.util.Arrays;

/**
 * Microcode handlers.
 *
 * @author Daniel Pitts
 */
<span class="nc" id="L12">public enum Microcode {</span>
<span class="nc" id="L13">    Constant {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L15">            return computer.getConstant(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L19">            computer.notAddressableError();</span>
<span class="nc" id="L20">            return 0;</span>
        }
    },
<span class="nc" id="L23">    Dereference {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L25">            return computer.getDeferencedValue(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L29">            return computer.getConstant(opnumber);</span>
        }
    },
<span class="nc" id="L32">    DoubleDereference {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L34">            return computer.getDoubleDereferencedValue(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L38">            return computer.getDeferencedValue(opnumber);</span>
        }
    },
<span class="nc" id="L41">    NumberedLabel {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L43">            return computer.getNumberedLabelValue(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L47">            computer.notAddressableError();</span>
<span class="nc" id="L48">            return 0;</span>
        }
    },
<span class="nc" id="L51">    ResolvedLabel {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L53">            return computer.getLabelValue(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L57">            computer.notAddressableError();</span>
<span class="nc" id="L58">            return 0;</span>
        }
    },
<span class="nc" id="L61">    UnresolvedLabel {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L63">            return computer.getUnresolvedLabelValue(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L67">            computer.notAddressableError();</span>
<span class="nc" id="L68">            return 0;</span>
        }
    },
<span class="nc" id="L71">    Invalid {</span>
        public short getValue(Computer computer, int opnumber) {
<span class="nc" id="L73">            computer.invalidMicrocodeError();</span>
<span class="nc" id="L74">            return computer.getConstant(opnumber);</span>
        }

        public int getAddress(Computer computer, int opnumber) {
<span class="nc" id="L78">            computer.notAddressableError();</span>
<span class="nc" id="L79">            return 0;</span>
        }
    };

<span class="nc" id="L83">    private static final Microcode[] codes = new Microcode[16];</span>

    static {
<span class="nc" id="L86">        Arrays.fill(codes, Invalid);</span>
<span class="nc" id="L87">        codes[AtRobotMicrocodes.CONSTANT] = Constant;</span>
<span class="nc" id="L88">        codes[AtRobotMicrocodes.REFERENCE] = Dereference;</span>
<span class="nc" id="L89">        codes[AtRobotMicrocodes.NUMBERED_LABEL] = NumberedLabel;</span>
<span class="nc" id="L90">        codes[AtRobotMicrocodes.UNRESOLVED_LABEL] = UnresolvedLabel;</span>
<span class="nc" id="L91">        codes[AtRobotMicrocodes.RESOLVED_LABEL] = ResolvedLabel;</span>
<span class="nc" id="L92">        codes[AtRobotMicrocodes.INDIRECT_REFERENCE_MASK | AtRobotMicrocodes.CONSTANT] = Dereference;</span>
<span class="nc" id="L93">        codes[AtRobotMicrocodes.INDIRECT_REFERENCE_MASK | AtRobotMicrocodes.REFERENCE] = DoubleDereference;</span>
<span class="nc" id="L94">    }</span>

    public static Microcode get(int microcode) {
<span class="nc" id="L97">        return codes[microcode &amp; 15];</span>
    }

    public abstract short getValue(Computer computer, int opnumber);

    public boolean isValid() {
<span class="nc bnc" id="L103" title="All 4 branches missed.">        return this != Invalid &amp;&amp; this != UnresolvedLabel;</span>
    }

    public boolean isAddressible() {
<span class="nc bnc" id="L107" title="All 4 branches missed.">        return this == Dereference || this == DoubleDereference;</span>
    }

    public boolean hasValue() {
<span class="nc bnc" id="L111" title="All 4 branches missed.">        return isAddressible() || this == Constant;</span>
    }

    public abstract int getAddress(Computer computer, int opnumber);

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>