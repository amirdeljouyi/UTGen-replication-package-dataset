<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JsonToSnapshots.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">86_at-robots2-j</a> &gt; <a href="index.source.html" class="el_package">net.virtualinfinity.atrobots.json</a> &gt; <span class="el_source">JsonToSnapshots.java</span></div><h1>JsonToSnapshots.java</h1><pre class="source lang-java linenums">package net.virtualinfinity.atrobots.json;

import net.virtualinfinity.atrobots.measures.*;
import net.virtualinfinity.atrobots.snapshots.*;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

/**
 * @author &lt;a href='mailto:daniel.pitts@cbs.com'&gt;Daniel Pitts&lt;/a&gt;
 */
<span class="nc" id="L16">public class JsonToSnapshots {</span>
<span class="nc" id="L17">    enum Types {</span>
<span class="nc" id="L18">        missile {</span>
            @Override
            public MissileSnapshot convert(JsonToSnapshots converter, JSONObject json) {
<span class="nc" id="L21">                return converter.getMissileSnapshot(json);</span>
            }
        },
<span class="nc" id="L24">        mine {</span>
            @Override
            public MineSnapshot convert(JsonToSnapshots converter, JSONObject json) throws JSONException {
<span class="nc" id="L27">                return converter.getMineSnapshot(json);</span>
            }
        },
<span class="nc" id="L30">        robot {</span>
            @Override
            public RobotSnapshot convert(JsonToSnapshots converter, JSONObject json) throws JSONException {
<span class="nc" id="L33">                return converter.getRobotSnapshot(json);</span>
            }
        },
<span class="nc" id="L36">        scan {</span>
            @Override
            public ScanSnapshot convert(JsonToSnapshots converter, JSONObject json) throws JSONException {
<span class="nc" id="L39">                return converter.getScanSnapshot(json);</span>
            }
        },
<span class="nc" id="L42">        explosion {</span>
            @Override
            public ExplosionSnapshot convert(JsonToSnapshots converter, JSONObject json) {
<span class="nc" id="L45">                return converter.getExplosionSnapshot(json);</span>
            }
        },
<span class="nc" id="L48">        unknown {</span>
            @Override
            public UnknownSnapshot convert(JsonToSnapshots converter, JSONObject json) {
<span class="nc" id="L51">                return new UnknownSnapshot(json.optString(&quot;type&quot;, &quot;&quot;));</span>
            }
        };


        public abstract ArenaObjectSnapshot convert(JsonToSnapshots converter, JSONObject json) throws JSONException;
    }

    private ExplosionSnapshot getExplosionSnapshot(JSONObject json) {
<span class="nc" id="L60">        return new ExplosionSnapshot(json.optDouble(&quot;radius&quot;, 5.0), Duration.fromCycles(json.optInt(&quot;age&quot;, 0)));</span>
    }

    public Collection&lt;ArenaObjectSnapshot&gt; getSnapshots(JSONArray array) {
<span class="nc" id="L64">        final List&lt;ArenaObjectSnapshot&gt; snapshots = new ArrayList&lt;ArenaObjectSnapshot&gt;(array.length());</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        for (int i = 0, length = array.length(); i &lt; length; ++i) {</span>
            try {
<span class="nc" id="L67">                final JSONObject json = array.getJSONObject(i);</span>
<span class="nc" id="L68">                Types types = Types.unknown;</span>
<span class="nc" id="L69">                final String type = json.getString(&quot;type&quot;);</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">                for (Types match : Types.values()) {</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">                    if (match.name().equals(type)) {</span>
<span class="nc" id="L72">                        types = match;</span>
<span class="nc" id="L73">                        break;</span>
                    }
                }
<span class="nc" id="L76">                final ArenaObjectSnapshot snapshot = types.convert(this, json);</span>
<span class="nc" id="L77">                snapshot.setPositionVector(Vector.createCartesian(json.getDouble(&quot;x&quot;), json.getDouble(&quot;y&quot;)));</span>
<span class="nc" id="L78">                snapshot.setVelocityVector(Vector.createCartesian(json.optDouble(&quot;deltaX&quot;, 0), json.optDouble(&quot;deltaY&quot;, 0)));</span>
<span class="nc" id="L79">                snapshot.setDead(json.optBoolean(&quot;dead&quot;, false));</span>
<span class="nc" id="L80">                snapshots.add(snapshot);</span>

<span class="nc" id="L82">            } catch (JSONException e) {</span>
                // TODO: Report problem?
<span class="nc" id="L84">            }</span>
        }
<span class="nc" id="L86">        return snapshots;</span>
    }

    private RobotSnapshot getRobotSnapshot(JSONObject json) throws JSONException {
<span class="nc" id="L90">        final RobotSnapshot robotSnapshot = new RobotSnapshot();</span>
<span class="nc" id="L91">        robotSnapshot.setId(json.getInt(&quot;id&quot;));</span>
<span class="nc" id="L92">        robotSnapshot.setName(json.optString(&quot;name&quot;));</span>
<span class="nc" id="L93">        robotSnapshot.setArmor(json.optLong(&quot;armor&quot;));</span>
<span class="nc" id="L94">        robotSnapshot.setTemperature(Temperature.fromLogScale(json.optLong(&quot;heat&quot;)));</span>
<span class="nc" id="L95">        robotSnapshot.setHeading(AbsoluteAngle.fromRadians(json.optDouble(&quot;heading&quot;)));</span>
<span class="nc" id="L96">        robotSnapshot.setTurretHeading(AbsoluteAngle.fromRadians(json.optDouble(&quot;turret&quot;)));</span>
<span class="nc" id="L97">        robotSnapshot.setLastMessage(json.optString(&quot;message&quot;));</span>
<span class="nc" id="L98">        robotSnapshot.setRoundKills(json.getInt(&quot;roundKills&quot;));</span>
<span class="nc" id="L99">        robotSnapshot.setTotalKills(json.getInt(&quot;gameKills&quot;));</span>
<span class="nc" id="L100">        robotSnapshot.setTotalWins(json.getInt(&quot;gameWins&quot;));</span>
<span class="nc" id="L101">        robotSnapshot.setTotalTies(json.getInt(&quot;gameTies&quot;));</span>
<span class="nc" id="L102">        robotSnapshot.setTotalDeaths(json.getInt(&quot;gameDeaths&quot;));</span>
<span class="nc" id="L103">        robotSnapshot.setActiveShield(&quot;activated&quot;.equals(json.getString(&quot;shields&quot;)));</span>
<span class="nc" id="L104">        robotSnapshot.setOverburn(&quot;activated&quot;.equals(json.getString(&quot;overburn&quot;)));</span>
<span class="nc" id="L105">        return robotSnapshot;</span>
    }

    private MineSnapshot getMineSnapshot(JSONObject json) throws JSONException {
<span class="nc" id="L109">        final MineSnapshot mineSnapshot = new MineSnapshot();</span>
<span class="nc" id="L110">        mineSnapshot.setTriggerRadius(json.getDouble(&quot;triggerRadius&quot;));</span>
<span class="nc" id="L111">        return mineSnapshot;</span>
    }

    private MissileSnapshot getMissileSnapshot(JSONObject json) {
<span class="nc" id="L115">        return new MissileSnapshot(&quot;activated&quot;.equals(json.optString(&quot;overburn&quot;, &quot;inactive&quot;)), Duration.fromCycles(json.optInt(&quot;age&quot;)));</span>
    }

    private ScanSnapshot getScanSnapshot(JSONObject json) throws JSONException {
<span class="nc" id="L119">        final JSONObject sector = json.getJSONObject(&quot;sector&quot;);</span>
<span class="nc" id="L120">        final boolean successful = json.optBoolean(&quot;successful&quot;);</span>
<span class="nc" id="L121">        final JSONObject accuracy = json.optJSONObject(&quot;accuracy&quot;);</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        final boolean accuracyAvailable = accuracy != null;</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">        return new ScanSnapshot(getAngleBracket(sector), sector.getDouble(&quot;radius&quot;), successful, getTargetVector(json, successful), accuracyAvailable, accuracyAvailable ? accuracy.optInt(&quot;value&quot;) : 0);</span>
    }

    private Vector getTargetVector(JSONObject json, boolean successful) throws JSONException {
<span class="nc bnc" id="L127" title="All 2 branches missed.">        return successful ? Vector.createCartesian(json.getDouble(&quot;targetX&quot;), json.getDouble(&quot;targetY&quot;)) : null;</span>
    }

    private AngleBracket getAngleBracket(JSONObject sector) throws JSONException {
<span class="nc bnc" id="L131" title="All 2 branches missed.">        if (&quot;circle&quot;.equals(sector.getString(&quot;shape&quot;))) {</span>
<span class="nc" id="L132">            return AngleBracket.all();</span>
        }
<span class="nc" id="L134">        return AngleBracket.clockwiseFrom(</span>
<span class="nc" id="L135">                AbsoluteAngle.fromRadians(sector.getDouble(&quot;counterClockwiseBound&quot;)),</span>
<span class="nc" id="L136">                RelativeAngle.fromRadians(sector.getDouble(&quot;rangeSize&quot;)));</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>