<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AtRobotInterruptFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">86_at-robots2-j</a> &gt; <a href="index.source.html" class="el_package">net.virtualinfinity.atrobots.compiler</a> &gt; <span class="el_source">AtRobotInterruptFactory.java</span></div><h1>AtRobotInterruptFactory.java</h1><pre class="source lang-java linenums">package net.virtualinfinity.atrobots.compiler;

import net.virtualinfinity.atrobots.arena.Arena;
import net.virtualinfinity.atrobots.arena.RoundState;
import net.virtualinfinity.atrobots.arena.RoundTimer;
import net.virtualinfinity.atrobots.atsetup.AtRobotInterrupt;
import net.virtualinfinity.atrobots.computer.InterruptHandler;
import net.virtualinfinity.atrobots.computer.MemoryCell;
import net.virtualinfinity.atrobots.computer.Registers;
import net.virtualinfinity.atrobots.interrupts.*;
import net.virtualinfinity.atrobots.robot.Robot;
import net.virtualinfinity.atrobots.util.MapWithDefaultValue;

import java.util.Collection;
import java.util.HashMap;
import java.util.Map;

import static net.virtualinfinity.atrobots.atsetup.AtRobotInterrupt.*;

/**
 * Creates built-in interrupt handlers for the standard AT-Robots set up.
 *
 * @author Daniel Pitts
 */
<span class="nc" id="L25">public class AtRobotInterruptFactory {</span>

    private InterruptHandler createResetMetersInterrupt(Robot robot) {
<span class="nc" id="L28">        return new ResetMetersInterrupt(getRegisters(robot).getMeters(), robot.getOdometer());</span>
    }

    private InterruptHandler createGetRobotStatisticsInterrupt(Robot robot) {
<span class="nc" id="L32">        return robot.createGetRobotStatisticsInterrupt(getDxCell(robot), getExCell(robot), getFxCell(robot));</span>
    }

    private MemoryCell getDxCell(Robot robot) {
<span class="nc" id="L36">        return getRegisters(robot).getDx();</span>
    }

    private InterruptHandler createResetQueueInterrupt(Robot robot) {
<span class="nc" id="L40">        return new ZeroMemoryCellsInterrupt(getRegisters(robot).getCommunicationQueueHead(),</span>
<span class="nc" id="L41">                getRegisters(robot).getCommunicationQueueTail());</span>
    }

    private InterruptHandler createGetQueueSizeInterrupt(Robot robot) {
<span class="nc" id="L45">        return new GetQueueSizeInterrupt(robot.getComputer().getCommQueue(), getFxCell(robot));</span>
    }

    private InterruptHandler createRecieveInterrupt(Robot robot) {
<span class="nc" id="L49">        return new ReceiveInterrupt(robot.getComputer().getCommQueue(), getFxCell(robot));</span>
    }

    private InterruptHandler createTransmitInterrupt(Robot robot) {
<span class="nc" id="L53">        return new TransmitInterrupt(robot.getTransceiver(), getAxCell(robot));</span>
    }

    private InterruptHandler createResetCollisionCountInterrupt(Robot robot) {
<span class="nc" id="L57">        return new ZeroMemoryCellsInterrupt(getRegisters(robot).getCollisionCount());</span>
    }

    private InterruptHandler createGetCollisionsInterrupt(Robot robot) {
<span class="nc" id="L61">        return new CopyMemoryCellsInterrupt(getRegisters(robot).getCollisionCount(), getFxCell(robot));</span>
    }

    private InterruptHandler createGetRobotInfoInterrupt(Robot robot) {
<span class="nc" id="L65">        return robot.createGetRobotInfoInterruptHandler(getDxCell(robot), getExCell(robot), getFxCell(robot));</span>
    }

    private InterruptHandler createGetGameInfoInterrupt(Robot robot, Arena arena, RoundState roundState) {
<span class="nc" id="L69">        return new GetGameInfoInterrupt(getDxCell(robot), getExCell(robot), getFxCell(robot), roundState.getTotalRounds(), roundState.getRoundNumber(), arena);</span>
    }

    private InterruptHandler createGetTargetInfoInterrupt(Robot robot) {
<span class="nc" id="L73">        return new CopyMemoryCellsInterrupt(getRegisters(robot).getTargetHeading(), getExCell(robot),</span>
<span class="nc" id="L74">                getRegisters(robot).getTargetThrottle(), getFxCell(robot));</span>
    }

    private InterruptHandler createGetTargetIdInterrupt(Robot robot) {
<span class="nc" id="L78">        return new CopyMemoryCellsInterrupt(getRegisters(robot).getTargetId(), getFxCell(robot));</span>
    }

    private InterruptHandler createFindAngleInterrupt(Robot robot) {
<span class="nc" id="L82">        return new FindAngleInterrupt(getExCell(robot), getFxCell(robot), getAxCell(robot), robot);</span>
    }

    private MemoryCell getAxCell(Robot robot) {
<span class="nc" id="L86">        return getRegisters(robot).getAx();</span>
    }

    private InterruptHandler createGetTimerInterrupt(Robot robot, RoundTimer roundTimer) {
<span class="nc" id="L90">        return new GetTimerInterrupt(getExCell(robot), getFxCell(robot), roundTimer);</span>
    }

    private InterruptHandler createGetTransponderIdInterrupt(Robot robot) {
<span class="nc" id="L94">        return new GetIdInterrupt(robot.getTransponder(), getFxCell(robot));</span>
    }

    private InterruptHandler createOverburnInterrupt(Robot robot) {
<span class="nc" id="L98">        return new OverburnInterrupt(robot, getAxCell(robot));</span>
    }

    private InterruptHandler createSetKeepshiftInterrupt(Robot robot) {
<span class="nc" id="L102">        return new SetKeepshiftInterrupt(robot.getTurret(), getAxCell(robot));</span>
    }

    private InterruptHandler createLocateInterrupt(Robot robot) {
<span class="nc" id="L106">        return new LocateInterrupt(robot,</span>
<span class="nc" id="L107">                getExCell(robot), getFxCell(robot));</span>
    }

    private MemoryCell getFxCell(Robot robot) {
<span class="nc" id="L111">        return getRegisters(robot).getFx();</span>
    }

    private MemoryCell getExCell(Robot robot) {
<span class="nc" id="L115">        return getRegisters(robot).getEx();</span>
    }

    private Registers getRegisters(Robot robot) {
<span class="nc" id="L119">        return robot.getComputer().getRegisters();</span>
    }

    private InterruptHandler createResetInterrupt(Robot robot) {
<span class="nc" id="L123">        return new ResetInterrupt(robot.getComputer());</span>
    }

    private InterruptHandler createDestructInterrupt(Destructable destructable) {
<span class="nc" id="L127">        return new DestructInterrupt(destructable);</span>
    }

    InvalidInterrupt createInvalidInterrupt(Robot robot) {
<span class="nc" id="L131">        return new InvalidInterrupt(robot.getComputer());</span>
    }

    public Map&lt;Integer, InterruptHandler&gt; createInterruptTable(Robot robot, Arena arena, RoundState roundState) {
<span class="nc" id="L135">        Map&lt;Integer, InterruptHandler&gt; interrupts = new HashMap&lt;Integer, InterruptHandler&gt;();</span>

<span class="nc" id="L137">        mapHandler(interrupts, DESTRUCT, createDestructInterrupt(robot));</span>
<span class="nc" id="L138">        mapHandler(interrupts, RESET, createResetInterrupt(robot).costs(10));</span>
<span class="nc" id="L139">        mapHandler(interrupts, LOCATE, createLocateInterrupt(robot).costs(5));</span>
<span class="nc" id="L140">        mapHandler(interrupts, KEEPSHIFT, createSetKeepshiftInterrupt(robot).costs(2));</span>
<span class="nc" id="L141">        mapHandler(interrupts, OVERBURN, createOverburnInterrupt(robot).costs(1));</span>
<span class="nc" id="L142">        mapHandler(interrupts, ID, createGetTransponderIdInterrupt(robot).costs(2));</span>
<span class="nc" id="L143">        mapHandler(interrupts, TIMER, createGetTimerInterrupt(robot, arena.getRoundTimer()).costs(2));</span>
<span class="nc" id="L144">        mapHandler(interrupts, ANGLE, createFindAngleInterrupt(robot).costs(32));</span>
<span class="nc" id="L145">        mapHandler(interrupts, TARGETID, createGetTargetIdInterrupt(robot).costs(1));</span>
<span class="nc" id="L146">        mapHandler(interrupts, TARGETINFO, createGetTargetInfoInterrupt(robot).costs(2));</span>
<span class="nc" id="L147">        mapHandler(interrupts, GAMEINFO, createGetGameInfoInterrupt(robot, arena, roundState).costs(4));</span>
<span class="nc" id="L148">        mapHandler(interrupts, ROBOTINFO, createGetRobotInfoInterrupt(robot).costs(5));</span>
<span class="nc" id="L149">        mapHandler(interrupts, COLLISIONS, createGetCollisionsInterrupt(robot).costs(1));</span>
<span class="nc" id="L150">        mapHandler(interrupts, RESETCOLCNT, createResetCollisionCountInterrupt(robot).costs(1));</span>
<span class="nc" id="L151">        mapHandler(interrupts, TRANSMIT, createTransmitInterrupt(robot).costs(1));</span>
<span class="nc" id="L152">        mapHandler(interrupts, RECEIVE, createRecieveInterrupt(robot).costs(1));</span>
<span class="nc" id="L153">        mapHandler(interrupts, DATAREADY, createGetQueueSizeInterrupt(robot).costs(1));</span>
<span class="nc" id="L154">        mapHandler(interrupts, CLEARCOM, createResetQueueInterrupt(robot).costs(1));</span>
<span class="nc" id="L155">        mapHandler(interrupts, KILLS, createGetRobotStatisticsInterrupt(robot).costs(3));</span>
<span class="nc" id="L156">        mapHandler(interrupts, CLEARMETERS, createResetMetersInterrupt(robot).costs(1));</span>
<span class="nc" id="L157">        connectHandlers(robot, interrupts.values());</span>
<span class="nc" id="L158">        return new MapWithDefaultValue&lt;Integer, InterruptHandler&gt;(interrupts, createInvalidInterrupt(robot));</span>
    }

    private void mapHandler(Map&lt;Integer, InterruptHandler&gt; interrupts, AtRobotInterrupt interrupt, InterruptHandler handler) {
<span class="nc" id="L162">        interrupts.put(interrupt.interruptNumber, handler);</span>
<span class="nc" id="L163">    }</span>

    private void connectHandlers(Robot robot, Collection&lt;InterruptHandler&gt; interruptHandlers) {
<span class="nc bnc" id="L166" title="All 2 branches missed.">        for (InterruptHandler handler : interruptHandlers) {</span>
<span class="nc" id="L167">            handler.setCycleSource(robot.getComputer());</span>
<span class="nc" id="L168">        }</span>
<span class="nc" id="L169">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>