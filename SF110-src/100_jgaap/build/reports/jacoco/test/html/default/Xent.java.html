<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Xent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">100_jgaap</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Xent.java</span></div><h1>Xent.java</h1><pre class="source lang-java linenums">import java.io.*;
import java.util.Vector;
import java.util.Hashtable;
import java.util.*;

<span class="nc" id="L6">public class Xent {</span>

    public double process(EventSet e1, EventSet e2, int windowSize) {

<span class="nc" id="L10">	double me = meanEntropy(e1,e2,windowSize);</span>
<span class="nc" id="L11">	double hhat = (Math.log(1.0*windowSize) / Math.log(2.0)) / me;</span>

<span class="nc" id="L13">	return hhat;</span>
    }

    private double meanEntropy(EventSet e1, EventSet e2, int windowSize) {
	
<span class="nc" id="L18">	double totalEntropy = 0;</span>
<span class="nc" id="L19">	int trials = 0;</span>
	
<span class="nc bnc" id="L21" title="All 2 branches missed.">	if (windowSize &gt; e1.size() - 1)</span>
<span class="nc" id="L22">	    windowSize = e1.size();</span>
	
<span class="nc" id="L24">	XEDictionary xed = new XEDictionary();</span>
<span class="nc" id="L25">	EventSet dictionary = new EventSet();</span>
<span class="nc" id="L26">	dictionary = window(e1,0,windowSize);</span>
<span class="nc" id="L27">	xed.build(dictionary);</span>

<span class="nc bnc" id="L29" title="All 2 branches missed.">	for (int i = 0; i &lt; e2.size(); i++) {</span>
<span class="nc" id="L30">	    totalEntropy += xed.find(e2.subset(i,e2.size()));</span>
<span class="nc" id="L31">	    trials++;</span>
	}
					      
<span class="nc" id="L34">	return totalEntropy / (double)trials;</span>
    }

    private EventSet window(EventSet e1, int offset, int WindowSize) {

<span class="nc" id="L39">	return e1.subset(offset, offset + WindowSize);</span>
    }

   
    private double calculateEntropy(EventSet e1, EventSet e2) {
<span class="nc" id="L44">	int currentEntropy = 0;</span>
<span class="nc" id="L45">	int maxEntropy = 0;</span>
<span class="nc" id="L46">	int finger = 0;</span>
<span class="nc bnc" id="L47" title="All 4 branches missed.">	while (finger &lt; e1.size() &amp;&amp; finger &lt; e2.size()) {</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">	    if (e1.eventAt(finger) == e2.eventAt(0)) {</span>
<span class="nc" id="L49">		currentEntropy = matchLength(e1.subset(finger, e1.size()), e2);</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">		if (currentEntropy &gt; maxEntropy)</span>
<span class="nc" id="L51">		    maxEntropy = currentEntropy;</span>
	    }
<span class="nc" id="L53">	    finger++;</span>
	}

<span class="nc" id="L56">	return maxEntropy;</span>
    }

    private int matchLength(EventSet e1, EventSet e2) {
<span class="nc" id="L60">	int i = 0;</span>
<span class="nc bnc" id="L61" title="All 6 branches missed.">	while (i &lt; e1.size() &amp;&amp; i &lt; e2.size() &amp;&amp; e1.eventAt(i) == e2.eventAt(i)) {</span>
<span class="nc" id="L62">	    i++;</span>
	}
<span class="nc" id="L64">	return i;</span>
    }
    
}

/**Cross Entropy Dictionary Node
 * Each node contains a single event and a hashtable containing Events as keys and
 * Cross Entropy Dictionary Nodes as values to the keys.  The hashtable can be of 
 * any size.  When this node is placed in a tree structure, a generalized Trie is 
 * created
 **/
class XEDictionaryNode {
    Event key;
<span class="nc" id="L77">    Hashtable&lt; Event, XEDictionaryNode &gt; child = new Hashtable&lt; Event, XEDictionaryNode &gt;();</span>

<span class="nc" id="L79">    XEDictionaryNode() {</span>
<span class="nc" id="L80">	key = null;</span>
<span class="nc" id="L81">    }</span>

<span class="nc" id="L83">    XEDictionaryNode (Event key) {</span>
<span class="nc" id="L84">	this.key = key;</span>
<span class="nc" id="L85">    }</span>
	
    void setKey(Event key) {
<span class="nc" id="L88">	this.key = key;</span>
<span class="nc" id="L89">    }</span>

    void addEventToLevel(Event e) {
<span class="nc" id="L92">	XEDictionaryNode node = new XEDictionaryNode();</span>
<span class="nc" id="L93">	node.key = e;</span>
<span class="nc" id="L94">	child.put(e, node);</span>
<span class="nc" id="L95">    }</span>

    boolean isEventInLevel(Event e) {
<span class="nc" id="L98">	return child.containsKey(e);</span>
    }

    XEDictionaryNode get(Event e) {
<span class="nc" id="L102">	return child.get(e);</span>
    }

    String printKey(XEDictionaryNode key) {
<span class="nc" id="L106">	return child.get(key).toString();</span>
    }

    /**Shows the events at this level of the tree.  Used mainly
     * for debugging purposes
     **/
    String eventsAtThisLevel() {
<span class="nc" id="L113">	String t = new String();</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">	for(Enumeration en = child.keys(); en.hasMoreElements();)</span>
<span class="nc" id="L115">	    t += en.nextElement();</span>
<span class="nc" id="L116">	return t;	</span>
    }

    public String toString() {
<span class="nc" id="L120">	String t = new String();</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">	if (key != null)</span>
<span class="nc" id="L122">	    t = key.toString();</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">	if (child != null) {</span>
<span class="nc" id="L124">	    t += eventsAtThisLevel();</span>
<span class="nc" id="L125">	    t += child;</span>
	}
<span class="nc" id="L127">	return t;</span>
    }

} 


/**Methods for building and manipulating a Cross Entropy Dictionary.
 * A Cross Entropy Dictionary is a hashtable where the keys are Events
 * and the values are Cross Entropy Dictionary Nodes
 **/
class XEDictionary {
    XEDictionaryNode root;

<span class="nc" id="L140">    XEDictionary() {</span>
<span class="nc" id="L141">	root = new XEDictionaryNode();</span>
<span class="nc" id="L142">    }</span>

    public void build(EventSet e) {
<span class="nc bnc" id="L145" title="All 2 branches missed.">	for (int i = 0; i &lt; e.size(); i++) {</span>
<span class="nc" id="L146">	    Event start = e.eventAt(i);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">	    if (!root.isEventInLevel(start)) </span>
<span class="nc" id="L148">	        insertAtRoot(start,e,i);</span>
	    else 
<span class="nc" id="L150">		insertBelowRoot(start,e,i);</span>
	    
	}
<span class="nc" id="L153">	root.key = null;</span>
<span class="nc" id="L154">    }</span>

    public int find(EventSet e) {
<span class="nc" id="L157">	int matchlength = 0;</span>
<span class="nc" id="L158">	boolean matched = false;</span>
<span class="nc" id="L159">	XEDictionaryNode node = root;</span>
<span class="nc bnc" id="L160" title="All 4 branches missed.">	while (matchlength &lt; e.size() &amp;&amp; !matched) {</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">	    if (node.isEventInLevel(e.eventAt(matchlength))) {</span>
<span class="nc" id="L162">		node = node.get(e.eventAt(matchlength));</span>
<span class="nc" id="L163">		matchlength++;</span>
	    }
	    else 
<span class="nc" id="L166">		matched = true;</span>
	}
<span class="nc" id="L168">	return matchlength;</span>
    }
		

    private void insertAtRoot(Event start,EventSet e,int offset) {
<span class="nc" id="L173">	root.addEventToLevel(start);</span>
<span class="nc" id="L174">	XEDictionaryNode node = new XEDictionaryNode();</span>
<span class="nc" id="L175">	node = root;</span>
<span class="nc" id="L176">	int j = offset;</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">	while(j &lt; e.size() - 1) {</span>
<span class="nc" id="L178">	    node = node.get(e.eventAt(j));</span>
<span class="nc" id="L179">	    j++;</span>
	    //  System.out.println(&quot;Adding Event: &quot; + e.eventAt(j));
<span class="nc" id="L181">	    node.addEventToLevel(e.eventAt(j));</span>
	}
<span class="nc" id="L183">    }</span>

    private void insertBelowRoot(Event start, EventSet e, int offset) {
<span class="nc" id="L186">	XEDictionaryNode node = new XEDictionaryNode();</span>
<span class="nc" id="L187">	node = root;</span>
	//	System.out.println(&quot;Event at offset: &quot; + e.eventAt(offset));
<span class="nc" id="L189">	node = node.get(e.eventAt(offset));</span>
<span class="nc" id="L190">	int j = offset;</span>
<span class="nc" id="L191">	boolean matches = true;   //match the events up to a given level</span>
<span class="nc bnc" id="L192" title="All 4 branches missed.">	while(matches &amp;&amp; j &lt; e.size() - 1) {</span>
<span class="nc" id="L193">	    j++;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">	    if (node.isEventInLevel(e.eventAt(j))) {</span>
		//	System.out.println(&quot;Match at level: &quot; + e.eventAt(j));
<span class="nc" id="L196">		node = node.get(e.eventAt(j));</span>
	    }
	    else 
<span class="nc" id="L199">		matches = false;</span>
	}
<span class="nc bnc" id="L201" title="All 2 branches missed.">	for (int i = j; i &lt; e.size(); i++) {    </span>
	    //	    System.out.println(&quot;Adding Event: &quot; + e.eventAt(i));
<span class="nc" id="L203">	    node.addEventToLevel(e.eventAt(i));</span>
<span class="nc" id="L204">	    node = node.get(e.eventAt(i));</span>
	}
<span class="nc" id="L206">    }</span>

    public String toString() {
<span class="nc" id="L209">	return root.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>