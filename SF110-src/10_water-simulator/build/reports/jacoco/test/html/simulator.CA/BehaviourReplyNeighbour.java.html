<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BehaviourReplyNeighbour.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.CA</a> &gt; <span class="el_source">BehaviourReplyNeighbour.java</span></div><h1>BehaviourReplyNeighbour.java</h1><pre class="source lang-java linenums">package simulator.CA;


import jade.content.ContentElement;
import jade.content.lang.Codec.CodecException;
import jade.content.onto.OntologyException;
import jade.core.behaviours.CyclicBehaviour;
import jade.core.behaviours.DataStore;
import jade.lang.acl.ACLMessage;
import jade.lang.acl.MessageTemplate;

import java.util.Iterator;

import org.apache.log4j.Logger;

import simulator.ontology.AskWeightsFor;
import simulator.ontology.Parameter;
import simulator.ontology.StepAttr;
import simulator.util.ParameterAttributes;

/**
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */
public class BehaviourReplyNeighbour extends CyclicBehaviour{
	private static final long serialVersionUID = -8970863990310722224L;
<span class="nc" id="L29">		private Logger log = Logger.getLogger(BehaviourReplyNeighbour.class);</span>
      private ConsumerAgent myAgent;
      private ParameterAttributes[] socialParameters;

      private MessageTemplate mt;

      // Constructor
      public BehaviourReplyNeighbour(ConsumerAgent a,MessageTemplate mt,
                                                        ParameterAttributes[] socialParameters,DataStore ds){
<span class="nc" id="L38">            super(a);</span>
<span class="nc" id="L39">            myAgent = a;</span>
<span class="nc" id="L40">            this.mt = mt;</span>
<span class="nc" id="L41">            this.socialParameters = socialParameters;</span>
<span class="nc" id="L42">            this.setDataStore(ds);</span>
<span class="nc" id="L43">      }</span>

      // ACTION

      public void action() {

<span class="nc" id="L49">        ACLMessage query = myAgent.receive(mt);</span>
        ACLMessage resNot;
<span class="nc bnc" id="L51" title="All 2 branches missed.">        if (query!= null){</span>
           try{
<span class="nc" id="L53">             ContentElement ce = myAgent.getContentManager().extractContent(query);</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">             if ( ce instanceof AskWeightsFor){</span>
<span class="nc" id="L55">                  resNot = query.createReply();</span>
<span class="nc" id="L56">                  resNot.setPerformative(ACLMessage.INFORM);</span>
<span class="nc" id="L57">                  resNot = replySocialQuery(query, resNot);</span>
<span class="nc" id="L58">                  myAgent.send(resNot);</span>
             }
           }
<span class="nc" id="L61">           catch(OntologyException oe){}</span>
<span class="nc" id="L62">           catch(CodecException cex){}</span>
        }
        else
<span class="nc" id="L65">	    block();</span>

<span class="nc" id="L67">      }// END of action</span>

      private ACLMessage replySocialQuery(ACLMessage query, ACLMessage resNot){

        // Answer the query
        // Fill the parameters' weights
        try{
<span class="nc" id="L74">          ContentElement ce = myAgent.getContentManager().extractContent(query);</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">          if (ce instanceof AskWeightsFor) {</span>
<span class="nc" id="L76">             AskWeightsFor awf = (AskWeightsFor) ce;</span>
             // Get stepId
<span class="nc" id="L78">             StepAttr st = (StepAttr) awf.getStep3();</span>
<span class="nc" id="L79">             int stepId = st.getId().intValue();</span>

<span class="nc" id="L81">             Iterator it = awf.getAllParameters();</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">             while(it.hasNext()){</span>
<span class="nc" id="L83">                Parameter p = new Parameter();</span>
<span class="nc" id="L84">                p = (Parameter)it.next();</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">                for(int i=0 ; i&lt;socialParameters.length ; i++){</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">                    if (p.getName().equals(this.socialParameters[i].getName())  ){</span>
<span class="nc" id="L87">                       float social = this.socialParameters[i].getSocialFunction().valueFor(stepId);</span>
<span class="nc" id="L88">                       p.setWeight(new Float(social));</span>
                    } // END if
                }// END for-i
<span class="nc" id="L91">             }//END while</span>

<span class="nc" id="L93">             myAgent.getContentManager().fillContent(resNot,awf);</span>
<span class="nc" id="L94">          }// END if</span>
          else
<span class="nc" id="L96">              myAgent.onFailure(query);</span>
        }
<span class="nc" id="L98">        catch (CodecException ce){log.error(ce.getStackTrace());}</span>
<span class="nc" id="L99">        catch (OntologyException oe){log.error(oe.getStackTrace());}</span>

        //TEST
//        Iterator receiver = resNot.getAllIntendedReceiver();
//        String s = ((AID)receiver.next()).getLocalName();
//        log.debug(myAgent.getLocalName() + &quot; reply social to &quot; + s);
        

<span class="nc" id="L107">        return resNot;</span>

   } // END ReplySocialQuery

}// END BehaviourReplyNeighbour

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>