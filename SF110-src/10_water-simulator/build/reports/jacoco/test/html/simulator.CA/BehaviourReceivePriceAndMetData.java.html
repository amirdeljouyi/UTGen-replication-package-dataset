<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BehaviourReceivePriceAndMetData.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.CA</a> &gt; <span class="el_source">BehaviourReceivePriceAndMetData.java</span></div><h1>BehaviourReceivePriceAndMetData.java</h1><pre class="source lang-java linenums">package simulator.CA;

import org.apache.log4j.Logger;

import simulator.CA.ConsumerAgent;

import simulator.ontology.*;
import simulator.util.AIDs;



import jade.core.behaviours.OneShotBehaviour;
import jade.core.behaviours.DataStore;

import jade.content.ContentElement;
import jade.lang.acl.ACLMessage;
import jade.lang.acl.MessageTemplate;

import jade.content.lang.Codec.CodecException;
import jade.content.onto.OntologyException;

/**
 * CA behaviour to receive price &amp; met data and store them to Datastore for 
 * later use
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */

class BehaviourReceivePriceAndMetData extends OneShotBehaviour implements AIDs{
	private static final long serialVersionUID = 159728795644167290L;
<span class="nc" id="L33">	private Logger log = Logger.getLogger(BehaviourReceivePriceAndMetData.class);</span>
	private ConsumerAgent myAgent;

    public BehaviourReceivePriceAndMetData(ConsumerAgent a, DataStore ds){
<span class="nc" id="L37">        super(a);</span>
<span class="nc" id="L38">        myAgent = a;</span>
<span class="nc" id="L39">        this.setDataStore(ds);</span>
<span class="nc" id="L40">    } // Constructor</span>


    // ACTION

    public void action(){

<span class="nc" id="L47">       MessageTemplate mt = MessageTemplate.and(</span>
<span class="nc" id="L48">                      MessageTemplate.MatchSender(WATER_SUPPLIER),</span>
<span class="nc" id="L49">                      MessageTemplate.MatchPerformative(ACLMessage.QUERY_REF));</span>

<span class="nc" id="L51">       ACLMessage query = myAgent./*blockingR*/receive(mt);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">       if(query != null){</span>
           // Ontology check
<span class="nc bnc" id="L54" title="All 2 branches missed.">           if (query.getOntology().equals(myAgent.ontology.getName())){</span>
<span class="nc" id="L55">              this.getDataStore().put(ConsumerAgent.QUERY_KEY,query);</span>
              // Store STEP_KEY for later use
              try{
<span class="nc" id="L58">                ContentElement ce = myAgent.getContentManager().extractContent(query);</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">                if (ce instanceof Consumes){</span>
<span class="nc" id="L60">                   Consumes cs = (Consumes) ce;</span>
<span class="nc" id="L61">                   StepAttr st = (StepAttr)cs.getStep2();</span>
<span class="nc" id="L62">                   this.getDataStore().put(ConsumerAgent.STEP_KEY,st.getId());</span>
<span class="nc" id="L63">                }</span>
                else
<span class="nc" id="L65">                  myAgent.onFailure(query);</span>
              }
<span class="nc" id="L67">              catch (CodecException ce){log.error(ce.getStackTrace());}</span>
<span class="nc" id="L68">              catch (OntologyException oe){log.error(oe.getStackTrace());}</span>

              //TEST
<span class="nc" id="L71">              log.debug(myAgent.getLocalName().toString() + &quot; : (ReceivePrice&amp;Met)&quot; );</span>
           }
           else{
<span class="nc" id="L74">              myAgent.onFailure(query);</span>
           }
       }// END-if-outer
       else{
<span class="nc" id="L78">          this.block();</span>
<span class="nc" id="L79">          this.parent.reset();</span>
       }
<span class="nc" id="L81">    } // ACTION</span>



  } // Behaviour
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>