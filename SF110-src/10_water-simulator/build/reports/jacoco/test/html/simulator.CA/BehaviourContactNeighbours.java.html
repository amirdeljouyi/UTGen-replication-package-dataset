<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BehaviourContactNeighbours.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.CA</a> &gt; <span class="el_source">BehaviourContactNeighbours.java</span></div><h1>BehaviourContactNeighbours.java</h1><pre class="source lang-java linenums">package simulator.CA;

import jade.content.lang.Codec.CodecException;
import jade.content.onto.OntologyException;
import jade.core.behaviours.DataStore;
import jade.lang.acl.ACLMessage;
import jade.proto.AchieveREInitiator;

import java.util.Vector;

import org.apache.log4j.Logger;

import simulator.ontology.AskWeightsFor;
import simulator.ontology.Parameter;
import simulator.ontology.StepAttr;
import simulator.util.AIDs;
import simulator.util.ParameterAttributes;


/**
 * Consumer Agent's behaviour for contacting to its neighbours.
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */

class BehaviourContactNeighbours extends AchieveREInitiator implements AIDs {
	
	private static final long serialVersionUID = 4131694655800331793L;
	
<span class="nc" id="L32">	private Logger log = Logger.getLogger(BehaviourContactNeighbours.class);</span>
	
	private ConsumerAgent myAgent;
	
	private ParameterAttributes[] parametersToAsk;
	
	public BehaviourContactNeighbours(ConsumerAgent a, ACLMessage query,
			ParameterAttributes[] parametersToAsk, DataStore ds) {
<span class="nc" id="L40">		super(a, query);</span>
<span class="nc" id="L41">		myAgent = a;</span>
<span class="nc" id="L42">		this.setDataStore(ds);</span>
<span class="nc" id="L43">		this.parametersToAsk = parametersToAsk;</span>
<span class="nc" id="L44">	}</span>
	
	protected Vector prepareRequests(ACLMessage msg) {
		
<span class="nc" id="L48">		Vector&lt;ACLMessage&gt; v = new Vector&lt;ACLMessage&gt;();</span>
<span class="nc" id="L49">		ACLMessage msg1 = myAgent.createQueryMsgForNeighbourhood();</span>
		try { // Fill message content
<span class="nc" id="L51">			myAgent.getContentManager()</span>
<span class="nc" id="L52">			.fillContent(msg1, fillParametersToAsk());</span>
<span class="nc" id="L53">		} catch (CodecException ce) {</span>
<span class="nc" id="L54">			log.error(ce.getStackTrace());</span>
<span class="nc" id="L55">		} catch (OntologyException oe) {</span>
<span class="nc" id="L56">			log.error(oe.getStackTrace());</span>
<span class="nc" id="L57">		}</span>
		
<span class="nc" id="L59">		v.addElement(msg1);</span>
		
		//TEST
<span class="nc" id="L62">		log.debug(myAgent.getLocalName() + &quot; : (Contact Neighs) &quot;);</span>
		
<span class="nc" id="L64">		return v;</span>
	} // Prepare Requests
	
	protected void handleAgree(ACLMessage msg) {
<span class="nc" id="L68">		log.debug(&quot;Agreed CA-&quot; + msg.getSender().getLocalName());</span>
<span class="nc" id="L69">	}</span>
	
	protected void handleInform(ACLMessage msg) {
<span class="nc" id="L72">		onSuccess(msg);</span>
<span class="nc" id="L73">	}</span>
	
	protected void handleFailure(ACLMessage msg) {
<span class="nc" id="L76">		myAgent.onFailure(msg);</span>
<span class="nc" id="L77">	}</span>
	
	protected void handleRefuse(ACLMessage msg) {
<span class="nc" id="L80">		myAgent.onFailure(msg);</span>
<span class="nc" id="L81">	}</span>
	
	protected void handleNotUnderstood(ACLMessage msg) {
<span class="nc" id="L84">		myAgent.onFailure(msg);</span>
<span class="nc" id="L85">	}</span>
	
	protected void handleOutOfSequence(ACLMessage msg) {
<span class="nc" id="L88">		myAgent.onFailure(msg);</span>
<span class="nc" id="L89">	}</span>
	
	protected void handleAllResponses(Vector responses) {
<span class="nc" id="L92">	}</span>
	
	protected void handleAllResultNotifications(Vector resultNotifications) {
		// Store replies to DataStore
<span class="nc" id="L96">		this.getDataStore().put(ConsumerAgent.REPLIES_KEY, resultNotifications);</span>
		
		//TEST
<span class="nc" id="L99">		log.debug(myAgent.getLocalName() + &quot; : (got replies) &quot;);</span>
		
<span class="nc" id="L101">	}// Result Not</span>
	
	private void onSuccess(ACLMessage msg) {
<span class="nc" id="L104">		log.debug(myAgent.getLocalName() + &quot; i by &quot;</span>
<span class="nc" id="L105">				+ msg.getSender().getLocalName());</span>
<span class="nc" id="L106">	}</span>
	
	/****************************
	 *  fillParametersToAsk()
	 *
	 * @return
	 */
	
	private AskWeightsFor fillParametersToAsk() {
		
<span class="nc" id="L116">		AskWeightsFor awf = new AskWeightsFor();</span>
<span class="nc" id="L117">		StepAttr st = new StepAttr();</span>
<span class="nc" id="L118">		st.setId((Integer) this.getDataStore().get(ConsumerAgent.STEP_KEY));</span>
<span class="nc" id="L119">		awf.setStep3(st);</span>
		
<span class="nc bnc" id="L121" title="All 2 branches missed.">		for (int i = 0; i &lt; parametersToAsk.length; i++) {</span>
<span class="nc" id="L122">			Parameter temp = new Parameter();</span>
<span class="nc" id="L123">			temp.setName(parametersToAsk[i].getName());</span>
<span class="nc" id="L124">			awf.addParameters(temp);</span>
		}
		
<span class="nc" id="L127">		return awf;</span>
	}
	
}// END BehaviourContactNeighbours
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>