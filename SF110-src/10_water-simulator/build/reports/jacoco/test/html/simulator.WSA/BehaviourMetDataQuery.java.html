<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BehaviourMetDataQuery.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.WSA</a> &gt; <span class="el_source">BehaviourMetDataQuery.java</span></div><h1>BehaviourMetDataQuery.java</h1><pre class="source lang-java linenums">package simulator.WSA;



import jade.content.ContentElement;
import jade.content.lang.Codec.CodecException;
import jade.content.onto.OntologyException;
import jade.core.behaviours.DataStore;
import jade.lang.acl.ACLMessage;
import jade.proto.AchieveREInitiator;

import java.util.Vector;

import org.apache.log4j.Logger;

import simulator.ontology.HasMetData;
import simulator.ontology.MetData;
import simulator.ontology.StepAttr;
import simulator.util.AIDs;

/**
 * &lt;p&gt;Title: BehaviourMetDataQuery &lt;/p&gt;
 * &lt;p&gt;Description: Beahaviour using QUERY-REF protocol for asking MOA the Temperature and RainFall
 * variables &lt;/p&gt;
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */


class BehaviourMetDataQuery extends AchieveREInitiator implements AIDs{

	private static final long serialVersionUID = 5608112376124330764L;
<span class="nc" id="L35">	private Logger log = Logger.getLogger(BehaviourMetDataQuery.class);</span>
	private WaterSupplierAgent myAgent;

    public BehaviourMetDataQuery(WaterSupplierAgent a, ACLMessage queryMsg, DataStore ds){
<span class="nc" id="L39">        super(a,queryMsg);</span>
<span class="nc" id="L40">        myAgent = a;</span>
<span class="nc" id="L41">        this.setDataStore(ds);</span>
<span class="nc" id="L42">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
	protected Vector prepareRequests(ACLMessage msg){

<span class="nc" id="L47">        Vector v = new Vector();</span>
<span class="nc" id="L48">        ACLMessage msg1 = myAgent.createQueryMsg();</span>
<span class="nc" id="L49">        msg1.addReceiver(MET_OFFICE);</span>

        // Prepare content
            // Fill concept
<span class="nc" id="L53">        StepAttr step = new StepAttr();</span>
<span class="nc" id="L54">        step.setId(((Integer)this.getDataStore().get(WaterSupplierAgent.STEP_ID_KEY)));</span>

<span class="nc" id="L56">        MetData md = new MetData();</span>

            // Fill Predidate
<span class="nc" id="L59">        HasMetData hsd = new HasMetData();</span>
<span class="nc" id="L60">        hsd.setStep1(step);</span>
<span class="nc" id="L61">        hsd.setData(md);</span>

        try{
              // Fill message content
<span class="nc" id="L65">              myAgent.getContentManager().fillContent(msg1,hsd);</span>
<span class="nc" id="L66">              v.addElement(msg1);</span>
        }
<span class="nc" id="L68">        catch (CodecException ce){ ce.printStackTrace(); }</span>
<span class="nc" id="L69">        catch (OntologyException oe){ oe.printStackTrace(); }</span>

<span class="nc" id="L71">        return v;</span>

    } // END prepareRequests


<span class="nc" id="L76">    protected void handleAgree(ACLMessage msg) { log.debug(&quot;Agreed&quot;);}</span>

<span class="nc" id="L78">    protected void handleInform(ACLMessage msg) { onSuccess(msg);}</span>

<span class="nc" id="L80">    protected void handleFailure(ACLMessage msg) { myAgent.onFailure(msg);}</span>
<span class="nc" id="L81">    protected void handleRefuse(ACLMessage msg) { myAgent.onFailure(msg);}</span>
<span class="nc" id="L82">    protected void handleNotUnderstood(ACLMessage msg) { myAgent.onFailure(msg);}</span>
<span class="nc" id="L83">    protected void handleOutOfSequence(ACLMessage msg) { myAgent.onFailure(msg);}</span>



    private void onSuccess(ACLMessage msg){

            try{
<span class="nc" id="L90">                ContentElement ce = myAgent.getContentManager().extractContent(msg);</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                if (ce instanceof HasMetData) {</span>
<span class="nc" id="L92">                            HasMetData hd = (HasMetData) ce;</span>
                            // Stores received met data in the shared datastore
<span class="nc" id="L94">                            this.getDataStore().put(WaterSupplierAgent.TEMPERATURE_KEY,hd.getData().getTemperature());</span>
<span class="nc" id="L95">                            this.getDataStore().put(WaterSupplierAgent.RAINFALL_KEY,hd.getData().getRainfall());</span>
                            //TEST
                            //System.out.println(&quot;\nWSA got from MOA : &quot; + msg.getContent());
<span class="nc" id="L98">                }</span>
<span class="nc" id="L99">                else{ myAgent.onFailure(msg); }</span>
             }
<span class="nc" id="L101">             catch (CodecException ce){</span>
<span class="nc" id="L102">               ce.printStackTrace();</span>
             }
<span class="nc" id="L104">             catch (OntologyException oe){</span>
<span class="nc" id="L105">               oe.printStackTrace();</span>
<span class="nc" id="L106">             }</span>
<span class="nc" id="L107">    } // END onSuccess</span>

} // END BehaviourMetDataQuery



</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>