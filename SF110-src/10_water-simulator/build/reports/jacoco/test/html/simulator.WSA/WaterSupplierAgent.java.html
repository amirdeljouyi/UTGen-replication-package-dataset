<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WaterSupplierAgent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.WSA</a> &gt; <span class="el_source">WaterSupplierAgent.java</span></div><h1>WaterSupplierAgent.java</h1><pre class="source lang-java linenums">package simulator.WSA;



import jade.content.lang.Codec;
import jade.content.lang.sl.SLCodec;
import jade.core.Agent;
import jade.core.behaviours.DataStore;
import jade.core.behaviours.SequentialBehaviour;
import jade.lang.acl.ACLMessage;

import java.util.Vector;

import simulator.ontology.WDS_Ontology;
import simulator.util.AIDs;
import simulator.util.ConsumerAttributes;

/**
 * &lt;p&gt;Title: WaterSupplierAgent &lt;/p&gt;
 * &lt;p&gt;Description: Waits the step number from SA , asks MOA for met data, informs consumers about price
 * and met data and finally calculates step's total consumption and sends it to SA  &lt;/p&gt;
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */

<span class="nc" id="L28">public class WaterSupplierAgent extends Agent implements AIDs{</span>

  private static final long serialVersionUID = 8293008733009089544L;
// DataStore KEYS
  protected static final String STEP_ID_KEY = &quot;StepId&quot;;
  protected static final String TEMPERATURE_KEY = &quot;TemperatureForStep&quot;;
  protected static final String RAINFALL_KEY = &quot;RainfallForStep&quot;;
  protected static final String STEP_TOTAL_KEY = &quot;StepTotalConsumption&quot;;

  // Ontology
<span class="nc" id="L38">  protected Codec codec = new SLCodec();</span>
<span class="nc" id="L39">  protected WDS_Ontology ontology = WDS_Ontology.getInstance();</span>

  // All Consumers Agents in this simulation
  private ConsumerAttributes[] allConsumers;

  // The inputs argument
  private boolean queryMOA;
  private Vector priceData;
  private Integer simulationStep;



  public void setup() {

       // Register SLCodec (language)
<span class="nc" id="L54">       getContentManager().registerLanguage(codec);</span>
<span class="nc" id="L55">       getContentManager().registerOntology(ontology);</span>

       // Get arguments (queryMOA , consumers , priceData)
<span class="nc" id="L58">       unpackArguments();</span>

<span class="nc" id="L60">       DataStore ds = new DataStore();</span>

       // In case MOA isn't launched
       // (these values are read in BehaviourQueryConsumers to fill in the message)
<span class="nc" id="L64">       ds.put(TEMPERATURE_KEY,new Float(&quot;0&quot;));</span>
<span class="nc" id="L65">       ds.put(RAINFALL_KEY,new Float(&quot;0&quot;));</span>

<span class="nc" id="L67">       SequentialBehaviour myBehaviour = new SequentialBehaviour(this){</span>
       private static final long serialVersionUID = -5425911877378817619L;

			public int onEnd(){
<span class="nc" id="L71">                  reset();</span>
<span class="nc" id="L72">                  myAgent.addBehaviour(this);</span>
<span class="nc" id="L73">                  return super.onEnd();</span>
              }
       };

<span class="nc" id="L77">       myBehaviour.addSubBehaviour(new BehaviourWaitStartStep(this,ds));</span>

       // query if there is a parameter with MetData type
<span class="nc bnc" id="L80" title="All 2 branches missed.">       if (queryMOA)</span>
<span class="nc" id="L81">             myBehaviour.addSubBehaviour(new BehaviourMetDataQuery(this,createQueryMsg(),ds));</span>

<span class="nc" id="L83">       myBehaviour.addSubBehaviour(new BehaviourQueryConsumers(this,createQueryMsg(),allConsumers,</span>
                                                   priceData, this.simulationStep,ds));
<span class="nc" id="L85">       addBehaviour(myBehaviour);</span>
<span class="nc" id="L86">  }</span>

  /**
   * &quot;Unpack&quot; the arguments WSA receives when is born. The arguments are elements of an object array.
   * The first argument is a boolean value indicating whether WSA has to query MOA about met data.
   * It is true in case one of demand curve parameters has a function of type MetDataFunction.
   * The second argument is a Vector of all consumers (as ConsumerAttributes objects).
   * The third is all price data that will be passed to BehaviourQueryConsumers.
   */
  private void unpackArguments(){

     // get the list with the consumers
<span class="nc" id="L98">     Object[] allArguments = getArguments();</span>

<span class="nc" id="L100">     queryMOA = ((Boolean)allArguments[0]).booleanValue();</span>
<span class="nc" id="L101">     Vector v = (Vector) allArguments[1];</span>
<span class="nc" id="L102">     allConsumers = new ConsumerAttributes[v.size()];</span>
<span class="nc" id="L103">     v.copyInto(allConsumers);</span>

<span class="nc" id="L105">     priceData = (Vector) allArguments[2];</span>
<span class="nc" id="L106">     simulationStep = (Integer)allArguments[3];</span>

<span class="nc" id="L108">  }// END of unpackArguments()</span>

  /**
   * Creates an ACLMessage with QUERY_REF performative, FIPA_QUERY in protocol slot,
   * WSA's language and ontology selected.
   * @return The ACLMessage
   */
  protected ACLMessage createQueryMsg(){

<span class="nc" id="L117">        ACLMessage msg = new ACLMessage(ACLMessage.QUERY_REF);</span>
<span class="nc" id="L118">        msg.setProtocol(jade.domain.FIPANames.InteractionProtocol.FIPA_QUERY);</span>
<span class="nc" id="L119">        msg.setLanguage(codec.getName());</span>
<span class="nc" id="L120">        msg.setOntology(ontology.getName());</span>
<span class="nc" id="L121">        return msg;</span>
  }

  /**
   * It's called when something goes wrong. WSA sents a message to SA in order to be displayed on progress
   * GUI
   * @param msg The message to be send to SA
   */
  protected void onFailure(ACLMessage msg){

<span class="nc" id="L131">        ACLMessage failureMsg = new ACLMessage(ACLMessage.FAILURE);</span>
<span class="nc" id="L132">        failureMsg.addReceiver(SIMULATOR);</span>
<span class="nc" id="L133">        failureMsg.setContent(msg.getSender() + &quot; - &quot; +  msg.getContent());</span>
<span class="nc" id="L134">        send(failureMsg);</span>
<span class="nc" id="L135">    }</span>

} // END of AGENT
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>