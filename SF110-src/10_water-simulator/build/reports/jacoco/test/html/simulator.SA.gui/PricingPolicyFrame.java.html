<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PricingPolicyFrame.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.SA.gui</a> &gt; <span class="el_source">PricingPolicyFrame.java</span></div><h1>PricingPolicyFrame.java</h1><pre class="source lang-java linenums">package simulator.SA.gui;

import jade.gui.GuiEvent;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JInternalFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.table.AbstractTableModel;
import javax.swing.table.TableModel;

import simulator.SA.SimulationAgent;

/**
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */

public class PricingPolicyFrame extends JInternalFrame {
	private static final long serialVersionUID = -3332140195203607928L;
	private SimulationAgent myAgent;
<span class="nc" id="L41">      private int chosenScenario=0;</span>
      private Integer reviewPeriod;
      private Float CPI;
      private Float CPIpercentage;
<span class="nc" id="L45">      private Vector scenarioVariables = new Vector(0,1);</span>
<span class="nc" id="L46">      private Vector priceData = new Vector(0,1);</span>
      private String[] availablePricingScenarios;

      // Constructor
<span class="nc" id="L50">      public PricingPolicyFrame(SimulationAgent a, String[] availablePricingScenarios, Vector priceData){</span>
<span class="nc" id="L51">          this.myAgent = a;</span>
<span class="nc" id="L52">          this.availablePricingScenarios = availablePricingScenarios;</span>
<span class="nc" id="L53">          this.priceData = priceData;</span>
<span class="nc" id="L54">          setDataToFields();</span>
<span class="nc" id="L55">      }</span>

<span class="nc" id="L57">      private JPanel contentPane = (JPanel) this.getContentPane();</span>
      {
<span class="nc" id="L59">              contentPane.setLayout(new BorderLayout());</span>
<span class="nc" id="L60">              this.setClosable(true);</span>
<span class="nc" id="L61">              this.setDefaultCloseOperation(JInternalFrame.HIDE_ON_CLOSE);</span>
<span class="nc" id="L62">              this.setResizable(false);</span>
<span class="nc" id="L63">              this.setSize(new Dimension(500, 430));</span>
<span class="nc" id="L64">              this.setTitle(&quot;Pricing Policy&quot;);</span>
      }

      //*******************************************************
      // INPUT PANEL

<span class="nc" id="L70">      private JPanel inputPanel = new JPanel(new GridLayout(3,1,0,0));</span>
      {
<span class="nc" id="L72">        inputPanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L73">        contentPane.add(inputPanel,BorderLayout.NORTH);</span>
      }

      //*******************************************************
      // Scenarios

<span class="nc" id="L79">      private JPanel panel1 = new JPanel(new GridLayout(2,1));</span>
      {
<span class="nc" id="L81">        inputPanel.add(panel1, null);</span>
      }
<span class="nc" id="L83">      private JPanel panel1_a = new JPanel(new FlowLayout(FlowLayout.CENTER));</span>
      {
<span class="nc" id="L85">        panel1.add(panel1_a,null);</span>
      }
<span class="nc" id="L87">      private JComboBox scenarioCombo = new JComboBox(/*availablePricingScenarios*/);</span>
      {
        //panel1.setSize(0,40);
<span class="nc" id="L90">        panel1_a.add(scenarioCombo,null);</span>
<span class="nc" id="L91">        scenarioCombo.addActionListener(new ActionListener(){</span>
                  public void actionPerformed(ActionEvent e){
<span class="nc" id="L93">                     chosenScenario = scenarioCombo.getSelectedIndex();</span>
<span class="nc" id="L94">                  }</span>
        });
      }

<span class="nc" id="L98">      private JPanel panel1_b = new JPanel(new FlowLayout(FlowLayout.CENTER));</span>
      {
<span class="nc" id="L100">        panel1.add(panel1_b,null);</span>
      }
<span class="nc" id="L102">      private JLabel labelReview = new JLabel(&quot;Policy reviewing every :&quot;);</span>
            {
<span class="nc" id="L104">              labelReview.setFont(new java.awt.Font(&quot;Dialog&quot;, 1, 12));</span>
<span class="nc" id="L105">              labelReview.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="nc" id="L106">              labelReview.setHorizontalTextPosition(SwingConstants.CENTER);</span>
<span class="nc" id="L107">              panel1_b.add(labelReview,null);</span>
            }
<span class="nc" id="L109">            private JTextField textReview = new JTextField(5);</span>
            {
<span class="nc" id="L111">              textReview.setBorder(BorderFactory.createLoweredBevelBorder());</span>
<span class="nc" id="L112">              panel1_b.add(textReview,null);</span>
            }
<span class="nc" id="L114">            private JLabel labelStepsReview = new JLabel(&quot; simulation step(s)&quot;);</span>
            {
<span class="nc" id="L116">              labelStepsReview.setFont(new java.awt.Font(&quot;Dialog&quot;, 1, 12));</span>
<span class="nc" id="L117">              labelStepsReview.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="nc" id="L118">              labelStepsReview.setHorizontalTextPosition(SwingConstants.CENTER);</span>
<span class="nc" id="L119">              panel1_b.add(labelStepsReview,null);</span>
            }

      // CPI
<span class="nc" id="L123">      private JPanel panel2 = new JPanel(new FlowLayout(FlowLayout.CENTER,0,0));</span>
<span class="nc" id="L124">      private JPanel panel2a = new JPanel(new GridLayout(2,2));</span>
      {
<span class="nc" id="L126">        panel2.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L127">        panel2.add(panel2a,null);</span>
<span class="nc" id="L128">        inputPanel.add(panel2, null);</span>
      }
<span class="nc" id="L130">      private JLabel labelCPI = new JLabel(&quot;Consumer Price Index (CPI) :&quot;);</span>
      {
<span class="nc" id="L132">        labelCPI.setFont(new java.awt.Font(&quot;Dialog&quot;, 1, 12));</span>
<span class="nc" id="L133">        panel2a.add(labelCPI, null);</span>
      }
<span class="nc" id="L135">      private JPanel panel_a = new JPanel(new FlowLayout(FlowLayout.LEFT));</span>
<span class="nc" id="L136">      private JTextField textCPI = new JTextField(10);</span>
      {
<span class="nc" id="L138">        textCPI.setBorder(BorderFactory.createLoweredBevelBorder());</span>
<span class="nc" id="L139">        panel2a.add(panel_a, null);</span>
<span class="nc" id="L140">        panel_a.add(textCPI,null);</span>
      }
<span class="nc" id="L142">      private JLabel labelPercentage = new JLabel(&quot;Increasing Percentage :&quot;);</span>
      {
<span class="nc" id="L144">        labelPercentage.setFont(new java.awt.Font(&quot;Dialog&quot;, 1, 12));</span>
<span class="nc" id="L145">        panel2a.add(labelPercentage, null);</span>
      }
<span class="nc" id="L147">      private JPanel panel_b = new JPanel(new FlowLayout(FlowLayout.LEADING));</span>
<span class="nc" id="L148">      private JTextField textPercentage = new JTextField(10);</span>
      {
<span class="nc" id="L150">        textPercentage.setBorder(BorderFactory.createLoweredBevelBorder());</span>
<span class="nc" id="L151">        panel2a.add(panel_b, null);</span>
<span class="nc" id="L152">        panel_b.add(textPercentage,null);</span>
      }
      // Price Variables
<span class="nc" id="L155">      private JPanel panel3 = new JPanel(new FlowLayout(FlowLayout.CENTER,0,0));</span>
<span class="nc" id="L156">      private JPanel panel3a = new JPanel(new GridLayout(2,1));</span>
<span class="nc" id="L157">      private JRadioButton[] buttons = new JRadioButton[2];</span>
<span class="nc" id="L158">      private ButtonGroup group = new ButtonGroup();</span>
      {
<span class="nc" id="L160">        buttons[0] = new JRadioButton(&quot;Average Price (AP)&quot;);</span>
<span class="nc" id="L161">        buttons[1] = new JRadioButton(&quot;Marginal Price (MP)&quot;);</span>
<span class="nc" id="L162">        group.add(buttons[0]);</span>
<span class="nc" id="L163">        group.add(buttons[1]);</span>
<span class="nc" id="L164">        buttons[0].setSelected(true);</span>
<span class="nc" id="L165">        panel3a.add(buttons[0],null);</span>
<span class="nc" id="L166">        panel3a.add(buttons[1],null);</span>
<span class="nc" id="L167">        panel3a.setBorder(BorderFactory.createEmptyBorder(5,0,5,0));</span>
<span class="nc" id="L168">        panel3.add(panel3a,null);</span>
<span class="nc" id="L169">        inputPanel.add(panel3,null);</span>
      }


//***************************END of input panel*********************************



      //*******************************************************
      // TABLE PANEL

<span class="nc" id="L180">      private JPanel tablePanel = new JPanel(new FlowLayout(FlowLayout.CENTER));</span>
      {
<span class="nc" id="L182">        tablePanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L183">        contentPane.add(tablePanel,  BorderLayout.CENTER);</span>
      }

      //*******************************************************

<span class="nc" id="L188">      private TableModel model = new AbstractTableModel(){</span>
		private static final long serialVersionUID = 8205637828692708450L;
<span class="nc" id="L190">		private String[] columnsNames = {&quot;Block No&quot;,&quot;Limit Down&quot;, &quot;Limit Up&quot; , &quot;Price&quot;};</span>
<span class="nc" id="L191">          private Object[][] data = new Object[10][4];</span>

          {
             // Initialize price table
<span class="nc bnc" id="L195" title="All 2 branches missed.">             for(int i=0 ; i&lt;10 ;i++)</span>
<span class="nc" id="L196">               data[i][0]= String.valueOf(i+1);</span>
<span class="nc" id="L197">             data[0][1] = &quot;0&quot;;</span>
<span class="nc" id="L198">          }</span>

<span class="nc" id="L200">          public int getColumnCount() { return columnsNames.length; }</span>
<span class="nc" id="L201">          public int getRowCount() { return data.length;}</span>
<span class="nc" id="L202">          public String getColumnName(int col) { return columnsNames[col];}</span>
          public Object getValueAt(int row, int col) {
<span class="nc" id="L204">             return data[row][col];</span>
          }

          public void setValueAt(Object value, int row, int col){
<span class="nc" id="L208">                data[row][col] = value;</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">                if(col == 2)</span>
<span class="nc" id="L210">                   data[row+1][col-1] = value;</span>
<span class="nc" id="L211">                fireTableCellUpdated (row, col);</span>
<span class="nc" id="L212">          }</span>

          public boolean isCellEditable(int row, int column) {
                  // 1st &amp; 2nd columns is read-only (limit Down)
<span class="nc bnc" id="L216" title="All 4 branches missed.">                  return ((column != 0) &amp;&amp; (column !=1))  ;</span>
          }

      };



<span class="nc" id="L223">      private JTable table = new JTable(model);</span>

<span class="nc" id="L225">      private JScrollPane scroll = new JScrollPane(table);</span>
      {
<span class="nc" id="L227">        scroll.setBorder(BorderFactory.createRaisedBevelBorder());</span>
<span class="nc" id="L228">        scroll.setPreferredSize(new Dimension(300,100));</span>
<span class="nc" id="L229">        tablePanel.add(scroll,null);</span>
      }

      //***************************END of List Panel**********************


      //*******************************************************
      // NAVIGATION PANEL

<span class="nc" id="L238">      private JPanel navigationPanel = new JPanel(new FlowLayout(FlowLayout.CENTER,30,10));</span>
      {
<span class="nc" id="L240">        navigationPanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L241">        navigationPanel.setPreferredSize(new Dimension(0,40));</span>
<span class="nc" id="L242">        contentPane.add(navigationPanel,  BorderLayout.SOUTH);</span>
      }

      //*******************************************************

<span class="nc" id="L247">      private JButton cancelButton = new JButton(&quot;    Cancel    &quot;);</span>
      {

<span class="nc" id="L250">        cancelButton.setBorder(BorderFactory.createRaisedBevelBorder());</span>
<span class="nc" id="L251">        navigationPanel.add(cancelButton,null);</span>
<span class="nc" id="L252">        cancelButton.addActionListener(new ActionListener(){</span>
              public void actionPerformed(ActionEvent ev){
<span class="nc" id="L254">                    try{PricingPolicyFrame.this.setClosed(true);}</span>
<span class="nc" id="L255">                    catch(java.beans.PropertyVetoException ex){}</span>
<span class="nc" id="L256">              }</span>
        });
      } // END cancelButton

      /*private JButton previousButton = new JButton(&quot;  &lt;&lt; Previous  &quot;);
      {
        previousButton.setBorder(BorderFactory.createRaisedBevelBorder());
        navigationPanel.add(previousButton);
        previousButton.addActionListener(new ActionListener(){
            public void actionPerformed(ActionEvent ev){
                step5.setVisible(false);
                step4 = new Step4Frame();
            }
        });
      } // END previousButton*/

<span class="nc" id="L272">      private JButton okButton = new JButton(&quot;  OK  &quot;);</span>
      {
<span class="nc" id="L274">        okButton.setBorder(BorderFactory.createRaisedBevelBorder());</span>
<span class="nc" id="L275">        navigationPanel.add(okButton);</span>

<span class="nc" id="L277">        okButton.addActionListener(new ActionListener(){</span>
            @SuppressWarnings(&quot;unchecked&quot;)
			public void actionPerformed(ActionEvent ev){

<span class="nc" id="L281">                int countBlocks = 1;</span>
<span class="nc bnc" id="L282" title="All 6 branches missed.">                while ( countBlocks&lt;10 &amp;&amp; model.getValueAt(countBlocks,3)!=null &amp;&amp; !model.getValueAt(countBlocks,3).equals((String)&quot;&quot;))</span>
<span class="nc" id="L283">                   countBlocks++;</span>

                // Set last block's limit up to infinity
<span class="nc" id="L286">                model.setValueAt(&quot;1000000&quot;,countBlocks-1,2);</span>

<span class="nc" id="L288">                boolean check = true;</span>

                try{
<span class="nc" id="L291">                   reviewPeriod = new Integer(textReview.getText());</span>
<span class="nc" id="L292">                   CPI =  new Float(textCPI.getText());</span>
<span class="nc" id="L293">                   CPIpercentage = new Float(textPercentage.getText());</span>
                }
<span class="nc" id="L295">                catch(NumberFormatException nfee){</span>
<span class="nc" id="L296">                  JOptionPane.showMessageDialog(PricingPolicyFrame.this,&quot; Invalid input!! CPI's attributes must be a float and review period an integer&quot;</span>
                                                                ,&quot;Error&quot;,JOptionPane.ERROR_MESSAGE);

<span class="nc" id="L299">                  check = false;</span>
<span class="nc" id="L300">                }</span>

<span class="nc bnc" id="L302" title="All 4 branches missed.">                if (check &amp;&amp; checkTable(countBlocks)){</span>
<span class="nc" id="L303">                    priceData.removeAllElements();</span>
<span class="nc" id="L304">                    priceData.addElement(new Integer(chosenScenario));</span>
<span class="nc" id="L305">                    priceData.addElement(PricingPolicyFrame.this.scenarioVariables);</span>
<span class="nc" id="L306">                    priceData.addElement(reviewPeriod);</span>
<span class="nc" id="L307">                    priceData.addElement(CPI);</span>
<span class="nc" id="L308">                    priceData.addElement(CPIpercentage);</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">                    if (buttons[0].isSelected())</span>
<span class="nc" id="L310">                      priceData.addElement(new String(&quot;AP&quot;));</span>
                    else
<span class="nc" id="L312">                      priceData.addElement(new String(&quot;MP&quot;));</span>
<span class="nc" id="L313">                    priceData.addElement(new Integer(countBlocks));</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                    for(int i = 0; i&lt;countBlocks;i++){</span>
<span class="nc" id="L315">                        priceData.addElement(new Integer(model.getValueAt(i,1).toString()));</span>
<span class="nc" id="L316">                        priceData.addElement(new Integer(model.getValueAt(i,2).toString()));</span>
<span class="nc" id="L317">                        priceData.addElement(new Float(model.getValueAt(i,3).toString()));</span>
                    }

<span class="nc" id="L320">                    GuiEvent ge = new GuiEvent((Object) this, SimulationAgent.PRICING_POLICY_INPUT);</span>
<span class="nc" id="L321">                    ge.addParameter(priceData);</span>
<span class="nc" id="L322">                    myAgent.postGuiEvent(ge);</span>

<span class="nc" id="L324">                    PricingPolicyFrame.this.setVisible(false);</span>

                }
<span class="nc" id="L327">            }</span>
        });
      } // END okButton

      private boolean checkTable(int blocks){
        try{
<span class="nc bnc" id="L333" title="All 2 branches missed.">           for(int i=0;i&lt;blocks;i++){</span>
<span class="nc" id="L334">                new Integer((String)model.getValueAt(i,2));</span>
<span class="nc" id="L335">                new Float((String)model.getValueAt(i,3));</span>
           }
        }
<span class="nc" id="L338">        catch(NumberFormatException nfe){</span>
<span class="nc" id="L339">               JOptionPane.showMessageDialog(PricingPolicyFrame.this,</span>
                        &quot; Invalid input !! Limit down must be an integer and price must be a float&quot;,
                                                                       &quot;Error&quot;,JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L342">               return false;</span>
        }
<span class="nc" id="L344">        catch(NullPointerException npe){</span>
<span class="nc" id="L345">               JOptionPane.showMessageDialog(PricingPolicyFrame.this,</span>
                        &quot; Price table is not properly filled in!!&quot;,&quot;Error&quot;,JOptionPane.ERROR_MESSAGE);
<span class="nc" id="L347">               return false;</span>
<span class="nc" id="L348">        }</span>
<span class="nc" id="L349">        return true;</span>
      }
      //***************************END of Navigation Panel**********************

      private void setDataToFields(){
<span class="nc bnc" id="L354" title="All 2 branches missed.">          for(int i=0; i &lt; this.availablePricingScenarios.length ; i++)</span>
<span class="nc" id="L355">               this.scenarioCombo.addItem(this.availablePricingScenarios[i]);</span>

<span class="nc" id="L357">          this.scenarioCombo.setSelectedIndex(((Integer)priceData.elementAt(0)).intValue());</span>
          // not used yet
          //this.scenarioVariables = (Vector) priceData.elementAt(1);
<span class="nc" id="L360">          this.textReview.setText(((Integer)priceData.elementAt(2)).toString());</span>
<span class="nc" id="L361">          this.textCPI.setText(((Float)priceData.elementAt(3)).toString());</span>
<span class="nc" id="L362">          this.textPercentage.setText(((Float)priceData.elementAt(4)).toString());</span>
<span class="nc bnc" id="L363" title="All 2 branches missed.">          if ( ((String)priceData.elementAt(5)).equals(&quot;AP&quot;))</span>
<span class="nc" id="L364">              this.buttons[0].setSelected(true);</span>
          else
<span class="nc" id="L366">              this.buttons[1].setSelected(true);</span>

<span class="nc" id="L368">          int j = 7;</span>
<span class="nc bnc" id="L369" title="All 2 branches missed.">          for(int i = 0; i &lt; ((Integer)priceData.elementAt(6)).intValue() ;i++){</span>
<span class="nc" id="L370">              model.setValueAt(priceData.elementAt(j).toString(),i,1);</span>
<span class="nc" id="L371">              j++;</span>
<span class="nc" id="L372">              model.setValueAt(priceData.elementAt(j).toString(),i,2);</span>
<span class="nc" id="L373">              j++;</span>
<span class="nc" id="L374">              model.setValueAt(priceData.elementAt(j).toString(),i,3);</span>
<span class="nc" id="L375">              j++;</span>
          }
<span class="nc" id="L377">      }</span>


}// END of Pricing Policy Frame
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>