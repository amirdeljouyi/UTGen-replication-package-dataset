<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProgressGui.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.SA.gui</a> &gt; <span class="el_source">ProgressGui.java</span></div><h1>ProgressGui.java</h1><pre class="source lang-java linenums">package simulator.SA.gui;


import jade.gui.GuiEvent;

import java.awt.*;
import javax.swing.*;

import org.apache.log4j.Logger;

import java.awt.event.*;

import java.util.Hashtable;

import simulator.SA.SimulationAgent;
import simulator.util.ConsumerAttributes;
import simulator.util.ConsumerType;
import de.progra.charting.*;
import de.progra.charting.model.*;
import de.progra.charting.render.*;
import de.progra.charting.swing.*;
import de.progra.charting.event.*;

/**
 * @author Vartalas Panagiotis
 * @author Ioannis N. Athanasiadis
 * @version 1.9
 * @since 2003-2006
 */

public class ProgressGui extends JInternalFrame implements  ChartDataModelListener {
  private static final long serialVersionUID = 502015433522322368L;
<span class="nc" id="L33">  private Logger log = Logger.getLogger(ProgressGui.class);</span>
  
<span class="nc" id="L35">  private JTabbedPane mainPanel = new JTabbedPane();</span>
<span class="nc" id="L36">  private JPanel tab1 = new JPanel(new BorderLayout());</span>
<span class="nc" id="L37">  private JPanel barPanel = new JPanel();</span>
<span class="nc" id="L38">  private JPanel titlePanel = new JPanel();</span>
<span class="nc" id="L39">  private JPanel centralPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L40">  private JPanel messagePanel = new JPanel(new GridLayout(1,1));</span>
<span class="nc" id="L41">  private JPanel gridPanel = new JPanel(new GridLayout(0,1));</span>

<span class="nc" id="L43">  private FlowLayout flowLayout1 = new FlowLayout(FlowLayout.CENTER,20,20);</span>
<span class="nc" id="L44">  private FlowLayout flowLayout2 = new FlowLayout(FlowLayout.CENTER,20,20);</span>

  private GridCanvas grid;

<span class="nc" id="L48">  private JTextArea messageArea = new JTextArea();</span>
<span class="nc" id="L49">  private JScrollPane scrollMessage = new JScrollPane(messageArea);</span>

<span class="nc" id="L51">  private JProgressBar progressBar = new JProgressBar();</span>
<span class="nc" id="L52">  private JLabel title = new JLabel();</span>
<span class="nc" id="L53">  private JButton startButton = new JButton();</span>

  private ChartPanel chartPanel;
  private EditableChartDataModel chartDataModel;

  private SimulationAgent myAgent;
  @SuppressWarnings(&quot;unused&quot;)
private ConsumerAttributes[] consumers;



  //**************
  // Constructor *
  //**************

<span class="nc" id="L68">  public ProgressGui(SimulationAgent a) {</span>
<span class="nc" id="L69">    this.myAgent = a;</span>

    //************
    // Tab2

<span class="nc" id="L74">    gridPanel.setName(&quot;Grid&quot;);</span>
<span class="nc" id="L75">    gridPanel.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createEmptyBorder(10,10,10,10),</span>
<span class="nc" id="L76">                                                           BorderFactory.createRaisedBevelBorder()));</span>


<span class="nc" id="L79">    try { jbInit(); }</span>
<span class="nc" id="L80">    catch(Exception e) { log.error(e.getStackTrace()); }</span>

    //***********************
    // Chart Panel

    // Init some starting data
<span class="nc" id="L86">    double[][] model = {{0.0,0.1}};</span>
<span class="nc" id="L87">    double[] columns = {0.0,1.0};</span>
<span class="nc" id="L88">    String[] rows = {&quot;Step Total&quot;};</span>
<span class="nc" id="L89">    String title = &quot;Viewing Total Consumption&quot;;</span>

    // Create an editable chart data model
<span class="nc" id="L92">    chartDataModel = new EditableChartDataModel(model, columns, rows);</span>
    // Creating the Swing ChartPanel instead of DefaultChart
<span class="nc" id="L94">    chartPanel = new ChartPanel(chartDataModel, title, DefaultChart.LINEAR_X_LINEAR_Y);</span>
    // Adding ChartRenderer as usual
<span class="nc" id="L96">    chartPanel.addChartRenderer(new LineChartRenderer(chartPanel.getCoordSystem(), chartDataModel), 1);</span>
    // Register EventListener
<span class="nc" id="L98">    chartDataModel.addChartDataModelListener(this);</span>


    //***************************

<span class="nc" id="L103">    this.setLocation(0,0);</span>
<span class="nc" id="L104">    this.setSize(600,500);</span>
<span class="nc" id="L105">    this.setClosable(true);</span>
<span class="nc" id="L106">    this.setMaximizable(true);</span>
<span class="nc" id="L107">    this.setIconifiable(true);</span>
<span class="nc" id="L108">    this.setDefaultCloseOperation(JInternalFrame.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L109">    this.getContentPane().add(mainPanel,null);</span>
<span class="nc" id="L110">    mainPanel.add(tab1,null);</span>
<span class="nc" id="L111">    mainPanel.add(gridPanel,null);</span>
<span class="nc" id="L112">    mainPanel.setSelectedComponent(tab1);</span>
<span class="nc" id="L113">    tab1.add(titlePanel, BorderLayout.NORTH);</span>
<span class="nc" id="L114">    tab1.add(centralPanel,BorderLayout.CENTER);</span>
<span class="nc" id="L115">    tab1.add(barPanel,BorderLayout.SOUTH);</span>
<span class="nc" id="L116">    tab1.setFocusable(true);</span>


    //chart panel is added to frame when the first result arrives (at updateGui method)

<span class="nc" id="L121"> }</span>

  public void chartDataChanged(ChartDataModelEvent evt) {
      // The DataModel changed -&gt; update display
<span class="nc" id="L125">      chartPanel.revalidate();</span>
<span class="nc" id="L126">      repaint();</span>
<span class="nc" id="L127">  }</span>

  private void jbInit() throws Exception {

    //************
    // Tab1

<span class="nc" id="L134">    tab1.setName(&quot;Main&quot;);</span>
<span class="nc" id="L135">    tab1.setBorder(BorderFactory.createEtchedBorder());</span>

    //************
    //Bar Panel

<span class="nc" id="L140">    progressBar.setBorder(BorderFactory.createLoweredBevelBorder());</span>
<span class="nc" id="L141">    progressBar.setPreferredSize(new Dimension(300, 25));</span>
<span class="nc" id="L142">    progressBar.setStringPainted(true);</span>
<span class="nc" id="L143">    startButton.setBorder(BorderFactory.createRaisedBevelBorder());</span>
<span class="nc" id="L144">    startButton.setText(&quot;Start&quot;);</span>
<span class="nc" id="L145">    startButton.addActionListener(new ActionListener(){</span>
             public void actionPerformed(ActionEvent e){
<span class="nc" id="L147">                 GuiEvent ge = new GuiEvent((Object) this, SimulationAgent.START_BUTTON_GUI);</span>
<span class="nc" id="L148">                 myAgent.postGuiEvent(ge);</span>
<span class="nc" id="L149">                 startButton.setEnabled(false);</span>
<span class="nc" id="L150">             }</span>
         }); //addActionListener
<span class="nc" id="L152">    startButton.setEnabled(false);</span>

<span class="nc" id="L154">    barPanel.setLayout(flowLayout1);</span>
<span class="nc" id="L155">    barPanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L156">    barPanel.setPreferredSize(new Dimension(0,70));</span>
<span class="nc" id="L157">    barPanel.add(startButton, null);</span>
<span class="nc" id="L158">    barPanel.add(progressBar, null);</span>


    //************
    //Title Panel

<span class="nc" id="L164">    title.setFont(new java.awt.Font(&quot;Serif&quot;, 1, 14));</span>
<span class="nc" id="L165">    title.setBorder(BorderFactory.createRaisedBevelBorder());</span>
<span class="nc" id="L166">    title.setPreferredSize(new Dimension(200, 30));</span>
<span class="nc" id="L167">    title.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="nc" id="L168">    title.setHorizontalTextPosition(SwingConstants.LEADING);</span>
<span class="nc" id="L169">    title.setText(&quot;Water Demand Simulator&quot;);</span>
<span class="nc" id="L170">    titlePanel.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L171">    titlePanel.setPreferredSize(new Dimension(0,70));</span>
<span class="nc" id="L172">    titlePanel.setLayout(flowLayout2);</span>
<span class="nc" id="L173">    titlePanel.add(title, null);</span>

    //************
    //Central Panel

<span class="nc" id="L178">    messagePanel.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createEmptyBorder(10,10,10,10),</span>
<span class="nc" id="L179">                                                              BorderFactory.createLoweredBevelBorder()));</span>
<span class="nc" id="L180">    messagePanel.add(scrollMessage);</span>
<span class="nc" id="L181">    messagePanel.setPreferredSize(new Dimension(0,150));</span>
<span class="nc" id="L182">    centralPanel.add(messagePanel,BorderLayout.SOUTH);</span>

<span class="nc" id="L184">  }</span>


  //***********
  // GRID
  //***********

  class GridCanvas extends Canvas implements MouseListener{

	private static final long serialVersionUID = 1664514449623126381L;

	//Internal use
<span class="nc" id="L196">    private final Color[] colors = {Color.BLUE,   Color.RED,  Color.GREEN,</span>
                                    Color.YELLOW, Color.PINK, Color.ORANGE,
                                    Color.MAGENTA, Color.CYAN, Color.DARK_GRAY, };

<span class="nc" id="L200">    private int cellDimension = 20;</span>
<span class="nc" id="L201">    private Hashtable typeColor = new Hashtable();</span>
    private int x0,y0;
    private boolean[][] cellOccupied;


    //Inputs
    private int cells;
    @SuppressWarnings(&quot;unused&quot;)
	private ConsumerType[] consumerTypes;
    private ConsumerAttributes[] consumers;


    //Constructor
    @SuppressWarnings(&quot;unchecked&quot;)
<span class="nc" id="L215">	public GridCanvas(int gridDimension,ConsumerAttributes[] consumers,ConsumerType[] consumerTypes){</span>

<span class="nc" id="L217">      this.cells = gridDimension;</span>
<span class="nc" id="L218">      this.cellOccupied = new boolean[gridDimension+1][gridDimension+1];</span>
<span class="nc" id="L219">      this.consumerTypes = consumerTypes;</span>
<span class="nc" id="L220">      this.consumers = consumers;</span>

      //Initialization
<span class="nc bnc" id="L223" title="All 2 branches missed.">      for(int i=0;i&lt;gridDimension;i++)</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">        for(int j=0;j&lt;gridDimension;j++)</span>
<span class="nc" id="L225">          this.cellOccupied[i][j] = false;</span>

      try{
<span class="nc bnc" id="L228" title="All 2 branches missed.">          for(int i=0;i&lt;consumerTypes.length;i++)</span>
<span class="nc" id="L229">              typeColor.put(consumerTypes[i].getName(),colors[i]);</span>
      }
<span class="nc" id="L231">      catch(Exception e){log.error(&quot;Colors are limited... 9!!&quot;);}</span>

      // Add Mouse Listener
<span class="nc" id="L234">      this.addMouseListener(this);</span>

<span class="nc" id="L236">    }</span>

    public void paint(Graphics g){

<span class="nc" id="L240">      Rectangle r = /*gridPanel.*/getBounds();</span>

<span class="nc" id="L242">      x0 = Math.round((int)((r.width-(cells*cellDimension))/2));</span>
<span class="nc" id="L243">      y0 = Math.round((int)((r.height-(cells*cellDimension))/2));</span>

<span class="nc" id="L245">      g.setColor(Color.black);</span>

<span class="nc bnc" id="L247" title="All 2 branches missed.">      for(int i=0; i&lt;=cells;i++){</span>
<span class="nc" id="L248">        g.drawLine(x0,y0+(i*cellDimension),x0+(cells*cellDimension),y0+(i*cellDimension));</span>
      }
<span class="nc bnc" id="L250" title="All 2 branches missed.">      for(int i=0; i&lt;=cells;i++){</span>
<span class="nc" id="L251">        g.drawLine(x0+(i*cellDimension),y0,x0+(i*cellDimension),y0+(cells*cellDimension));</span>
      }

<span class="nc bnc" id="L254" title="All 2 branches missed.">      for(int i=0;i&lt;consumers.length;i++){</span>
<span class="nc" id="L255">        g.setColor(((Color)typeColor.get(consumers[i].getConsumerType())));</span>
<span class="nc" id="L256">        g.fillRect(x0+1+(cellDimension*(consumers[i].getX()-1)),</span>
<span class="nc" id="L257">                   y0+1+(cellDimension*(consumers[i].getY()-1)),19,19);</span>
        //Map consumers position
<span class="nc" id="L259">        cellOccupied[consumers[i].getX()][consumers[i].getY()] = true;</span>
      }

<span class="nc" id="L262">    }//END of paint()</span>

    //MouseListener implementation
    public void mouseClicked(MouseEvent e){
<span class="nc" id="L266">      int x = ((e.getX()-x0)/cellDimension)+1;</span>
<span class="nc" id="L267">      int y = ((e.getY()-y0)/cellDimension)+1;</span>
<span class="nc bnc" id="L268" title="All 8 branches missed.">      if(x&gt;0 &amp;&amp; x&lt;=cells &amp;&amp; y&gt;0 &amp;&amp; y&lt;=cells){</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">          if(cellOccupied[x][y]){</span>
<span class="nc" id="L270">              GuiEvent ge = new GuiEvent((Object) this, SimulationAgent.LAUNCH_CONSUMER_GUI);</span>
<span class="nc" id="L271">              ge.addParameter(&quot;consumer_&quot;+ x + &quot;,&quot; + y);</span>
<span class="nc" id="L272">              myAgent.postGuiEvent(ge);</span>
<span class="nc" id="L273">          }</span>
<span class="nc" id="L274">      }  else log.error(&quot;Out of range&quot;);</span>
<span class="nc" id="L275">    }</span>
<span class="nc" id="L276">    public void mouseReleased(MouseEvent e){}</span>
<span class="nc" id="L277">    public void mousePressed(MouseEvent e){}</span>
<span class="nc" id="L278">    public void mouseEntered(MouseEvent e){}</span>
<span class="nc" id="L279">    public void mouseExited(MouseEvent e){}</span>


  }


  /******************
   *  PUBLIC methods
   ******************/


  public void updateChart(double consumption, double step){
<span class="nc bnc" id="L291" title="All 2 branches missed.">    if (step==1){</span>
<span class="nc" id="L292">              centralPanel.add(chartPanel,BorderLayout.CENTER);</span>
    }
<span class="nc" id="L294">    chartDataModel.insertValue(0, new Double(consumption), new Double(step));</span>
<span class="nc" id="L295">  }</span>


<span class="nc" id="L298">  public void updateBar(int v){ progressBar.setValue(v);}</span>


  public void updateMessageArea(String message){
<span class="nc" id="L302">    this.messageArea.append(message + &quot;\n&quot;);</span>
<span class="nc" id="L303">    scrollMessage.getHorizontalScrollBar().setValue(100);</span>
<span class="nc" id="L304">  }</span>


<span class="nc" id="L307">  public void enableStartButton(boolean b){startButton.setEnabled(b); }</span>

  public void paintGrid(int gridDimension,ConsumerAttributes[] consumers,ConsumerType[] consumerTypes){
<span class="nc" id="L310">    this.consumers = consumers;</span>
<span class="nc" id="L311">    grid = new GridCanvas(gridDimension,consumers,consumerTypes);</span>
<span class="nc" id="L312">    gridPanel.add(grid);</span>
<span class="nc" id="L313">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>