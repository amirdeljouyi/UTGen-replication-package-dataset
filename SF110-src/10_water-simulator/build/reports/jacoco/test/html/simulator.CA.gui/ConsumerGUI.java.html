<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ConsumerGUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">10_water-simulator</a> &gt; <a href="index.source.html" class="el_package">simulator.CA.gui</a> &gt; <span class="el_source">ConsumerGUI.java</span></div><h1>ConsumerGUI.java</h1><pre class="source lang-java linenums">package simulator.CA.gui;


import jade.gui.GuiEvent;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.util.Enumeration;
import java.util.Vector;

import javax.swing.BorderFactory;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTable;
import javax.swing.event.TableModelEvent;
import javax.swing.event.TableModelListener;
import javax.swing.table.AbstractTableModel;

import simulator.CA.ConsumerAgent;
import simulator.util.ConsumerAttributes;
import simulator.util.ParameterAttributes;
import de.progra.charting.DefaultChart;
import de.progra.charting.event.ChartDataModelEvent;
import de.progra.charting.event.ChartDataModelListener;
import de.progra.charting.model.EditableChartDataModel;
import de.progra.charting.model.ObjectChartDataModel;
import de.progra.charting.render.LineChartRenderer;
import de.progra.charting.render.PieChartRenderer;
import de.progra.charting.swing.ChartPanel;


/**
 * &lt;p&gt;Title: Simulator&lt;/p&gt;
 * &lt;p&gt;Description: &lt;/p&gt;
 * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;
 * &lt;p&gt;Company: &lt;/p&gt;
 * @author Vartalas Panagiotis
 * @version 1.0
 */

public class ConsumerGUI extends JFrame implements  ChartDataModelListener, TableModelListener{

	private static final long serialVersionUID = -8962775059023388498L;
	private ConsumerAgent myAgent;
<span class="nc" id="L55">    private JMenuBar menuBar = new JMenuBar();</span>
<span class="nc" id="L56">    private JMenu[] menu = {new JMenu(&quot;File&quot;)};</span>
<span class="nc" id="L57">    private JMenuItem[] items = {new JMenuItem(&quot;Save results&quot;),new JMenuItem(&quot;Exit&quot;)};</span>

<span class="nc" id="L59">    private JPanel contentPane = (JPanel) this.getContentPane();</span>
      {
<span class="nc" id="L61">              contentPane.setLayout(new BorderLayout());</span>
<span class="nc" id="L62">              this.setSize(new Dimension(650,500));</span>
<span class="nc" id="L63">              this.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>

      }

<span class="nc" id="L67">    private JTabbedPane panel = new JTabbedPane();</span>
<span class="nc" id="L68">    private JPanel consumptionPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L69">    private JPanel neighboursPanel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L70">    private JPanel socialParametersPanel = new JPanel(new BorderLayout());</span>
    {
<span class="nc" id="L72">      consumptionPanel.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createLoweredBevelBorder(),</span>
<span class="nc" id="L73">                                                            BorderFactory.createEmptyBorder(30,30,30,30)));</span>
<span class="nc" id="L74">      neighboursPanel.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createLoweredBevelBorder(),</span>
<span class="nc" id="L75">                                                            BorderFactory.createEmptyBorder(30,30,30,30)));</span>
<span class="nc" id="L76">      socialParametersPanel.setBorder(BorderFactory.createCompoundBorder(BorderFactory.createLoweredBevelBorder(),</span>
<span class="nc" id="L77">                                                            BorderFactory.createEmptyBorder(30,30,30,30)));</span>
    }

    // Consumption Panel components
    //*****************************

      // Create an editable chart data model
    private EditableChartDataModel chartDataModel;
      // Creating the Swing ChartPanel instead of DefaultChart
    private ChartPanel chartPanel;


    // Neighbouhood Panel components
    //******************************

<span class="nc" id="L92">    private String[] columnsNamesN = {&quot;Neighbour Name&quot;,&quot;Consumer Type&quot;};</span>
<span class="nc" id="L93">    private JTable neighsTable = new JTable();</span>
<span class="nc" id="L94">    private JScrollPane scroll2 = new JScrollPane(neighsTable);</span>
    private TableDataModel neighsTableDataModel;

      // Create data model
    private ObjectChartDataModel pieChartDataModel;
      // Creating the Swing ChartPanel instead of DefaultChart
    private ChartPanel pieChartPanel;



    // Socialization Panel components
    //*******************************
    private String[] columnsNamesS;// = {&quot;Step No&quot;,&quot;Parameter 1&quot;,&quot;Parameter 2&quot;,&quot;Parameter 3&quot;};
<span class="nc" id="L107">    private JTable socialTable = new JTable();</span>
<span class="nc" id="L108">    private JScrollPane scroll3 = new JScrollPane(socialTable);</span>
    private TableDataModel socialTableDataModel;



    //Constructor
    @SuppressWarnings({&quot;unchecked&quot;,&quot;deprecation&quot;})
	public ConsumerGUI(ConsumerAgent a,Vector consumptions, ConsumerAttributes[] myNeighbours,
                                                                ParameterAttributes[] socialParameters,
<span class="nc" id="L117">                                                                Object[] socialParametersWeightsPerStep){</span>

<span class="nc" id="L119">      this.myAgent = a;</span>

      //Menu
<span class="nc" id="L122">      this.menu[0].add(items[0]);</span>
<span class="nc" id="L123">      this.menu[0].addSeparator();</span>
<span class="nc" id="L124">      this.menu[0].add(items[1]);</span>
<span class="nc" id="L125">      menuBar.add(menu[0]);</span>
<span class="nc" id="L126">      this.setJMenuBar(menuBar);</span>
<span class="nc" id="L127">      items[0].addActionListener(new menuActionListener());</span>
<span class="nc" id="L128">      items[1].addActionListener(new menuActionListener());</span>

      //Consumption Panel
      //*****************

      // Init some starting data
<span class="nc" id="L134">      double[][] chartModel = {{0.0,0.1}};</span>
<span class="nc" id="L135">      double[] chartColumns = {0.0,1.0};</span>
<span class="nc" id="L136">      String[] chartRows = {&quot;Consumption&quot;};</span>
<span class="nc" id="L137">      String chartTitle = &quot;Viewing &quot; + myAgent.getLocalName()+ &quot; Consumption&quot;;</span>
<span class="nc" id="L138">      chartDataModel = new EditableChartDataModel(chartModel,chartColumns,chartRows);</span>
<span class="nc" id="L139">      chartPanel = new ChartPanel(chartDataModel,chartTitle, DefaultChart.LINEAR_X_LINEAR_Y);</span>
        // Adding ChartRenderer as usual
<span class="nc" id="L141">      chartPanel.addChartRenderer(new LineChartRenderer(chartPanel.getCoordSystem(), chartDataModel), 1);</span>
        // Register EventListener
<span class="nc" id="L143">      chartDataModel.addChartDataModelListener(this);</span>

      //Update data model with new consumtpions
<span class="nc bnc" id="L146" title="All 2 branches missed.">      for(int i = 0; i&lt;consumptions.size() ; i++){</span>
<span class="nc" id="L147">        chartDataModel.insertValue(0, new Double(((Float)consumptions.elementAt(i)).doubleValue()),</span>
                                                                                           new Double(i));
      }


      //Neighbours Panel
      //****************

<span class="nc bnc" id="L155" title="All 2 branches missed.">      if(myNeighbours.length != 0 ){</span>
          // Define model for neighboursTable
<span class="nc" id="L157">        neighsTableDataModel = new TableDataModel(columnsNamesN,myNeighbours.length);</span>
<span class="nc" id="L158">        neighsTable.setModel(neighsTableDataModel);</span>

          // Fill in neighbours
<span class="nc" id="L161">        Vector consumerTypes = new Vector(0);</span>
<span class="nc" id="L162">        neighsTable.setValueAt(myNeighbours[0].getName(),0,0);</span>
<span class="nc" id="L163">        neighsTable.setValueAt(myNeighbours[0].getConsumerType(),0,1);</span>
<span class="nc" id="L164">        consumerTypes.addElement(myNeighbours[0].getConsumerType());</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">        for(int i=1; i&lt;myNeighbours.length;i++){</span>
<span class="nc" id="L167">            neighsTable.setValueAt(myNeighbours[i].getName(),i,0);</span>
<span class="nc" id="L168">            neighsTable.setValueAt(myNeighbours[i].getConsumerType(),i,1);</span>
            //Count consumer types in my neighbourhood
<span class="nc" id="L170">            Enumeration e = consumerTypes.elements();</span>
<span class="nc" id="L171">            boolean contains = false;</span>
<span class="nc bnc" id="L172" title="All 4 branches missed.">            while(e.hasMoreElements() &amp;&amp; !contains){</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">              if (myNeighbours[i].getConsumerType().equals((String)e.nextElement())){</span>
<span class="nc" id="L174">                contains = true;</span>
              }
<span class="nc bnc" id="L176" title="All 2 branches missed.">              else if (!e.hasMoreElements())</span>
<span class="nc" id="L177">                consumerTypes.addElement(myNeighbours[i].getConsumerType());</span>
            }
        }//END for

<span class="nc" id="L181">        int[][] pieModel = new int [consumerTypes.size()][1];     // Create data array</span>

<span class="nc" id="L183">        String[] pieColumns = {&quot;1&quot;};  // Create x-axis values</span>

<span class="nc" id="L185">        String[] pieRows = new String[consumerTypes.size()];   // Create data set title</span>
<span class="nc" id="L186">        consumerTypes.copyInto(pieRows);</span>

<span class="nc" id="L188">        String pieTitle = &quot;Consumer Types Distribution in my Neighbourhood&quot;;  // Create diagram title</span>

        //Fill in model (count neighbours of each consumer type)
<span class="nc bnc" id="L191" title="All 2 branches missed.">        for(int j=0 ; j&lt;myNeighbours.length ; j++){</span>
<span class="nc" id="L192">            int i=0;</span>
<span class="nc" id="L193">            boolean counted = false;</span>
<span class="nc bnc" id="L194" title="All 4 branches missed.">            while( (i&lt;consumerTypes.size()) &amp;&amp; !counted ){</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">               if (myNeighbours[j].getConsumerType().equals(pieRows[i])){</span>
<span class="nc" id="L196">                          pieModel[i][0]++;</span>
<span class="nc" id="L197">                          counted = true;</span>
               }
               else
<span class="nc" id="L200">                      i++;</span>
            }// END while
        }//END j-loop

        //rows: consumer type + percentage
<span class="nc bnc" id="L205" title="All 2 branches missed.">        for(int i=0;i&lt;consumerTypes.size();i++){</span>
<span class="nc" id="L206">            float percentage = (pieModel[i][0]*100)/myNeighbours.length;</span>
<span class="nc" id="L207">            pieRows[i] = ((String)consumerTypes.elementAt(i)) + &quot; : &quot; + percentage + &quot;%&quot;;</span>
        }


<span class="nc" id="L211">        pieChartDataModel = new ObjectChartDataModel(pieModel, pieColumns, pieRows);</span>

          // Create chart with default coordinate system
<span class="nc" id="L214">        pieChartPanel = new ChartPanel(pieChartDataModel, pieTitle);</span>

          // Add a line chart renderer
<span class="nc" id="L217">        pieChartPanel.addChartRenderer(new PieChartRenderer(pieChartDataModel),1);</span>
        //pieChartPanel.setBorder(BorderFactory.createEtchedBorder());

      }//END if-neighbours!=0




      //SocializationTab
      //****************
<span class="nc bnc" id="L227" title="All 2 branches missed.">       if (socialParameters.length!= 0){</span>
          // Define model for socialTable
<span class="nc" id="L229">          columnsNamesS = new String[socialParameters.length+1];</span>
<span class="nc" id="L230">          columnsNamesS[0] = &quot;Step No&quot;;</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">          for(int i=1;i&lt;columnsNamesS.length;i++)</span>
<span class="nc" id="L232">            columnsNamesS[i] = socialParameters[i-1].getName();</span>

<span class="nc" id="L234">          socialTableDataModel = new TableDataModel(columnsNamesS,</span>
<span class="nc" id="L235">                                  ((Vector)socialParametersWeightsPerStep[socialParameters.length-1]).size());</span>
<span class="nc" id="L236">          socialTableDataModel.addTableModelListener(this);</span>
<span class="nc" id="L237">          socialTable.setModel(socialTableDataModel);</span>


          // Fill in social parametrs

<span class="nc bnc" id="L242" title="All 2 branches missed.">          for(int i=0; i&lt;((Vector)socialParametersWeightsPerStep[0]).size() ;i++){</span>
<span class="nc" id="L243">             socialTable.setValueAt(new Integer(i+1),i,0);</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">             for(int j=1 ; j&lt; columnsNamesS.length ; j++)</span>
<span class="nc" id="L245">               socialTable.setValueAt(((Vector)socialParametersWeightsPerStep[j-1]).elementAt(i),i,j);</span>

          }
      }

<span class="nc" id="L250">      contentPane.add(panel);</span>
<span class="nc" id="L251">      panel.addTab(&quot;Consumption&quot;,consumptionPanel);</span>
<span class="nc" id="L252">      consumptionPanel.add(chartPanel,BorderLayout.CENTER);</span>
<span class="nc" id="L253">      panel.addTab(&quot;Neighbourhood&quot;,neighboursPanel);</span>
<span class="nc" id="L254">      scroll2.setPreferredSize(new Dimension(0,200) );</span>
<span class="nc" id="L255">      neighboursPanel.add(scroll2,BorderLayout.NORTH);</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">      if (myNeighbours.length != 0){</span>
<span class="nc" id="L257">               neighboursPanel.setPreferredSize(new Dimension(this.getWidth(),250));</span>
<span class="nc" id="L258">               neighboursPanel.add(pieChartPanel,BorderLayout.CENTER);</span>
      }
<span class="nc" id="L260">      panel.addTab(&quot;Socializition&quot;,socialParametersPanel);</span>
<span class="nc" id="L261">      socialParametersPanel.add(scroll3,BorderLayout.CENTER);</span>

<span class="nc" id="L263">      this.setTitle(&quot;Water Demand Simulator - &quot; + myAgent.getLocalName() + &quot;  Status&quot;);</span>
<span class="nc" id="L264">      this.setLocation(50,50);</span>
<span class="nc" id="L265">      this.show();</span>

<span class="nc" id="L267">    }// END of constructor</span>



    /*******************************************
     * tableDataModel
     * &lt;p&gt;Title: Simulator&lt;/p&gt;
     * &lt;p&gt;Description: &lt;/p&gt;
     * &lt;p&gt;Copyright: Copyright (c) 2003&lt;/p&gt;
     * &lt;p&gt;Company: &lt;/p&gt;
     * @author Vartalas Panagiotis
     * @version 1.0
     */

    private class TableDataModel extends AbstractTableModel{

		private static final long serialVersionUID = -7463336493241742489L;
		private String[] columnsNames;
        private Object[] data;

<span class="nc" id="L287">        public TableDataModel(String[] colNames,int rowsCount){</span>
<span class="nc" id="L288">            columnsNames = colNames;</span>
<span class="nc" id="L289">            data = new Object[columnsNames.length];</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">            for(int i=0; i &lt; columnsNames.length ; i++)</span>
<span class="nc" id="L291">              data[i] = new Vector(0,1);</span>
<span class="nc" id="L292">        }</span>

<span class="nc" id="L294">        public int getRowCount() {return ((Vector)data[columnsNames.length-1]).size();}</span>
<span class="nc" id="L295">        public int getColumnCount() {return columnsNames.length;}</span>
<span class="nc" id="L296">        public String getColumnName(int col) { return columnsNames[col];}</span>
<span class="nc" id="L297">        public Object getValueAt(int row, int column){ return ((Vector)data[column]).elementAt(row);}</span>
        @SuppressWarnings(&quot;unchecked&quot;)
		public void setValueAt(Object value,int row,int column){
<span class="nc" id="L300">          ((Vector)data[column]).addElement(value);</span>
<span class="nc" id="L301">          this.fireTableDataChanged();</span>
<span class="nc" id="L302">        }</span>
<span class="nc" id="L303">        public boolean isCellEditable(int row,int column){return false;}</span>

        //Used only for socialTable
        @SuppressWarnings(&quot;unchecked&quot;)
		public void addValueAtColumn(Object value,int step, int column){
<span class="nc bnc" id="L308" title="All 2 branches missed.">          if(column !=1)</span>
<span class="nc" id="L309">            ((Vector)data[column]).addElement(value);</span>
          else{
<span class="nc" id="L311">              ((Vector)data[0]).addElement(new Integer(step));</span>
<span class="nc" id="L312">              ((Vector)data[1]).addElement(value);</span>
          }
<span class="nc" id="L314">          this.fireTableDataChanged();</span>
<span class="nc" id="L315">        }</span>

    }// END of model


    /**
     * Implementation of ChartDataModelListener
     * @param evt
     */

    public void chartDataChanged(ChartDataModelEvent evt) {
      // The DataModel changed -&gt; update display
<span class="nc" id="L327">      chartPanel.revalidate();</span>
<span class="nc" id="L328">      repaint();</span>
<span class="nc" id="L329">    }</span>

    public void tableChanged(TableModelEvent e){
<span class="nc" id="L332">      socialTable.revalidate();</span>
<span class="nc" id="L333">      repaint();</span>
<span class="nc" id="L334">    }</span>

    public void updateChart(double consumption, double step){
<span class="nc" id="L337">      chartDataModel.insertValue(0, new Double(consumption), new Double(step));</span>
<span class="nc" id="L338">    }</span>

    public void updateSocialTable(float value, int step, int column){
<span class="nc" id="L341">      socialTableDataModel.addValueAtColumn(new Float(value),step,column+1);</span>
<span class="nc" id="L342">    }</span>

<span class="nc" id="L344">    class menuActionListener implements ActionListener{</span>
        @SuppressWarnings(&quot;deprecation&quot;)
		public void actionPerformed(ActionEvent e){
           GuiEvent ge;

<span class="nc bnc" id="L349" title="All 2 branches missed.">           if (e.getActionCommand() == &quot;Save results&quot;) {</span>
              // Save Scenario
<span class="nc" id="L351">              ge = new GuiEvent((Object) this, ConsumerAgent.SAVE_RESULTS);</span>
<span class="nc" id="L352">              ge.addParameter(saveFile());</span>
<span class="nc" id="L353">              myAgent.postGuiEvent(ge);</span>
           }
<span class="nc" id="L355">           else ConsumerGUI.this.hide();</span>

<span class="nc" id="L357">        }</span>
    }// End of menuActionListener

    private File saveFile(){

<span class="nc" id="L362">        String msg = &quot;&quot;;</span>
        File chosenFile;

        // instantiate file chooser
<span class="nc" id="L366">        JFileChooser chooser = new JFileChooser(System.getProperty(&quot;user.dir&quot;));</span>

        // file chooser properties
<span class="nc" id="L369">        chooser.setControlButtonsAreShown(true);</span>
<span class="nc" id="L370">        chooser.setDialogType(JFileChooser.SAVE_DIALOG);</span>
<span class="nc" id="L371">        chooser.setAcceptAllFileFilterUsed(true);</span>
<span class="nc" id="L372">        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);</span>
<span class="nc" id="L373">        chooser.setMultiSelectionEnabled(false);</span>
<span class="nc" id="L374">        chooser.setSelectedFile(null);</span>
<span class="nc" id="L375">        chooser.setDialogTitle(&quot;Save Results&quot;);</span>
<span class="nc" id="L376">        double w = (contentPane.getBounds().getWidth()/2)-40;</span>
<span class="nc" id="L377">        double h = (contentPane.getBounds().getHeight()/2)-40;</span>
<span class="nc" id="L378">        chooser.setLocation((int)w,(int)h);</span>

<span class="nc" id="L380">        int returnValue = chooser.showSaveDialog(contentPane);</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">	if (returnValue == JFileChooser.APPROVE_OPTION) {</span>
<span class="nc" id="L382">	         chosenFile = chooser.getSelectedFile();</span>
<span class="nc bnc" id="L383" title="All 2 branches missed.">		    if (chosenFile != null) {</span>
<span class="nc" id="L384">		        JOptionPane.showMessageDialog(contentPane,&quot;Saving in this directory : &quot; + chosenFile.getPath()</span>
                                                          ,&quot;Save &quot;,JOptionPane.INFORMATION_MESSAGE);
<span class="nc" id="L386">                        return chosenFile;</span>
	            }
<span class="nc bnc" id="L388" title="All 2 branches missed.">        } else if (returnValue == JFileChooser.CANCEL_OPTION) {</span>
<span class="nc" id="L389">	         msg = &quot;User cancelled operation. No directory was chosen.&quot;;</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">	    } else if (returnValue == JFileChooser.ERROR_OPTION) {</span>
<span class="nc" id="L391">	         msg = &quot;An error occured. No directory was chosen.&quot;;</span>
	        } else {
<span class="nc" id="L393">	                 msg =  &quot;Unknown operation occured.&quot;;</span>
	                }

<span class="nc" id="L396">        JOptionPane.showMessageDialog(contentPane,msg,&quot;Save scenario&quot;,JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L397">        return null;</span>


  }

}// END of GUI
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>