<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Statemachine2Java.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">14_omjstate</a> &gt; <a href="index.source.html" class="el_package">uk.me.jockmacmad.jstate.tools</a> &gt; <span class="el_source">Statemachine2Java.java</span></div><h1>Statemachine2Java.java</h1><pre class="source lang-java linenums">package uk.me.jockmacmad.jstate.tools;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

import org.apache.velocity.VelocityContext;
import org.apache.velocity.app.Velocity;
import org.apache.velocity.exception.MethodInvocationException;
import org.apache.velocity.exception.ParseErrorException;
import org.apache.velocity.exception.ResourceNotFoundException;
import org.apache.xmlbeans.XmlError;
import org.apache.xmlbeans.XmlException;
import org.apache.xmlbeans.XmlOptions;

import uk.me.jockmacmad.jstate.Interface;
import uk.me.jockmacmad.jstate.JstateDocument;
import uk.me.jockmacmad.jstate.State;
import de.hunsicker.jalopy.Jalopy;

/**
 * @author Administrator
 *
 */
<span class="nc" id="L29">public class Statemachine2Java {</span>

    private static final int INDENT = 4;
    private static final int OFFSET = 4;
    /**
     * @param args
     */
    public static void main(final String[] args) {
<span class="nc" id="L37">        Statemachine2Java parser = new Statemachine2Java();</span>
<span class="nc" id="L38">        parser.init();</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">        if (args.length &gt; 0) {</span>
<span class="nc" id="L40">            parser.parseXml(args[0]);</span>
        } else {
<span class="nc" id="L42">            System.exit(-1);</span>
        }
<span class="nc" id="L44">    }</span>

    private JstateDocument xmlDocument;
    
    private void createFactory(JstateDocument stateMachineObject)
    throws Exception {
<span class="nc" id="L50">        VelocityContext context = new VelocityContext();</span>
<span class="nc" id="L51">        String packagePath = stateMachineObject.getJstate().getStatemachine().getPackage().replace('.', '/');</span>
<span class="nc" id="L52">        context.put(&quot;StateMachine&quot;, stateMachineObject);</span>
<span class="nc" id="L53">        StringWriter generatedJava = new StringWriter();</span>
<span class="nc" id="L54">        StringWriter outputJava = new StringWriter();        </span>
<span class="nc" id="L55">        Velocity.mergeTemplate(&quot;FactoryTemplate.vm&quot;, context, generatedJava );</span>
<span class="nc" id="L56">        formatJava(generatedJava, outputJava);</span>
<span class="nc" id="L57">        FileWriter fw = </span>
            new FileWriter(
                    &quot;c:/Users/Administrator/workspace/JState/GeneratedOutput/&quot;
                    + packagePath
                    + &quot;/&quot;
<span class="nc" id="L62">                    + stateMachineObject.getJstate().getStatemachine().getClass1()</span>
                    + &quot;Factory.java&quot;
                    );
<span class="nc" id="L65">        fw.write(outputJava.toString());</span>
<span class="nc" id="L66">        fw.close();</span>
<span class="nc" id="L67">    }</span>

    private void createInterface(JstateDocument stateMachineObject)
    throws Exception {
<span class="nc" id="L71">        String packagePath = stateMachineObject.getJstate().getStatemachine().getPackage().replace('.', '/');</span>
<span class="nc" id="L72">        VelocityContext context = new VelocityContext();        </span>
<span class="nc" id="L73">        context.put(&quot;StateMachine&quot;, stateMachineObject);</span>
<span class="nc" id="L74">        context.put(&quot;Interface&quot;, stateMachineObject.getJstate().getStatemachine().getInterface());</span>
<span class="nc" id="L75">        StringWriter generatedJava = new StringWriter();</span>
<span class="nc" id="L76">        StringWriter outputJava = new StringWriter();        </span>
<span class="nc" id="L77">        Velocity.mergeTemplate(&quot;InterfaceTemplate.vm&quot;, context, generatedJava );</span>
<span class="nc" id="L78">        formatJava(generatedJava, outputJava);</span>
<span class="nc" id="L79">        FileWriter fw = </span>
            new FileWriter(
                    &quot;c:/Users/Administrator/workspace/JState/GeneratedOutput/&quot;
                    + packagePath
                    + &quot;/I&quot;
<span class="nc" id="L84">                    + stateMachineObject.getJstate().getStatemachine().getClass1()</span>
                    + &quot;.java&quot;
                    );
<span class="nc" id="L87">        fw.write(outputJava.toString());</span>
<span class="nc" id="L88">        fw.close();</span>
        
<span class="nc" id="L90">    }</span>

    private void createStates(JstateDocument stateMachineObject)
    throws Exception {
<span class="nc" id="L94">        String packagePath = stateMachineObject.getJstate().getStatemachine().getPackage().replace('.', '/');</span>
        FileWriter fw; 
<span class="nc bnc" id="L96" title="All 2 branches missed.">        for(State state : stateMachineObject.getJstate().getStatemachine().getStateArray()) {</span>
<span class="nc" id="L97">            VelocityContext context = new VelocityContext();</span>
<span class="nc" id="L98">            context.put(&quot;Package&quot;, stateMachineObject.getJstate().getStatemachine().getPackage());</span>
<span class="nc" id="L99">            context.put(&quot;Interface&quot;, stateMachineObject.getJstate().getStatemachine().getInterface());</span>
<span class="nc" id="L100">            context.put(&quot;State&quot;, state);</span>
<span class="nc" id="L101">            context.put(&quot;Clazz&quot;, stateMachineObject.getJstate().getStatemachine().getClass1());</span>
<span class="nc" id="L102">            StringWriter generatedJava = new StringWriter();</span>
<span class="nc" id="L103">            StringWriter outputJava = new StringWriter();        </span>
<span class="nc" id="L104">            Velocity.mergeTemplate(&quot;StateTemplate.vm&quot;, context, generatedJava );</span>
<span class="nc" id="L105">            formatJava(generatedJava, outputJava);</span>
<span class="nc" id="L106">            fw = new FileWriter(</span>
                    &quot;c:/Users/Administrator/workspace/JState/GeneratedOutput/&quot;
                    + packagePath
                    + &quot;/&quot;
<span class="nc" id="L110">                    + state.getName()</span>
                    + &quot;.java&quot;
                    );
<span class="nc" id="L113">            fw.write(outputJava.toString());</span>
<span class="nc" id="L114">            fw.close();</span>
        }
<span class="nc" id="L116">    }</span>
    
    private void createStateMachine(JstateDocument stateMachineObject)
    throws Exception {
<span class="nc" id="L120">        VelocityContext context = new VelocityContext();</span>
<span class="nc" id="L121">        String packagePath = stateMachineObject.getJstate().getStatemachine().getPackage().replace('.', '/');</span>
<span class="nc" id="L122">        context.put(&quot;StateMachine&quot;, stateMachineObject);</span>
<span class="nc" id="L123">        StringWriter generatedJava = new StringWriter();</span>
<span class="nc" id="L124">        StringWriter outputJava = new StringWriter();        </span>
<span class="nc" id="L125">        Velocity.mergeTemplate(&quot;StateMachineTemplate.vm&quot;, context, generatedJava );</span>
<span class="nc" id="L126">        formatJava(generatedJava, outputJava);</span>
<span class="nc" id="L127">        FileWriter fw = </span>
            new FileWriter(
                    &quot;c:/Users/Administrator/workspace/JState/GeneratedOutput/&quot;
                    + packagePath
                    + &quot;/&quot;
<span class="nc" id="L132">                    + stateMachineObject.getJstate().getStatemachine().getClass1()</span>
                    + &quot;.java&quot;
                    );
<span class="nc" id="L135">        fw.write(outputJava.toString());</span>
<span class="nc" id="L136">        fw.close();</span>
<span class="nc" id="L137">    }</span>
    

    private String formatJava(StringWriter generatedJava, StringWriter outputJava) {
        Jalopy jalopy;
<span class="nc" id="L142">        jalopy = new Jalopy();</span>
<span class="nc" id="L143">        jalopy.setInput(generatedJava.toString(), &quot;c:/Users/Administrator/workspace/JState/GeneratedOutput&quot;);</span>
<span class="nc" id="L144">        System.out.println(generatedJava );        </span>
<span class="nc" id="L145">        jalopy.setOutput(outputJava);</span>
<span class="nc" id="L146">        jalopy.format();</span>
<span class="nc" id="L147">        System.out.println(outputJava );</span>
<span class="nc" id="L148">        return outputJava.toString();</span>
    }
    
    private final void generateJava(JstateDocument stateMachineObject) {
        try {
<span class="nc" id="L153">            createFactory(stateMachineObject);</span>
<span class="nc" id="L154">            createInterface(stateMachineObject);            </span>
<span class="nc" id="L155">            createStates(stateMachineObject);</span>
<span class="nc" id="L156">            createStateMachine(stateMachineObject);</span>
<span class="nc" id="L157">        } catch (ResourceNotFoundException e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L159">            e.printStackTrace();</span>
<span class="nc" id="L160">        } catch (ParseErrorException e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L162">            e.printStackTrace();</span>
<span class="nc" id="L163">        } catch (MethodInvocationException e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L165">            e.printStackTrace();</span>
<span class="nc" id="L166">        } catch (Exception e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L168">            e.printStackTrace();</span>
<span class="nc" id="L169">        }</span>
<span class="nc" id="L170">    }</span>
    
    private final void init() {
        /* first, we init the runtime engine.  Defaults are fine. */
        try {
<span class="nc" id="L175">            Properties p = new Properties();</span>
<span class="nc" id="L176">            p.setProperty(&quot;file.resource.loader.path&quot;, &quot;c:/Users/Administrator/workspace/JState/templates/&quot;);</span>
<span class="nc" id="L177">            Velocity.init(p);</span>
<span class="nc" id="L178">        } catch (Exception e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L180">            e.printStackTrace();</span>
<span class="nc" id="L181">        }</span>
<span class="nc" id="L182">    }</span>

    private final void parseXml(String xmlFile) {
<span class="nc" id="L185">        XmlOptions options = new XmlOptions();</span>
<span class="nc" id="L186">        List&lt;XmlError&gt; errors = new ArrayList&lt;XmlError&gt;();</span>
<span class="nc" id="L187">        options.setSavePrettyPrintIndent(INDENT);</span>
<span class="nc" id="L188">        options.setSavePrettyPrintOffset(OFFSET);</span>
<span class="nc" id="L189">        options.setSavePrettyPrint();</span>
<span class="nc" id="L190">        options.setErrorListener(errors);</span>
        try {
<span class="nc" id="L192">            xmlDocument = JstateDocument.Factory.parse(new File(xmlFile), options);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (xmlDocument.validate()) {</span>
<span class="nc" id="L194">                generateJava(xmlDocument);</span>
            } else {
<span class="nc" id="L196">                xmlDocument.dump();</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                for(XmlError error : errors) {</span>
<span class="nc" id="L198">                    System.out.println(error.getMessage());</span>
<span class="nc" id="L199">                }</span>
            }
<span class="nc" id="L201">        } catch (XmlException e) {</span>
<span class="nc" id="L202">            e.printStackTrace();</span>
<span class="nc" id="L203">        } catch (IOException e) {</span>
            // TODO Auto-generated catch block
<span class="nc" id="L205">            e.printStackTrace();</span>
<span class="nc" id="L206">        }</span>
<span class="nc" id="L207">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>