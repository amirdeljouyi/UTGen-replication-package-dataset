<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Transition.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">14_omjstate</a> &gt; <a href="index.source.html" class="el_package">uk.me.jockmacmad.jstate.state</a> &gt; <span class="el_source">Transition.java</span></div><h1>Transition.java</h1><pre class="source lang-java linenums">/*
	This code is (c) Don Stewart 2001.

This file is part of OMJState.

	OMJState is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    OMJState is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU General Public License for more details.
    You should have received a copy of the GNU General Public License
    along with OMJState; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */

package uk.me.jockmacmad.jstate.state;

import org.apache.commons.lang.builder.EqualsBuilder;
import org.apache.commons.lang.builder.HashCodeBuilder;
import org.apache.commons.lang.builder.ToStringBuilder;

/**
 * A transition that is evaluated upon receiving an event.
 * &lt;p&gt;
 *   Given a start state and an event the transition
 *     firstly evaluates if it applies by checking
 *     the start state and and event match its own.
 *     Once it ascertains it is for the start state/event
 *     combination, then the transition evaluates any
 *     guard conditions it has associated to it.
 *     If all the guard conditions evaluate to true,
 *     then the transition executes and returns the
 *     new state that the state machine is in.
 * Creation date: (14/02/01 6:14:35 PM)
 * @author:
 */
public class Transition {
    /**
     * The initial state that the state machine must
     * be in for this transition to apply.
     */
    private final IState initialState;
    /**
     * The outcome state that the state machine will be
     *   in if this transition applies.
     */
    private final IState outcomeState;
    /**
     * List of guard conditions that must be
     * evaluated and return true before the transition
     * can execute.
     */
<span class="fc" id="L55">    private final java.util.List&lt;IGuardCondition&gt; guardConditions =</span>
        new java.util.ArrayList&lt;IGuardCondition&gt;();
    /**
     * The event upon which this transition takes place.
     */
    private final Event triggerEvent;
    /**
     * The name of the transition.
     */
    private final java.lang.String name;

    /**
     * Transition constructor comment.
     *
     * @param pName the name of this Transition
     * @param pTriggerEvent the Event that causes
     * this Transition
     * @param pInitialState the State which we must
     * be in to initiate this Transition
     * @param pOutcomeState the State we will be
     * in once we have performed this Transition
     */
    public Transition(final java.lang.String pName,
                      final Event pTriggerEvent,
                      final IState pInitialState,
                      final IState pOutcomeState) {
<span class="fc" id="L81">        super();</span>
<span class="fc" id="L82">        name = pName;</span>
<span class="fc" id="L83">        initialState = pInitialState;</span>
<span class="fc" id="L84">        outcomeState = pOutcomeState;</span>
<span class="fc" id="L85">        triggerEvent = pTriggerEvent;</span>
<span class="fc" id="L86">    }</span>

    /**
     * Insert the method's description here.
     * Creation date: (2/15/01 2:57:02 PM)
     * @param pGuard com.objectmentors.state.IGuardCondition
     */
    public final void addGuardCondition(
            final uk.me.jockmacmad.jstate.predicate.IPredicate pGuard
            ) {
<span class="nc" id="L96">        guardConditions.add((IGuardCondition) pGuard);</span>
<span class="nc" id="L97">    }</span>

    /**
     * Insert the method's description here.
     * Creation date: (2/15/01 2:57:02 PM)
     * @param pGuard com.objectmentors.state.IGuardCondition
     */
    public final void addGuardCondition(final IGuardCondition pGuard) {
<span class="nc" id="L105">        guardConditions.add(pGuard);</span>
<span class="nc" id="L106">    }</span>

    /**
     * Method to compare two Transition objects.
     *
     * Returns true if both Transition objects are identical,
     * otherwise returns false.
     * &lt;p&gt;
     * Uses the Apache Commons Lang
     *  &lt;code&gt;EqualsBuilder.reflectionEquals(this, pIState);&lt;/code&gt; function.
     * @since 0.1
     * @return boolean
     * @param pTransition the Transition to compare against
     * the State to compare against
     */
    @Override
    public final boolean equals(final Object pTransition) {
<span class="fc" id="L123">        return EqualsBuilder.reflectionEquals(this, pTransition);</span>
    }

    /**
     *  Builds the &lt;code&gt;hashCode&lt;/code&gt; of this &lt;code&gt;Object&lt;/code&gt;
     *  using the Apache Commons Lang
     *  &lt;code&gt;HashCodeBuilder.reflectionHashCode(this);&lt;/code&gt; function.
     * @return int the HashCode of this &lt;code&gt;Object&lt;/code&gt;
     */
    @Override
    public final int hashCode() {
<span class="nc" id="L134">        return HashCodeBuilder.reflectionHashCode(this);</span>
    }

    /**
     * Insert the method's description here.
     * Creation date: (2/14/01 6:19:57 PM)
     */
    protected void evaluateGuardConditions() {
<span class="fc" id="L142">    }</span>

    /**
     * Insert the method's description here.
     * Creation date: (2/15/01 9:34:41 AM)
     * @return com.objectmentors.state.IState
     */
    public final IState getInitialState() {
<span class="nc" id="L150">        return initialState;</span>
    }

    /**
     * Insert the method's description here.
     * Creation date: (2/15/01 9:34:41 AM)
     * @return com.objectmentors.state.IState
     */
    public final IState getOutcomeState() {
<span class="nc" id="L159">        return outcomeState;</span>
    }

    /**
     * Insert the method's description here.
     * Creation date: (2/15/01 9:34:41 AM)
     * @return com.objectmentors.state.Event
     */
    public final Event getTriggerEvent() {
<span class="fc" id="L168">        return triggerEvent;</span>
    }

    /**
     * Insert the method's description here.
     * Creation date: (15/02/01 2:14:58 PM)
     * @return java.lang.String
     */
    @Override
    public final String toString() {
<span class="nc" id="L178">        return ToStringBuilder.reflectionToString(this);</span>
    }

    /**
     * Causes this Transition to fire.
     * Creation date: (14/02/01 6:21:09 PM)
     * @author Don Stewart
     * @since 0.1
     * @param pCurrentState the current State
     * @param pEvent the Event to trigger
     * @return com.objectmentors.state.State
     */
    public final IState trigger(
            final IState pCurrentState,
            final Event pEvent) {
<span class="nc" id="L193">        IState retVal = pCurrentState;</span>
<span class="nc" id="L194">        boolean passesGuards = false;</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">        if ((initialState.equals(pCurrentState))</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                &amp;&amp; (triggerEvent.equals(pEvent))) {</span>
            // Check if there are any guard conditions
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (guardConditions.isEmpty()) {</span>
                // No guards so just trigger
<span class="nc" id="L200">                passesGuards = true;</span>
            } else {
<span class="nc bnc" id="L202" title="All 2 branches missed.">                for (IGuardCondition ig : guardConditions) {</span>
<span class="nc" id="L203">                    passesGuards = ig.evaluate(pEvent);</span>
<span class="nc" id="L204">                }</span>
            }
<span class="nc bnc" id="L206" title="All 2 branches missed.">            if (passesGuards) {</span>
<span class="nc" id="L207">                retVal = outcomeState;</span>
            }
        }
<span class="nc" id="L210">        return retVal;</span>
    }

    /**
     * Check to evaluate if this Transition will trigger
     * given the supplied current State of the State Machine
     * and the supplied Event.
     * Creation date: (14/02/01 6:21:09 PM)
     * @param pCurrentState current State of the State Machine
     * @param pEvent the supplied Event
     * @return com.objectmentors.state.State
     */
    public final boolean willTrigger(
            final IState pCurrentState,
            final Event pEvent) {
<span class="fc" id="L225">        boolean retVal = false;</span>
<span class="fc" id="L226">        boolean passesGuards = false;</span>
<span class="pc bpc" id="L227" title="1 of 2 branches missed.">        if ((initialState.equals(pCurrentState))</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">                &amp;&amp; (triggerEvent.equals(pEvent))) {</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            for (IGuardCondition ig : guardConditions) {</span>
<span class="nc" id="L230">                passesGuards = ig.evaluate(pEvent);</span>
<span class="nc" id="L231">            }</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">            if (passesGuards) {</span>
<span class="nc" id="L233">                retVal = true;</span>
            }
        }
<span class="fc" id="L236">        return retVal;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>