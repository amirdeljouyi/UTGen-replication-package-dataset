<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Mapeamento.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">87_jaw-br</a> &gt; <a href="index.source.html" class="el_package">jaw.configuracoes</a> &gt; <span class="el_source">Mapeamento.java</span></div><h1>Mapeamento.java</h1><pre class="source lang-java linenums">/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package jaw.configuracoes;

import java.io.File;
import java.io.IOException;
import java.util.Collection;
import java.util.Collections;
import java.util.HashSet;
import java.util.List;
import java.util.Properties;
import java.util.TreeSet;
import java.util.Vector;
import java.util.logging.Level;
import java.util.logging.Logger;
import jaw.metamodelo.Atributo;
import jaw.metamodelo.Entidade;

/**
 *
 * @author flavio
 */
public class Mapeamento {

<span class="nc" id="L27">    private String nome = &quot;&quot;;</span>
<span class="nc" id="L28">    private Properties mapeamento = new Properties();</span>
<span class="nc" id="L29">    private static final TreeSet&lt;String&gt; chaves = new TreeSet();</span>

<span class="nc" id="L31">    public Mapeamento() {</span>
<span class="nc" id="L32">    }</span>

    public String toString() {
<span class="nc" id="L35">        return this.nome;</span>
    }

    public String getNome() {
<span class="nc" id="L39">        return nome;</span>
    }

    public void setNome(String nome) {
<span class="nc" id="L43">        this.nome = nome;</span>
<span class="nc" id="L44">    }</span>

    public Properties getMapeamento() {
<span class="nc" id="L47">        return mapeamento;</span>
    }

    public void setMapeamento(Properties mapeamento) {
<span class="nc" id="L51">        this.mapeamento = mapeamento;</span>
<span class="nc" id="L52">    }</span>

    public static TreeSet&lt;String&gt; getChaves() {
<span class="nc" id="L55">        return chaves;</span>
    }

    public void salvar() {
<span class="nc" id="L59">        salvar(this);</span>
<span class="nc" id="L60">    }</span>

    public void remover() {
<span class="nc" id="L63">        File arquivo = new File(jaw.Main.configuracao.getCaminho() + &quot;/mapeamento/&quot; + this.getNome() + &quot;.properties&quot;);</span>
<span class="nc" id="L64">        arquivo.delete();</span>
<span class="nc" id="L65">    }</span>

    public static void carregarMapeamentos() {
<span class="nc" id="L68">        jaw.Main.configuracao.getMapeamentos().clear();</span>
<span class="nc" id="L69">        File[] arquivosDeMapeamento = new File(jaw.Main.configuracao.getCaminho() + &quot;/mapeamento&quot;).listFiles();</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">        for (int i = 0; i &lt; arquivosDeMapeamento.length; i++) {</span>
            try {
<span class="nc" id="L72">                Properties propriedades = new Properties();</span>
<span class="nc" id="L73">                java.io.FileInputStream in = null;</span>
<span class="nc" id="L74">                in = new java.io.FileInputStream(arquivosDeMapeamento[i]);</span>
<span class="nc" id="L75">                propriedades.load(in);</span>
<span class="nc" id="L76">                Mapeamento mapeamento = new Mapeamento();</span>
<span class="nc" id="L77">                mapeamento.setMapeamento(propriedades);</span>
<span class="nc" id="L78">                mapeamento.setNome(arquivosDeMapeamento[i].getName().replace(&quot;.properties&quot;, &quot;&quot;));</span>
<span class="nc" id="L79">                jaw.Main.configuracao.getMapeamentos().add(mapeamento);</span>
<span class="nc" id="L80">            } catch (IOException ex) {</span>
<span class="nc" id="L81">                jaw.Main.janelaPrincipal.log(ex.toString());</span>
<span class="nc" id="L82">            }</span>
        }
<span class="nc" id="L84">        carregarChaves();</span>
<span class="nc" id="L85">    }</span>

    public static void salvar(List&lt;Mapeamento&gt; mapeamentos) {
<span class="nc bnc" id="L88" title="All 2 branches missed.">        for (Mapeamento mapeamento : mapeamentos) {</span>
<span class="nc" id="L89">            salvarIndividual(mapeamento);</span>
<span class="nc" id="L90">        }</span>
<span class="nc" id="L91">    }</span>

    private static void salvarIndividual(Mapeamento mapeamento) {
<span class="nc" id="L94">        java.io.OutputStream os = null;</span>
        try {
<span class="nc" id="L96">            File arquivo = new File(jaw.Main.configuracao.getCaminho() + &quot;/mapeamento/&quot; + mapeamento.getNome() + &quot;.properties&quot;);</span>
<span class="nc" id="L97">            os = new java.io.FileOutputStream(arquivo);</span>
<span class="nc" id="L98">            mapeamento.getMapeamento().store(os, new java.util.Date() + &quot;&quot;);</span>
<span class="nc" id="L99">        } catch (IOException ex) {</span>
<span class="nc" id="L100">            jaw.Main.janelaPrincipal.log(ex.toString());</span>
        } finally {
            try {
<span class="nc" id="L103">                os.close();</span>
<span class="nc" id="L104">            } catch (IOException ex) {</span>
<span class="nc" id="L105">                jaw.Main.janelaPrincipal.log(ex.toString());</span>
<span class="nc" id="L106">            }</span>
        }

<span class="nc" id="L109">    }</span>

    public static void salvar(Mapeamento mapeamento) {
<span class="nc" id="L112">        salvarIndividual(mapeamento);</span>
<span class="nc" id="L113">        carregarMapeamentos();</span>
<span class="nc" id="L114">    }</span>

    public static boolean removerChave(String chave) {
<span class="nc" id="L117">        System.out.println(chaves.size());</span>
<span class="nc" id="L118">        chaves.remove(chave);</span>
<span class="nc" id="L119">        System.out.println(chaves.size());</span>

<span class="nc" id="L121">        List&lt;Mapeamento&gt; lista = new Vector();</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        for (Mapeamento mapeamento : jaw.Main.configuracao.getMapeamentos()) {</span>
<span class="nc" id="L123">            mapeamento.getMapeamento().remove(chave);</span>
<span class="nc" id="L124">            lista.add(mapeamento);</span>
<span class="nc" id="L125">        }</span>
<span class="nc" id="L126">        salvar(lista);</span>
<span class="nc" id="L127">        return true;</span>
    }

    public static boolean adicionarChave(String chave) {
<span class="nc" id="L131">        boolean alteracao = false;</span>
<span class="nc" id="L132">        chaves.add(chave);</span>
<span class="nc" id="L133">        List&lt;Mapeamento&gt; lista = new Vector();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        for (Mapeamento mapeamento : jaw.Main.configuracao.getMapeamentos()) {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">            if (!mapeamento.getMapeamento().containsKey(chave)) {</span>
<span class="nc" id="L136">                mapeamento.getMapeamento().setProperty(chave, chave);</span>
<span class="nc" id="L137">                alteracao = true;</span>
            } else {
<span class="nc" id="L139">                alteracao = false;</span>
            }

<span class="nc bnc" id="L142" title="All 2 branches missed.">            if (alteracao) {</span>
<span class="nc" id="L143">                lista.add(mapeamento);</span>
            }
<span class="nc" id="L145">        }</span>
<span class="nc" id="L146">        salvar(lista);</span>
<span class="nc" id="L147">        return alteracao;</span>
    }

    public static boolean adicionarChaves(Collection&lt;String&gt; chaves) {
<span class="nc" id="L151">        boolean alteracao = false;</span>
<span class="nc bnc" id="L152" title="All 2 branches missed.">        for (String chave : chaves) {</span>
<span class="nc bnc" id="L153" title="All 4 branches missed.">            alteracao = alteracao &amp;&amp; adicionarChave(chave);</span>
<span class="nc" id="L154">        }</span>
<span class="nc" id="L155">        return alteracao;</span>
    }

    public static Mapeamento createMapeamento(String nome) {
<span class="nc" id="L159">        Mapeamento mapeamento = new Mapeamento();</span>
<span class="nc" id="L160">        mapeamento.setNome(nome);</span>
<span class="nc" id="L161">        Properties propriedades = mapeamento.getMapeamento();</span>
<span class="nc" id="L162">        java.util.Enumeration lista = propriedades.propertyNames();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">        while (lista.hasMoreElements()) {</span>
<span class="nc" id="L164">            String prop = lista.nextElement().toString();</span>
<span class="nc" id="L165">            propriedades.setProperty(prop, &quot;&quot;);</span>
<span class="nc" id="L166">        }</span>

<span class="nc" id="L168">        return mapeamento;</span>
    }

    public static void mapear(Atributo atributo) {
<span class="nc" id="L172">        String chave = atributo.getTipo();</span>
<span class="nc" id="L173">        Properties propriedades = atributo.getTipos();</span>
<span class="nc bnc" id="L174" title="All 2 branches missed.">        for (Mapeamento mapeamento : jaw.Main.configuracao.getMapeamentos()) {</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            String valor = (mapeamento.getMapeamento().getProperty(chave) == null) ? chave : mapeamento.getMapeamento().getProperty(chave);</span>
<span class="nc" id="L176">            propriedades.setProperty(mapeamento.getNome(), valor);</span>
<span class="nc" id="L177">        }</span>

<span class="nc" id="L179">        atributo.setTipos(propriedades);</span>
<span class="nc" id="L180">    }</span>

    public static void mapear(Entidade entidade) {
<span class="nc bnc" id="L183" title="All 2 branches missed.">        for (Atributo atributo : entidade.getAtributos()) {</span>
<span class="nc" id="L184">            mapear(atributo);</span>
<span class="nc" id="L185">        }</span>

<span class="nc" id="L187">    }</span>

    public static void mapear(Collection&lt;Entidade&gt; entidades) {
<span class="nc bnc" id="L190" title="All 2 branches missed.">        for (Entidade entidade : entidades) {</span>
<span class="nc" id="L191">            mapear(entidade);</span>
<span class="nc" id="L192">        }</span>

<span class="nc" id="L194">    }</span>

    public static void carregarChaves() {
<span class="nc bnc" id="L197" title="All 2 branches missed.">        for (Mapeamento mapeamento : jaw.Main.configuracao.getMapeamentos()) {</span>
<span class="nc" id="L198">            java.util.Enumeration lista = mapeamento.getMapeamento().propertyNames();</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            while (lista.hasMoreElements()) {</span>
<span class="nc" id="L200">                chaves.add(lista.nextElement().toString());</span>
            }

<span class="nc" id="L203">        }</span>
<span class="nc" id="L204">        normalizarMapeamentos();</span>
<span class="nc" id="L205">    }</span>

    public static void normalizarMapeamentos() {
<span class="nc" id="L208">        boolean alteracao = false;</span>
<span class="nc bnc" id="L209" title="All 2 branches missed.">        for (Mapeamento mapeamento : jaw.Main.configuracao.getMapeamentos()) {</span>
<span class="nc" id="L210">            Properties propriedades = mapeamento.getMapeamento();</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">            for (String chave : chaves) {</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">                if (!propriedades.containsKey(chave)) {</span>
<span class="nc" id="L213">                    propriedades.setProperty(chave, chave);</span>
<span class="nc" id="L214">                    alteracao =</span>
                            true;
                }

<span class="nc" id="L218">            }</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">            if (alteracao) {</span>
<span class="nc" id="L220">                salvar(mapeamento);</span>
<span class="nc" id="L221">                break;</span>
            }
<span class="nc" id="L223">        }</span>
<span class="nc" id="L224">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>