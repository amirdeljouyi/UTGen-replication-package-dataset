<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MainFrameMenuBar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.mainframe</a> &gt; <span class="el_source">MainFrameMenuBar.java</span></div><h1>MainFrameMenuBar.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui.mainframe;
/*
 * Copyright (C) 2001-2004 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.Component;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;

import javax.swing.Action;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JMenu;
import javax.swing.JMenuBar;

import net.sourceforge.squirrel_sql.client.gui.mainframe.IHasJDesktopPane;
import net.sourceforge.squirrel_sql.fw.gui.IToggleAction;
import net.sourceforge.squirrel_sql.fw.util.Resources;
import net.sourceforge.squirrel_sql.fw.util.SystemProperties;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.client.gui.desktopcontainer.IDesktopContainer;
import net.sourceforge.squirrel_sql.client.gui.desktopcontainer.DesktopStyle;
import net.sourceforge.squirrel_sql.client.action.ActionCollection;
import net.sourceforge.squirrel_sql.client.session.action.CloseAllSQLResultTabsButCurrentAction;
import net.sourceforge.squirrel_sql.client.mainframe.action.*;
import net.sourceforge.squirrel_sql.client.plugin.IPluginManager;
import net.sourceforge.squirrel_sql.client.plugin.PluginInfo;
import net.sourceforge.squirrel_sql.client.preferences.SquirrelPreferences;
import net.sourceforge.squirrel_sql.client.resources.SquirrelResources;
import net.sourceforge.squirrel_sql.client.session.action.*;
/**
 * Menu bar for &lt;CODE&gt;MainFrame&lt;/CODE&gt;.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
@SuppressWarnings(&quot;serial&quot;)
final class MainFrameMenuBar extends JMenuBar
{

   public interface IMenuIDs
	{
		int PLUGINS_MENU = 1;
		int SESSION_MENU = 2;
	}

	/** Logger for this class. */
<span class="nc" id="L63">	private static final ILogger s_log =</span>
<span class="nc" id="L64">		LoggerController.createLogger(MainFrameMenuBar.class);</span>

	private final IApplication _app;
//	private final JMenu _editMenu;
	private final JMenu _pluginsMenu;
	private final JMenu _sessionMenu;
	private final JMenu _windowsMenu;

   private JMenu _aliasesMenu;
   private JMenu _driversMenu;
   
   private final ActionCollection _actions;

	private JCheckBoxMenuItem _showLoadedDriversOnlyItem;

	/** Listener to changes to application properties. */
	private SquirrelPropertiesListener _propsLis;

	private final boolean _osxPluginLoaded;

	/**
	 * Ctor.
	 */
	MainFrameMenuBar(IApplication app, IDesktopContainer desktopContainer, ActionCollection actions)
	{
<span class="nc" id="L89">		super();</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">		if (app == null)</span>
		{
<span class="nc" id="L92">			throw new IllegalArgumentException(&quot;Null IApplication passed&quot;);</span>
		}

<span class="nc bnc" id="L95" title="All 2 branches missed.">		if (desktopContainer == null)</span>
		{
<span class="nc" id="L97">			throw new IllegalArgumentException(&quot;Null JDesktopPane passed&quot;);</span>
		}

<span class="nc bnc" id="L100" title="All 2 branches missed.">		if (actions == null)</span>
		{
<span class="nc" id="L102">			throw new IllegalArgumentException(&quot;Null ActionCollection passed&quot;);</span>
		}

<span class="nc" id="L105">		Resources rsrc = app.getResources();</span>

<span class="nc bnc" id="L107" title="All 2 branches missed.">		if (rsrc == null)</span>
		{
<span class="nc" id="L109">			throw new IllegalStateException(&quot;No Resources object in IApplication&quot;);</span>
		}

<span class="nc" id="L112">		_actions = actions;</span>

<span class="nc" id="L114">		_app = app;</span>
<span class="nc" id="L115">		_osxPluginLoaded = isOsxPluginLoaded();</span>

<span class="nc" id="L117">		add(createOsxFileMenu(rsrc));</span>
<span class="nc" id="L118">      add(_driversMenu = createDriversMenu(rsrc));</span>
<span class="nc" id="L119">      add(_aliasesMenu = createAliasesMenu(rsrc));</span>
<span class="nc" id="L120">		add(_pluginsMenu = createPluginsMenu(rsrc));</span>
<span class="nc" id="L121">		add(_sessionMenu = createSessionMenu(rsrc));</span>
<span class="nc" id="L122">		add(_windowsMenu = createWindowsMenu(rsrc, desktopContainer));</span>
<span class="nc" id="L123">		add(createHelpMenu(rsrc));</span>
<span class="nc" id="L124">	}</span>

	/**
	 * Component has been added to its parent so setup required listeners.
	 */
	public void addNotify()
	{
<span class="nc" id="L131">		super.addNotify();</span>
<span class="nc" id="L132">		propertiesChanged(null);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">		if (_propsLis == null)</span>
		{
<span class="nc" id="L135">			_propsLis = new SquirrelPropertiesListener();</span>
<span class="nc" id="L136">			_app.getSquirrelPreferences().addPropertyChangeListener(_propsLis);</span>
		}
<span class="nc" id="L138">	}</span>

	/**
	 * Component has been removed from its parent so remove required listeners.
	 */
	public void removeNotify()
	{
<span class="nc" id="L145">		super.removeNotify();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if (_propsLis != null)</span>
		{
<span class="nc" id="L148">			_app.getSquirrelPreferences().removePropertyChangeListener(_propsLis);</span>
<span class="nc" id="L149">			_propsLis = null;</span>
		}
<span class="nc" id="L151">	}</span>

	JMenu getWindowsMenu()
	{
<span class="nc" id="L155">		return _windowsMenu;</span>
	}

	JMenu getSessionMenu()
	{
<span class="nc" id="L160">		return _sessionMenu;</span>
	}

	void addToMenu(int menuId, JMenu menu)
	{
<span class="nc bnc" id="L165" title="All 2 branches missed.">		if (menu == null)</span>
		{
<span class="nc" id="L167">			throw new IllegalArgumentException(&quot;Null JMenu passed&quot;);</span>
		}

<span class="nc bnc" id="L170" title="All 3 branches missed.">		switch (menuId)</span>
		{
			case IMenuIDs.PLUGINS_MENU :
			{
<span class="nc" id="L174">				_pluginsMenu.add(menu);</span>
<span class="nc" id="L175">				break;</span>
			}

			case IMenuIDs.SESSION_MENU :
			{
<span class="nc" id="L180">				_sessionMenu.add(menu);</span>
<span class="nc" id="L181">				break;</span>
			}

			default:
			{
<span class="nc" id="L186">				throw new IllegalArgumentException(&quot;Invalid menuId passed: &quot; + menuId);</span>
			}
		}
<span class="nc" id="L189">	}</span>

	void addToMenu(int menuId, Action action)
	{
<span class="nc bnc" id="L193" title="All 2 branches missed.">		if (action == null)</span>
		{
<span class="nc" id="L195">			throw new IllegalArgumentException(&quot;Null Action passed&quot;);</span>
		}

<span class="nc bnc" id="L198" title="All 3 branches missed.">		switch (menuId)</span>
		{
			case IMenuIDs.PLUGINS_MENU :
			{
<span class="nc" id="L202">				_pluginsMenu.add(action);</span>
<span class="nc" id="L203">				break;</span>
			}

			case IMenuIDs.SESSION_MENU :
			{
<span class="nc" id="L208">				_sessionMenu.add(action);</span>
<span class="nc" id="L209">				break;</span>
			}

			default :
			{
<span class="nc" id="L214">				throw new IllegalArgumentException(&quot;Invalid menuId passed: &quot; + menuId);</span>
			}
		}
<span class="nc" id="L217">	}</span>

	/**
	 * Add a component to the end of the menu.
	 *
	 * @param	menuId	Defines the menu to add the component to. @see IMenuIDs
	 * @param	comp	Component to add to menu.
	 *
	 * @throws	IllegalArgumentException if null &lt;TT&gt;Component&lt;/TT&gt; passed or
	 * 			an invalid &lt;TT&gt;menuId&lt;/TT&gt; passed.
	 */
	void addToMenu(int menuId, Component comp)
	{
<span class="nc bnc" id="L230" title="All 2 branches missed.">		if (comp == null)</span>
		{
<span class="nc" id="L232">			throw new IllegalArgumentException(&quot;Component == null&quot;);</span>
		}

<span class="nc bnc" id="L235" title="All 3 branches missed.">		switch (menuId)</span>
		{
			case IMenuIDs.PLUGINS_MENU :
			{
<span class="nc" id="L239">				_pluginsMenu.add(comp);</span>
<span class="nc" id="L240">				break;</span>
			}

			case IMenuIDs.SESSION_MENU :
			{
<span class="nc" id="L245">				_sessionMenu.add(comp);</span>
<span class="nc" id="L246">				break;</span>
			}

			default :
			{
<span class="nc" id="L251">				throw new IllegalArgumentException(&quot;Invalid menuId passed: &quot; + menuId);</span>
			}

		}
<span class="nc" id="L255">	}</span>

	private JMenu createOsxFileMenu(Resources rsrc)
	{
<span class="nc" id="L259">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.OSX_FILE);</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">		if (!_osxPluginLoaded)</span>
		{
<span class="nc" id="L262">			addToMenu(rsrc, GlobalPreferencesAction.class, menu);</span>
		}
<span class="nc" id="L264">		addToMenu(rsrc, NewSessionPropertiesAction.class, menu);</span>
<span class="nc" id="L265">		menu.addSeparator();</span>
<span class="nc" id="L266">		addToMenu(rsrc, DumpApplicationAction.class, menu);</span>
<span class="nc" id="L267">        addToMenu(rsrc, SavePreferencesAction.class, menu);</span>
<span class="nc" id="L268">		menu.addSeparator();</span>
<span class="nc bnc" id="L269" title="All 2 branches missed.">		if (!_osxPluginLoaded)</span>
		{
<span class="nc" id="L271">			addToMenu(rsrc, ExitAction.class, menu);</span>
		}

<span class="nc" id="L274">		return menu;</span>
	}

   public void setEnabledAliasesMenu(boolean b)
   {
<span class="nc" id="L279">      _aliasesMenu.setEnabled(b);</span>
<span class="nc" id="L280">   }</span>

   public void setEnabledDriversMenu(boolean b)
   {
<span class="nc" id="L284">      _driversMenu.setEnabled(b);</span>
<span class="nc" id="L285">   }</span>



   private JMenu createSessionMenu(Resources rsrc)
	{
<span class="nc" id="L291">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.SESSION);</span>
<span class="nc" id="L292">		addToMenu(rsrc, SessionPropertiesAction.class, menu);</span>
<span class="nc" id="L293">		addToMenu(rsrc, DumpSessionAction.class, menu);</span>
<span class="nc" id="L294">		menu.addSeparator();</span>
<span class="nc" id="L295">		addToMenu(rsrc, ToolsPopupAction.class, menu);</span>
<span class="nc" id="L296">		addToMenu(rsrc, RefreshSchemaInfoAction.class, menu);</span>
<span class="nc" id="L297">		addToMenu(rsrc, ExecuteSqlAction.class, menu);</span>
<span class="nc" id="L298">      menu.add(createTransactionMenu(rsrc));</span>
<span class="nc" id="L299">      addToMenu(rsrc, SQLFilterAction.class, menu);</span>
<span class="nc" id="L300">      menu.addSeparator();</span>
<span class="nc" id="L301">      addToMenu(rsrc, ViewObjectAtCursorInObjectTreeAction.class, menu);</span>
<span class="nc" id="L302">		menu.addSeparator();</span>
<span class="nc" id="L303">      menu.add(createFileMenu(rsrc));</span>
<span class="nc" id="L304">      menu.addSeparator();</span>
<span class="nc" id="L305">		addToMenu(rsrc, GotoPreviousResultsTabAction.class, menu);</span>
<span class="nc" id="L306">		addToMenu(rsrc, GotoNextResultsTabAction.class, menu);</span>
<span class="nc" id="L307">		addToMenu(rsrc, ToggleCurrentSQLResultTabStickyAction.class, menu);</span>
<span class="nc" id="L308">		menu.addSeparator();</span>
<span class="nc" id="L309">		addToMenu(rsrc, ShowNativeSQLAction.class, menu);</span>
<span class="nc" id="L310">		menu.addSeparator();</span>
<span class="nc" id="L311">		addToMenu(rsrc, ReconnectAction.class, menu);</span>
<span class="nc" id="L312">		addToMenu(rsrc, CloseSessionWindowAction.class, menu);</span>
<span class="nc" id="L313">		addToMenu(rsrc, CloseSessionAction.class, menu);</span>
<span class="nc" id="L314">	    addToMenu(rsrc, RenameSessionAction.class, menu);		</span>
<span class="nc" id="L315">		menu.add(createSQLResultsCloseMenu(rsrc));</span>
<span class="nc" id="L316">		menu.addSeparator();</span>
<span class="nc" id="L317">		addToMenu(rsrc, PreviousSessionAction.class, menu);</span>
<span class="nc" id="L318">		addToMenu(rsrc, NextSessionAction.class, menu);</span>
<span class="nc" id="L319">		menu.addSeparator();</span>
<span class="nc" id="L320">		addToMenu(rsrc, PreviousSqlAction.class, menu);</span>
<span class="nc" id="L321">		addToMenu(rsrc, NextSqlAction.class, menu);</span>
<span class="nc" id="L322">		addToMenu(rsrc, SelectSqlAction.class, menu);</span>
<span class="nc" id="L323">		menu.addSeparator();</span>
<span class="nc" id="L324">      addToMenu(rsrc, FormatSQLAction.class, menu);</span>
<span class="nc" id="L325">      menu.addSeparator();</span>
<span class="nc" id="L326">		addToMenu(rsrc, EditWhereColsAction.class, menu);</span>
<span class="nc" id="L327">		menu.addSeparator();</span>
<span class="nc" id="L328">      addToMenu(rsrc, NewSQLWorksheetAction.class, menu);</span>
<span class="nc" id="L329">      addToMenu(rsrc, NewObjectTreeAction.class, menu);</span>
<span class="nc" id="L330">      menu.addSeparator();      </span>
       
<span class="nc" id="L332">		menu.setEnabled(false);</span>
<span class="nc" id="L333">		return menu;</span>
	}


   private JMenu createPluginsMenu(Resources rsrc)
   {
<span class="nc" id="L339">      JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.PLUGINS);</span>
<span class="nc" id="L340">      addToMenu(rsrc, DisplayPluginSummaryAction.class, menu);</span>
<span class="nc" id="L341">      menu.addSeparator();</span>
<span class="nc" id="L342">      return menu;</span>
   }

	private JMenu createAliasesMenu(Resources rsrc)
	{
<span class="nc" id="L347">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.ALIASES);</span>
<span class="nc" id="L348">		addToMenu(rsrc, ConnectToAliasAction.class, menu);</span>
<span class="nc" id="L349">		menu.addSeparator();</span>
<span class="nc" id="L350">		addToMenu(rsrc, CreateAliasAction.class, menu);</span>
<span class="nc" id="L351">		addToMenu(rsrc, ModifyAliasAction.class, menu);</span>
<span class="nc" id="L352">		addToMenu(rsrc, DeleteAliasAction.class, menu);</span>
<span class="nc" id="L353">		addToMenu(rsrc, CopyAliasAction.class, menu);</span>
<span class="nc" id="L354">      menu.addSeparator();</span>
<span class="nc" id="L355">		addToMenu(rsrc, AliasPropertiesAction.class, menu);</span>
<span class="nc" id="L356">      menu.addSeparator();</span>
<span class="nc" id="L357">      addToMenu(rsrc, SortAliasesAction.class, menu);</span>
<span class="nc" id="L358">      menu.addSeparator();</span>
<span class="nc" id="L359">      addToMenuAsCheckBoxMenuItem(rsrc, ToggleTreeViewAction.class, menu);</span>
<span class="nc" id="L360">      addToMenu(rsrc, NewAliasFolderAction.class, menu);</span>
<span class="nc" id="L361">      addToMenu(rsrc, CopyToPasteAliasFolderAction.class, menu);</span>
<span class="nc" id="L362">      addToMenu(rsrc, CutAliasFolderAction.class, menu);</span>
<span class="nc" id="L363">      addToMenu(rsrc, PasteAliasFolderAction.class, menu);</span>
<span class="nc" id="L364">      addToMenu(rsrc, CollapseAllAliasFolderAction.class, menu);</span>
<span class="nc" id="L365">      addToMenu(rsrc, ExpandAllAliasFolderAction.class, menu);</span>
<span class="nc" id="L366">		return menu;</span>
	}

	private JMenu createDriversMenu(Resources rsrc)
	{
<span class="nc" id="L371">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.DRIVERS);</span>
<span class="nc" id="L372">		addToMenu(rsrc, CreateDriverAction.class, menu);</span>
<span class="nc" id="L373">		menu.addSeparator();</span>
<span class="nc" id="L374">		addToMenu(rsrc, ModifyDriverAction.class, menu);</span>
<span class="nc" id="L375">		addToMenu(rsrc, DeleteDriverAction.class, menu);</span>
<span class="nc" id="L376">		addToMenu(rsrc, CopyDriverAction.class, menu);</span>
<span class="nc" id="L377">      addToMenu(rsrc, ShowDriverWebsiteAction.class, menu);</span>
<span class="nc" id="L378">		menu.addSeparator();</span>
<span class="nc" id="L379">		addToMenu(rsrc, InstallDefaultDriversAction.class, menu);</span>
<span class="nc" id="L380">		menu.addSeparator();</span>
<span class="nc" id="L381">		_showLoadedDriversOnlyItem = addToMenuAsCheckBoxMenuItem(rsrc,</span>
									ShowLoadedDriversOnlyAction.class, menu);
<span class="nc" id="L383">		return menu;</span>
	}

	private JMenu createWindowsMenu(Resources rsrc, IDesktopContainer desktopPane)
	{
<span class="nc" id="L388">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.WINDOWS);</span>
<span class="nc" id="L389">		addToMenu(rsrc, ViewAliasesAction.class, menu);</span>
<span class="nc" id="L390">		addToMenu(rsrc, ViewDriversAction.class, menu);</span>
<span class="nc" id="L391">		addToMenu(rsrc, ViewLogsAction.class, menu);</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">      if (_app.getDesktopStyle().isInternalFrameStyle())</span>
      {
<span class="nc" id="L394">         menu.addSeparator();</span>
<span class="nc" id="L395">         addDesktopPaneActionToMenu(rsrc, TileAction.class, menu, desktopPane);</span>
<span class="nc" id="L396">         addDesktopPaneActionToMenu(rsrc, TileHorizontalAction.class, menu, desktopPane);</span>
<span class="nc" id="L397">         addDesktopPaneActionToMenu(rsrc, TileVerticalAction.class, menu, desktopPane);</span>
<span class="nc" id="L398">         addDesktopPaneActionToMenu(rsrc, CascadeAction.class, menu, desktopPane);</span>
<span class="nc" id="L399">         addDesktopPaneActionToMenu(rsrc, MaximizeAction.class, menu, desktopPane);</span>
<span class="nc" id="L400">         menu.addSeparator();</span>
      }
<span class="nc" id="L402">      addToMenu(rsrc, CloseAllSessionsAction.class, menu);</span>
<span class="nc" id="L403">      addToMenu(rsrc, CloseAllButCurrentSessionsAction.class, menu);</span>
<span class="nc" id="L404">		menu.addSeparator();</span>
<span class="nc" id="L405">		return menu;</span>
	}

	private JMenu createHelpMenu(Resources rsrc)
	{
<span class="nc" id="L410">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.HELP);</span>
<span class="nc" id="L411">		addToMenu(rsrc, ViewHelpAction.class, menu);</span>

<span class="nc" id="L413">		menu.addSeparator();</span>
<span class="nc" id="L414">		addToMenu(rsrc, UpdateAction.class, menu);</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">		if (!_osxPluginLoaded)</span>
		{
<span class="nc" id="L417">			addToMenu(rsrc, AboutAction.class, menu);</span>
		}

<span class="nc" id="L420">		return menu;</span>
	}

	private JMenu createSQLResultsCloseMenu(Resources rsrc)
	{
<span class="nc" id="L425">		JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.CLOSE_ALL_SQL_RESULTS);</span>
<span class="nc" id="L426">		addToMenu(rsrc, CloseAllSQLResultTabsAction.class, menu);</span>
<span class="nc" id="L427">		addToMenu(rsrc, CloseCurrentSQLResultTabAction.class, menu);</span>
<span class="nc" id="L428">		addToMenu(rsrc, CloseAllSQLResultTabsButCurrentAction.class, menu);</span>
<span class="nc" id="L429">		addToMenu(rsrc, CloseAllSQLResultWindowsAction.class, menu);</span>
<span class="nc" id="L430">		return menu;</span>
	}

   private Component createFileMenu(Resources rsrc)
   {
<span class="nc" id="L435">      JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.FILE);</span>
<span class="nc" id="L436">      addToMenu(rsrc, FileSaveAction.class, menu);</span>
<span class="nc" id="L437">      addToMenu(rsrc, FileSaveAsAction.class, menu);</span>
<span class="nc" id="L438">      addToMenu(rsrc, FileOpenAction.class, menu);</span>
<span class="nc" id="L439">      addToMenu(rsrc, FileNewAction.class, menu);</span>
<span class="nc" id="L440">      addToMenu(rsrc, FileAppendAction.class, menu);</span>
<span class="nc" id="L441">      addToMenu(rsrc, FilePrintAction.class, menu);</span>
<span class="nc" id="L442">      addToMenu(rsrc, FileCloseAction.class, menu);</span>
<span class="nc" id="L443">      return menu;</span>
   }

   private Component createTransactionMenu(Resources rsrc)
   {
<span class="nc" id="L448">      JMenu menu = rsrc.createMenu(SquirrelResources.IMenuResourceKeys.TRANSACTION);</span>
<span class="nc" id="L449">      addToMenuAsCheckBoxMenuItem(rsrc, ToggleAutoCommitAction.class, menu);</span>
<span class="nc" id="L450">      addToMenu(rsrc, CommitAction.class, menu);</span>
<span class="nc" id="L451">      addToMenu(rsrc, RollbackAction.class, menu);</span>
<span class="nc" id="L452">      return menu;</span>
   }


   @SuppressWarnings(&quot;unchecked&quot;)
   private Action addDesktopPaneActionToMenu(Resources rsrc, Class actionClass,
											JMenu menu, IDesktopContainer desktopContainer)
	{
<span class="nc" id="L460">		Action act = addToMenu(rsrc, actionClass, menu);</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">		if (act != null)</span>
		{
<span class="nc bnc" id="L463" title="All 2 branches missed.">			if (act instanceof IHasJDesktopPane)</span>
			{
<span class="nc" id="L465">				((IHasJDesktopPane)act).setDesktopContainer(desktopContainer);</span>
			}
			else
			{
<span class="nc" id="L469">				s_log.error(&quot;Tryimg to add non IHasJDesktopPane (&quot;</span>
<span class="nc" id="L470">						+ actionClass.getName()</span>
						+ &quot;) in MainFrameMenuBar.addDesktopPaneActionToMenu&quot;);
			}
		}
<span class="nc" id="L474">		return act;</span>
	}
   
    @SuppressWarnings(&quot;unchecked&quot;)
	private Action addToMenu(Resources rsrc, Class actionClass, JMenu menu)
	{
<span class="nc" id="L480">		Action act = _actions.get(actionClass);</span>
<span class="nc bnc" id="L481" title="All 2 branches missed.">		if (act != null)</span>
		{
<span class="nc" id="L483">			rsrc.addToMenu(act, menu);</span>
		}
		else
		{
<span class="nc" id="L487">			s_log.error(&quot;Could not retrieve instance of &quot;</span>
<span class="nc" id="L488">							+ actionClass.getName()</span>
							+ &quot;) in MainFrameMenuBar.addToMenu&quot;);
		}

<span class="nc" id="L492">		return act;</span>
	}

    @SuppressWarnings(&quot;unchecked&quot;)
	private JCheckBoxMenuItem addToMenuAsCheckBoxMenuItem(Resources rsrc, Class actionClass, JMenu menu)
	{
<span class="nc" id="L498">		Action act = _actions.get(actionClass);</span>
<span class="nc bnc" id="L499" title="All 2 branches missed.">		if (act != null)</span>
		{
<span class="nc" id="L501">         JCheckBoxMenuItem mnu = rsrc.addToMenuAsCheckBoxMenuItem(act, menu);</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">         if(act instanceof IToggleAction)</span>
         {
<span class="nc" id="L504">            ((IToggleAction)act).getToggleComponentHolder().addToggleableComponent(mnu);</span>
         }
<span class="nc" id="L506">         return mnu;</span>
		}
<span class="nc" id="L508">		s_log.error(&quot;Could not retrieve instance of &quot; + actionClass.getName()</span>
							+ &quot;) in MainFrameMenuBar.addToMenu&quot;);
<span class="nc" id="L510">      return null;</span>
	}

	/**
	 * Application properties have changed so update this object.
	 *
	 * @param	propName	Name of property that has changed or &lt;TT&gt;null&lt;/TT&gt;
	 * 						if multiple properties have changed.
	 */
	private void propertiesChanged(String propName)
	{
<span class="nc bnc" id="L521" title="All 2 branches missed.">		if (propName == null</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">			|| propName.equals(SquirrelPreferences.IPropertyNames.SHOW_LOADED_DRIVERS_ONLY))</span>
		{
<span class="nc" id="L524">			boolean show = _app.getSquirrelPreferences().getShowLoadedDriversOnly();</span>
<span class="nc" id="L525">			_showLoadedDriversOnlyItem.setSelected(show);</span>
		}
<span class="nc" id="L527">	}</span>

	// TODO: This is a nasty quick hack. Needs an API to do this.
	private boolean isOsxPluginLoaded()
	{
<span class="nc bnc" id="L532" title="All 2 branches missed.">		if (SystemProperties.isRunningOnOSX())</span>
		{
<span class="nc" id="L534">			final IPluginManager mgr = _app.getPluginManager();</span>
<span class="nc" id="L535">			PluginInfo[] ar = mgr.getPluginInformation();</span>
<span class="nc bnc" id="L536" title="All 2 branches missed.">			for (int i = 0; i &lt; ar.length; ++i)</span>
			{
<span class="nc bnc" id="L538" title="All 2 branches missed.">				if (ar[i].getInternalName().equals(&quot;macosx&quot;))</span>
				{
<span class="nc" id="L540">					return ar[i].isLoaded();</span>
				}
			}
		}
<span class="nc" id="L544">		return false;</span>
	}

	/**
	 * Listener for changes to Squirrel Properties.
	 */
<span class="nc" id="L550">	private class SquirrelPropertiesListener implements PropertyChangeListener</span>
	{
		public void propertyChange(PropertyChangeEvent evt)
		{
<span class="nc bnc" id="L554" title="All 2 branches missed.">			final String propName = evt != null ? evt.getPropertyName() : null;</span>
<span class="nc" id="L555">			propertiesChanged(propName);</span>
<span class="nc" id="L556">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>