<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SplitPnResizeHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.mainframe</a> &gt; <span class="el_source">SplitPnResizeHandler.java</span></div><h1>SplitPnResizeHandler.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui.mainframe;

import net.sourceforge.squirrel_sql.client.session.MessagePanel;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import javax.swing.*;
import java.awt.event.ActionEvent;
import java.util.prefs.Preferences;

public class SplitPnResizeHandler
{
<span class="nc" id="L13">   private static final StringManager s_stringMgr =</span>
<span class="nc" id="L14">       StringManagerFactory.getStringManager(SplitPnResizeHandler.class);</span>

   private static final String PREFS_KEY_MESSAGEPANEL_HEIGHT = &quot;squirrelSql_msgPanel_height&quot;;

   private boolean m_hasBeenVisible;

   private JSplitPane _splitPn;
   private MessagePanel _msgPnl;

   public SplitPnResizeHandler(JSplitPane splitPn, MessagePanel msgPnl)
<span class="nc" id="L24">   {</span>
<span class="nc" id="L25">      _splitPn = splitPn;</span>
<span class="nc" id="L26">      _msgPnl = msgPnl;</span>

      String key;

      //i18n[MainFrame.saveSize=Save size]
<span class="nc" id="L31">      key = s_stringMgr.getString(&quot;MainFrame.saveSize&quot;);</span>
<span class="nc" id="L32">      Action saveSplitDividerLocAction = new AbstractAction(key)</span>
<span class="nc" id="L33">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L36">            int msgPanelHeight = _splitPn.getBottomComponent().getSize().height;</span>
<span class="nc" id="L37">            Preferences.userRoot().putInt(PREFS_KEY_MESSAGEPANEL_HEIGHT, msgPanelHeight);</span>
<span class="nc" id="L38">         }</span>
      };
<span class="nc" id="L40">      _msgPnl.addToMessagePanelPopup(saveSplitDividerLocAction);</span>

      //i18n[MainFrame.saveSize0=Save size 0]
<span class="nc" id="L43">      key = s_stringMgr.getString(&quot;MainFrame.saveSize0&quot;);</span>
<span class="nc" id="L44">      Action save0SplitDividerLocAction = new AbstractAction(key)</span>
<span class="nc" id="L45">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L48">            Preferences.userRoot().putInt(PREFS_KEY_MESSAGEPANEL_HEIGHT, 0);</span>
<span class="nc" id="L49">            setUnexpanded();</span>
<span class="nc" id="L50">         }</span>
      };
<span class="nc" id="L52">      _msgPnl.addToMessagePanelPopup(save0SplitDividerLocAction);</span>


<span class="nc" id="L55">      key = s_stringMgr.getString(&quot;MainFrame.restoreSize&quot;);</span>
<span class="nc" id="L56">      Action setSplitDividerLocAction = new AbstractAction(key)</span>
<span class="nc" id="L57">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L60">            int prefMsgPanelHeight = Preferences.userRoot().getInt(PREFS_KEY_MESSAGEPANEL_HEIGHT, -1);</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">            if(-1 != prefMsgPanelHeight)</span>
            {
<span class="nc bnc" id="L63" title="All 2 branches missed.">               if (0 == prefMsgPanelHeight)</span>
               {
<span class="nc" id="L65">                  setUnexpanded();</span>
               }
               else
               {
<span class="nc" id="L69">                  int divLoc = getDividerLocation(prefMsgPanelHeight, _splitPn);</span>
<span class="nc" id="L70">                  _splitPn.setDividerLocation(divLoc);</span>
               }
            }
<span class="nc" id="L73">         }</span>
      };
<span class="nc" id="L75">      _msgPnl.addToMessagePanelPopup(setSplitDividerLocAction);</span>

<span class="nc" id="L77">   }</span>

   private void setUnexpanded()
   {
<span class="nc" id="L81">      _splitPn.setDividerLocation(_splitPn.getMaximumDividerLocation() + 100);</span>
<span class="nc" id="L82">   }</span>

   void resizeSplitOnStartup()
   {

<span class="nc bnc" id="L87" title="All 2 branches missed.">      if(false == m_hasBeenVisible)</span>
      {
<span class="nc" id="L89">         m_hasBeenVisible = true;</span>
<span class="nc" id="L90">         final int prefMsgPanelHeight = Preferences.userRoot().getInt(PREFS_KEY_MESSAGEPANEL_HEIGHT, -1);</span>

<span class="nc" id="L92">         SwingUtilities.invokeLater(new Runnable()</span>
<span class="nc" id="L93">         {</span>
            public void run()
            {
<span class="nc bnc" id="L96" title="All 2 branches missed.">               if (-1 == prefMsgPanelHeight)</span>
               {
<span class="nc" id="L98">                  int divLoc = getDividerLocation(50, _splitPn);</span>
<span class="nc" id="L99">                  _splitPn.setDividerLocation(divLoc);</span>
<span class="nc" id="L100">               }</span>
               else
               {
<span class="nc bnc" id="L103" title="All 2 branches missed.">                  if (0 == prefMsgPanelHeight)</span>
                  {
<span class="nc" id="L105">                     tryForceUnexpanded();</span>
                  }
                  else
                  {
<span class="nc" id="L109">                     int divLoc = getDividerLocation(prefMsgPanelHeight, _splitPn);</span>
<span class="nc" id="L110">                     _splitPn.setDividerLocation(divLoc);</span>
                  }

               }
<span class="nc" id="L114">            }</span>
         });

      }
<span class="nc" id="L118">   }</span>

   /**
    * Used at startup and almost always makes it to hide the Message panel at startup
    */
   private void tryForceUnexpanded()
   {
<span class="nc" id="L125">      setUnexpanded();</span>
<span class="nc" id="L126">      Runnable runnable = new Runnable()</span>
<span class="nc" id="L127">      {</span>
         public void run()
         {
<span class="nc" id="L130">            setUnexpanded();</span>
<span class="nc" id="L131">         }</span>
      };
<span class="nc" id="L133">      SwingUtilities.invokeLater(runnable);</span>
<span class="nc" id="L134">   }</span>

   private int getDividerLocation(int wantedBottomComponentHeight, JSplitPane splitPn)
   {
<span class="nc" id="L138">      int splitBarSize =</span>
<span class="nc" id="L139">         splitPn.getSize().height -</span>
<span class="nc" id="L140">         splitPn.getBottomComponent().getSize().height -</span>
<span class="nc" id="L141">         splitPn.getTopComponent().getSize().height - 1;</span>

<span class="nc" id="L143">      int divLoc = splitPn.getSize().height - wantedBottomComponentHeight - splitBarSize;</span>
<span class="nc" id="L144">      return divLoc;</span>
   }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>