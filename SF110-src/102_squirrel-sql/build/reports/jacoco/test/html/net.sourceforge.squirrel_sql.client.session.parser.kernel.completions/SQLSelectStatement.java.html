<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLSelectStatement.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.parser.kernel.completions</a> &gt; <span class="el_source">SQLSelectStatement.java</span></div><h1>SQLSelectStatement.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2002 Christian Sell
 * csell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 *
 * created by cse, 26.09.2002 15:14:45
 *
 * @version $Id: SQLSelectStatement.java,v 1.2 2007-08-20 00:16:17 manningr Exp $
 */
package net.sourceforge.squirrel_sql.client.session.parser.kernel.completions;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Vector;

import net.sourceforge.squirrel_sql.client.session.parser.kernel.Completion;
import net.sourceforge.squirrel_sql.client.session.parser.kernel.ParserLogger;
import net.sourceforge.squirrel_sql.client.session.parser.kernel.SQLSchema;


/**
 * an SQL select statement
 */
public class SQLSelectStatement extends SQLStatement
{
    private static final int FA_START = 0;
    private static final int FA_END = 1;

    private static final int FA_GROUPBY = 0;
    private static final int FA_HAVING = 1;
    private static final int FA_ORDERBY = 2;

<span class="nc" id="L47">    private Map&lt;String, Table&gt; aliasMap = new HashMap&lt;String, Table&gt;();</span>
    private int selectListStart, selectListEnd, fromStart, fromEnd;

<span class="nc" id="L50">    private int[][] fieldAreas = new int[3][2]; //FA_xxx</span>

<span class="nc" id="L52">	 private Vector&lt;SQLSelectStatementListener&gt; listeners = </span>
	     new Vector&lt;SQLSelectStatementListener&gt;();

    public SQLSelectStatement(int start)
    {
<span class="nc" id="L57">        super(start);</span>
<span class="nc" id="L58">    }</span>

    public void setSelectListStart(int start)
    {
<span class="nc" id="L62">        selectListStart = start;</span>
<span class="nc" id="L63">        selectListEnd = NO_LIMIT;</span>
<span class="nc" id="L64">        setEndPosition(selectListEnd);</span>
<span class="nc" id="L65">    }</span>

    public void setSelectListEnd(int end)
    {
<span class="nc" id="L69">        selectListEnd = end;</span>
<span class="nc" id="L70">        setEndPosition(end);</span>
<span class="nc" id="L71">    }</span>

    public void setFromStart(int fromStart)
    {
<span class="nc" id="L75">        this.fromStart = fromStart;</span>
<span class="nc" id="L76">        this.fromEnd = NO_LIMIT;</span>
<span class="nc" id="L77">        setEndPosition(fromEnd);</span>
<span class="nc" id="L78">    }</span>

    public void setFromEnd(int fromEnd)
    {
<span class="nc" id="L82">        this.fromEnd = fromEnd;</span>
<span class="nc" id="L83">        setEndPosition(fromEnd);</span>
<span class="nc" id="L84">    }</span>

    public void setGroupByStart(int start)
    {
<span class="nc" id="L88">        setFieldAreaStart(FA_GROUPBY, start);</span>
<span class="nc" id="L89">    }</span>

    public void setGroupByEnd(int whereEnd)
    {
<span class="nc" id="L93">        setFieldAreEnd(FA_GROUPBY, whereEnd);</span>
<span class="nc" id="L94">    }</span>

    public void setHavingStart(int start)
    {
<span class="nc" id="L98">        setFieldAreaStart(FA_HAVING, start);</span>
<span class="nc" id="L99">    }</span>

    public void setHavingEnd(int whereEnd)
    {
<span class="nc" id="L103">        setFieldAreEnd(FA_HAVING, whereEnd);</span>
<span class="nc" id="L104">    }</span>

    public void setOrderByStart(int start)
    {
<span class="nc" id="L108">        setFieldAreaStart(FA_ORDERBY, start);</span>
<span class="nc" id="L109">    }</span>

    public void setOrderByEnd(int whereEnd)
    {
<span class="nc" id="L113">        setFieldAreEnd(FA_ORDERBY, whereEnd);</span>
<span class="nc" id="L114">    }</span>

    private void setFieldAreaStart(int fa, int start)
    {
<span class="nc" id="L118">        fieldAreas[fa][FA_START] = start;</span>
<span class="nc" id="L119">        fieldAreas[fa][FA_END] = NO_LIMIT;</span>
<span class="nc" id="L120">        setEndPosition(NO_LIMIT);</span>
<span class="nc" id="L121">    }</span>

    private void setFieldAreEnd(int fa, int end)
    {
<span class="nc" id="L125">        fieldAreas[fa][FA_END] = end;</span>
<span class="nc" id="L126">        setEndPosition(end);</span>
<span class="nc" id="L127">    }</span>

    public boolean setTable(String catalog, String schema, String name, String alias)
    {
<span class="nc" id="L131">        ParserLogger.log(&quot;setTable: &quot;+alias+&quot;.&quot;+name);</span>
<span class="nc" id="L132">        Table table = sqlSchema.getTable(catalog, schema, name);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">        if(table == null) return false;</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">        if(alias != null)</span>
		  {
<span class="nc" id="L136">            aliasMap.put(alias, table.clone(alias));</span>
<span class="nc" id="L137">			   fireAliasDefined(name, alias);</span>
		  }
<span class="nc" id="L139">        return true;</span>
    }

    public List&lt;Table&gt; getTables(String catalog, String schema, String name)
    {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if(aliasMap.size() == 0)</span>
<span class="nc" id="L145">            return sqlSchema.getTables(catalog, schema, name);</span>
        else {
<span class="nc" id="L147">            List&lt;Table&gt; tables = sqlSchema.getTables(catalog, schema, name);</span>
<span class="nc" id="L148">            tables.addAll(aliasMap.values());</span>
<span class="nc" id="L149">            return tables;</span>
        }
    }

    public SQLSchema.Table getTableForAlias(String alias)
    {
<span class="nc" id="L155">        SQLSchema.Table table = aliasMap.get(alias);</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        return table != null ? table : sqlSchema.getTableForAlias(alias);</span>
    }

    public Completion getCompletion(int offset)
    {
<span class="nc" id="L161">        Completion comp = super.getCompletion(offset);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">        if(comp != null) return comp;</span>

<span class="nc bnc" id="L164" title="All 4 branches missed.">        if(offset &gt;= selectListStart &amp;&amp; offset &lt;= selectListEnd)</span>
<span class="nc" id="L165">            return new SQLColumn(this, offset, offset);</span>
<span class="nc bnc" id="L166" title="All 4 branches missed.">        else if(offset &gt;= fromStart &amp;&amp; offset &lt;= fromEnd)</span>
<span class="nc" id="L167">            return new SQLTable(this, offset, offset);</span>
        else {
<span class="nc bnc" id="L169" title="All 2 branches missed.">            for(int i=0; i&lt;fieldAreas.length; i++) {</span>
<span class="nc bnc" id="L170" title="All 4 branches missed.">                if(offset &gt;= fieldAreas[i][FA_START] &amp;&amp; offset &lt;= fieldAreas[i][FA_END]) {</span>
<span class="nc" id="L171">                    SQLColumn col = new SQLColumn(this, offset, offset);</span>
<span class="nc" id="L172">                    col.setRepeatable(false);</span>
<span class="nc" id="L173">                    return col;</span>
                }
            }
        }
<span class="nc" id="L177">        return null;</span>
    }

	 public void addListener(SQLSelectStatementListener l)
	 {
<span class="nc" id="L182">        listeners.add(l);</span>
<span class="nc" id="L183">	 }</span>

 	 public void removeListener(SQLSelectStatementListener l)
    {
<span class="nc" id="L187">	    listeners.remove(l);</span>
<span class="nc" id="L188">	 }</span>

	 private void fireAliasDefined(String tableName, String aliasName)
	 {
<span class="nc" id="L192">    	 SQLSelectStatementListener[] clone = </span>
<span class="nc" id="L193">    	     listeners.toArray(new SQLSelectStatementListener[listeners.size()]);</span>

<span class="nc bnc" id="L195" title="All 2 branches missed.">		 for (int i = 0; i &lt; clone.length; i++)</span>
		 {
<span class="nc" id="L197">			 clone[i].aliasDefined(tableName, aliasName);</span>
		 }
<span class="nc" id="L199">	 }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>