<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLDriver.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.sql</a> &gt; <span class="el_source">SQLDriver.java</span></div><h1>SQLDriver.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.sql;
/*
 * Copyright (C) 2001-2002 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.beans.PropertyChangeListener;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

import net.sourceforge.squirrel_sql.fw.id.IIdentifier;
import net.sourceforge.squirrel_sql.fw.persist.ValidationException;
import net.sourceforge.squirrel_sql.fw.util.PropertyChangeReporter;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.beanwrapper.StringWrapper;
/**
 * This represents a JDBC driver.
 * This class is a &lt;CODE&gt;JavaBean&lt;/CODE&gt;.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class SQLDriver implements ISQLDriver, Cloneable, Serializable
{
    static final long serialVersionUID = 8506401259069527981L;
    
	/** Internationalized strings for this class. */
<span class="nc" id="L42">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L43">		StringManagerFactory.getStringManager(SQLDriver.class);</span>

	private interface IStrings
	{
<span class="nc" id="L47">		String ERR_BLANK_NAME = s_stringMgr.getString(&quot;SQLDriver.error.blankname&quot;);</span>
<span class="nc" id="L48">		String ERR_BLANK_DRIVER = s_stringMgr.getString(&quot;SQLDriver.error.blankdriver&quot;);</span>
<span class="nc" id="L49">		String ERR_BLANK_URL = s_stringMgr.getString(&quot;SQLDriver.error.blankurl&quot;);</span>
	}

	/** The &lt;CODE&gt;IIdentifier&lt;/CODE&gt; that uniquely identifies this object. */
	private IIdentifier _id;

	/** The name of this driver. */
	private String _name;

	/**
	 * File name associated with &lt;CODE&gt;_jarFileURL&lt;/CODE&gt;.
	 */
<span class="nc" id="L61">	private String _jarFileName = null;</span>

	/** Names for driver jar files. */
<span class="nc" id="L64">	private List&lt;String&gt; _jarFileNamesList = new ArrayList&lt;String&gt;();</span>

	/** The class name of the JDBC driver. */
	private String _driverClassName;

	/** Default URL required to access the database. */
	private String _url;

	/** Is the JDBC driver class for this object loaded? */
	private boolean _jdbcDriverClassLoaded;

	/** Object to handle property change events. */
	private transient PropertyChangeReporter _propChgReporter;

    /** Default Website URL for more info about the JDBC driver */
    private String _websiteUrl;
    
	/**
	 * Ctor specifying the identifier.
	 *
	 * @param	id	Uniquely identifies this object.
	 */
	public SQLDriver(IIdentifier id)
<span class="nc" id="L87">	{</span>
<span class="nc" id="L88">		_id = id;</span>
<span class="nc" id="L89">		_name = &quot;&quot;;</span>
<span class="nc" id="L90">		_jarFileName = null;</span>
<span class="nc" id="L91">		_driverClassName = null;</span>
<span class="nc" id="L92">		_url = &quot;&quot;;</span>
<span class="nc" id="L93">        _websiteUrl = &quot;&quot;;</span>
<span class="nc" id="L94">	}</span>

	/**
	 * Default ctor.
	 */
	public SQLDriver()
<span class="nc" id="L100">	{</span>
<span class="nc" id="L101">	}</span>

	/**
	 * Assign data from the passed &lt;CODE&gt;ISQLDriver&lt;/CODE&gt; to this one. This
	 * does &lt;B&gt;not&lt;/B&gt; copy the identifier.
	 *
	 * @param	rhs	 &lt;CODE&gt;ISQLDriver&lt;/CODE&gt; to copy data from.
	 *
	 * @exception	ValidationException
	 *				Thrown if an error occurs assigning data from
	 *				&lt;CODE&gt;rhs&lt;/CODE&gt;.
	 */
	public synchronized void assignFrom(ISQLDriver rhs)
		throws ValidationException
	{
<span class="nc" id="L116">		setName(rhs.getName());</span>
<span class="nc" id="L117">		setJarFileNames(rhs.getJarFileNames());</span>
<span class="nc" id="L118">		setDriverClassName(rhs.getDriverClassName());</span>
<span class="nc" id="L119">		setUrl(rhs.getUrl());</span>
<span class="nc" id="L120">		setJDBCDriverClassLoaded(rhs.isJDBCDriverClassLoaded());</span>
<span class="nc" id="L121">        setWebSiteUrl(rhs.getWebSiteUrl());</span>
<span class="nc" id="L122">	}</span>

	/**
	 * Returns &lt;TT&gt;true&lt;/TT&gt; if this objects is equal to the passed one. Two
	 * &lt;TT&gt;ISQLDriver&lt;/TT&gt; objects are considered equal if they have the same
	 * identifier.
	 */
	public boolean equals(Object rhs)
	{
<span class="nc" id="L131">		boolean rc = false;</span>
<span class="nc bnc" id="L132" title="All 4 branches missed.">		if (rhs != null &amp;&amp; rhs.getClass().equals(getClass()))</span>
		{
<span class="nc" id="L134">			rc = ((ISQLDriver) rhs).getIdentifier().equals(getIdentifier());</span>
		}
<span class="nc" id="L136">		return rc;</span>
	}

	/**
	 * Returns a hash code value for this object.
	 */
	public synchronized int hashCode()
	{
<span class="nc" id="L144">		return getIdentifier().hashCode();</span>
	}

	/**
	 * Returns the name of this &lt;TT&gt;ISQLDriver&lt;/TT&gt;.
	 */
	public String toString()
	{
<span class="nc" id="L152">		return getName();</span>
	}

	/**
	 * Return a clone of this object.
	 */
	public Object clone()
	{
		try
		{
<span class="nc" id="L162">			final SQLDriver driver = (SQLDriver)super.clone();</span>
<span class="nc" id="L163">			driver._propChgReporter = null;</span>
<span class="nc" id="L164">			return driver;</span>
		}
<span class="nc" id="L166">		catch (CloneNotSupportedException ex)</span>
		{
<span class="nc" id="L168">			throw new InternalError(ex.getMessage()); // Impossible.</span>
		}
	}

	/**
	 * Compare this &lt;TT&gt;ISQLDriver&lt;/TT&gt; to another &lt;TT&gt;ISQLDriver&lt;/TT&gt;.  The 
	 * &lt;TT&gt;getName()&lt;/TT&gt; functions of the two &lt;TT&gt;ISQLDriver&lt;/TT&gt; objects are 
	 * used to compare them. 
	 */
	public int compareTo(ISQLDriver rhs)
	{
<span class="nc" id="L179">		return _name.compareTo(rhs.getName());</span>
	}

	public void addPropertyChangeListener(PropertyChangeListener listener)
	{
<span class="nc" id="L184">		getPropertyChangeReporter().addPropertyChangeListener(listener);</span>
<span class="nc" id="L185">	}</span>

	public void removePropertyChangeListener(PropertyChangeListener listener)
	{
<span class="nc" id="L189">		getPropertyChangeReporter().removePropertyChangeListener(listener);</span>
<span class="nc" id="L190">	}</span>

	public void setReportPropertyChanges(boolean report)
	{
<span class="nc" id="L194">		getPropertyChangeReporter().setNotify(report);</span>
<span class="nc" id="L195">	}</span>

	public IIdentifier getIdentifier()
	{
<span class="nc" id="L199">		return _id;</span>
	}

	public void setIdentifier(IIdentifier id)
	{
<span class="nc" id="L204">		_id = id;</span>
<span class="nc" id="L205">	}</span>

	public String getDriverClassName()
	{
<span class="nc" id="L209">		return _driverClassName;</span>
	}

	public void setDriverClassName(String driverClassName)
		throws ValidationException
	{
<span class="nc" id="L215">		String data = getString(driverClassName);</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if (data.length() == 0)</span>
		{
<span class="nc" id="L218">			throw new ValidationException(IStrings.ERR_BLANK_DRIVER);</span>
		}
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!data.equals(_driverClassName))</span>
		{
<span class="nc" id="L222">			final String oldValue = _driverClassName;</span>
<span class="nc" id="L223">			_driverClassName = data;</span>
<span class="nc" id="L224">			getPropertyChangeReporter().firePropertyChange(</span>
				ISQLDriver.IPropertyNames.DRIVER_CLASS,
				oldValue,
				_driverClassName);
		}
<span class="nc" id="L229">	}</span>

	/**
	 * @deprecated	Replaced by getJarFileNames().
	 */
	public String getJarFileName()
	{
<span class="nc" id="L236">		return _jarFileName;</span>
	}

	public void setJarFileName(String value)
	{
<span class="nc bnc" id="L241" title="All 2 branches missed.">		if (value == null)</span>
		{
<span class="nc" id="L243">			value = &quot;&quot;;</span>
		}
<span class="nc bnc" id="L245" title="All 4 branches missed.">		if (_jarFileName == null || !_jarFileName.equals(value))</span>
		{
<span class="nc" id="L247">			final String oldValue = _jarFileName;</span>
<span class="nc" id="L248">			_jarFileName = value;</span>
<span class="nc" id="L249">			getPropertyChangeReporter().firePropertyChange(</span>
				ISQLDriver.IPropertyNames.JARFILE_NAME,
				oldValue,
				_jarFileName);
		}
<span class="nc" id="L254">	}</span>

	public synchronized String[] getJarFileNames()
	{
<span class="nc" id="L258">		return _jarFileNamesList.toArray(new String[_jarFileNamesList.size()]);</span>
	}

	public synchronized void setJarFileNames(String[] values)
	{
<span class="nc" id="L263">		String[] oldValue =</span>
<span class="nc" id="L264">            _jarFileNamesList.toArray(new String[_jarFileNamesList.size()]);</span>
<span class="nc" id="L265">		_jarFileNamesList.clear();</span>

<span class="nc bnc" id="L267" title="All 2 branches missed.">		if (values == null)</span>
		{
<span class="nc" id="L269">			values = new String[0];</span>
		}

<span class="nc bnc" id="L272" title="All 2 branches missed.">		for (int i = 0; i &lt; values.length; ++i)</span>
		{
<span class="nc" id="L274">			_jarFileNamesList.add(values[i]);</span>
		}

<span class="nc" id="L277">		getPropertyChangeReporter().firePropertyChange(</span>
			ISQLDriver.IPropertyNames.JARFILE_NAMES,
			oldValue,
			values);
<span class="nc" id="L281">	}</span>
	public String getUrl()
	{
<span class="nc" id="L284">		return _url;</span>
	}

	public void setUrl(String url) throws ValidationException
	{
<span class="nc" id="L289">		String data = getString(url);</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">		if (data.length() == 0)</span>
		{
<span class="nc" id="L292">			throw new ValidationException(IStrings.ERR_BLANK_URL);</span>
		}
<span class="nc bnc" id="L294" title="All 2 branches missed.">		if (!data.equals(_url))</span>
		{
<span class="nc" id="L296">			final String oldValue = _url;</span>
<span class="nc" id="L297">			_url = data;</span>
<span class="nc" id="L298">			getPropertyChangeReporter().firePropertyChange(</span>
				ISQLDriver.IPropertyNames.URL,
				oldValue,
				_url);
		}
<span class="nc" id="L303">	}</span>

	public String getName()
	{
<span class="nc" id="L307">		return _name;</span>
	}

	public void setName(String name) throws ValidationException
	{
<span class="nc" id="L312">		String data = getString(name);</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">		if (data.length() == 0)</span>
		{
<span class="nc" id="L315">			throw new ValidationException(IStrings.ERR_BLANK_NAME);</span>
		}
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (!data.equals(_name))</span>
		{
<span class="nc" id="L319">			final String oldValue = _name;</span>
<span class="nc" id="L320">			_name = data;</span>
<span class="nc" id="L321">			getPropertyChangeReporter().firePropertyChange(</span>
				ISQLDriver.IPropertyNames.NAME,
				oldValue,
				_name);
		}
<span class="nc" id="L326">	}</span>

	public boolean isJDBCDriverClassLoaded()
	{
<span class="nc" id="L330">		return _jdbcDriverClassLoaded;</span>
	}

	public void setJDBCDriverClassLoaded(boolean cl)
	{
<span class="nc" id="L335">		_jdbcDriverClassLoaded = cl;</span>
		//TODO: Decide whether this should be a bound property or not.
		//		getPropertyChangeReporter().firePropertyChange(ISQLDriver.IPropertyNames.NAME, _name, _name);
<span class="nc" id="L338">	}</span>

	public synchronized StringWrapper[] getJarFileNameWrappers()
	{
<span class="nc" id="L342">		StringWrapper[] wrappers = new StringWrapper[_jarFileNamesList.size()];</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">		for (int i = 0; i &lt; wrappers.length; ++i)</span>
		{
<span class="nc" id="L345">			wrappers[i] = new StringWrapper(_jarFileNamesList.get(i));</span>
		}
<span class="nc" id="L347">		return wrappers;</span>
	}

	public StringWrapper getJarFileNameWrapper(int idx)
		throws ArrayIndexOutOfBoundsException
	{
<span class="nc" id="L353">		return new StringWrapper(_jarFileNamesList.get(idx));</span>
	}

	public void setJarFileNameWrappers(StringWrapper[] value)
	{
<span class="nc" id="L358">		_jarFileNamesList.clear();</span>
<span class="nc bnc" id="L359" title="All 2 branches missed.">		if (value != null)</span>
		{
<span class="nc bnc" id="L361" title="All 2 branches missed.">			for (int i = 0; i &lt; value.length; ++i)</span>
			{
<span class="nc" id="L363">				_jarFileNamesList.add(value[i].getString());</span>
			}
		}
<span class="nc" id="L366">	}</span>

	public void setJarFileNameWrapper(int idx, StringWrapper value)
		throws ArrayIndexOutOfBoundsException
	{
<span class="nc" id="L371">		_jarFileNamesList.set(idx, value.getString());</span>
<span class="nc" id="L372">	}</span>

	private String getString(String data)
	{
<span class="nc bnc" id="L376" title="All 2 branches missed.">		return data != null ? data.trim() : &quot;&quot;;</span>
	}

	private synchronized PropertyChangeReporter getPropertyChangeReporter()
	{
<span class="nc bnc" id="L381" title="All 2 branches missed.">		if (_propChgReporter == null)</span>
		{
<span class="nc" id="L383">			_propChgReporter = new PropertyChangeReporter(this);</span>
		}
<span class="nc" id="L385">		return _propChgReporter;</span>
	}

    /* (non-Javadoc)
     * @see net.sourceforge.squirrel_sql.fw.sql.ISQLDriver#getWebSiteUrl()
     */
    public String getWebSiteUrl() {
<span class="nc" id="L392">        return _websiteUrl;</span>
    }

    /* (non-Javadoc)
     * @see net.sourceforge.squirrel_sql.fw.sql.ISQLDriver#setWebSiteUrl(java.lang.String)
     */
    public void setWebSiteUrl(String url) throws ValidationException { 
<span class="nc" id="L399">        String data = getString(url);</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">        if (!data.equals(_websiteUrl)) {</span>
<span class="nc" id="L401">            final String oldValue = _websiteUrl;</span>
<span class="nc" id="L402">            _websiteUrl = data;</span>
<span class="nc" id="L403">            PropertyChangeReporter pcr = getPropertyChangeReporter();</span>
<span class="nc" id="L404">            pcr.firePropertyChange(ISQLDriver.IPropertyNames.WEBSITE_URL,</span>
                                   oldValue,
                                   _websiteUrl);            
        }
<span class="nc" id="L408">    }</span>
    
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>