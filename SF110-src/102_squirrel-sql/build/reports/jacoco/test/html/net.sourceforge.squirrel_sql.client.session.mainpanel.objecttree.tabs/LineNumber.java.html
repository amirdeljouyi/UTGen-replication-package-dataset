<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LineNumber.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.mainpanel.objecttree.tabs</a> &gt; <span class="el_source">LineNumber.java</span></div><h1>LineNumber.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session.mainpanel.objecttree.tabs;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Rectangle;

import javax.swing.BorderFactory;
import javax.swing.JComponent;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextPane;

//JH: sources freely available without restriction from 
//http://www.discoverteenergy.com/files/LineNumber.java
public class LineNumber extends JComponent
{
<span class="nc" id="L22">	private final static Color DEFAULT_BACKGROUND = new Color(204, 204, 255);</span>
<span class="nc" id="L23">	private final static Color DEFAULT_FOREGROUND = Color.black;</span>
<span class="nc" id="L24">	private final static Font  DEFAULT_FONT = new Font(&quot;monospaced&quot;, Font.PLAIN, 12);</span>

	//  LineNumber height (abends when I use MAX_VALUE)
	private final static int HEIGHT = Integer.MAX_VALUE - 1000000;

	//  Set right/left margin
	private final static int MARGIN = 5;

	//  Variables for this LineNumber component
	private FontMetrics fontMetrics;
	private int lineHeight;
	private int currentDigits;

	//  Metrics of the component used in the constructor
	private JComponent component;
	private int componentFontHeight;
	private int componentFontAscent;

	/**
	 *	Convenience constructor for Text Components
	 */
	public LineNumber(JComponent component)
<span class="nc" id="L46">	{</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">		if (component == null)</span>
		{
<span class="nc" id="L49">			setFont( DEFAULT_FONT );</span>
<span class="nc" id="L50">			this.component = this;</span>
		}
		else
		{
<span class="nc" id="L54">			setFont( component.getFont() );</span>
<span class="nc" id="L55">			this.component = component;</span>
		}

<span class="nc" id="L58">		setBackground( DEFAULT_BACKGROUND );</span>
<span class="nc" id="L59">		setForeground( DEFAULT_FOREGROUND );</span>
<span class="nc" id="L60">		setPreferredWidth( 99 );</span>
<span class="nc" id="L61">	}</span>

	/**
	 *  Calculate the width needed to display the maximum line number
	 */
	public void setPreferredWidth(int lines)
	{
<span class="nc" id="L68">		int digits = String.valueOf(lines).length();</span>

		//  Update sizes when number of digits in the line number changes

<span class="nc bnc" id="L72" title="All 4 branches missed.">		if (digits != currentDigits &amp;&amp; digits &gt; 1)</span>
		{
<span class="nc" id="L74">			currentDigits = digits;</span>
<span class="nc" id="L75">			int width = fontMetrics.charWidth( '0' ) * digits;</span>
<span class="nc" id="L76">			Dimension d = getPreferredSize();</span>
<span class="nc" id="L77">			d.setSize(2 * MARGIN + width, HEIGHT);</span>
<span class="nc" id="L78">			setPreferredSize( d );</span>
<span class="nc" id="L79">			setSize( d );</span>
		}
<span class="nc" id="L81">	}</span>

	/**
	 *  Reset variables that are dependent on the font.
	 */
	public void setFont(Font font)
	{
<span class="nc" id="L88">		super.setFont(font);</span>
<span class="nc" id="L89">		fontMetrics = getFontMetrics( getFont() );</span>
<span class="nc" id="L90">		componentFontHeight = fontMetrics.getHeight();</span>
<span class="nc" id="L91">		componentFontAscent = fontMetrics.getAscent();</span>
<span class="nc" id="L92">	}</span>

	/**
	 *  The line height defaults to the line height of the font for this
	 *  component.
	 */
	public int getLineHeight()
	{
<span class="nc bnc" id="L100" title="All 2 branches missed.">		if (lineHeight == 0)</span>
<span class="nc" id="L101">			return componentFontHeight;</span>
		else
<span class="nc" id="L103">			return lineHeight;</span>
	}

	/**
	 *  Override the default line height with a positive value.
	 *  For example, when you want line numbers for a JTable you could
	 *  use the JTable row height.
	 */
	public void setLineHeight(int lineHeight)
	{
<span class="nc bnc" id="L113" title="All 2 branches missed.">		if (lineHeight &gt; 0)</span>
<span class="nc" id="L114">			this.lineHeight = lineHeight;</span>
<span class="nc" id="L115">	}</span>

	public int getStartOffset()
	{
<span class="nc" id="L119">		return component.getInsets().top + componentFontAscent;</span>
	}

	public void paintComponent(Graphics g)
	{
<span class="nc" id="L124">		int lineHeight = getLineHeight();</span>
<span class="nc" id="L125">		int startOffset = getStartOffset();</span>
<span class="nc" id="L126">		Rectangle drawHere = g.getClipBounds();</span>

		// Paint the background

<span class="nc" id="L130">		g.setColor( getBackground() );</span>
<span class="nc" id="L131">		g.fillRect(drawHere.x, drawHere.y, drawHere.width, drawHere.height);</span>

		//  Determine the number of lines to draw in the foreground.

<span class="nc" id="L135">		g.setColor( getForeground() );</span>
<span class="nc" id="L136">		int startLineNumber = (drawHere.y / lineHeight) + 1;</span>
<span class="nc" id="L137">		int endLineNumber = startLineNumber + (drawHere.height / lineHeight);</span>

<span class="nc" id="L139">		int start = (drawHere.y / lineHeight) * lineHeight + startOffset;</span>

<span class="nc bnc" id="L141" title="All 2 branches missed.">		for (int i = startLineNumber; i &lt;= endLineNumber; i++)</span>
		{
<span class="nc" id="L143">			String lineNumber = String.valueOf(i);</span>
<span class="nc" id="L144">			int stringWidth = fontMetrics.stringWidth( lineNumber );</span>
<span class="nc" id="L145">			int rowWidth = getSize().width;</span>
<span class="nc" id="L146">			g.drawString(lineNumber, rowWidth - stringWidth - MARGIN, start);</span>
<span class="nc" id="L147">			start += lineHeight;</span>
		}

<span class="nc" id="L150">		int rows = component.getSize().height / componentFontHeight;</span>
<span class="nc" id="L151">		setPreferredWidth( rows );</span>
<span class="nc" id="L152">	}</span>

	public static void main(String[] args)
	{
<span class="nc" id="L156">		JFrame frame = new JFrame(&quot;LineNumberDemo&quot;);</span>
<span class="nc" id="L157">		frame.setDefaultCloseOperation( JFrame.EXIT_ON_CLOSE );</span>

<span class="nc" id="L159">		JPanel panel = new JPanel();</span>
<span class="nc" id="L160">		frame.setContentPane( panel );</span>
<span class="nc" id="L161">		panel.setBorder(BorderFactory.createEmptyBorder(20,20,20,20));</span>
<span class="nc" id="L162">		panel.setLayout(new BorderLayout());</span>

<span class="nc" id="L164">		JTextPane textPane = new JTextPane();</span>
<span class="nc" id="L165">		textPane.setFont( new Font(&quot;monospaced&quot;, Font.PLAIN, 12) );</span>
<span class="nc" id="L166">		textPane.setText(&quot;abc&quot;);</span>

<span class="nc" id="L168">		JScrollPane scrollPane = new JScrollPane(textPane);</span>
<span class="nc" id="L169">		panel.add(scrollPane);</span>
<span class="nc" id="L170">		scrollPane.setPreferredSize(new Dimension(300, 250));</span>

<span class="nc" id="L172">		LineNumber lineNumber = new LineNumber( textPane );</span>
<span class="nc" id="L173">		scrollPane.setRowHeaderView( lineNumber );</span>

<span class="nc" id="L175">		frame.pack();</span>
<span class="nc" id="L176">		frame.setVisible(true);</span>
<span class="nc" id="L177">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>