<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SquirrelTabbedPaneDelegate.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.builders</a> &gt; <span class="el_source">SquirrelTabbedPaneDelegate.java</span></div><h1>SquirrelTabbedPaneDelegate.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui.builders;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.client.preferences.SquirrelPreferences;

import javax.swing.*;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.lang.ref.WeakReference;

public class SquirrelTabbedPaneDelegate
{
   private SquirrelPreferences _prefs;

   private PropsListener _prefsListener;
   private JTabbedPane _tabbedPane;

   /** Convenient way to refer to Application Preferences property names. */
   private interface IAppPrefPropertynames extends SquirrelPreferences.IPropertyNames
   {
      // Empty block.
   }

   SquirrelTabbedPaneDelegate(SquirrelPreferences prefs, IApplication app, JTabbedPane tabbedPane)
<span class="nc" id="L25">   {</span>
<span class="nc" id="L26">      _tabbedPane = tabbedPane;</span>
<span class="nc bnc" id="L27" title="All 2 branches missed.">      if (prefs == null) { throw new IllegalArgumentException(&quot;SquirrelPreferences == null&quot;); }</span>
<span class="nc" id="L28">      _prefs = prefs;</span>

<span class="nc" id="L30">      int tabLayoutPolicy =</span>
<span class="nc bnc" id="L31" title="All 2 branches missed.">            _prefs.getUseScrollableTabbedPanes() ? JTabbedPane.SCROLL_TAB_LAYOUT : JTabbedPane.WRAP_TAB_LAYOUT;</span>
<span class="nc" id="L32">      _tabbedPane.setTabLayoutPolicy(tabLayoutPolicy);</span>
<span class="nc" id="L33">   }</span>

   /**
    * Component is being added to its parent so add a property change listener to application perferences.
    */
   public void addNotify()
   {
<span class="nc" id="L40">      _prefsListener = new PropsListener(_prefs, _tabbedPane);</span>
<span class="nc" id="L41">      _prefs.addPropertyChangeListener(_prefsListener);</span>
<span class="nc" id="L42">      _prefsListener.propertiesHaveChanged(null);</span>
<span class="nc" id="L43">   }</span>

   /**
    * Component is being removed from its parent so remove the property change listener from the application
    * preferences.
    */
   public void removeNotify()
   {
<span class="nc" id="L51">      _tabbedPane.removeNotify();</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">      if (_prefsListener != null)</span>
      {
<span class="nc" id="L54">         _prefs.removePropertyChangeListener(_prefsListener);</span>
<span class="nc" id="L55">         _prefsListener = null;</span>
      }
<span class="nc" id="L57">   }</span>


   /**
    * Avoids memory leaks.
    *
    * Removing the global listener in removeNotify() did not prove really save.
    * We introduced this listener class to hold a weak reference to the tabbed pane
    * to make sure Sessions get garbage collected:
    *
    * If removeNotify() does not work this listener will remain in the list of the global prefs
    * listener. It will then be the only global reference to the tabbed pane.
    * The tabbed pane then can be garbage collected which will result in garbage collecting the
    * complete Session.
    *
    */
   private static final class PropsListener implements PropertyChangeListener
   {
      private SquirrelPreferences _prefs;

      private WeakReference&lt;JTabbedPane&gt; _refSquirrelTabbedPane;

      public PropsListener(SquirrelPreferences prefs, JTabbedPane squirrelTabbedPane)
<span class="nc" id="L80">      {</span>
<span class="nc" id="L81">         _prefs = prefs;</span>
<span class="nc" id="L82">         _refSquirrelTabbedPane = new WeakReference&lt;JTabbedPane&gt;(squirrelTabbedPane);</span>
<span class="nc" id="L83">      }</span>

      public void propertyChange(PropertyChangeEvent evt)
      {
<span class="nc" id="L87">         propertiesHaveChanged(evt.getPropertyName());</span>
<span class="nc" id="L88">      }</span>

      void propertiesHaveChanged(String propName)
      {
<span class="nc" id="L92">         JTabbedPane squirrelTabbedPane = _refSquirrelTabbedPane.get();</span>

<span class="nc bnc" id="L94" title="All 2 branches missed.">         if(null == squirrelTabbedPane)</span>
         {
<span class="nc" id="L96">            return;</span>
         }


<span class="nc bnc" id="L100" title="All 4 branches missed.">         if (propName == null || propName.equals(IAppPrefPropertynames.SCROLLABLE_TABBED_PANES))</span>
         {
<span class="nc" id="L102">            int tabLayoutPolicy =</span>
<span class="nc bnc" id="L103" title="All 2 branches missed.">                  _prefs.getUseScrollableTabbedPanes() ? JTabbedPane.SCROLL_TAB_LAYOUT</span>
                        : JTabbedPane.WRAP_TAB_LAYOUT;
<span class="nc" id="L105">            squirrelTabbedPane.setTabLayoutPolicy(tabLayoutPolicy);</span>
         }
<span class="nc" id="L107">      }</span>

   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>