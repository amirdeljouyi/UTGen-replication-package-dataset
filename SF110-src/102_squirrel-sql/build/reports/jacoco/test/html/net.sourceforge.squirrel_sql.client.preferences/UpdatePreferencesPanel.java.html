<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UpdatePreferencesPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.preferences</a> &gt; <span class="el_source">UpdatePreferencesPanel.java</span></div><h1>UpdatePreferencesPanel.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2007 Rob Manning
 * manningr@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
package net.sourceforge.squirrel_sql.client.preferences;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;

import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.ButtonGroup;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JRadioButton;
import javax.swing.JSeparator;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.client.preferences.UpdateChannelComboBoxEntry.ChannelType;
import net.sourceforge.squirrel_sql.client.update.UpdateCheckFrequency;
import net.sourceforge.squirrel_sql.client.update.UpdateUtil;
import net.sourceforge.squirrel_sql.client.update.UpdateUtilImpl;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import org.apache.commons.lang.StringUtils;

public class UpdatePreferencesPanel extends JPanel
{
<span class="nc" id="L58">	private static final Color CONNECTION_FAILURE_COLOR = Color.RED;</span>

<span class="nc" id="L60">	private static final Color CONNECTION_SUCCESS_COLOR = new Color(67, 181, 118);</span>

	/** Internationalized strings for this class. */
<span class="nc" id="L63">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L64">		StringManagerFactory.getStringManager(UpdatePreferencesPanel.class);</span>

<span class="nc" id="L66">	private static final UpdateUtil _updateUtil = new UpdateUtilImpl();</span>

	static interface i18n
	{

		// i18n[UpdatePreferencesPanel.atStartupLabel=At Startup]
<span class="nc" id="L72">		String AT_STARTUP_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.atStartupLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.autoBorderLabel=Automatic Updates]
<span class="nc" id="L75">		String AUTO_BORDER_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.autoBorderLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.autoCheckFrequency=How often to check for
		// updates:]
<span class="nc" id="L79">		String AUTO_CHECK_FREQUENCY = s_stringMgr.getString(&quot;UpdatePreferencesPanel.autoCheckFrequency&quot;);</span>

		// i18n[UpdatePreferencesPanel.channel=Channel:]
<span class="nc" id="L82">		String CHANNEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.channel&quot;);</span>

		// i18n[UpdatePreferencesPanel.updateSiteBorderLabel=Update Site]
<span class="nc" id="L85">		String UPDATE_SITE_BORDER_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.updateSiteBorderLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.enableAutoUpdate=Enable Automatic Updates]
<span class="nc" id="L88">		String ENABLE_AUTO_UPDATE = s_stringMgr.getString(&quot;UpdatePreferencesPanel.enableAutoUpdate&quot;);</span>

		// i18n[UpdatePreferencesPanel.localPathLabel=Local Path:]
<span class="nc" id="L91">		String LOCAL_PATH = s_stringMgr.getString(&quot;UpdatePreferencesPanel.localPathLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.localSiteButtonLabel=Local]
<span class="nc" id="L94">		String LOCAL_SITE_BUTTON_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.localSiteButtonLabel&quot;);		</span>
		
		// i18n[UpdatePreferencesPanel.path=Path:]
<span class="nc" id="L97">		String PATH = s_stringMgr.getString(&quot;UpdatePreferencesPanel.path&quot;);</span>

		// i18n[UpdatePreferencesPanel.port=Port:]
<span class="nc" id="L100">		String PORT = s_stringMgr.getString(&quot;UpdatePreferencesPanel.port&quot;);</span>

		// i18n[UpdatePreferencesPanel.server=Server:]
<span class="nc" id="L103">		String SERVER = s_stringMgr.getString(&quot;UpdatePreferencesPanel.server&quot;);</span>

		// i18n[UpdatePreferencesPanel.dailyLabel=Daily]
<span class="nc" id="L106">		String DAILY_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.dailyLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.weeklyLabel=Weekly]
<span class="nc" id="L109">		String WEEKLY_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.weeklyLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.remoteSiteButtonLabel=Remote]
<span class="nc" id="L112">		String REMOTE_SITE_BUTTON_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.remoteSiteButtonLabel&quot;);</span>
		
		// i18n[UpdatePreferencesPanel.siteTypeLabel=Site Type:]
<span class="nc" id="L115">		String SITE_TYPE_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.siteTypeLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.testLabel=Test Connection]
<span class="nc" id="L118">		String TEST_LABEL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.testLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.urlLabel=Url:]
<span class="nc" id="L121">		String URL = s_stringMgr.getString(&quot;UpdatePreferencesPanel.urlLabel&quot;);</span>

		// i18n[UpdatePreferencesPanel.statusLableSuccessMsg=Connected Successfully]
<span class="nc" id="L124">		String STATUS_LABEL_SUCCESS_MSG = s_stringMgr.getString(&quot;UpdatePreferencesPanel.statusLableSuccessMsg&quot;);</span>

		// i18n[UpdatePreferencesPanel.statusLableFailureMsg=Connection failed. See log for error.]
<span class="nc" id="L127">		String STATUS_LABEL_FAILURE_MSG = s_stringMgr.getString(&quot;UpdatePreferencesPanel.statusLableFailureMsg&quot;);</span>

		// i18n[UpdatePreferencesPanel.connectionFailureDialogMsg=Unable to download release.xml from the
		// specified location]
<span class="nc" id="L131">		String CONNECTION_FAILURE_DIALOG_MSG =</span>
<span class="nc" id="L132">			s_stringMgr.getString(&quot;UpdatePreferencesPanel.connectionFailureDialogMsg&quot;);</span>
	}

	private static final long serialVersionUID = 6411907298042579120L;

<span class="nc" id="L137">	private JLabel _serverLabel = null;</span>

<span class="nc" id="L139">	private JLabel _portLabel = null;</span>

<span class="nc" id="L141">	private JLabel _pathLabel = null;</span>

<span class="nc" id="L143">	private JLabel _localPathLabel = null;</span>

<span class="nc" id="L145">	private JLabel _channelLabel = null;</span>

<span class="nc" id="L147">	private JLabel _urlLabel = null;</span>

<span class="nc" id="L149">	private JTextField _updateServerName = new JTextField();</span>

<span class="nc" id="L151">	private JTextField _updateServerPort = new JTextField();</span>

<span class="nc" id="L153">	private JTextField _updateServerPath = new JTextField();</span>

<span class="nc" id="L155">	private JTextField _localPath = new JTextField();</span>

<span class="nc" id="L157">	private JTextField _updateUrl = new JTextField();</span>

<span class="nc" id="L159">	private JLabel siteTypeLabel = null;</span>

<span class="nc" id="L161">	private JRadioButton _remoteTypeButton = new JRadioButton(i18n.REMOTE_SITE_BUTTON_LABEL);</span>

<span class="nc" id="L163">	private JRadioButton _localTypeButton = new JRadioButton(i18n.LOCAL_SITE_BUTTON_LABEL);</span>

<span class="nc" id="L165">	private ButtonGroup _updateSiteTypeGroup = new ButtonGroup();</span>

<span class="nc" id="L167">	private UpdateChannelComboBoxEntry stableChannel =</span>
		new UpdateChannelComboBoxEntry(ChannelType.STABLE, &quot;stable&quot;);

<span class="nc" id="L170">	private UpdateChannelComboBoxEntry snapshotChannel =</span>
		new UpdateChannelComboBoxEntry(ChannelType.SNAPSHOT, &quot;snapshot&quot;);

<span class="nc" id="L173">	private JComboBox _updateServerChannel = new JComboBox(new Object[] { stableChannel, snapshotChannel });</span>

<span class="nc" id="L175">	private JCheckBox _enableAutoUpdateChk = new JCheckBox(i18n.ENABLE_AUTO_UPDATE);</span>

<span class="nc" id="L177">	private UpdateCheckFrequencyComboBoxEntry checkAtStartup =</span>
		new UpdateCheckFrequencyComboBoxEntry(UpdateCheckFrequency.STARTUP, i18n.AT_STARTUP_LABEL);

<span class="nc" id="L180">	private UpdateCheckFrequencyComboBoxEntry checkDaily =</span>
		new UpdateCheckFrequencyComboBoxEntry(UpdateCheckFrequency.DAILY, i18n.DAILY_LABEL);

<span class="nc" id="L183">	private UpdateCheckFrequencyComboBoxEntry checkWeekly =</span>
		new UpdateCheckFrequencyComboBoxEntry(UpdateCheckFrequency.WEEKLY, i18n.WEEKLY_LABEL);

<span class="nc" id="L186">	private JComboBox _updateCheckFrequency =</span>
		new JComboBox(new Object[] { checkAtStartup, checkDaily, checkWeekly });

<span class="nc" id="L189">	private JButton _testConnectionButton = new JButton(i18n.TEST_LABEL);</span>

<span class="nc" id="L191">	private JLabel _testConnectionStatusLabel = new JLabel();</span>

<span class="nc" id="L193">	private final Insets SEP_INSETS = new Insets(10, 14, 0, 14);</span>

<span class="nc" id="L195">	private final Insets LABEL_INSETS = new Insets(2, 28, 6, 0);</span>

<span class="nc" id="L197">	private final Insets FIELD_INSETS = new Insets(2, 8, 6, 28);</span>

	private IApplication _app;

	public UpdatePreferencesPanel()
	{
<span class="nc" id="L203">		super(new GridBagLayout());</span>
<span class="nc" id="L204">		createUserInterface();</span>
<span class="nc" id="L205">	}</span>

	void loadData(SquirrelPreferences prefs)
	{
<span class="nc" id="L209">		final IUpdateSettings updateSettings = prefs.getUpdateSettings();</span>

<span class="nc" id="L211">		_updateServerName.setText(updateSettings.getUpdateServer());</span>
<span class="nc" id="L212">		_updateServerPort.setText(updateSettings.getUpdateServerPort());</span>
<span class="nc" id="L213">		_updateServerPath.setText(updateSettings.getUpdateServerPath());</span>

<span class="nc" id="L215">		String channelStr = updateSettings.getUpdateServerChannel();</span>
<span class="nc" id="L216">		_updateServerChannel.setSelectedItem(stableChannel);</span>
<span class="nc bnc" id="L217" title="All 4 branches missed.">		if (channelStr != null &amp;&amp; channelStr.equals(ChannelType.SNAPSHOT.name()))</span>
		{
<span class="nc" id="L219">			_updateServerChannel.setSelectedItem(snapshotChannel);</span>
		}

<span class="nc" id="L222">		_enableAutoUpdateChk.setSelected(updateSettings.isEnableAutomaticUpdates());</span>

<span class="nc" id="L224">		UpdateCheckFrequency updateCheckFrequency =</span>
<span class="nc" id="L225">			UpdateCheckFrequency.getEnumForString(updateSettings.getUpdateCheckFrequency());</span>

<span class="nc bnc" id="L227" title="All 2 branches missed.">		if (updateCheckFrequency == UpdateCheckFrequency.DAILY)</span>
		{
<span class="nc" id="L229">			_updateCheckFrequency.setSelectedItem(checkDaily);</span>
		}
<span class="nc bnc" id="L231" title="All 2 branches missed.">		if (updateCheckFrequency == UpdateCheckFrequency.STARTUP)</span>
		{
<span class="nc" id="L233">			_updateCheckFrequency.setSelectedItem(checkAtStartup);</span>
		}
<span class="nc bnc" id="L235" title="All 2 branches missed.">		if (updateCheckFrequency == UpdateCheckFrequency.WEEKLY)</span>
		{
<span class="nc" id="L237">			_updateCheckFrequency.setSelectedItem(checkWeekly);</span>
		}

<span class="nc bnc" id="L240" title="All 2 branches missed.">		if (updateSettings.isRemoteUpdateSite())</span>
		{
<span class="nc" id="L242">			_remoteTypeButton.setSelected(true);</span>
<span class="nc" id="L243">			enableRemoteSite();</span>
		}
		else
		{
<span class="nc" id="L247">			_localTypeButton.setSelected(true);</span>
<span class="nc" id="L248">			enableLocalPath();</span>
		}
<span class="nc" id="L250">		_localPath.setText(updateSettings.getFileSystemUpdatePath());</span>
<span class="nc" id="L251">		updateControlStatus();</span>
<span class="nc" id="L252">		updateUrl();</span>
<span class="nc" id="L253">	}</span>

	void applyChanges(SquirrelPreferences prefs)
	{

<span class="nc" id="L258">		final IUpdateSettings updateSettings = new UpdateSettings();</span>

<span class="nc" id="L260">		updateSettings.setUpdateServer(_updateServerName.getText());</span>
<span class="nc" id="L261">		updateSettings.setUpdateServerPort(_updateServerPort.getText());</span>
<span class="nc" id="L262">		updateSettings.setUpdateServerPath(_updateServerPath.getText());</span>

<span class="nc" id="L264">		UpdateChannelComboBoxEntry channelEntry =</span>
<span class="nc" id="L265">			(UpdateChannelComboBoxEntry) _updateServerChannel.getSelectedItem();</span>

<span class="nc" id="L267">		String channelStr = ChannelType.STABLE.name();</span>
<span class="nc bnc" id="L268" title="All 2 branches missed.">		if (channelEntry.isSnapshot())</span>
		{
<span class="nc" id="L270">			channelStr = ChannelType.SNAPSHOT.name();</span>
		}
<span class="nc" id="L272">		updateSettings.setUpdateServerChannel(channelStr);</span>

<span class="nc" id="L274">		updateSettings.setEnableAutomaticUpdates(_enableAutoUpdateChk.isSelected());</span>

<span class="nc" id="L276">		UpdateCheckFrequencyComboBoxEntry freqEntry =</span>
<span class="nc" id="L277">			(UpdateCheckFrequencyComboBoxEntry) _updateCheckFrequency.getSelectedItem();</span>

<span class="nc" id="L279">		updateSettings.setUpdateCheckFrequency(freqEntry.getUpdateCheckFrequencyEnum().name());</span>
<span class="nc" id="L280">		updateSettings.setRemoteUpdateSite(_remoteTypeButton.isSelected());</span>
<span class="nc" id="L281">		updateSettings.setFileSystemUpdatePath(_localPath.getText());</span>

<span class="nc" id="L283">		prefs.setUpdateSettings(updateSettings);</span>

<span class="nc" id="L285">	}</span>

	private void updateControlStatus()
	{
<span class="nc" id="L289">		final boolean enableAutoCheck = _enableAutoUpdateChk.isSelected();</span>
<span class="nc" id="L290">		_updateCheckFrequency.setEnabled(enableAutoCheck);</span>
<span class="nc" id="L291">	}</span>

	private void createUserInterface()
	{
<span class="nc" id="L295">		final GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L296">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L297">		gbc.insets = new Insets(4, 4, 4, 4);</span>
<span class="nc" id="L298">		gbc.gridx = 0;</span>
<span class="nc" id="L299">		gbc.gridy = 0;</span>
<span class="nc" id="L300">		gbc.weightx = 1;</span>
<span class="nc" id="L301">		add(createUpdateSitePanel(), gbc);</span>
<span class="nc" id="L302">		++gbc.gridy;</span>
<span class="nc" id="L303">		add(createAutoUpdatePanel(), gbc);</span>

<span class="nc" id="L305">		final ActionListener lis = new MyActionHandler();</span>
<span class="nc" id="L306">		_enableAutoUpdateChk.addActionListener(lis);</span>
<span class="nc" id="L307">	}</span>

	private JPanel createUpdateSitePanel()
	{
<span class="nc" id="L311">		JPanel pnl = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L312">		pnl.setBorder(BorderFactory.createTitledBorder(i18n.UPDATE_SITE_BORDER_LABEL));</span>

<span class="nc" id="L314">		ItemListener urlUpdateItemListener = new UrlItemListener();</span>
<span class="nc" id="L315">		DocumentListener urlDocumentListener = new UrlDocumentListener();</span>
<span class="nc" id="L316">		final GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L318">		setSeparatorConstraints(gbc, 0);</span>
<span class="nc" id="L319">		gbc.gridwidth = 1;</span>
<span class="nc" id="L320">		gbc.weightx = 0;</span>
<span class="nc" id="L321">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L322">		gbc.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L323">		siteTypeLabel = new JLabel(i18n.SITE_TYPE_LABEL, JLabel.RIGHT);</span>
<span class="nc" id="L324">		pnl.add(siteTypeLabel, gbc);</span>

		// Site type

<span class="nc" id="L328">		setSeparatorConstraints(gbc, 0);</span>
<span class="nc" id="L329">		gbc.gridx = 1;</span>
<span class="nc" id="L330">		gbc.gridwidth = 1;</span>
<span class="nc" id="L331">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L332">		pnl.add(getSiteTypePanel(), gbc);</span>

<span class="nc" id="L334">		setSeparatorConstraints(gbc, 1);</span>
<span class="nc" id="L335">		pnl.add(getSep(), gbc);</span>

		// Update server name

<span class="nc" id="L339">		setLabelConstraints(gbc, 2);</span>
<span class="nc" id="L340">		_serverLabel = new JLabel(i18n.SERVER, SwingConstants.RIGHT);</span>
<span class="nc" id="L341">		pnl.add(_serverLabel, gbc);</span>

<span class="nc" id="L343">		setFieldConstraints(gbc, 2);</span>
<span class="nc" id="L344">		_updateServerName.getDocument().addDocumentListener(urlDocumentListener);</span>
<span class="nc" id="L345">		pnl.add(_updateServerName, gbc);</span>

		// Update server port

<span class="nc" id="L349">		setLabelConstraints(gbc, 3);</span>
<span class="nc" id="L350">		_portLabel = new JLabel(i18n.PORT, SwingConstants.RIGHT);</span>
<span class="nc" id="L351">		pnl.add(_portLabel, gbc);</span>

<span class="nc" id="L353">		setFieldConstraints(gbc, 3);</span>
<span class="nc" id="L354">		_updateServerPort.getDocument().addDocumentListener(urlDocumentListener);</span>
<span class="nc" id="L355">		pnl.add(_updateServerPort, gbc);</span>

		// Path to release.xml

<span class="nc" id="L359">		setLabelConstraints(gbc, 4);</span>
<span class="nc" id="L360">		_pathLabel = new JLabel(i18n.PATH, SwingConstants.RIGHT);</span>
<span class="nc" id="L361">		pnl.add(_pathLabel, gbc);</span>

<span class="nc" id="L363">		setFieldConstraints(gbc, 4);</span>
<span class="nc" id="L364">		_updateServerPath.getDocument().addDocumentListener(urlDocumentListener);</span>
<span class="nc" id="L365">		pnl.add(_updateServerPath, gbc);</span>

		// Channnel combo-box

<span class="nc" id="L369">		setLabelConstraints(gbc, 5);</span>
<span class="nc" id="L370">		_channelLabel = new JLabel(i18n.CHANNEL, SwingConstants.RIGHT);</span>
<span class="nc" id="L371">		pnl.add(_channelLabel, gbc);</span>

<span class="nc" id="L373">		setFieldConstraints(gbc, 5);</span>
<span class="nc" id="L374">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L375">		_updateServerChannel.addItemListener(urlUpdateItemListener);</span>
<span class="nc" id="L376">		pnl.add(_updateServerChannel, gbc);</span>

		// URL text field

<span class="nc" id="L380">		setLabelConstraints(gbc, 6);</span>
<span class="nc" id="L381">		_urlLabel = new JLabel(i18n.URL, SwingConstants.RIGHT);</span>
<span class="nc" id="L382">		pnl.add(_urlLabel, gbc);</span>

<span class="nc" id="L384">		setFieldConstraints(gbc, 6);</span>
<span class="nc" id="L385">		updateUrl();</span>
<span class="nc" id="L386">		pnl.add(_updateUrl, gbc);</span>

		// Test Connection Button Panel (Both the button and the status label

<span class="nc" id="L390">		setFieldConstraints(gbc, 7);</span>

<span class="nc" id="L392">		Box buttonBox = Box.createHorizontalBox();</span>
<span class="nc" id="L393">		buttonBox.add(_testConnectionButton);</span>
<span class="nc" id="L394">		buttonBox.add(Box.createHorizontalStrut(20));</span>
<span class="nc" id="L395">		buttonBox.add(_testConnectionStatusLabel);</span>
<span class="nc" id="L396">		_testConnectionButton.addActionListener(new TestConnectionButtonListener());</span>
<span class="nc" id="L397">		pnl.add(buttonBox, gbc);</span>

		// Separator

<span class="nc" id="L401">		setSeparatorConstraints(gbc, 8);</span>
<span class="nc" id="L402">		pnl.add(getSep(), gbc);</span>

		// Local update directory

<span class="nc" id="L406">		setLabelConstraints(gbc, 9);</span>
<span class="nc" id="L407">		_localPathLabel = new JLabel(i18n.LOCAL_PATH, SwingConstants.RIGHT);</span>
<span class="nc" id="L408">		pnl.add(_localPathLabel, gbc);</span>

<span class="nc" id="L410">		setFieldConstraints(gbc, 9);</span>
<span class="nc" id="L411">		pnl.add(_localPath, gbc);</span>
<span class="nc" id="L412">		return pnl;</span>
	}

	/**
	 * Sets the specified GridBagConstraints with the specified grid y coordinate and:&lt;br&gt;
	 * &lt;br&gt;
	 * grid x = 0 &lt;br&gt;
	 * grid width = 1 &lt;br&gt;
	 * weight x = 1 &lt;br&gt;
	 * insets = LABEL_INSETS &lt;br&gt;
	 * fill = GridBagConstraints.NONE &lt;br&gt;
	 * anchor = GridBagConstraints.EAST
	 * 
	 * @param gbc
	 *           the constraints to set
	 * @param gridy
	 *           the grid y coordinate
	 */
	private void setLabelConstraints(GridBagConstraints gbc, int gridy)
	{
<span class="nc" id="L432">		gbc.gridx = 0;</span>
<span class="nc" id="L433">		gbc.gridy = gridy;</span>
<span class="nc" id="L434">		gbc.gridwidth = 1;</span>
<span class="nc" id="L435">		gbc.weightx = 0;</span>
<span class="nc" id="L436">		gbc.insets = LABEL_INSETS;</span>
<span class="nc" id="L437">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L438">		gbc.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L439">	}</span>

	/**
	 * Sets the specified GridBagConstraints with the specified grid y coordinate and:&lt;br&gt;
	 * &lt;br&gt;
	 * grid x = 1 &lt;br&gt;
	 * grid width = 1 &lt;br&gt;
	 * weight x = 1 &lt;br&gt;
	 * insets = FIELD_INSETS &lt;br&gt;
	 * fill = GridBagConstraints.HORIZONTAL &lt;br&gt;
	 * anchor = GridBagConstraints.WEST
	 * 
	 * @param gbc
	 *           the constraints to set
	 * @param gridy
	 *           the grid y coordinate
	 */
	private void setFieldConstraints(GridBagConstraints gbc, int gridy)
	{
<span class="nc" id="L458">		gbc.gridx = 1;</span>
<span class="nc" id="L459">		gbc.gridy = gridy;</span>
<span class="nc" id="L460">		gbc.gridwidth = 1;</span>
<span class="nc" id="L461">		gbc.weightx = 1;</span>
<span class="nc" id="L462">		gbc.insets = FIELD_INSETS;</span>
<span class="nc" id="L463">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L464">		gbc.anchor = GridBagConstraints.WEST;</span>

<span class="nc" id="L466">	}</span>

	/**
	 * Sets the specified GridBagConstraints with the specified grid y coordinate and:&lt;br&gt;
	 * &lt;br&gt;
	 * grid x = 0 &lt;br&gt;
	 * grid width = 2 &lt;br&gt;
	 * weight x = 1 &lt;br&gt;
	 * insets = SEP_INSETS &lt;br&gt;
	 * fill = GridBagConstraints.HORIZONTAL &lt;br&gt;
	 * anchor = GridBagConstraints.WEST
	 * 
	 * @param gbc
	 *           the constraints to set
	 * @param gridy
	 *           the grid y coordinate
	 */
	private void setSeparatorConstraints(GridBagConstraints gbc, int gridy)
	{
<span class="nc" id="L485">		gbc.gridx = 0;</span>
<span class="nc" id="L486">		gbc.gridy = gridy;</span>
<span class="nc" id="L487">		gbc.gridwidth = 2;</span>
<span class="nc" id="L488">		gbc.weightx = 1;</span>
<span class="nc" id="L489">		gbc.insets = SEP_INSETS;</span>
<span class="nc" id="L490">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L491">		gbc.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L492">	}</span>

	private void enableRemoteSite()
	{
<span class="nc" id="L496">		_localPath.setEnabled(false);</span>
<span class="nc" id="L497">		_localPathLabel.setEnabled(false);</span>
<span class="nc" id="L498">		_updateServerChannel.setEnabled(true);</span>
<span class="nc" id="L499">		_updateServerName.setEnabled(true);</span>
<span class="nc" id="L500">		_updateServerPath.setEnabled(true);</span>
<span class="nc" id="L501">		_updateServerPort.setEnabled(true);</span>
<span class="nc" id="L502">		_serverLabel.setEnabled(true);</span>
<span class="nc" id="L503">		_portLabel.setEnabled(true);</span>
<span class="nc" id="L504">		_pathLabel.setEnabled(true);</span>
<span class="nc" id="L505">		_channelLabel.setEnabled(true);</span>
<span class="nc" id="L506">		_testConnectionButton.setEnabled(true);</span>
<span class="nc" id="L507">		_testConnectionStatusLabel.setEnabled(true);</span>
<span class="nc" id="L508">		_updateUrl.setEnabled(true);</span>
<span class="nc" id="L509">		_urlLabel.setEnabled(true);</span>
<span class="nc" id="L510">	}</span>

	private void enableLocalPath()
	{
<span class="nc" id="L514">		_localPath.setEnabled(true);</span>
<span class="nc" id="L515">		_localPathLabel.setEnabled(true);</span>
<span class="nc" id="L516">		_updateServerChannel.setEnabled(false);</span>
<span class="nc" id="L517">		_updateServerName.setEnabled(false);</span>
<span class="nc" id="L518">		_updateServerPath.setEnabled(false);</span>
<span class="nc" id="L519">		_updateServerPort.setEnabled(false);</span>
<span class="nc" id="L520">		_serverLabel.setEnabled(false);</span>
<span class="nc" id="L521">		_portLabel.setEnabled(false);</span>
<span class="nc" id="L522">		_pathLabel.setEnabled(false);</span>
<span class="nc" id="L523">		_channelLabel.setEnabled(false);</span>
<span class="nc" id="L524">		_testConnectionButton.setEnabled(false);</span>
<span class="nc" id="L525">		_testConnectionStatusLabel.setEnabled(false);</span>
<span class="nc" id="L526">		_updateUrl.setEnabled(false);</span>
<span class="nc" id="L527">		_urlLabel.setEnabled(false);</span>

<span class="nc" id="L529">	}</span>

	private void updateUrl()
	{

<span class="nc" id="L534">		String portStr = _updateServerPort.getText();</span>
<span class="nc" id="L535">		StringBuilder tmp = new StringBuilder(&quot;http://&quot;);</span>
<span class="nc" id="L536">		tmp.append(_updateServerName.getText());</span>
<span class="nc bnc" id="L537" title="All 2 branches missed.">		if (!StringUtils.isEmpty(portStr))</span>
		{
<span class="nc" id="L539">			tmp.append(&quot;:&quot;);</span>
<span class="nc" id="L540">			tmp.append(_updateServerPort.getText());</span>
		}
<span class="nc" id="L542">		tmp.append(&quot;/&quot;);</span>
<span class="nc" id="L543">		tmp.append(_updateServerPath.getText());</span>
<span class="nc" id="L544">		tmp.append(&quot;/&quot;);</span>
<span class="nc" id="L545">		tmp.append(_updateServerChannel.getSelectedItem().toString());</span>
<span class="nc" id="L546">		tmp.append(&quot;/release.xml&quot;);</span>
<span class="nc" id="L547">		_updateUrl.setText(tmp.toString());</span>
<span class="nc" id="L548">		_updateUrl.setEditable(false);</span>
<span class="nc" id="L549">		_updateUrl.revalidate();</span>
<span class="nc" id="L550">	}</span>

	private JPanel getSiteTypePanel()
	{
<span class="nc" id="L554">		_remoteTypeButton.addActionListener(new ActionListener()</span>
<span class="nc" id="L555">		{</span>
			public void actionPerformed(ActionEvent e)
			{
<span class="nc" id="L558">				enableRemoteSite();</span>
<span class="nc" id="L559">			}</span>
		});
<span class="nc" id="L561">		_localTypeButton.addActionListener(new ActionListener()</span>
<span class="nc" id="L562">		{</span>
			public void actionPerformed(ActionEvent e)
			{
<span class="nc" id="L565">				enableLocalPath();</span>
<span class="nc" id="L566">			}</span>
		});
<span class="nc" id="L568">		_updateSiteTypeGroup.add(_remoteTypeButton);</span>
<span class="nc" id="L569">		_updateSiteTypeGroup.add(_localTypeButton);</span>
<span class="nc" id="L570">		JPanel siteTypePanel = new JPanel();</span>
<span class="nc" id="L571">		siteTypePanel.add(_remoteTypeButton);</span>
<span class="nc" id="L572">		siteTypePanel.add(_localTypeButton);</span>
<span class="nc" id="L573">		return siteTypePanel;</span>
	}

	private JSeparator getSep()
	{
<span class="nc" id="L578">		JSeparator sep = new JSeparator(SwingConstants.HORIZONTAL);</span>
		// separators need preferred size in GridBagLayout
<span class="nc" id="L580">		sep.setPreferredSize(new Dimension(100, 20));</span>
<span class="nc" id="L581">		sep.setMinimumSize(new Dimension(100, 20));</span>
<span class="nc" id="L582">		return sep;</span>
	}

	private JPanel createAutoUpdatePanel()
	{
<span class="nc" id="L587">		JPanel pnl = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L588">		pnl.setBorder(BorderFactory.createTitledBorder(i18n.AUTO_BORDER_LABEL));</span>

<span class="nc" id="L590">		final GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L591">		gbc.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L592">		gbc.insets = new Insets(4, 4, 4, 4);</span>
<span class="nc" id="L593">		gbc.gridx = 0;</span>
<span class="nc" id="L594">		gbc.gridy = 0;</span>
<span class="nc" id="L595">		gbc.gridwidth = 2;</span>
<span class="nc" id="L596">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L597">		pnl.add(_enableAutoUpdateChk, gbc);</span>

<span class="nc" id="L599">		gbc.gridwidth = 1;</span>

<span class="nc" id="L601">		gbc.gridx = 0;</span>
<span class="nc" id="L602">		gbc.gridy = 1;</span>
<span class="nc" id="L603">		gbc.weightx = 0;</span>
<span class="nc" id="L604">		gbc.insets = new Insets(4, 20, 4, 10);</span>
<span class="nc" id="L605">		pnl.add(new JLabel(i18n.AUTO_CHECK_FREQUENCY, JLabel.LEFT), gbc);</span>

<span class="nc" id="L607">		gbc.gridx = 1;</span>
<span class="nc" id="L608">		gbc.gridy = 1;</span>
<span class="nc" id="L609">		gbc.weightx = 1;</span>
<span class="nc" id="L610">		gbc.insets = new Insets(4, 0, 4, 0);</span>
<span class="nc" id="L611">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L612">		pnl.add(this._updateCheckFrequency, gbc);</span>

<span class="nc" id="L614">		return pnl;</span>
	}

<span class="nc" id="L617">	private final class MyActionHandler implements ActionListener</span>
	{
		public void actionPerformed(ActionEvent evt)
		{
<span class="nc" id="L621">			updateControlStatus();</span>
<span class="nc" id="L622">		}</span>
	}

	/**
	 * Sets the IApplication that is used to display error messages.
	 * 
	 * @param app
	 *           the IApplication implementation
	 */
	public void setApplication(IApplication app)
	{
<span class="nc" id="L633">		_app = app;</span>
<span class="nc" id="L634">	}</span>

<span class="nc" id="L636">	private class TestConnectionButtonListener implements ActionListener</span>
	{
		public void actionPerformed(ActionEvent e)
		{
<span class="nc" id="L640">			String serverName = _updateServerName.getText();</span>

<span class="nc" id="L642">			StringBuilder path = new StringBuilder(_updateServerPath.getText());</span>
<span class="nc" id="L643">			path.append(&quot;/&quot;);</span>
<span class="nc" id="L644">			path.append(_updateServerChannel.getSelectedItem().toString());</span>

<span class="nc" id="L646">			String portString = _updateServerPort.getText();</span>

			try
			{
<span class="nc" id="L650">				int port = 80;</span>
<span class="nc bnc" id="L651" title="All 2 branches missed.">				if (!StringUtils.isEmpty(portString))</span>
				{
<span class="nc" id="L653">					port = Integer.parseInt(_updateServerPort.getText());</span>
				}
<span class="nc" id="L655">				_updateUtil.downloadCurrentRelease(serverName, port, path.toString(),</span>
<span class="nc" id="L656">					UpdateUtil.RELEASE_XML_FILENAME, _app.getSquirrelPreferences().getProxySettings());</span>
<span class="nc" id="L657">				_testConnectionStatusLabel.setText(i18n.STATUS_LABEL_SUCCESS_MSG);</span>
<span class="nc" id="L658">				_testConnectionStatusLabel.setForeground(CONNECTION_SUCCESS_COLOR);</span>
			}
<span class="nc" id="L660">			catch (Exception e1)</span>
			{
<span class="nc" id="L662">				_testConnectionStatusLabel.setText(i18n.STATUS_LABEL_FAILURE_MSG);</span>
<span class="nc" id="L663">				_testConnectionStatusLabel.setForeground(CONNECTION_FAILURE_COLOR);</span>
<span class="nc" id="L664">				_app.showErrorDialog(i18n.CONNECTION_FAILURE_DIALOG_MSG, e1);</span>

<span class="nc" id="L666">			}</span>

<span class="nc" id="L668">		}</span>
	}

	/**
	 * A listener that will update the url whenever the associated document is modified
	 * 
	 * @author manningr
	 */
<span class="nc" id="L676">	private class UrlDocumentListener implements DocumentListener</span>
	{
		public void changedUpdate(DocumentEvent e)
		{
<span class="nc" id="L680">			updateUrl();</span>
<span class="nc" id="L681">		}</span>

		public void insertUpdate(DocumentEvent e)
		{
<span class="nc" id="L685">			updateUrl();</span>

<span class="nc" id="L687">		}</span>

		public void removeUpdate(DocumentEvent e)
		{
<span class="nc" id="L691">			updateUrl();</span>

<span class="nc" id="L693">		}</span>
	}

<span class="nc" id="L696">	private class UrlItemListener implements ItemListener</span>
	{
		public void itemStateChanged(ItemEvent e)
		{
<span class="nc" id="L700">			updateUrl();</span>
<span class="nc" id="L701">		}</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>