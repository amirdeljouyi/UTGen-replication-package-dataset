<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WikiTablePreferencesPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.preferences</a> &gt; <span class="el_source">WikiTablePreferencesPanel.java</span></div><h1>WikiTablePreferencesPanel.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2011 Stefan Willinger
 * wis775@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
package net.sourceforge.squirrel_sql.client.preferences;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.util.ArrayList;
import java.util.List;

import javax.swing.BorderFactory;
import javax.swing.DefaultListModel;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JLabel;
import javax.swing.JList;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.ListSelectionModel;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.fw.gui.action.wikiTable.GenericWikiTableConfigurationBean;
import net.sourceforge.squirrel_sql.fw.gui.action.wikiTable.IWikiTableConfiguration;
import net.sourceforge.squirrel_sql.fw.gui.action.wikiTable.IWikiTableConfigurationFactory;
import net.sourceforge.squirrel_sql.fw.gui.action.wikiTable.WikiTableConfigurationFactory;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import org.apache.commons.lang.StringUtils;

/**
 * Preferences panel for WIKI table configurations
 * @author Stefan Willinger
 *
 */
public class WikiTablePreferencesPanel extends JPanel {
	
	/** Internationalized strings for this class. */
<span class="nc" id="L70">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L71">		StringManagerFactory.getStringManager(WikiTablePreferencesPanel.class);</span>

<span class="nc" id="L73">	private final Insets LABEL_INSETS = new Insets(2, 28, 6, 0);</span>

<span class="nc" id="L75">	private final Insets FIELD_INSETS = new Insets(2, 8, 6, 28);</span>

	
<span class="nc" id="L78">	private IWikiTableConfigurationFactory wikiTableConfigFactory = WikiTableConfigurationFactory.getInstance();</span>
	
	
	private IApplication application;
	
	
	// Components of the detail panel
	
<span class="nc" id="L86">	private JLabel nameLable = null;</span>
	
<span class="nc" id="L88">	private JTextField name = null;</span>
	
<span class="nc" id="L90">	private JLabel tableStartTagLabel = null;</span>
	
<span class="nc" id="L92">	private JTextField tableStartTag = null;</span>
	
<span class="nc" id="L94">	private JLabel headerStartTagLabel = null;</span>
	
<span class="nc" id="L96">	private JTextField headerStartTag = null;</span>
	
<span class="nc" id="L98">	private JLabel headerCellTagLabel = null;</span>
	
<span class="nc" id="L100">	private JTextField headerCellTag = null;</span>
	
<span class="nc" id="L102">	private JLabel headerEndTagLabel = null;</span>
	
<span class="nc" id="L104">	private JTextField headerEndTag = null;</span>
	
<span class="nc" id="L106">	private JLabel rowStartTagLabel = null;</span>
	
<span class="nc" id="L108">	private JTextField rowStartTag = null;</span>
	
<span class="nc" id="L110">	private JLabel cellTagLabel = null;</span>
	
<span class="nc" id="L112">	private JTextField cellTag = null;</span>
	
<span class="nc" id="L114">	private JLabel rowEndTagLabel = null;</span>
	
<span class="nc" id="L116">	private JTextField rowEndTag = null;</span>
	
<span class="nc" id="L118">	private JLabel tableEndTagLabel = null;</span>
	
<span class="nc" id="L120">	private JTextField tableEndTag = null;</span>
	
<span class="nc" id="L122">	private JLabel noWikiTagLabel = null;</span>
	
<span class="nc" id="L124">	private JTextField noWikiTag = null;</span>
	
<span class="nc" id="L126">	private DefaultListModel wikiConfigListModel = null;</span>

	private JList wikiConfigList;

	private JButton newButton;

	private JButton copyButton;

	private JButton deleteButton;

	private JTable exampleTable;

	private JTextArea exampleText;

	private IWikiTableConfiguration currentConfigurationInView;

	private JCheckBox enabled;

	
	
	public WikiTablePreferencesPanel()
	{
<span class="nc" id="L148">		super(new GridBagLayout());</span>
<span class="nc" id="L149">		createUserInterface();</span>
<span class="nc" id="L150">	}</span>
	
	
	/**
	 * Creates the user Interface
	 */
	private void createUserInterface()
	{
<span class="nc" id="L158">		JPanel jp = new JPanel(new GridBagLayout());</span>
		
<span class="nc" id="L160">		GridBagConstraints gbc = new GridBagConstraints();</span>
<span class="nc" id="L161">		gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L162">		gbc.insets = new Insets(4, 4, 4, 4);</span>
<span class="nc" id="L163">		gbc.gridx = 0;</span>
<span class="nc" id="L164">		gbc.gridy = 0;</span>
<span class="nc" id="L165">		gbc.weightx = 0;</span>
<span class="nc" id="L166">		gbc.weighty = 1;</span>
<span class="nc" id="L167">		jp.add(createOverviewPanel(), gbc);</span>
		
<span class="nc" id="L169">		gbc.gridy = 1;</span>
<span class="nc" id="L170">		gbc.weighty = 0;</span>
<span class="nc" id="L171">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L172">		jp.add(createNotePanel(), gbc);</span>
		
<span class="nc" id="L174">		gbc.weightx = 1;</span>
<span class="nc" id="L175">		gbc.weighty = 1;</span>
<span class="nc" id="L176">		gbc.gridheight=2;</span>
<span class="nc" id="L177">		gbc.gridy = 0;</span>
<span class="nc" id="L178">		gbc.gridx =1;</span>
<span class="nc" id="L179">		gbc.fill = GridBagConstraints.BOTH;</span>
		
<span class="nc" id="L181">		jp.add(createDetailPanel(), gbc);</span>

		
<span class="nc" id="L184">		gbc.weightx = 1;</span>
<span class="nc" id="L185">		gbc.weighty = 1;</span>
<span class="nc" id="L186">		gbc.gridheight=2;</span>
<span class="nc" id="L187">		gbc.gridy = 0;</span>
<span class="nc" id="L188">		gbc.gridx =2;</span>
<span class="nc" id="L189">		gbc.fill = GridBagConstraints.BOTH;</span>

<span class="nc" id="L191">		jp.add(createExamplePanel(), gbc);</span>

<span class="nc" id="L193">		JScrollPane sp = new JScrollPane(jp);</span>
<span class="nc" id="L194">		gbc = new GridBagConstraints();</span>
<span class="nc" id="L195">		gbc.fill=GridBagConstraints.BOTH;</span>
<span class="nc" id="L196">		gbc.weightx=1;</span>
<span class="nc" id="L197">		gbc.weighty=1;</span>
<span class="nc" id="L198">		add(sp,gbc);</span>

<span class="nc" id="L200">	}</span>
	
	/**
	 * Create the component, which shows a example.
	 * The example contains a {@link JTable} and a {@link JTextField}. If the user change a element of the configuration, then the example will be updated.
	 * So we can provide a feedback of the result immediately.
	 */
	private Component createExamplePanel() {
<span class="nc" id="L208">		JPanel jp = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L209">		jp.setBorder(BorderFactory.createTitledBorder(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.titleExample&quot;))); //$NON-NLS-1$</span>

<span class="nc" id="L211">		GridBagConstraints gbc = new GridBagConstraints();</span>
		
		
<span class="nc" id="L214">		String[][] rowData = new String[][]{</span>
<span class="nc" id="L215">				{s_stringMgr.getString(&quot;WikiTablePreferencesPanel.austria&quot;), s_stringMgr.getString(&quot;WikiTablePreferencesPanel.vienna&quot;)}, //$NON-NLS-1$ //$NON-NLS-2$</span>
<span class="nc" id="L216">				{s_stringMgr.getString(&quot;WikiTablePreferencesPanel.italy&quot;), s_stringMgr.getString(&quot;WikiTablePreferencesPanel.rome&quot;)} //$NON-NLS-1$ //$NON-NLS-2$</span>
		};
		
<span class="nc" id="L219">		String[] columnNames = new String[]{s_stringMgr.getString(&quot;WikiTablePreferencesPanel.country&quot;), s_stringMgr.getString(&quot;WikiTablePreferencesPanel.captial&quot;)}; //$NON-NLS-1$ //$NON-NLS-2$</span>
		
<span class="nc" id="L221">		exampleTable = new JTable(rowData, columnNames);</span>
<span class="nc" id="L222">		exampleTable.setMinimumSize(new Dimension(10,10));</span>

<span class="nc" id="L224">		JScrollPane sp = new JScrollPane(exampleTable);</span>
<span class="nc" id="L225">		sp.setPreferredSize(new Dimension(100,50));</span>
		
<span class="nc" id="L227">		gbc.fill=GridBagConstraints.BOTH;</span>
<span class="nc" id="L228">		gbc.weighty=1;</span>
<span class="nc" id="L229">		gbc.weighty=0.1;</span>
<span class="nc" id="L230">		jp.add(sp, gbc);</span>
		
	
<span class="nc" id="L233">		gbc.gridx=0;</span>
<span class="nc" id="L234">		gbc.gridy=1;</span>
<span class="nc" id="L235">		gbc.fill=GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L236">		gbc.weighty=0;</span>
<span class="nc" id="L237">		gbc.weightx=0;</span>
<span class="nc" id="L238">		jp.add(new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.titleResultExample&quot;)), gbc); //$NON-NLS-1$</span>
		
		
<span class="nc" id="L241">		exampleText = new JTextArea(15,20);</span>
<span class="nc" id="L242">		exampleText.setWrapStyleWord(true);</span>
<span class="nc" id="L243">		exampleText.setEditable(false);</span>
<span class="nc" id="L244">		exampleText.setLineWrap(false);</span>
		
		
<span class="nc" id="L247">		gbc.gridy=2;</span>
<span class="nc" id="L248">		gbc.fill=GridBagConstraints.BOTH;</span>
<span class="nc" id="L249">		gbc.weighty=1;</span>
<span class="nc" id="L250">		gbc.weightx=1;</span>
		
<span class="nc" id="L252">		sp = new JScrollPane(exampleText);</span>
<span class="nc" id="L253">		jp.add(sp, gbc);</span>
		
<span class="nc" id="L255">		return jp;</span>
	}


	/**
	 * Create the panel with a small help text for the user.
	 * This panel indicates, which variables are allowed.
	 */
	private Component createNotePanel() {
<span class="nc" id="L264">		JPanel jp = new JPanel();</span>
<span class="nc" id="L265">		jp.setBorder(BorderFactory.createTitledBorder(&quot;Note&quot;)); //$NON-NLS-1$</span>
		
		
<span class="nc" id="L268">		String text = &quot;&lt;html&gt;&lt;body&gt;&quot;+ //$NON-NLS-1$</span>
<span class="nc" id="L269">		s_stringMgr.getString(&quot;WikiTablePreferencesPanel.hintValueVariable&quot;) + //$NON-NLS-1$</span>
		&quot;&lt;br /&gt;&quot; + //$NON-NLS-1$
<span class="nc" id="L271">		s_stringMgr.getString(&quot;WikiTablePreferencesPanel.hintNewLine&quot;) + //$NON-NLS-1$</span>
		&quot;&lt;/body&gt;&lt;/html&gt;&quot;; //$NON-NLS-1$
<span class="nc" id="L273">		JLabel label = new JLabel(text);</span>
		
<span class="nc" id="L275">		jp.add(label);</span>
		
<span class="nc" id="L277">		return jp;</span>
	}
	
	
	/**
	 * The overview panel contains a list of all available configurations.
	 * There are some methods provided for creating, copying or deleting configurations.
	 * @return
	 */
	private Component createOverviewPanel() {
<span class="nc" id="L287">		JPanel jp = new JPanel(new BorderLayout());</span>
<span class="nc" id="L288">		jp.setBorder(BorderFactory.createTitledBorder(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.titleOverview&quot;))); //$NON-NLS-1$</span>
		
<span class="nc" id="L290">		wikiConfigListModel = new DefaultListModel();</span>
		
<span class="nc" id="L292">		wikiConfigList = new JList(wikiConfigListModel);</span>
<span class="nc" id="L293">		wikiConfigList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</span>
<span class="nc" id="L294">		wikiConfigList.addListSelectionListener(new ListSelectionListener() {</span>
			@Override
			public void valueChanged(ListSelectionEvent e) {
<span class="nc" id="L297">				SwingUtilities.invokeLater(new Runnable() {</span>
					
					@Override
					public void run() {
<span class="nc" id="L301">						IWikiTableConfiguration selectedValue = (IWikiTableConfiguration) wikiConfigList.getSelectedValue();</span>
<span class="nc" id="L302">						showDataFor(selectedValue);</span>
<span class="nc bnc" id="L303" title="All 2 branches missed.">						if(selectedValue != null){</span>
<span class="nc" id="L304">							copyButton.setEnabled(true);</span>
						}else{
<span class="nc" id="L306">							copyButton.setEnabled(false);</span>
						}
<span class="nc" id="L308">					}</span>
				});
				
<span class="nc" id="L311">			}</span>
		});
		
<span class="nc" id="L314">		JScrollPane sp = new JScrollPane(wikiConfigList);</span>
		
<span class="nc" id="L316">		JPanel buttonPanel = new JPanel(new FlowLayout());</span>
<span class="nc" id="L317">		newButton = new JButton(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.new&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L318">		newButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L321">				IWikiTableConfiguration newConfig = new GenericWikiTableConfigurationBean();</span>
<span class="nc" id="L322">				addNewConfigToList(newConfig);</span>
<span class="nc" id="L323">			}</span>

			private void addNewConfigToList(IWikiTableConfiguration newConfig) {
<span class="nc" id="L326">				wikiConfigListModel.addElement(newConfig);</span>
<span class="nc" id="L327">				wikiConfigList.setSelectedValue(newConfig, true);</span>
<span class="nc" id="L328">			}</span>
		});
<span class="nc" id="L330">		buttonPanel.add(newButton);</span>
		
<span class="nc" id="L332">		copyButton = new JButton(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.copy&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L333">		copyButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L336">				IWikiTableConfiguration newConfig = ((IWikiTableConfiguration)wikiConfigList.getSelectedValue()).copyAsUserSpecific();</span>

<span class="nc" id="L338">				int suffix = 0;</span>
				
<span class="nc" id="L340">				String originalName = newConfig.getName();</span>
				
				do{
<span class="nc" id="L343">					suffix++;</span>
<span class="nc" id="L344">					newConfig.setName(originalName+&quot;_&quot;+suffix); //$NON-NLS-1$</span>
<span class="nc bnc" id="L345" title="All 2 branches missed.">				}while(!isUniqueName(newConfig));</span>
					
				
<span class="nc" id="L348">				addNewConfigToList(newConfig);</span>
<span class="nc" id="L349">			}</span>

			
		});
		
<span class="nc" id="L354">		buttonPanel.add(copyButton);</span>
		
<span class="nc" id="L356">		deleteButton = new JButton(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.delete&quot;)); //$NON-NLS-1$</span>
<span class="nc" id="L357">		deleteButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L360">				int selectedIndex = wikiConfigList.getSelectedIndex();</span>
<span class="nc" id="L361">				wikiConfigList.setSelectedIndex(0);</span>
<span class="nc" id="L362">				wikiConfigListModel.remove(selectedIndex);</span>
				// we always have at least on item - the build in configuration
//				wikiConfigList.invalidate();
<span class="nc" id="L365">			}</span>
		});
<span class="nc" id="L367">		buttonPanel.add(deleteButton);</span>
		
<span class="nc" id="L369">		jp.add(sp, BorderLayout.CENTER);</span>
<span class="nc" id="L370">		jp.add(buttonPanel, BorderLayout.SOUTH);</span>
		
<span class="nc" id="L372">		return jp;</span>
	}


	/**
	 * The detail panel contains all information of a specific configuration.
	 * The user can edit the configuration in this panel.
	 */
	private JPanel createDetailPanel(){
<span class="nc" id="L381">		JPanel jp = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L382">		jp.setBorder(BorderFactory.createTitledBorder(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.titleDetailPanel&quot;))); //$NON-NLS-1$</span>
<span class="nc" id="L383">		jp.setMinimumSize(new Dimension(400,50));</span>
		
<span class="nc" id="L385">		final GridBagConstraints gbc = new GridBagConstraints();</span>
		
<span class="nc" id="L387">		int row= 0;</span>
		
<span class="nc" id="L389">		setLabelConstraints(gbc, row);</span>
<span class="nc" id="L390">		nameLable = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.name&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L391">		jp.add(nameLable, gbc);</span>
		
<span class="nc" id="L393">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L394">		name = new JTextField(30);</span>
<span class="nc" id="L395">		jp.add(name, gbc);</span>
		
<span class="nc" id="L397">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L398">		tableStartTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.tableStartTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L399">		jp.add(tableStartTagLabel, gbc);</span>
		
<span class="nc" id="L401">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L402">		tableStartTag = new JTextField(30);</span>
<span class="nc" id="L403">		jp.add(tableStartTag, gbc);</span>
		
		
<span class="nc" id="L406">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L407">		headerStartTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.headerStartTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L408">		jp.add(headerStartTagLabel, gbc);</span>
		
<span class="nc" id="L410">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L411">		headerStartTag = new JTextField(30);</span>
<span class="nc" id="L412">		jp.add(headerStartTag, gbc);</span>
		
<span class="nc" id="L414">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L415">		headerCellTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.headerCellTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L416">		jp.add(headerCellTagLabel, gbc);</span>
		
<span class="nc" id="L418">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L419">		headerCellTag = new JTextField(30);</span>
<span class="nc" id="L420">		jp.add(headerCellTag, gbc);</span>
		
<span class="nc" id="L422">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L423">		headerEndTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.headerEndTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L424">		jp.add(headerEndTagLabel, gbc);</span>
		
<span class="nc" id="L426">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L427">		headerEndTag = new JTextField(30);</span>
<span class="nc" id="L428">		jp.add(headerEndTag, gbc);</span>
		
<span class="nc" id="L430">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L431">		rowStartTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.rowStartTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L432">		jp.add(rowStartTagLabel, gbc);</span>
		
<span class="nc" id="L434">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L435">		rowStartTag = new JTextField(30);</span>
<span class="nc" id="L436">		jp.add(rowStartTag, gbc);</span>
		
<span class="nc" id="L438">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L439">		cellTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.cellTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L440">		jp.add(cellTagLabel, gbc);</span>
		
<span class="nc" id="L442">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L443">		cellTag = new JTextField(30);</span>
<span class="nc" id="L444">		jp.add(cellTag, gbc);</span>
		
<span class="nc" id="L446">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L447">		rowEndTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.rowEndTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L448">		jp.add(rowEndTagLabel, gbc);</span>
		
<span class="nc" id="L450">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L451">		rowEndTag = new JTextField(30);</span>
<span class="nc" id="L452">		jp.add(rowEndTag, gbc);</span>
		
<span class="nc" id="L454">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L455">		tableEndTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.tableEndTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L456">		jp.add(tableEndTagLabel, gbc);</span>
		
<span class="nc" id="L458">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L459">		tableEndTag = new JTextField(30);</span>
<span class="nc" id="L460">		jp.add(tableEndTag, gbc);</span>
		
<span class="nc" id="L462">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L463">		noWikiTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.noWikiTag&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L464">		jp.add(noWikiTagLabel, gbc);</span>
		
<span class="nc" id="L466">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L467">		noWikiTag = new JTextField(30);</span>
<span class="nc" id="L468">		jp.add(noWikiTag, gbc);</span>
		
<span class="nc" id="L470">		setLabelConstraints(gbc, ++row);</span>
<span class="nc" id="L471">		noWikiTagLabel = new JLabel(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.enabled&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</span>
<span class="nc" id="L472">		jp.add(noWikiTagLabel, gbc);</span>
		
<span class="nc" id="L474">		setFieldConstraints(gbc, row);</span>
<span class="nc" id="L475">		enabled = new JCheckBox();</span>
<span class="nc" id="L476">		jp.add(enabled, gbc);</span>
		
<span class="nc" id="L478">		addFocusLostListeners();</span>

<span class="nc" id="L480">		return jp;</span>
	}
	
	
	/**
	 * Adds a {@link FocusListener} for the focus lost event to all input fields of the detail panel.
	 * This listener updated the configuration and the example.
	 */
	private void addFocusLostListeners() {
<span class="nc" id="L489">		name.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L492">				String newName = name.getText();</span>
<span class="nc" id="L493">				config.setName(newName);</span>
				
<span class="nc bnc" id="L495" title="All 2 branches missed.">				 if(!isUniqueName(config)){</span>
<span class="nc" id="L496">					 throw new IllegalArgumentException(s_stringMgr.getString(&quot;WikiTablePreferencesPanel.errorConfigNotUnique&quot;)); //$NON-NLS-1$</span>
				 }
<span class="nc" id="L498">			}</span>
		});
		
		
<span class="nc" id="L502">		tableStartTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L505">				config.setTableStartTag(tableStartTag.getText());</span>
<span class="nc" id="L506">			}</span>
		});
		
<span class="nc" id="L509">		headerStartTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L512">				config.setHeaderStartTag(headerStartTag.getText());</span>
<span class="nc" id="L513">			}</span>
		});
		
<span class="nc" id="L516">		headerCellTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L519">				config.setHeaderCell(headerCellTag.getText());</span>
<span class="nc" id="L520">			}</span>
		});
		
<span class="nc" id="L523">		headerEndTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L526">				config.setHeaderEndTag(headerEndTag.getText());</span>
<span class="nc" id="L527">			}</span>
		});
		
<span class="nc" id="L530">		rowStartTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L533">				config.setRowStartTag(rowStartTag.getText());</span>
<span class="nc" id="L534">			}</span>
		});
		
<span class="nc" id="L537">		cellTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L540">				config.setDataCell(cellTag.getText());</span>
<span class="nc" id="L541">			}</span>
		});
		
<span class="nc" id="L544">		rowEndTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L547">				config.setRowEndTag(rowEndTag.getText());</span>
<span class="nc" id="L548">			}</span>
		});
		
<span class="nc" id="L551">		tableEndTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L554">				config.setTableEndTag(tableEndTag.getText());</span>
<span class="nc" id="L555">			}</span>
		});
		
<span class="nc" id="L558">		noWikiTag.addFocusListener(new DetailConfigFocusLostListener(){</span>
			@Override
			public void setValue(IWikiTableConfiguration config) throws IllegalArgumentException {
<span class="nc" id="L561">				config.setNoWikiTag(noWikiTag.getText());</span>
<span class="nc" id="L562">			}</span>
		});
		
<span class="nc" id="L565">		enabled.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(ActionEvent e) {
<span class="nc" id="L568">				IWikiTableConfiguration config = currentConfigurationInView;</span>
<span class="nc" id="L569">				config.setEnabled(enabled.isSelected());</span>
<span class="nc" id="L570">			}</span>
		});
		
<span class="nc" id="L573">	}</span>


	private void setLabelConstraints(GridBagConstraints gbc, int gridy)
	{
<span class="nc" id="L578">		gbc.gridx = 0;</span>
<span class="nc" id="L579">		gbc.gridy = gridy;</span>
//		gbc.gridwidth = 0;
<span class="nc" id="L581">		gbc.weightx = 0;</span>
<span class="nc" id="L582">		gbc.insets = LABEL_INSETS;</span>
<span class="nc" id="L583">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L584">		gbc.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L585">	}</span>
	
	private void setFieldConstraints(GridBagConstraints gbc, int gridy)
	{
<span class="nc" id="L589">		gbc.gridx = 1;</span>
<span class="nc" id="L590">		gbc.gridy = gridy;</span>
//		gbc.gridwidth = 0;
<span class="nc" id="L592">		gbc.weightx = 1;</span>
<span class="nc" id="L593">		gbc.insets = FIELD_INSETS;</span>
<span class="nc" id="L594">		gbc.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L595">		gbc.anchor = GridBagConstraints.WEST;</span>

<span class="nc" id="L597">	}</span>

	public IApplication getApplication() {
<span class="nc" id="L600">		return application;</span>
	}

	public void setApplication(IApplication app) {
<span class="nc" id="L604">		this.application = app;</span>
<span class="nc" id="L605">	}</span>

	/**
	 * Adds all available configurations to this page
	 * @param squirrelPreferences
	 */
	public void loadData(SquirrelPreferences squirrelPreferences) {
		
<span class="nc" id="L613">		List&lt;IWikiTableConfiguration&gt; configurations = wikiTableConfigFactory.getConfigurations();</span>
		
<span class="nc bnc" id="L615" title="All 2 branches missed.">		for (IWikiTableConfiguration configuration : configurations) {</span>
<span class="nc" id="L616">			wikiConfigListModel.addElement(configuration);</span>
<span class="nc" id="L617">		}</span>
		
<span class="nc" id="L619">		wikiConfigList.setSelectedIndex(0);</span>
		
<span class="nc" id="L621">		IWikiTableConfiguration selectedValue = (IWikiTableConfiguration)wikiConfigList.getSelectedValue();</span>
<span class="nc" id="L622">		showDataFor(selectedValue);	</span>
<span class="nc bnc" id="L623" title="All 2 branches missed.">		if(selectedValue == null){</span>
<span class="nc" id="L624">			this.copyButton.setEnabled(false);</span>
		}
		
<span class="nc" id="L627">	}</span>


	/**
	 * Shows the data of a specific configuration in the detail panel
	 * @param selectedValue
	 */
	private void showDataFor(IWikiTableConfiguration selectedValue) {
<span class="nc bnc" id="L635" title="All 2 branches missed.">		if(selectedValue != null){</span>
<span class="nc" id="L636">			this.currentConfigurationInView = selectedValue;</span>
<span class="nc" id="L637">			fillDetailPane(selectedValue);</span>
<span class="nc" id="L638">			showExample(selectedValue);</span>
		}else{
<span class="nc" id="L640">			this.currentConfigurationInView = null;</span>
<span class="nc" id="L641">			enableInputFields(false);</span>
		}
<span class="nc" id="L643">	}</span>
	
	/**
	 * Disable all input fields
	 */
	private void enableInputFields(boolean enabled) {
<span class="nc" id="L649">		this.name.setEnabled(enabled);</span>
<span class="nc" id="L650">		this.tableStartTag.setEnabled(enabled);</span>
<span class="nc" id="L651">		this.headerStartTag.setEnabled(enabled);</span>
<span class="nc" id="L652">		this.headerCellTag.setEnabled(enabled);</span>
<span class="nc" id="L653">		this.headerEndTag.setEnabled(enabled);</span>
<span class="nc" id="L654">		this.rowStartTag.setEnabled(enabled);</span>
<span class="nc" id="L655">		this.cellTag.setEnabled(enabled);</span>
<span class="nc" id="L656">		this.rowEndTag.setEnabled(enabled);</span>
<span class="nc" id="L657">		this.tableEndTag.setEnabled(enabled);</span>
<span class="nc" id="L658">		this.noWikiTag.setEnabled(enabled);</span>
<span class="nc" id="L659">		this.deleteButton.setEnabled(enabled);</span>
		
<span class="nc bnc" id="L661" title="All 2 branches missed.">		if(currentConfigurationInView != null){</span>
<span class="nc" id="L662">			this.enabled.setEnabled(true);</span>
		}else{
<span class="nc" id="L664">			this.enabled.setEnabled(false);</span>
		}
<span class="nc" id="L666">	}</span>


	/**
	 * Shows the example for a specific configuration
	 */
	private void showExample(IWikiTableConfiguration selectedValue) {
		// select all rows
<span class="nc" id="L674">		exampleTable.changeSelection(0, 0, false, false);</span>
<span class="nc" id="L675">		exampleTable.changeSelection(exampleTable.getRowCount()-1, exampleTable.getColumnCount()-1, true, true);</span>
		
		
<span class="nc" id="L678">		String example = selectedValue.createTransformer().transform(this.exampleTable);</span>
<span class="nc" id="L679">		this.exampleText.setText(example);</span>
<span class="nc" id="L680">	}</span>


	/**
	 * Fills the detail pane with the values of the selected configuration
	 * @param selectedValue
	 */
	private void fillDetailPane(IWikiTableConfiguration config) {
		
<span class="nc" id="L689">		this.name.setText(config.getName());</span>
		
<span class="nc" id="L691">		this.tableStartTag.setText(config.getTableStartTag());</span>
		
<span class="nc" id="L693">		this.headerStartTag.setText(config.getHeaderStartTag());</span>
		
<span class="nc" id="L695">		this.headerCellTag.setText(config.getHeaderCell());</span>
		
<span class="nc" id="L697">		this.headerEndTag.setText(config.getHeaderEndTag());</span>
		
<span class="nc" id="L699">		this.rowStartTag.setText(config.getRowStartTag());</span>
		
<span class="nc" id="L701">		this.cellTag.setText(config.getDataCell());</span>
		
<span class="nc" id="L703">		this.rowEndTag.setText(config.getRowEndTag());</span>
		
<span class="nc" id="L705">		this.tableEndTag.setText(config.getTableEndTag());</span>
		
<span class="nc" id="L707">		this.noWikiTag.setText(config.getNoWikiTag());</span>
		
<span class="nc" id="L709">		this.enabled.setSelected(config.isEnabled());</span>
		
<span class="nc bnc" id="L711" title="All 2 branches missed.">		enableInputFields(!config.isReadOnly());</span>
<span class="nc" id="L712">	}</span>

	/**
	 * Adds a new configuration to the list.
	 */
	private void addNewConfigToList(IWikiTableConfiguration newConfig) {
<span class="nc" id="L718">		wikiConfigListModel.addElement(newConfig);</span>
<span class="nc" id="L719">		wikiConfigList.setSelectedValue(newConfig, true);</span>
<span class="nc" id="L720">	}</span>
	
	/**
	 * checks, if the name of a configuration is unique in the system.
	 */
	private boolean isUniqueName(IWikiTableConfiguration config) {
		boolean unique;
<span class="nc" id="L727">		Object[] configArray =  wikiConfigListModel.toArray();</span>
<span class="nc" id="L728">		unique = true;</span>
<span class="nc bnc" id="L729" title="All 2 branches missed.">		for (Object conf : configArray) {</span>
			// This must be a check, if the references are identical.
<span class="nc bnc" id="L731" title="All 2 branches missed.">			if(conf != conf){</span>
<span class="nc bnc" id="L732" title="All 2 branches missed.">				if(StringUtils.equalsIgnoreCase(config.getName(), ((IWikiTableConfiguration) conf).getName())){</span>
<span class="nc" id="L733">					unique = false;</span>
				}
			}
		}
<span class="nc" id="L737">		return unique;</span>
	}
	
<span class="nc" id="L740">	private abstract class DetailConfigFocusLostListener implements FocusListener{</span>

		/* (non-Javadoc)
		 * @see java.awt.event.FocusListener#focusGained(java.awt.event.FocusEvent)
		 */
		@Override
		public void focusGained(FocusEvent envent) {
			// nothing
			
<span class="nc" id="L749">		}</span>

		/* (non-Javadoc)
		 * @see java.awt.event.FocusListener#focusLost(java.awt.event.FocusEvent)
		 */
		@Override
		public void focusLost(final FocusEvent event) {
<span class="nc bnc" id="L756" title="All 2 branches missed.">			if(!event.isTemporary()){</span>
<span class="nc" id="L757">				IWikiTableConfiguration config = currentConfigurationInView;</span>
				try{
<span class="nc" id="L759">					setValue(config);</span>
<span class="nc" id="L760">				}catch (IllegalArgumentException e) {</span>
<span class="nc" id="L761">					application.showErrorDialog(e.getMessage());</span>
<span class="nc" id="L762">					JTextField textField = (JTextField) event.getComponent();</span>
<span class="nc" id="L763">					String text = textField.getText();</span>
<span class="nc" id="L764">					System.out.println(text);</span>
<span class="nc" id="L765">					SwingUtilities.invokeLater(new Runnable() {</span>
						
						@Override
						public void run() {
<span class="nc" id="L769">							event.getComponent().requestFocus();</span>
<span class="nc" id="L770">						}</span>
					});
<span class="nc" id="L772">				}</span>
<span class="nc" id="L773">				showExample(config);</span>
			}
			
<span class="nc" id="L776">		}</span>
		
		public abstract void setValue(IWikiTableConfiguration config) throws IllegalArgumentException;
		
	}

	/**
	 * Puts the configurations back into the {@link IWikiTableConfigurationFactory}.
	 * @see IWikiTableConfigurationFactory#replaceUserSpecificConfigurations(List)
	 * @param squirrelPreferences
	 */
	public void applyChanges() {
		
<span class="nc" id="L789">		Object[] array = wikiConfigListModel.toArray();</span>
		
<span class="nc" id="L791">		List&lt;IWikiTableConfiguration&gt; userSpecific = new ArrayList&lt;IWikiTableConfiguration&gt;();</span>
<span class="nc" id="L792">		List&lt;IWikiTableConfiguration&gt; buildIn = new ArrayList&lt;IWikiTableConfiguration&gt;();</span>
<span class="nc bnc" id="L793" title="All 2 branches missed.">		for (Object object : array) {</span>
<span class="nc" id="L794">			IWikiTableConfiguration config = (IWikiTableConfiguration) object;</span>
<span class="nc bnc" id="L795" title="All 2 branches missed.">			if(config.isReadOnly() == false){</span>
<span class="nc" id="L796">				userSpecific.add(config);</span>
			}else{
<span class="nc" id="L798">				buildIn.add(config);</span>
			}
		}
		
<span class="nc" id="L802">		wikiTableConfigFactory.replaceUserSpecificConfigurations(userSpecific);</span>
<span class="nc" id="L803">		wikiTableConfigFactory.replaceBuilInConfiguration(buildIn);</span>
<span class="nc" id="L804">	}</span>


	public IWikiTableConfigurationFactory getWikiTableConfigFactory() {
<span class="nc" id="L808">		return wikiTableConfigFactory;</span>
	}


	public void setWikiTableConfigFactory(IWikiTableConfigurationFactory wikiTableConfigFactory) {
<span class="nc" id="L813">		this.wikiTableConfigFactory = wikiTableConfigFactory;</span>
<span class="nc" id="L814">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>