<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DefaultSQLEntryPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session</a> &gt; <span class="el_source">DefaultSQLEntryPanel.java</span></div><h1>DefaultSQLEntryPanel.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session;
/*
 * Copyright (C) 2001-2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.Font;
import java.awt.dnd.DropTarget;
import java.awt.event.MouseListener;

import javax.swing.JTextArea;
import javax.swing.event.CaretListener;
import javax.swing.event.UndoableEditListener;
import javax.swing.text.BadLocationException;
import javax.swing.text.JTextComponent;
import javax.swing.undo.UndoManager;

import net.sourceforge.squirrel_sql.client.gui.dnd.FileEditorDropTargetListener;
import net.sourceforge.squirrel_sql.client.session.properties.SessionProperties;
import net.sourceforge.squirrel_sql.fw.gui.FontInfo;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

public class DefaultSQLEntryPanel extends BaseSQLEntryPanel
{
	/** Logger for this class. */
<span class="nc" id="L40">	private static ILogger s_log =</span>
<span class="nc" id="L41">		LoggerController.createLogger(DefaultSQLEntryPanel.class);</span>

	/** Current session. */
	private ISession _session;

	/** Text area control. */
	private MyTextArea _comp;

    @SuppressWarnings(&quot;unused&quot;)
    private DropTarget dt;
	
	public DefaultSQLEntryPanel(ISession session)
	{
<span class="nc" id="L54">		super(session.getApplication());</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">		if (session == null)</span>
		{
<span class="nc" id="L57">			throw new IllegalArgumentException(&quot;ISession == null&quot;);</span>
		}

<span class="nc" id="L60">		_session = session;</span>
<span class="nc" id="L61">		_comp = new MyTextArea(session);</span>
		
<span class="nc" id="L63">		dt = new DropTarget(_comp, new FileEditorDropTargetListener(session));</span>
<span class="nc" id="L64">	}</span>

	/**
	 * Retrieve the text area component. Normally this would be a subclass
	 * of &lt;TT&gt;javax.swing.text.JTextComponent&lt;/TT&gt; but a plugin may use a
	 * class otehr than a Swing text control.
	 *
	 * @return	The text area component.
	 */
	public JTextComponent getTextComponent()
	{
<span class="nc" id="L75">		return _comp;</span>
	}

	/**
	 * If the component returned by &lt;TT&gt;getTextComponent&lt;/TT&gt; contains
	 * its own scroll bars return &lt;TT&gt;true&lt;/TT&gt; other wise this component
	 * will be wrapped in the scroll pane when added to the SQL panel.
	 *
	 * @return	&lt;TT&gt;true&lt;/TT&gt; if text component already handles scrolling.
	 */
	public boolean getDoesTextComponentHaveScroller()
	{
<span class="nc" id="L87">		return false;</span>
	}

	public void addUndoableEditListener(UndoableEditListener lis)
	{
<span class="nc" id="L92">		_comp.getDocument().addUndoableEditListener(lis);</span>
<span class="nc" id="L93">	}</span>

	public void removeUndoableEditListener(UndoableEditListener lis)
	{
<span class="nc" id="L97">		_comp.getDocument().removeUndoableEditListener(lis);</span>
<span class="nc" id="L98">	}</span>

	/*
	 * @see ISQLEntryPanel#hasOwnUndoableManager()
	 */
	public boolean hasOwnUndoableManager()
	{
<span class="nc" id="L105">		return false;</span>
	}


	/**
	 * @see ISQLEntryPanel#getText()
	 */
	public String getText()
	{
<span class="nc" id="L114">		return _comp.getText();</span>
	}

	/**
	 * @see ISQLEntryPanel#getSelectedText()
	 */
	public String getSelectedText()
	{
<span class="nc" id="L122">		return _comp.getSelectedText();</span>
	}

	/**
	 * Replace the contents of the SQL entry area with the passed
	 * SQL script without selecting it.
	 *
	 * @param	sqlScript	The script to be placed in the SQL entry area..
	 */
	public void setText(String sqlScript)
	{
<span class="nc" id="L133">		setText(sqlScript, true);</span>
<span class="nc" id="L134">	}</span>

	/**
	 * Replace the contents of the SQL entry area with the passed
	 * SQL script and specify whether to select it.
	 *
	 * @param	sqlScript	The script to be placed in the SQL entry area..
	 * @param	select		If &lt;TT&gt;true&lt;/TT&gt; then select the passed script
	 * 						in the sql entry area.
	 */
	public void setText(String sqlScript, boolean select)
	{
<span class="nc" id="L146">		_comp.setText(sqlScript);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">		if (select)</span>
		{
<span class="nc" id="L149">			setSelectionEnd(getText().length());</span>
<span class="nc" id="L150">			setSelectionStart(0);</span>
		}
<span class="nc" id="L152">      _comp.setCaretPosition(0);</span>
<span class="nc" id="L153">	}</span>

	/**
	 * Append the passed SQL script to the SQL entry area but don't select
	 * it.
	 *
	 * @param	sqlScript	The script to be appended.
	 */
	public void appendText(String sqlScript)
	{
<span class="nc" id="L163">		appendText(sqlScript, false);</span>
<span class="nc" id="L164">	}</span>

	/**
	 * Append the passed SQL script to the SQL entry area and specify
	 * whether it should be selected.
	 *
	 * @param	sqlScript	The script to be appended.
	 * @param	select		If &lt;TT&gt;true&lt;/TT&gt; then select the passed script
	 * 						in the sql entry area.
	 */
	public void appendText(String sqlScript, boolean select)
	{
<span class="nc bnc" id="L176" title="All 2 branches missed.">		final int start = select ? getText().length() : 0;</span>
<span class="nc" id="L177">		_comp.append(sqlScript);</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">		if (select)</span>
		{
<span class="nc" id="L180">			setSelectionEnd(getText().length());</span>
<span class="nc" id="L181">			setSelectionStart(start);</span>
		}
<span class="nc" id="L183">	}</span>

	/**
	 * Replace the currently selected text in the SQL entry area
	 * with the passed text.
	 *
	 * @param	sqlScript	The script to be placed in the SQL entry area.
	 */
	public void replaceSelection(String sqlScript)
	{
<span class="nc" id="L193">		_comp.replaceSelection(sqlScript);</span>
<span class="nc" id="L194">	}</span>

	/**
	 * @see ISQLEntryPanel#getCaretPosition()
	 */
	public int getCaretPosition()
	{
<span class="nc" id="L201">		return _comp.getCaretPosition();</span>
	}

	/**
	 * @see ISQLEntryPanel#setTabSize(int)
	 */
	public void setTabSize(int tabSize)
	{
<span class="nc" id="L209">		_comp.setTabSize(tabSize);</span>
<span class="nc" id="L210">	}</span>

	public void setFont(Font font)
	{
<span class="nc" id="L214">		_comp.setFont(font);</span>
<span class="nc" id="L215">	}</span>


	/**
	 * @see ISQLEntryPanel#addMouseListener(MouseListener)
	 */
	public void addMouseListener(MouseListener lis)
	{
<span class="nc" id="L223">		_comp.addMouseListener(lis);</span>
<span class="nc" id="L224">	}</span>

	/**
	 * @see ISQLEntryPanel#removeListener(MouseListener)
	 */
	public void removeMouseListener(MouseListener lis)
	{
<span class="nc" id="L231">		_comp.removeMouseListener(lis);</span>
<span class="nc" id="L232">	}</span>

	/**
	 * @see ISQLEntryPanel#setCaretPosition(int)
	 */
	public void setCaretPosition(int pos)
	{
<span class="nc" id="L239">		_comp.setCaretPosition(pos);</span>
<span class="nc" id="L240">	}</span>

	/*
	 * @see ISQLEntryPanel#getCaretLineNumber()
	 */
	public int getCaretLineNumber()
	{
		try
		{
<span class="nc" id="L249">			return _comp.getLineOfOffset(_comp.getCaretPosition());</span>
		}
<span class="nc" id="L251">		catch (BadLocationException ex)</span>
		{
<span class="nc" id="L253">			return 0;</span>
		}
	}

	public int getCaretLinePosition()
	{
<span class="nc" id="L259">		int caretPos = _comp.getCaretPosition();</span>
<span class="nc" id="L260">		int caretLineOffset = caretPos;</span>
		try
		{
<span class="nc" id="L263">			caretLineOffset = _comp.getLineStartOffset(getCaretLineNumber());</span>
		}
<span class="nc" id="L265">		catch (BadLocationException ex)</span>
		{
<span class="nc" id="L267">			s_log.error(&quot;BadLocationException in getCaretLinePosition&quot;, ex);</span>
<span class="nc" id="L268">		}</span>
<span class="nc" id="L269">		return caretPos - caretLineOffset;</span>
	}

	/**
	 * @see ISQLEntryPanel#getSelectionStart()
	 */
	public int getSelectionStart()
	{
<span class="nc" id="L277">		return _comp.getSelectionStart();</span>
	}

	/**
	 * @see ISQLEntryPanel#setSelectionStart(int)
	 */
	public void setSelectionStart(int pos)
	{
<span class="nc" id="L285">		_comp.setSelectionStart(pos);</span>
<span class="nc" id="L286">	}</span>

	/**
	 * @see ISQLEntryPanel#getSelectionEnd()
	 */
	public int getSelectionEnd()
	{
<span class="nc" id="L293">		return _comp.getSelectionEnd();</span>
	}

	/**
	 * @see ISQLEntryPanel#setSelectionEnd(int)
	 */
	public void setSelectionEnd(int pos)
	{
<span class="nc" id="L301">		_comp.setSelectionEnd(pos);</span>
<span class="nc" id="L302">	}</span>

	/**
	 * @see ISQLEntryPanel#hasFocus()
	 */
	public boolean hasFocus()
	{
<span class="nc" id="L309">		return _comp.hasFocus();</span>
	}

	/**
	 * @see ISQLEntryPanel#requestFocus()
	 */
	public void requestFocus()
	{
<span class="nc" id="L317">		_comp.requestFocus();</span>
<span class="nc" id="L318">	}</span>

	/*
	 * @see ISQLEntryPanel#addCaretListener(CaretListener)
	 */
	public void addCaretListener(CaretListener lis)
	{
<span class="nc" id="L325">		_comp.addCaretListener(lis);</span>
<span class="nc" id="L326">	}</span>

	/*
	 * @see ISQLEntryPanel#removeCaretListener(CaretListener)
	 */
	public void removeCaretListener(CaretListener lis)
	{
<span class="nc" id="L333">		_comp.removeCaretListener(lis);</span>
<span class="nc" id="L334">	}</span>

	public void addSQLTokenListener(SQLTokenListener tl)
	{
		// Not implemented
<span class="nc" id="L339">	}</span>

	public void removeSQLTokenListener(SQLTokenListener tl)
	{
		// Not implemented
<span class="nc" id="L344">	}</span>

   public ISession getSession()
   {
<span class="nc" id="L348">      return _session;</span>
   }

   private static class MyTextArea extends JTextArea
	{
		private MyTextArea(ISession session)
<span class="nc" id="L354">		{</span>
<span class="nc" id="L355">			SessionProperties props = session.getProperties();</span>
<span class="nc" id="L356">			final FontInfo fi = props.getFontInfo();</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">			if (fi != null)</span>
			{
<span class="nc" id="L359">				this.setFont(props.getFontInfo().createFont());</span>
			}
<span class="nc" id="L361">		}</span>
	}

    /* (non-Javadoc)
     * @see net.sourceforge.squirrel_sql.client.session.ISQLEntryPanel#setUndoManager(javax.swing.undo.UndoManager)
     */
    public void setUndoManager(UndoManager manager) {
        // no support for undo
<span class="nc" id="L369">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>