<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ObjectTreeSearch.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session</a> &gt; <span class="el_source">ObjectTreeSearch.java</span></div><h1>ObjectTreeSearch.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session;

import net.sourceforge.squirrel_sql.client.gui.session.ObjectTreeInternalFrame;
import net.sourceforge.squirrel_sql.client.gui.session.SessionInternalFrame;
import net.sourceforge.squirrel_sql.client.session.schemainfo.FilterMatcher;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import javax.swing.*;
import java.util.ArrayList;


/**
 * Helps to locate Objects in the Object tree of a Session main window or an ObjectTreeInternalFrame
 */
<span class="nc" id="L16">public class ObjectTreeSearch</span>
{
<span class="nc" id="L18">   private static final StringManager s_stringMgr =</span>
<span class="nc" id="L19">       StringManagerFactory.getStringManager(ObjectTreeSearch.class);</span>



   /**
    * View the Object at cursor in the Object Tree
    *
    * @param	evt		Event being executed.
    */
   public synchronized void viewObjectInObjectTree(String objectName, ISession session)
   {

<span class="nc" id="L31">      ObjectCandidates candidates = getObjectCandidates(objectName);</span>
<span class="nc bnc" id="L32" title="All 2 branches missed.">      if (candidates.size() == 0)</span>
      {
<span class="nc" id="L34">          return;</span>
      }

<span class="nc bnc" id="L37" title="All 2 branches missed.">      if(false == session.getActiveSessionWindow() instanceof SessionInternalFrame &amp;&amp;</span>
<span class="nc bnc" id="L38" title="All 2 branches missed.">         false == session.getActiveSessionWindow() instanceof ObjectTreeInternalFrame)</span>
      {
<span class="nc" id="L40">         return;</span>
      }



<span class="nc" id="L45">      IObjectTreeAPI objectTree = session.getObjectTreeAPIOfActiveSessionWindow();</span>

<span class="nc" id="L47">      boolean success = false;</span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">      while (candidates.hasNext())</span>
      {

<span class="nc" id="L51">         ArrayList&lt;String&gt; catSchemObj = candidates.next();</span>

<span class="nc" id="L53">         success = objectTree.selectInObjectTree(catSchemObj.get(0), catSchemObj.get(1), new FilterMatcher(catSchemObj.get(2), null));</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">         if (success)</span>
         {
<span class="nc" id="L56">            session.selectMainTab(ISession.IMainPanelTabIndexes.OBJECT_TREE_TAB);</span>
<span class="nc" id="L57">            break;</span>
         }

<span class="nc" id="L60">      }</span>

<span class="nc bnc" id="L62" title="All 2 branches missed.">      if (false == success)</span>
      {
         // i18n[ObjectTreeSearch.error.objectnotfound=Could not locate the database object ''{0}'' in Object tree]
<span class="nc" id="L65">         String msg =</span>
<span class="nc" id="L66">             s_stringMgr.getString(</span>
                     &quot;ObjectTreeSearch.error.objectnotfound&quot;,
<span class="nc" id="L68">                     candidates.getSearchString());</span>
<span class="nc" id="L69">         JOptionPane.showMessageDialog(session.getApplication().getMainFrame(), msg);</span>
      }

<span class="nc" id="L72">   }</span>

   private ObjectCandidates getObjectCandidates(String objectName)
   {
<span class="nc" id="L76">      ObjectCandidates ret = new ObjectCandidates(objectName);</span>

<span class="nc" id="L78">      String[] splits = objectName.split(&quot;\\.&quot;);</span>


<span class="nc bnc" id="L81" title="All 2 branches missed.">      for (int i = splits.length-1; i &gt;=0 ; i--)</span>
      {
<span class="nc" id="L83">         String object = null;</span>
<span class="nc" id="L84">         String schema = null;</span>
<span class="nc" id="L85">         String catalog = null;</span>

<span class="nc" id="L87">         object = removeQuotes(splits[i]);</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">         if (i+1 &lt; splits.length)</span>
         {
<span class="nc" id="L91">            schema = splits[i+1];</span>
         }

<span class="nc bnc" id="L94" title="All 2 branches missed.">         if (i+2 &lt; splits.length)</span>
         {
<span class="nc" id="L96">            catalog = splits[i+2];</span>
         }
<span class="nc bnc" id="L98" title="All 6 branches missed.">         if (catalog == null &amp;&amp; schema == null &amp;&amp; &quot;&quot;.equals(object)) {</span>
<span class="nc" id="L99">             continue;</span>
         }
<span class="nc" id="L101">         ret.add(catalog, schema, object);</span>
      }

<span class="nc" id="L104">      return ret;</span>
   }

   private String removeQuotes(String objectName)
   {
<span class="nc" id="L109">      String ret = objectName.trim();</span>


<span class="nc bnc" id="L112" title="All 4 branches missed.">      while(ret.startsWith(&quot;\&quot;&quot;) || ret.startsWith(&quot;/&quot;))</span>
      {
<span class="nc" id="L114">         ret = ret.substring(1);</span>
      }

<span class="nc bnc" id="L117" title="All 4 branches missed.">      while(ret.endsWith(&quot;\&quot;&quot;) || ret.endsWith(&quot;/&quot;))</span>
      {
<span class="nc" id="L119">          ret = ret.substring(0,ret.length()-1);</span>
      }
      
<span class="nc" id="L122">      return ret;</span>
   }


   private static class ObjectCandidates
   {
<span class="nc" id="L128">      ArrayList&lt;ArrayList&lt;String&gt;&gt; _candidates = new ArrayList&lt;ArrayList&lt;String&gt;&gt;();</span>

<span class="nc" id="L130">      int _curIndex = 0;</span>
      private String _searchString;

      public ObjectCandidates(String searchString)
<span class="nc" id="L134">      {</span>
<span class="nc" id="L135">         _searchString = searchString;</span>
<span class="nc" id="L136">      }</span>


      public boolean hasNext()
      {
<span class="nc bnc" id="L141" title="All 2 branches missed.">         return _curIndex &lt; _candidates.size();</span>
      }

      public ArrayList&lt;String&gt; next()
      {
<span class="nc" id="L146">         return _candidates.get(_curIndex++);</span>
      }

      public String getSearchString()
      {
<span class="nc" id="L151">         return _searchString;</span>
      }

      public void add(String catalog, String schema, String object)
      {
<span class="nc" id="L156">         ArrayList&lt;String&gt; candidate = new ArrayList&lt;String&gt;(3);</span>
<span class="nc" id="L157">         candidate.add(catalog);</span>
<span class="nc" id="L158">         candidate.add(schema);</span>
<span class="nc" id="L159">         candidate.add(object);</span>
<span class="nc" id="L160">         _candidates.add(candidate);</span>
<span class="nc" id="L161">      }</span>

      public int size()
      {
<span class="nc" id="L165">         return _candidates.size();</span>
      }
   }




}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>