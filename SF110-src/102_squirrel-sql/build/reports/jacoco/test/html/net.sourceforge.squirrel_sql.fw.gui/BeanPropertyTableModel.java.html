<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BeanPropertyTableModel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.gui</a> &gt; <span class="el_source">BeanPropertyTableModel.java</span></div><h1>BeanPropertyTableModel.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.gui;
/*
 * Copyright (C) 2001-2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.beans.BeanInfo;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Collections;
import java.util.Comparator;
import java.util.Vector;

import javax.swing.table.DefaultTableModel;

import net.sourceforge.squirrel_sql.fw.util.BaseException;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

public class BeanPropertyTableModel extends DefaultTableModel
{
    private static final long serialVersionUID = 1L;

    /** Internationalized strings for this class. */
<span class="nc" id="L40">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L41">		StringManagerFactory.getStringManager(BeanPropertyTableModel.class);</span>

	private Object _bean;

<span class="nc" id="L45">	private String _nameColumnName = s_stringMgr.getString(&quot;BeanPropertyTableModel.namecolumn&quot;);</span>
<span class="nc" id="L46">	private String _valueColumnName = s_stringMgr.getString(&quot;BeanPropertyTableModel.valuecolumn&quot;);</span>

	public BeanPropertyTableModel()
	{
<span class="nc" id="L50">		super();</span>
<span class="nc" id="L51">	}</span>

	public void setBean(Object bean) throws BaseException
	{
<span class="nc" id="L55">		_bean = bean;</span>
<span class="nc" id="L56">		refresh();</span>
<span class="nc" id="L57">	}</span>

	public void refresh() throws BaseException
	{
<span class="nc" id="L61">		final Vector&lt;Object&gt; columnNames = new Vector&lt;Object&gt;();</span>
<span class="nc" id="L62">		columnNames.add(_nameColumnName);</span>
<span class="nc" id="L63">		columnNames.add(_valueColumnName);</span>
<span class="nc" id="L64">		final Vector&lt;Object&gt; columnData = new Vector&lt;Object&gt;();</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">		if (_bean != null)</span>
		{
			try
			{
<span class="nc" id="L69">				BeanInfo info = Introspector.getBeanInfo(_bean.getClass(), Introspector.USE_ALL_BEANINFO);</span>
<span class="nc" id="L70">				processBeanInfo(info, columnData);</span>
			}
<span class="nc" id="L72">			catch (Exception ex)</span>
			{
<span class="nc" id="L74">				throw new BaseException(ex);</span>
<span class="nc" id="L75">			}</span>
		}

		// Sort the rows by the property name.
<span class="nc" id="L79">		Collections.sort(columnData, new DataSorter());</span>

<span class="nc" id="L81">		setDataVector(columnData, columnNames);</span>
<span class="nc" id="L82">	}</span>

	private void processBeanInfo(BeanInfo info, Vector&lt;Object&gt; columnData)
		throws InvocationTargetException, IllegalAccessException
	{
<span class="nc" id="L87">		BeanInfo[] extra = info.getAdditionalBeanInfo();</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (extra != null)</span>
		{
<span class="nc bnc" id="L90" title="All 2 branches missed.">			for (int i = 0; i &lt; extra.length; ++i)</span>
			{
<span class="nc" id="L92">				processBeanInfo(extra[i], columnData);</span>
			}
		}

<span class="nc" id="L96">		PropertyDescriptor[] propDesc = info.getPropertyDescriptors();</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">		for (int i = 0; i &lt; propDesc.length; ++i)</span>
		{
<span class="nc" id="L99">			final String propName = propDesc[i].getName();</span>
<span class="nc" id="L100">			final Method getter = propDesc[i].getReadMethod();</span>
<span class="nc bnc" id="L101" title="All 4 branches missed.">			if (propName != null &amp;&amp; getter != null)</span>
			{
<span class="nc" id="L103">				Vector&lt;Object&gt; line = generateLine(propName, _bean, getter);</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">				if (line != null)</span>
				{
<span class="nc" id="L106">					columnData.add(line);</span>
				}
			}
		}
<span class="nc" id="L110">	}</span>

	/**
	 * Generate a line for the passed property.
	 *
	 * @param	propName	Name of the property.
	 * @param	bean		Bean containg the property.
	 * @param	getter		The &quot;getter&quot; function to retrieve the
	 *						properties value.
	 *
	 * @return	A &lt;CODE&gt;Vector&lt;/CODE&gt; containing the cells for the line in
	 *			the table. Element zero the first cell etc. Return
	 *			&lt;CODE&gt;null&lt;/CODE&gt; if this property is &lt;B&gt;not&lt;/B&gt; to be added
	 *			to the table.
	 */
	protected Vector&lt;Object&gt; generateLine(String propName, Object bean, Method getter)
		throws InvocationTargetException, IllegalAccessException
	{
<span class="nc" id="L128">		final Vector&lt;Object&gt; line = new Vector&lt;Object&gt;();</span>
<span class="nc" id="L129">		line.add(propName);</span>
<span class="nc" id="L130">		line.add(executeGetter(bean, getter));</span>
<span class="nc" id="L131">		return line;</span>
	}

	protected Object executeGetter(Object bean, Method getter)
		throws InvocationTargetException, IllegalAccessException
	{
<span class="nc" id="L137">		return getter.invoke(bean, (Object[])null);</span>
	}

	public void setNameColumnName(String value)
	{
<span class="nc" id="L142">		_nameColumnName = value;</span>
<span class="nc" id="L143">	}</span>

	public void setValueColumnName(String value)
	{
<span class="nc" id="L147">		_valueColumnName = value;</span>
<span class="nc" id="L148">	}</span>

	/**
	 * This comparator is compatible with the strange use of lists in this 
	 * class.  This classes lists are Vectors with Strings as the first element
	 * and any object as the other objects.
	 */
	private static final class DataSorter implements Comparator&lt;Object&gt;
	{
		public int compare(Object o1, Object o2)
		{
<span class="nc" id="L159">		    Vector&lt;Object&gt; v1 = (Vector&lt;Object&gt;)o1;</span>
<span class="nc" id="L160">		    Vector&lt;Object&gt; v2 = (Vector&lt;Object&gt;)o2;</span>
<span class="nc" id="L161">		    String lhs = (String)v1.get(0);</span>
<span class="nc" id="L162">		    String rhs = (String)v2.get(0);</span>
<span class="nc" id="L163">			return lhs.compareToIgnoreCase(rhs);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>