<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RectangleSelectionHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.gui</a> &gt; <span class="el_source">RectangleSelectionHandler.java</span></div><h1>RectangleSelectionHandler.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.gui;

import javax.swing.*;
import java.awt.*;
import java.awt.event.InputEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseMotionAdapter;

public class RectangleSelectionHandler
{
   private JComponent _comp;
<span class="nc" id="L13">   private Point _dragBeginPoint = null;</span>
<span class="nc" id="L14">   private Point _dragEndPoint = null;</span>
   private RectangleSelectionListener _rectangleSelectionListener;
   private boolean _cancelCurrentSelection;


   public RectangleSelectionHandler(JComponent comp)
<span class="nc" id="L20">   {</span>
<span class="nc" id="L21">      setComponent(comp);</span>
<span class="nc" id="L22">   }</span>

   public RectangleSelectionHandler()
<span class="nc" id="L25">   {</span>
<span class="nc" id="L26">   }</span>

   private void onMouseDragged(MouseEvent e)
   {
<span class="nc bnc" id="L30" title="All 2 branches missed.">      if(null == _dragBeginPoint )</span>
      {
<span class="nc" id="L32">         initBeginPoint(e);</span>
      }

<span class="nc" id="L35">      _dragEndPoint = e.getPoint();</span>

<span class="nc" id="L37">      _comp.repaint();</span>

<span class="nc" id="L39">   }</span>

   /**
    * Call this method from your component's paint method.
    */
   public void paintRectWhenNeeded(Graphics g)
   {
<span class="nc bnc" id="L46" title="All 8 branches missed.">      if(false == _cancelCurrentSelection &amp;&amp; null != _dragBeginPoint &amp;&amp; null != _dragEndPoint &amp;&amp; false == _dragBeginPoint.equals(_dragEndPoint))</span>
      {
<span class="nc" id="L48">         int x = Math.min(_dragBeginPoint.x,  _dragEndPoint.x);</span>
<span class="nc" id="L49">         int y = Math.min(_dragBeginPoint.y,  _dragEndPoint.y);</span>
<span class="nc" id="L50">         int width = Math.abs(_dragBeginPoint.x - _dragEndPoint.x);</span>
<span class="nc" id="L51">         int heigh = Math.abs(_dragBeginPoint.y - _dragEndPoint.y);</span>

<span class="nc" id="L53">         Color colBuf = g.getColor();</span>
<span class="nc" id="L54">         g.setColor(_comp.getForeground());</span>
<span class="nc" id="L55">         g.drawRect(x,y,width,heigh);</span>
<span class="nc" id="L56">         g.setColor(colBuf);</span>
      }
<span class="nc" id="L58">   }</span>

   public void setComponent(JComponent comp)
   {
<span class="nc" id="L62">      _comp = comp;</span>

<span class="nc" id="L64">      _comp.addMouseListener(new MouseAdapter()</span>
<span class="nc" id="L65">      {</span>
         public void mousePressed(MouseEvent e)
         {
<span class="nc" id="L68">            initBeginPoint(e);</span>
<span class="nc" id="L69">         }</span>

         public void mouseReleased(MouseEvent e)
         {
<span class="nc" id="L73">            onMouseReleased();</span>
<span class="nc" id="L74">         }</span>
      });

<span class="nc" id="L77">      _comp.addMouseMotionListener(new MouseMotionAdapter()</span>
<span class="nc" id="L78">      {</span>
         public void mouseDragged(MouseEvent e)
         {
<span class="nc" id="L81">            onMouseDragged(e);</span>
<span class="nc" id="L82">         }</span>
      });
<span class="nc" id="L84">   }</span>

   private void onMouseReleased()
   {
<span class="nc bnc" id="L88" title="All 8 branches missed.">      if (false == _cancelCurrentSelection &amp;&amp; null != _rectangleSelectionListener &amp;&amp; null != _dragBeginPoint &amp;&amp; null != _dragEndPoint)</span>
      {
<span class="nc" id="L90">         _rectangleSelectionListener.rectSelected(_dragBeginPoint, _dragEndPoint);</span>
      }
<span class="nc" id="L92">      _dragBeginPoint = null;</span>
<span class="nc" id="L93">      _dragEndPoint = null;</span>
<span class="nc" id="L94">      _cancelCurrentSelection = false;</span>
<span class="nc" id="L95">      _comp.repaint();</span>
<span class="nc" id="L96">   }</span>

   private void initBeginPoint(MouseEvent e)
   {
<span class="nc bnc" id="L100" title="All 4 branches missed.">      if (SwingUtilities.isLeftMouseButton(e) &amp;&amp; 0 == (e.getModifiers() &amp; MouseEvent.CTRL_MASK))</span>
      {
<span class="nc" id="L102">         _dragBeginPoint = e.getPoint();</span>
      }
<span class="nc" id="L104">   }</span>

   public void setRectangleSelectionListener(RectangleSelectionListener rectangleSelectionListener)
   {
<span class="nc" id="L108">      _rectangleSelectionListener = rectangleSelectionListener;</span>
<span class="nc" id="L109">   }</span>

   public static boolean rectHit(Rectangle bounds, Point p1, Point p2)
   {
<span class="nc" id="L113">      Rectangle selRect = new Rectangle(Math.min(p1.x, p2.x), Math.min(p1.y, p2.y), Math.abs(p1.x - p2.x), Math.abs(p1.y - p2.y));</span>
<span class="nc" id="L114">      return bounds.intersects(selRect);</span>
   }

   public void cancelCurrentSelection()
   {
<span class="nc" id="L119">      _cancelCurrentSelection = true;</span>
<span class="nc" id="L120">   }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>