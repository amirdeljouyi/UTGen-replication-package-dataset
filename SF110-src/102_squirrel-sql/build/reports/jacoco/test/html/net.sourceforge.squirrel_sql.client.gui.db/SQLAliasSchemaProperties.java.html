<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLAliasSchemaProperties.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.db</a> &gt; <span class="el_source">SQLAliasSchemaProperties.java</span></div><h1>SQLAliasSchemaProperties.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui.db;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Arrays;

<span class="nc" id="L7">public class SQLAliasSchemaProperties implements Serializable</span>
{
   private static final long serialVersionUID = 1L;

<span class="nc" id="L11">   SQLAliasSchemaDetailProperties[] _schemaDetails = </span>
       new SQLAliasSchemaDetailProperties[0];

   public static final int GLOBAL_STATE_LOAD_ALL_CACHE_NONE = 0;
   public static final int GLOBAL_STATE_LOAD_AND_CACHE_ALL = 1;
   public static final int GLOBAL_STATE_SPECIFY_SCHEMAS = 2;

<span class="nc" id="L18">   private int _globalState = GLOBAL_STATE_LOAD_ALL_CACHE_NONE;</span>
   private boolean _cacheSchemaIndependentMetaData;

   public SQLAliasSchemaDetailProperties[] getSchemaDetails()
   {
<span class="nc" id="L23">      return _schemaDetails;</span>
   }

   public void setSchemaDetails(SQLAliasSchemaDetailProperties[] schemaDetails)
   {
<span class="nc" id="L28">      _schemaDetails = schemaDetails;</span>
<span class="nc" id="L29">   }</span>


   public int getGlobalState()
   {
<span class="nc" id="L34">      return _globalState;</span>
   }

   public void setGlobalState(int globalState)
   {
<span class="nc" id="L39">      this._globalState = globalState;</span>
<span class="nc" id="L40">   }</span>


   public boolean isCacheSchemaIndependentMetaData()
   {
<span class="nc" id="L45">      return _cacheSchemaIndependentMetaData;</span>
   }

   public void setCacheSchemaIndependentMetaData(boolean b)
   {
<span class="nc" id="L50">      _cacheSchemaIndependentMetaData = b;</span>
<span class="nc" id="L51">   }</span>

   public boolean loadSchemaIndependentMetaData(SQLAliasSchemaProperties schemaPropsCacheIsBasedOn)
   {
<span class="nc bnc" id="L55" title="All 2 branches missed.">      if(null == schemaPropsCacheIsBasedOn)</span>
      {
<span class="nc" id="L57">         return true;</span>
      }

<span class="nc bnc" id="L60" title="All 4 branches missed.">      return !(schemaPropsCacheIsBasedOn._cacheSchemaIndependentMetaData &amp;&amp; _cacheSchemaIndependentMetaData);</span>

   }


   /**
    * @param schemaPropsCacheIsBasedOn null means that cache is not considered
    */
   public SchemaLoadInfo[] getSchemaLoadInfos(SQLAliasSchemaProperties schemaPropsCacheIsBasedOn,
                                              String[] tableTypes,
                                              String[] viewTypes)
   {
<span class="nc bnc" id="L72" title="All 2 branches missed.">      if(null == schemaPropsCacheIsBasedOn)</span>
      {
<span class="nc" id="L74">         return getSchemasToLoadDefault(tableTypes, viewTypes);</span>
      }

<span class="nc bnc" id="L77" title="All 4 branches missed.">      if(GLOBAL_STATE_LOAD_AND_CACHE_ALL == _globalState &amp;&amp;</span>
         GLOBAL_STATE_LOAD_AND_CACHE_ALL == schemaPropsCacheIsBasedOn._globalState)
      {
         // See also loadSchemaNames()
<span class="nc" id="L81">         return new SchemaLoadInfo[0];</span>
      }

<span class="nc bnc" id="L84" title="All 4 branches missed.">      if(GLOBAL_STATE_SPECIFY_SCHEMAS == _globalState &amp;&amp;</span>
         GLOBAL_STATE_SPECIFY_SCHEMAS == schemaPropsCacheIsBasedOn._globalState)
      {
<span class="nc" id="L87">         ArrayList&lt;SchemaLoadInfo&gt; ret = new ArrayList&lt;SchemaLoadInfo&gt;();</span>

<span class="nc bnc" id="L89" title="All 2 branches missed.">         for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
         {
<span class="nc" id="L91">            SQLAliasSchemaDetailProperties cachedDetailProp =</span>
<span class="nc" id="L92">               getMatchingDetail(_schemaDetails[i].getSchemaName(), schemaPropsCacheIsBasedOn._schemaDetails);</span>

<span class="nc" id="L94">            SchemaLoadInfo buf = new SchemaLoadInfo(addStringArrays(tableTypes, viewTypes));</span>
<span class="nc" id="L95">            buf.schemaName = _schemaDetails[i].getSchemaName();</span>

<span class="nc" id="L97">            ArrayList&lt;String&gt; tableTypesToLoad = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L99" title="All 4 branches missed.">            if(needsLoading(_schemaDetails[i].getTable(), null == cachedDetailProp ? null : cachedDetailProp.getTable()))</span>
            {
<span class="nc" id="L101">               tableTypesToLoad.addAll(Arrays.asList(tableTypes));</span>
            }

<span class="nc bnc" id="L104" title="All 4 branches missed.">            if(needsLoading(_schemaDetails[i].getView(), null == cachedDetailProp ? null : cachedDetailProp.getView()))</span>
            {
<span class="nc" id="L106">               tableTypesToLoad.addAll(Arrays.asList(viewTypes));</span>
            }

<span class="nc" id="L109">            buf.loadProcedures =</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">               needsLoading(_schemaDetails[i].getProcedure(), null == cachedDetailProp ? null : cachedDetailProp.getProcedure());</span>

<span class="nc bnc" id="L112" title="All 4 branches missed.">            if(0 &lt; tableTypesToLoad.size() || buf.loadProcedures)</span>
            {
<span class="nc" id="L114">               buf.tableTypes = tableTypesToLoad.toArray(new String[tableTypesToLoad.size()]);</span>
<span class="nc" id="L115">               ret.add(buf);</span>
            }
         }

<span class="nc" id="L119">         return ret.toArray(new SchemaLoadInfo[ret.size()]);</span>
      }

<span class="nc" id="L122">      return getSchemasToLoadDefault(tableTypes, viewTypes);</span>
   }

   /**
    * Returns SchemaLoadInfos as if there was no cache.
    */
   private SchemaLoadInfo[] getSchemasToLoadDefault(String[] tableTypes, String[] viewTypes)
   {
<span class="nc bnc" id="L130" title="All 4 branches missed.">      if(GLOBAL_STATE_LOAD_ALL_CACHE_NONE == _globalState ||</span>
         GLOBAL_STATE_LOAD_AND_CACHE_ALL== _globalState)
      {
         // Means load all Schemas from database.
<span class="nc" id="L134">         return new SchemaLoadInfo[]{new SchemaLoadInfo(addStringArrays(tableTypes, viewTypes))};</span>

      }
<span class="nc bnc" id="L137" title="All 2 branches missed.">      else if(SQLAliasSchemaProperties.GLOBAL_STATE_SPECIFY_SCHEMAS == _globalState)</span>
      {
<span class="nc" id="L139">         ArrayList&lt;SchemaLoadInfo&gt; schemaLoadInfos = </span>
             new ArrayList&lt;SchemaLoadInfo&gt;();

<span class="nc bnc" id="L142" title="All 2 branches missed.">         for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
         {
<span class="nc bnc" id="L144" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getTable() &amp;&amp;</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getView() &amp;&amp;</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getProcedure())</span>
            {
<span class="nc" id="L148">               continue;</span>
            }

<span class="nc" id="L151">            SchemaLoadInfo schemaLoadInfo = new SchemaLoadInfo(addStringArrays(tableTypes, viewTypes));</span>
<span class="nc" id="L152">            schemaLoadInfo.schemaName = _schemaDetails[i].getSchemaName();</span>
<span class="nc" id="L153">            schemaLoadInfo.tableTypes = new String[0];</span>

<span class="nc bnc" id="L155" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD !=_schemaDetails[i].getTable())</span>
            {
<span class="nc" id="L157">               schemaLoadInfo.tableTypes = addStringArrays(schemaLoadInfo.tableTypes, tableTypes);</span>
            }

<span class="nc bnc" id="L160" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD !=_schemaDetails[i].getView())</span>
            {
<span class="nc" id="L162">               schemaLoadInfo.tableTypes = addStringArrays(schemaLoadInfo.tableTypes, viewTypes);</span>
            }

<span class="nc bnc" id="L165" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD !=_schemaDetails[i].getProcedure())</span>
            {
<span class="nc" id="L167">               schemaLoadInfo.loadProcedures = true;</span>
            }
            else
            {
<span class="nc" id="L171">               schemaLoadInfo.loadProcedures = false;</span>

            }

<span class="nc" id="L175">            schemaLoadInfos.add(schemaLoadInfo);</span>
         }

<span class="nc" id="L178">         return schemaLoadInfos.toArray(new SchemaLoadInfo[schemaLoadInfos.size()]);</span>
      }
      else
      {
<span class="nc" id="L182">         throw new IllegalStateException(&quot;Undefined global state &quot; + _globalState);</span>
      }
   }


   private String[] addStringArrays(String[] tableTypes, String[] viewTypes)
   {
<span class="nc" id="L189">      ArrayList&lt;String&gt; ret = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L190">      ret.addAll(Arrays.asList(tableTypes));</span>
<span class="nc" id="L191">      ret.addAll(Arrays.asList(viewTypes));</span>

<span class="nc" id="L193">      return ret.toArray(new String[ret.size()]);</span>
   }

   private boolean needsLoading(int loadingID, Integer cachedLoadingID)
   {
<span class="nc bnc" id="L198" title="All 2 branches missed.">      if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD == loadingID)</span>
      {
         // current Schema says don't load
<span class="nc" id="L201">         return false;</span>
      }
<span class="nc bnc" id="L203" title="All 4 branches missed.">      else if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE == loadingID &amp;&amp;</span>
              null != cachedLoadingID &amp;&amp;
<span class="nc bnc" id="L205" title="All 2 branches missed.">              SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE == cachedLoadingID.intValue())</span>
      {
<span class="nc" id="L207">         return false;</span>
      }

<span class="nc" id="L210">      return true;</span>
   }

   private SQLAliasSchemaDetailProperties getMatchingDetail(String schemaName, SQLAliasSchemaDetailProperties[] schemaDetails)
   {
<span class="nc bnc" id="L215" title="All 2 branches missed.">      for (int i = 0; i &lt; schemaDetails.length; i++)</span>
      {
<span class="nc bnc" id="L217" title="All 2 branches missed.">         if(schemaDetails[i].getSchemaName().equals(schemaName))</span>
         {
<span class="nc" id="L219">            return schemaDetails[i];</span>
         }
      }

<span class="nc" id="L223">      return null;</span>

   }

   public SchemaTableTypeCombination[] getAllSchemaTableTypeCombinationsNotToBeCached(String[] tableTypes, String[] viewTypes)
   {
<span class="nc" id="L229">      ArrayList&lt;SchemaTableTypeCombination&gt; ret = </span>
          new ArrayList&lt;SchemaTableTypeCombination&gt;();

<span class="nc bnc" id="L232" title="All 2 branches missed.">      for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
      {
<span class="nc bnc" id="L234" title="All 2 branches missed.">         if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE != _schemaDetails[i].getTable())</span>
         {
<span class="nc" id="L236">            SchemaTableTypeCombination buf = new SchemaTableTypeCombination();</span>
<span class="nc" id="L237">            buf.schemaName = _schemaDetails[i].getSchemaName();</span>
<span class="nc" id="L238">            buf.types = tableTypes;</span>
<span class="nc" id="L239">            ret.add(buf);</span>
         }

<span class="nc bnc" id="L242" title="All 2 branches missed.">         if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE != _schemaDetails[i].getView())</span>
         {
<span class="nc" id="L244">            SchemaTableTypeCombination buf = new SchemaTableTypeCombination();</span>
<span class="nc" id="L245">            buf.schemaName = _schemaDetails[i].getSchemaName();</span>
<span class="nc" id="L246">            buf.types = viewTypes;</span>
<span class="nc" id="L247">            ret.add(buf);</span>
         }
      }

<span class="nc" id="L251">      return ret.toArray(new SchemaTableTypeCombination[ret.size()]);</span>
   }

   public String[] getAllSchemaProceduresNotToBeCached()
   {
<span class="nc" id="L256">      ArrayList&lt;String&gt; ret = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L258" title="All 2 branches missed.">      for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
      {
<span class="nc bnc" id="L260" title="All 2 branches missed.">         if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE != _schemaDetails[i].getProcedure())</span>
         {
<span class="nc" id="L262">            ret.add(_schemaDetails[i].getSchemaName());</span>
         }

      }

<span class="nc" id="L267">      return ret.toArray(new String[ret.size()]);</span>
   }

   public boolean getExpectsSomeCachedData()
   {
<span class="nc bnc" id="L272" title="All 4 branches missed.">      if(_cacheSchemaIndependentMetaData || GLOBAL_STATE_LOAD_AND_CACHE_ALL == _globalState)</span>
      {
<span class="nc" id="L274">         return true;</span>
      }

<span class="nc bnc" id="L277" title="All 2 branches missed.">      if(GLOBAL_STATE_SPECIFY_SCHEMAS == _globalState)</span>
      {
         // Note: If we are here _cacheSchemaIndependentMetaData must be false

<span class="nc bnc" id="L281" title="All 2 branches missed.">         for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
         {
<span class="nc bnc" id="L283" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE ==_schemaDetails[i].getTable() ||</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE ==_schemaDetails[i].getView() ||</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_LOAD_AND_CACHE ==_schemaDetails[i].getProcedure())</span>
            {
<span class="nc" id="L287">               return true;</span>
            }
         }
      }

<span class="nc" id="L292">      return false;</span>
   }

   public boolean loadSchemaNames(SQLAliasSchemaProperties schemaPropsCacheIsBasedOn)
   {
<span class="nc bnc" id="L297" title="All 4 branches missed.">      if(GLOBAL_STATE_LOAD_AND_CACHE_ALL == _globalState &amp;&amp;</span>
         GLOBAL_STATE_LOAD_AND_CACHE_ALL == schemaPropsCacheIsBasedOn._globalState)
      {
<span class="nc" id="L300">         return true;</span>
      }
      else
      {
<span class="nc" id="L304">         return false;</span>
      }
   }


   public SchemaNameLoadInfo getSchemaNameLoadInfo(SQLAliasSchemaProperties schemaPropsCacheIsBasedOn)
   {
<span class="nc" id="L311">      SchemaNameLoadInfo ret = new SchemaNameLoadInfo();</span>

<span class="nc bnc" id="L313" title="All 6 branches missed.">      if(GLOBAL_STATE_LOAD_AND_CACHE_ALL == _globalState &amp;&amp;</span>
         null != schemaPropsCacheIsBasedOn &amp;&amp;
         GLOBAL_STATE_LOAD_AND_CACHE_ALL == schemaPropsCacheIsBasedOn._globalState)
      {
<span class="nc" id="L317">         ret.state = SchemaNameLoadInfo.STATE_DONT_REFERESH_SCHEMA_NAMES;</span>
      }
<span class="nc bnc" id="L319" title="All 2 branches missed.">      else if(GLOBAL_STATE_SPECIFY_SCHEMAS == _globalState)</span>
      {
<span class="nc" id="L321">         ArrayList&lt;String&gt; schemaNames = new ArrayList&lt;String&gt;();</span>

<span class="nc" id="L323">         ret.state = SchemaNameLoadInfo.STATE_USES_PROVIDED_SCHEMA_NAMES;</span>

<span class="nc bnc" id="L325" title="All 2 branches missed.">         for (int i = 0; i &lt; _schemaDetails.length; i++)</span>
         {
<span class="nc bnc" id="L327" title="All 2 branches missed.">            if(SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getTable() &amp;&amp;</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getView() &amp;&amp;</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">               SQLAliasSchemaDetailProperties.SCHEMA_LOADING_ID_DONT_LOAD ==_schemaDetails[i].getProcedure())</span>
            {
<span class="nc" id="L331">               continue;</span>
            }

<span class="nc" id="L334">            schemaNames.add(_schemaDetails[i].getSchemaName());</span>
         }

<span class="nc" id="L337">         ret.schemaNames = schemaNames.toArray(new String[schemaNames.size()]);</span>
<span class="nc" id="L338">      }</span>
      else
      {
<span class="nc" id="L341">         ret.state = SchemaNameLoadInfo.STATE_REFERESH_SCHEMA_NAMES_FROM_DB;</span>
      }

<span class="nc" id="L344">      return ret;</span>
   }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>