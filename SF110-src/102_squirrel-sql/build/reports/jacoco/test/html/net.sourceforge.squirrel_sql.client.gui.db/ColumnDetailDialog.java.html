<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ColumnDetailDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.db</a> &gt; <span class="el_source">ColumnDetailDialog.java</span></div><h1>ColumnDetailDialog.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2006 Rob Manning
 * manningr@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */

package net.sourceforge.squirrel_sql.client.gui.db;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.ComponentEvent;
import java.awt.event.ComponentListener;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.sql.DatabaseMetaData;

import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JComboBox;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSpinner;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.SpinnerNumberModel;
import javax.swing.SwingConstants;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;
import javax.swing.border.LineBorder;

import net.sourceforge.squirrel_sql.client.ApplicationArguments;
import net.sourceforge.squirrel_sql.fw.dialects.DialectFactory;
import net.sourceforge.squirrel_sql.fw.dialects.HibernateDialect;
import net.sourceforge.squirrel_sql.fw.sql.JDBCTypeMapper;
import net.sourceforge.squirrel_sql.fw.sql.TableColumnInfo;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

/**
 * A dialog that can be used to get column info from the user for adding new 
 * columns or modifying existing ones.
 */
public class ColumnDetailDialog extends JDialog implements IDisposableDialog {

    private static final long serialVersionUID = 1L;

    /** Internationalized strings for this class. */
<span class="nc" id="L72">    private static final StringManager s_stringMgr =</span>
<span class="nc" id="L73">        StringManagerFactory.getStringManager(ColumnDetailDialog.class);</span>
    
<span class="nc" id="L75">    private JLabel tableNameLabel = null;</span>
<span class="nc" id="L76">    private JTextField tableNameTextField = null;</span>
<span class="nc" id="L77">    private JLabel columnNameLabel = null;</span>
<span class="nc" id="L78">    private JTextField columnNameTextField = null;</span>
<span class="nc" id="L79">    private JLabel dialectLabel = null;</span>
<span class="nc" id="L80">    private JComboBox dialectList = null;</span>
<span class="nc" id="L81">    private JLabel typeLabel = null;</span>
<span class="nc" id="L82">    private JComboBox typeList = null;</span>
<span class="nc" id="L83">    private JLabel lengthLabel = null;</span>
<span class="nc" id="L84">    private JSpinner lengthSpinner = null;</span>
<span class="nc" id="L85">    private JLabel precisionLabel = null;</span>
<span class="nc" id="L86">    private JSpinner precisionSpinner = null;</span>
<span class="nc" id="L87">    private JLabel scaleLabel = null;</span>
<span class="nc" id="L88">    private JSpinner scaleSpinner = null;</span>
<span class="nc" id="L89">    private JLabel defaultLabel = null;</span>
<span class="nc" id="L90">    private JTextField defaultTextField = null;</span>
<span class="nc" id="L91">    private JLabel commentLabel = null;</span>
<span class="nc" id="L92">    private JTextArea commentTextArea = null;</span>
<span class="nc" id="L93">    private JLabel nullableLabel = null;</span>
<span class="nc" id="L94">    private JCheckBox nullableCheckBox = null;    </span>
    
<span class="nc" id="L96">    private JButton executeButton = null;</span>
<span class="nc" id="L97">    private JButton editSQLButton = null;</span>
<span class="nc" id="L98">    private JButton showSQLButton = null;</span>
<span class="nc" id="L99">    private JButton cancelButton = null;</span>
    
    public static final int ADD_MODE = 0;
    public static final int MODIFY_MODE = 1;
    
<span class="nc" id="L104">    private int _mode = ADD_MODE;</span>
    
    private interface i18n {
        //i18n[ColumnDetailsDialog.editButtonLabel=Edit SQL]        
        String EDIT_BUTTON_LABEL = 
<span class="nc" id="L109">            s_stringMgr.getString(&quot;ColumnDetailsDialog.editButtonLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.executeButtonLabel=Execute]
        String EXECUTE_BUTTON_LABEL = 
<span class="nc" id="L112">            s_stringMgr.getString(&quot;ColumnDetailsDialog.executeButtonLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.addColumnTitle=Add Column]
        String ADD_COLUMN_TITLE = 
<span class="nc" id="L115">            s_stringMgr.getString(&quot;ColumnDetailsDialog.addColumnTitle&quot;);  </span>
        //i18n[ColumnDetailsDialog.modifyColumnTitle=Modify Column]
        String MODIFY_COLUMN_TITLE = 
<span class="nc" id="L118">            s_stringMgr.getString(&quot;ColumnDetailsDialog.modifyColumnTitle&quot;);</span>
        //i18n[ColumnDetailsDialog.cancelButtonLabel=Cancel]
        String CANCEL_BUTTON_LABEL = 
<span class="nc" id="L121">            s_stringMgr.getString(&quot;ColumnDetailsDialog.cancelButtonLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.columnNameLabel=Column Name: ]
        String COLUMN_NAME_LABEL=
<span class="nc" id="L124">            s_stringMgr.getString(&quot;ColumnDetailsDialog.columnNameLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.commentLabel=Comment: ]        
        String COMMENT_LABEL = 
<span class="nc" id="L127">            s_stringMgr.getString(&quot;ColumnDetailsDialog.commentLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.defaultValueLabel=Default Value: ]
        String DEFAULT_VALUE_LABEL = 
<span class="nc" id="L130">            s_stringMgr.getString(&quot;ColumnDetailsDialog.defaultValueLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.dialectLabel=Dialect: ]
        String DIALECT_LABEL = 
<span class="nc" id="L133">            s_stringMgr.getString(&quot;ColumnDetailsDialog.dialectLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.lengthLabel=Length: ]
        String LENGTH_LABEL = 
<span class="nc" id="L136">            s_stringMgr.getString(&quot;ColumnDetailsDialog.lengthLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.nullableLabel=Nullable: ]
        String NULLABLE_LABEL = 
<span class="nc" id="L139">            s_stringMgr.getString(&quot;ColumnDetailsDialog.nullableLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.newColumnValue=NewColumn]
        String NEW_COLUMN_VALUE = 
<span class="nc" id="L142">            s_stringMgr.getString(&quot;ColumnDetailsDialog.newColumnValue&quot;);</span>
        //i18n[ColumnDetailsDialog.precisionLabel=Precision: ]
        String PRECISION_LABEL = 
<span class="nc" id="L145">            s_stringMgr.getString(&quot;ColumnDetailsDialog.precisionLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.scaleLabel=Scale: ]
        String SCALE_LABEL = 
<span class="nc" id="L148">            s_stringMgr.getString(&quot;ColumnDetailsDialog.scaleLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.showButtonLabel=Show SQL]
        String SHOW_BUTTON_LABEL = 
<span class="nc" id="L151">            s_stringMgr.getString(&quot;ColumnDetailsDialog.showButtonLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.tableNameLabel=Table Name: ]
        String TABLE_NAME_LABEL = 
<span class="nc" id="L154">            s_stringMgr.getString(&quot;ColumnDetailsDialog.tableNameLabel&quot;);</span>
        //i18n[ColumnDetailsDialog.typeLabel=Type: ]
<span class="nc" id="L156">        String TYPE_LABEL =</span>
<span class="nc" id="L157">            s_stringMgr.getString(&quot;ColumnDetailsDialog.typeLabel&quot;);</span>
    }
    
    /**
     * 
     * @param tableName
     */
<span class="nc" id="L164">    public ColumnDetailDialog(int mode) {</span>
<span class="nc" id="L165">        setMode(mode);</span>
<span class="nc" id="L166">        init();</span>
<span class="nc" id="L167">    }</span>
    
    public void setMode(int mode) {
<span class="nc bnc" id="L170" title="All 4 branches missed.">        if (mode != ADD_MODE &amp;&amp; mode != MODIFY_MODE) {</span>
<span class="nc" id="L171">            throw new IllegalArgumentException(&quot;Invalid mode - &quot;+mode);</span>
        }
<span class="nc" id="L173">        _mode = mode;</span>
<span class="nc" id="L174">    }</span>
    
    /**
     * 
     * @param dbName
     */
    public void setSelectedDialect(String dbName) {
<span class="nc" id="L181">        dialectList.setSelectedItem(dbName);</span>
<span class="nc" id="L182">    }</span>
    
    public String getSelectedDBName() {
<span class="nc" id="L185">        return (String)dialectList.getSelectedItem();</span>
    }
    
    public void setTableName(String tableName) {
<span class="nc" id="L189">        tableNameTextField.setText(tableName);</span>
<span class="nc" id="L190">    }</span>
    
    public String getTableName() {
<span class="nc" id="L193">        return tableNameTextField.getText();</span>
    }
    
    public void setExistingColumnInfo(TableColumnInfo info) {
<span class="nc" id="L197">        tableNameTextField.setText(info.getTableName());</span>
<span class="nc" id="L198">        columnNameTextField.setText(info.getColumnName());</span>
<span class="nc" id="L199">        String dataType = JDBCTypeMapper.getJdbcTypeName(info.getDataType());</span>
<span class="nc" id="L200">        typeList.setSelectedItem(dataType);</span>
<span class="nc" id="L201">        nullableCheckBox.setSelected(info.isNullable().equals(&quot;YES&quot;));</span>
        
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if (JDBCTypeMapper.isNumberType(info.getDataType())) {</span>
<span class="nc" id="L204">            precisionSpinner.setValue(Integer.valueOf(info.getColumnSize()));</span>
        } else {
<span class="nc" id="L206">            lengthSpinner.setValue(Integer.valueOf(info.getColumnSize()));</span>
        }   
<span class="nc" id="L208">        commentTextArea.setText(info.getRemarks());</span>
<span class="nc" id="L209">        defaultTextField.setText(info.getDefaultValue());</span>
<span class="nc" id="L210">    }</span>
    
    public String getSelectedTypeName() {
<span class="nc" id="L213">        return (String)typeList.getSelectedItem();</span>
    }
    
    /**
     * Returns a TableColumnInfo representation of the user's settings for the
     * column.
     *  
     * @return 
     */
    public TableColumnInfo getColumnInfo() {
<span class="nc" id="L223">        String tableName = tableNameTextField.getText();</span>
<span class="nc" id="L224">        String columnName = columnNameTextField.getText();</span>
<span class="nc" id="L225">        String typeName = (String)typeList.getSelectedItem();</span>
<span class="nc" id="L226">        int dataType = JDBCTypeMapper.getJdbcType(typeName);</span>
        
<span class="nc" id="L228">        SpinnerNumberModel sizeModel = null;</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">        if (JDBCTypeMapper.isNumberType(dataType)) {</span>
<span class="nc" id="L230">            sizeModel = (SpinnerNumberModel)precisionSpinner.getModel();</span>
        } else {
<span class="nc" id="L232">            sizeModel = (SpinnerNumberModel)lengthSpinner.getModel();</span>
        }   
<span class="nc" id="L234">        int columnSize = sizeModel.getNumber().intValue();</span>
<span class="nc" id="L235">        SpinnerNumberModel scaleModel = </span>
<span class="nc" id="L236">            (SpinnerNumberModel)scaleSpinner.getModel();</span>
<span class="nc" id="L237">        int decimalDigits = scaleModel.getNumber().intValue();</span>
        
<span class="nc" id="L239">        int isNullAllowed = 1;</span>
<span class="nc" id="L240">        String isNullable = null;</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">        if (nullableCheckBox.isSelected()) {</span>
<span class="nc" id="L242">            isNullAllowed = DatabaseMetaData.columnNullable;</span>
<span class="nc" id="L243">            isNullable = &quot;YES&quot;;</span>
        } else {
<span class="nc" id="L245">            isNullAllowed = DatabaseMetaData.columnNoNulls;</span>
<span class="nc" id="L246">            isNullable = &quot;NO&quot;;</span>
        }
<span class="nc" id="L248">        String remarks = null;</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (commentTextArea.isEditable()) {</span>
<span class="nc" id="L250">            remarks = commentTextArea.getText();</span>
        }
<span class="nc" id="L252">        String defaultValue = defaultTextField.getText();</span>
        // TODO Maybe we should have a checkbox to allow the user to toggle 
        // default value on/off.  Some dbs (like DB2) treat empty string &quot;&quot; as
        // a different default value than null.
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (&quot;&quot;.equals(defaultValue)) {</span>
<span class="nc" id="L257">            defaultValue = null;</span>
        }
        
        // These are not used
<span class="nc" id="L261">        String catalog = null;</span>
<span class="nc" id="L262">        String schema = null;</span>
<span class="nc" id="L263">        int octetLength = 1;</span>
<span class="nc" id="L264">        int ordinalPosition = 1;</span>
<span class="nc" id="L265">        int radix = 1;</span>
        
<span class="nc" id="L267">        TableColumnInfo result = </span>
            new TableColumnInfo(catalog, 
                                schema,
                                tableName,
                                columnName,
                                dataType,
                                typeName,
                                columnSize,
                                decimalDigits,
                                radix,
                                isNullAllowed,
                                remarks,
                                defaultValue,
                                octetLength,
                                ordinalPosition,
                                isNullable
                                );
<span class="nc" id="L284">        return result;</span>
    }
    
    public void addExecuteListener(ActionListener listener) {
<span class="nc" id="L288">        executeButton.addActionListener(listener);</span>
<span class="nc" id="L289">    }</span>

    public void addEditSQLListener(ActionListener listener) {
<span class="nc" id="L292">        editSQLButton.addActionListener(listener);</span>
<span class="nc" id="L293">    }</span>

    public void addShowSQLListener(ActionListener listener) {
<span class="nc" id="L296">        showSQLButton.addActionListener(listener);</span>
<span class="nc" id="L297">    }</span>
    
    public void addDialectListListener(ItemListener listener) {
<span class="nc" id="L300">        dialectList.addItemListener(listener);</span>
<span class="nc" id="L301">    }</span>

    public void setVisible(boolean visible) {
<span class="nc" id="L304">        super.setVisible(visible);</span>
<span class="nc" id="L305">        columnNameTextField.requestFocus();</span>
<span class="nc" id="L306">        columnNameTextField.select(0, columnNameTextField.getText().length());                </span>
<span class="nc" id="L307">    }</span>
    
    private GridBagConstraints getLabelConstraints(GridBagConstraints c) {
<span class="nc" id="L310">        c.gridx = 0;</span>
<span class="nc" id="L311">        c.gridy++;                </span>
<span class="nc" id="L312">        c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L313">        c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L314">        c.weightx = 0;</span>
<span class="nc" id="L315">        c.weighty = 0;</span>
<span class="nc" id="L316">        return c;</span>
    }
    
    private GridBagConstraints getFieldConstraints(GridBagConstraints c) {
<span class="nc" id="L320">        c.gridx++;</span>
<span class="nc" id="L321">        c.anchor = GridBagConstraints.WEST;   </span>
<span class="nc" id="L322">        c.weightx = 1;</span>
<span class="nc" id="L323">        c.weighty = 1;</span>
<span class="nc" id="L324">        c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L325">        return c;</span>
    }

    private JLabel getBorderedLabel(String text, Border border) {
<span class="nc" id="L329">        JLabel result = new JLabel(text);</span>
<span class="nc" id="L330">        result.setBorder(border);</span>
<span class="nc" id="L331">        result.setPreferredSize(new Dimension(115, 20));</span>
<span class="nc" id="L332">        result.setHorizontalAlignment(SwingConstants.RIGHT);</span>
<span class="nc" id="L333">        return result;</span>
    }
    
    private JTextField getSizedTextField(Dimension mediumField) {
<span class="nc" id="L337">        JTextField result = new JTextField();</span>
<span class="nc" id="L338">        result.setPreferredSize(mediumField);</span>
<span class="nc" id="L339">        return result;</span>
    }
    
    /**
     * Creates the UI for this dialog.
     */
    private void init() {
<span class="nc" id="L346">        super.setModal(true);</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">        if (_mode == ADD_MODE) {</span>
<span class="nc" id="L348">            setTitle(i18n.ADD_COLUMN_TITLE);</span>
        } else {
<span class="nc" id="L350">            setTitle(i18n.MODIFY_COLUMN_TITLE);</span>
        }
        
<span class="nc" id="L353">        setSize(375, 400);</span>
<span class="nc" id="L354">        EmptyBorder border = new EmptyBorder(new Insets(5,5,5,5));</span>
<span class="nc" id="L355">        Dimension mediumField = new Dimension(126, 20);</span>
<span class="nc" id="L356">        Dimension largeField = new Dimension(126, 60);</span>
        
<span class="nc" id="L358">        JPanel pane = new JPanel();</span>
<span class="nc" id="L359">        pane.setLayout(new GridBagLayout());</span>
<span class="nc" id="L360">        pane.setBorder(new EmptyBorder(0,0,0,10));</span>

<span class="nc" id="L362">        GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L363">        c.gridx = 0;</span>
<span class="nc" id="L364">        c.gridy = -1;</span>

        // Table name
<span class="nc" id="L367">        tableNameLabel = getBorderedLabel(i18n.TABLE_NAME_LABEL, border);</span>
<span class="nc" id="L368">        pane.add(tableNameLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L370">        tableNameTextField = new JTextField();</span>
<span class="nc" id="L371">        tableNameTextField.setPreferredSize(mediumField);</span>
<span class="nc" id="L372">        tableNameTextField.setEditable(false);</span>
<span class="nc" id="L373">        pane.add(tableNameTextField, getFieldConstraints(c));</span>
        
        // Column name
<span class="nc" id="L376">        columnNameLabel = getBorderedLabel(i18n.COLUMN_NAME_LABEL, border);</span>
<span class="nc" id="L377">        pane.add(columnNameLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L379">        columnNameTextField = getSizedTextField(mediumField);</span>
<span class="nc" id="L380">        columnNameTextField.setText(i18n.NEW_COLUMN_VALUE);</span>
<span class="nc" id="L381">        columnNameTextField.addKeyListener(new KeyAdapter() {</span>
            public void keyTyped(KeyEvent e) {
<span class="nc bnc" id="L383" title="All 2 branches missed.">                if (columnNameTextField.getText().length() == 0) {</span>
<span class="nc" id="L384">                    executeButton.setEnabled(false);</span>
<span class="nc" id="L385">                    showSQLButton.setEnabled(false);</span>
                } else {
<span class="nc" id="L387">                    executeButton.setEnabled(true);</span>
<span class="nc" id="L388">                    showSQLButton.setEnabled(true);</span>
                }
<span class="nc" id="L390">            }</span>
        });
<span class="nc" id="L392">        pane.add(columnNameTextField, getFieldConstraints(c));</span>
        
        // Dialect list
<span class="nc" id="L395">        dialectLabel = getBorderedLabel(i18n.DIALECT_LABEL, border);</span>
<span class="nc" id="L396">        pane.add(dialectLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L398">        Object[] dbNames = DialectFactory.getDbNames();</span>
<span class="nc" id="L399">        dialectList = new JComboBox(dbNames);</span>
<span class="nc" id="L400">        dialectList.setPreferredSize(mediumField);</span>
<span class="nc" id="L401">        dialectList.addItemListener(new DialectTypeListListener());</span>
<span class="nc" id="L402">        pane.add(dialectList, getFieldConstraints(c));        </span>
        
        // Type list
<span class="nc" id="L405">        typeLabel = getBorderedLabel(i18n.TYPE_LABEL, border);</span>
<span class="nc" id="L406">        pane.add(typeLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L408">        String[] jdbcTypes = JDBCTypeMapper.getJdbcTypeList();</span>
<span class="nc" id="L409">        typeList = new JComboBox(jdbcTypes);</span>
<span class="nc" id="L410">        typeList.addItemListener(new ColumnTypeListListener());</span>
<span class="nc" id="L411">        typeList.setPreferredSize(mediumField);</span>
<span class="nc" id="L412">        pane.add(typeList, getFieldConstraints(c));</span>
        
        // Length
<span class="nc" id="L415">        lengthLabel = getBorderedLabel(i18n.LENGTH_LABEL, border);</span>
<span class="nc" id="L416">        pane.add(lengthLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L418">        lengthSpinner = new JSpinner();</span>
<span class="nc" id="L419">        lengthSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L420">        int value = 10; </span>
<span class="nc" id="L421">        int min = 1;</span>
<span class="nc" id="L422">        int max = Integer.MAX_VALUE; </span>
<span class="nc" id="L423">        int step = 1; </span>
<span class="nc" id="L424">        SpinnerNumberModel model = new SpinnerNumberModel(value, min, max, step);</span>
<span class="nc" id="L425">        lengthSpinner.setModel(model);</span>
<span class="nc" id="L426">        lengthSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L427">        pane.add(lengthSpinner, getFieldConstraints(c));</span>
        
<span class="nc" id="L429">        precisionLabel = new JLabel(i18n.PRECISION_LABEL);</span>
<span class="nc" id="L430">        precisionLabel.setBorder(border);</span>
<span class="nc" id="L431">        pane.add(precisionLabel, getLabelConstraints(c));</span>

        // Precision
<span class="nc" id="L434">        precisionSpinner = new JSpinner();</span>
<span class="nc" id="L435">        precisionSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L436">        value = 8; </span>
<span class="nc" id="L437">        min = 0;</span>
<span class="nc" id="L438">        max = Integer.MAX_VALUE;</span>
<span class="nc" id="L439">        step = 1; </span>
<span class="nc" id="L440">        SpinnerNumberModel precisionModel = </span>
            new SpinnerNumberModel(value, min, max, step); 
<span class="nc" id="L442">        precisionSpinner.setModel(precisionModel);</span>
<span class="nc" id="L443">        precisionSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L444">        pane.add(precisionSpinner, getFieldConstraints(c));        </span>

        // Scale
<span class="nc" id="L447">        scaleLabel = new JLabel(i18n.SCALE_LABEL);</span>
<span class="nc" id="L448">        scaleLabel.setBorder(border);</span>
<span class="nc" id="L449">        pane.add(scaleLabel, getLabelConstraints(c));</span>

<span class="nc" id="L451">        scaleSpinner = new JSpinner();</span>
<span class="nc" id="L452">        scaleSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L453">        value = 8; </span>
<span class="nc" id="L454">        min = 0;</span>
<span class="nc" id="L455">        max = Integer.MAX_VALUE;</span>
<span class="nc" id="L456">        step = 1; </span>
<span class="nc" id="L457">        SpinnerNumberModel scaleModel = </span>
            new SpinnerNumberModel(value, min, max, step); 
<span class="nc" id="L459">        scaleSpinner.setModel(scaleModel);</span>
<span class="nc" id="L460">        scaleSpinner.setPreferredSize(mediumField);</span>
<span class="nc" id="L461">        pane.add(scaleSpinner, getFieldConstraints(c));        </span>
        
        // Default value
<span class="nc" id="L464">        defaultLabel = new JLabel(i18n.DEFAULT_VALUE_LABEL);</span>
<span class="nc" id="L465">        defaultLabel.setBorder(border);</span>
<span class="nc" id="L466">        pane.add(defaultLabel, getLabelConstraints(c));</span>
        
<span class="nc" id="L468">        defaultTextField = new JTextField();</span>
<span class="nc" id="L469">        defaultTextField.setPreferredSize(mediumField);</span>
<span class="nc" id="L470">        pane.add(defaultTextField, getFieldConstraints(c));</span>

        // Nullable
<span class="nc" id="L473">        nullableLabel = new JLabel(i18n.NULLABLE_LABEL);</span>
<span class="nc" id="L474">        nullableLabel.setBorder(border);</span>
<span class="nc" id="L475">        pane.add(nullableLabel, getLabelConstraints(c));        </span>
        
<span class="nc" id="L477">        nullableCheckBox = new JCheckBox(&quot;&quot;);</span>
<span class="nc" id="L478">        nullableCheckBox.setSelected(true);</span>
<span class="nc" id="L479">        pane.add(nullableCheckBox, getFieldConstraints(c));</span>
        
        // Comment
<span class="nc" id="L482">        commentLabel = new JLabel(i18n.COMMENT_LABEL);</span>
<span class="nc" id="L483">        commentLabel.setBorder(border);</span>
<span class="nc" id="L484">        pane.add(commentLabel, getLabelConstraints(c));                </span>
        
<span class="nc" id="L486">        commentTextArea = new JTextArea();</span>
<span class="nc" id="L487">        commentTextArea.setBorder(new LineBorder(Color.DARK_GRAY, 1));</span>
<span class="nc" id="L488">        commentTextArea.setLineWrap(true);</span>
<span class="nc" id="L489">        c = getFieldConstraints(c);</span>
<span class="nc" id="L490">        c.weightx = 2;</span>
<span class="nc" id="L491">        c.weighty = 2;</span>
<span class="nc" id="L492">        c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L493">        JScrollPane scrollPane = new JScrollPane(); </span>
<span class="nc" id="L494">        scrollPane.getViewport().add(commentTextArea);</span>
<span class="nc" id="L495">        scrollPane.setPreferredSize(largeField);</span>
<span class="nc" id="L496">        pane.add(scrollPane, c);        </span>
        
<span class="nc" id="L498">        Container contentPane = super.getContentPane();</span>
<span class="nc" id="L499">        contentPane.setLayout(new BorderLayout());</span>
<span class="nc" id="L500">        contentPane.add(pane, BorderLayout.CENTER);</span>
        
<span class="nc" id="L502">        contentPane.add(getButtonPanel(), BorderLayout.SOUTH);</span>
                
<span class="nc" id="L504">    }</span>
    
    private JPanel getButtonPanel() {
<span class="nc" id="L507">        JPanel result = new JPanel();</span>
<span class="nc" id="L508">        executeButton = new JButton(i18n.EXECUTE_BUTTON_LABEL);</span>

<span class="nc" id="L510">        editSQLButton = new JButton(i18n.EDIT_BUTTON_LABEL);</span>
<span class="nc" id="L511">        showSQLButton = new JButton(i18n.SHOW_BUTTON_LABEL);</span>
<span class="nc" id="L512">        cancelButton = new JButton(i18n.CANCEL_BUTTON_LABEL);</span>
<span class="nc" id="L513">        cancelButton.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L515">                setVisible(false);</span>
<span class="nc" id="L516">            }</span>
        });
<span class="nc" id="L518">        result.add(executeButton);</span>
<span class="nc" id="L519">        result.add(editSQLButton);</span>
<span class="nc" id="L520">        result.add(showSQLButton);</span>
<span class="nc" id="L521">        result.add(cancelButton);</span>
<span class="nc" id="L522">        return result;</span>
    }
    
    /**
     * @param args
     */
    public static void main(String[] args) {
<span class="nc" id="L529">        ApplicationArguments.initialize(new String[] {});</span>
<span class="nc" id="L530">        final ColumnDetailDialog c = new ColumnDetailDialog(ADD_MODE);</span>
<span class="nc" id="L531">        c.setTableName(&quot;FooTable&quot;);</span>
<span class="nc" id="L532">        c.addComponentListener(new ComponentListener() {</span>
<span class="nc" id="L533">            public void componentHidden(ComponentEvent e) {}</span>
<span class="nc" id="L534">            public void componentMoved(ComponentEvent e) {}</span>
            public void componentResized(ComponentEvent e) {
<span class="nc" id="L536">                System.out.println(&quot;Current size = &quot;+c.getSize());</span>
<span class="nc" id="L537">            }</span>
<span class="nc" id="L538">            public void componentShown(ComponentEvent e) {}            </span>
        });
<span class="nc" id="L540">        c.cancelButton.addActionListener(new ActionListener() {</span>
            public void actionPerformed(ActionEvent e) {
<span class="nc" id="L542">                System.exit(1);</span>
<span class="nc" id="L543">            }</span>
        });
<span class="nc" id="L545">        c.setVisible(true);</span>
        
<span class="nc" id="L547">    }</span>
<span class="nc" id="L548">    private class ColumnTypeListListener implements ItemListener {</span>

        public void itemStateChanged(ItemEvent e) {
<span class="nc bnc" id="L551" title="All 2 branches missed.">            if (precisionSpinner == null) {</span>
<span class="nc" id="L552">                return;</span>
            }
<span class="nc" id="L554">            String columnType = (String)typeList.getSelectedItem();</span>
<span class="nc" id="L555">            int jdbcType = JDBCTypeMapper.getJdbcType(columnType);</span>
<span class="nc bnc" id="L556" title="All 2 branches missed.">            if (JDBCTypeMapper.isNumberType(jdbcType)) {</span>
<span class="nc" id="L557">                precisionSpinner.setEnabled(true);</span>
<span class="nc" id="L558">                scaleSpinner.setEnabled(true);</span>
<span class="nc" id="L559">                lengthSpinner.setEnabled(false);</span>
            } else {
<span class="nc bnc" id="L561" title="All 2 branches missed.">                if (JDBCTypeMapper.isDateType(jdbcType)) {</span>
<span class="nc" id="L562">                    precisionSpinner.setEnabled(false);</span>
<span class="nc" id="L563">                    scaleSpinner.setEnabled(false);</span>
<span class="nc" id="L564">                    lengthSpinner.setEnabled(false);                                </span>
                } else {
<span class="nc" id="L566">                    precisionSpinner.setEnabled(false);</span>
<span class="nc" id="L567">                    scaleSpinner.setEnabled(false);</span>
<span class="nc" id="L568">                    lengthSpinner.setEnabled(true);                                    </span>
                }
            }
<span class="nc" id="L571">        }</span>
        
    }
    
<span class="nc" id="L575">    private class DialectTypeListListener implements ItemListener {</span>
        
        public void itemStateChanged(ItemEvent e) {
<span class="nc" id="L578">            String dbName = (String)dialectList.getSelectedItem();</span>
<span class="nc" id="L579">            HibernateDialect dialect = DialectFactory.getDialect(dbName);</span>
<span class="nc bnc" id="L580" title="All 2 branches missed.">            if (!dialect.supportsColumnComment()) {</span>
<span class="nc" id="L581">                commentTextArea.setEditable(false);</span>
                //i18n[ColumnDetailsDialog.columnCommentLabel={0} does not 
                //support column comments]
                String noColumnSupportMsg =
<span class="nc" id="L585">                    s_stringMgr.getString(</span>
                            &quot;ColumnDetailsDialog.columnCommentToolTip&quot;,
                            dbName);
<span class="nc" id="L588">                commentTextArea.setToolTipText(noColumnSupportMsg);</span>
<span class="nc" id="L589">            } else {</span>
<span class="nc" id="L590">                commentTextArea.setEditable(true);</span>
<span class="nc" id="L591">                commentTextArea.setToolTipText(null);</span>
            }
<span class="nc bnc" id="L593" title="All 2 branches missed.">            if (_mode == MODIFY_MODE) {</span>
<span class="nc bnc" id="L594" title="All 2 branches missed.">                if (!dialect.supportsAlterColumnNull()) {</span>
<span class="nc" id="L595">                    nullableCheckBox.setEnabled(false);</span>
                    //i18n[ColumnDetailsDialog.columnNullLabel={0} does not 
                    //support altering column nullability]
                    String noColumnSupportMsg = 
<span class="nc" id="L599">                        s_stringMgr.getString(&quot;ColumnDetailsDialog.columnNullToolTip&quot;,</span>
                                              dbName);
<span class="nc" id="L601">                    nullableCheckBox.setToolTipText(noColumnSupportMsg);</span>
<span class="nc" id="L602">                } else {</span>
<span class="nc" id="L603">                    nullableCheckBox.setEnabled(true);</span>
<span class="nc" id="L604">                    nullableCheckBox.setToolTipText(null);</span>
                }
<span class="nc bnc" id="L606" title="All 2 branches missed.">                if (!dialect.supportsRenameColumn()) {</span>
                    //i18n[ColumnDetailsDialog.columnNameTootTip={0} does not 
                    //support altering column name]
                    String noColNameChange = 
<span class="nc" id="L610">                        s_stringMgr.getString(&quot;ColumnDetailsDialog.columnNameTootTip&quot;, </span>
                                              dbName);
<span class="nc" id="L612">                    columnNameTextField.setEditable(false);</span>
<span class="nc" id="L613">                    columnNameTextField.setToolTipText(noColNameChange);</span>
<span class="nc" id="L614">                } else {</span>
<span class="nc" id="L615">                    columnNameTextField.setEditable(true);</span>
<span class="nc" id="L616">                    columnNameTextField.setToolTipText(null);                    </span>
                }
<span class="nc bnc" id="L618" title="All 2 branches missed.">                if (!dialect.supportsAlterColumnType()) {</span>
                    //i18n[ColumnDetailsDialog.columnTypeTootTip={0} does not 
                    //support altering column type]     
                    String noColTypeChange = 
<span class="nc" id="L622">                        s_stringMgr.getString(&quot;ColumnDetailsDialog.columnTypeTootTip&quot;,</span>
                                              dbName);
<span class="nc" id="L624">                    typeList.setEnabled(false);</span>
<span class="nc" id="L625">                    typeList.setToolTipText(noColTypeChange);</span>
<span class="nc" id="L626">                    precisionSpinner.setEnabled(false);</span>
<span class="nc" id="L627">                    precisionSpinner.setToolTipText(noColTypeChange);</span>
<span class="nc" id="L628">                    lengthSpinner.setEnabled(false);</span>
<span class="nc" id="L629">                    lengthSpinner.setToolTipText(noColTypeChange);</span>
<span class="nc" id="L630">                    scaleSpinner.setEnabled(false);</span>
<span class="nc" id="L631">                    scaleSpinner.setToolTipText(noColTypeChange);</span>
<span class="nc" id="L632">                } else {</span>
<span class="nc" id="L633">                    typeList.setEnabled(true);</span>
<span class="nc" id="L634">                    typeList.setToolTipText(null);</span>
<span class="nc" id="L635">                    precisionSpinner.setToolTipText(null);</span>
<span class="nc" id="L636">                    lengthSpinner.setToolTipText(null);</span>
<span class="nc" id="L637">                    scaleSpinner.setToolTipText(null);</span>
                }
            }
<span class="nc" id="L640">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>