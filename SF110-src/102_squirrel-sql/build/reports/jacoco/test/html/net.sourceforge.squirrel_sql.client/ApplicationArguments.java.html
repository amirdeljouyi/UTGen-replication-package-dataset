<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationArguments.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client</a> &gt; <span class="el_source">ApplicationArguments.java</span></div><h1>ApplicationArguments.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client;

/*
 * Copyright (C) 2001-2006 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;

import org.apache.commons.cli.CommandLine;
import org.apache.commons.cli.CommandLineParser;
import org.apache.commons.cli.GnuParser;
import org.apache.commons.cli.HelpFormatter;
import org.apache.commons.cli.Option;
import org.apache.commons.cli.OptionBuilder;
import org.apache.commons.cli.Options;
import org.apache.commons.cli.ParseException;
/**
 * Application arguments.
 *
 * &lt;B&gt;Note:&lt;/B&gt; &lt;EM&gt;This class &lt;B&gt;cannot&lt;/B&gt; use the logging package as this
 * class is used to initialize the logging package. Nor can it use any classes
 * that themselves use the logging package.&lt;/EM&gt; Since StringManager uses the 
 * logging facility, neither can it be internationalized.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class ApplicationArguments implements IApplicationArguments
{
	/**
	 * Option descriptions.
	 *
	 * &lt;UL&gt;
	 * &lt;LI&gt;element 0 - short option
	 * &lt;LI&gt;element 1 - long option (null if none)
	 * &lt;LI&gt;element 2 - option description
	 * &lt;/UL&gt;
	 */
	public interface IOptions
	{
<span class="nc" id="L57">		String[] HELP = { &quot;h&quot;, &quot;help&quot;, &quot;Display Help and exit&quot;};</span>
<span class="nc" id="L58">		String[] SQUIRREL_HOME = { &quot;home&quot;, &quot;squirrel-home&quot;,</span>
									&quot;SQuirreL home directory&quot;};
<span class="nc" id="L60">		String[] LOG_FILE = { &quot;l&quot;, &quot;log-config-file&quot;,</span>
											&quot;Logging configuration file&quot;};
<span class="nc" id="L62">		String[] USE_DEFAULT_METAL_THEME = { &quot;m&quot;, &quot;use-default-metal-theme&quot;,</span>
											&quot;Use default metal theme&quot;};
<span class="nc" id="L64">		String[] USE_NATIVE_LAF = { &quot;n&quot;, &quot;native-laf&quot;,</span>
									&quot;Use native look and feel&quot;};
<span class="nc" id="L66">		String[] NO_PLUGINS = {&quot;nop&quot;, &quot;no-plugins&quot;, &quot;Don't load plugins&quot;};</span>
<span class="nc" id="L67">		String[] NO_SPLASH = { &quot;nos&quot;, &quot;no-splash&quot;, &quot;Don't display splash screen&quot;};</span>
<span class="nc" id="L68">		String[] USER_SETTINGS_DIR = { &quot;userdir&quot;, &quot;user-settings-dir&quot;,</span>
								&quot;User settings directory&quot;};
<span class="nc" id="L70">		String[] UI_DEBUG = {&quot;uidebug&quot;, &quot;user-interface-debugging&quot;, </span>
			&quot;Provides tool-tips and highlighting of UI components for easy identification&quot; };
<span class="nc" id="L72">		String[] PLUGIN_LIST = { &quot;pluginlist&quot;, &quot;plugin-classpath-list&quot;, </span>
			&quot;Specify a comma-delimited list of plugins to load from the CLASSPATH&quot; };
<span class="nc" id="L74">		String[] SHUTDOWN_TIMEOUT_SECONDS = { &quot;s&quot;, &quot;shutdown-timeout-seconds&quot;, </span>
			&quot;Specify the number of seconds to allow the application to run before exiting the VM&quot; };

	}

	/** Only instance of this class. */
	private static volatile ApplicationArguments s_instance;

	/** Collection of possible options that acn be passed. */
<span class="nc" id="L83">	private final Options _options = new Options();</span>

	/** Parsed command line that was passed to application. */
	private CommandLine _cmdLine;

	/** &amp;quot;Raw&amp;quot; arguments straight from the command line. */
	private String[] _rawArgs;

	/** Squirrels home directory. */
<span class="nc" id="L92">	private String _squirrelHome = null;</span>

	/**
	 * If not &lt;TT&gt;null&lt;/TT&gt; then is an override for the users .squirrel-sql
	 * settings directory.
	 */
<span class="nc" id="L98">	private String _userSettingsDir = null;</span>

	/** Path for logging configuration file */
<span class="nc" id="L101">	private String _loggingConfigFile = null;</span>

	/** List of plugins to load from the classloader */
<span class="nc" id="L104">	private List&lt;String&gt; _pluginList = null;</span>
	
	/** Time in seconds to allow the application to run prior to exiting the VM */
<span class="nc" id="L107">	private Integer _shutdownTimerSeconds = null;</span>
	
	/**
	 * Ctor specifying arguments from command line.
	 *
	 * @param	args	Arguments passed on command line.
	 *
	 * @throws	ParseException
	 * 			Thrown if unable to parse arguments.
	 */
	private ApplicationArguments(String[] args)
		throws ParseException
	{
<span class="nc" id="L120">		super();</span>
<span class="nc" id="L121">		createOptions();</span>

        // set up array to return for public access to cmd line args
<span class="nc" id="L124">        _rawArgs = args;        </span>

<span class="nc" id="L126">		final CommandLineParser parser = new GnuParser();</span>
		try
		{
<span class="nc" id="L129">			_cmdLine = parser.parse(_options, args);</span>
		}
<span class="nc" id="L131">		catch(ParseException ex)</span>
		{
<span class="nc" id="L133">			System.err.println(&quot;Parsing failed. Reason: &quot; + ex.getMessage());</span>
<span class="nc" id="L134">			printHelp();</span>
<span class="nc" id="L135">			throw ex;</span>
<span class="nc" id="L136">		}</span>

<span class="nc bnc" id="L138" title="All 2 branches missed.">		if (_cmdLine.hasOption(IOptions.SQUIRREL_HOME[0]))</span>
		{
<span class="nc" id="L140">			_squirrelHome = _cmdLine.getOptionValue(IOptions.SQUIRREL_HOME[0]);</span>
		}
<span class="nc bnc" id="L142" title="All 2 branches missed.">		if (_cmdLine.hasOption(IOptions.USER_SETTINGS_DIR[0]))</span>
		{
<span class="nc" id="L144">			_userSettingsDir = _cmdLine.getOptionValue(IOptions.USER_SETTINGS_DIR[0]);</span>
		}
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if (_cmdLine.hasOption(IOptions.LOG_FILE[0]))</span>
		{
<span class="nc" id="L148">			_loggingConfigFile = _cmdLine.getOptionValue(IOptions.LOG_FILE[0]);</span>
		}
<span class="nc bnc" id="L150" title="All 2 branches missed.">		if (_cmdLine.hasOption(IOptions.PLUGIN_LIST[0]))</span>
		{
<span class="nc" id="L152">			String pluginList = _cmdLine.getOptionValue(IOptions.PLUGIN_LIST[0]);</span>
<span class="nc bnc" id="L153" title="All 4 branches missed.">			if (pluginList != null &amp;&amp; !pluginList.isEmpty()) {</span>
<span class="nc" id="L154">				String[] pluginArr = pluginList.split(&quot;,&quot;);</span>
<span class="nc" id="L155">				_pluginList = new ArrayList&lt;String&gt;(Arrays.asList(pluginArr));</span>
<span class="nc" id="L156">				_pluginList = Collections.unmodifiableList(_pluginList);</span>
			}
		}
<span class="nc bnc" id="L159" title="All 2 branches missed.">		if (_cmdLine.hasOption(IOptions.SHUTDOWN_TIMEOUT_SECONDS[0])) {</span>
<span class="nc" id="L160">			_shutdownTimerSeconds = Integer.parseInt(_cmdLine.getOptionValue(IOptions.SHUTDOWN_TIMEOUT_SECONDS[0]));</span>
		}
		
<span class="nc" id="L163">	}</span>

	/**
	 * Initialize application arguments.
	 *
	 * @param	args	Arguments passed on command line.
	 *
	 * @return	&lt;TT&gt;true&lt;/TT&gt; if arguments parsed successfully else
	 *			&lt;TT&gt;false&lt;.TT&gt;. If parsing was unsuccessful an error was written
	 *			to standard error.
	 */
	public synchronized static boolean initialize(String[] args)
	{
<span class="nc bnc" id="L176" title="All 2 branches missed.">		if (s_instance == null)</span>
		{
			try
			{
<span class="nc" id="L180">				s_instance = new ApplicationArguments(args);</span>
			}
<span class="nc" id="L182">			catch (ParseException ex)</span>
			{
<span class="nc" id="L184">				return false;</span>
<span class="nc" id="L185">			}</span>
		}
		else
		{
<span class="nc" id="L189">			System.out.println(&quot;ApplicationArguments.initialize() called twice&quot;);</span>
		}
<span class="nc" id="L191">		return true;</span>
	}

	/**
	 * Return the single instance of this class.
	 *
	 * @return the single instance of this class. If initialize() hasn't yet been called, then it is
	 * assumed that there are no arguments to the application.
	 */
	public static ApplicationArguments getInstance()
	{
<span class="nc bnc" id="L202" title="All 2 branches missed.">		if (s_instance == null)</span>
		{
			try {
<span class="nc" id="L205">				s_instance = new ApplicationArguments(new String[] {});</span>
<span class="nc" id="L206">			} catch (ParseException e) {</span>
<span class="nc" id="L207">				e.printStackTrace();</span>
<span class="nc" id="L208">			}</span>
		}
<span class="nc" id="L210">		return s_instance;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getSquirrelHomeDirectory()
	 */
	public String getSquirrelHomeDirectory()
	{
<span class="nc" id="L218">		return _squirrelHome;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getUserSettingsDirectoryOverride()
	 */
	public String getUserSettingsDirectoryOverride()
	{
<span class="nc" id="L226">		return _userSettingsDir;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getShowSplashScreen()
	 */
	public boolean getShowSplashScreen()
	{
<span class="nc bnc" id="L234" title="All 2 branches missed.">		return !_cmdLine.hasOption(IOptions.NO_SPLASH[0]);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getShowHelp()
	 */
	public boolean getShowHelp()
	{
<span class="nc" id="L242">		return _cmdLine.hasOption(IOptions.HELP[0]);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getLoggingConfigFileName()
	 */
	public String getLoggingConfigFileName()
	{
<span class="nc" id="L250">		return _loggingConfigFile;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getLoadPlugins()
	 */
	public boolean getLoadPlugins()
	{
<span class="nc bnc" id="L258" title="All 2 branches missed.">		return !_cmdLine.hasOption(IOptions.NO_PLUGINS[0]);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#useDefaultMetalTheme()
	 */
	public boolean useDefaultMetalTheme()
	{
<span class="nc" id="L266">		return _cmdLine.hasOption(IOptions.USE_DEFAULT_METAL_THEME[0]);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#useNativeLAF()
	 */
	public boolean useNativeLAF()
	{
<span class="nc" id="L274">		return _cmdLine.hasOption(IOptions.USE_NATIVE_LAF[0]);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getRawArguments()
	 */
	public String[] getRawArguments()
	{
<span class="nc" id="L282">		return _rawArgs;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getUserInterfaceDebugEnabled()
	 */
	public boolean getUserInterfaceDebugEnabled() {
<span class="nc" id="L289">		return _cmdLine.hasOption(IOptions.UI_DEBUG[0]);</span>
	}
	
	/**
	 * @see net.sourceforge.squirrel_sql.client.IApplicationArguments#getPluginList()
	 */
	public List&lt;String&gt; getPluginList() {
<span class="nc" id="L296">		return _pluginList;</span>
	}
	
	public Integer getShutdownTimerSeconds() {
<span class="nc" id="L300">		return _shutdownTimerSeconds;</span>
	}
	
	void printHelp()
	{
<span class="nc" id="L305">		HelpFormatter formatter = new HelpFormatter();</span>
<span class="nc" id="L306">		formatter.printHelp(&quot;squirrel-sql&quot;, _options);</span>
<span class="nc" id="L307">	}</span>

	/**
	 * Create the &lt;TT&gt;Options&lt;/TT&gt; object used to parse the command line.
	 */
	private void createOptions()
	{
		Option opt;

<span class="nc" id="L316">		opt = createAnOption(IOptions.NO_SPLASH);</span>
<span class="nc" id="L317">		_options.addOption(opt);</span>

<span class="nc" id="L319">		opt = createAnOption(IOptions.HELP);</span>
<span class="nc" id="L320">		_options.addOption(opt);</span>

<span class="nc" id="L322">		opt = createAnOption(IOptions.NO_PLUGINS);</span>
<span class="nc" id="L323">		_options.addOption(opt);</span>

<span class="nc" id="L325">		opt = createAnOption(IOptions.USE_DEFAULT_METAL_THEME);</span>
<span class="nc" id="L326">		_options.addOption(opt);</span>

<span class="nc" id="L328">		opt = createAnOption(IOptions.USE_NATIVE_LAF);</span>
<span class="nc" id="L329">		_options.addOption(opt);</span>

<span class="nc" id="L331">		opt = createAnOptionWithArgument(IOptions.SQUIRREL_HOME);</span>
<span class="nc" id="L332">		_options.addOption(opt);</span>

<span class="nc" id="L334">		opt = createAnOptionWithArgument(IOptions.USER_SETTINGS_DIR);</span>
<span class="nc" id="L335">		_options.addOption(opt);</span>

<span class="nc" id="L337">		opt = createAnOptionWithArgument(IOptions.LOG_FILE);</span>
<span class="nc" id="L338">		_options.addOption(opt);</span>
		
<span class="nc" id="L340">		opt = createAnOption(IOptions.UI_DEBUG);</span>
<span class="nc" id="L341">		_options.addOption(opt);</span>
		
<span class="nc" id="L343">		opt = createAnOptionWithArgument(IOptions.PLUGIN_LIST);</span>
<span class="nc" id="L344">		_options.addOption(opt);</span>
		
<span class="nc" id="L346">		opt = createAnOptionWithArgument(IOptions.SHUTDOWN_TIMEOUT_SECONDS);</span>
<span class="nc" id="L347">		_options.addOption(opt);</span>
<span class="nc" id="L348">	}</span>

	private Option createAnOption(String[] argInfo)
	{
<span class="nc" id="L352">		Option opt = new Option(argInfo[0], argInfo[2]);</span>
<span class="nc bnc" id="L353" title="All 2 branches missed.">		if (!isStringEmpty(argInfo[1]))</span>
		{
<span class="nc" id="L355">			opt.setLongOpt(argInfo[1]);</span>
		}

<span class="nc" id="L358">		return opt;</span>
	}

	private Option createAnOptionWithArgument(String[] argInfo)
	{
<span class="nc" id="L363">		OptionBuilder.withArgName(argInfo[0]);</span>
<span class="nc" id="L364">		OptionBuilder.hasArg();</span>
<span class="nc" id="L365">		OptionBuilder.withDescription(argInfo[2]);</span>
<span class="nc" id="L366">		Option opt = OptionBuilder.create( argInfo[0]);</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">		if (!isStringEmpty(argInfo[1]))</span>
		{
<span class="nc" id="L369">			opt.setLongOpt(argInfo[1]);</span>
		}
<span class="nc" id="L371">		return opt;</span>
	}

	private static boolean isStringEmpty(String str)
	{
<span class="nc bnc" id="L376" title="All 4 branches missed.">		return str == null || str.length() == 0;</span>
	}
    
    /**
     * Resets the internally stored instance so that the next call to initialize
     * will function as the first call.  Useful for unit tests, so it uses package
     * level access.
     */
    static final void reset() {
<span class="nc" id="L385">        s_instance = null;</span>
<span class="nc" id="L386">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>