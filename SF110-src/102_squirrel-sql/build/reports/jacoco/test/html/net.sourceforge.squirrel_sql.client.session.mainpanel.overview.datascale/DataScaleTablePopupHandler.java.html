<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataScaleTablePopupHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.mainpanel.overview.datascale</a> &gt; <span class="el_source">DataScaleTablePopupHandler.java</span></div><h1>DataScaleTablePopupHandler.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session.mainpanel.overview.datascale;

import net.sourceforge.squirrel_sql.fw.gui.SortableTableModel;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;


/**
 * This class only exists because the regular right mouse menu handling does not work
 * for the buttons that a DataScalePanel consists of.
 *
 * The right mouse menu works for those Buttons only if a button was clicked and then the previous navigation button was used
 * to return to the table where the button was klicked. In this case the tabel's right mouse menu doesn't work anymore.
 * That is why we implement both ways. 
 *
 * Quite a bit comlicated just to bring up a right mouse menu, isn't it. 
 *
 *  
 */
public class DataScaleTablePopupHandler
{
<span class="nc" id="L29">   private static final StringManager s_stringMgr = StringManagerFactory.getStringManager(DataScaleTablePopupHandler.class);</span>

   private DataScaleTable _dataScaleTable;
   private JButton _buttonPopupWasOpenedAt;
   private DataScale _dataScalePopupWasOpenedAt;

   DataScaleTablePopupHandler(final DataScaleTable dataScaleTable)
<span class="nc" id="L36">   {</span>
<span class="nc" id="L37">      _dataScaleTable = dataScaleTable;</span>
      
<span class="nc" id="L39">      attachListenersToTable(dataScaleTable);</span>

<span class="nc" id="L41">      attachListenersToButtons(dataScaleTable);</span>

<span class="nc" id="L43">   }</span>

   private void attachListenersToButtons(DataScaleTable dataScaleTable)
   {
<span class="nc" id="L47">      final JPopupMenu popup = createPopupMenu();</span>

<span class="nc bnc" id="L49" title="All 2 branches missed.">      for (int i = 0; i &lt; dataScaleTable.getDataScaleTableModel().getRowCount(); i++)</span>
      {
<span class="nc" id="L51">         final DataScale dataScale = dataScaleTable.getDataScaleTableModel().getDataScaleAt(i);</span>

         // This initialzing call is needed to make ths scale to create the buttons.
<span class="nc" id="L54">         dataScale.getPanel();</span>

<span class="nc" id="L56">         JButton[] buttons = dataScale.getButtons();</span>

<span class="nc bnc" id="L58" title="All 2 branches missed.">         for (final JButton button : buttons)</span>
         {
<span class="nc" id="L60">            button.addMouseListener(new MouseAdapter()</span>
<span class="nc" id="L61">            {</span>
               @Override
               public void mousePressed(MouseEvent evt)
               {
<span class="nc" id="L65">                  maybeShowPopUpOnButton(evt, dataScale, button, popup);</span>
<span class="nc" id="L66">               }</span>

               @Override
               public void mouseReleased(MouseEvent evt)
               {
<span class="nc" id="L71">                  maybeShowPopUpOnButton(evt, dataScale, button, popup);</span>
<span class="nc" id="L72">               }</span>
            });


         }
      }
<span class="nc" id="L78">   }</span>

   private void maybeShowPopUpOnButton(MouseEvent evt, DataScale dataScale, JButton button, JPopupMenu popup)
   {
<span class="nc bnc" id="L82" title="All 2 branches missed.">      if (evt.isPopupTrigger())</span>
      {
<span class="nc" id="L84">         _dataScalePopupWasOpenedAt = dataScale;</span>
<span class="nc" id="L85">         _buttonPopupWasOpenedAt = button;</span>
<span class="nc" id="L86">         popup.show(evt.getComponent(), evt.getX(), evt.getY());</span>
      }
<span class="nc" id="L88">   }</span>

   private void attachListenersToTable(DataScaleTable dataScaleTable)
   {
<span class="nc" id="L92">      final JPopupMenu popup = createPopupMenu();</span>

<span class="nc" id="L94">      dataScaleTable.addMouseListener(new MouseAdapter()</span>
<span class="nc" id="L95">      {</span>
         @Override
         public void mousePressed(MouseEvent evt)
         {
<span class="nc" id="L99">            maybeShowPopUpOnTable(evt, popup);</span>
<span class="nc" id="L100">         }</span>

         @Override
         public void mouseReleased(MouseEvent evt)
         {
<span class="nc" id="L105">            maybeShowPopUpOnTable(evt, popup);</span>
<span class="nc" id="L106">         }</span>
      });
<span class="nc" id="L108">   }</span>

   private JPopupMenu createPopupMenu()
   {
<span class="nc" id="L112">      final JPopupMenu popup = new JPopupMenu();</span>

<span class="nc" id="L114">      JMenuItem mnuInTable = new JMenuItem(s_stringMgr.getString(&quot;DataScaleTablePopupHandler.showInTable&quot;));</span>
<span class="nc" id="L115">      mnuInTable.addActionListener(new ActionListener()</span>
<span class="nc" id="L116">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L119">            _dataScalePopupWasOpenedAt.showInTableSelected(_buttonPopupWasOpenedAt);</span>
<span class="nc" id="L120">         }</span>
      });
<span class="nc" id="L122">      popup.add(mnuInTable);</span>

<span class="nc" id="L124">      JMenuItem mnuInTableWin = new JMenuItem(s_stringMgr.getString(&quot;DataScaleTablePopupHandler.showTableInWin&quot;));</span>
<span class="nc" id="L125">      mnuInTableWin.addActionListener(new ActionListener()</span>
<span class="nc" id="L126">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L129">            _dataScalePopupWasOpenedAt.showInTableWin(_buttonPopupWasOpenedAt);</span>
<span class="nc" id="L130">         }</span>
      });
<span class="nc" id="L132">      popup.add(mnuInTableWin);</span>

<span class="nc" id="L134">      return popup;</span>
   }

   private void maybeShowPopUpOnTable(MouseEvent evt, JPopupMenu popup)
   {
<span class="nc bnc" id="L139" title="All 2 branches missed.">      if (evt.isPopupTrigger())</span>
      {
<span class="nc" id="L141">         Point point = new Point(evt.getX(), evt.getY());</span>

<span class="nc" id="L143">         int colIx = _dataScaleTable.columnAtPoint(point);</span>

<span class="nc" id="L145">         String headerValue = (String) _dataScaleTable.getColumnModel().getColumn(colIx).getHeaderValue();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">         if(DataScaleTableModel.COL_NAME_DATA.equals(headerValue))</span>
         {
<span class="nc" id="L148">            int rowIx = _dataScaleTable.rowAtPoint(point);</span>

<span class="nc" id="L150">            DataScaleTableModel model = _dataScaleTable.getDataScaleTableModel();</span>

<span class="nc" id="L152">            SortableTableModel sortableTableModel = (SortableTableModel) _dataScaleTable.getModel();</span>
<span class="nc" id="L153">            int transformedRow = sortableTableModel.transfromToModelRow(rowIx);</span>
<span class="nc" id="L154">            _dataScalePopupWasOpenedAt = model.getDataScaleAt(transformedRow);</span>


<span class="nc" id="L157">            Rectangle rect = _dataScaleTable.getCellRect(rowIx, colIx, false);</span>

//            System.out.println(&quot;cell rect x = &quot; + rect.x);
//            System.out.println(&quot;cell rect y = &quot; + rect.y);
//
//            System.out.println(&quot;point x = &quot; + point.x);
//            System.out.println(&quot;point y = &quot; + point.y);
//
<span class="nc" id="L165">            int xInScalePanel = point.x - rect.x;</span>
<span class="nc" id="L166">            int yInScalePanel = point.y - rect.y;</span>
//
//            System.out.println(&quot;point in panel x = &quot; + xInScalePanel);
//            System.out.println(&quot;point in panel y = &quot; + yInScalePanel);

<span class="nc" id="L171">            _buttonPopupWasOpenedAt = _dataScalePopupWasOpenedAt.getPanel().getButtonAt(xInScalePanel);</span>

//            System.out.println(&quot;btn = &quot; + _buttonPopupWasOpenedAt.getText());

<span class="nc bnc" id="L175" title="All 4 branches missed.">            if (null != _dataScalePopupWasOpenedAt &amp;&amp; null != _buttonPopupWasOpenedAt)</span>
            {
<span class="nc" id="L177">               popup.show(evt.getComponent(), evt.getX(), evt.getY());</span>
            }

         }
      }
<span class="nc" id="L182">   }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>