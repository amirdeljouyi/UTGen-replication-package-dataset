<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.mainpanel</a> &gt; <span class="el_source">SQLPanel.java</span></div><h1>SQLPanel.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session.mainpanel;
/*
 * Copyright (C) 2001-2004 Colin Bell
 * colbell@users.sourceforge.net
 *
 * Modifications Copyright (C) 2001-2004 Johan Compagner
 * jcompagner@j-com.nl
 *
 * Modifications Copyright (C) 2003-2004 Jason Height
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.beans.PropertyChangeEvent;
import java.beans.PropertyChangeListener;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.prefs.Preferences;

import javax.swing.Action;
import javax.swing.Box;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSplitPane;
import javax.swing.JTabbedPane;
import javax.swing.SwingUtilities;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;
import javax.swing.event.EventListenerList;
import javax.swing.plaf.SplitPaneUI;
import javax.swing.plaf.basic.BasicSplitPaneUI;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.client.gui.builders.UIFactory;
import net.sourceforge.squirrel_sql.client.resources.SquirrelResources;
import net.sourceforge.squirrel_sql.client.session.ISQLEntryPanel;
import net.sourceforge.squirrel_sql.client.session.ISQLPanelAPI;
import net.sourceforge.squirrel_sql.client.session.ISession;
import net.sourceforge.squirrel_sql.client.session.SQLPanelAPI;
import net.sourceforge.squirrel_sql.client.session.action.OpenSqlHistoryAction;
import net.sourceforge.squirrel_sql.client.session.event.ISQLExecutionListener;
import net.sourceforge.squirrel_sql.client.session.event.ISQLPanelListener;
import net.sourceforge.squirrel_sql.client.session.event.ISQLResultExecuterTabListener;
import net.sourceforge.squirrel_sql.client.session.event.SQLExecutionAdapter;
import net.sourceforge.squirrel_sql.client.session.event.SQLPanelEvent;
import net.sourceforge.squirrel_sql.client.session.event.SQLResultExecuterTabEvent;
import net.sourceforge.squirrel_sql.client.session.properties.SessionProperties;
import net.sourceforge.squirrel_sql.fw.gui.FontInfo;
import net.sourceforge.squirrel_sql.fw.gui.IntegerField;
import net.sourceforge.squirrel_sql.fw.gui.MemoryComboBox;
import net.sourceforge.squirrel_sql.fw.sql.ISQLConnection;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;
/**
 * This is the panel where SQL scripts can be entered and executed.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class SQLPanel extends JPanel
{
    private static final long serialVersionUID = 1L;

    /** Logger for this class. */
<span class="nc" id="L94">	private static final ILogger s_log = LoggerController.createLogger(SQLPanel.class);</span>

    /** Internationalized strings for this class. */
<span class="nc" id="L97">    private static final StringManager s_stringMgr =</span>
<span class="nc" id="L98">        StringManagerFactory.getStringManager(SQLPanel.class);   </span>
    
	/** Used to separate lines in the SQL entry area. */
	private final static String LINE_SEPARATOR = &quot;\n&quot;;

	/**
	 * Set to &lt;TT&gt;true&lt;/TT&gt; once SQL history has been loaded from the file
	 * system.
	 */
	private static boolean s_loadedSQLHistory;

	/** Current session. */
	transient private ISession _session;

	private SQLHistoryComboBox _sqlCombo;
	transient private ISQLEntryPanel _sqlEntry;
	private JCheckBox _limitRowsChk;
<span class="nc" id="L115">	private IntegerField _nbrRows = new IntegerField();</span>


<span class="nc" id="L118">	transient private SqlComboListener _sqlComboListener = new SqlComboListener();</span>
	transient private MyPropertiesListener _propsListener;

	/** Each tab is a &lt;TT&gt;ResultTab&lt;/TT&gt; showing the results of a query. */
//	private JTabbedPane _tabbedResultsPanel;

	/**
	 * Collection of &lt;TT&gt;ResultTabInfo&lt;/TT&gt; objects for all
	 * &lt;TT&gt;ResultTab&lt;/TT&gt; objects that have been created. Keyed
	 * by &lt;TT&gt;ResultTab.getIdentifier()&lt;/TT&gt;.
	 */
//	private Map _allTabs = new HashMap();

	/**
	 * Pool of &lt;TT&gt;ResultTabInfo&lt;/TT&gt; objects available for use.
	 */
//	private List _availableTabs = new ArrayList();

	/**
	 * Pool of &lt;TT&gt;ResultTabInfo&lt;/TT&gt; objects currently being used.
	 */
//	private ArrayList _usedTabs = new ArrayList();

	/** Each tab is a &lt;TT&gt;ExecuterTab&lt;/TT&gt; showing an installed executer. */

   /**
    * Is the bottom component of the split.
    * Holds the _simpleExecuterPanel if there is just one entry in _executors,
    * holds the _tabbedExecuterPanel if there is more that one element in _executors, 
    */
   private JPanel _executerPanleHolder;

	private JTabbedPane _tabbedExecuterPanel;
	private JPanel _simpleExecuterPanel;

<span class="nc" id="L153">	private boolean _hasBeenVisible = false;</span>
	private JSplitPane _splitPane;


	/** Listeners */
<span class="nc" id="L158">	private EventListenerList _listeners = new EventListenerList();</span>

   /** Factory for generating unique IDs for new &lt;TT&gt;ResultTab&lt;/TT&gt; objects. */
//	private IntegerIdentifierFactory _idFactory = new IntegerIdentifierFactory();

<span class="nc" id="L163">	private final List&lt;ISQLResultExecuter&gt; _executors = </span>
        new ArrayList&lt;ISQLResultExecuter&gt;();

	private SQLResultExecuterPanel _sqlExecPanel;

	transient private ISQLPanelAPI _panelAPI;

   private static final String PREFS_KEY_SPLIT_DIVIDER_LOC = &quot;squirrelSql_sqlPanel_divider_loc&quot;;
   private static final String PREFS_KEY_SPLIT_DIVIDER_LOC_HORIZONTAL = &quot;squirrelSql_sqlPanel_divider_loc_horizontal&quot;;

   /**
    * true if this panel is within a SessionInternalFrame
    * false if this panle is within a SQLInternalFrame
    */
   private boolean _inMainSessionWindow;
<span class="nc" id="L178">	transient private SQLPanel.SQLExecutorHistoryListener _sqlExecutorHistoryListener = new SQLExecutorHistoryListener();</span>
<span class="nc" id="L179">   private ArrayList&lt;SqlPanelListener&gt; _sqlPanelListeners = new ArrayList&lt;SqlPanelListener&gt;();</span>
   private IUndoHandler _undoHandler;


   /**
	 * Ctor.
	 *
	 * @param	session	 Current session.
	 *
	 * @throws	IllegalArgumentException
	 *			Thrown if a &lt;TT&gt;null&lt;/TT&gt; &lt;TT&gt;ISession&lt;/TT&gt; passed.
	 */
	public SQLPanel(ISession session, boolean isInMainSessionWindow)
	{
<span class="nc" id="L193">		super();</span>
<span class="nc" id="L194">		_inMainSessionWindow = isInMainSessionWindow;</span>
<span class="nc" id="L195">		setSession(session);</span>
<span class="nc" id="L196">		createGUI();</span>
<span class="nc" id="L197">		propertiesHaveChanged(null);</span>
<span class="nc" id="L198">		_sqlExecPanel = new SQLResultExecuterPanel(session);</span>
<span class="nc" id="L199">		_sqlExecPanel.addSQLExecutionListener(_sqlExecutorHistoryListener);</span>
<span class="nc" id="L200">		addExecutor(_sqlExecPanel);</span>
<span class="nc" id="L201">		_panelAPI = new SQLPanelAPI(this);</span>
<span class="nc" id="L202">	}</span>

	/**
	 * Set the current session.
	 *
	 * @param	session	 Current session.
	 *
	 * @throws	IllegalArgumentException
	 *			Thrown if a &lt;TT&gt;null&lt;/TT&gt; &lt;TT&gt;ISession&lt;/TT&gt; passed.
	 */
	public synchronized void setSession(ISession session)
	{
<span class="nc bnc" id="L214" title="All 2 branches missed.">		if (session == null)</span>
		{
<span class="nc" id="L216">			throw new IllegalArgumentException(&quot;Null ISession passed&quot;);</span>
		}
<span class="nc" id="L218">		sessionClosing();</span>
<span class="nc" id="L219">		_session = session;</span>
<span class="nc" id="L220">		_propsListener = new MyPropertiesListener();</span>
<span class="nc" id="L221">		_session.getProperties().addPropertyChangeListener(_propsListener);</span>
<span class="nc" id="L222">	}</span>

	/**
	 * JASON: This method may go eventually if the SQLPanel implements the
	 * ISQLPanelAPI interface.
	 */
	public ISQLPanelAPI getSQLPanelAPI()
	{
<span class="nc" id="L230">		return _panelAPI;</span>
	}

	/** Current session. */
	public synchronized ISession getSession()
	{
<span class="nc" id="L236">		return _session;</span>
	}

	public void addExecutor(ISQLResultExecuter exec)
	{
<span class="nc" id="L241">		_executors.add(exec);</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">      if(1 == _executors.size())</span>
      {
<span class="nc" id="L245">         _executerPanleHolder.remove(_tabbedExecuterPanel);</span>
<span class="nc" id="L246">         _executerPanleHolder.add(_simpleExecuterPanel);</span>
      }
<span class="nc bnc" id="L248" title="All 2 branches missed.">      else if(2 == _executors.size())</span>
      {
<span class="nc" id="L250">         _executerPanleHolder.remove(_simpleExecuterPanel);</span>
<span class="nc" id="L251">         _executerPanleHolder.add(_tabbedExecuterPanel);</span>
<span class="nc" id="L252">         _executors.get(0);</span>
<span class="nc" id="L253">         ISQLResultExecuter buf = _executors.get(0);</span>
<span class="nc" id="L254">         _tabbedExecuterPanel.addTab(buf.getTitle(), null, buf.getComponent(), buf.getTitle());</span>
      }


<span class="nc bnc" id="L258" title="All 2 branches missed.">      if( 1 &lt; _executors.size())</span>
      {
<span class="nc" id="L260">         _tabbedExecuterPanel.addTab(exec.getTitle(), null, exec.getComponent(), exec.getTitle());</span>
      }
      else
      {
<span class="nc" id="L264">         _simpleExecuterPanel.add(exec.getComponent());</span>
      }

<span class="nc" id="L267">		this.fireExecuterTabAdded(exec);</span>
<span class="nc" id="L268">	}</span>

	public void removeExecutor(ISQLResultExecuter exec)
	{
<span class="nc" id="L272">		_executors.remove(exec);</span>
<span class="nc" id="L273">	}</span>

	public SQLResultExecuterPanel getSQLExecPanel()
	{
<span class="nc" id="L277">		return _sqlExecPanel;</span>
	}

	/**
	 * Add a listener listening for SQL Execution.
	 *
	 * @param	lis		Listener to add
	 *
	 * @throws	IllegalArgumentException
	 *			Thrown if a null &lt;TT&gt;ISQLExecutionListener&lt;/TT&gt; passed.
	 */
	public synchronized void addSQLExecutionListener(ISQLExecutionListener lis)
	{
<span class="nc bnc" id="L290" title="All 2 branches missed.">		if (lis == null)</span>
		{
<span class="nc" id="L292">			throw new IllegalArgumentException(&quot;null ISQLExecutionListener passed&quot;);</span>
		}
		//_listeners.add(ISQLExecutionListener.class, lis);
<span class="nc" id="L295">      _sqlExecPanel.addSQLExecutionListener(lis);</span>
<span class="nc" id="L296">   }</span>

	/**
	 * Remove an SQL execution listener.
	 *
	 * @param	lis	Listener
	 *
	 * @throws	IllegalArgumentException
	 *			If a null &lt;TT&gt;ISQLExecutionListener&lt;/TT&gt; passed.
	 */
	public synchronized void removeSQLExecutionListener(ISQLExecutionListener lis)
	{
<span class="nc bnc" id="L308" title="All 2 branches missed.">		if (lis == null)</span>
		{
<span class="nc" id="L310">			throw new IllegalArgumentException(&quot;null ISQLExecutionListener passed&quot;);</span>
		}
		//_listeners.remove(ISQLExecutionListener.class, lis);
<span class="nc" id="L313">      _sqlExecPanel.removeSQLExecutionListener(lis);</span>
<span class="nc" id="L314">	}</span>

	/**
	 * Add a listener to this panel.
	 *
	 * @param	lis	 Listener
	 *
	 * @throws	IllegalArgumentException
	 *			If a null &lt;TT&gt;ISQLPanelListener&lt;/TT&gt; passed.
	 */
	public synchronized void addSQLPanelListener(ISQLPanelListener lis)
	{
<span class="nc bnc" id="L326" title="All 2 branches missed.">		if (lis == null)</span>
		{
<span class="nc" id="L328">			throw new IllegalArgumentException(&quot;null ISQLPanelListener passed&quot;);</span>
		}
<span class="nc" id="L330">		_listeners.add(ISQLPanelListener.class, lis);</span>
<span class="nc" id="L331">	}</span>

	/**
	 * Remove a listener.
	 *
	 * @param	lis	Listener
	 *
	 * @throws	IllegalArgumentException
	 *			If a null &lt;TT&gt;ISQLPanelListener&lt;/TT&gt; passed.
	 */
	public synchronized void removeSQLPanelListener(ISQLPanelListener lis)
	{
<span class="nc bnc" id="L343" title="All 2 branches missed.">		if (lis == null)</span>
		{
<span class="nc" id="L345">			throw new IllegalArgumentException(&quot;null ISQLPanelListener passed&quot;);</span>
		}
<span class="nc" id="L347">		_listeners.remove(ISQLPanelListener.class, lis);</span>
<span class="nc" id="L348">	}</span>


	/**
	 * Add a listener for events in this sql panel executer tabs.
	 *
	 * @param	lis	Listener
	 *
	 * @throws	IllegalArgumentException
	 *			If a null &lt;TT&gt;ISQLResultExecuterTabListener&lt;/TT&gt; passed.
	 */
	public void addExecuterTabListener(ISQLResultExecuterTabListener lis)
	{
<span class="nc bnc" id="L361" title="All 2 branches missed."> 		if (lis == null)</span>
 		{
<span class="nc" id="L363"> 			throw new IllegalArgumentException(&quot;ISQLExecutionListener == null&quot;);</span>
 		}
<span class="nc" id="L365"> 		_listeners.add(ISQLResultExecuterTabListener.class, lis);</span>
<span class="nc" id="L366">	}</span>


	public synchronized void removeExecuterTabListener(ISQLResultExecuterTabListener lis)
	{
<span class="nc bnc" id="L371" title="All 2 branches missed.">		if (lis == null)</span>
		{
<span class="nc" id="L373">			throw new IllegalArgumentException(&quot;ISQLResultExecuterTabListener == null&quot;);</span>
		}
<span class="nc" id="L375">		_listeners.remove(ISQLResultExecuterTabListener.class, lis);</span>
<span class="nc" id="L376">	}</span>


	public ISQLEntryPanel getSQLEntryPanel()
	{
<span class="nc" id="L381">		return _sqlEntry;</span>
	}


	public void runCurrentExecuter()
	{
<span class="nc bnc" id="L387" title="All 2 branches missed.">      if(1 == _executors.size())</span>
      {
<span class="nc" id="L389">         ISQLResultExecuter exec = _executors.get(0);</span>
<span class="nc" id="L390">         exec.execute(_sqlEntry);</span>
<span class="nc" id="L391">      }</span>
      else
      {
<span class="nc" id="L394">         int selectedIndex = _tabbedExecuterPanel.getSelectedIndex();</span>
<span class="nc" id="L395">         ISQLResultExecuter exec = _executors.get(selectedIndex);</span>
<span class="nc" id="L396">         exec.execute(_sqlEntry);</span>
      }
<span class="nc" id="L398">	}</span>

	/**
	 * Sesssion is ending.
	 * Remove all listeners that this component has setup. Close all
	 * torn off result tab windows.
	 */
	void sessionClosing()
	{
<span class="nc bnc" id="L407" title="All 2 branches missed.">		if (_propsListener != null)</span>
		{
<span class="nc" id="L409">			_session.getProperties().removePropertyChangeListener(_propsListener);</span>
<span class="nc" id="L410">			_propsListener = null;</span>
		}
<span class="nc" id="L412">	}</span>

   public void sessionWindowClosing()
   {

<span class="nc" id="L417">      fireSQLEntryAreaClosed();</span>

<span class="nc bnc" id="L419" title="All 2 branches missed.">      if(_hasBeenVisible)</span>
      {
<span class="nc" id="L421">    	 saveOrientationDependingDividerLocation();</span>
         
      }

<span class="nc" id="L425">		_sqlCombo.removeActionListener(_sqlComboListener);</span>
<span class="nc" id="L426">		_sqlCombo.dispose();</span>
<span class="nc" id="L427">		_sqlExecPanel.removeSQLExecutionListener(_sqlExecutorHistoryListener);</span>
		



<span class="nc bnc" id="L432" title="All 2 branches missed.">      for (SqlPanelListener l : _sqlPanelListeners)</span>
      {
<span class="nc" id="L434">         l.panelParentWindowClosing();</span>
<span class="nc" id="L435">      }</span>

<span class="nc" id="L437">      _sqlEntry.dispose();</span>


<span class="nc" id="L440">   }</span>


   /**
    * Save the location of the divider depending on the orientation.
    * @see #PREFS_KEY_SPLIT_DIVIDER_LOC
    * @see #PREFS_KEY_SPLIT_DIVIDER_LOC_HORIZONTAL
    */
   private void saveOrientationDependingDividerLocation() {
<span class="nc" id="L449">	   int dividerLoc = _splitPane.getDividerLocation();</span>
<span class="nc bnc" id="L450" title="All 2 branches missed.">	   if(_splitPane.getOrientation() == JSplitPane.VERTICAL_SPLIT){</span>
<span class="nc" id="L451">		   Preferences.userRoot().putInt(PREFS_KEY_SPLIT_DIVIDER_LOC, dividerLoc);</span>
	   }else{
<span class="nc" id="L453">		   Preferences.userRoot().putInt(PREFS_KEY_SPLIT_DIVIDER_LOC_HORIZONTAL, dividerLoc);</span>
	   }
<span class="nc" id="L455">   }</span>

	private void installSQLEntryPanel(ISQLEntryPanel pnl)
	{
<span class="nc bnc" id="L459" title="All 2 branches missed.">		if (pnl == null)</span>
		{
<span class="nc" id="L461">			throw new IllegalArgumentException(&quot;Null ISQLEntryPanel passed&quot;);</span>
		}

<span class="nc" id="L464">		_sqlEntry = pnl;</span>

<span class="nc" id="L466">		final int pos = _splitPane.getDividerLocation();</span>

<span class="nc" id="L468">      JScrollPane  scrollPane = _sqlEntry.createScrollPane(_sqlEntry.getTextComponent());</span>
<span class="nc" id="L469">      _splitPane.add(scrollPane, JSplitPane.LEFT);</span>



//		if (!_sqlEntry.getDoesTextComponentHaveScroller())
//		{
//         JScrollPane sqlEntryScroller = createScrollPane(_sqlEntry.getTextComponent());
//			_splitPane.add(sqlEntryScroller);
//		}
//		else
//		{
//			_splitPane.add(_sqlEntry.getTextComponent(), JSplitPane.LEFT);
//		}
<span class="nc" id="L482">		_splitPane.setDividerLocation(pos);</span>

<span class="nc" id="L484">      _undoHandler = new UndoHandlerImpl(_session.getApplication(), _sqlEntry);</span>

<span class="nc" id="L486">      fireSQLEntryAreaInstalled();</span>
<span class="nc" id="L487">	}</span>

   public void setVisible(boolean value)
   {
<span class="nc" id="L491">      super.setVisible(value);</span>
<span class="nc bnc" id="L492" title="All 2 branches missed.">      if (value)</span>
      {
<span class="nc" id="L494">         _hasBeenVisible = true;</span>
      }
<span class="nc" id="L496">   }</span>


   /**
	 * Add the passed item to end of the SQL history. If the item
	 * at the end of the history is the same as the passed one
	 * then don't add it.
	 *
	 * @param	sql		SQL item to add.
	 *
	 * @throws	IllegalArgumentException
	 * 			Thrown if &lt;TT&gt;null&lt;/TT&gt; sql passed.
	 */
	public void addSQLToHistory(SQLHistoryItem sql)
	{
<span class="nc bnc" id="L511" title="All 2 branches missed.">		if (sql == null)</span>
		{
<span class="nc" id="L513">			throw new IllegalArgumentException(&quot;SQLHistoryItem == null&quot;);</span>
		}

<span class="nc" id="L516">		_sqlComboListener.stopListening();</span>
		try
		{
<span class="nc" id="L519">			int beforeSize = 0;</span>
<span class="nc" id="L520">			int afterSize = _sqlCombo.getItemCount();</span>
			do
			{
<span class="nc" id="L523">				beforeSize = afterSize;</span>
<span class="nc" id="L524">				_sqlCombo.removeItem(sql);</span>
<span class="nc" id="L525">				afterSize = _sqlCombo.getItemCount();</span>
<span class="nc bnc" id="L526" title="All 2 branches missed.">			} while (beforeSize != afterSize);</span>
<span class="nc" id="L527">			_sqlCombo.insertItemAt(sql, afterSize);</span>
<span class="nc" id="L528">			_sqlCombo.setSelectedIndex(afterSize);</span>
<span class="nc" id="L529">         _sqlCombo.repaint();</span>
		}
		finally
		{
<span class="nc" id="L533">			_sqlComboListener.startListening();</span>
		}
<span class="nc" id="L535">	}</span>

	/**
	 * Add a hierarchical menu to the SQL Entry Area popup menu.
	 *
	 * @param	menu	The menu that will be added.
	 *
	 * @throws	IllegalArgumentException
	 * 			Thrown if &lt;TT&gt;null&lt;/TT&gt; &lt;TT&gt;Menu&lt;/TT&gt; passed.
	 */
	public void addToSQLEntryAreaMenu(JMenu menu)
	{
<span class="nc bnc" id="L547" title="All 2 branches missed.">		if (menu == null)</span>
		{
<span class="nc" id="L549">			throw new IllegalArgumentException(&quot;Menu == null&quot;);</span>
		}
<span class="nc" id="L551">		getSQLEntryPanel().addToSQLEntryAreaMenu(menu);</span>
<span class="nc" id="L552">	}</span>

	/**
	 * Add an &lt;TT&gt;Action&lt;/TT&gt; to the SQL Entry Area popup menu.
	 *
	 * @param	action	The action to be added.
	 *
	 * @throws	IllegalArgumentException
	 * 			Thrown if &lt;TT&gt;null&lt;/TT&gt; &lt;TT&gt;Action&lt;/TT&gt; passed.
	 */
	public JMenuItem addToSQLEntryAreaMenu(Action action)
	{
<span class="nc bnc" id="L564" title="All 2 branches missed.">		if (action == null)</span>
		{
<span class="nc" id="L566">			throw new IllegalArgumentException(&quot;Action == null&quot;);</span>
		}
<span class="nc" id="L568">		return getSQLEntryPanel().addToSQLEntryAreaMenu(action);</span>
	}

	private void fireSQLEntryAreaInstalled()
	{
		// Guaranteed to be non-null.
<span class="nc" id="L574">		Object[] listeners = _listeners.getListenerList();</span>
		// Process the listeners last to first, notifying
		// those that are interested in this event.
<span class="nc" id="L577">		SQLPanelEvent evt = null;</span>
<span class="nc bnc" id="L578" title="All 2 branches missed.">		for (int i = listeners.length - 2; i &gt;= 0; i -= 2)</span>
		{
<span class="nc bnc" id="L580" title="All 2 branches missed.">			if (listeners[i] == ISQLPanelListener.class)</span>
			{
				// Lazily create the event:
<span class="nc bnc" id="L583" title="All 2 branches missed.">				if (evt == null)</span>
				{
<span class="nc" id="L585">					evt = new SQLPanelEvent(_session, this);</span>
				}
<span class="nc" id="L587">				((ISQLPanelListener)listeners[i + 1]).sqlEntryAreaInstalled(evt);</span>
			}
		}
<span class="nc" id="L590">	}</span>


   private void fireSQLEntryAreaClosed()
   {
      // Guaranteed to be non-null.
<span class="nc" id="L596">      Object[] listeners = _listeners.getListenerList();</span>
      // Process the listeners last to first, notifying
      // those that are interested in this event.
<span class="nc" id="L599">      SQLPanelEvent evt = null;</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">      for (int i = listeners.length - 2; i &gt;= 0; i -= 2)</span>
      {
<span class="nc bnc" id="L602" title="All 2 branches missed.">         if (listeners[i] == ISQLPanelListener.class)</span>
         {
            // Lazily create the event:
<span class="nc bnc" id="L605" title="All 2 branches missed.">            if (evt == null)</span>
            {
<span class="nc" id="L607">               evt = new SQLPanelEvent(_session, this);</span>
            }
<span class="nc" id="L609">            ((ISQLPanelListener)listeners[i + 1]).sqlEntryAreaClosed(evt);</span>
         }
      }
<span class="nc" id="L612">   }</span>

   private void fireExecuterTabAdded(ISQLResultExecuter exec)
	{
		// Guaranteed to be non-null.
<span class="nc" id="L617">		Object[] listeners = _listeners.getListenerList();</span>
		// Process the listeners last to first, notifying
		// those that are interested in this event.
<span class="nc" id="L620">		SQLResultExecuterTabEvent evt = null;</span>
<span class="nc bnc" id="L621" title="All 2 branches missed.">		for (int i = listeners.length - 2; i &gt;= 0; i -= 2)</span>
		{
<span class="nc bnc" id="L623" title="All 2 branches missed.">			if (listeners[i] == ISQLResultExecuterTabListener.class)</span>
			{
				// Lazily create the event:
<span class="nc bnc" id="L626" title="All 2 branches missed.">				if (evt == null)</span>
				{
<span class="nc" id="L628">					evt = new SQLResultExecuterTabEvent(_session, exec);</span>
				}
<span class="nc" id="L630">				((ISQLResultExecuterTabListener)listeners[i + 1]).executerTabAdded(evt);</span>
			}
		}
<span class="nc" id="L633">	}</span>

	private void fireExecuterTabActivated(ISQLResultExecuter exec)
	{
		// Guaranteed to be non-null.
<span class="nc" id="L638">		Object[] listeners = _listeners.getListenerList();</span>
		// Process the listeners last to first, notifying
		// those that are interested in this event.
<span class="nc" id="L641">		SQLResultExecuterTabEvent evt = null;</span>
<span class="nc bnc" id="L642" title="All 2 branches missed.">		for (int i = listeners.length - 2; i &gt;= 0; i -= 2)</span>
		{
<span class="nc bnc" id="L644" title="All 2 branches missed.">			if (listeners[i] == ISQLResultExecuterTabListener.class)</span>
			{
				// Lazily create the event:
<span class="nc bnc" id="L647" title="All 2 branches missed.">				if (evt == null)</span>
				{
<span class="nc" id="L649">					evt = new SQLResultExecuterTabEvent(_session, exec);</span>
				}
<span class="nc" id="L651">				((ISQLResultExecuterTabListener)listeners[i + 1]).executerTabActivated(evt);</span>
			}
		}
<span class="nc" id="L654">	}</span>


	private void appendSQL(String sql)
	{
<span class="nc bnc" id="L659" title="All 2 branches missed.">		if (_sqlEntry.getText().length() &gt; 0)</span>
		{
<span class="nc" id="L661">			_sqlEntry.appendText(LINE_SEPARATOR + LINE_SEPARATOR);</span>
		}
<span class="nc" id="L663">		_sqlEntry.appendText(sql, true);</span>
<span class="nc" id="L664">		_sqlEntry.requestFocus();</span>
<span class="nc" id="L665">	}</span>

	private void copySelectedItemToEntryArea()
	{
<span class="nc" id="L669">		SQLHistoryItem item = (SQLHistoryItem)_sqlCombo.getSelectedItem();</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">		if (item != null)</span>
		{
<span class="nc" id="L672">			appendSQL(item.getSQL());</span>
		}
<span class="nc" id="L674">	}</span>

	@SuppressWarnings(&quot;unused&quot;)
	private void openSQLHistory()
	{
<span class="nc" id="L679">      new SQLHistoryController(_session, getSQLPanelAPI(), ((SQLHistoryComboBoxModel)_sqlCombo.getModel()).getItems());</span>
<span class="nc" id="L680">   }</span>

	private void propertiesHaveChanged(String propName)
	{
<span class="nc" id="L684">		final SessionProperties props = _session.getProperties();</span>
<span class="nc bnc" id="L685" title="All 4 branches missed.">		if (propName == null || propName.equals(</span>
				SessionProperties.IPropertyNames.SQL_SHARE_HISTORY))
		{
<span class="nc" id="L688">			_sqlCombo.setUseSharedModel(props.getSQLShareHistory());</span>
		}

<span class="nc bnc" id="L691" title="All 4 branches missed.">		if (propName == null || propName.equals(SessionProperties.IPropertyNames.AUTO_COMMIT))</span>
		{
<span class="nc" id="L693">            SetAutoCommitTask task = new SetAutoCommitTask();</span>
<span class="nc bnc" id="L694" title="All 2 branches missed.">            if (SwingUtilities.isEventDispatchThread()) {</span>
<span class="nc" id="L695">                _session.getApplication().getThreadPool().addTask(task);</span>
            } else {
<span class="nc" id="L697">                task.run();</span>
            }
		}

<span class="nc bnc" id="L701" title="All 4 branches missed.">		if (propName == null || propName.equals(SessionProperties.IPropertyNames.SQL_LIMIT_ROWS))</span>
		{
<span class="nc" id="L703">			_limitRowsChk.setSelected(props.getSQLLimitRows());</span>
		}

<span class="nc bnc" id="L706" title="All 2 branches missed.">		if (propName == null</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">			|| propName.equals(SessionProperties.IPropertyNames.SQL_NBR_ROWS_TO_SHOW))</span>
		{
<span class="nc" id="L709">			_nbrRows.setInt(props.getSQLNbrRowsToShow());</span>
		}

<span class="nc bnc" id="L712" title="All 4 branches missed.">		if (propName == null || propName.equals(SessionProperties.IPropertyNames.FONT_INFO))</span>
		{
<span class="nc" id="L714">			FontInfo fi = props.getFontInfo();</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">			if (fi != null)</span>
			{
<span class="nc" id="L717">				_sqlEntry.setFont(fi.createFont());</span>
			}
		}

<span class="nc bnc" id="L721" title="All 4 branches missed.">		if (propName == null || propName.equals(SessionProperties.IPropertyNames.SQL_ENTRY_HISTORY_SIZE)</span>
<span class="nc bnc" id="L722" title="All 2 branches missed.">							|| propName.equals(SessionProperties.IPropertyNames.LIMIT_SQL_ENTRY_HISTORY_SIZE))</span>
		{
<span class="nc bnc" id="L724" title="All 2 branches missed.">			if (props.getLimitSQLEntryHistorySize())</span>
			{
<span class="nc" id="L726">				_sqlCombo.setMaxMemoryCount(props.getSQLEntryHistorySize());</span>
			}
			else
			{
<span class="nc" id="L730">				_sqlCombo.setMaxMemoryCount(MemoryComboBox.NO_MAX);</span>
			}
		}

<span class="nc" id="L734">	}</span>

   public void addSqlPanelListener(SqlPanelListener sqlPanelListener)
   {
<span class="nc" id="L738">      _sqlPanelListeners.add(sqlPanelListener);</span>
<span class="nc" id="L739">   }</span>

   public ArrayList&lt;SQLHistoryItem&gt; getSQLHistoryItems()
   {
<span class="nc" id="L743">      return ((SQLHistoryComboBoxModel)_sqlCombo.getModel()).getItems();</span>
   }

<span class="nc" id="L746">   private class SetAutoCommitTask implements Runnable {</span>
        
        public void run() {
<span class="nc" id="L749">            final ISQLConnection conn = _session.getSQLConnection();</span>
<span class="nc" id="L750">            final SessionProperties props = _session.getProperties();</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">            if (conn != null)</span>
            {
<span class="nc" id="L753">                boolean auto = true;</span>
                try
                {
<span class="nc" id="L756">                    auto = conn.getAutoCommit();</span>
                }
<span class="nc" id="L758">                catch (SQLException ex)</span>
                {
<span class="nc" id="L760">                    s_log.error(&quot;Error with transaction control&quot;, ex);</span>
<span class="nc" id="L761">                    _session.showErrorMessage(ex);</span>
<span class="nc" id="L762">                }</span>
                try
                {
<span class="nc" id="L765">                    conn.setAutoCommit(props.getAutoCommit());</span>
                }
<span class="nc" id="L767">                catch (SQLException ex)</span>
                {
<span class="nc" id="L769">                    props.setAutoCommit(auto);</span>
<span class="nc" id="L770">                    _session.showErrorMessage(ex);</span>
<span class="nc" id="L771">                }</span>
            }        
<span class="nc" id="L773">        }</span>
    }    
    
	private void createGUI()
	{
<span class="nc" id="L778">		final IApplication app = _session.getApplication();</span>
<span class="nc" id="L779">		synchronized (getClass())</span>
		{
<span class="nc bnc" id="L781" title="All 2 branches missed.">			if (!s_loadedSQLHistory)</span>
			{
<span class="nc" id="L783">				final SQLHistory sqlHistory = app.getSQLHistory();</span>
<span class="nc" id="L784">				SQLHistoryComboBoxModel.initializeSharedInstance(sqlHistory.getData());</span>
<span class="nc" id="L785">				s_loadedSQLHistory = true;</span>
			}
<span class="nc" id="L787">		}</span>

//		_tabbedResultsPanel = UIFactory.getInstance().createTabbedPane();
<span class="nc" id="L790">		_tabbedExecuterPanel = UIFactory.getInstance().createTabbedPane();</span>
<span class="nc" id="L791">		_tabbedExecuterPanel.addChangeListener(new MyExecuterPaneListener());</span>

<span class="nc" id="L793">		setLayout(new BorderLayout());</span>

<span class="nc" id="L795">		_nbrRows.setColumns(8);</span>

<span class="nc" id="L797">		final SessionProperties props = _session.getProperties();</span>
<span class="nc" id="L798">		_sqlCombo = new SQLHistoryComboBox(props.getSQLShareHistory());</span>
<span class="nc" id="L799">		_sqlCombo.setEditable(false);</span>
<span class="nc bnc" id="L800" title="All 2 branches missed.">		if (_sqlCombo.getItemCount() &gt; 0)</span>
		{
<span class="nc" id="L802">			_sqlCombo.setSelectedIndex(_sqlCombo.getItemCount() - 1);</span>
		}

		{
<span class="nc" id="L806">			JPanel pnl = new JPanel();</span>
<span class="nc" id="L807">			pnl.setLayout(new BorderLayout());</span>
<span class="nc" id="L808">			pnl.add(_sqlCombo, BorderLayout.CENTER);</span>

<span class="nc" id="L810">			Box box = Box.createHorizontalBox();</span>
<span class="nc" id="L811">			box.add(new CopyLastButton(app));</span>
<span class="nc" id="L812">			box.add(new ShowHistoryButton(app));</span>
<span class="nc" id="L813">			box.add(Box.createHorizontalStrut(10));</span>
            // i18n[SQLPanel.limitrowscheckbox.hint=Limit rows: ]
<span class="nc" id="L815">            String hint = </span>
<span class="nc" id="L816">                s_stringMgr.getString(&quot;SQLPanel.limitrowscheckbox.label&quot;);</span>
<span class="nc" id="L817">            _limitRowsChk = new JCheckBox(hint);</span>
<span class="nc" id="L818">			box.add(_limitRowsChk);</span>
<span class="nc" id="L819">			box.add(Box.createHorizontalStrut(5));</span>
<span class="nc" id="L820">			box.add(_nbrRows);</span>
<span class="nc" id="L821">			pnl.add(box, BorderLayout.EAST);</span>
<span class="nc" id="L822">			add(pnl, BorderLayout.NORTH);</span>
		}

<span class="nc" id="L825">		createSplitPane();	</span>
	  
<span class="nc" id="L827">		_splitPane.setOneTouchExpandable(true);</span>

<span class="nc" id="L829">		installSQLEntryPanel(</span>
<span class="nc" id="L830">		        app.getSQLEntryPanelFactory().createSQLEntryPanel(</span>
		                _session, 
		                new HashMap&lt;String, Object&gt;()));

<span class="nc" id="L834">      _executerPanleHolder = new JPanel(new GridLayout(1,1));</span>
<span class="nc" id="L835">      _executerPanleHolder.setMinimumSize(new Dimension(50,50));</span>


<span class="nc" id="L838">      _simpleExecuterPanel = new JPanel(new GridLayout(1,1));</span>
<span class="nc" id="L839">      _executerPanleHolder.add(_simpleExecuterPanel);</span>
<span class="nc" id="L840">      _splitPane.add(_executerPanleHolder, JSplitPane.RIGHT);</span>

<span class="nc" id="L842">		add(_splitPane, BorderLayout.CENTER);</span>

<span class="nc" id="L844">		_sqlCombo.addActionListener(_sqlComboListener);</span>
<span class="nc" id="L845">		_limitRowsChk.addChangeListener(new LimitRowsCheckBoxListener());</span>
<span class="nc" id="L846">		_nbrRows.getDocument().addDocumentListener(new LimitRowsTextBoxListener());</span>

		// Set focus to the SQL entry panel.
<span class="nc" id="L849">		SwingUtilities.invokeLater(new Runnable()</span>
<span class="nc" id="L850">		{</span>
			public void run()
			{
<span class="nc" id="L853">				_sqlEntry.getTextComponent().requestFocus();</span>
<span class="nc" id="L854">			}</span>
		});
<span class="nc" id="L856">	}</span>

   
	/**
	 * Create the split pane, restore the divider's location and register the needed listeners.
	 * There will be a {@link PropertyChangeListener} for switching the layout horizontal/vertical 
	 * and a {@link MouseListener}, to restore the divider's location to the default values.
	 * @see #calculateDividerLocation(int, boolean)
	 */
	private void createSplitPane()
	{
<span class="nc" id="L867">		final int spOrientation = getSession().getProperties().getSqlPanelOrientation();</span>

<span class="nc" id="L869">		_splitPane = new JSplitPane(spOrientation);</span>

<span class="nc" id="L871">		int dividerLoc = calculateDividerLocation(spOrientation, false);</span>
<span class="nc" id="L872">		_splitPane.setDividerLocation(dividerLoc);</span>

		/*
		 * Add a PropertyChangeListener for the SessionProperties for changing the orientation
		 * of the split pane, if the user change the settings.
		 */
<span class="nc" id="L878">		getSession().getProperties().addPropertyChangeListener(new PropertyChangeListener() {</span>
			@Override
			public void propertyChange(PropertyChangeEvent evt) {
<span class="nc bnc" id="L881" title="All 2 branches missed.">				if(SessionProperties.IPropertyNames.SQL_PANEL_ORIENTATION.equals(evt.getPropertyName())){</span>
<span class="nc" id="L882">					saveOrientationDependingDividerLocation();</span>
<span class="nc" id="L883">					_splitPane.setOrientation((Integer) evt.getNewValue());</span>
<span class="nc" id="L884">					_splitPane.setDividerLocation(calculateDividerLocation(_splitPane.getOrientation(), false));</span>
<span class="nc" id="L885">					_splitPane.repaint();</span>
				}
<span class="nc" id="L887">			}</span>
		});


		/*
		 * Add a mouse event listener to the divider, so that we can reset the divider location when a double click 
		 * occurs on the divider.
		 */
<span class="nc" id="L895">		SplitPaneUI spUI = _splitPane.getUI();</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">		if (spUI instanceof BasicSplitPaneUI) {</span>
<span class="nc" id="L897">			BasicSplitPaneUI bspUI = (BasicSplitPaneUI) spUI;</span>
<span class="nc" id="L898">			bspUI.getDivider().addMouseListener(new MouseAdapter() {</span>
				@Override
				public void mouseClicked(MouseEvent e) {
<span class="nc bnc" id="L901" title="All 4 branches missed.">					if (SwingUtilities.isLeftMouseButton(e) &amp;&amp; e.getClickCount() == 2) {</span>
<span class="nc" id="L902">						_splitPane.setDividerLocation(calculateDividerLocation(_splitPane.getOrientation(), true));</span>
					}			
<span class="nc" id="L904">				}</span>
			});

		}

<span class="nc" id="L909">	}</span>

   /**
    * Calculates the divider location of the split pane, depending on a orientation.
    * The default values are defined as followed:
    * &lt;li&gt;Vertical: split panes height - 200&lt;/li&gt;
    * &lt;li&gt;Horizontal: the half of split panes width&lt;/li&gt;
    * @param useDefault flag, if the default values should be used instead of the stored one.
    * @see #PREFS_KEY_SPLIT_DIVIDER_LOC
    * @see #PREFS_KEY_SPLIT_DIVIDER_LOC_HORIZONTAL
    * @return the divider's location depending on the orientation
    */
   private int calculateDividerLocation(int orientation, boolean useDefault) {
	   int dividerLoc;	
	   
<span class="nc" id="L924">	   final Dimension parentDim = _splitPane.getSize();</span>
	   
<span class="nc bnc" id="L926" title="All 2 branches missed.">	   if(orientation == JSplitPane.VERTICAL_SPLIT){</span>
<span class="nc" id="L927">		   int def = parentDim.height-200;</span>
<span class="nc bnc" id="L928" title="All 2 branches missed.">		   if(useDefault == false){</span>
<span class="nc" id="L929">			   dividerLoc = Preferences.userRoot().getInt(PREFS_KEY_SPLIT_DIVIDER_LOC, def);</span>
		   }else{
<span class="nc" id="L931">			   dividerLoc = def;</span>
		   }
<span class="nc" id="L933">	   }else{</span>
<span class="nc" id="L934">		   int def = parentDim.width/2;</span>
<span class="nc bnc" id="L935" title="All 2 branches missed.">		   if(useDefault == false){</span>
<span class="nc" id="L936">			   dividerLoc = Preferences.userRoot().getInt(PREFS_KEY_SPLIT_DIVIDER_LOC_HORIZONTAL, def);</span>
		   }else{
<span class="nc" id="L938">			   dividerLoc = def;</span>
		   }
	   }
<span class="nc" id="L941">	  return dividerLoc;</span>

   }

   public Action getUndoAction()
   {
<span class="nc" id="L947">      return _undoHandler.getUndoAction();</span>
   }

   public Action getRedoAction()
   {
<span class="nc" id="L952">      return _undoHandler.getRedoAction();</span>
   }

   public boolean isInMainSessionWindow()
   {
<span class="nc" id="L957">      return _inMainSessionWindow;</span>
   }

   /**
	 * Listens for changes in the execution jtabbedpane and then fires
	 * activation events
	 */
<span class="nc" id="L964">	private class MyExecuterPaneListener implements ChangeListener</span>
	{
		public void stateChanged(ChangeEvent e)
		{
<span class="nc" id="L968">			JTabbedPane pane = (JTabbedPane)e.getSource();</span>
<span class="nc" id="L969">			int index = pane.getSelectedIndex();</span>
<span class="nc bnc" id="L970" title="All 2 branches missed.">			if (index != -1)</span>
			{
<span class="nc" id="L972">				fireExecuterTabActivated(_executors.get(index));</span>
			}
<span class="nc" id="L974">		}</span>
	}

<span class="nc" id="L977">	private class MyPropertiesListener implements PropertyChangeListener</span>
	{
<span class="nc" id="L979">		private boolean _listening = true;</span>

		void stopListening()
		{
<span class="nc" id="L983">			_listening = false;</span>
<span class="nc" id="L984">		}</span>

		void startListening()
		{
<span class="nc" id="L988">			_listening = true;</span>
<span class="nc" id="L989">		}</span>

		public void propertyChange(PropertyChangeEvent evt)
		{
<span class="nc bnc" id="L993" title="All 2 branches missed.">			if (_listening)</span>
			{
<span class="nc" id="L995">				propertiesHaveChanged(evt.getPropertyName());</span>
			}
<span class="nc" id="L997">		}</span>
	}

<span class="nc" id="L1000">	private class SqlComboListener implements ActionListener</span>
	{
<span class="nc" id="L1002">		private boolean _listening = true;</span>

		void stopListening()
		{
<span class="nc" id="L1006">			_listening = false;</span>
<span class="nc" id="L1007">		}</span>

		void startListening()
		{
<span class="nc" id="L1011">			_listening = true;</span>
<span class="nc" id="L1012">		}</span>

		public void actionPerformed(ActionEvent evt)
		{
<span class="nc bnc" id="L1016" title="All 2 branches missed.">			if (_listening)</span>
			{
				// Because the datamodel for the combobox may be shared
				// between sessions we only want to update the sql entry area
				// if this is actually the combox box that a new item has been
				// selected in.
//				SessionWindowManager winMgr = _session.getApplication().getSessionWindowManager();
//				if (winMgr.getInternalFrame(_session).isSelected())
//				{
<span class="nc" id="L1025">					copySelectedItemToEntryArea();</span>
				}
<span class="nc" id="L1027">			}</span>
//		}

//		private void copySelectedItemToEntryArea()
//		{
//			SQLHistoryItem item = (SQLHistoryItem)_sqlCombo.getSelectedItem();
//			if (item != null)
//			{
//				appendSQL(item.getSQL());
//			}
//		}
	}

<span class="nc" id="L1040">	private class LimitRowsCheckBoxListener implements ChangeListener</span>
	{
		public void stateChanged(ChangeEvent evt)
		{
<span class="nc bnc" id="L1044" title="All 2 branches missed.">			if (_propsListener != null)</span>
			{
<span class="nc" id="L1046">				_propsListener.stopListening();</span>
			}
			try
			{
<span class="nc" id="L1050">				final boolean limitRows = ((JCheckBox)evt.getSource()).isSelected();</span>
<span class="nc" id="L1051">				_nbrRows.setEnabled(limitRows);</span>
<span class="nc" id="L1052">				_session.getProperties().setSQLLimitRows(limitRows);</span>
			}
			finally
			{
<span class="nc bnc" id="L1056" title="All 2 branches missed.">				if (_propsListener != null)</span>
				{
<span class="nc" id="L1058">					_propsListener.startListening();</span>
				}
			}
<span class="nc" id="L1061">		}</span>
	}

<span class="nc" id="L1064">	private class LimitRowsTextBoxListener implements DocumentListener</span>
	{
		public void insertUpdate(DocumentEvent evt)
		{
<span class="nc" id="L1068">			updateProperties(evt);</span>
<span class="nc" id="L1069">		}</span>

		public void changedUpdate(DocumentEvent evt)
		{
<span class="nc" id="L1073">			updateProperties(evt);</span>
<span class="nc" id="L1074">		}</span>

		public void removeUpdate(DocumentEvent evt)
		{
<span class="nc" id="L1078">			updateProperties(evt);</span>
<span class="nc" id="L1079">		}</span>
		@SuppressWarnings(&quot;unused&quot;)
		private void updateProperties(DocumentEvent evt)
		{
<span class="nc bnc" id="L1083" title="All 2 branches missed.">			if (_propsListener != null)</span>
			{
<span class="nc" id="L1085">				_propsListener.stopListening();</span>
			}
			try
			{
<span class="nc" id="L1089">				_session.getProperties().setSQLNbrRowsToShow(_nbrRows.getInt());</span>
			}
			finally
			{
<span class="nc bnc" id="L1093" title="All 2 branches missed.">				if (_propsListener != null)</span>
				{
<span class="nc" id="L1095">					_propsListener.startListening();</span>
				}
			}
<span class="nc" id="L1098">		}</span>
	}


	private class CopyLastButton extends JButton
	{
        private static final long serialVersionUID = 1L;

        CopyLastButton(IApplication app)
<span class="nc" id="L1107">		{</span>
<span class="nc" id="L1108">			super();</span>
<span class="nc" id="L1109">			final SquirrelResources rsrc = app.getResources();</span>
<span class="nc" id="L1110">			final ImageIcon icon = rsrc.getIcon(SquirrelResources.IImageNames.COPY_SELECTED);</span>
<span class="nc" id="L1111">			setIcon(icon);</span>
            // i18n[SQLPanel.copylastbutton.hint=Copy current SQL history to entry area]
<span class="nc" id="L1113">			String hint = s_stringMgr.getString(&quot;SQLPanel.copylastbutton.hint&quot;);</span>
<span class="nc" id="L1114">            setToolTipText(hint);</span>
<span class="nc" id="L1115">			Dimension dm = getPreferredSize();</span>
<span class="nc" id="L1116">			dm.setSize(dm.height, dm.height);</span>
<span class="nc" id="L1117">			setPreferredSize(dm);</span>
<span class="nc" id="L1118">			addActionListener(new ActionListener()</span>
<span class="nc" id="L1119">			{</span>
				public void actionPerformed(ActionEvent e)
				{
<span class="nc" id="L1122">					copySelectedItemToEntryArea();</span>
<span class="nc" id="L1123">				}</span>
			});
<span class="nc" id="L1125">		}</span>
	}

	private class ShowHistoryButton extends JButton
	{
        private static final long serialVersionUID = 1L;

        ShowHistoryButton(IApplication app)
<span class="nc" id="L1133">		{</span>
<span class="nc" id="L1134">         final SquirrelResources rsrc = app.getResources();</span>
<span class="nc" id="L1135">         final ImageIcon icon = rsrc.getIcon(SquirrelResources.IImageNames.SQL_HISTORY);</span>
<span class="nc" id="L1136">         setIcon(icon);</span>
         // i18n[SQLPanel.openSqlHistory.hint=Open SQL History]
<span class="nc" id="L1138">         String hint = s_stringMgr.getString(&quot;SQLPanel.openSqlHistory.hint&quot;);</span>
<span class="nc" id="L1139">         setToolTipText(hint);</span>
<span class="nc" id="L1140">         Dimension dm = getPreferredSize();</span>
<span class="nc" id="L1141">         dm.setSize(dm.height, dm.height);</span>
<span class="nc" id="L1142">			setPreferredSize(dm);</span>
<span class="nc" id="L1143">         addActionListener(_session.getApplication().getActionCollection().get(OpenSqlHistoryAction.class));</span>
<span class="nc" id="L1144">		}</span>
	}

	/**
	 * This class is responsible for listening for sql that executes
	 * for a SQLExecuterPanel and adding it to the SQL history.
	 */
<span class="nc" id="L1151">	private class SQLExecutorHistoryListener extends SQLExecutionAdapter</span>
	{
      public void statementExecuted(String sql)
      {
<span class="nc" id="L1155">         _panelAPI.addSQLToHistory(sql);</span>
<span class="nc" id="L1156">      }</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>