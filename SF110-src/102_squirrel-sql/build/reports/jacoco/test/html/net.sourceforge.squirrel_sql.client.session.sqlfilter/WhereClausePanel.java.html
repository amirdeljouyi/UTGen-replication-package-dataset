<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WhereClausePanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.sqlfilter</a> &gt; <span class="el_source">WhereClausePanel.java</span></div><h1>WhereClausePanel.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session.sqlfilter;
/*
 * Copyright (C) 2003 Maury Hammel
 * mjhammel@users.sourceforge.net
 *
 * Adapted from SessionSQLPropertiesPanel.java by Colin Bell.
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.Component;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Map;
import java.util.SortedSet;

import javax.swing.BorderFactory;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;

import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
/**
 * This panel allows the user to change the where clause for a Contents tab query.
 *
 * @author &lt;A HREF=&quot;mailto:mjhammel@users.sourceforge.net&quot;&gt;Maury Hammel&lt;/A&gt;
 */
public class WhereClausePanel implements ISQLFilterPanel
{
    /** Internationalized strings for this class. */
<span class="nc" id="L53">    private static final StringManager s_stringMgr =</span>
<span class="nc" id="L54">        StringManagerFactory.getStringManager(WhereClausePanel.class);    </span>
    
	/** A class containing the information about the SQL filters. */
<span class="nc" id="L57">	private SQLFilterClauses _sqlFilterClauses = new SQLFilterClauses();</span>

	/** The actual GUI panel that allows user to do the maintenance. */
	private WhereClauseSubPanel _myPanel;

	/**
	 * Create a new instance of a WhereClausePanel.
	 *
	 * @param	columnList	A list of column names for the database table.
	 * @param	textColumns	A collection of column names that are &quot;text&quot;
	 * 						columns.
	 * @param	tableName	The name of the database table that the filter
	 * 						information will apply to.
	 *
	 * @throws	IllegalArgumentException
	 *			The exception thrown if invalid arguments are passed.
	 */
	public WhereClausePanel(SortedSet&lt;String&gt; columnList, 
	                        Map&lt;String, Boolean&gt; textColumns, 
							String tableName)
		throws IllegalArgumentException
	{
<span class="nc" id="L79">		super();</span>
<span class="nc" id="L80">		_myPanel = new WhereClauseSubPanel(columnList, textColumns, tableName);</span>
<span class="nc" id="L81">	}</span>

	/**
	 * Initialize the components of the WhereClausePanel.
	 *
	 * @param	sqlFilterClauses	An instance of a class containing information
	 *								about SQL filters already in place for the table.
	 *
	 * @throws	IllegalArgumentException
	 *			Thrown if an invalid argument is passed.
	 */
	public void initialize(SQLFilterClauses sqlFilterClauses)
		throws IllegalArgumentException
	{
<span class="nc bnc" id="L95" title="All 2 branches missed.">		if (sqlFilterClauses == null)</span>
		{
<span class="nc" id="L97">			throw new IllegalArgumentException(&quot;Null sqlFilterClauses passed&quot;);</span>
		}

<span class="nc" id="L100">		_sqlFilterClauses = sqlFilterClauses;</span>
<span class="nc" id="L101">		_myPanel.loadData(_sqlFilterClauses);</span>
<span class="nc" id="L102">	}</span>

	/**
	 * Returns the panel created by the class.
	 *
	 * @return Return an instance of a WhereClauseSubPanel.
	 */
	public Component getPanelComponent()
	{
<span class="nc" id="L111">		return _myPanel;</span>
	}

	/**
	 * Get the title of the panel.
	 *
	 * @return	Return a string containing the title of the panl.
	 */
	public String getTitle()
	{
<span class="nc" id="L121">		return WhereClauseSubPanel.WhereClauseSubPanelI18n.WHERE_CLAUSE;</span>
	}

	/**
	 * Get the hint text associated with the panel.
	 *
	 * @return A String value containing the hint text associated with the panel.
	 */
	public String getHint()
	{
<span class="nc" id="L131">		return WhereClauseSubPanel.WhereClauseSubPanelI18n.HINT;</span>
	}

	/**
	 * Update the current session with any changes to the SQL filter
	 * information.
	 */
	public void applyChanges()
	{
<span class="nc" id="L140">		_myPanel.applyChanges(_sqlFilterClauses);</span>
<span class="nc" id="L141">	}</span>

	/**
	 * A private class that makes up the bulk of the GUI for the panel.
	 */
	private static final class WhereClauseSubPanel extends JPanel
	{
        private static final long serialVersionUID = 1L;

        /**
		 * This interface defines locale specific strings. This should be
		 * replaced with a property file.
		 */
		interface WhereClauseSubPanelI18n
		{
		    //i18n[WhereClausePanel.columnLabel=Columns]
		    String COLUMNS = 
<span class="nc" id="L158">		        s_stringMgr.getString(&quot;WhereClausePanel.columnLabel&quot;);</span>
		    //i18n[WhereClausePanel.operatorsLabel=Operators]
		    String OPERATORS = 
<span class="nc" id="L161">		        s_stringMgr.getString(&quot;WhereClausePanel.operatorsLabel&quot;);</span>
		    //i18n[WhereClausePanel.valueLabel=Value]            
<span class="nc" id="L163">		    String VALUE = s_stringMgr.getString(&quot;WhereClausePanel.valueLabel&quot;);</span>
		    //i18n[WhereClausePanel.whereClauseLabel=Where Clause]            
		    String WHERE_CLAUSE = 
<span class="nc" id="L166">		        s_stringMgr.getString(&quot;WhereClausePanel.whereClauseLabel&quot;);</span>
		    //i18n[WhereClausePanel.hint=Where clause for the selected table]            
<span class="nc" id="L168">		    String HINT = s_stringMgr.getString(&quot;WhereClausePanel.hint&quot;);</span>
		    //i18n[WhereClausePanel.addLabel=Add]            
<span class="nc" id="L170">		    String ADD = s_stringMgr.getString(&quot;WhereClausePanel.addLabel&quot;);</span>
            // The following strings are SQL tokens and should therefore *not*
            // be internationalized
		    String AND = &quot;AND&quot;;                 // No I18N
		    String OR = &quot;OR&quot;;                   // No I18N            
		    String LIKE = &quot;LIKE&quot;;               // No I18N            
		    String IN = &quot;IN&quot;;                   // No I18N            
		    String IS_NULL = &quot;IS NULL&quot;;         // No I18N             
		    String IS_NOT_NULL = &quot;IS NOT NULL&quot;; // No I18N
		}

		/**
		 * A JComboBox component containing a list of the names of the
		 * columns for the current table.
		 */
		private JComboBox _columnCombo;

		/** A label to identify the column combo box. */
<span class="nc" id="L188">		private JLabel _columnLabel = new JLabel(WhereClauseSubPanelI18n.COLUMNS);</span>

		/**
		 * A JComboBox containing a list of valid operators used in SQL Where clause
		 * expressions.
		 */
<span class="nc" id="L194">		private OperatorTypeCombo _operatorCombo = new OperatorTypeCombo();</span>

		/** A label to identify the operator combo box. */
<span class="nc" id="L197">		private JLabel _operatorLabel = new JLabel(WhereClauseSubPanelI18n.OPERATORS);</span>

		/** A field used to enter the right-hand side of a WhereClause expression. */
<span class="nc" id="L200">		private JTextField _valueField = new JTextField(10);</span>

		/** A label to identify the valueField text area. */
<span class="nc" id="L203">		private JLabel _valueLabel = new JLabel(WhereClauseSubPanelI18n.VALUE);</span>

		/** A JComboBox used to list Where clause connectors. */
<span class="nc" id="L206">		private AndOrCombo _andOrCombo = new AndOrCombo();</span>

		/** A label to identify the andor combo box. */
<span class="nc" id="L209">		private JLabel _andOrLabel = new JLabel(&quot; &quot;);</span>

		/** A text area used to contain all of the information for the Where clause. */
<span class="nc" id="L212">		private JTextArea _whereClauseArea = new JTextArea(10, 40);</span>

		/**
		 * A button used to add information from the combo boxes and text fields into the
		 * Where clause text area.
		 */
<span class="nc" id="L218">		private JButton _addTextButton = new JButton(WhereClauseSubPanelI18n.ADD);</span>

		/** The name of the database table the Where clause applies to. */
		private String _tableName;

		/** A List containing the names of the text columns */
		private Map&lt;String, Boolean&gt; _textColumns;

		/**
		 * A JPanel used for a bulk of the GUI elements of the panel.
		 *
		 * @param	columnList	A list of the column names for the table.
		 * @param	tableName	The name of the database table.
		 */
		WhereClauseSubPanel(SortedSet&lt;String&gt; columnList, 
		                    Map&lt;String, Boolean&gt; textColumns,
						    String tableName)
<span class="nc" id="L235">		{</span>
<span class="nc" id="L236">			_tableName = tableName;</span>
<span class="nc" id="L237">			_columnCombo = new JComboBox(columnList.toArray());</span>
<span class="nc" id="L238">			_textColumns = textColumns;</span>
<span class="nc" id="L239">			createGUI();</span>
<span class="nc" id="L240">		}</span>

		/**
		 * Load existing clause information into the panel.
		 *
		 * @param	sqlFilterClauses	An instance of a class containing
		 * 								SQL Filter information for the current table.
		 *
		 */
		void loadData(SQLFilterClauses sqlFilterClauses)
		{
<span class="nc" id="L251">			_whereClauseArea.setText(</span>
<span class="nc" id="L252">				sqlFilterClauses.get(getClauseIdentifier(), _tableName));</span>
<span class="nc" id="L253">		}</span>

		/** Update the current SQuirreL session with any changes to the SQL filter
		 * information.
		 * @param sqlFilterClauses An instance of a class containing SQL Filter information for the current table.
		 *
		 */
		void applyChanges(SQLFilterClauses sqlFilterClauses)
		{
<span class="nc" id="L262">			sqlFilterClauses.put(</span>
<span class="nc" id="L263">				getClauseIdentifier(),</span>
				_tableName,
<span class="nc" id="L265">				_whereClauseArea.getText());</span>
<span class="nc" id="L266">		}</span>

		/**
		 * Create the GUI elements for the panel.
		 */
		private void createGUI()
		{
<span class="nc" id="L273">         setLayout(new GridBagLayout());</span>


         GridBagConstraints gbc;

<span class="nc" id="L278">         gbc = new GridBagConstraints(0,0,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L279">         add(createControlsPanel(), gbc);</span>

<span class="nc" id="L281">         _whereClauseArea.setBorder(BorderFactory.createEtchedBorder());</span>
<span class="nc" id="L282">         _whereClauseArea.setLineWrap(true);</span>
<span class="nc" id="L283">         JScrollPane sp = new JScrollPane(_whereClauseArea, JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,</span>
                                    JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);


<span class="nc" id="L287">         gbc = new GridBagConstraints(0,1,1,1,1,1,GridBagConstraints.NORTHWEST, GridBagConstraints.BOTH, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L288">         add(sp, gbc);</span>
<span class="nc" id="L289">		}</span>


      private JPanel createControlsPanel()
      {

<span class="nc" id="L295">         JPanel ret = new JPanel(new GridBagLayout());</span>
         GridBagConstraints gbc;

<span class="nc" id="L298">         gbc = new GridBagConstraints(0,0,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.NONE, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L299">         ret.add(_andOrLabel, gbc);</span>

<span class="nc" id="L301">         gbc = new GridBagConstraints(0,1,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L302">         ret.add(_andOrCombo, gbc);</span>



<span class="nc" id="L306">         gbc = new GridBagConstraints(1,0,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.NONE, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L307">         ret.add(_columnLabel, gbc);</span>

<span class="nc" id="L309">         gbc = new GridBagConstraints(1,1,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L310">         ret.add(_columnCombo, gbc);</span>



<span class="nc" id="L314">         gbc = new GridBagConstraints(2,0,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.NONE, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L315">         ret.add(_operatorLabel, gbc);</span>

<span class="nc" id="L317">         gbc = new GridBagConstraints(2,1,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L318">         ret.add(_operatorCombo, gbc);</span>



<span class="nc" id="L322">         gbc = new GridBagConstraints(3,0,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.NONE, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L323">         ret.add(_valueLabel, gbc);</span>

<span class="nc" id="L325">         gbc = new GridBagConstraints(3,1,1,1,1,0,GridBagConstraints.NORTHWEST, GridBagConstraints.BOTH, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L326">         ret.add(_valueField, gbc);</span>



<span class="nc" id="L330">         gbc = new GridBagConstraints(4,1,1,1,0,0,GridBagConstraints.NORTHWEST, GridBagConstraints.NONE, new Insets(4,4,4,4),0,0);</span>
<span class="nc" id="L331">         ret.add(_addTextButton, gbc);</span>


<span class="nc" id="L334">         _addTextButton.addActionListener(new ActionListener()</span>
<span class="nc" id="L335">         {</span>
            public void actionPerformed(ActionEvent evt)
            {
<span class="nc" id="L338">               addTextToClause();</span>
<span class="nc" id="L339">            }</span>
         });

<span class="nc" id="L342">         return ret;</span>
      }

      private static final class OperatorTypeCombo extends JComboBox
		{
            private static final long serialVersionUID = 1L;

            OperatorTypeCombo()
<span class="nc" id="L350">			{</span>
<span class="nc" id="L351">				addItem(&quot;=&quot;);</span>
<span class="nc" id="L352">				addItem(&quot;&lt;&gt;&quot;);</span>
<span class="nc" id="L353">				addItem(&quot;&gt;&quot;);</span>
<span class="nc" id="L354">				addItem(&quot;&lt;&quot;);</span>
<span class="nc" id="L355">				addItem(&quot;&gt;=&quot;);</span>
<span class="nc" id="L356">				addItem(&quot;&lt;=&quot;);</span>
<span class="nc" id="L357">				addItem(WhereClauseSubPanelI18n.IN);</span>
<span class="nc" id="L358">				addItem(WhereClauseSubPanelI18n.LIKE);</span>
<span class="nc" id="L359">				addItem(WhereClauseSubPanelI18n.IS_NULL);</span>
<span class="nc" id="L360">				addItem(WhereClauseSubPanelI18n.IS_NOT_NULL);</span>
<span class="nc" id="L361">			}</span>
		}

		private static final class AndOrCombo extends JComboBox
		{
            private static final long serialVersionUID = 1L;

            AndOrCombo()
<span class="nc" id="L369">			{</span>
<span class="nc" id="L370">				addItem(WhereClauseSubPanelI18n.AND);</span>
<span class="nc" id="L371">				addItem(WhereClauseSubPanelI18n.OR);</span>
<span class="nc" id="L372">			}</span>
		}

		/**
		 * Combine the information entered in the combo boxes
		 * and the text field and add it to the Where clause information.
		 */
		private void addTextToClause()
		{
<span class="nc" id="L381">			String value = _valueField.getText();</span>
<span class="nc" id="L382">			String operator = (String)_operatorCombo.getSelectedItem();</span>
<span class="nc bnc" id="L383" title="All 4 branches missed.">			if (((value != null) &amp;&amp; (value.length() &gt; 0))</span>
<span class="nc bnc" id="L384" title="All 2 branches missed.">					|| ((operator.equals(WhereClauseSubPanelI18n.IS_NULL))</span>
<span class="nc bnc" id="L385" title="All 2 branches missed.">					|| 	(operator.equals(WhereClauseSubPanelI18n.IS_NOT_NULL))))</span>
			{
<span class="nc" id="L387">				String andOr = (String)_andOrCombo.getSelectedItem();</span>
<span class="nc" id="L388">				String column = (String)_columnCombo.getSelectedItem();</span>

				// Put the 'AND' or the 'OR' in front of the clause if
				// there are already values in the text area.
<span class="nc bnc" id="L392" title="All 2 branches missed.">				if (_whereClauseArea.getText().length() &gt; 0)</span>
				{
<span class="nc" id="L394">					_whereClauseArea.append(&quot;\n&quot; + andOr + &quot; &quot;);</span>
				}

				// If the operator is 'IN' and there are no parenthesis
				// around the value, put them there.
<span class="nc bnc" id="L399" title="All 2 branches missed.">				if (operator.equals(WhereClauseSubPanelI18n.IN)</span>
<span class="nc bnc" id="L400" title="All 2 branches missed.">					&amp;&amp; (!value.trim().startsWith(&quot;(&quot;)))</span>
				{
<span class="nc" id="L402">					value = &quot;(&quot; + value + &quot;)&quot;;</span>
				}

				// If the column is a text column, and there aren't single quotes around the value, put them there.

<span class="nc bnc" id="L407" title="All 4 branches missed.">				else if ((value != null) &amp;&amp; (value.length() &gt; 0)) </span>
				{
<span class="nc bnc" id="L409" title="All 2 branches missed.">					if (_textColumns.containsKey(column)</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">							&amp;&amp; (!value.trim().startsWith(&quot;'&quot;)))</span>
					{
<span class="nc" id="L412">						value = &quot;'&quot; + value + &quot;'&quot;;</span>
					}
				}
<span class="nc" id="L415">				_whereClauseArea.append(column + &quot; &quot; + operator);</span>

<span class="nc bnc" id="L417" title="All 4 branches missed.">				if ((value != null) &amp;&amp; (value.length() &gt; 0)) </span>
				{
<span class="nc" id="L419">					_whereClauseArea.append(&quot; &quot; + value);</span>
				}
			}
<span class="nc" id="L422">			_valueField.setText(&quot;&quot;);</span>
<span class="nc" id="L423">		}</span>

		/**
		 * Erase all information for the current filter.
		 */
		public void clearFilter()
		{
<span class="nc" id="L430">			_whereClauseArea.setText(&quot;&quot;);</span>
<span class="nc" id="L431">		}</span>
	}

	/**
	 * Erase any information for the appropriate filter.
	 */
	public void clearFilter()
	{
<span class="nc" id="L439">		_myPanel.clearFilter();</span>
<span class="nc" id="L440">	}</span>

	/**
	 * Get a value that uniquely identifies this SQL filter clause.
	 *
	 * @return Return a String value containing an identifing value.
	 */
	public static String getClauseIdentifier()
	{
<span class="nc" id="L449">		return WhereClauseSubPanel.WhereClauseSubPanelI18n.WHERE_CLAUSE;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>