<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HtmlViewerPanel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui</a> &gt; <span class="el_source">HtmlViewerPanel.java</span></div><h1>HtmlViewerPanel.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui;
/*
 * Copyright (C) 2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.BorderLayout;
import java.awt.Point;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.io.IOException;
import java.net.URL;
import java.util.LinkedList;
import java.util.List;
import java.util.ListIterator;

import javax.swing.BorderFactory;
import javax.swing.JEditorPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.event.EventListenerList;
import javax.swing.event.HyperlinkEvent;
import javax.swing.event.HyperlinkListener;
import javax.swing.text.html.HTMLDocument;
import javax.swing.text.html.HTMLFrameHyperlinkEvent;

import net.sourceforge.squirrel_sql.fw.gui.CursorChanger;
import net.sourceforge.squirrel_sql.fw.gui.TextPopupMenu;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;
/**
 * This panel shows the contents of a HTML file.
 *
 * @author  &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class HtmlViewerPanel extends JPanel
{
	/** Logger for this class. */
<span class="nc" id="L54">	private final static ILogger s_log =</span>
<span class="nc" id="L55">		LoggerController.createLogger(HtmlViewerPanel.class);</span>

    /** Internationalized strings for this class. */
<span class="nc" id="L58">    private static final StringManager s_stringMgr =</span>
<span class="nc" id="L59">        StringManagerFactory.getStringManager(HtmlViewerPanel.class);    </span>
    
	/** Text area containing the HTML. */
<span class="nc" id="L62">	private final JEditorPane _contentsTxt = new JEditorPane();</span>

	/** &lt;TT&gt;JScrollPane&lt;/TT&gt; for &lt;TT&gt;_contentsText&lt;/TT&gt;. */
	private JScrollPane _contentsScrollPane;

	/** Original URL (home). */
	private URL _homeURL;

	/** Current URL. */
	private URL _currentURL;

	/** History of links. */
<span class="nc" id="L74">	private final List&lt;URL&gt; _history = new LinkedList&lt;URL&gt;();</span>

	/** Current index into &lt;TT&gt;_history&lt;/TT&gt;. */
<span class="nc" id="L77">	private int _historyIndex = -1;</span>

	/**
	 * Collection of listeners for events in this object.
	 */
<span class="nc" id="L82">	private EventListenerList _listenerList = new EventListenerList();</span>

	/**
	 * Ctor.
	 * 
	 * @param	url	URL to home document.
	 */
	public HtmlViewerPanel(URL url)
	{
<span class="nc" id="L91">		super();</span>
<span class="nc" id="L92">		createGUI();</span>
<span class="nc" id="L93">		setHomeURL(url);</span>
<span class="nc" id="L94">		setURL(url);</span>
<span class="nc" id="L95">	}</span>

	/**
	 * Retrieve the current URL.
	 * 
	 * @return	The current URL.
	 */
	public URL getURL()
	{
<span class="nc" id="L104">		return _currentURL;</span>
	}

	/**
	 * Retrieve the home URL.
	 * 
	 * @return	The home URL.
	 */
	public URL getHomeURL()
	{
<span class="nc" id="L114">		return _homeURL;</span>
	}

	/**
	 * Specify the URL that is to the consider the &amp;quot;Home&amp;quot; URL. THis
	 * does &lt;EM&gt;not&lt;/EM&gt; change the current URL for this viewer.
	 * 
	 * @param	homeURL		The new home URL.
	 */
	public void setHomeURL(URL homeURL)
	{
<span class="nc" id="L125">		_homeURL = homeURL;</span>
<span class="nc" id="L126">		fireHomeURLChanged();</span>
<span class="nc" id="L127">	}</span>

	/**
	 * Adds a listener to this object.
	 *
	 * @param	lis		Listener to be added.
	 */
	public void addListener(IHtmlViewerPanelListener lis)
	{
<span class="nc" id="L136">		_listenerList.add(IHtmlViewerPanelListener.class, lis);</span>
<span class="nc" id="L137">	}</span>

	/**
	 * Removes a listener from this object.
	 *
	 * @param	lis	Listener to be removed.
	 */
	void removeListener(IHtmlViewerPanelListener lis)
	{
<span class="nc" id="L146">		_listenerList.remove(IHtmlViewerPanelListener.class, lis);</span>
<span class="nc" id="L147">	}</span>

	public synchronized void gotoURL(URL url) throws IOException
	{
<span class="nc bnc" id="L151" title="All 2 branches missed.">		if (url == null)</span>
		{
<span class="nc" id="L153">			throw new IllegalArgumentException(&quot;URL == null&quot;);</span>
		}
<span class="nc bnc" id="L155" title="All 2 branches missed.">		if (!url.equals(_currentURL))</span>
		{
<span class="nc" id="L157">			ListIterator&lt;URL&gt; it = _history.listIterator(_historyIndex + 1);</span>
<span class="nc bnc" id="L158" title="All 2 branches missed.">			while (it.hasNext())</span>
			{
<span class="nc" id="L160">				it.next();</span>
<span class="nc" id="L161">				it.remove();</span>
			}
<span class="nc" id="L163">			_history.add(url);</span>
<span class="nc" id="L164">			_historyIndex = _history.size() - 1;</span>
<span class="nc" id="L165">			_contentsTxt.setPage(url);</span>
<span class="nc" id="L166">			_currentURL = url;</span>
<span class="nc" id="L167">			fireURLChanged();</span>
		}
<span class="nc" id="L169">	}</span>

	public synchronized void goBack()
	{
<span class="nc bnc" id="L173" title="All 4 branches missed.">		if (_historyIndex &gt; 0 &amp;&amp; _historyIndex &lt; _history.size())</span>
		{
<span class="nc" id="L175">			displayURL(_history.get(--_historyIndex));</span>
		}
<span class="nc" id="L177">	}</span>

	public synchronized void goForward()
	{
<span class="nc bnc" id="L181" title="All 4 branches missed.">		if (_historyIndex &gt; -1 &amp;&amp; _historyIndex &lt; _history.size() - 1)</span>
		{
<span class="nc" id="L183">			displayURL(_history.get(++_historyIndex));</span>
		}
<span class="nc" id="L185">	}</span>

	public synchronized void goHome()
	{
<span class="nc" id="L189">		_historyIndex = 0;</span>
<span class="nc" id="L190">		displayURL(_homeURL);</span>
<span class="nc" id="L191">	}</span>

	public void refreshPage()
	{
<span class="nc" id="L195">		final Point pos = _contentsScrollPane.getViewport().getViewPosition();</span>
<span class="nc" id="L196">		displayURL(_currentURL);</span>
<span class="nc" id="L197">		_contentsScrollPane.getViewport().setViewPosition(pos);</span>
<span class="nc" id="L198">	}</span>

	/**
	 * Displayed the passed URL in this panel.
	 * 
	 * @param	url		URL to be displayed.
	 */
	private synchronized void setURL(URL url)
	{
<span class="nc bnc" id="L207" title="All 2 branches missed.">		if (url != null)</span>
		{
<span class="nc" id="L209">			CursorChanger cursorChg = new CursorChanger(this);</span>
<span class="nc" id="L210">			cursorChg.show();</span>
			try
			{
				// Causes NPE in JDK 1.3.1
				//_contentsTxt.setText(&quot;&quot;);
<span class="nc" id="L215">				displayURL(url);</span>
<span class="nc" id="L216">				_history.add(url);</span>
<span class="nc" id="L217">				_historyIndex = 0;</span>
			}
			finally
			{
<span class="nc" id="L221">				cursorChg.restore();</span>
			}
		}
<span class="nc" id="L224">	}</span>

	/**
	 * Display the passed URL. This method does not affect the URL history, it
	 * merely displays the URL.
	 * 
	 * @param	url	The URL to display.
	 */
	private void displayURL(URL url)
	{
<span class="nc bnc" id="L234" title="All 2 branches missed.">		if (url != null)</span>
		{
			try
			{
<span class="nc" id="L238">				_contentsTxt.setPage(url);</span>
<span class="nc" id="L239">				_currentURL = url;</span>
<span class="nc" id="L240">				fireURLChanged();</span>
			}
<span class="nc" id="L242">			catch (Exception ex)</span>
			{
                // i18n[HtmlViewerPanel.error.displayurl=Error displaying URL]
<span class="nc" id="L245">				s_log.error(s_stringMgr.getString(&quot;HtmlViewerPanel.error.displayurl&quot;), ex);</span>
<span class="nc" id="L246">			}</span>
		}
<span class="nc" id="L248">	}</span>

	/**
	 * Fire a &quot;URL changed&quot; event to all listeners.
	 */
	private void fireURLChanged()
	{
		// Guaranteed to be non-null.
<span class="nc" id="L256">		Object[] listeners = _listenerList.getListenerList();</span>
		// Process the listeners last to first, notifying
		// those that are interested in this event.
<span class="nc" id="L259">		HtmlViewerPanelListenerEvent evt = null;</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">		for (int i = listeners.length - 2; i &gt;= 0; i-=2 )</span>
		{
<span class="nc bnc" id="L262" title="All 2 branches missed.">			if (listeners[i] == IHtmlViewerPanelListener.class)</span>
			{
				// Lazily create the event.
<span class="nc bnc" id="L265" title="All 2 branches missed.">				if (evt == null)</span>
				{
<span class="nc" id="L267">					evt = new HtmlViewerPanelListenerEvent(this);</span>
				}
<span class="nc" id="L269">				((IHtmlViewerPanelListener)listeners[i + 1]).currentURLHasChanged(evt);</span>
			}
		}
<span class="nc" id="L272">	}</span>

	/**
	 * Fire a &quot;Home URL changed&quot; event to all listeners.
	 */
	private void fireHomeURLChanged()
	{
		// Guaranteed to be non-null.
<span class="nc" id="L280">		Object[] listeners = _listenerList.getListenerList();</span>
		// Process the listeners last to first, notifying
		// those that are interested in this event.
<span class="nc" id="L283">		HtmlViewerPanelListenerEvent evt = null;</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">		for (int i = listeners.length - 2; i &gt;= 0; i-=2 )</span>
		{
<span class="nc bnc" id="L286" title="All 2 branches missed.">			if (listeners[i] == IHtmlViewerPanelListener.class)</span>
			{
				// Lazily create the event.
<span class="nc bnc" id="L289" title="All 2 branches missed.">				if (evt == null)</span>
				{
<span class="nc" id="L291">					evt = new HtmlViewerPanelListenerEvent(this);</span>
				}
<span class="nc" id="L293">				((IHtmlViewerPanelListener)listeners[i + 1]).homeURLHasChanged(evt);</span>
			}
		}
<span class="nc" id="L296">	}</span>

	/**
	 * Create user interface.
	 */
	private void createGUI()
	{
<span class="nc" id="L303">		setLayout(new BorderLayout());</span>
<span class="nc" id="L304">		add(createMainPanel(), BorderLayout.CENTER);</span>
<span class="nc" id="L305">	}</span>

	/**
	 * Create the main panel.
	 */
	private JPanel createMainPanel()
	{
<span class="nc" id="L312">		_contentsTxt.setEditable(false);</span>
<span class="nc" id="L313">		_contentsTxt.setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L314">		final TextPopupMenu pop = new TextPopupMenu();</span>
<span class="nc" id="L315">		pop.setTextComponent(_contentsTxt);</span>
<span class="nc" id="L316">		_contentsTxt.addMouseListener(new MouseAdapter()</span>
<span class="nc" id="L317">		{</span>
			public void mousePressed(MouseEvent evt)
			{
<span class="nc bnc" id="L320" title="All 2 branches missed.">				if (evt.isPopupTrigger())</span>
				{
<span class="nc" id="L322">					pop.show(evt.getComponent(), evt.getX(), evt.getY());</span>
				}
<span class="nc" id="L324">			}</span>
			public void mouseReleased(MouseEvent evt)
			{
<span class="nc bnc" id="L327" title="All 2 branches missed.">				if (evt.isPopupTrigger())</span>
				{
<span class="nc" id="L329">					pop.show(evt.getComponent(), evt.getX(), evt.getY());</span>
				}
<span class="nc" id="L331">			}</span>
		});

<span class="nc" id="L334">		final JPanel pnl = new JPanel(new BorderLayout());</span>
<span class="nc" id="L335">		_contentsTxt.setBorder(BorderFactory.createEmptyBorder(0, 1, 0, 0));</span>
<span class="nc" id="L336">		_contentsTxt.addHyperlinkListener(createHyperLinkListener());</span>
<span class="nc" id="L337">		_contentsScrollPane = new JScrollPane(_contentsTxt,</span>
									JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,
									JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
<span class="nc" id="L340">		pnl.add(_contentsScrollPane, BorderLayout.CENTER);</span>

<span class="nc" id="L342">		return pnl;</span>
	}

	private HyperlinkListener createHyperLinkListener()
	{
<span class="nc" id="L347">		return new HyperlinkListener()</span>
<span class="nc" id="L348">		{</span>
			public void hyperlinkUpdate(HyperlinkEvent e)
			{
<span class="nc bnc" id="L351" title="All 2 branches missed.">				if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED)</span>
				{
<span class="nc bnc" id="L353" title="All 2 branches missed.">					if (e instanceof HTMLFrameHyperlinkEvent)</span>
					{
<span class="nc" id="L355">						((HTMLDocument)_contentsTxt.getDocument()).processHTMLFrameHyperlinkEvent((HTMLFrameHyperlinkEvent)e);</span>
					}
					else
					{
						try
						{
<span class="nc" id="L361">							gotoURL(e.getURL());</span>
						}
<span class="nc" id="L363">						catch (IOException ex)</span>
						{
                            // i18n[HtmlViewerPanel.error.processhyperlink=Error processing hyperlink]
<span class="nc" id="L366">							s_log.error(s_stringMgr.getString(&quot;HtmlViewerPanel.error.processhyperlink&quot;), ex);</span>
<span class="nc" id="L367">						}</span>
					}
				}
<span class="nc" id="L370">			}</span>
		};
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>