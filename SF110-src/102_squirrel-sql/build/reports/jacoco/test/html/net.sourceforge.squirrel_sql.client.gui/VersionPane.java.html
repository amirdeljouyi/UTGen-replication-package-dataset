<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VersionPane.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui</a> &gt; <span class="el_source">VersionPane.java</span></div><h1>VersionPane.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui;

/*
 * Copyright (C) 2006 Rob Manning
 * manningr@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.Cursor;
import java.awt.Desktop;
import java.awt.Point;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionListener;
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;

import javax.swing.JTextPane;
import javax.swing.text.AttributeSet;
import javax.swing.text.DefaultStyledDocument;
import javax.swing.text.Document;
import javax.swing.text.Element;
import javax.swing.text.SimpleAttributeSet;
import javax.swing.text.StyleConstants;
import javax.swing.text.StyledDocument;
import javax.swing.text.html.HTML;

import net.sourceforge.squirrel_sql.client.Version;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

/**
 * A class that encapsulates the work of rendering the version and copyright.
 * This is used in both the splash screen and the about dialog.
 */
public class VersionPane extends JTextPane implements MouseMotionListener,MouseListener{

<span class="nc" id="L51">    private boolean _showWebsite = false;</span>

    /** Logger for this class. */
<span class="nc" id="L54">    private final static ILogger s_log =</span>
<span class="nc" id="L55">        LoggerController.createLogger(VersionPane.class);</span>

    /**
     * Constructor
     * @param showWebsite whether or not to display the website.  This is done
     *                    in the about dialog but not in the splash screen.
     */
<span class="nc" id="L62">    public VersionPane(boolean showWebsite) {</span>
<span class="nc" id="L63">        _showWebsite = showWebsite;</span>
<span class="nc" id="L64">        init();</span>
<span class="nc" id="L65">    }</span>

    /**
     * Renders the content.
     */
    private void init() {
<span class="nc" id="L71">        String content = getContent();</span>
<span class="nc" id="L72">        setContentType(&quot;text/html&quot;);</span>
<span class="nc" id="L73">        StyledDocument doc = getStyledDocument();</span>
<span class="nc" id="L74">        SimpleAttributeSet s = new SimpleAttributeSet();</span>
<span class="nc" id="L75">        StyleConstants.setAlignment(s, StyleConstants.ALIGN_CENTER);</span>
<span class="nc" id="L76">        StyleConstants.setBold(s, true);</span>
        try {
<span class="nc" id="L78">            doc.setParagraphAttributes(0,content.length(), s, false);</span>
<span class="nc" id="L79">            doc.insertString(0, content, s);</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">            if (_showWebsite) {</span>
<span class="nc" id="L81">            	String webContent = Version.getWebSite();</span>
<span class="nc" id="L82">            	SimpleAttributeSet w = new SimpleAttributeSet();</span>
<span class="nc" id="L83">                StyleConstants.setAlignment(w, StyleConstants.ALIGN_CENTER);</span>
<span class="nc" id="L84">                StyleConstants.setUnderline(w, true);</span>
<span class="nc" id="L85">                SimpleAttributeSet hrefAttr = new SimpleAttributeSet();</span>
<span class="nc" id="L86">                hrefAttr.addAttribute(HTML.Attribute.HREF, Version.getWebSite());</span>
<span class="nc" id="L87">                w.addAttribute(HTML.Tag.A, hrefAttr);</span>
<span class="nc" id="L88">                doc.setParagraphAttributes(content.length(),webContent.length(), w, false);</span>
<span class="nc" id="L89">                doc.insertString(content.length(), webContent, w);</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">                if (Desktop.isDesktopSupported()){</span>
<span class="nc" id="L91">                	addMouseListener(this);</span>
<span class="nc" id="L92">                	addMouseMotionListener(this);</span>
                }
            }
<span class="nc" id="L95">        } catch (Exception e) {</span>
<span class="nc" id="L96">            s_log.error(&quot;init: Unexpected exception &quot;+e.getMessage());</span>
<span class="nc" id="L97">        }</span>
<span class="nc" id="L98">        setOpaque(false);</span>

<span class="nc" id="L100">    }</span>

	/**
     * Constructs the text that gets rendered.
     *
     * @return version and copyright info ( and possibly website url )
     */
    private String getContent() {
<span class="nc" id="L108">        StringBuffer text = new StringBuffer();</span>
<span class="nc" id="L109">        text.append(Version.getVersion());</span>
<span class="nc" id="L110">        text.append(&quot;\n&quot;);</span>
<span class="nc" id="L111">        text.append(Version.getCopyrightStatement());</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">         if (_showWebsite) {</span>
<span class="nc" id="L113">        	 text.append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        	 if (!Desktop.isDesktopSupported()) {</span>
<span class="nc" id="L115">        		 text.append(Version.getWebSite());</span>
        	 }
         }
<span class="nc" id="L118">        return text.toString();</span>
    }

	public void mouseMoved(MouseEvent ev) {
<span class="nc" id="L122">        JTextPane editor = (JTextPane) ev.getSource();</span>
<span class="nc" id="L123">        editor.setEditable(false);</span>
<span class="nc" id="L124">          Point pt = new Point(ev.getX(), ev.getY());</span>
<span class="nc" id="L125">          int pos = editor.viewToModel(pt);</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">          if (pos &gt;= 0) {</span>
<span class="nc" id="L127">            Document eDoc = editor.getDocument();</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">            if (eDoc instanceof DefaultStyledDocument) {</span>
<span class="nc" id="L129">              DefaultStyledDocument hdoc =</span>
                (DefaultStyledDocument) eDoc;
<span class="nc" id="L131">              Element e = hdoc.getCharacterElement(pos);</span>
<span class="nc" id="L132">              AttributeSet a = e.getAttributes();</span>
<span class="nc" id="L133">              AttributeSet tagA = (AttributeSet) a.getAttribute(HTML.Tag.A);</span>
<span class="nc" id="L134">              String href = null;</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">              if (tagA!=null){</span>
<span class="nc" id="L136">                  href = (String)tagA.getAttribute(HTML.Attribute.HREF);</span>
              }
<span class="nc bnc" id="L138" title="All 2 branches missed.">              if (href != null) {</span>
<span class="nc" id="L139">                  editor.setToolTipText(href);</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">                  if (editor.getCursor().getType() != Cursor.HAND_CURSOR) {</span>
<span class="nc" id="L141">                      editor.setCursor(new Cursor(Cursor.HAND_CURSOR));</span>
                  }
              }
              else {
<span class="nc" id="L145">                  editor.setToolTipText(null);</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">                  if (editor.getCursor().getType() != Cursor.DEFAULT_CURSOR) {</span>
<span class="nc" id="L147">                      editor.setCursor(new Cursor(Cursor.DEFAULT_CURSOR));</span>
                }
              }
            }
<span class="nc" id="L151">          }</span>
          else {
<span class="nc" id="L153">              editor.setToolTipText(null);</span>
          }
<span class="nc" id="L155">        }</span>

	public void mouseClicked(MouseEvent ev) {
<span class="nc" id="L158">	    JTextPane editor = (JTextPane) ev.getSource();</span>
<span class="nc" id="L159">	     editor.setEditable(false);</span>
<span class="nc" id="L160">	      Point pt = new Point(ev.getX(), ev.getY());</span>
<span class="nc" id="L161">	      int pos = editor.viewToModel(pt);</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">	      if (pos &gt;= 0) {</span>
<span class="nc" id="L163">	        Document eDoc = editor.getDocument();</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">	        if (eDoc instanceof DefaultStyledDocument) {</span>
<span class="nc" id="L165">	          DefaultStyledDocument hdoc =</span>
	            (DefaultStyledDocument) eDoc;
<span class="nc" id="L167">	          Element e = hdoc.getCharacterElement(pos);</span>
<span class="nc" id="L168">	          AttributeSet a = e.getAttributes();</span>
<span class="nc" id="L169">	          AttributeSet tagA = (AttributeSet) a.getAttribute(HTML.Tag.A);</span>
<span class="nc" id="L170">	          String href = null;</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">	          if (tagA!=null){</span>
<span class="nc" id="L172">	        	  href = (String)tagA.getAttribute(HTML.Attribute.HREF);</span>
	          }
<span class="nc bnc" id="L174" title="All 2 branches missed.">	          if (href != null) {</span>
<span class="nc" id="L175">	        	Desktop desktop = Desktop.getDesktop();</span>
	        	try {
<span class="nc" id="L177">					desktop.browse(new URI(href));</span>
<span class="nc" id="L178">				} catch (IOException e1) {</span>
<span class="nc" id="L179">					 s_log.error(&quot;mouseClicked: Unexpected exception &quot;+e1.getMessage());</span>
<span class="nc" id="L180">				} catch (URISyntaxException e1) {</span>
<span class="nc" id="L181">					 s_log.error(&quot;mouseClicked: Unexpected exception &quot;+e1.getMessage());</span>
<span class="nc" id="L182">				}</span>

	        }
	      }

	    }
<span class="nc" id="L188">	}</span>

	@SuppressWarnings(&quot;all&quot;)
	public void mouseEntered(MouseEvent arg0) {
<span class="nc" id="L192">	}</span>
	@SuppressWarnings(&quot;all&quot;)
	public void mouseExited(MouseEvent arg0) {
<span class="nc" id="L195">	}</span>

	@SuppressWarnings(&quot;all&quot;)
	public void mousePressed(MouseEvent arg0) {
<span class="nc" id="L199">	}</span>

	@SuppressWarnings(&quot;all&quot;)
	public void mouseReleased(MouseEvent arg0) {
<span class="nc" id="L203">	}</span>

	@SuppressWarnings(&quot;all&quot;)
	public void mouseDragged(MouseEvent arg0) {
<span class="nc" id="L207">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>