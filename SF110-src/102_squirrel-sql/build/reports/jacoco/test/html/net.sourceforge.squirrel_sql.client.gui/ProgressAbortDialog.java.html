<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProgressAbortDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui</a> &gt; <span class="el_source">ProgressAbortDialog.java</span></div><h1>ProgressAbortDialog.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2011 Stefan Willinger
 * wis775@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
package net.sourceforge.squirrel_sql.client.gui;

import java.awt.Dialog;
import java.awt.Dimension;
import java.awt.Frame;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.Window;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.text.DateFormat;
import java.util.Date;

import javax.swing.AbstractAction;
import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JComponent;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JProgressBar;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.SwingUtilities;

import org.apache.commons.lang.StringUtils;

import net.sourceforge.squirrel_sql.client.action.SquirrelAction;
import net.sourceforge.squirrel_sql.fw.gui.GUIUtils;
import net.sourceforge.squirrel_sql.fw.sql.ProgressAbortCallback;
import net.sourceforge.squirrel_sql.fw.sql.ProgressCallBack;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.StringUtilities;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

/**
 * A monitor, which provide certain information to the user about a long running
 * operation. The user get information about the progress of a long running
 * operation. In addition to the progress bar, each step is reported in a
 * &quot;history area&quot;. This monitor provides the opportunity to cancel the
 * operation. Sometimes it is not known, how many tasks must be completed, until
 * the whole operation is finished. For this case, the monitor can be run in
 * &quot;indeterminate&quot; mode. Depending on indeterminate or not, we can or cann't
 * claim that the overall progress is finished.
 * 
 * @see JProgressBar#isIndeterminate()
 * @author Stefan Willinger
 * 
 */
public class ProgressAbortDialog extends JDialog implements ProgressAbortCallback {

<span class="nc" id="L77">	private final ProgressAbortDialog instance = this;</span>

	/**
	 * serialVersionUID
	 */
	private static final long serialVersionUID = 1L;

	/** Logger for this class. */
<span class="nc" id="L85">	public final static ILogger s_log = LoggerController.createLogger(ProgressAbortDialog.class);</span>

	/** Internationalized strings for this class */
<span class="nc" id="L88">	private static final StringManager s_stringMgr = StringManagerFactory</span>
<span class="nc" id="L89">			.getStringManager(ProgressAbortDialog.class);</span>

	static interface i18n {
		// i18n[ProgressAbortDialog.defaultLoadingPrefix=Loading:]
<span class="nc" id="L93">		String DEFAULT_LOADING_PREFIX = s_stringMgr.getString(&quot;ProgressAbortDialog.defaultLoadingPrefix&quot;);</span>

		// i18n[ProgressAbortDialog.initialLoadingPrefix=Loading...]
<span class="nc" id="L96">		String INITIAL_LOADING_PREFIX = s_stringMgr.getString(&quot;ProgressAbortDialog.initialLoadingPrefix&quot;);</span>

		// i18n[ProgressAbortDialog.confirmCancel=Should the export be
		// canceled?]
<span class="nc" id="L100">		String CONFIRM_CANCEL = s_stringMgr.getString(&quot;ProgressAbortDialog.confirmCancel&quot;);</span>

<span class="nc" id="L102">		String TITEL_PROGRESS = s_stringMgr.getString(&quot;ProgressAbortDialog.titelProgress&quot;);</span>
		
<span class="nc" id="L104">		String CANCEL = s_stringMgr.getString(&quot;ProgressAbortDialog.cancel&quot;);</span>

<span class="nc" id="L106">		String CANCEL_FEEDBACK = s_stringMgr.getString(&quot;ProgressAbortDialog.cancelFeedback&quot;);</span>
	}

	/**
	 * Date format for the history area.
	 */
<span class="nc" id="L112">	private DateFormat dateFormat = DateFormat.getTimeInstance();</span>

	/**
	 * The number of task, until the operation is completed.
	 */
<span class="nc" id="L117">	private int itemCount = 0;</span>

	/**
	 * The progress-bar itself
	 */
<span class="nc" id="L122">	private JProgressBar progressBar = null;</span>

	/**
	 * The place to show the current task
	 */
<span class="nc" id="L127">	private JLabel statusLabel = null;</span>

	/**
	 * The place to show additional information about the current task
	 */
<span class="nc" id="L132">	private JLabel additionalStatusLabel = null;</span>

<span class="nc" id="L134">	private String _loadingPrefix = i18n.DEFAULT_LOADING_PREFIX;</span>

	/**
	 * True, if we dont know, how many tasks are neccesary to complete the
	 * operation
	 * 
	 * @see JProgressBar#setIndeterminate(boolean)
	 */
	private boolean indeterminate;

	/**
	 * A callback handler, if the user decided to abort the operation.
	 */
	private IAbortEventHandler abortHandler;

	private JButton cancelButton;

	/**
	 * Area to display the already completed tasks of this operation.
	 */
	private JTextArea historyArea;

	/**
	 * Description of the long running operation.
	 */
	private JComponent taskDescriptionComponent;

	/**
	 * Flag, if the operation should be canceled
	 */
	private boolean canceled;

	/**
	 * Someone told us, that all tasks are done.
	 */
	private boolean finished;

	/**
	 * A simple description for this task
	 */
<span class="nc" id="L174">	private String simpleTaskDescription = null;</span>

	/**
	 * Constructor which accepts a Dialog owner
	 * 
	 * @param owner
	 *            the owner Dialog from which the dialog is displayed or null if
	 *            this dialog has no owner
	 * @param title
	 *            the String to display in the dialog's title bar
	 * @param totalItems
	 *            the total number of items at which point progress will
	 *            indicate complete
	 * @param indeterminate
	 *            true, if the {@link JProgressBar} should be used in the
	 *            indeterminate mode.
	 * @param abortHandler
	 *            If the underlying tasks maybe aborted, then a abort Handler is
	 *            needed. Otherwise null.
	 * @see JProgressBar#setIndeterminate(boolean)
	 */
	public ProgressAbortDialog(Dialog owner, String title, String description, int totalItems,
			boolean indeterminate, IAbortEventHandler abortHandler) {
<span class="nc" id="L197">		super(owner, title);</span>
<span class="nc" id="L198">		init(description, totalItems, indeterminate, abortHandler);</span>
<span class="nc" id="L199">	}</span>

	/**
	 * Constructor which accepts a Frame owner
	 * 
	 * @param owner
	 *            the owner Frame from which the dialog is displayed or null if
	 *            this dialog has no owner
	 * @param title
	 *            the String to display in the dialog's title bar
	 * @param totalItems
	 *            the total number of items at which point progress will
	 *            indicate complete
	 * @param indeterminate
	 *            true, if the {@link JProgressBar} should be used in the
	 *            indeterminate mode.
	 * @param abortHandler
	 *            If the underlying tasks maybe aborted, then a abort Handler is
	 *            needed. Otherwise null.
	 * @see JProgressBar#setIndeterminate(boolean)
	 */
	public ProgressAbortDialog(Frame owner, String title, String description, int totalItems,
			boolean indeterminate, IAbortEventHandler abortHandler) {
<span class="nc" id="L222">		super(owner, title);</span>
<span class="nc" id="L223">		setLocationRelativeTo(owner);</span>
<span class="nc" id="L224">		init(description, totalItems, indeterminate, abortHandler);</span>
<span class="nc" id="L225">	}</span>

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.ProgressCallBack#setTotalItems(int)
	 */
	@Override
	public void setTotalItems(int totalItems) {
<span class="nc" id="L232">		itemCount = totalItems;</span>
<span class="nc" id="L233">		progressBar.setMaximum(totalItems);</span>
<span class="nc" id="L234">	}</span>

	/**
	 * Sets the text that is displayed before each thing being loaded. By
	 * default this is the string &quot;Loading:&quot;.
	 * 
	 * @param loadingPrefix
	 */
	@Override
	public void setLoadingPrefix(String loadingPrefix) {
<span class="nc bnc" id="L244" title="All 2 branches missed.">		if (loadingPrefix != null) {</span>
<span class="nc" id="L245">			_loadingPrefix = loadingPrefix;</span>
		}
<span class="nc" id="L247">	}</span>

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.ProgressCallBack#currentlyLoading(java.lang.String)
	 */
	@Override
	public void currentlyLoading(final String simpleName) {
<span class="nc" id="L254">		final StringBuilder statusText = appendPrefixed(simpleName);</span>

		try {
<span class="nc" id="L257">			GUIUtils.processOnSwingEventThread(new Runnable() {</span>
				public void run() {
<span class="nc" id="L259">					statusLabel.setText(statusText.toString());</span>
<span class="nc" id="L260">					setTaskStatus(null);</span>
<span class="nc" id="L261">					progressBar.setValue(progressBar.getValue() + 1);</span>

<span class="nc bnc" id="L263" title="All 2 branches missed.">					if (finishedLoading()) {</span>
<span class="nc" id="L264">						ProgressAbortDialog.this.setVisible(false);</span>
<span class="nc" id="L265">						return;</span>
					}
<span class="nc" id="L267">				}</span>
			});
<span class="nc" id="L269">		} catch (Exception e) {</span>
<span class="nc" id="L270">			s_log.error(&quot;Unexpected exception: &quot; + e.getMessage(), e);</span>
<span class="nc" id="L271">		}</span>
<span class="nc" id="L272">	}</span>

	private StringBuilder appendPrefixed(String simpleName) {
<span class="nc" id="L275">		final StringBuilder statusText = new StringBuilder();</span>
<span class="nc" id="L276">		statusText.append(_loadingPrefix);</span>
<span class="nc" id="L277">		statusText.append(&quot; &quot;);</span>
<span class="nc" id="L278">		statusText.append(simpleName);</span>

<span class="nc" id="L280">		appendToHistory(statusText.toString());</span>
<span class="nc" id="L281">		return statusText;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.ProgressAbortCallback#setTaskStatus(java.lang.String)
	 */
	@Override
	public void setTaskStatus(final String status) {
<span class="nc" id="L289">		final StringBuilder statusText = new StringBuilder();</span>

<span class="nc bnc" id="L291" title="All 2 branches missed.">		if (StringUtils.isNotBlank(status)) {</span>
<span class="nc" id="L292">			statusText.append(status);</span>
		} else {
<span class="nc" id="L294">			statusText.append(&quot; &quot;);</span>
		}

		try {
<span class="nc" id="L298">			GUIUtils.processOnSwingEventThread(new Runnable() {</span>
				public void run() {
<span class="nc" id="L300">					String statusTextToAppend = statusText.toString();</span>
<span class="nc" id="L301">					additionalStatusLabel.setText(statusTextToAppend);</span>
<span class="nc bnc" id="L302" title="All 2 branches missed.">					if (StringUtils.isNotBlank(statusTextToAppend)) {</span>
<span class="nc" id="L303">						appendPrefixed(statusTextToAppend);</span>
					}
<span class="nc" id="L305">				}</span>

			});
<span class="nc" id="L308">		} catch (Exception e) {</span>
<span class="nc" id="L309">			s_log.error(&quot;Unexpected exception: &quot; + e.getMessage(), e);</span>
<span class="nc" id="L310">		}</span>
<span class="nc" id="L311">	}</span>

	/**
	 * @param string
	 */
	private void appendToHistory(String string) {
<span class="nc bnc" id="L317" title="All 2 branches missed.">		if (this.historyArea != null) {</span>
<span class="nc" id="L318">			final StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L319">			sb.append(dateFormat.format(new Date()));</span>
<span class="nc" id="L320">			sb.append(&quot;: &quot;);</span>
<span class="nc" id="L321">			sb.append(string);</span>
<span class="nc" id="L322">			sb.append(StringUtilities.getEolStr());</span>

<span class="nc" id="L324">         Runnable runnable = new Runnable()</span>
<span class="nc" id="L325">         {</span>
            public void run()
            {
<span class="nc" id="L328">               historyArea.append(sb.toString());</span>
<span class="nc" id="L329">               historyArea.setCaretPosition(historyArea.getDocument().getLength());</span>
<span class="nc" id="L330">            }</span>
         };

<span class="nc" id="L333">         GUIUtils.processOnSwingEventThread(runnable);</span>
      }
<span class="nc" id="L335">	}</span>

	/**
	 * Checks, if the overall progress is finished. If this monitor runs in
	 * indeterminate mode, we didn't know, if the progress is finished.
	 * Otherwise, the finish state is interpreted, if we have reached the
	 * necessary task count.
	 * 
	 * @see net.sourceforge.squirrel_sql.fw.sql.ProgressCallBack#finishedLoading()
	 */
	@Override
	public boolean finishedLoading() {
<span class="nc bnc" id="L347" title="All 2 branches missed.">		if (finished) {</span>
<span class="nc" id="L348">			progressBar.setIndeterminate(false);</span>
<span class="nc" id="L349">			return true;</span>
		}

<span class="nc bnc" id="L352" title="All 2 branches missed.">		if (this.indeterminate) {</span>
<span class="nc" id="L353">			return false;</span>
		}
<span class="nc bnc" id="L355" title="All 2 branches missed.">		return progressBar.getValue() == itemCount;</span>
	}

	/**
	 * Dispose this monitor.
	 * 
	 * @see java.awt.Window#dispose()
	 */
	@Override
	public void dispose() {
<span class="nc" id="L365">		GUIUtils.processOnSwingEventThread(new Runnable() {</span>
			@Override
			public void run() {
<span class="nc" id="L368">				callDisposeFromSuperClass();</span>
<span class="nc" id="L369">			}</span>
		});
<span class="nc" id="L371">	}</span>

	/**
	 * Since {@link #dispose()} uses an {@link Runnable}, we needs an delegate
	 * to call the overridden dispose method.
	 */
	private void callDisposeFromSuperClass() {
<span class="nc" id="L378">		super.dispose();</span>
<span class="nc" id="L379">	}</span>

	/**
	 * @see java.awt.Dialog#setVisible(boolean)
	 */
	@Override
	public void setVisible(final boolean b) {
<span class="nc" id="L386">		GUIUtils.processOnSwingEventThread(new Runnable() {</span>
			@Override
			public void run() {
<span class="nc" id="L389">				callSetVisibleFromSuperClass(b);</span>
<span class="nc" id="L390">			}</span>
		});
<span class="nc" id="L392">	}</span>

	/**
	 * Since {@link #setVisible(boolean)} uses an {@link Runnable}, we needs an
	 * delegate to call the overridden setVisible method.
	 */
	private void callSetVisibleFromSuperClass(final boolean b) {
<span class="nc" id="L399">		super.setVisible(b);</span>
<span class="nc" id="L400">	}</span>

	private void init(String description, int totalItems, boolean intermediate,
			IAbortEventHandler abortHandler) {
<span class="nc" id="L404">		itemCount = totalItems;</span>
<span class="nc" id="L405">		this.indeterminate = intermediate;</span>
<span class="nc" id="L406">		this.abortHandler = abortHandler;</span>
<span class="nc" id="L407">		this.simpleTaskDescription = description;</span>
<span class="nc" id="L408">		final Window owner = super.getOwner();</span>
<span class="nc" id="L409">		final ProgressAbortDialog dialog = this;</span>
<span class="nc" id="L410">		createGUI();</span>
<span class="nc" id="L411">		setLocationRelativeTo(owner);</span>
<span class="nc" id="L412">		dialog.setVisible(true);</span>
<span class="nc" id="L413">	}</span>

	private void createGUI() {
<span class="nc" id="L416">		JPanel dialogPanel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L417">		dialogPanel.setBorder(BorderFactory.createEmptyBorder(0, 10, 0, 10));</span>
		GridBagConstraints c;

<span class="nc" id="L420">		c = new GridBagConstraints();</span>
<span class="nc" id="L421">		c.gridx = 0;</span>
<span class="nc" id="L422">		c.gridy = 0;</span>
<span class="nc" id="L423">		c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L424">		c.weightx = 1.0;</span>
<span class="nc" id="L425">		c.weighty = 0.5;</span>
<span class="nc" id="L426">		c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L427">		c.insets = new Insets(4, 0, 4, 0);</span>
<span class="nc" id="L428">		taskDescriptionComponent = createTaskDescripion();</span>
<span class="nc" id="L429">		dialogPanel.add(taskDescriptionComponent, c);</span>

<span class="nc" id="L431">		c.gridy++;</span>
<span class="nc" id="L432">		JPanel progressPanel = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L433">		progressPanel.setMinimumSize(new Dimension(400, 200));</span>
<span class="nc" id="L434">		progressPanel.setPreferredSize(new Dimension(400, 200));</span>
<span class="nc" id="L435">		progressPanel.setBorder(BorderFactory.createTitledBorder(&quot;Progress&quot;));</span>
<span class="nc" id="L436">		dialogPanel.add(progressPanel, c);</span>

<span class="nc" id="L438">		c.gridy = 0;</span>
<span class="nc" id="L439">		c.gridx = 0;</span>
<span class="nc" id="L440">		c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L441">		c.weightx = 0.0;</span>
<span class="nc" id="L442">		c.weighty = 0.0;</span>
<span class="nc" id="L443">		c.insets = new Insets(4, 10, 4, 10);</span>
<span class="nc" id="L444">		statusLabel = new JLabel(i18n.INITIAL_LOADING_PREFIX);</span>
<span class="nc" id="L445">		progressPanel.add(statusLabel, c);</span>

<span class="nc" id="L447">		c.gridy++;</span>
<span class="nc" id="L448">		c.insets = new Insets(4, 10, 4, 10);</span>
<span class="nc" id="L449">		additionalStatusLabel = new JLabel(&quot; &quot;); // Must be a space :-)</span>
<span class="nc" id="L450">		progressPanel.add(additionalStatusLabel, c);</span>

<span class="nc" id="L452">		c.gridy++;</span>
<span class="nc" id="L453">		c.weightx = 1.0;</span>
<span class="nc" id="L454">		progressBar = new JProgressBar(0, itemCount);</span>
<span class="nc" id="L455">		progressBar.setIndeterminate(indeterminate);</span>
<span class="nc" id="L456">		progressPanel.add(progressBar, c);</span>

<span class="nc" id="L458">		c.gridy++;</span>
<span class="nc" id="L459">		c.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L460">		c.weightx = 1.0;</span>
<span class="nc" id="L461">		c.weighty = 1.0;</span>
<span class="nc" id="L462">		historyArea = new JTextArea();</span>
<span class="nc" id="L463">		historyArea.setEditable(false);</span>
<span class="nc" id="L464">		JScrollPane jScrollPane = new JScrollPane(historyArea);</span>
<span class="nc" id="L465">		progressPanel.add(jScrollPane, c);</span>

<span class="nc bnc" id="L467" title="All 2 branches missed.">		if (abortHandler != null) {</span>
<span class="nc" id="L468">			cancelButton = new JButton(new CancelAction());</span>

<span class="nc" id="L470">			c.gridy++;</span>
<span class="nc" id="L471">			c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L472">			c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L473">			c.weightx = 0.0;</span>
<span class="nc" id="L474">			c.weighty = 0.0;</span>
<span class="nc" id="L475">			dialogPanel.add(cancelButton, c);</span>
		}

<span class="nc" id="L478">		super.getContentPane().add(dialogPanel);</span>
<span class="nc" id="L479">		super.pack();</span>
<span class="nc" id="L480">		super.setSize(new Dimension(450, 450));</span>
<span class="nc" id="L481">		super.setDefaultCloseOperation(JDialog.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L482">		super.addWindowListener(new WindowCloseListener());</span>
<span class="nc" id="L483">	}</span>

	/**
	 * Creates the description of the task/operation. Per default, this will be
	 * a simple {@link JLabel} with the {@link #simpleTaskDescription} of this
	 * dialog.. A subclass may override this for a solution, that is more
	 * sophisticated.
	 * 
	 * @see #simpleTaskDescription
	 * @return a {@link JComponent} as task description
	 */
	protected JComponent createTaskDescripion() {
<span class="nc" id="L495">		return new JLabel(this.simpleTaskDescription);</span>
	}

	/**
	 * Just for playing...
	 */
	public static void main(String[] args) throws Exception {
<span class="nc" id="L502">		IAbortEventHandler handler = new IAbortEventHandler() {</span>

			@Override
			public void cancel() {
<span class="nc" id="L506">				System.out.println(&quot;echo&quot;);</span>
<span class="nc" id="L507">			}</span>
		};

<span class="nc" id="L510">		ProgressCallBack dialog = new ProgressAbortDialog((Frame) null, &quot;myTitle&quot;, &quot;myDescription&quot;, 0, true,</span>
				handler);
<span class="nc" id="L512">		Thread.sleep(3000);</span>
<span class="nc" id="L513">		dialog.currentlyLoading(&quot;Running query&quot;);</span>
<span class="nc" id="L514">		Thread.sleep(3000);</span>
<span class="nc" id="L515">		dialog.currentlyLoading(&quot;1 Row(s) exported&quot;);</span>
<span class="nc" id="L516">		Thread.sleep(3000);</span>
<span class="nc" id="L517">		dialog.currentlyLoading(&quot;100 Row(s) exported&quot;);</span>
<span class="nc" id="L518">		Thread.sleep(3000);</span>
<span class="nc" id="L519">		dialog.currentlyLoading(&quot;1000 Row(s) exported&quot;);</span>
<span class="nc" id="L520">		dialog.currentlyLoading(&quot;Finished&quot;);</span>

<span class="nc" id="L522">	}</span>

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.IAbortController#isStop()
	 */
	@Override
	public boolean isStop() {
<span class="nc" id="L529">		return this.canceled;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.IAbortController#isVisble()
	 */
	@Override
	public boolean isVisble() {
<span class="nc" id="L537">		return super.isVisible();</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.sql.ProgressAbortCallback#setFinished()
	 */
	@Override
	public void setFinished() {
<span class="nc" id="L545">		this.finished = true;</span>
<span class="nc" id="L546">	}</span>

	/**
	 * A WindowListener that responds to windowClosed events. To close the
	 * window, means the same as pressing the cancel button.
	 */
<span class="nc" id="L552">	private class WindowCloseListener extends WindowAdapter {</span>
		/**
		 * @see java.awt.event.WindowAdapter#windowClosing(java.awt.event.WindowEvent)
		 */
		@Override
		public void windowClosing(WindowEvent e) {
<span class="nc" id="L558">			new CancelAction().clickCancel();</span>
<span class="nc" id="L559">		}</span>
	}

	
	
	/**
	 * Action to handle the request for canceling.
	 * The user will be asked, if he really want to cancel the progress.
	 * @author Stefan Willinger
	 *
	 */
	private class CancelAction extends AbstractAction {
		
<span class="nc" id="L572">		public CancelAction() {</span>
<span class="nc" id="L573">			super(i18n.CANCEL);</span>
<span class="nc" id="L574">		}</span>

		/**
		 * @see java.awt.event.ActionListener#actionPerformed(java.awt.event.ActionEvent)
		 */
		@Override
		public void actionPerformed(ActionEvent e) {
<span class="nc" id="L581">			clickCancel();</span>
<span class="nc" id="L582">		}</span>

		/**
		 * Ask the user, if he really want to cancel the action. If yes, do the cancel.
		 */
		public void clickCancel() {
<span class="nc" id="L588">			int ret = JOptionPane.showConfirmDialog(instance, i18n.CONFIRM_CANCEL);</span>
<span class="nc bnc" id="L589" title="All 2 branches missed.">			if (JOptionPane.YES_OPTION == ret) {</span>
<span class="nc" id="L590">				appendToHistory(i18n.CANCEL_FEEDBACK);</span>
<span class="nc" id="L591">				canceled = true;</span>
<span class="nc" id="L592">				cancelButton.setEnabled(false);</span>
<span class="nc" id="L593">				abortHandler.cancel();</span>
			}
<span class="nc" id="L595">		}</span>
		

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>