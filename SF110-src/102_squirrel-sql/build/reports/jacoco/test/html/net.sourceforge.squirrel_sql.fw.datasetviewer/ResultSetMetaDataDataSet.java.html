<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResultSetMetaDataDataSet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.datasetviewer</a> &gt; <span class="el_source">ResultSetMetaDataDataSet.java</span></div><h1>ResultSetMetaDataDataSet.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.datasetviewer;
/*
 * Copyright (C) 2001-2004 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.lang.reflect.Method;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.util.*;

import net.sourceforge.squirrel_sql.fw.util.IMessageHandler;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

public class ResultSetMetaDataDataSet implements IDataSet
{

<span class="nc" id="L35">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L36">		StringManagerFactory.getStringManager(ResultSetMetaDataDataSet.class);</span>


   private interface i18n
	{
		String UNSUPPORTED = &quot;&lt;Unsupported&gt;&quot;;
		// i18n[resultSetMentaDataSet.propName=Property Name]
<span class="nc" id="L43">		String NAME_COLUMN = s_stringMgr.getString(&quot;resultSetMentaDataSet.propName&quot;);</span>
//		String NULL = &quot;&lt;null&gt;&quot;;
		// i18n[resultSetMentaDataSet.val=Value]
<span class="nc" id="L46">		String VALUE_COLUMN = s_stringMgr.getString(&quot;resultSetMentaDataSet.val&quot;);</span>
	}

	/** Logger for this class. */
<span class="nc" id="L50">	private static ILogger s_log =</span>
<span class="nc" id="L51">		LoggerController.createLogger(ResultSetMetaDataDataSet.class);</span>

	private DataSetDefinition _dsDef;
	private Iterator&lt;Object[]&gt; _rowsIter;
	private Object[] _row;

	/**
	 * Data. Each element is an array of String objects representing a column from
	 * the result set metadata.
	 */
<span class="nc" id="L61">	private List&lt;Object[]&gt; _data = new ArrayList&lt;Object[]&gt;();</span>

	/**
	 * Collection of method names that are considered to the
	 * &amp;quot;properties&amp;quot; of the &lt;TT&gt;ResultSetMetaData&lt;/TT&gt; class.
	 */
<span class="nc" id="L67">	private static final Method[] s_methods = createMetaDataMethodArray();</span>

   private static Method[] createMetaDataMethodArray()
   {
      try
      {
<span class="nc" id="L73">         return new Method[]</span>
            {
<span class="nc" id="L75">               ResultSetMetaData.class.getMethod(&quot;getColumnName&quot;, Integer.TYPE),</span>
<span class="nc" id="L76">               ResultSetMetaData.class.getMethod(&quot;getColumnTypeName&quot;, Integer.TYPE),</span>
<span class="nc" id="L77">               ResultSetMetaData.class.getMethod(&quot;getPrecision&quot;, Integer.TYPE),</span>
<span class="nc" id="L78">               ResultSetMetaData.class.getMethod(&quot;getScale&quot;, Integer.TYPE),</span>
<span class="nc" id="L79">               ResultSetMetaData.class.getMethod(&quot;isNullable&quot;, Integer.TYPE),</span>
<span class="nc" id="L80">               ResultSetMetaData.class.getMethod(&quot;getTableName&quot;, Integer.TYPE),</span>
<span class="nc" id="L81">               ResultSetMetaData.class.getMethod(&quot;getSchemaName&quot;, Integer.TYPE),</span>
<span class="nc" id="L82">               ResultSetMetaData.class.getMethod(&quot;getCatalogName&quot;, Integer.TYPE),</span>
<span class="nc" id="L83">               ResultSetMetaData.class.getMethod(&quot;getColumnClassName&quot;, Integer.TYPE),</span>
<span class="nc" id="L84">               ResultSetMetaData.class.getMethod(&quot;getColumnDisplaySize&quot;, Integer.TYPE),</span>
<span class="nc" id="L85">               ResultSetMetaData.class.getMethod(&quot;getColumnLabel&quot;, Integer.TYPE),</span>
<span class="nc" id="L86">               ResultSetMetaData.class.getMethod(&quot;getColumnType&quot;, Integer.TYPE),</span>
<span class="nc" id="L87">               ResultSetMetaData.class.getMethod(&quot;isAutoIncrement&quot;, Integer.TYPE),</span>
<span class="nc" id="L88">               ResultSetMetaData.class.getMethod(&quot;isCaseSensitive&quot;, Integer.TYPE),</span>
<span class="nc" id="L89">               ResultSetMetaData.class.getMethod(&quot;isCurrency&quot;, Integer.TYPE),</span>
<span class="nc" id="L90">               ResultSetMetaData.class.getMethod(&quot;isDefinitelyWritable&quot;, Integer.TYPE),</span>
<span class="nc" id="L91">               ResultSetMetaData.class.getMethod(&quot;isReadOnly&quot;, Integer.TYPE),</span>
<span class="nc" id="L92">               ResultSetMetaData.class.getMethod(&quot;isSearchable&quot;, Integer.TYPE),</span>
<span class="nc" id="L93">               ResultSetMetaData.class.getMethod(&quot;isSigned&quot;, Integer.TYPE),</span>
<span class="nc" id="L94">               ResultSetMetaData.class.getMethod(&quot;isWritable&quot;, Integer.TYPE)</span>
            };
      }
<span class="nc" id="L97">      catch (NoSuchMethodException e)</span>
      {
<span class="nc" id="L99">         throw new RuntimeException(e);</span>
      }
   }

   public ResultSetMetaDataDataSet(ResultSet rs)
		throws IllegalArgumentException, DataSetException
	{
<span class="nc" id="L106">		this(getMetaDataFromResultSet(rs));</span>
<span class="nc" id="L107">	}</span>

	public ResultSetMetaDataDataSet(ResultSetMetaData md)
		throws IllegalArgumentException, DataSetException
	{
<span class="nc" id="L112">		super();</span>
<span class="nc" id="L113">		setResultSetMetaData(md);</span>
<span class="nc" id="L114">	}</span>

	public synchronized void setResultSetMetaData(ResultSetMetaData md)
		throws DataSetException
	{
<span class="nc" id="L119">		_dsDef = new DataSetDefinition(createColumnDefinitions());</span>
<span class="nc" id="L120">		load(md);</span>
<span class="nc" id="L121">	}</span>

	public final int getColumnCount()
	{
<span class="nc" id="L125">		return _dsDef.getColumnDefinitions().length;</span>
	}

	public DataSetDefinition getDataSetDefinition()
	{
<span class="nc" id="L130">		return _dsDef;</span>
	}

	public synchronized boolean next(IMessageHandler msgHandler)
		throws DataSetException
	{
<span class="nc bnc" id="L136" title="All 2 branches missed.">		if (_rowsIter.hasNext())</span>
		{
<span class="nc" id="L138">			_row = _rowsIter.next();</span>
		}
		else
		{
<span class="nc" id="L142">			_row = null;</span>
		}
<span class="nc bnc" id="L144" title="All 2 branches missed.">		return _row != null;</span>
	}

	public synchronized Object get(int columnIndex)
	{
<span class="nc" id="L149">		return _row[columnIndex];</span>
	}

	private ColumnDisplayDefinition[] createColumnDefinitions()
	{
<span class="nc" id="L154">      ColumnDisplayDefinition[] colDefs = new ColumnDisplayDefinition[s_methods.length + 1];</span>

<span class="nc" id="L156">      colDefs[0] = new ColumnDisplayDefinition(25, &quot;ColumnIndex&quot;);</span>

<span class="nc bnc" id="L158" title="All 2 branches missed.">      for (int i = 0; i &lt; s_methods.length; i++)</span>
      {
<span class="nc" id="L160">         colDefs[i+1] = new ColumnDisplayDefinition(25, s_methods[i].getName());</span>
      }

<span class="nc" id="L163">		return colDefs;</span>
	}

	private void load(ResultSetMetaData md) throws DataSetException
	{
		try
		{
<span class="nc bnc" id="L170" title="All 2 branches missed.">         for (int i = 1; i &lt; md.getColumnCount() + 1; ++i)</span>
         {
<span class="nc" id="L172">            Object[] line = new Object[s_methods.length + 1];</span>
<span class="nc" id="L173">            line[0] = i;</span>

<span class="nc" id="L175">            Object[] methodParms = new Object[] { Integer.valueOf(i) };</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">            for (int j = 0; j &lt; s_methods.length; j++)</span>
            {
<span class="nc" id="L178">               line[j+1] = executeGetter(md, s_methods[j], methodParms);</span>
            }
<span class="nc" id="L180">            _data.add(line);</span>
         }

<span class="nc" id="L183">			_rowsIter = _data.iterator();</span>
		}
<span class="nc" id="L185">		catch (SQLException ex)</span>
		{
<span class="nc" id="L187">			s_log.error(&quot;Error occured processing result set&quot;, ex);</span>
<span class="nc" id="L188">			throw new DataSetException(ex);</span>
<span class="nc" id="L189">		}</span>
<span class="nc" id="L190">	}</span>

   protected Object executeGetter(Object bean, Method getter, Object[] parms)
	{
		try
		{
<span class="nc" id="L196">			return getter.invoke(bean, parms);</span>
		}
<span class="nc" id="L198">		catch (Throwable th)</span>
		{
<span class="nc" id="L200">			return i18n.UNSUPPORTED;</span>
		}
	}

	private static ResultSetMetaData getMetaDataFromResultSet(ResultSet rs)
		throws IllegalArgumentException, DataSetException
	{
<span class="nc bnc" id="L207" title="All 2 branches missed.">		if (rs == null)</span>
		{
<span class="nc" id="L209">			throw new IllegalArgumentException(&quot;Null ResultSet passed&quot;);</span>
		}
		try
		{
<span class="nc" id="L213">			return rs.getMetaData();</span>
		}
<span class="nc" id="L215">		catch (SQLException ex)</span>
		{
<span class="nc" id="L217">			throw new DataSetException(ex);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>