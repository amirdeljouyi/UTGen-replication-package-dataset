<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApplicationFiles.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.util</a> &gt; <span class="el_source">ApplicationFiles.java</span></div><h1>ApplicationFiles.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.util;
/*
 * Copyright (C) 2001-2004 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.io.File;
import java.io.FilenameFilter;
import java.util.Arrays;

import net.sourceforge.squirrel_sql.fw.util.IJavaPropertyNames;

import net.sourceforge.squirrel_sql.client.ApplicationArguments;
/**
 * This class contains information about files and directories used by the
 * application.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class ApplicationFiles
{
	/** Name of directory to contain users settings. */
	private String _userSettingsDir;

	/** Name of folder that contains Squirrel app. */
	private final File _squirrelHomeDir;

	/** Name of folder that contains plugins. */
	private String _squirrelPluginsDir;

	/** Documentation folder. */
	private String _documentationDir;

	/** Name of folder that contains library jars */
	private String _libraryDir;
	
	/** Name of folder that contains update files */
	private String _updateDir;
	
	/** Flag for cleaning up execution log files on app entry. **/
<span class="nc" id="L54">	private static boolean needExecutionLogCleanup = true;</span>

	/** Flag for cleaning up debug log files on app entry. **/
<span class="nc" id="L57">	private static boolean needDebugLogCleanup = true;</span>

	/**
	 * Ctor.
	 */
	public ApplicationFiles()
	{
<span class="nc" id="L64">		super();</span>
<span class="nc" id="L65">		ApplicationArguments args = ApplicationArguments.getInstance();</span>

<span class="nc" id="L67">		final String homeDir = args.getSquirrelHomeDirectory();</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">		_squirrelHomeDir = new File(homeDir != null ? homeDir : System.getProperty(IJavaPropertyNames.USER_DIR));</span>
<span class="nc" id="L69">		String homeDirPath = _squirrelHomeDir.getPath() + File.separator;</span>
<span class="nc" id="L70">		_squirrelPluginsDir = homeDirPath + &quot;plugins&quot;;</span>
<span class="nc" id="L71">		_documentationDir = homeDirPath + &quot;doc&quot;;</span>
<span class="nc" id="L72">		_libraryDir = homeDirPath + &quot;lib&quot;;</span>
<span class="nc" id="L73">		_updateDir = homeDirPath + &quot;update&quot;;</span>

<span class="nc" id="L75">		_userSettingsDir = args.getUserSettingsDirectoryOverride();</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">		if (_userSettingsDir == null)</span>
		{
<span class="nc" id="L78">			_userSettingsDir = System.getProperty(IJavaPropertyNames.USER_HOME)</span>
											+ File.separator + &quot;.squirrel-sql&quot;;
		}
		try
		{
<span class="nc" id="L83">			new File(_userSettingsDir).mkdirs();</span>
		}
<span class="nc" id="L85">		catch (Exception ex)</span>
		{
<span class="nc" id="L87">			System.out.println(</span>
				&quot;Error creating user settings directory: &quot; + _userSettingsDir);
<span class="nc" id="L89">			System.out.println(ex.toString());</span>
<span class="nc" id="L90">		}</span>
		try
		{
<span class="nc" id="L93">			final File logsDir = getExecutionLogFile().getParentFile();</span>
<span class="nc" id="L94">			logsDir.mkdirs();</span>
		}
<span class="nc" id="L96">		catch (Exception ex)</span>
		{
<span class="nc" id="L98">			System.out.println(&quot;Error creating logs directory&quot;);</span>
<span class="nc" id="L99">			System.out.println(ex.toString());</span>
<span class="nc" id="L100">		}</span>
<span class="nc" id="L101">	}</span>

	public File getUserSettingsDirectory()
	{
<span class="nc" id="L105">		return new File(_userSettingsDir);</span>
	}

	public File getPluginsDirectory()
	{
<span class="nc" id="L110">		return new File(_squirrelPluginsDir);</span>
	}

	public File getLibraryDirectory() 
	{
<span class="nc" id="L115">	   return new File(_libraryDir);</span>
	}
	
   public File getUpdateDirectory() 
   {
<span class="nc" id="L120">      return new File(_updateDir);</span>
   }

	/**
	 * @return file that contains database aliases.
	 */
	public File getDatabaseAliasesFile()
	{
<span class="nc" id="L128">		return new File(_userSettingsDir + File.separator + &quot;SQLAliases23.xml&quot;);</span>
	}

   public File getDatabaseAliasesTreeStructureFile()
   {
<span class="nc" id="L133">      return new File(_userSettingsDir + File.separator + &quot;SQLAliases23_treeStructure.xml&quot;);</span>
   }


   public File getDatabaseAliasesFile_before_version_2_3()
   {
<span class="nc" id="L139">      return new File(_userSettingsDir + File.separator + &quot;SQLAliases.xml&quot;);</span>
   }


   /**
	 * @return file that contains JDBC driver definitions.
	 */
	public File getDatabaseDriversFile()
	{
<span class="nc" id="L148">		return new File(_userSettingsDir + File.separator + &quot;SQLDrivers.xml&quot;);</span>
	}

	/**
	 * @return file that contains JDBC driver definitions.
	 */
	public File getUserPreferencesFile()
	{
<span class="nc" id="L156">		return new File(_userSettingsDir + File.separator + &quot;prefs.xml&quot;);</span>
	}

	/**
	 * @return file that contains the selections user chose for Cell import/export.
	 */
	public File getCellImportExportSelectionsFile()
	{
<span class="nc" id="L164">		return new File(_userSettingsDir + File.separator + &quot;cellImportExport.xml&quot;);</span>
	}

	/**
	 * @return file that contains the selections user chose
	 * for DataType-specific properties.
	 */
	public File getDTPropertiesFile()
	{
<span class="nc" id="L173">		return new File(_userSettingsDir + File.separator + &quot;DTproperties.xml&quot;);</span>
	}

	/**
	 * @return file that contains the selections user chose for specific columns to use
	 * in the WHERE clause when editing a cell in a DB table.
	 */
	public File getEditWhereColsFile()
	{
<span class="nc" id="L182">		return new File(_userSettingsDir + File.separator + &quot;editWhereCols.xml&quot;);</span>
	}

	/**
	 * @return file to log execution information to.
	 */
	public File getExecutionLogFile()
	{
<span class="nc" id="L190">		final String dirPath = _userSettingsDir + File.separator + &quot;logs&quot;;</span>
<span class="nc" id="L191">		final String logBaseName = &quot;squirrel-sql.log&quot;;</span>

<span class="nc bnc" id="L193" title="All 2 branches missed.">		if (needExecutionLogCleanup) {</span>
			// first time through this method in program, so go cleanup
			// old log files
<span class="nc" id="L196">			deleteOldFiles(dirPath, logBaseName);</span>
<span class="nc" id="L197">			needExecutionLogCleanup = false;</span>
		}
<span class="nc" id="L199">		return new File(dirPath	+ File.separator + logBaseName);</span>
	}

	/**
	 * @return file to log JDBC debug information to.
	 */
	public File getJDBCDebugLogFile()
	{
<span class="nc" id="L207">		final String dirPath = _userSettingsDir + File.separator + &quot;logs&quot;;</span>
<span class="nc" id="L208">		final String logBaseName = &quot;jdbcdebug.log&quot;;</span>

<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (needDebugLogCleanup) {</span>
			// first time through this method in program, so go cleanup
			// old log files
<span class="nc" id="L213">			deleteOldFiles(dirPath, logBaseName);</span>
<span class="nc" id="L214">			needDebugLogCleanup = false;</span>
		}
<span class="nc" id="L216">		return new File(dirPath	+ File.separator + logBaseName);</span>
	}

	/**
	 * @return file to log debug information to.
	 */
//	public File getDebugLogFile()
//	{
//		return new File(_userSettingsDir + File.separator + &quot;squirrel-sql-debug.log&quot;);
//	}

 	/**
 	 * @return serialized Vector containing history of SQL queries executed
 	 */
 	public File getUserSQLHistoryFile()
 	{
<span class="nc" id="L232"> 		return new File(_userSettingsDir + File.separator + &quot;sql_history.xml&quot;);</span>
 	}

	public File getSquirrelHomeDir()
	{
<span class="nc" id="L237">		return _squirrelHomeDir;</span>
	}


	/**
	 * @return directory that contains plugin specific user settings
	 */
	public File getPluginsUserSettingsDirectory()
	{
<span class="nc" id="L246">		return new File(_userSettingsDir + File.separator + &quot;plugins&quot;);</span>
	}

	/**
	 * @return the quickstart guide.
	 */
	public File getQuickStartGuideFile()
	{
<span class="nc" id="L254">		return new File(_documentationDir + File.separator + &quot;quick_start.html&quot;);</span>
	}

	/**
	 * @return the FAQ.
	 */
	public File getFAQFile()
	{
<span class="nc" id="L262">		return new File(_documentationDir + File.separator + &quot;faq.html&quot;);</span>
	}

	/**
	 * @return the changelog.
	 */
	public File getChangeLogFile()
	{
<span class="nc" id="L270">		return new File(_documentationDir + File.separator + &quot;changes.txt&quot;);</span>
	}

	/**
	 * @return the licence file.
	 */
	public File getLicenceFile()
	{
<span class="nc" id="L278">		return new File(_documentationDir + File.separator + &quot;licences/squirrel_licence.txt&quot;);</span>
	}

 	/**
 	 * @return the Welcome document..
 	 */
 	public File getWelcomeFile()
 	{
<span class="nc" id="L286"> 		return new File(_documentationDir + File.separator + &quot;welcome.html&quot;);</span>
 	}

	/**
	 * Internal method to remove old files such as log files.
	 * The dirPath is the path name of the directory containing the files.
	 * The fileBase is the base name of all files in the set to be culled,
	 * i.e. this method removes old versions of files named &lt;fileBase&gt;*,
	 * but not the file named &lt;fileBase&gt; or recent versions of that file.
	 * It is assumed that files are named with dates such that the names of
	 * older files are alphabetically before newer files.
	 */
	private void deleteOldFiles(String dirPath, String fileBase) {

		// the number of files to keep is arbitrarilly set here
<span class="nc" id="L301">		final int numberToKeep = 3;</span>

		// define filter to select only names using the fileBase
		class OldFileNameFilter implements FilenameFilter {
			String fBase;
<span class="nc" id="L306">			OldFileNameFilter(String fileBase) {</span>
<span class="nc" id="L307">				fBase = fileBase;</span>
<span class="nc" id="L308">			}</span>
			public boolean accept (File dir, String name) {
<span class="nc bnc" id="L310" title="All 2 branches missed.">				if (name.startsWith(fBase))</span>
<span class="nc" id="L311">					return true;</span>
<span class="nc" id="L312">				return false;</span>
			}
		}

		// get the directory
<span class="nc" id="L317">		File dir = new File(dirPath);</span>

		// create filename filter and attach to directory
<span class="nc" id="L320">		OldFileNameFilter fileFilter = new OldFileNameFilter(fileBase);</span>

		// get list of files using that base name
<span class="nc" id="L323">		String fileNames[] = dir.list(fileFilter);</span>
<span class="nc bnc" id="L324" title="All 4 branches missed.">		if (fileNames == null || fileNames.length &lt;= numberToKeep)</span>
<span class="nc" id="L325">			return;	// not too many old files</span>

		// we do not expect a lot of files in this directory,
		// so just do things linearly

		// sort the list
<span class="nc" id="L331">		Arrays.sort(fileNames);</span>

		// If the file using the base name with no extention exists,
		// it is first.  The other files are in order from oldest to newest.
		// The set of files to delete is slightly different depending on
		// whether the base name file exists or not.
<span class="nc" id="L337">		int startIndex = 0;</span>
<span class="nc" id="L338">		int endIndex = fileNames.length - numberToKeep;</span>
<span class="nc bnc" id="L339" title="All 2 branches missed.">		if (fileNames[0].equals(fileBase)) {</span>
			// since the base name file exists, we need to skip it
			// and bump up the endIndex
<span class="nc" id="L342">			startIndex = 1;</span>
<span class="nc" id="L343">			endIndex++;</span>
		}

<span class="nc bnc" id="L346" title="All 2 branches missed.">		for (int i = startIndex; i &lt; endIndex; i++) {</span>
			// delete the old file
<span class="nc" id="L348">			File oldFile = new File(dirPath + File.separator + fileNames[i]);</span>
<span class="nc" id="L349">			oldFile.delete();</span>
		}
<span class="nc" id="L351">	}</span>

	public File getSQuirrelJarFile()
	{
<span class="nc" id="L355">		File ret = new File(_squirrelHomeDir.getPath() + File.separator + &quot;lib&quot; + File.separator + &quot;squirrel-sql.jar&quot;);</span>

<span class="nc bnc" id="L357" title="All 2 branches missed.">		if(false == ret.exists())</span>
		{
<span class="nc" id="L359">			ret = new File(_squirrelHomeDir.getPath() +  File.separator + &quot;squirrel-sql.jar&quot;);</span>
		}
<span class="nc" id="L361">		return ret;</span>
	}

	public File getFwJarFile()
	{
<span class="nc" id="L366">		return new File(_squirrelHomeDir.getPath() + File.separator + &quot;lib&quot; + File.separator + &quot;fw.jar&quot;);		</span>
	}
	
	/**
 	 * @return serialized List containing user specific configurations for WIKI tables. 
 	 */
 	public File getUserSpecificWikiConfigurationsFile()
 	{
<span class="nc" id="L374"> 		return new File(_userSettingsDir + File.separator + &quot;userSpecificWikiTableConfigurations.xml&quot;);</span>
 	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>