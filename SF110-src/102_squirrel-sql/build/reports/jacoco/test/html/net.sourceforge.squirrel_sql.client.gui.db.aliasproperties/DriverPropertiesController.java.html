<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DriverPropertiesController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.gui.db.aliasproperties</a> &gt; <span class="el_source">DriverPropertiesController.java</span></div><h1>DriverPropertiesController.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.gui.db.aliasproperties;

import net.sourceforge.squirrel_sql.client.IApplication;
import net.sourceforge.squirrel_sql.client.gui.db.SQLAlias;
import net.sourceforge.squirrel_sql.fw.gui.MultipleLineLabel;
import net.sourceforge.squirrel_sql.fw.id.IIdentifier;
import net.sourceforge.squirrel_sql.fw.sql.ISQLAlias;
import net.sourceforge.squirrel_sql.fw.sql.SQLDriverPropertyCollection;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import java.awt.*;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.sql.Driver;
import java.sql.DriverPropertyInfo;
import java.sql.SQLException;
import java.util.Properties;

/**
 * This dialog allows the user to review and maintain
 * the properties for a JDBC driver.
 *
 * @author &lt;A HREF=&quot;mailto:colbell@users.sourceforge.net&quot;&gt;Colin Bell&lt;/A&gt;
 */
public class DriverPropertiesController implements IAliasPropertiesPanelController
{
   /**
    * Internationalized strings for this class.
    */
<span class="nc" id="L31">   private static final StringManager s_stringMgr =</span>
<span class="nc" id="L32">      StringManagerFactory.getStringManager(DriverPropertiesController.class);</span>

   private DriverPropertiesPanel _propsPnl;

   /**
    * The driver properties. This is only available once OK pressed.
    */
   private SQLDriverPropertyCollection _driverPropInfo;
   private ISQLAlias _alias;
   private IApplication _app;
   String _errMsg;
   private Color _origTblColor;

   public DriverPropertiesController(SQLAlias alias, IApplication app)
<span class="nc" id="L46">   {</span>
<span class="nc" id="L47">      _alias = alias;</span>
<span class="nc" id="L48">      _app = app;</span>
<span class="nc" id="L49">      String aliasUrl = alias.getUrl();</span>

<span class="nc" id="L51">      IIdentifier driverIdentifier = alias.getDriverIdentifier();</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">      if (driverIdentifier == null)</span>
      {
         // I18n[DriverPropertiesController.noDriverSelected=No driver available in this Alias.\nCan not load driver properties tab.]
<span class="nc" id="L55">         _errMsg = s_stringMgr.getString(&quot;DriverPropertiesController.noDriverSelected&quot;);</span>
<span class="nc" id="L56">         _app.getMessageHandler().showErrorMessage(_errMsg);</span>
<span class="nc" id="L57">         return;</span>
      }
<span class="nc" id="L59">      final Driver jdbcDriver = app.getSQLDriverManager().getJDBCDriver(driverIdentifier);</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">      if (jdbcDriver == null)</span>
      {
         // I18n[DriverPropertiesController.loadingDriverFailed=Loading JDBC driver &quot;{0}&quot; failed.\nCan not load driver properties tab.]
<span class="nc" id="L63">         _errMsg = s_stringMgr.getString(&quot;DriverPropertiesController.loadingDriverFailed&quot;, app.getDataCache().getDriver(driverIdentifier).getName());</span>
<span class="nc" id="L64">         _app.getMessageHandler().showErrorMessage(_errMsg);</span>
<span class="nc" id="L65">         return;</span>
      } else {
          try {
<span class="nc bnc" id="L68" title="All 2 branches missed.">              if (!jdbcDriver.acceptsURL( aliasUrl )) {</span>
<span class="nc" id="L69">                  String driverName = </span>
<span class="nc" id="L70">                      app.getDataCache().getDriver(driverIdentifier).getName();</span>
                  //I18n[DriverPropertiesController.invalidUrl=According to 
                  //the driver &quot;{0}&quot;, the url &quot;{1}&quot; is invalid.]
<span class="nc" id="L73">                  _errMsg = </span>
<span class="nc" id="L74">                      s_stringMgr.getString(</span>
                              &quot;DriverPropertiesController.invalidUrl&quot;, 
                              new String[] {driverName, aliasUrl});
<span class="nc" id="L77">                  _app.getMessageHandler().showErrorMessage(_errMsg);</span>
<span class="nc" id="L78">                  return;</span>
              }
<span class="nc" id="L80">          } catch (Exception e) {</span>
              // I18n[DriverPropertiesController.loadingDriverFailed=Loading JDBC driver &quot;{0}&quot; failed.\nCan not load driver properties tab.]
<span class="nc" id="L82">              _errMsg = s_stringMgr.getString(&quot;DriverPropertiesController.loadingDriverFailed&quot;, app.getDataCache().getDriver(driverIdentifier).getName());</span>
<span class="nc" id="L83">              _app.getMessageHandler().showErrorMessage(_errMsg);</span>
<span class="nc" id="L84">              return;</span>
<span class="nc" id="L85">          }</span>
      }

<span class="nc" id="L88">      DriverPropertyInfo[] infoAr = new DriverPropertyInfo[0];</span>
      try
      {
<span class="nc" id="L91">         infoAr = jdbcDriver.getPropertyInfo(alias.getUrl(), new Properties());</span>
      }
<span class="nc" id="L93">      catch (Exception e)</span>
      {
         // I18n[DriverPropertiesController.gettingDriverPropetiesFailed=Loading the properties from the JDBC driver failed.\nCan not load driver properties tab.]
<span class="nc" id="L96">         _errMsg = s_stringMgr.getString(&quot;DriverPropertiesController.gettingDriverPropetiesFailed&quot;);</span>
<span class="nc" id="L97">         _app.getMessageHandler().showErrorMessage(_errMsg);</span>
         //return;
<span class="nc" id="L99">      }</span>

<span class="nc" id="L101">      SQLDriverPropertyCollection driverPropertiesClone = alias.getDriverPropertiesClone();</span>
<span class="nc" id="L102">      driverPropertiesClone.applyDriverPropertynfo(infoAr);</span>
<span class="nc" id="L103">      _propsPnl = new DriverPropertiesPanel(driverPropertiesClone);</span>

<span class="nc" id="L105">      _propsPnl.chkUseDriverProperties.setSelected(alias.getUseDriverProperties());</span>
<span class="nc" id="L106">      updateTableEnabled();</span>

<span class="nc" id="L108">      _propsPnl.chkUseDriverProperties.addActionListener(new ActionListener()</span>
<span class="nc" id="L109">      {</span>
         public void actionPerformed(ActionEvent e)
         {
<span class="nc" id="L112">            updateTableEnabled();</span>
<span class="nc" id="L113">         }</span>
      });


<span class="nc" id="L117">   }</span>

   private void updateTableEnabled()
   {
<span class="nc bnc" id="L121" title="All 2 branches missed.">      if(null == _origTblColor)</span>
      {
<span class="nc" id="L123">         _origTblColor = _propsPnl.tbl.getForeground();</span>
      }

<span class="nc" id="L126">      _propsPnl.tbl.setEnabled(_propsPnl.chkUseDriverProperties.isSelected());</span>

<span class="nc bnc" id="L128" title="All 2 branches missed.">      if(_propsPnl.chkUseDriverProperties.isSelected())</span>
      {
<span class="nc" id="L130">         _propsPnl.tbl.setForeground(_origTblColor);</span>
      }
      else
      {
<span class="nc" id="L134">         _propsPnl.tbl.setForeground(Color.lightGray);</span>
      }
<span class="nc" id="L136">   }</span>

   /**
    * Retrieve the database driver properties. This is only valid if the
    * OK button was pressed.
    *
    * @return the database driver properties.
    */
   public SQLDriverPropertyCollection getSQLDriverPropertyCollection()
   {
<span class="nc" id="L146">      return _driverPropInfo;</span>
   }

   public Component getPanelComponent()
   {
<span class="nc bnc" id="L151" title="All 2 branches missed.">      if(null == _propsPnl)</span>
      {
<span class="nc" id="L153">         return new MultipleLineLabel(_errMsg);</span>
      }
      else
      {
<span class="nc" id="L157">         return _propsPnl;</span>
      }
   }


   public void applyChanges()
   {
<span class="nc bnc" id="L164" title="All 2 branches missed.">      if (null != _propsPnl)</span>
      {
<span class="nc" id="L166">         _alias.setDriverProperties(_propsPnl.getSQLDriverProperties());</span>
<span class="nc" id="L167">         _alias.setUseDriverProperties(_propsPnl.chkUseDriverProperties.isSelected());</span>
      }
<span class="nc" id="L169">   }</span>


   public String getTitle()
   {
      //i18n[DriverPropertiesController.title=DriverProperties]
<span class="nc" id="L175">      return s_stringMgr.getString(&quot;DriverPropertiesController.title&quot;);</span>
   }

   public String getHint()
   {
      //i18n[DriverPropertiesController.Hint=DriverProperties]
<span class="nc" id="L181">      return s_stringMgr.getString(&quot;DriverPropertiesController.title&quot;);</span>
   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>