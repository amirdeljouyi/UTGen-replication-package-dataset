<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EditWhereColsSheet.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.session.properties</a> &gt; <span class="el_source">EditWhereColsSheet.java</span></div><h1>EditWhereColsSheet.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.session.properties;
/**
 * Copyright (C) 2003-2004 Glenn Griffin
 *
 * Modifications Copyright (C) 2003-2004 Jason Height
 *
 * Adapted from SQLFilterSheet.java by Maury Hammel.
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */

import net.sourceforge.squirrel_sql.client.gui.desktopcontainer.DialogWidget;
import net.sourceforge.squirrel_sql.client.gui.desktopcontainer.SessionDialogWidget;
import net.sourceforge.squirrel_sql.client.session.ISession;
import net.sourceforge.squirrel_sql.client.session.mainpanel.objecttree.tabs.table.ContentsTab;
import net.sourceforge.squirrel_sql.fw.gui.GUIUtils;
import net.sourceforge.squirrel_sql.fw.sql.IDatabaseObjectInfo;
import net.sourceforge.squirrel_sql.fw.sql.ISQLConnection;
import net.sourceforge.squirrel_sql.fw.sql.ITableInfo;
import net.sourceforge.squirrel_sql.fw.sql.TableColumnInfo;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.sql.SQLException;
import java.util.SortedSet;
import java.util.TreeSet;

/**
 * Edit Where Cols dialog gui.
 * JASON: Rename to EditWhereColsInternalFrame 
 */
public class EditWhereColsSheet extends SessionDialogWidget
{

<span class="nc" id="L54">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L55">		StringManagerFactory.getStringManager(EditWhereColsSheet.class);</span>


	/**
	 * This interface defines locale specific strings. This should be
	 * replaced with a property file.
	 */
	private interface i18n
	{
		/** Title  */
		// i18n[editWhereColsSheet.editWhereColumns=Edit 'WHERE' columns]
<span class="nc" id="L66">		String TITLE = s_stringMgr.getString(&quot;editWhereColsSheet.editWhereColumns&quot;);</span>
	}

	/** Logger for this class. */
<span class="nc" id="L70">	private static final ILogger s_log =</span>
<span class="nc" id="L71">		LoggerController.createLogger(EditWhereColsSheet.class);</span>

	/** A reference to a class containing information about the database metadata. */
	private IDatabaseObjectInfo _objectInfo;

	/** Frame title. */
<span class="nc" id="L77">	private JLabel _titleLbl = new JLabel();</span>

	/** A reference to a panel for the EditWhereCols list. */
<span class="nc" id="L80">	private EditWhereColsPanel _editWhereColsPanel = null;</span>

	/**
	 * Creates a new instance of SQLFilterSheet
	 *
	 * @param	session		A reference to the current SQuirreL session
	 * @param	objectInfo	An instance of a class containing database metadata
	 * 						information.
	 */
	public EditWhereColsSheet(ISession session, IDatabaseObjectInfo objectInfo)
	{
<span class="nc" id="L91">		super(i18n.TITLE, true, session);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">		if (objectInfo == null)</span>
		{
<span class="nc" id="L94">			throw new IllegalArgumentException(&quot;Null IDatabaseObjectInfo passed&quot;);</span>
		}

<span class="nc" id="L97">		_objectInfo = objectInfo;</span>
<span class="nc" id="L98">		createGUI();</span>
<span class="nc" id="L99">      pack();</span>
<span class="nc" id="L100">	}</span>

	/**
	 * Position and display the sheet.
	 *
	 * @param	show	A boolean that determines whether the sheet is shown
	 * 					or hidden.
	 */
	public synchronized void setVisible(boolean show)
	{
<span class="nc bnc" id="L110" title="All 2 branches missed.">		if (show)</span>
		{
<span class="nc bnc" id="L112" title="All 2 branches missed.">			if (!isVisible())</span>
			{
<span class="nc" id="L114">				final boolean isDebug = s_log.isDebugEnabled();</span>
<span class="nc" id="L115">				long start = 0;</span>

<span class="nc bnc" id="L117" title="All 2 branches missed.">				if (isDebug)</span>
				{
<span class="nc" id="L119">					start = System.currentTimeMillis();</span>
				}

<span class="nc bnc" id="L122" title="All 2 branches missed.">				if (isDebug)</span>
				{
<span class="nc" id="L124">					s_log.debug(&quot;Panel &quot; + _editWhereColsPanel.getTitle()</span>
						+ &quot; initialized in &quot;
<span class="nc" id="L126">						+ (System.currentTimeMillis() - start) + &quot;ms&quot;);</span>
				}

<span class="nc" id="L129">				pack();</span>
				/*
				 * TODO: Work out why
				 * KLUDGE: For some reason, I am not able to get the sheet to
				 * size correctly. It always displays with a size that causes
				 * the sub-panels to have their scrollbars showing. Add a bit
				 * of an increase in the size of the panel so the scrollbars
				 * are not displayed.
				 */
<span class="nc" id="L138">				Dimension d = getSize();</span>
<span class="nc" id="L139">				d.width += 5;</span>
<span class="nc" id="L140">				d.height += 5;</span>
<span class="nc" id="L141">				setSize(d);</span>
				/*
				 * END-KLUDGE
				 */
<span class="nc" id="L145">				DialogWidget.centerWithinDesktop(this);</span>
			}
<span class="nc" id="L147">			moveToFront();</span>
		}
<span class="nc" id="L149">		super.setVisible(show);</span>
<span class="nc" id="L150">	}</span>

//	/**
//	 * Set title of this frame. Ensure that the title label matches the frame title.
//	 *
//	 * @param	title	New title text.
//	 */
//	public void setTitle(String title)
//	{
//      super
//	}

	/**
	 * Dispose of the sheet.
	 */
	private void performClose()
	{
<span class="nc" id="L167">		dispose();</span>
<span class="nc" id="L168">	}</span>

	public IDatabaseObjectInfo getDatabaseObjectInfo()
	{
<span class="nc" id="L172">		return _objectInfo;</span>
	}

	/**
	 * Reset button pressed.  Reset the data to the way it was when we started
	 * this round of editing.
	 *
	 */
	private void performReset()
	{
<span class="nc" id="L182">		_editWhereColsPanel.reset();</span>
<span class="nc" id="L183">	}</span>

	/**
	 * OK button pressed. Save data to EditWhereCols repository
	 * then close dialog.
	 */
	private void performOk()
	{
		// try to save the selection.
		// do not dispose of this panel if there is a problem
<span class="nc bnc" id="L193" title="All 2 branches missed.">		if (_editWhereColsPanel.ok())</span>
<span class="nc" id="L194">			dispose();</span>
<span class="nc" id="L195">	}</span>

	/**
	 * Create the GUI elements for the sheet and pass in the setup data to the panel.
	 */
	private void createGUI()
	{
<span class="nc" id="L202">		SortedSet&lt;String&gt; columnNames = new TreeSet&lt;String&gt;();</span>

<span class="nc" id="L204">		setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span>

		// This is a tool window.
<span class="nc" id="L207">		makeToolWindow(true);</span>

<span class="nc" id="L209">		final ISession session = getSession();</span>

		try
		{
<span class="nc" id="L213">			final ISQLConnection conn = session.getSQLConnection();</span>
<span class="nc" id="L214">				TableColumnInfo[] infos = conn.getSQLMetaData().getColumnInfo((ITableInfo)_objectInfo);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">				for (int i = 0; i &lt; infos.length; i++) {</span>
<span class="nc" id="L216">					 TableColumnInfo info = infos[i];</span>
<span class="nc" id="L217">					 columnNames.add(info.getColumnName());</span>
				}
		}
<span class="nc" id="L220">		catch (SQLException ex)</span>
		{
<span class="nc" id="L222">			session.getApplication().showErrorDialog(</span>
				// i18n[editWhereColsSheet.unableToEdit=Unable to get list of columns, {0}]
<span class="nc" id="L224">				s_stringMgr.getString(&quot;editWhereColsSheet.unableToEdit&quot;, ex));</span>
<span class="nc" id="L225">		}</span>
<span class="nc" id="L226">		String unambiguousname = </span>
<span class="nc" id="L227">            ContentsTab.getUnambiguousTableName(session, </span>
<span class="nc" id="L228">                                                _objectInfo.getQualifiedName());</span>
<span class="nc" id="L229">		_editWhereColsPanel =</span>
			new EditWhereColsPanel(session,
                                   (ITableInfo)_objectInfo,
                                   columnNames,  
                                   unambiguousname);


<span class="nc" id="L236">		_titleLbl.setText(getTitle() + &quot;: &quot; + _objectInfo.getSimpleName());</span>


<span class="nc" id="L239">		final JPanel contentPane = new JPanel(new GridBagLayout());</span>
<span class="nc" id="L240">		contentPane.setBorder(BorderFactory.createEmptyBorder(5, 10, 5, 10));</span>
<span class="nc" id="L241">		setContentPane(contentPane);</span>

<span class="nc" id="L243">		GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L245">		gbc.gridwidth = 1;</span>

<span class="nc" id="L247">		gbc.gridx = 0;</span>
<span class="nc" id="L248">		gbc.gridy = 0;</span>

<span class="nc" id="L250">		gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L251">		gbc.weightx = 1;</span>
<span class="nc" id="L252">		contentPane.add(_titleLbl, gbc);</span>

<span class="nc" id="L254">		gbc.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L255">		gbc.gridx = GridBagConstraints.REMAINDER;</span>

		// leave a blank line just to make it look a bit nicer
<span class="nc" id="L258">		gbc.gridx = 0;</span>
<span class="nc" id="L259">		++gbc.gridy;</span>
<span class="nc" id="L260">		contentPane.add(new JLabel(&quot; &quot;), gbc);</span>

<span class="nc" id="L262">		gbc.gridx = 0;</span>
<span class="nc" id="L263">		++gbc.gridy;</span>
<span class="nc" id="L264">		contentPane.add(</span>
			// i18n[editWhereColsSheet.limitSizeOfWhereClause=Limit the size of the WHERE clause used behind the scenes when editing cell contents.]
<span class="nc" id="L266">			new JLabel(s_stringMgr.getString(&quot;editWhereColsSheet.limitSizeOfWhereClause&quot;)), gbc);</span>
<span class="nc" id="L267">		gbc.gridx = 0;</span>
<span class="nc" id="L268">		++gbc.gridy;</span>
<span class="nc" id="L269">		contentPane.add(</span>
			// i18n[editWhereColsSheet.shouldIncludePKs=The 'use' window should include at least the primary keys for the table.]
<span class="nc" id="L271">			new JLabel(s_stringMgr.getString(&quot;editWhereColsSheet.shouldIncludePKs&quot;)), gbc);</span>

		// leave a blank line just to make it look a bit nicer
<span class="nc" id="L274">		gbc.gridx = 0;</span>
<span class="nc" id="L275">		++gbc.gridy;</span>
<span class="nc" id="L276">		contentPane.add(new JLabel(&quot; &quot;), gbc);</span>

<span class="nc" id="L278">		gbc.fill = GridBagConstraints.BOTH;</span>
<span class="nc" id="L279">		gbc.gridwidth = 2;</span>
<span class="nc" id="L280">		gbc.gridx = 0;</span>
<span class="nc" id="L281">		++gbc.gridy;</span>
<span class="nc" id="L282">		gbc.weighty = 1;</span>
<span class="nc" id="L283">		contentPane.add(_editWhereColsPanel, gbc);</span>

<span class="nc" id="L285">		++gbc.gridy;</span>
<span class="nc" id="L286">		gbc.gridwidth = 2;</span>
<span class="nc" id="L287">		gbc.weighty = 0;</span>
<span class="nc" id="L288">		contentPane.add(createButtonsPanel(), gbc);</span>


<span class="nc" id="L291">      AbstractAction closeAction = new AbstractAction()</span>
<span class="nc" id="L292">      {</span>
         public void actionPerformed(ActionEvent actionEvent)
         {
<span class="nc" id="L295">            performClose();</span>
<span class="nc" id="L296">         }</span>
      };
<span class="nc" id="L298">      KeyStroke escapeStroke = KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE, 0);</span>
<span class="nc" id="L299">      getRootPane().getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT).put(escapeStroke, &quot;CloseAction&quot;);</span>
<span class="nc" id="L300">      getRootPane().getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(escapeStroke, &quot;CloseAction&quot;);</span>
<span class="nc" id="L301">      getRootPane().getInputMap(JComponent.WHEN_FOCUSED).put(escapeStroke, &quot;CloseAction&quot;);</span>
<span class="nc" id="L302">      getRootPane().getActionMap().put(&quot;CloseAction&quot;, closeAction);</span>

<span class="nc" id="L304">	}</span>

	/**
	 * Create a panel that contains the buttons that control the closing
	 * of the sheet.
	 *
	 * @return An instance of a JPanel.
	 */
	private JPanel createButtonsPanel()
	{
<span class="nc" id="L314">		JPanel pnl = new JPanel();</span>

		// i18n[editWherColsSheet.ok=OK]
<span class="nc" id="L317">		JButton okBtn = new JButton(s_stringMgr.getString(&quot;editWherColsSheet.ok&quot;));</span>
<span class="nc" id="L318">		okBtn.addActionListener(new ActionListener()</span>
<span class="nc" id="L319">		{</span>
			public void actionPerformed(ActionEvent evt)
			{
<span class="nc" id="L322">				performOk();</span>
<span class="nc" id="L323">			}</span>
		});
		// i18n[editWherColsSheet.reset=Reset]
<span class="nc" id="L326">		JButton resetBtn = new JButton(s_stringMgr.getString(&quot;editWherColsSheet.reset&quot;));</span>
<span class="nc" id="L327">		resetBtn.addActionListener(new ActionListener()</span>
<span class="nc" id="L328">		{</span>
			public void actionPerformed(ActionEvent evt)
			{
<span class="nc" id="L331">				performReset();</span>
<span class="nc" id="L332">			}</span>
		});
		// i18n[editWherColsSheet.close=Close]
<span class="nc" id="L335">		JButton closeBtn = new JButton(s_stringMgr.getString(&quot;editWherColsSheet.close&quot;));</span>
<span class="nc" id="L336">		closeBtn.addActionListener(new ActionListener()</span>
<span class="nc" id="L337">		{</span>
			public void actionPerformed(ActionEvent evt)
			{
<span class="nc" id="L340">				performClose();</span>
<span class="nc" id="L341">			}</span>
		});

<span class="nc" id="L344">		pnl.add(okBtn);</span>
<span class="nc" id="L345">		pnl.add(resetBtn);</span>
<span class="nc" id="L346">		pnl.add(closeBtn);</span>

<span class="nc" id="L348">		GUIUtils.setJButtonSizesTheSame(new JButton[] { okBtn, resetBtn, closeBtn });</span>
<span class="nc" id="L349">		getRootPane().setDefaultButton(okBtn);</span>

<span class="nc" id="L351">		return pnl;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>