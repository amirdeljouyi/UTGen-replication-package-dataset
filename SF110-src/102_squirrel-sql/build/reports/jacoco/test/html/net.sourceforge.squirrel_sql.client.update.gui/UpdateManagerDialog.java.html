<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UpdateManagerDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.update.gui</a> &gt; <span class="el_source">UpdateManagerDialog.java</span></div><h1>UpdateManagerDialog.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.update.gui;

/*
 * Copyright (C) 2007 Rob Manning
 * manningr@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;

import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.border.Border;
import javax.swing.border.EmptyBorder;
import javax.swing.border.LineBorder;

import net.sourceforge.squirrel_sql.fw.gui.GUIUtils;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

/**
 * The dialog that presents the user with the option to check for updates.
 * 
 */
public class UpdateManagerDialog extends JDialog {
   private static final long serialVersionUID = 1L;

   /** Internationalized strings for this class. */
<span class="nc" id="L55">   private static final StringManager s_stringMgr = </span>
<span class="nc" id="L56">      StringManagerFactory.getStringManager(UpdateManagerDialog.class);</span>

   /* GUI Widgets */

   /** Check button for dialog */
<span class="nc" id="L61">   private JButton _checkBtn = null;</span>

   /** Configure button for dialog */
<span class="nc" id="L64">   private JButton _configBtn = null;</span>
   
   /** Close button for dialog. */
<span class="nc" id="L67">   private JButton _closeBtn = null;</span>

   /** server hostname textfield */
<span class="nc" id="L70">   private JTextField _updateServerNameTF = null;</span>
   
   /** server port textfield */
<span class="nc" id="L73">   private JTextField _updateServerPortTF = null;</span>
   
   /** server path textfield */
<span class="nc" id="L76">   private JTextField _updateServerPathTF = null;</span>
   
   /** server channel textfield */
<span class="nc" id="L79">   private JTextField _updateServerChannelTF = null;</span>
   
   /** local path textfield */
<span class="nc" id="L82">   private JTextField _localUpdatePath = null;</span>
      
   /** registered check update listeners */
<span class="nc" id="L85">   private ArrayList&lt;CheckUpdateListener&gt; _checkUpdateListeners = </span>
      new ArrayList&lt;CheckUpdateListener&gt;();
   
<span class="nc" id="L88">   private boolean isRemoteUpdateSite = true;</span>
   
   static interface i18n {
      // i18n[UpdateManagerDialog.channelLabel=Channel:]
<span class="nc" id="L92">      String CHANNEL_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.channelLabel&quot;);</span>
      
      // i18n[UpdateManagerDialog.checkButtonLabel=Check]
<span class="nc" id="L95">      String CHECK_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.checkButtonLabel&quot;);</span>

      // i18n[UpdateManagerDialog.closeLabel=Close]
<span class="nc" id="L98">      String CLOSE_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.closeLabel&quot;);</span>

      // i18n[UpdateManagerDialog.hostLabel=Host:]
<span class="nc" id="L101">      String HOST_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.hostLabel&quot;);</span>

      String LOCAL_UPDATE_PATH_LABEL = &quot;Local Update Path:&quot;;
      
      // i18n[UpdateManagerDialog.repositoryTabLabel=Repository]
<span class="nc" id="L106">      String LOCATION_TAB_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.repositoryTabLabel&quot;);</span>

      // i18n[UpdateManagerDialog.pathLabel=Path:]
<span class="nc" id="L109">      String PATH_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.pathLabel&quot;);</span>

      // i18n[UpdateManagerDialog.portLabel=Port:]
<span class="nc" id="L112">      String PORT_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.portLabel&quot;);</span>

      // i18n[UpdateManagerDialog.settingsLabel=Settings]
<span class="nc" id="L115">      String SETTINGS_LABEL = s_stringMgr.getString(&quot;UpdateManagerDialog.settingsLabel&quot;);</span>

      // i18n[UpdateManagerDialog.title=Update Manager]
<span class="nc" id="L118">      String TITLE = s_stringMgr.getString(&quot;UpdateManagerDialog.title&quot;);</span>
   }

   /**
    * 
    * @param parent
    */
   public UpdateManagerDialog(JFrame parent, boolean isRemoteUpdateSite) {
<span class="nc" id="L126">      super(parent, i18n.TITLE, true);</span>
<span class="nc" id="L127">      setDefaultCloseOperation(JDialog.HIDE_ON_CLOSE);</span>
<span class="nc" id="L128">      this.isRemoteUpdateSite = isRemoteUpdateSite;</span>
<span class="nc" id="L129">      init();</span>
<span class="nc" id="L130">   }</span>

   /**
    * Sets the value for the update server name.
    * 
    * @param name the hostname of the update server.
    */
   public void setUpdateServerName(String nameStr) {
<span class="nc" id="L138">      _updateServerNameTF.setText(nameStr);</span>
<span class="nc" id="L139">   }</span>
   
   /**
    * Sets the value for the update server port.
    * 
    * @param port the port of the update server.
    */
   public void setUpdateServerPort(String portStr) {
<span class="nc" id="L147">      _updateServerPortTF.setText(portStr);</span>
<span class="nc" id="L148">   }</span>
   
   /**
    * Sets the update server path (directory where release.xml is located).
    *  
    * @param pathStr the update server path.
    */
   public void setUpdateServerPath(String pathStr) {
<span class="nc" id="L156">      _updateServerPathTF.setText(pathStr);</span>
<span class="nc" id="L157">   }</span>
   
   /**
    * Sets the update server channel.
    * 
    * @param channelStr the update server channel.
    */
   public void setUpdateServerChannel(String channelStr) {
<span class="nc" id="L165">      _updateServerChannelTF.setText(channelStr);</span>
<span class="nc" id="L166">   }</span>
   
   public void setLocalUpdatePath(String path) {
<span class="nc" id="L169">      _localUpdatePath.setText(path);</span>
<span class="nc" id="L170">   }</span>
   
   
   /**
    * Adds a listener which is called when check for updates action is invoked
    * from this dialog.
    * 
    * @param listener the CheckUpdateListener to be registered.
    */
   public void addCheckUpdateListener(CheckUpdateListener listener) {
<span class="nc" id="L180">      this._checkUpdateListeners.add(listener);</span>
<span class="nc" id="L181">   }</span>
   
   /** Initialized the UI components */
   private void init() {
<span class="nc" id="L185">      this.setLayout(new BorderLayout());</span>
<span class="nc" id="L186">      JPanel locationPanel = null;</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">      if (isRemoteUpdateSite) {</span>
<span class="nc" id="L188">         locationPanel = getRemoteLocationPanel();</span>
      } else {
<span class="nc" id="L190">         locationPanel = getLocalUpdateSitePanel();</span>
      }

<span class="nc" id="L193">      this.add(locationPanel, BorderLayout.CENTER);</span>
<span class="nc" id="L194">      this.add(getButtonPanel(), BorderLayout.SOUTH);</span>
<span class="nc" id="L195">      this.setSize(300, 200);</span>
<span class="nc" id="L196">      GUIUtils.centerWithinParent(this);</span>
<span class="nc" id="L197">   }</span>

   private JPanel getRemoteLocationPanel() {
<span class="nc" id="L200">      EmptyBorder border = new EmptyBorder(new Insets(5, 5, 5, 5));</span>
<span class="nc" id="L201">      Dimension mediumField = new Dimension(200, 20);</span>
<span class="nc" id="L202">      Dimension portField = new Dimension(50, 20);</span>

<span class="nc" id="L204">      JPanel locationPanel = new JPanel();</span>
<span class="nc" id="L205">      locationPanel.setBorder(new EmptyBorder(0, 0, 0, 10));</span>
<span class="nc" id="L206">      locationPanel.setLayout(new GridBagLayout());</span>

<span class="nc" id="L208">      int x = 0;</span>
<span class="nc" id="L209">      int y = -1;</span>

<span class="nc" id="L211">      GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L212">      c.gridx = x;</span>
<span class="nc" id="L213">      c.gridy = y;</span>
<span class="nc" id="L214">      c.anchor = GridBagConstraints.NORTH;</span>

<span class="nc" id="L216">      JLabel hostLabel = getBorderedLabel(i18n.HOST_LABEL, border);</span>
<span class="nc" id="L217">      _updateServerNameTF = getSizedTextField(mediumField);</span>

<span class="nc" id="L219">      locationPanel.add(hostLabel, getLabelConstraints(c));</span>
<span class="nc" id="L220">      locationPanel.add(_updateServerNameTF, getFieldFillHorizontalConstaints(c));</span>

<span class="nc" id="L222">      JLabel portLabel = getBorderedLabel(i18n.PORT_LABEL, border);</span>
<span class="nc" id="L223">      _updateServerPortTF = getSizedTextField(portField);</span>

<span class="nc" id="L225">      locationPanel.add(portLabel, getLabelConstraints(c));</span>
<span class="nc" id="L226">      locationPanel.add(_updateServerPortTF, getFieldConstraints(c));</span>

<span class="nc" id="L228">      JLabel pathLabel = getBorderedLabel(i18n.PATH_LABEL, border);</span>
<span class="nc" id="L229">      _updateServerPathTF = getSizedTextField(mediumField);</span>

<span class="nc" id="L231">      locationPanel.add(pathLabel, getLabelConstraints(c));</span>
<span class="nc" id="L232">      locationPanel.add(_updateServerPathTF, getFieldFillHorizontalConstaints(c));</span>

<span class="nc" id="L234">      JLabel channelLabel = getBorderedLabel(i18n.CHANNEL_LABEL, border);</span>
<span class="nc" id="L235">      _updateServerChannelTF = getSizedTextField(mediumField);</span>
      
<span class="nc" id="L237">      locationPanel.add(channelLabel, getLabelConstraints(c));</span>
<span class="nc" id="L238">      locationPanel.add(_updateServerChannelTF, getFieldFillHorizontalConstaints(c));</span>
<span class="nc" id="L239">      locationPanel.setBorder(new LineBorder(Color.LIGHT_GRAY, 1));</span>
      
<span class="nc" id="L241">      return locationPanel;</span>
   }
   
   private JPanel getLocalUpdateSitePanel() {
<span class="nc" id="L245">      EmptyBorder border = new EmptyBorder(new Insets(5, 5, 5, 5));</span>
<span class="nc" id="L246">      Dimension mediumField = new Dimension(200, 20);</span>

<span class="nc" id="L248">      JPanel locationPanel = new JPanel();</span>
<span class="nc" id="L249">      locationPanel.setBorder(new EmptyBorder(0, 0, 0, 10));</span>
<span class="nc" id="L250">      locationPanel.setLayout(new GridBagLayout());</span>

<span class="nc" id="L252">      int x = 0;</span>
<span class="nc" id="L253">      int y = -1;</span>

<span class="nc" id="L255">      GridBagConstraints c = new GridBagConstraints();</span>
<span class="nc" id="L256">      c.gridx = x;</span>
<span class="nc" id="L257">      c.gridy = y;</span>
<span class="nc" id="L258">      c.anchor = GridBagConstraints.NORTH;</span>

<span class="nc" id="L260">      JLabel localUpdatePathLabel = getBorderedLabel(i18n.LOCAL_UPDATE_PATH_LABEL, border);</span>
<span class="nc" id="L261">      _localUpdatePath = getSizedTextField(mediumField);</span>

<span class="nc" id="L263">      locationPanel.add(localUpdatePathLabel, getLabelConstraints(c));</span>
<span class="nc" id="L264">      locationPanel.add(_localUpdatePath, getFieldFillHorizontalConstaints(c));</span>
      
<span class="nc" id="L266">      return locationPanel;</span>
   }
   
   private JPanel getButtonPanel() {
<span class="nc" id="L270">      JPanel result = new JPanel();</span>

<span class="nc" id="L272">      _checkBtn = new JButton(i18n.CHECK_LABEL);</span>
<span class="nc" id="L273">      _checkBtn.addActionListener(new ActionListener() {</span>
         public void actionPerformed(ActionEvent e) {
<span class="nc" id="L275">            UpdateManagerDialog.this.setVisible(false);</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            for (CheckUpdateListener listener: _checkUpdateListeners) {</span>
               try {
<span class="nc" id="L278">                  listener.checkUpToDate();</span>
<span class="nc" id="L279">               } catch (Exception ex) {</span>
<span class="nc" id="L280">                  listener.showErrorMessage(</span>
                     &quot;Unexpected Exception&quot;,
<span class="nc" id="L282">                     &quot;Update check failed with Exception: &quot; + ex.getMessage(),</span>
                     ex);
<span class="nc" id="L284">               }</span>
<span class="nc" id="L285">            }            </span>
<span class="nc" id="L286">         }</span>
      });

<span class="nc" id="L289">      _configBtn = new JButton(i18n.SETTINGS_LABEL);</span>
<span class="nc" id="L290">      _configBtn.addActionListener(new ActionListener() {</span>
         public void actionPerformed(ActionEvent e) {
<span class="nc" id="L292">            UpdateManagerDialog.this.setVisible(false);</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">            for (CheckUpdateListener listener: _checkUpdateListeners) {</span>
<span class="nc" id="L294">               listener.showPreferences();</span>
<span class="nc" id="L295">            }</span>
<span class="nc" id="L296">         }</span>
      });
      
<span class="nc" id="L299">      _closeBtn = new JButton(i18n.CLOSE_LABEL);</span>
<span class="nc" id="L300">      _closeBtn.addActionListener(new ActionListener() {</span>
         public void actionPerformed(ActionEvent e) {
<span class="nc" id="L302">            UpdateManagerDialog.this.setVisible(false);</span>
<span class="nc" id="L303">         }</span>
      });

<span class="nc" id="L306">      result.add(_checkBtn);</span>
<span class="nc" id="L307">      result.add(_configBtn);</span>
<span class="nc" id="L308">      result.add(_closeBtn);</span>
<span class="nc" id="L309">      return result;</span>
   }

   private GridBagConstraints getLabelConstraints(GridBagConstraints c) {
<span class="nc" id="L313">      c.gridx = 0;</span>
<span class="nc" id="L314">      c.gridy++;</span>
<span class="nc" id="L315">      c.anchor = GridBagConstraints.EAST;</span>
<span class="nc" id="L316">      c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L317">      c.weightx = 0;</span>
<span class="nc" id="L318">      c.weighty = 0;</span>
<span class="nc" id="L319">      return c;</span>
   }

   private GridBagConstraints getFieldFillHorizontalConstaints(
         GridBagConstraints c) {
<span class="nc" id="L324">      c.gridx++;</span>
<span class="nc" id="L325">      c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L326">      c.weightx = 1;</span>
<span class="nc" id="L327">      c.weighty = 1;</span>
<span class="nc" id="L328">      c.fill = GridBagConstraints.HORIZONTAL;</span>
<span class="nc" id="L329">      c.insets = new Insets(0, 0, 0, 5);</span>
<span class="nc" id="L330">      return c;</span>
   }

   private GridBagConstraints getFieldConstraints(GridBagConstraints c) {
<span class="nc" id="L334">      c.gridx++;</span>
<span class="nc" id="L335">      c.anchor = GridBagConstraints.WEST;</span>
<span class="nc" id="L336">      c.weightx = 1;</span>
<span class="nc" id="L337">      c.weighty = 1;</span>
<span class="nc" id="L338">      c.fill = GridBagConstraints.NONE;</span>
<span class="nc" id="L339">      return c;</span>
   }

   private JLabel getBorderedLabel(String text, Border border) {
<span class="nc" id="L343">      JLabel result = new JLabel(text);</span>
<span class="nc" id="L344">      result.setBorder(border);</span>
<span class="nc" id="L345">      result.setPreferredSize(new Dimension(115, 20));</span>
<span class="nc" id="L346">      result.setHorizontalAlignment(SwingConstants.RIGHT);</span>
<span class="nc" id="L347">      return result;</span>
   }

   private JTextField getSizedTextField(Dimension preferredSize) {
<span class="nc" id="L351">      JTextField result = new JTextField();</span>
<span class="nc" id="L352">      result.setPreferredSize(preferredSize);</span>
<span class="nc" id="L353">      result.setMinimumSize(preferredSize);</span>
<span class="nc" id="L354">      result.setEditable(false);</span>
<span class="nc" id="L355">      return result;</span>
   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>