<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UpdateSummaryDialog.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.client.update.gui</a> &gt; <span class="el_source">UpdateSummaryDialog.java</span></div><h1>UpdateSummaryDialog.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.client.update.gui;

/*
 * Copyright (C) 2007 Rob Manning
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.awt.BorderLayout;
import java.awt.Container;
import java.awt.Frame;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.util.List;

import javax.swing.AbstractAction;
import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JComponent;
import javax.swing.JDialog;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.KeyStroke;

import net.sourceforge.squirrel_sql.client.update.UpdateController;
import net.sourceforge.squirrel_sql.fw.gui.GUIUtils;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

/**
 * This dialog displays a summary of update information
 */
public class UpdateSummaryDialog extends JDialog {
   private static final long serialVersionUID = 1L;

   /** Internationalized strings for this class. */
<span class="nc" id="L52">   private static final StringManager s_stringMgr = StringManagerFactory.getStringManager(UpdateSummaryDialog.class);</span>

   private UpdateSummaryTable _updateSummaryTable;

<span class="nc" id="L56">   private JLabel _installedVersionLabel = null;</span>
   
<span class="nc" id="L58">   private JLabel _availableVersionLabel = null;</span>
   
<span class="nc" id="L60">   private String _installedVersion = null;</span>
   
<span class="nc" id="L62">   private String _availableVersion = null;</span>
   
   static interface i18n {
      // i18n[UpdateSummaryDialog.applyLabel=Apply Changes]
<span class="nc" id="L66">      String APPLY_LABEL = s_stringMgr.getString(&quot;UpdateSummaryDialog.applyLabel&quot;);</span>

      // i18n[UpdateSummaryDialog.title=Update Summary]
<span class="nc" id="L69">      String TITLE = s_stringMgr.getString(&quot;UpdateSummaryDialog.title&quot;);</span>
      
      // i18n[UpdateSummaryDialog.currentVersionPrefix=Current Version:]
      String AVAILABLE_VERSION_PREFIX = 
<span class="nc" id="L73">         s_stringMgr.getString(&quot;UpdateSummaryDialog.currentVersionPrefix&quot;);</span>
      
      // i18n[UpdateSummaryDialog.installedVersionPrefix=Installed Version:]
      String INSTALLED_VERSION_PREFIX = 
<span class="nc" id="L77">         s_stringMgr.getString(&quot;UpdateSummaryDialog.installedVersionPrefix&quot;);</span>
      
      //i18n[UpdateSummaryDialog.close=Close]
<span class="nc" id="L80">      String CLOSE_LABEL = </span>
<span class="nc" id="L81">         s_stringMgr.getString(&quot;UpdateSummaryDialog.close&quot;);</span>
   }

   public UpdateSummaryDialog(Frame owner, List&lt;ArtifactStatus&gt; artifactStatus,
         UpdateController updateController) 
   {
<span class="nc" id="L87">      super(owner, i18n.TITLE);</span>
<span class="nc" id="L88">      createGUI(artifactStatus, updateController);</span>
<span class="nc" id="L89">   }</span>

   public void setInstalledVersion(String installedVersion) {
<span class="nc" id="L92">   	_installedVersion = installedVersion;</span>
<span class="nc" id="L93">      StringBuilder tmp = new StringBuilder(i18n.INSTALLED_VERSION_PREFIX);</span>
<span class="nc" id="L94">      tmp.append(&quot; &quot;);</span>
<span class="nc" id="L95">      tmp.append(installedVersion);</span>
<span class="nc" id="L96">      _installedVersionLabel.setText(tmp.toString());</span>
<span class="nc" id="L97">      setReleaseVersionWillChangeFlag();</span>
<span class="nc" id="L98">   }</span>
   
   public void setAvailableVersion(String availableVersion) {
<span class="nc" id="L101">   	_availableVersion = availableVersion;</span>
<span class="nc" id="L102">      StringBuilder tmp = new StringBuilder(i18n.AVAILABLE_VERSION_PREFIX);</span>
<span class="nc" id="L103">      tmp.append(&quot; &quot;);</span>
<span class="nc" id="L104">      tmp.append(availableVersion);</span>
<span class="nc" id="L105">      _availableVersionLabel.setText(tmp.toString());   </span>
<span class="nc" id="L106">      setReleaseVersionWillChangeFlag();</span>
<span class="nc" id="L107">   }</span>
   
   private void setReleaseVersionWillChangeFlag() {
<span class="nc bnc" id="L110" title="All 4 branches missed.">   	if (_availableVersion == null || _installedVersion == null) {</span>
<span class="nc" id="L111">   		return;</span>
   	}
<span class="nc bnc" id="L113" title="All 2 branches missed.">   	_updateSummaryTable.setReleaseVersionWillChange(!_availableVersion.equals(_installedVersion));</span>
<span class="nc" id="L114">   }</span>
   
   private void createGUI(final List&lt;ArtifactStatus&gt; artifactStatus, 
                          final UpdateController updateController) {
<span class="nc" id="L118">      setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>

<span class="nc" id="L120">      final Container contentPane = getContentPane();</span>
<span class="nc" id="L121">      contentPane.setLayout(new BorderLayout());</span>

<span class="nc" id="L123">      _installedVersionLabel = new JLabel();</span>
<span class="nc" id="L124">      _installedVersionLabel.setBorder(BorderFactory.createEmptyBorder(1, 4, 1, 4));</span>
      
<span class="nc" id="L126">      _availableVersionLabel = new JLabel();</span>
<span class="nc" id="L127">      _availableVersionLabel.setBorder(BorderFactory.createEmptyBorder(1, 4, 1, 4));</span>
      
<span class="nc" id="L129">      JPanel labelPanel = new JPanel();</span>
<span class="nc" id="L130">      labelPanel.add(_installedVersionLabel);</span>
<span class="nc" id="L131">      labelPanel.add(_availableVersionLabel);</span>
      // Label panel containing the versions for the update at top of dialog.
<span class="nc" id="L133">      contentPane.add(labelPanel, BorderLayout.NORTH);</span>

<span class="nc" id="L135">      UpdateSummaryTableModel model = new UpdateSummaryTableModel(artifactStatus);</span>
<span class="nc" id="L136">      _updateSummaryTable = new UpdateSummaryTable(artifactStatus, model);</span>
<span class="nc" id="L137">      contentPane.add(new JScrollPane(_updateSummaryTable), BorderLayout.CENTER);</span>

<span class="nc" id="L139">      final JPanel btnsPnl = new JPanel();</span>
<span class="nc" id="L140">      final JButton okBtn = new JButton(i18n.APPLY_LABEL);</span>
<span class="nc" id="L141">      okBtn.addActionListener(new ActionListener() {</span>
         public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L143">            List&lt;ArtifactStatus&gt; changes = </span>
<span class="nc" id="L144">               _updateSummaryTable.getUserRequestedChanges();</span>
<span class="nc" id="L145">            updateController.applyChanges(changes, _updateSummaryTable.getReleaseVersionWillChange());</span>
<span class="nc" id="L146">         }</span>
      });
<span class="nc" id="L148">      btnsPnl.add(okBtn);</span>

<span class="nc" id="L150">      final JButton closeBtn = new JButton(i18n.CLOSE_LABEL);</span>
<span class="nc" id="L151">      closeBtn.addActionListener(new ActionListener() {</span>
         public void actionPerformed(ActionEvent evt) {
<span class="nc" id="L153">            dispose();</span>
<span class="nc" id="L154">         }</span>
      });
<span class="nc" id="L156">      btnsPnl.add(closeBtn);</span>
<span class="nc" id="L157">      contentPane.add(btnsPnl, BorderLayout.SOUTH);</span>

<span class="nc" id="L159">      AbstractAction closeAction = new AbstractAction() {</span>
         private static final long serialVersionUID = 1L;

         public void actionPerformed(ActionEvent actionEvent) {
<span class="nc" id="L163">            setVisible(false);</span>
<span class="nc" id="L164">            dispose();</span>
<span class="nc" id="L165">         }</span>
      };
<span class="nc" id="L167">      KeyStroke escapeStroke = KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE, 0);</span>
<span class="nc" id="L168">      getRootPane().getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT)</span>
<span class="nc" id="L169">                   .put(escapeStroke, &quot;CloseAction&quot;);</span>
<span class="nc" id="L170">      getRootPane().getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW)</span>
<span class="nc" id="L171">                   .put(escapeStroke, &quot;CloseAction&quot;);</span>
<span class="nc" id="L172">      getRootPane().getInputMap(JComponent.WHEN_FOCUSED).put(escapeStroke,</span>
                                                             &quot;CloseAction&quot;);
<span class="nc" id="L174">      getRootPane().getActionMap().put(&quot;CloseAction&quot;, closeAction);</span>

<span class="nc" id="L176">      pack();</span>
<span class="nc" id="L177">      setSize(655, 500);</span>
<span class="nc" id="L178">      GUIUtils.centerWithinParent(this);</span>
<span class="nc" id="L179">      setResizable(true);</span>

<span class="nc" id="L181">   }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>