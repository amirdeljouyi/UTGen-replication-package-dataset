<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClobDescriptor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent</a> &gt; <span class="el_source">ClobDescriptor.java</span></div><h1>ClobDescriptor.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent;
/*
 * Copyright (C) 2001-2004 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.sql.Clob;

import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;
/**
 * @author gwg
 *
 * This is the object that is actually stored in the ContentsTab table
 * for a CLOB field.
 * The data in a CLOB is handled differently than other data types.
 * When the row in the DB is read, what is returned is actually a
 * java.sql.Clob object that points to the data rather than the data itself.
 * Since CLOBs can be very large (and thus take a long time to read), we
 * provide the user the flexibility to read only part of the CLOB data, or
 * to not read any of it.  We use the user selected options in various operations
 * such as deciding if the field is editable or not.
 * These options are set in the Session Parameters,
 * and since those parameters can be changed after the data has been read, we
 * make a copy of the appropriate information here.
 */
public class ClobDescriptor {

	/**
	 * The java.sql.Clob object that was read.
	 */
	Clob _clob;

	/**
	 * The data read from the Clob.
	 */
<span class="nc" id="L50">	String _data = null;</span>

	/**
	 * If &lt;TT&gt;_clobRead&lt;/TT&gt; is &lt;TT&gt;true&lt;/TT&gt; then at least some
	 * of the data in the CLOB should have been read.  If &lt;TT&gt;false&lt;/TT&gt;,
	 * then we have not even tried to read the data.
	 */
<span class="nc" id="L57">	private boolean _clobRead = false;</span>

	/**
	 * If &lt;TT&gt;_wholeClobRead&lt;/TT&gt; is &lt;TT&gt;true&lt;/TT&gt; then all of the
	 * data in this CLOB has been read into _data..
	 */
<span class="nc" id="L63">	private boolean _wholeClobRead = false;</span>

	/**
	 * If &lt;TT&gt;_wholeClobRead&lt;/TT&gt; is false, this is the size limit
	 * set by the user for how much to read.
	 */
	private int _userSetClobLimit;

	/** Internationalized strings for this class. */
<span class="nc" id="L72">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L73">		StringManagerFactory.getStringManager(ClobDescriptor.class);</span>

    public static interface i18n {
<span class="nc" id="L76">        String CLOB_LABEL = s_stringMgr.getString(&quot;ClobDescriptor.clob&quot;);</span>
    }
    
	/**
	 * Ctor
	 */
	public ClobDescriptor (
		Clob clob, String data,
<span class="nc" id="L84">		boolean clobRead, boolean wholeClobRead, int userSetClobLimit) {</span>
<span class="nc" id="L85">		_clob = clob;</span>
<span class="nc" id="L86">		_data = data;</span>
<span class="nc" id="L87">		_clobRead = clobRead;</span>
<span class="nc" id="L88">		_wholeClobRead = wholeClobRead;</span>
<span class="nc" id="L89">		_userSetClobLimit = userSetClobLimit;</span>
<span class="nc" id="L90">	}</span>

	/**
	 * Equals for Clobs means that the internal strings are identical,
	 * including their length.
	 * We need to account for the fact that one or both of them may not
	 * have actually had their data read.  If both have not had their data read,
	 * then they are &quot;equal&quot;, in a wierd kind of way.
	 */
	public boolean equals(ClobDescriptor c) {
<span class="nc bnc" id="L100" title="All 2 branches missed.">		if (c == null) {</span>
			// the other obj is null, so see if this non-null obj contains
			// a null value, which is equivilent.
			// Assume that if we have read some of the data and we still have
			// _data == null, then the value in the DB is actually null.
<span class="nc bnc" id="L105" title="All 4 branches missed.">			if (_clobRead == true &amp;&amp; _data == null)</span>
<span class="nc" id="L106">				return true;</span>
			else
<span class="nc" id="L108">				return false;</span>
		}

<span class="nc bnc" id="L111" title="All 2 branches missed.">		if (c.getClobRead() == false) {</span>
			// the other obj has not read the data yet.
<span class="nc bnc" id="L113" title="All 2 branches missed.">			if (_clobRead == true)</span>
<span class="nc" id="L114">				return false;	// we have read data, so that is not the same state</span>
<span class="nc" id="L115">			else return true;	//  odd-ball case: assume if neither has read data that they are equal</span>
		}

		// the other object has real data
<span class="nc bnc" id="L119" title="All 2 branches missed.">		if (_clobRead == false)</span>
<span class="nc" id="L120">			return false;	// this one does not, so they are not equal</span>

		// both have actual data, so compare the strings
		// Note that if one has read all of the data and the other has read only part
		// of the data that we will say that they are NOT equal.
<span class="nc" id="L125">		return c.getData().equals(_data);</span>
	}

	/**
	 * toString means print the data string, unless the data has not been
	 * read at all.
	 */
	public String toString()
	{
<span class="nc bnc" id="L134" title="All 2 branches missed.">		if (_clobRead)</span>
		{
<span class="nc bnc" id="L136" title="All 2 branches missed.">			if (_data == null)</span>
			{
<span class="nc" id="L138">				return s_stringMgr.getString(&quot;ClobDescriptor.null&quot;);</span>
			}
<span class="nc bnc" id="L140" title="All 4 branches missed.">			if (_wholeClobRead || _userSetClobLimit &gt; _data.length())</span>
			{
<span class="nc" id="L142">				return _data;	// we have the whole contents of the CLOB</span>
			}
<span class="nc" id="L144">			return _data + &quot;...&quot;;	// tell user the data is truncated</span>
		}
<span class="nc" id="L146">		return i18n.CLOB_LABEL;</span>
	}

	/*
	 * Getters and Setters
	 */

<span class="nc" id="L153">	public Clob getClob(){return _clob;}</span>
<span class="nc" id="L154">	public void setClob(Clob clob){_clob = clob;}</span>

<span class="nc" id="L156">	public String getData(){return _data;}</span>
<span class="nc" id="L157">	public void setData(String data){_data = data;}</span>

<span class="nc" id="L159">	public boolean getClobRead(){return _clobRead;}</span>
<span class="nc" id="L160">	public void setClobRead(boolean clobRead){_clobRead = clobRead;}</span>

<span class="nc" id="L162">	public boolean getWholeClobRead(){return _wholeClobRead;}</span>
<span class="nc" id="L163">	public void setWholeClobRead(boolean wholeClobRead){_wholeClobRead = wholeClobRead;}</span>

<span class="nc" id="L165">	public int getUserSetClobLimit(){return _userSetClobLimit;}</span>
	public void setUserSetClobLimit(int userSetClobLimit)
<span class="nc" id="L167">		{_userSetClobLimit = userSetClobLimit;}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>