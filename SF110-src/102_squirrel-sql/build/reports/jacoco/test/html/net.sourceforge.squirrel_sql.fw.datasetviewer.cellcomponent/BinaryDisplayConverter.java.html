<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BinaryDisplayConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent</a> &gt; <span class="el_source">BinaryDisplayConverter.java</span></div><h1>BinaryDisplayConverter.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent;
/*
 * Copyright (C) 2001-2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
 
 
/**
 * @author gwg
 *
 * This encapsulates the functions of converting binary data
 * (held as an array of Bytes)
 * into a string for display, and converting a string from a display
 * into an array of Bytes.
 * Both operations allow for the string to be &quot;&lt;null&gt;&quot;.
 * Both operations allow for hex, octal, decimal or binary representation.
 * Both operations allow for individual bytes that represent ascii characters
 * to be displayed as that ascii char rather than as the binary representation.
 * &lt;P&gt;
 * These functions are entirely static since all parameters are handed in
 * each time they are called, so there is no need for any instances of this
 * class to ever be created.
 */
public class BinaryDisplayConverter {
	
	/**
	 * Use Hexidecimal representation
	 */
	 public static final int HEX = 16;
	 
	 /**
	  * Use decimal representation.
	  */
	 public static final int DECIMAL = 10;
	 
	 /**
	  * Use Octal representation.
	  */
	 public static final int OCTAL = 8;
	 
	 /**
	  * Use Binary representation.
	  */
	 public static final int BINARY = 2;
	
	/*
	 * Conversion Constants
	 */
	 static class ConversionConstants {
	 	int width;	// number of chars used to represent byte
	 	int radix;	// the base radix
	 	
<span class="nc" id="L67">	 	ConversionConstants(int w, int r) {</span>
<span class="nc" id="L68">	 		width = w;</span>
<span class="nc" id="L69">	 		radix = r;</span>
<span class="nc" id="L70">	 	}</span>
	 }
	 
<span class="nc" id="L73">	 static ConversionConstants hex = new ConversionConstants(2, 16);</span>
<span class="nc" id="L74">	 static ConversionConstants decimal = new ConversionConstants(3, 10);</span>
<span class="nc" id="L75">	 private static ConversionConstants octal = new ConversionConstants(3, 8);</span>
<span class="nc" id="L76">	 private static ConversionConstants binary = new ConversionConstants(8, 2);</span>
	 
	 /**
	  * List of characters considered &quot;printable&quot;.
	  */
<span class="nc" id="L81">	 private static String printable = &quot;0123456789abcdefghijklmnopqrstuvwxyz&quot; +</span>
	 	&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ`~!@#$%^&amp;*()-_=+[{]}\\|;:'\&quot;,&lt;.&gt;/?&quot;;
	 
	
	/**
	 * Do not allow any instances to be created.
	 */
	private BinaryDisplayConverter() {}
	
	/**
	 * Convert from an array of Bytes into a string.
	 */
	public static String convertToString(Byte[] data, int base, boolean showAscii) {
		
		// handle null
<span class="nc bnc" id="L96" title="All 2 branches missed.">		if (data == null)</span>
<span class="nc" id="L97">			return null;</span>

<span class="nc" id="L99">		StringBuffer buf = new StringBuffer();</span>
		
<span class="nc" id="L101">		ConversionConstants convConst = getConstants(base);</span>
		
		// Convert each byte and put into string buffer
<span class="nc bnc" id="L104" title="All 2 branches missed.">		for (int i=0; i &lt; data.length; i++) {</span>
<span class="nc" id="L105">			int value = data[i].byteValue();</span>
<span class="nc" id="L106">			String s = null;</span>
			
			// if user wants to see ASCII chars as characters,
			// see if this is one that should be displayed that way
<span class="nc bnc" id="L110" title="All 2 branches missed.">			if (showAscii) {</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">				if (printable.indexOf((char)value) &gt; -1) {</span>
<span class="nc" id="L112">					s = Character.valueOf((char)value) +</span>
<span class="nc" id="L113">						&quot;          &quot;.substring(10-(convConst.width - 1));</span>
				}
			}
			
			// if use is not looking for ASCII chars, or if this one is one that
			// is not printable, then convert it into numeric form
<span class="nc bnc" id="L119" title="All 2 branches missed.">			if (s == null) {</span>
<span class="nc bnc" id="L120" title="All 4 branches missed.">				switch (base) {</span>
					case DECIMAL:	
						// convert signed to unsigned
<span class="nc bnc" id="L123" title="All 2 branches missed.">						if (value &lt; 0)</span>
<span class="nc" id="L124">							value = 256 + value;</span>
<span class="nc" id="L125">						s = Integer.toString(value); break;</span>
<span class="nc" id="L126">					case OCTAL:		s = Integer.toOctalString(value); break;</span>
<span class="nc" id="L127">					case BINARY:	s = Integer.toBinaryString(value); break;</span>
					case HEX:	// fall through to default
					default:
<span class="nc" id="L130">						s = Integer.toHexString(value);</span>
				}
				// some formats (e.g. hex &amp; octal) extend a negative number to multiple places
				// (e.g. FC becomes FFFC), so chop off extra stuff in front
<span class="nc bnc" id="L134" title="All 2 branches missed.">				if (s.length() &gt; convConst.width)</span>
<span class="nc" id="L135">					s = s.substring(s.length() - convConst.width);</span>
			
				// front pad with zeros and add to output
<span class="nc bnc" id="L138" title="All 2 branches missed.">				if (s.length() &lt; convConst.width)</span>
<span class="nc" id="L139">					buf.append(&quot;00000000&quot;.substring(8-(convConst.width - s.length())));</span>
			}
<span class="nc" id="L141">			buf.append(s);</span>
<span class="nc" id="L142">			buf.append(&quot;  &quot;);	// always add spaces at end for consistancy</span>
		}
<span class="nc" id="L144">		return buf.toString();</span>
	}
	
	/**
	 * Convert a string into Bytes.  The string is assumed to be in
	 * the form generated by the convertToString function, with each
	 * byte's data space separated from each other byte's.
	 */
	public static Byte[] convertToBytes(String data, int base, boolean showAscii)
		throws NumberFormatException {
		
<span class="nc" id="L155">		ConversionConstants convConst = getConstants(base);</span>
		
<span class="nc bnc" id="L157" title="All 2 branches missed.">		if (data == null)</span>
<span class="nc" id="L158">			return null;</span>
		
<span class="nc bnc" id="L160" title="All 2 branches missed.">		if (data.length() == 0)</span>
<span class="nc" id="L161">			return new Byte[0];</span>
		
<span class="nc bnc" id="L163" title="All 2 branches missed.">		if (data.equals(&quot;&lt;null&gt;&quot;))</span>
<span class="nc" id="L164">			return null;</span>
		
<span class="nc" id="L166">		int stringIndex = 0;</span>
<span class="nc" id="L167">		int byteIndex = 0;</span>
<span class="nc" id="L168">		Byte[] bytes = new Byte[(data.length()+2)/(convConst.width+2)];</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">		while (stringIndex &lt; data.length()) {</span>
			// get the text to be converted
<span class="nc" id="L171">			String s = data.substring(stringIndex, stringIndex+convConst.width);</span>
			
			// handle ASCII chars
			// Irrespective of the radix, the second byte will always
			// be a space when the data is displayed as a single ASCII character.
<span class="nc bnc" id="L176" title="All 4 branches missed.">			if (showAscii &amp;&amp; s.charAt(1) == ' ') {</span>
				// convert the char into its numeric value
<span class="nc" id="L178">				bytes[byteIndex++] = Byte.valueOf((byte)s.charAt(0));</span>
			}
			else {

				// The following ugly conversion from text to Byte is necessary because
				// the Byte class is inconsistant.  When asked to output as Hex, it does
				// so as an UNSIGNED byte, but when asked to read back the same thing
				// using the Hex radix, it insists that the input must be SIGNED.
				// To get around this, we up-size the conversion to Integer, then 
				// truncate that to a byte, and finally convert the byte to a Byte.  Yech.
<span class="nc" id="L188">				bytes[byteIndex++] = Byte.valueOf(</span>
<span class="nc" id="L189">					(byte)(Integer.valueOf(s, convConst.radix)).intValue());	</span>
			}	

<span class="nc" id="L192">			stringIndex += convConst.width + 2;</span>
<span class="nc" id="L193">		}</span>
	
<span class="nc" id="L195">		return bytes;</span>
	}

	/**
	 * Get the constants to use for the given base.
	 */
	private static ConversionConstants getConstants(int base) {
<span class="nc bnc" id="L202" title="All 2 branches missed.">		if (base == HEX) return hex;</span>
<span class="nc bnc" id="L203" title="All 2 branches missed.">		if (base == DECIMAL) return decimal;</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">		if (base == OCTAL) return octal;</span>
<span class="nc bnc" id="L205" title="All 2 branches missed.">		if (base == BINARY) return binary;</span>
<span class="nc" id="L206">		return hex;	// default to hex if unknown base passed in</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>