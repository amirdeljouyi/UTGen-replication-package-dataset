<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FloatingPointBase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent</a> &gt; <span class="el_source">FloatingPointBase.java</span></div><h1>FloatingPointBase.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent;

import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Insets;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;
import java.text.NumberFormat;

import javax.swing.BorderFactory;
import javax.swing.ButtonGroup;
import javax.swing.JRadioButton;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import net.sourceforge.squirrel_sql.fw.gui.IntegerField;
import net.sourceforge.squirrel_sql.fw.gui.OkJPanel;
import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

import org.apache.commons.lang.StringUtils;

public abstract class FloatingPointBase extends BaseDataTypeComponent
{
<span class="nc" id="L25">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L26">		StringManagerFactory.getStringManager(FloatingPointBase.class);</span>

	// flag for whether we have already loaded the properties or not
<span class="nc" id="L29">	private static boolean propertiesAlreadyLoaded = false;</span>


	// flag for whether to use the default Java format (true)
	// or the Locale-dependent format (false)
<span class="nc" id="L34">	protected static boolean useJavaDefaultFormat = false;</span>
	
	
	/**
	 * How many Digits after the comma should be shown?
	 */
<span class="nc" id="L40">	protected static int maximumFractionDigits = 5;</span>
	

	/**
	 * Generate a JPanel containing controls that allow the user
	 * to adjust the properties for this DataType.
	 * All properties are static accross all instances of this DataType.
	 * However, the class may choose to apply the information differentially,
	 * such as keeping a list (also entered by the user) of table/column names
	 * for which certain properties should be used.
	 * &lt;P&gt;
	 * This is called ONLY if there is at least one property entered into the DTProperties
	 * for this class.
	 * &lt;P&gt;
	 * Since this method is called by reflection on the Method object derived from this class,
	 * it does not need to be included in the Interface.
	 * It would be nice to include this in the Interface for consistancy, documentation, etc,
	 * but the Interface does not seem to like static methods.
	 */
	public static OkJPanel getControlPanel() {

	  /*
				* If you add this method to one of the standard DataTypes in the
				* fw/datasetviewer/cellcomponent directory, you must also add the name
				* of that DataType class to the list in CellComponentFactory, method
				* getControlPanels, variable named initialClassNameList.
				* If the class is being registered with the factory using registerDataType,
				* then you should not include the class name in the list (it will be found
				* automatically), but if the DataType is part of the case statement in the
				* factory method getDataTypeObject, then it does need to be explicitly listed
				* in the getControlPanels method also.
				*/

		// if this panel is called before any instances of the class have been
		// created, we need to load the properties from the DTProperties.
<span class="nc" id="L75">		loadProperties();</span>

<span class="nc" id="L77">	  return new FloatingPointOkJPanel();</span>
	}


	public FloatingPointBase()
<span class="nc" id="L82">	{</span>
<span class="nc" id="L83">		loadProperties();</span>
<span class="nc" id="L84">	}</span>


	private static void loadProperties() {

		//set the property values
		// Note: this may have already been done by another instance of
		// this DataType created to handle a different column.
<span class="nc bnc" id="L92" title="All 2 branches missed.">		if (propertiesAlreadyLoaded == false) {</span>
			// get parameters previously set by user, or set default values
<span class="nc" id="L94">			useJavaDefaultFormat = false;	// set to use the Java default</span>
<span class="nc" id="L95">			String useJavaDefaultFormatString = DTProperties.get(DataTypeBigDecimal.class.getName(), &quot;useJavaDefaultFormat&quot;);</span>

<span class="nc bnc" id="L97" title="All 4 branches missed.">			if (useJavaDefaultFormatString != null &amp;&amp; useJavaDefaultFormatString.equals(&quot;true&quot;))</span>
			{
<span class="nc" id="L99">				useJavaDefaultFormat =true;</span>
			}
			
<span class="nc" id="L102">			maximumFractionDigits = 5; // by default use 5</span>
<span class="nc" id="L103">			String maximumFractionDigitsString = DTProperties.get(DataTypeBigDecimal.class.getName(), &quot;maximumFractionDigits&quot;);</span>

<span class="nc bnc" id="L105" title="All 2 branches missed.">			if (StringUtils.isEmpty(maximumFractionDigitsString) == false)</span>
			{
<span class="nc" id="L107">				maximumFractionDigits =Integer.valueOf(maximumFractionDigitsString);</span>
			}
		}
<span class="nc" id="L110">	}</span>


	/**
	 * Inner class that extends OkJPanel so that we can call the ok()
	 * method to save the data when the user is happy with it.
	 */
	private static class FloatingPointOkJPanel extends OkJPanel
	{
        private static final long serialVersionUID = 3745853322636427759L;

        JRadioButton optUseDefaultFormat;
		JRadioButton optUseLocaleDependendFormat;
		IntegerField maximumFraction;
		
		public FloatingPointOkJPanel()
<span class="nc" id="L126">		{</span>
			

<span class="nc" id="L129">			optUseDefaultFormat =</span>
<span class="nc" id="L130">				new JRadioButton(s_stringMgr.getString(&quot;floatingPointBase.useDefaultFormat&quot;, new Double(3.14159).toString()));</span>
<span class="nc" id="L131">			optUseLocaleDependendFormat =</span>
<span class="nc" id="L132">				new JRadioButton(createTextForOptUseLocaleDependendFormat(maximumFractionDigits));</span>
			
<span class="nc" id="L134">			maximumFraction = new IntegerField(2);</span>
			
<span class="nc" id="L136">			setBorder(BorderFactory.createTitledBorder(s_stringMgr.getString(&quot;floatingPointBase.typeBigDecimal&quot;)));</span>

<span class="nc" id="L138">			setLayout(new GridBagLayout());</span>

			GridBagConstraints gbc;
<span class="nc" id="L141">			gbc = new GridBagConstraints(0,0,1,1,0,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL, new Insets(4, 4, 4, 4),0,0);</span>
<span class="nc" id="L142">			add(optUseLocaleDependendFormat, gbc);</span>
			
<span class="nc" id="L144">			gbc = new GridBagConstraints(1,0,1,1,0,0,GridBagConstraints.EAST,GridBagConstraints.HORIZONTAL, new Insets(4, 4, 4, 4),0,0);</span>
<span class="nc" id="L145">			add(maximumFraction, gbc);</span>
			
<span class="nc" id="L147">			gbc = new GridBagConstraints(0,1,1,1,0,0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL, new Insets(0, 4, 4, 4),0,0);</span>
<span class="nc" id="L148">			add(optUseDefaultFormat, gbc);</span>



<span class="nc" id="L152">			ButtonGroup bg = new ButtonGroup();</span>
<span class="nc" id="L153">			bg.add(optUseDefaultFormat);</span>
<span class="nc" id="L154">			bg.add(optUseLocaleDependendFormat);</span>

			
			
			// Register listeners, for enabling/disabling the integer-field &quot;maximumFraction&quot;
<span class="nc" id="L159">			optUseLocaleDependendFormat.addChangeListener(new ChangeListener() {</span>
				@Override
				public void stateChanged(ChangeEvent e) {
<span class="nc bnc" id="L162" title="All 2 branches missed.">					if(optUseLocaleDependendFormat.isSelected()){</span>
<span class="nc" id="L163">						maximumFraction.setEditable(true);</span>
<span class="nc" id="L164">						maximumFraction.setEnabled(true);</span>
					}
<span class="nc" id="L166">				}</span>
			});			
			
<span class="nc" id="L169">			optUseDefaultFormat.addChangeListener(new ChangeListener() {</span>
				@Override
				public void stateChanged(ChangeEvent e) {
<span class="nc bnc" id="L172" title="All 2 branches missed.">					if(optUseDefaultFormat.isSelected()){</span>
<span class="nc" id="L173">						maximumFraction.setEditable(false);</span>
<span class="nc" id="L174">						maximumFraction.setEnabled(false);</span>
					}
<span class="nc" id="L176">				}</span>
			});
			
			
			// Register a listener for updating the example text with the actual settings of maximumFractions
<span class="nc" id="L181">			maximumFraction.addFocusListener(new FocusListener() {</span>
				@Override
				public void focusLost(FocusEvent e) {
<span class="nc" id="L184">					optUseLocaleDependendFormat.setText(createTextForOptUseLocaleDependendFormat(maximumFraction.getInt()));</span>
<span class="nc" id="L185">					maximumFraction.repaint();</span>
<span class="nc" id="L186">				}</span>
				
				@Override
				public void focusGained(FocusEvent e) {
					// do nothing
<span class="nc" id="L191">				}</span>
			});
			
			
			// set the initial value
<span class="nc bnc" id="L196" title="All 2 branches missed.">			optUseLocaleDependendFormat.setSelected(!useJavaDefaultFormat);</span>
<span class="nc" id="L197">			optUseDefaultFormat.setSelected(useJavaDefaultFormat);</span>
<span class="nc" id="L198">			maximumFraction.setInt(maximumFractionDigits);</span>
			
<span class="nc" id="L200">		}</span>

		/**
		 * Creates the text for the {@link JRadioButton} of &quot;use locale depended format&quot; with respect of maxFractionDigits
		 * @param maxFractionDigits Number of digits after the comma to use in the example.  
		 */
		private String createTextForOptUseLocaleDependendFormat(int maxFractionDigits) {
<span class="nc" id="L207">			NumberFormat numberFormat = NumberFormat.getInstance();</span>
<span class="nc" id="L208">			numberFormat.setMaximumFractionDigits(maxFractionDigits);</span>
<span class="nc" id="L209">			return s_stringMgr.getString(&quot;floatingPointBase.uselocaleDependendFormat&quot;, numberFormat.format(new Double(3.14159)));</span>
		}

		/**
		 * User has clicked OK in the surrounding JPanel,
		 * so save the current state of all variables
		 */
		public void ok()
		{
			// get the values from the controls and set them in the static properties
<span class="nc" id="L219">			useJavaDefaultFormat = optUseDefaultFormat.isSelected();</span>
<span class="nc" id="L220">			DTProperties.put(DataTypeBigDecimal.class.getName(), </span>
			                 &quot;useJavaDefaultFormat&quot;, 
<span class="nc" id="L222">			                 Boolean.valueOf(useJavaDefaultFormat).toString());</span>
			
<span class="nc" id="L224">			maximumFractionDigits = maximumFraction.getInt();</span>
<span class="nc" id="L225">			DTProperties.put(DataTypeBigDecimal.class.getName(), </span>
	                 &quot;maximumFractionDigits&quot;, 
<span class="nc" id="L227">	                 Integer.valueOf(maximumFractionDigits).toString());</span>
<span class="nc" id="L228">		}</span>
	} // end of inner class

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>