<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BlobDescriptor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent</a> &gt; <span class="el_source">BlobDescriptor.java</span></div><h1>BlobDescriptor.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.datasetviewer.cellcomponent;
/*
 * Copyright (C) 2001-2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
 
import java.sql.Blob;
import java.util.Arrays;

import net.sourceforge.squirrel_sql.fw.util.StringManager;
import net.sourceforge.squirrel_sql.fw.util.StringManagerFactory;

/**
 * @author gwg
 *
 * This is the object that is actually stored in the ContentsTab table
 * for a BLOB field.
 * The data in a BLOB is handled differently than other data types.
 * When the row in the DB is read, what is returned is actually a
 * java.sql.Blob object that points to the data rather than the data itself.
 * Since BLOBs can be very large (and thus take a long time to read), we
 * provide the user the flexibility to read only part of the BLOB data, or
 * to not read any of it.  We use the user selected options in various operations
 * such as deciding if the field is editable or not.
 * These options are set in the Session Parameters,
 * and since those parameters can be changed after the data has been read, we
 * make a copy of the appropriate information here.
 */
public class BlobDescriptor {
	
	/**
	 * The java.sql.Blob object that was read.
	 */
	Blob _blob;
	
	/**
	 * The data read from the Blob.
	 */
<span class="nc" id="L53">	byte[] _data = null;</span>
	
	/**
	 * If &lt;TT&gt;_blobRead&lt;/TT&gt; is &lt;TT&gt;true&lt;/TT&gt; then at least some
	 * of the data in the BLOB should have been read.  If &lt;TT&gt;false&lt;/TT&gt;,
	 * then we have not even tried to read the data.
	 */
<span class="nc" id="L60">	private boolean _blobRead = false;</span>
	
	/**
	 * If &lt;TT&gt;_wholeBlobRead&lt;/TT&gt; is &lt;TT&gt;true&lt;/TT&gt; then all of the
	 * data in this BLOB has been read into _data..
	 */
<span class="nc" id="L66">	private boolean _wholeBlobRead = false;</span>

	/**
	 * If &lt;TT&gt;_wholeBlobRead&lt;/TT&gt; is false, this is the size limit
	 * set by the user for how much to read.
	 */
	private int _userSetBlobLimit;
	
	/** Internationalized strings for this class. */
<span class="nc" id="L75">	private static final StringManager s_stringMgr =</span>
<span class="nc" id="L76">		StringManagerFactory.getStringManager(BlobDescriptor.class);</span>
	
    public static interface i18n {
<span class="nc" id="L79">        String BLOB_LABEL = s_stringMgr.getString(&quot;BlobDescriptor.blob&quot;);</span>
    }
    
	/**
	 * Ctor
	 */
	public BlobDescriptor (
		Blob blob, byte[] data, 
<span class="nc" id="L87">		boolean blobRead, boolean wholeBlobRead, int userSetBlobLimit) {</span>
<span class="nc" id="L88">		_blob = blob;</span>
<span class="nc" id="L89">		_data = data;</span>
<span class="nc" id="L90">		_blobRead = blobRead;</span>
<span class="nc" id="L91">		_wholeBlobRead = wholeBlobRead;</span>
<span class="nc" id="L92">		_userSetBlobLimit = userSetBlobLimit;</span>
<span class="nc" id="L93">	}</span>
	
	/**
	 * Equals for Blobs means that the internal byte arrays are identical,
	 * including their length.
	 * We need to account for the fact that one or both of them may not
	 * have actually had their data read.  If both have not had their data read,
	 * then they are &quot;equal&quot;, in a wierd kind of way.
	 */
	public boolean equals(BlobDescriptor c) {
<span class="nc bnc" id="L103" title="All 2 branches missed.">		if (c == null) {</span>
			// the other obj is null, so see if this non-null obj contains
			// a null value, which is equivilent.
			// Assume that if we have read some of the data and we still have
			// _data == null, then the value in the DB is actually null.
<span class="nc bnc" id="L108" title="All 4 branches missed.">			if (_blobRead == true &amp;&amp; _data == null)</span>
<span class="nc" id="L109">				return true;</span>
			else
<span class="nc" id="L111">				return false;</span>
		}
		
<span class="nc bnc" id="L114" title="All 2 branches missed.">		if (c.getBlobRead() == false) {</span>
			// the other obj has not read the data yet.
<span class="nc bnc" id="L116" title="All 2 branches missed.">			if (_blobRead == true)</span>
<span class="nc" id="L117">				return false;	// we have read data, so that is not the same state</span>
<span class="nc" id="L118">			else return true;	//  odd-ball case: assume if neither has read data that they are equal</span>
		}
		
		// the other object has real data
<span class="nc bnc" id="L122" title="All 2 branches missed.">		if (_blobRead == false)</span>
<span class="nc" id="L123">			return false;	// this one does not, so they are not equal</span>
		
		// both have actual data, so compare the strings
		// Note that if one has read all of the data and the other has read only part
		// of the data that we will say that they are NOT equal.
<span class="nc" id="L128">		return Arrays.equals(c.getData(), _data);</span>
	}
	
	/**
	 * toString means print the data string, unless the data has not been
	 * read at all.
	 */
	public String toString() {
<span class="nc bnc" id="L136" title="All 2 branches missed.">		if (_blobRead) {</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">			if (_data == null)</span>
<span class="nc" id="L138">				return null;</span>
			
			// Convert the data into an ascii representation
			// using the standard convention
<span class="nc" id="L142">			Byte[] useValue = new Byte[_data.length];</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">					for (int i=0; i&lt;_data.length; i++)</span>
<span class="nc" id="L144">						useValue[i] = Byte.valueOf(_data[i]);</span>
<span class="nc" id="L145">			String outString = BinaryDisplayConverter.convertToString(useValue,</span>
						                            BinaryDisplayConverter.HEX, 
                                                    false);
<span class="nc bnc" id="L148" title="All 4 branches missed.">			if (_wholeBlobRead || _userSetBlobLimit &gt; _data.length)</span>
<span class="nc" id="L149">				return outString;	// we have the whole contents of the BLOB</span>
<span class="nc" id="L150">			else return outString+&quot;...&quot;;	// tell user the data is truncated</span>
		}
<span class="nc" id="L152">		else return i18n.BLOB_LABEL;</span>
	}
	
	/* 
	 * Getters and Setters
	 */
	 
<span class="nc" id="L159">	public Blob getBlob(){return _blob;}</span>
<span class="nc" id="L160">	public void setBlob(Blob blob){_blob = blob;}</span>
	 
<span class="nc" id="L162">	public byte[] getData(){return _data;}</span>
<span class="nc" id="L163">	public void setData(byte[] data){_data = data;}</span>
	
<span class="nc" id="L165">	public boolean getBlobRead(){return _blobRead;}</span>
<span class="nc" id="L166">	public void setBlobRead(boolean blobRead){_blobRead = blobRead;}</span>
	 
<span class="nc" id="L168">	public boolean getWholeBlobRead(){return _wholeBlobRead;}</span>
<span class="nc" id="L169">	public void setWholeBlobRead(boolean wholeBlobRead){_wholeBlobRead = wholeBlobRead;}</span>

<span class="nc" id="L171">	public int getUserSetBlobLimit(){return _userSetBlobLimit;}</span>
	public void setUserSetBlobLimit(int userSetBlobLimit)
<span class="nc" id="L173">		{_userSetBlobLimit = userSetBlobLimit;}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>