<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Resources.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">102_squirrel-sql</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.squirrel_sql.fw.util</a> &gt; <span class="el_source">Resources.java</span></div><h1>Resources.java</h1><pre class="source lang-java linenums">package net.sourceforge.squirrel_sql.fw.util;

/*
 * Copyright (C) 2001-2003 Colin Bell
 * colbell@users.sourceforge.net
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
import java.net.URL;
import java.util.Locale;
import java.util.MissingResourceException;
import java.util.ResourceBundle;

import javax.swing.*;

import net.sourceforge.squirrel_sql.fw.gui.action.BaseAction;
import net.sourceforge.squirrel_sql.fw.util.log.ILogger;
import net.sourceforge.squirrel_sql.fw.util.log.LoggerController;

public abstract class Resources implements IResources
{
	private interface ActionProperties
	{
		String DISABLED_IMAGE = &quot;disabledimage&quot;;

		String IMAGE = &quot;image&quot;;

		String NAME = &quot;name&quot;;

		String ROLLOVER_IMAGE = &quot;rolloverimage&quot;;

		String TOOLTIP = &quot;tooltip&quot;;
	}

	private interface MenuProperties
	{
		String TITLE = &quot;title&quot;;

		String MNEMONIC = &quot;mnemonic&quot;;
	}

	private interface MenuItemProperties extends MenuProperties
	{
		String ACCELERATOR = &quot;accelerator&quot;;
	}

	private interface Keys
	{
		String ACTION = &quot;action&quot;;

		String MENU = &quot;menu&quot;;

		String MENU_ITEM = &quot;menuitem&quot;;
	}

	/** Logger for this class. */
<span class="nc" id="L69">	private static final ILogger s_log = LoggerController.createLogger(Resources.class);</span>

	/** Applications resource bundle. */
	private final ResourceBundle _bundle;

	/** To load resources */
	private ClassLoader _classLoader;

	/** Path to images. */
	private final String _imagePath;

	protected Resources(String rsrcBundleBaseName, ClassLoader cl) {
<span class="nc" id="L81">		super();</span>
<span class="nc bnc" id="L82" title="All 4 branches missed.">		if (rsrcBundleBaseName == null || rsrcBundleBaseName.trim().length() == 0)</span>
		{
<span class="nc" id="L84">			throw new IllegalArgumentException(&quot;Null or empty rsrcBundleBaseName passed&quot;);</span>
		}

<span class="nc" id="L87">		_classLoader = cl;</span>
<span class="nc" id="L88">		_bundle = ResourceBundle.getBundle(rsrcBundleBaseName, Locale.getDefault(), cl);</span>
<span class="nc" id="L89">		_imagePath = _bundle.getString(&quot;path.images&quot;);</span>
<span class="nc" id="L90">	}</span>

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#getKeyStroke(javax.swing.Action)
	 */
	public KeyStroke getKeyStroke(Action action)
	{
<span class="nc" id="L97">		Utilities.checkNull(&quot;getKeyStroke&quot;, &quot;action&quot;, action);</span>
<span class="nc" id="L98">		final String fullKey = Keys.MENU_ITEM + &quot;.&quot; + action.getClass().getName();</span>

<span class="nc" id="L100">		String accel = getResourceString(fullKey, MenuItemProperties.ACCELERATOR);</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		if (accel.length() &gt; 0)</span>
		{
<span class="nc" id="L103">			return KeyStroke.getKeyStroke(accel);</span>
		}
<span class="nc" id="L105">		return null;</span>
	}

	private String getAcceleratorString(Action action)
	{
		try
		{
<span class="nc" id="L112">			final String fullKey = Keys.MENU_ITEM + &quot;.&quot; + action.getClass().getName();</span>
<span class="nc" id="L113">			return getResourceString(fullKey, MenuItemProperties.ACCELERATOR);</span>
<span class="nc" id="L114">		} catch (MissingResourceException e)</span>
		{
<span class="nc" id="L116">			return null;</span>
		}
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#addToPopupMenu(javax.swing.Action, javax.swing.JPopupMenu)
	 */
	public JMenuItem addToPopupMenu(Action action, javax.swing.JPopupMenu menu)
	      throws MissingResourceException
	{
<span class="nc" id="L126">		Utilities.checkNull(&quot;addToPopupMenu&quot;, &quot;action&quot;, action, &quot;menu&quot;, menu);</span>
<span class="nc" id="L127">		final String fullKey = Keys.MENU_ITEM + &quot;.&quot; + action.getClass().getName();</span>
<span class="nc" id="L128">		final JMenuItem item = menu.add(action);</span>

<span class="nc bnc" id="L130" title="All 2 branches missed.">		if (action.getValue(Action.MNEMONIC_KEY) == null)</span>
		{
<span class="nc" id="L132">			String mn = getResourceString(fullKey, MenuItemProperties.MNEMONIC);</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">			if (mn.length() &gt; 0)</span>
			{
<span class="nc" id="L135">				item.setMnemonic(mn.charAt(0));</span>
			}
		}

<span class="nc bnc" id="L139" title="All 2 branches missed.">		if (action.getValue(Action.ACCELERATOR_KEY) == null)</span>
		{
<span class="nc" id="L141">			String accel = getResourceString(fullKey, MenuItemProperties.ACCELERATOR);</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">			if (accel.length() &gt; 0)</span>
			{
<span class="nc" id="L144">				item.setAccelerator(KeyStroke.getKeyStroke(accel));</span>
			}
		}

<span class="nc" id="L148">		String toolTipText = getToolTipTextWithAccelerator(action, fullKey);</span>

<span class="nc" id="L150">		item.setToolTipText(toolTipText);</span>

<span class="nc" id="L152">		return item;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#addToMenuAsCheckBoxMenuItem(javax.swing.Action, javax.swing.JMenu)
	 */
	public JCheckBoxMenuItem addToMenuAsCheckBoxMenuItem(Action action, JMenu menu)
	      throws MissingResourceException
	{
<span class="nc" id="L161">		Utilities.checkNull(&quot;addToMenuAsCheckBoxMenuItem&quot;, &quot;action&quot;, action, &quot;menu&quot;, menu);</span>
<span class="nc" id="L162">		final JCheckBoxMenuItem item = new JCheckBoxMenuItem(action);</span>
<span class="nc" id="L163">		menu.add(item);</span>
<span class="nc" id="L164">		configureMenuItem(action, item);</span>
<span class="nc" id="L165">		return item;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#addToMenuAsCheckBoxMenuItem(javax.swing.Action, javax.swing.JPopupMenu)
	 */
	public JCheckBoxMenuItem addToMenuAsCheckBoxMenuItem(Action action, JPopupMenu popupMenu)
	{
<span class="nc" id="L173">		final JCheckBoxMenuItem item = new JCheckBoxMenuItem(action);</span>
<span class="nc" id="L174">		popupMenu.add(item);</span>
<span class="nc" id="L175">		configureMenuItem(action, item);</span>
<span class="nc" id="L176">		return item;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#addToMenu(javax.swing.Action, javax.swing.JMenu)
	 */
	public JMenuItem addToMenu(Action action, JMenu menu) throws MissingResourceException
	{
<span class="nc" id="L184">		final JMenuItem item = menu.add(action);</span>
<span class="nc" id="L185">		configureMenuItem(action, item);</span>
<span class="nc" id="L186">		return item;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#createMenu(java.lang.String)
	 */
	public JMenu createMenu(String menuKey) throws MissingResourceException
	{
<span class="nc" id="L194">		JMenu menu = new JMenu();</span>
<span class="nc" id="L195">		final String fullKey = Keys.MENU + &quot;.&quot; + menuKey;</span>
<span class="nc" id="L196">		menu.setText(getResourceString(fullKey, MenuProperties.TITLE));</span>
<span class="nc" id="L197">		String mn = getResourceString(fullKey, MenuProperties.MNEMONIC);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">		if (mn.length() &gt;= 1)</span>
		{
<span class="nc" id="L200">			menu.setMnemonic(mn.charAt(0));</span>
		}
<span class="nc" id="L202">		return menu;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#setupAction(javax.swing.Action, boolean)
	 */
	public void setupAction(Action action, boolean showColoricons)
	{
<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (action == null)</span>
		{
<span class="nc" id="L212">			throw new IllegalArgumentException(&quot;Action == null&quot;);</span>
		}

<span class="nc" id="L215">		final String actionClassName = action.getClass().getName();</span>
<span class="nc" id="L216">		final String key = Keys.ACTION + &quot;.&quot; + actionClassName;</span>
<span class="nc" id="L217">		action.putValue(Action.NAME, getResourceString(key, ActionProperties.NAME));</span>

<span class="nc" id="L219">		String shortDescription = getResourceString(key, ActionProperties.TOOLTIP);</span>

<span class="nc" id="L221">		String acceleratorString = getAcceleratorString(action);</span>
<span class="nc bnc" id="L222" title="All 4 branches missed.">		if (null != acceleratorString &amp;&amp; 0 &lt; acceleratorString.trim().length())</span>
		{
<span class="nc" id="L224">			shortDescription += &quot;  (&quot; + acceleratorString + &quot;)&quot;;</span>

		}

<span class="nc" id="L228">		action.putValue(Action.SHORT_DESCRIPTION, shortDescription);</span>

<span class="nc" id="L230">		String accelerator = getAcceleratorString(action);</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">		if (null != accelerator)</span>
		{
<span class="nc" id="L233">			action.putValue(ACCELERATOR_STRING, accelerator);</span>
		}

<span class="nc" id="L236">		Icon icon = null;</span>
		try
		{
<span class="nc bnc" id="L239" title="All 2 branches missed.">			if (showColoricons == true)</span>
			{
<span class="nc" id="L241">				icon = getIcon(key, ActionProperties.ROLLOVER_IMAGE);</span>
<span class="nc" id="L242">				action.putValue(Action.SMALL_ICON, icon);</span>
			} else
			{
<span class="nc" id="L245">				icon = getIcon(key, ActionProperties.IMAGE);</span>
<span class="nc" id="L246">				action.putValue(Action.SMALL_ICON, icon);</span>
			}
<span class="nc" id="L248">		} catch (MissingResourceException ex)</span>
		{
			try
			{
<span class="nc" id="L252">				icon = getIcon(key, ActionProperties.IMAGE);</span>
<span class="nc" id="L253">				action.putValue(Action.SMALL_ICON, icon);</span>
<span class="nc" id="L254">			} catch (MissingResourceException ignore)</span>
			{
				// Ignore
<span class="nc" id="L257">			}</span>
<span class="nc" id="L258">		}</span>

		try
		{
<span class="nc" id="L262">			icon = getIcon(key, ActionProperties.ROLLOVER_IMAGE);</span>
<span class="nc" id="L263">			action.putValue(BaseAction.IBaseActionPropertyNames.ROLLOVER_ICON, icon);</span>
<span class="nc" id="L264">		} catch (MissingResourceException ignore)</span>
		{
			// Ignore
<span class="nc" id="L267">		}</span>

		try
		{
<span class="nc" id="L271">			icon = getIcon(key, ActionProperties.DISABLED_IMAGE);</span>
<span class="nc" id="L272">			action.putValue(BaseAction.IBaseActionPropertyNames.DISABLED_ICON, icon);</span>
<span class="nc" id="L273">		} catch (MissingResourceException ignore)</span>
		{
			// Ignore
<span class="nc" id="L276">		}</span>
<span class="nc" id="L277">	}</span>

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#getIcon(java.lang.String)
	 */
	public ImageIcon getIcon(String keyName)
	{
<span class="nc" id="L284">		return getIcon(keyName, &quot;image&quot;);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#getIcon(java.lang.Class, java.lang.String)
	 */
	public ImageIcon getIcon(Class&lt;?&gt; objClass, String propName)
	{
<span class="nc" id="L292">		return getIcon(objClass.getName(), propName);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#getIcon(java.lang.String, java.lang.String)
	 */
	public ImageIcon getIcon(String keyName, String propName)
	{
<span class="nc bnc" id="L300" title="All 2 branches missed.">		if (keyName == null)</span>
		{
<span class="nc" id="L302">			throw new IllegalArgumentException(&quot;keyName == null&quot;);</span>
		}
<span class="nc bnc" id="L304" title="All 2 branches missed.">		if (propName == null)</span>
		{
<span class="nc" id="L306">			throw new IllegalArgumentException(&quot;propName == null&quot;);</span>
		}

<span class="nc" id="L309">		ImageIcon icon = null;</span>

<span class="nc" id="L311">		String rsrcName = getResourceString(keyName, propName);</span>

<span class="nc bnc" id="L313" title="All 4 branches missed.">		if (rsrcName != null &amp;&amp; rsrcName.length() &gt; 0)</span>
		{
<span class="nc" id="L315">			icon = privateGetIcon(rsrcName);</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">			if (icon == null)</span>
			{
<span class="nc" id="L318">				s_log.error(&quot;can't load image: &quot; + rsrcName);</span>
			}
		} else
		{
<span class="nc bnc" id="L322" title="All 2 branches missed.">			if (s_log.isDebugEnabled())</span>
			{
<span class="nc" id="L324">				s_log.debug(&quot;No resource found for &quot; + keyName + &quot; : &quot; + propName);</span>
			}
		}

<span class="nc" id="L328">		return icon;</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#getString(java.lang.String)
	 */
	public String getString(String key)
	{
<span class="nc" id="L336">		Utilities.checkNull(&quot;getString&quot;, &quot;key&quot;, key);</span>
<span class="nc" id="L337">		return _bundle.getString(key);</span>
	}

	/**
	 * @see net.sourceforge.squirrel_sql.fw.util.IResources#configureMenuItem(javax.swing.Action, javax.swing.JMenuItem)
	 */
	public void configureMenuItem(Action action, JMenuItem item) throws MissingResourceException
	{
<span class="nc" id="L345">		Utilities.checkNull(&quot;configureMenuItem&quot;, &quot;action&quot;, action, &quot;item&quot;, item);</span>
<span class="nc" id="L346">		final String fullKey = Keys.MENU_ITEM + &quot;.&quot; + action.getClass().getName();</span>

<span class="nc bnc" id="L348" title="All 2 branches missed.">		if (action.getValue(Action.MNEMONIC_KEY) == null)</span>
		{
<span class="nc" id="L350">			String mn = getResourceString(fullKey, MenuItemProperties.MNEMONIC);</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">			if (mn.length() &gt; 0)</span>
			{
<span class="nc" id="L353">				item.setMnemonic(mn.charAt(0));</span>
			}
		}

<span class="nc bnc" id="L357" title="All 2 branches missed.">		if (action.getValue(Action.ACCELERATOR_KEY) == null)</span>
		{
<span class="nc" id="L359">			String accel = getResourceString(fullKey, MenuItemProperties.ACCELERATOR);</span>
<span class="nc bnc" id="L360" title="All 2 branches missed.">			if (accel.length() &gt; 0)</span>
			{
<span class="nc" id="L362">				item.setAccelerator(KeyStroke.getKeyStroke(accel));</span>
			}
		}

<span class="nc" id="L366">		String toolTipText = getToolTipTextWithAccelerator(action, fullKey);</span>

<span class="nc" id="L368">		item.setToolTipText(toolTipText);</span>

		// item.setIcon(null);
<span class="nc" id="L371">	}</span>

	private String getToolTipTextWithAccelerator(Action action, String fullKey)
	{
<span class="nc" id="L375">		String toolTipText = (String) action.getValue(Action.SHORT_DESCRIPTION);</span>

<span class="nc bnc" id="L377" title="All 2 branches missed.">		if (null == toolTipText)</span>
		{
<span class="nc" id="L379">			toolTipText = &quot;&quot;;</span>
		}
		try
		{
<span class="nc" id="L383">			String accel = getResourceString(fullKey, MenuItemProperties.ACCELERATOR);</span>
<span class="nc bnc" id="L384" title="All 4 branches missed.">			if (null != accel &amp;&amp; accel.length() &gt; 0)</span>
			{
<span class="nc" id="L386">				toolTipText += &quot;  (&quot; + accel + &quot;)&quot;;</span>
			}
<span class="nc" id="L388">		} catch (MissingResourceException e)</span>
		{
			// Some actions dont have accelerators
<span class="nc" id="L391">		}</span>
<span class="nc" id="L392">		return toolTipText;</span>
	}

	protected ResourceBundle getBundle()
	{
<span class="nc" id="L397">		return _bundle;</span>
	}

	private ImageIcon privateGetIcon(String iconName)
	{
<span class="nc bnc" id="L402" title="All 4 branches missed.">		if (iconName != null &amp;&amp; iconName.length() &gt; 0)</span>
		{
			URL url;
<span class="nc" id="L405">			String imagePathName = getImagePathName(iconName);</span>

<span class="nc bnc" id="L407" title="All 2 branches missed.">			if (null == _classLoader)</span>
			{
<span class="nc" id="L409">				url = getClass().getResource(imagePathName);</span>

				// This slash stuff is a ...
<span class="nc bnc" id="L412" title="All 4 branches missed.">				if (null == url &amp;&amp; imagePathName.startsWith(&quot;/&quot;))</span>
				{
<span class="nc" id="L414">					url = getClass().getResource(imagePathName.substring(1));</span>
<span class="nc bnc" id="L415" title="All 4 branches missed.">				} else if (null == url &amp;&amp; false == imagePathName.startsWith(&quot;/&quot;))</span>
				{
<span class="nc" id="L417">					url = getClass().getResource(&quot;/&quot; + imagePathName);</span>
				}

			} else
			{
<span class="nc" id="L422">				url = _classLoader.getResource(imagePathName);</span>

<span class="nc bnc" id="L424" title="All 4 branches missed.">				if (null == url &amp;&amp; imagePathName.startsWith(&quot;/&quot;))</span>
				{
<span class="nc" id="L426">					url = _classLoader.getResource(imagePathName.substring(1));</span>
<span class="nc bnc" id="L427" title="All 4 branches missed.">				} else if (null == url &amp;&amp; false == imagePathName.startsWith(&quot;/&quot;))</span>
				{
<span class="nc" id="L429">					url = _classLoader.getResource(&quot;/&quot; + imagePathName);</span>
				}
			}

<span class="nc bnc" id="L433" title="All 2 branches missed.">			if (url != null)</span>
			{
<span class="nc" id="L435">				return new ImageIcon(url);</span>
			}
		}
<span class="nc" id="L438">		return null;</span>
	}

	private String getResourceString(String keyName, String propName) throws MissingResourceException
	{
<span class="nc" id="L443">		return _bundle.getString(keyName + &quot;.&quot; + propName);</span>
	}

	private String getImagePathName(String iconName)
	{
<span class="nc" id="L448">		return _imagePath + iconName;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>