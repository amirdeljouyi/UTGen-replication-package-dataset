<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ParameterMap.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">96_heal</a> &gt; <a href="index.source.html" class="el_package">org.heal.util</a> &gt; <span class="el_source">ParameterMap.java</span></div><h1>ParameterMap.java</h1><pre class="source lang-java linenums">package org.heal.util;

import java.util.HashMap;
import java.util.Map;
import java.util.Iterator;
import java.util.StringTokenizer;

/**
 * Convenience class for manipulating a ServletRequest.getParameterMap()
 *
 * @version 1.0
 * @author Brad Schaefer (&lt;A HREF=&quot;mailto:schaefer@lib.med.utah.edu&quot;&gt;schaefer@lib.med.utah.edu&lt;/A&gt;) 
 */
public class ParameterMap extends HashMap {

    public ParameterMap() {
<span class="nc" id="L17">        super();</span>
<span class="nc" id="L18">    }</span>

    public ParameterMap(Map map) {
<span class="nc" id="L21">        super(map);</span>
<span class="nc" id="L22">    }</span>

    /**
     * Initializes a ParameterMap with keys/values parsed from a
     * query string.&lt;br/&gt;&lt;br/&gt;
     *
     * For example, given the URL
     * &lt;code&gt;&quot;http://www.healcentral.org/healapp/searchResults?searchtype=simple&amp;keywords=foo&amp;page=1&quot;&lt;/code&gt;
     * the query string would be &lt;code&gt;&quot;searchtype=simple&amp;keywords=foo&amp;page=1&quot;&lt;/code&gt;.&lt;br/&gt;&lt;br/&gt;
     *
     *
     * The preferred constructor is ParameterMap(java.util.Map), but this is provided for
     * cases where an initial map is not available, but a query string is.
     *
     * @param queryString A String representation of a ParameterMap.
     */
<span class="nc" id="L38">    public ParameterMap(String queryString) {</span>
<span class="nc" id="L39">        StringTokenizer pairs = new StringTokenizer(queryString, &quot;&amp;&quot;);</span>
<span class="nc bnc" id="L40" title="All 2 branches missed.">        while(pairs.hasMoreTokens()) {</span>
<span class="nc" id="L41">            String pair = pairs.nextToken();</span>
<span class="nc" id="L42">            int equalIndex = pair.indexOf(&quot;=&quot;);</span>

            // Don't go any further for this pair if a '=' cannot be found
<span class="nc bnc" id="L45" title="All 2 branches missed.">            if(-1 == equalIndex) { continue; }</span>

<span class="nc" id="L47">            String key = pair.substring(0, equalIndex);</span>
            String value;
<span class="nc bnc" id="L49" title="All 2 branches missed.">            if((equalIndex + 1) &lt; pair.length()) {</span>
<span class="nc" id="L50">                value = pair.substring((equalIndex + 1), pair.length());</span>
            } else {
<span class="nc" id="L52">                value = &quot;&quot;;</span>
            }

            String[] paramValue;
<span class="nc bnc" id="L56" title="All 2 branches missed.">            if(!containsKey(key)) {</span>
<span class="nc" id="L57">                paramValue = new String[1];</span>
<span class="nc" id="L58">                paramValue[0] = value;</span>
            } else {
                // copies the old array into a new array which is one
                // element larger
<span class="nc" id="L62">                String[] temp = (String[])get(key);</span>
<span class="nc" id="L63">                paramValue = new String[temp.length+1];</span>
<span class="nc bnc" id="L64" title="All 2 branches missed.">                for(int i = 0; i &lt; temp.length; ++i) {</span>
<span class="nc" id="L65">                    paramValue[i] = temp[i];</span>
                }
<span class="nc" id="L67">                paramValue[temp.length] = value;</span>
            }
<span class="nc" id="L69">            put(key, paramValue);</span>
<span class="nc" id="L70">        }</span>
<span class="nc" id="L71">    }</span>

    /**
     *
     * @param key
     * @param value
     * @return
     * @throws IllegalArgumentException Thrown when a key is not a String, or a value is
     *      not a String[].
     */
    public Object put(Object key, Object value) {
<span class="nc bnc" id="L82" title="All 2 branches missed.">        if(!(value instanceof String[])) {</span>
<span class="nc" id="L83">            throw new IllegalArgumentException(&quot;Cannot put a non-String[] value into a ParameterMap&quot;);</span>
        }
<span class="nc bnc" id="L85" title="All 2 branches missed.">        if(!(key instanceof String)) {</span>
<span class="nc" id="L86">            throw new IllegalArgumentException(&quot;Cannot put a non-String key into a ParameterMap&quot;);</span>
        }
<span class="nc" id="L88">        return super.put(key, value);</span>
    }

    /**
     * Over-ridden method to correctly put a single String value
     * into the parameter map as a String[] (since that's how
     * parameters need to be stored).
     *
     * @param key
     * @param value
     * @return
     */
    public Object put(String key, String value) {
<span class="nc" id="L101">        String[] temp = { value };</span>
<span class="nc" id="L102">        return super.put(key, temp);</span>
    }

    public String toString() {
<span class="nc" id="L106">        StringBuffer ret = new StringBuffer();</span>
<span class="nc" id="L107">        Iterator iter = entrySet().iterator();</span>
<span class="nc bnc" id="L108" title="All 2 branches missed.">        while(iter.hasNext()) {</span>
<span class="nc" id="L109">            Map.Entry pair = (Map.Entry)iter.next();</span>
<span class="nc" id="L110">            String[] values = (String[])pair.getValue();</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">            for(int i = 0; i &lt; values.length; ++i) {</span>
<span class="nc" id="L112">                ret.append((String)pair.getKey()).append(&quot;=&quot;).append(values[i]);</span>
<span class="nc bnc" id="L113" title="All 4 branches missed.">                if(iter.hasNext() || (i+1) &lt; values.length) {</span>
                    // only adds a &amp; if there are more parameters to add
<span class="nc" id="L115">                    ret.append(&quot;&amp;&quot;);</span>
                }
            }
<span class="nc" id="L118">        }</span>
<span class="nc" id="L119">        return ret.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>