<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SimpleSearchAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">96_heal</a> &gt; <a href="index.source.html" class="el_package">org.heal.servlet.search</a> &gt; <span class="el_source">SimpleSearchAction.java</span></div><h1>SimpleSearchAction.java</h1><pre class="source lang-java linenums">package org.heal.servlet.search;

import org.heal.module.search.ParameterBean;
import org.heal.module.search.ParameterNode;
import org.heal.module.search.SearchResultBean;
//import org.heal.module.search.ConceptMappingBean;
import org.heal.module.search.SimpleSearchDAO;
//import org.heal.module.search.ConceptMappingDAO;
import org.heal.servlet.Action;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.sql.SQLException;

/**
 * @author Grace/Julie
 * @version 0.1
 */
 
public class SimpleSearchAction implements Action
{
  public SimpleSearchAction()
<span class="nc" id="L26">  {</span>
<span class="nc" id="L27">  }</span>
  /**
   * 
   * @param servlet
   * @param request
   * @param response
   * @throws IOException
   * @throws ServletException
   */
  public void perform(HttpServlet servlet, HttpServletRequest request, HttpServletResponse response)
    throws IOException, ServletException 
  {
<span class="nc" id="L39">    SimpleSearchDAO sd = (SimpleSearchDAO) servlet.getServletContext().getAttribute(&quot;SimpleSearchDAO&quot;); </span>
   // ConceptMappingDAO cd = (ConceptMappingDAO) servlet.getServletContext().getAttribute(&quot;ConceptMappingDAO&quot;);
<span class="nc" id="L41">    request.getSession().setAttribute(&quot;prekeywords&quot;,null); </span>
<span class="nc" id="L42">    String consumer = request.getParameter(&quot;consumer&quot;);</span>
<span class="nc" id="L43">    String keywordString = request.getParameter(&quot;keywords&quot;);</span>
<span class="nc" id="L44">    String peir = request.getParameter(&quot;peir&quot;);</span>
<span class="nc" id="L45">    String searchType = request.getParameter(&quot;searchtype&quot;);</span>
<span class="nc" id="L46">    String keywords =&quot;&quot;;</span>
<span class="nc" id="L47">    ParameterBean param=new ParameterBean(keywordString); </span>
<span class="nc bnc" id="L48" title="All 2 branches missed.">    if (peir == null){</span>
<span class="nc" id="L49">       param.setUsageRights(null);; </span>
    }
    else {
<span class="nc" id="L52">        param.setUsageRights(&quot;PEIR&quot;);;</span>
    }
<span class="nc" id="L54">    request.getSession().setAttribute(&quot;searchResults&quot;, null); </span>
   // request.getSession().setAttribute(&quot;conceptMapping&quot;, null);
<span class="nc" id="L56">    SearchResultBean resultBean = new SearchResultBean();</span>
   // ConceptMappingBean cmb = new ConceptMappingBean();
    try 
    {
<span class="nc bnc" id="L60" title="All 2 branches missed.">      if (keywordString != null) </span>
      {
<span class="nc" id="L62">        resultBean = sd.simpleSearch(param,consumer);</span>
      //  cmb = cd.ConceptMapping(keywordString);     
<span class="nc bnc" id="L64" title="All 2 branches missed.">        for (int i =0; i&lt;param.size(); i++)</span>
        {
<span class="nc" id="L66">          ParameterNode tempNode=param.getParameters(i);</span>
<span class="nc bnc" id="L67" title="All 2 branches missed.">          if(i == 0)</span>
          {
<span class="nc" id="L69">            keywords = tempNode.getKeyWord();</span>
          }
          else 
          {
<span class="nc" id="L73">            keywords = keywords + &quot; &quot; + tempNode.getRelation()+&quot; &quot;+ tempNode.getKeyWord();</span>
          }
        }
<span class="nc" id="L76">        resultBean.setKeywords(keywords);  </span>
<span class="nc" id="L77">        request.getSession().setAttribute(&quot;searchResults&quot;, resultBean);</span>
       // request.getSession().setAttribute(&quot;conceptMapping&quot;, cmb);
      }
<span class="nc bnc" id="L80" title="All 2 branches missed.">      if (resultBean == null) System.err.println(&quot;rb is null&quot;);</span>
        //NOTE: PAGE MUST BE THE LAST PARAMETER!
<span class="nc" id="L82">      String queryString = request.getQueryString();  </span>
      
<span class="nc bnc" id="L84" title="All 4 branches missed.">      if (queryString == null || queryString.length() == 0) </span>
      {
<span class="nc" id="L86">        queryString = &quot;page=1&quot;;</span>
      } 
      else 
      {
<span class="nc" id="L90">        queryString = queryString + &quot;&amp;page=1&quot;;</span>
      }
<span class="nc" id="L92">      String redirectURL = &quot;searchResults?&quot; + queryString;</span>
<span class="nc" id="L93">      response.sendRedirect(redirectURL);     </span>
    } 
<span class="nc" id="L95">    catch (SQLException ex) </span>
    {
      //throw new SQLException(ex.toString());
<span class="nc" id="L98">    }    </span>
<span class="nc" id="L99">  }</span>
  /**
   * 
   * @return 
   */
  public boolean actionRequiresLogin() 
  {
<span class="nc" id="L106">    return false;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>