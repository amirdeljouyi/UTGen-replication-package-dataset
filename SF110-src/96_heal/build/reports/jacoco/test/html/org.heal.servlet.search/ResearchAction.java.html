<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ResearchAction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">96_heal</a> &gt; <a href="index.source.html" class="el_package">org.heal.servlet.search</a> &gt; <span class="el_source">ResearchAction.java</span></div><h1>ResearchAction.java</h1><pre class="source lang-java linenums">package org.heal.servlet.search;

import java.io.*;
import java.util.*;
import org.heal.module.search.*;
import org.heal.servlet.Action;
import javax.servlet.*;
import javax.servlet.http.*;
import java.sql.*;

/**
 * @author Grace
 * @version 0.1
 */
 
public class ResearchAction implements Action 
{
  public ResearchAction()
<span class="nc" id="L19">  {</span>
<span class="nc" id="L20">  }</span>
  public void perform(HttpServlet servlet, HttpServletRequest request, HttpServletResponse response)
            throws IOException, ServletException 
  {
<span class="nc" id="L24">    List metaIDs = null;</span>
<span class="nc" id="L25">    String metaids=null;</span>
    
<span class="nc" id="L27">    SearchResultBean resultBean = new SearchResultBean(); </span>
<span class="nc" id="L28">    ReSearchDAO sd = (ReSearchDAO) servlet.getServletContext().getAttribute(&quot;ReSearchDAO&quot;);</span>
<span class="nc" id="L29">    String checker = request.getParameter(&quot;check&quot;);  </span>
<span class="nc" id="L30">    String keywordString = request.getParameter(&quot;keywords&quot;);  </span>
<span class="nc" id="L31">    String searchtype = request.getParameter(&quot;selecttype&quot;);</span>
   // String pagenb = request.getParameter(&quot;page&quot;);
<span class="nc bnc" id="L33" title="All 2 branches missed.">    if(checker != null)</span>
    { 
<span class="nc" id="L35">      metaIDs=(List)request.getSession().getAttribute(&quot;metaids&quot;);</span>
     // System.out.print(&quot;step2:&quot;+metaIDs);
<span class="nc" id="L37">      metaids=sd.makeInString(metaIDs);</span>
      /* Tracking previous search words
      String prewords = request.getParameter(&quot;prekeywords&quot;);
      
      String prekeywords =(String)request.getSession().getAttribute(&quot;prekeywords&quot;);
      if(prekeywords != null) 
      {     
          prekeywords = prekeywords+&quot; AND &quot;+prewords;       
      }
      else 
      {
        prekeywords =prewords;
      }
      request.getSession().setAttribute(&quot;prekeywords&quot;,prekeywords);  
      */
    }
    else 
    {
<span class="nc" id="L55">      metaids = &quot;no&quot;;</span>
    //  request.getSession().setAttribute(&quot;prekeywords&quot;,null); 
    }    
<span class="nc bnc" id="L58" title="All 2 branches missed.">    if (keywordString == null) </span>
    {
<span class="nc" id="L60">      keywordString = &quot;%&quot;;</span>
    }
<span class="nc bnc" id="L62" title="All 4 branches missed.">    else if (keywordString != null &amp;&amp; keywordString.length() == 0) </span>
    {
<span class="nc" id="L64">      keywordString = &quot;%&quot;;</span>
    }
    else 
    {
      //control apostrophes search in database
<span class="nc" id="L69">      char ch=39;     </span>
<span class="nc" id="L70">      String nch=&quot;''&quot;;</span>
<span class="nc" id="L71">      String och=null;</span>
<span class="nc" id="L72">      och=Character.toString(ch);</span>
<span class="nc" id="L73">      keywordString=keywordString.toLowerCase();</span>
<span class="nc" id="L74">      keywordString=keywordString.replaceAll(och, nch);</span>
<span class="nc" id="L75">      keywordString=keywordString.replace('&quot;','%'); </span>
<span class="nc" id="L76">      keywordString=keywordString.replaceAll(&quot; and &quot;,&quot; &quot;); </span>
<span class="nc" id="L77">      keywordString=keywordString.replaceAll(&quot; or &quot;,&quot; &quot;);   </span>
    }
<span class="nc" id="L79">    request.getSession().setAttribute(&quot;searchResults&quot;, null);</span>
<span class="nc" id="L80">    String[] filterStringArray = request.getParameterValues(&quot;filters&quot;);        </span>
<span class="nc bnc" id="L81" title="All 4 branches missed.">    if ((filterStringArray != null) &amp;&amp; (filterStringArray[0].equals(&quot;all&quot;)))</span>
<span class="nc" id="L82">      filterStringArray = null;             </span>
    try 
    {
<span class="nc bnc" id="L85" title="All 2 branches missed.">      if (keywordString != null) </span>
      {
<span class="nc" id="L87">        resultBean = sd.editSearch(metaids,keywordString,filterStringArray,searchtype,false); //filter hidden </span>
       // System.out.print(&quot;\nID&quot;+metaids);
<span class="nc" id="L89">       List keys = new ArrayList();</span>
<span class="nc" id="L90">       String keywords = &quot;&quot;;</span>
<span class="nc" id="L91">       StringTokenizer tokenizer = new StringTokenizer(keywordString,&quot; &quot;);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">       while (tokenizer.hasMoreTokens()) </span>
       {
<span class="nc" id="L94">         keys.add(tokenizer.nextToken());</span>
       }
<span class="nc bnc" id="L96" title="All 2 branches missed.">       for (int i=0; i&lt;keys.size(); i++)</span>
       {
<span class="nc bnc" id="L98" title="All 2 branches missed.">         if(i == 0)</span>
          {
<span class="nc" id="L100">            keywords =(String)keys.get(0);</span>
          }
          else 
          {
<span class="nc bnc" id="L104" title="All 2 branches missed.">            if(searchtype.equals(&quot;All&quot;))</span>
            {
<span class="nc" id="L106">              keywords = keywords + &quot; AND &quot;+ (String)keys.get(i);  </span>
            }
<span class="nc bnc" id="L108" title="All 2 branches missed.">            if(searchtype.equals(&quot;Any&quot;))</span>
            {
<span class="nc" id="L110">              keywords = keywords + &quot; OR &quot;+ (String)keys.get(i); </span>
            }
<span class="nc bnc" id="L112" title="All 2 branches missed.">            if(searchtype.equals(&quot;Exact&quot;))</span>
            {
<span class="nc" id="L114">              keywords = keywords + &quot; &quot;+ (String)keys.get(i);    </span>
            }            
          }
        }
<span class="nc" id="L118">        resultBean.setKeywords(keywords);</span>
<span class="nc" id="L119">        request.getSession().setAttribute(&quot;searchResults&quot;, resultBean);</span>
      }
       
<span class="nc bnc" id="L122" title="All 2 branches missed.">      if (resultBean == null) System.err.println(&quot;rb is null&quot;);</span>
      //NOTE: PAGE MUST BE THE LAST PARAMETER!
<span class="nc" id="L124">      String queryString = request.getQueryString();        </span>
<span class="nc bnc" id="L125" title="All 4 branches missed.">      if (queryString == null || queryString.length() == 0) </span>
      {
<span class="nc" id="L127">        queryString = &quot;page=1&quot;;</span>
      } 
      else 
      {
<span class="nc" id="L131">        queryString = queryString + &quot;&amp;page=1&quot;;</span>
      }
<span class="nc" id="L133">      String redirectURL = &quot;searchResults?&quot; + queryString;</span>
<span class="nc" id="L134">      response.sendRedirect(redirectURL);</span>
    } 
<span class="nc" id="L136">    catch (SQLException ex) </span>
    {
      //throw new SQLException(ex.toString());
<span class="nc" id="L139">    }</span>
<span class="nc" id="L140">  }</span>
  public boolean actionRequiresLogin()
  {
<span class="nc" id="L143">    return false;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>