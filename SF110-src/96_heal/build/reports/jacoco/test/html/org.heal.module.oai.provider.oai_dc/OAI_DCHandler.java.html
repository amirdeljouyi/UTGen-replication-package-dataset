<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OAI_DCHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">96_heal</a> &gt; <a href="index.source.html" class="el_package">org.heal.module.oai.provider.oai_dc</a> &gt; <span class="el_source">OAI_DCHandler.java</span></div><h1>OAI_DCHandler.java</h1><pre class="source lang-java linenums">/*
 * Created on Dec 1, 2004
 *
 */
package org.heal.module.oai.provider.oai_dc;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.StringWriter;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerConfigurationException;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;

import org.heal.module.oai.provider.OAIMetadataFormat;
import org.heal.module.oai.provider.OAIMetadataHandler;
import org.heal.module.oai.provider.OAIRecordAdapter;
import org.w3c.dom.Document;
import org.w3c.dom.Element;

/**
 * @author Seth Wright
 *
 */
public class OAI_DCHandler implements OAIMetadataHandler {
	public static final String SIMPLEDC_PREFIX = &quot;dc&quot;;
	private final OAIMetadataFormat metadataFormat;

<span class="nc" id="L35">	public OAI_DCHandler(final OAIMetadataFormat format) {</span>
<span class="nc" id="L36">		this.metadataFormat = format;</span>
<span class="nc" id="L37">	}</span>
	public OAIMetadataFormat getFormat() {
<span class="nc" id="L39">		return metadataFormat;</span>
	}
	
	/* (non-Javadoc)
	 * @see org.heal.module.oai.provider.OAIMetadataHandler#writeRecord(org.heal.module.oai.provider.OAIRecord, java.io.OutputStream)
	 */
	public void writeMetadata(final OAIRecordAdapter record, final PrintWriter writer)
	throws IOException 
	{
<span class="nc" id="L48">		OAI_DCRecordAdapter recordAdapter = (OAI_DCRecordAdapter) record;</span>
		try {
			//create a new Document using JAXP
<span class="nc" id="L51">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L52">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L53">			Document doc = db.newDocument();</span>

			Element recordElem;
<span class="nc" id="L56">			recordElem = doc.createElement(metadataFormat.getPrefix()+&quot;:dc&quot;);</span>
<span class="nc" id="L57">			recordElem.setAttribute(&quot;xmlns:&quot;+metadataFormat.getPrefix(),metadataFormat.getNamespace());</span>

//include the dublin core...
<span class="nc" id="L60">			recordElem.setAttribute(&quot;xmlns:&quot;+OAI_DCHandler.SIMPLEDC_PREFIX,</span>
									&quot;http://purl.org/dc/elements/1.1/&quot;);
		 	    
<span class="nc" id="L63">			recordElem.setAttribute(&quot;xmlns:xsi&quot;,</span>
									&quot;http://www.w3.org/2001/XMLSchema-instance&quot;); 
            
<span class="nc" id="L66">			recordElem.setAttribute(&quot;xsi:schemaLocation&quot;,metadataFormat.getSchemaLocation());</span>

			//allow the recordAdapter to add any namespaces, etc necessary.
<span class="nc" id="L69">			recordAdapter.addRecordAttributes(recordElem,doc);</span>
<span class="nc" id="L70">			recordAdapter.appendTitleElements(recordElem,doc);</span>
<span class="nc" id="L71">			recordAdapter.appendCreatorElements(recordElem,doc);</span>
<span class="nc" id="L72">			recordAdapter.appendSubjectElements(recordElem,doc);</span>
<span class="nc" id="L73">			recordAdapter.appendDescriptionElements(recordElem,doc);</span>
<span class="nc" id="L74">			recordAdapter.appendPublisherElements(recordElem,doc);</span>
<span class="nc" id="L75">			recordAdapter.appendContributorElements(recordElem,doc);</span>
<span class="nc" id="L76">			recordAdapter.appendDateElements(recordElem,doc);</span>
<span class="nc" id="L77">			recordAdapter.appendTypeElements(recordElem,doc);</span>
<span class="nc" id="L78">			recordAdapter.appendFormatElements(recordElem,doc);</span>
<span class="nc" id="L79">			recordAdapter.appendIdentifierElements(recordElem,doc);</span>
<span class="nc" id="L80">			recordAdapter.appendSourceElements(recordElem,doc);</span>
<span class="nc" id="L81">			recordAdapter.appendLanguageElements(recordElem,doc);</span>
<span class="nc" id="L82">			recordAdapter.appendRelationElements(recordElem,doc);</span>
<span class="nc" id="L83">			recordAdapter.appendCoverageElements(recordElem,doc);</span>
<span class="nc" id="L84">			recordAdapter.appendRightsElements(recordElem,doc);</span>

<span class="nc" id="L86">			doc.appendChild(recordElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L89">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L90">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L91">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L92">			transformer.transform(new DOMSource(doc),new StreamResult(swriter));</span>

			///This is ugly...we need to strip off the initial &lt;?xml ?&gt; line
<span class="nc" id="L95">			String output = swriter.toString();</span>
<span class="nc" id="L96">			int questIndex = output.indexOf(&quot;?&gt;&quot;);		</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">			if (questIndex &gt; 0) {</span>
<span class="nc" id="L98">				writer.print(output.substring(questIndex+2));</span>
			} else {
<span class="nc" id="L100">				writer.print(output);</span>
			}
<span class="nc" id="L102">		} catch (ParserConfigurationException e) {</span>
<span class="nc" id="L103">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L104">			PrintWriter exwriter = new PrintWriter(swriter);</span>
<span class="nc" id="L105">			e.printStackTrace(exwriter);</span>
<span class="nc" id="L106">			throw new IOException(exwriter.toString());</span>
<span class="nc" id="L107">		} catch (TransformerConfigurationException e) {</span>
<span class="nc" id="L108">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L109">			PrintWriter exwriter = new PrintWriter(swriter);</span>
<span class="nc" id="L110">			e.printStackTrace(exwriter);</span>
<span class="nc" id="L111">			throw new IOException(exwriter.toString());</span>
<span class="nc" id="L112">		} catch (TransformerException e) {</span>
<span class="nc" id="L113">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L114">			PrintWriter exwriter = new PrintWriter(swriter);</span>
<span class="nc" id="L115">			e.printStackTrace(exwriter);</span>
<span class="nc" id="L116">			throw new IOException(exwriter.toString());</span>
<span class="nc" id="L117">		}</span>
<span class="nc" id="L118">	}	</span>

	public void writeCustomAbout(final OAIRecordAdapter record, final PrintWriter writer) 
	throws IOException {
<span class="nc" id="L122">		OAI_DCRecordAdapter recordAdapter = (OAI_DCRecordAdapter) record;</span>
		try {
			//create a new Document using JAXP
<span class="nc" id="L125">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L126">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L127">			Document doc = db.newDocument();</span>

<span class="nc" id="L129">			record.addCustomAbout(doc);</span>
			
			//now that we have the document built, we should write it out.
<span class="nc" id="L132">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L133">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L134">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L135">			transformer.transform(new DOMSource(doc),new StreamResult(swriter));</span>
			
			///This is ugly...we need to strip off the initial &lt;?xml ?&gt; line
<span class="nc" id="L138">			String output = swriter.toString();</span>
<span class="nc" id="L139">			int questIndex = output.indexOf(&quot;?&gt;&quot;);		</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">			if (questIndex &gt; 0) {</span>
<span class="nc" id="L141">				writer.print(output.substring(questIndex+2));</span>
			} else {
<span class="nc" id="L143">				writer.print(output);</span>
			}

<span class="nc" id="L146">		} catch (Exception ex) {</span>
<span class="nc" id="L147">			ex.printStackTrace();</span>
<span class="nc" id="L148">			throw new IOException(ex.toString());</span>
<span class="nc" id="L149">		}</span>
<span class="nc" id="L150">	}</span>
	
	public void writeOAIAbout(final OAIRecordAdapter record, final PrintWriter writer)
	throws IOException 
	{
<span class="nc" id="L155">		OAI_DCRecordAdapter recordAdapter = (OAI_DCRecordAdapter) record;</span>
		try {
			//create a new Document using JAXP
<span class="nc" id="L158">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L159">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L160">			Document doc = db.newDocument();</span>
			Element recordElem;
<span class="nc" id="L162">			recordElem = doc.createElement(metadataFormat.getPrefix()+&quot;:dc&quot;);</span>
<span class="nc" id="L163">			recordElem.setAttribute(&quot;xmlns:&quot;+metadataFormat.getPrefix(),metadataFormat.getNamespace());</span>

//include the dublin core...
<span class="nc" id="L166">			recordElem.setAttribute(&quot;xmlns:&quot;+OAI_DCHandler.SIMPLEDC_PREFIX,</span>
									&quot;http://purl.org/dc/elements/1.1/&quot;);
		 	    
<span class="nc" id="L169">			recordElem.setAttribute(&quot;xmlns:xsi&quot;,</span>
									&quot;http://www.w3.org/2001/XMLSchema-instance&quot;); 
            
<span class="nc" id="L172">			recordElem.setAttribute(&quot;xsi:schemaLocation&quot;,metadataFormat.getSchema());</span>

			//allow the recordAdapter to add any namespaces, etc necessary.
<span class="nc" id="L175">			recordAdapter.addOAIAboutAttributes(recordElem,doc);</span>
<span class="nc" id="L176">			recordAdapter.appendOAIAboutElements(recordElem,doc);</span>

<span class="nc" id="L178">			doc.appendChild(recordElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L181">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L182">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L183">			StringWriter swriter = new StringWriter();</span>
<span class="nc" id="L184">			transformer.transform(new DOMSource(doc),new StreamResult(swriter));</span>

			///This is ugly...we need to strip off the initial &lt;?xml ?&gt; line
<span class="nc" id="L187">			String output = swriter.toString();</span>
<span class="nc" id="L188">			int questIndex = output.indexOf(&quot;?&gt;&quot;);		</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">			if (questIndex &gt; 0) {</span>
<span class="nc" id="L190">				writer.print(output.substring(questIndex+2));</span>
			} else {
<span class="nc" id="L192">				writer.print(output);</span>
			}

<span class="nc" id="L195">		} catch (Exception ex) {</span>
<span class="nc" id="L196">			ex.printStackTrace();</span>
<span class="nc" id="L197">			throw new IOException(ex.toString());</span>
<span class="nc" id="L198">		}</span>
<span class="nc" id="L199">	}	</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>