<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HealMetadataXMLConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">96_heal</a> &gt; <a href="index.source.html" class="el_package">org.heal.module.metadata</a> &gt; <span class="el_source">HealMetadataXMLConverter.java</span></div><h1>HealMetadataXMLConverter.java</h1><pre class="source lang-java linenums">package org.heal.module.metadata;

import org.w3c.dom.Document;
import org.w3c.dom.Element;

import org.heal.util.DateTools;
import org.heal.util.FileLocator;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.SortedSet;
import java.util.TreeMap;

<span class="nc" id="L23">public class HealMetadataXMLConverter {</span>
	//public static final String IMSNAMESPACETAG = &quot;imsmd&quot;;
<span class="nc" id="L25">	public static final String IMSNAMESPACETAG = null;</span>

	/**
	 * Given a metadata bean and document, generates a complete IMS metadata
	 * representation of the provided bean using the document to create the
	 * elements.  The elemprefix is intended to allow the element names to
	 * begin with namespace information, so each element IMS element will
	 * be created with that prefix as follows: &quot;prefix:elementName&quot;.  So,
	 * the prefix should correspond to the prefix specified in an xmlns
	 * attribute that specifies the IMS metadata namespace definition.
	 * If no prefix is specified, then no prefix (or colon) is appended.
	 */
	public static Element metadataToElement(CompleteMetadataBean metaInfo,
											FileLocator fileLocator,
											String elemPrefix,
											Document doc) {
		Element recordElem, metametadataElem, generalElem, lifecycleElem;
		Element technicalElem, educationalElem, classificationElem;
		Element rightsElem;

		String nsPrefix;
<span class="nc bnc" id="L46" title="All 2 branches missed.">		if(elemPrefix == null) {</span>
<span class="nc" id="L47">			nsPrefix = &quot;&quot;;</span>
		} else {
<span class="nc" id="L49">			nsPrefix = elemPrefix + &quot;:&quot;;</span>
		}

<span class="nc" id="L52">		recordElem = doc.createElement(nsPrefix + &quot;record&quot;);</span>

<span class="nc" id="L54">		metametadataElem = createMetametadataElem(metaInfo, nsPrefix, doc);</span>
<span class="nc" id="L55">		recordElem.appendChild(metametadataElem);</span>

<span class="nc" id="L57">		generalElem = createGeneralElem(metaInfo, nsPrefix, doc);</span>
<span class="nc" id="L58">		recordElem.appendChild(generalElem);</span>

<span class="nc" id="L60">		lifecycleElem = createLifecycleElem(metaInfo, nsPrefix, doc);</span>
<span class="nc" id="L61">		recordElem.appendChild(lifecycleElem);</span>

<span class="nc" id="L63">		technicalElem = createTechnicalElem(metaInfo,</span>
			  fileLocator,
			  nsPrefix, doc);
<span class="nc" id="L66">		recordElem.appendChild(technicalElem);</span>

<span class="nc" id="L68">		educationalElem = createEducationalElem(metaInfo, nsPrefix, doc);</span>
<span class="nc" id="L69">		recordElem.appendChild(educationalElem);</span>

<span class="nc" id="L71">		rightsElem = createRightsElem(metaInfo, nsPrefix, doc);</span>
<span class="nc" id="L72">		recordElem.appendChild(rightsElem);</span>

<span class="nc" id="L74">		appendRelations(metaInfo, recordElem, nsPrefix, doc);</span>

<span class="nc" id="L76">		classificationElem = createClassificationElem(metaInfo,</span>
			  nsPrefix,
			  doc);
<span class="nc" id="L79">		recordElem.appendChild(classificationElem);</span>

<span class="nc" id="L81">		return recordElem;</span>
	}

	/**
	 * Takes a metadata bean and generates the IMS XML output for that
	 * bean.
	 */
	public static void metadataToIMSXML(CompleteMetadataBean metaInfo,
										FileLocator fileLocator,
										OutputStream out)
		  throws IOException {
		try {
			//create a new Document using JAXP
<span class="nc" id="L94">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L95">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L96">			Document doc = db.newDocument();</span>

<span class="nc" id="L98">			Element recordElem = metadataToElement(metaInfo,</span>
				  fileLocator,
				  IMSNAMESPACETAG,
				  doc);

			//recordElem.setAttribute(&quot;xmlns:&quot;+IMSNAMESPACETAG,
			//&quot;http://www.imsproject.org/metadata&quot;);


<span class="nc" id="L107">			recordElem.setAttribute(&quot;xmlns&quot;,</span>
				  &quot;http://www.healcentral.org/xsd/healmd_v1p5&quot;);

<span class="nc" id="L110">			recordElem.setAttribute(&quot;xmlns:xsi&quot;,</span>
				  &quot;http://www.w3.org/2001/XMLSchema-instance&quot;);

<span class="nc" id="L113">			recordElem.setAttribute(&quot;xsi:schemaLocation&quot;,</span>
				  &quot;http://www.healcentral.org/services/schema/HEALmdSchemaXMLv1p5.xsd&quot;);


<span class="nc" id="L117">			doc.appendChild(recordElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L120">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L121">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L122">			transformer.transform(new DOMSource(doc), new StreamResult(out));</span>
<span class="nc" id="L123">		} catch(Exception ex) {</span>
<span class="nc" id="L124">			ex.printStackTrace();</span>
<span class="nc" id="L125">			throw new IOException(ex.toString());</span>
<span class="nc" id="L126">		}</span>
<span class="nc" id="L127">	}</span>

	/**
	 * Creates a custom heal representation of the metadata.  This metadata
	 * contains the id, title, description, filename, fileextension, and
	 * filesize.
	 */
	public static void shortMetadataToXML(ShortMetadataBean metaInfo,
										  OutputStream out)
		  throws IOException {
<span class="nc" id="L137">		String id = metaInfo.getGlobalId();</span>
<span class="nc" id="L138">		String title = metaInfo.getTitle();</span>
<span class="nc" id="L139">		String description = metaInfo.getDescription();</span>
<span class="nc" id="L140">		String fileName = metaInfo.getFileName();</span>
<span class="nc" id="L141">		String fileExtension = metaInfo.getFileExtension();</span>
<span class="nc" id="L142">		String fileSize = metaInfo.getFileSize();</span>

		//String nsPrefix = IMSNAMESPACETAG+&quot;:&quot;;
<span class="nc" id="L145">		String nsPrefix = &quot;&quot;;</span>


		try {
			//create a new Document using JAXP
<span class="nc" id="L150">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L151">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L152">			Document doc = db.newDocument();</span>

			Element fileNameElem, fileExtensionElem, fileSizeElem, titleElem;
			Element titleStringElem, descriptionElem, descriptionStringElem;
			Element extensionElem, catalogEntryElem, technicalElem, generalElem;
			Element recordElem, metaElem, metaschemeElem, languageElem;

			//make the general element and sub elements
<span class="nc" id="L160">			titleElem = doc.createElement(nsPrefix + &quot;title&quot;);</span>
<span class="nc" id="L161">			titleStringElem = doc.createElement(nsPrefix + &quot;langstring&quot;);</span>
<span class="nc" id="L162">			titleStringElem.setAttribute(&quot;xml:lang&quot;, &quot;en-US&quot;);</span>
<span class="nc" id="L163">			titleStringElem.appendChild(doc.createTextNode(title));</span>
<span class="nc" id="L164">			titleElem.appendChild(titleStringElem);</span>

<span class="nc" id="L166">			descriptionElem = doc.createElement(nsPrefix + &quot;description&quot;);</span>
<span class="nc" id="L167">			descriptionStringElem = doc.createElement(nsPrefix + &quot;langstring&quot;);</span>
<span class="nc" id="L168">			descriptionStringElem.setAttribute(&quot;xml:lang&quot;, &quot;en-US&quot;);</span>
<span class="nc" id="L169">			descriptionStringElem.appendChild(doc.createTextNode(description));</span>
<span class="nc" id="L170">			descriptionElem.appendChild(titleStringElem);</span>

<span class="nc" id="L172">			catalogEntryElem = createCatalogEntryElem(id, nsPrefix, doc);</span>

<span class="nc" id="L174">			metaElem = doc.createElement(nsPrefix + &quot;metametadata&quot;);</span>
<span class="nc" id="L175">			metaElem.appendChild(catalogEntryElem);</span>
<span class="nc" id="L176">			metaschemeElem = doc.createElement(nsPrefix + &quot;metadatascheme&quot;);</span>
<span class="nc" id="L177">			metaschemeElem.appendChild(doc.createTextNode(&quot;IMS:1.1&quot;));</span>
<span class="nc" id="L178">			metaElem.appendChild(metaschemeElem);</span>
<span class="nc" id="L179">			languageElem = doc.createElement(nsPrefix + &quot;language&quot;);</span>
<span class="nc" id="L180">			languageElem.appendChild(doc.createTextNode(&quot;en-US&quot;));</span>
<span class="nc" id="L181">			metaElem.appendChild(languageElem);</span>

<span class="nc" id="L183">			catalogEntryElem = createCatalogEntryElem(id, nsPrefix, doc);</span>

<span class="nc" id="L185">			generalElem = doc.createElement(nsPrefix + &quot;general&quot;);</span>
<span class="nc" id="L186">			generalElem.appendChild(catalogEntryElem);</span>
<span class="nc" id="L187">			generalElem.appendChild(titleElem);</span>
<span class="nc" id="L188">			generalElem.appendChild(descriptionElem);</span>

			//make the technical portion
<span class="nc" id="L191">			fileNameElem = doc.createElement(&quot;filename&quot;);</span>
<span class="nc" id="L192">			fileNameElem.appendChild(doc.createTextNode(fileName));</span>
<span class="nc" id="L193">			fileExtensionElem = doc.createElement(&quot;fileextension&quot;);</span>
<span class="nc" id="L194">			fileExtensionElem.appendChild(doc.createTextNode(fileExtension));</span>
<span class="nc" id="L195">			fileSizeElem = doc.createElement(&quot;size&quot;);</span>
<span class="nc" id="L196">			fileSizeElem.appendChild(doc.createTextNode(fileSize));</span>
<span class="nc" id="L197">			extensionElem = doc.createElement(nsPrefix + &quot;extension&quot;);</span>
<span class="nc" id="L198">			extensionElem.appendChild(fileNameElem);</span>
<span class="nc" id="L199">			extensionElem.appendChild(fileExtensionElem);</span>
<span class="nc" id="L200">			technicalElem = doc.createElement(nsPrefix + &quot;technical&quot;);</span>
<span class="nc" id="L201">			technicalElem.appendChild(extensionElem);</span>
<span class="nc" id="L202">			technicalElem.appendChild(fileSizeElem);</span>

<span class="nc" id="L204">			recordElem = doc.createElement(nsPrefix + &quot;record&quot;);</span>
<span class="nc" id="L205">			recordElem.setAttribute(&quot;xmlns:&quot; + IMSNAMESPACETAG,</span>
				  &quot;http://www.imsproject.org/metadata&quot;);

<span class="nc" id="L208">			recordElem.appendChild(metaElem);</span>
<span class="nc" id="L209">			recordElem.appendChild(generalElem);</span>
<span class="nc" id="L210">			recordElem.appendChild(technicalElem);</span>

<span class="nc" id="L212">			doc.appendChild(recordElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L215">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L216">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L217">			transformer.transform(new DOMSource(doc), new StreamResult(out));</span>
<span class="nc" id="L218">		} catch(Exception ex) {</span>
<span class="nc" id="L219">			throw new IOException(ex.toString());</span>
<span class="nc" id="L220">		}</span>
<span class="nc" id="L221">	}</span>

	private static Element createCatalogEntryElem(String entry,
												  String nsPrefix,
												  Document doc) {
		//make the catalogentry portion of the general elem
<span class="nc" id="L227">		Element catalogueElem = doc.createElement(nsPrefix + &quot;catalogue&quot;);</span>
<span class="nc" id="L228">		catalogueElem.appendChild(doc.createTextNode(&quot;HEAL.org&quot;));</span>

<span class="nc" id="L230">		Element entryElem = createElementWithLang(nsPrefix + &quot;entry&quot;,</span>
			  &quot;en-US&quot;,
			  entry,
			  nsPrefix,
			  doc);
<span class="nc" id="L235">		Element catalogEntryElem = doc.createElement(nsPrefix + &quot;catalogentry&quot;);</span>
<span class="nc" id="L236">		catalogEntryElem.appendChild(catalogueElem);</span>
<span class="nc" id="L237">		catalogEntryElem.appendChild(entryElem);</span>
<span class="nc" id="L238">		return catalogEntryElem;</span>
	}

	/**
	 * Generates the metametadata element which contains the catalog entry
	 * which contains the global id, the metadata scheme and version, the
	 * language, and the contributors.
	 */
	private static Element createMetametadataElem(CompleteMetadataBean cmb,
												  String nsPrefix,
												  Document doc) {
		Element metaElem, catalogElem, schemeElem, languageElem;
<span class="nc bnc" id="L250" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L251">			return null;</span>
		}
<span class="nc" id="L253">		MetadataBean metadata = cmb.getMetadata();</span>
//	String metadataId = metadata.getMetadataId();
<span class="nc" id="L255">		String globalId = metadata.getGlobalId();</span>

<span class="nc" id="L257">		metaElem = doc.createElement(nsPrefix + &quot;metametadata&quot;);</span>
<span class="nc" id="L258">		catalogElem = createCatalogEntryElem(globalId, nsPrefix, doc);</span>
<span class="nc" id="L259">		metaElem.appendChild(catalogElem);</span>
<span class="nc" id="L260">		appendContributors(cmb, metaElem, nsPrefix, doc);</span>
<span class="nc" id="L261">		schemeElem = doc.createElement(nsPrefix + &quot;metadatascheme&quot;);</span>
<span class="nc" id="L262">		schemeElem.appendChild(doc.createTextNode(&quot;IMS:1.1&quot;));</span>
<span class="nc" id="L263">		metaElem.appendChild(schemeElem);</span>
<span class="nc" id="L264">		languageElem = doc.createElement(nsPrefix + &quot;language&quot;);</span>
<span class="nc" id="L265">		languageElem.appendChild(doc.createTextNode(&quot;en-US&quot;));</span>
<span class="nc" id="L266">		metaElem.appendChild(languageElem);</span>
<span class="nc" id="L267">		return metaElem;</span>
	}

	/**
	 * Given an element, appends the contributors specified in the complete
	 * metadata bean to the given element.
	 */
	private static void appendContributors(CompleteMetadataBean cmb,
										   Element parentElem,
										   String nsPrefix,
										   Document doc) {
<span class="nc bnc" id="L278" title="All 6 branches missed.">		if(cmb == null || parentElem == null || doc == null) {</span>
<span class="nc" id="L279">			return;</span>
		}
<span class="nc" id="L281">		TreeMap contributors = cmb.getContributors();</span>
<span class="nc" id="L282">		String contributeDate = null;</span>
<span class="nc" id="L283">		String role = null;</span>
<span class="nc" id="L284">		String vCard = null;</span>
<span class="nc" id="L285">		ContributorBean contributor = null;</span>
		Element dateElem, roleElem, contributorElem, vCardElem;
		ArrayList contribList;
		Iterator listIterator;

<span class="nc" id="L290">		contributeDate = DateTools.format(cmb.getContributeDate());</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">		if(contributors != null) {</span>
<span class="nc" id="L292">			Iterator contributorIterator = contributors.keySet().iterator();</span>
<span class="nc bnc" id="L293" title="All 2 branches missed.">			while(contributorIterator.hasNext()) {</span>
<span class="nc" id="L294">				role = (String)contributorIterator.next();</span>
<span class="nc" id="L295">				contribList = (ArrayList)contributors.get(role);</span>
<span class="nc" id="L296">				listIterator = contribList.iterator();</span>
<span class="nc" id="L297">				contributorElem = doc.createElement(nsPrefix + &quot;contribute&quot;);</span>
<span class="nc" id="L298">				roleElem = createElementWithLang(nsPrefix + &quot;role&quot;,</span>
					  null,
					  role,
					  nsPrefix,
					  doc);
<span class="nc" id="L303">				contributorElem.appendChild(roleElem);</span>

<span class="nc bnc" id="L305" title="All 2 branches missed.">				while(listIterator.hasNext()) {</span>
<span class="nc" id="L306">					contributor = (ContributorBean)listIterator.next();</span>
<span class="nc" id="L307">					vCard = contributor.getVCard();</span>
<span class="nc" id="L308">					vCardElem = createVCardElem(vCard, nsPrefix, doc);</span>
<span class="nc" id="L309">					contributorElem.appendChild(vCardElem);</span>
				}

<span class="nc bnc" id="L312" title="All 2 branches missed.">				if(contributeDate != null) {</span>
<span class="nc" id="L313">					dateElem = createDateElem(contributeDate, nsPrefix, doc);</span>
<span class="nc" id="L314">					contributorElem.appendChild(dateElem);</span>
				}
<span class="nc" id="L316">				parentElem.appendChild(contributorElem);</span>
			}
		}
<span class="nc" id="L319">	}</span>

	/**
	 * Generates a vcard element that adheres to the specified
	 * IMS hierarchy (centity containing a vcard).
	 */
	private static Element createVCardElem(String vCard,
										   String nsPrefix,
										   Document doc) {
<span class="nc bnc" id="L328" title="All 4 branches missed.">		if(vCard == null || doc == null) {</span>
<span class="nc" id="L329">			return null;</span>
		}
<span class="nc" id="L331">		Element centityElem = doc.createElement(nsPrefix + &quot;centity&quot;);</span>
<span class="nc" id="L332">		Element vCardElem = doc.createElement(nsPrefix + &quot;vcard&quot;);</span>
<span class="nc" id="L333">		vCardElem.appendChild(doc.createTextNode(vCard));</span>
<span class="nc" id="L334">		centityElem.appendChild(vCardElem);</span>
<span class="nc" id="L335">		return centityElem;</span>
	}

	/**
	 * Given a date string, creates a date and datetime element that adheres
	 * to the IMS's specifications for dates.
	 */
	private static Element createDateElem(String date,
										  String nsPrefix,
										  Document doc) {
<span class="nc bnc" id="L345" title="All 4 branches missed.">		if(date == null || doc == null) {</span>
<span class="nc" id="L346">			return null;</span>
		}
<span class="nc" id="L348">		Element dateElem = doc.createElement(nsPrefix + &quot;date&quot;);</span>
<span class="nc" id="L349">		Element dateTimeElem = doc.createElement(nsPrefix + &quot;datetime&quot;);</span>
<span class="nc" id="L350">		dateTimeElem.appendChild(doc.createTextNode(date));</span>
<span class="nc" id="L351">		dateElem.appendChild(dateTimeElem);</span>
<span class="nc" id="L352">		return dateElem;</span>
	}


	private static Element createGeneralElem(CompleteMetadataBean cmb,
											 String nsPrefix,
											 Document doc) {
<span class="nc bnc" id="L359" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L360">			return null;</span>
		}
		Element generalElem, catalogElem, descriptionElem, languageElem;
//	Element keywordsElem, titleElem, extensionElem;
		Element titleElem, extensionElem;

<span class="nc" id="L366">		MetadataBean metadata = cmb.getMetadata();</span>

<span class="nc" id="L368">		generalElem = doc.createElement(nsPrefix + &quot;general&quot;);</span>

<span class="nc bnc" id="L370" title="All 2 branches missed.">		if(metadata == null) {</span>
<span class="nc" id="L371">			return generalElem;</span>
		}

//	String metadataId = metadata.getMetadataId();
<span class="nc" id="L375">		String title = metadata.getTitle();</span>
<span class="nc" id="L376">		String globalId = metadata.getGlobalId();</span>
<span class="nc" id="L377">		String description = metadata.getDescription();</span>
		//ArrayList keywords = cmb.getKeywords();

<span class="nc" id="L380">		titleElem = createElementWithLang(nsPrefix + &quot;title&quot;,</span>
			  null,
			  title,
			  nsPrefix,
			  doc);
<span class="nc" id="L385">		generalElem.appendChild(titleElem);</span>
<span class="nc" id="L386">		catalogElem = createCatalogEntryElem(globalId, nsPrefix, doc);</span>
<span class="nc" id="L387">		generalElem.appendChild(catalogElem);</span>
<span class="nc" id="L388">		languageElem = doc.createElement(nsPrefix + &quot;language&quot;);</span>
<span class="nc" id="L389">		languageElem.appendChild(doc.createTextNode(&quot;en-US&quot;));</span>
<span class="nc" id="L390">		generalElem.appendChild(languageElem);</span>
<span class="nc" id="L391">		descriptionElem = createElementWithLang(nsPrefix + &quot;description&quot;,</span>
			  null,
			  description,
			  nsPrefix,
			  doc);
<span class="nc" id="L396">		generalElem.appendChild(descriptionElem);</span>
		//appendKeywordList(generalElem,keywords,nsPrefix,doc);

<span class="nc" id="L399">		extensionElem = createGeneralExtensionElem(cmb, nsPrefix, doc);</span>
<span class="nc" id="L400">		generalElem.appendChild(extensionElem);</span>

<span class="nc" id="L402">		return generalElem;</span>
	}

	private static Element createGeneralExtensionElem(CompleteMetadataBean cmb,
													  String nsPrefix,
													  Document doc) {
<span class="nc bnc" id="L408" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L409">			return null;</span>
		}
		Element extensionElem;

<span class="nc" id="L413">		MetadataBean meta = cmb.getMetadata();</span>

<span class="nc" id="L415">		extensionElem = doc.createElement(nsPrefix + &quot;extension&quot;);</span>

<span class="nc bnc" id="L417" title="All 2 branches missed.">		if(meta == null) {</span>
<span class="nc" id="L418">			return extensionElem;</span>
		}

<span class="nc" id="L421">		extensionElem.appendChild(createTextElement(&quot;specimentype&quot;,</span>
<span class="nc" id="L422">			  meta.getSpecimenType(),</span>
			  doc));
<span class="nc" id="L424">		extensionElem.appendChild(createTextElement(&quot;radiographtype&quot;,</span>
<span class="nc" id="L425">			  meta.getRadiographType(),</span>
			  doc));
<span class="nc" id="L427">		extensionElem.appendChild(createTextElement(&quot;orientation&quot;,</span>
<span class="nc" id="L428">			  meta.getOrientation(),</span>
			  doc));
<span class="nc" id="L430">		extensionElem.appendChild(createTextElement(&quot;magnification&quot;,</span>
<span class="nc" id="L431">			  meta.getMagnification(),</span>
			  doc));
<span class="nc" id="L433">		extensionElem.appendChild(createTextElement(&quot;annotated&quot;,</span>
<span class="nc" id="L434">			  booleanToYesNo(meta.isAnnotated()),</span>
			  doc));

<span class="nc bnc" id="L437" title="All 2 branches missed.">		for(Iterator iter = cmb.getDiseaseDiagnoses().iterator(); iter.hasNext();) {</span>
<span class="nc" id="L438">			DiseaseDiagnosisBean value = (DiseaseDiagnosisBean)iter.next();</span>
<span class="nc" id="L439">			extensionElem.appendChild(createTextElement(&quot;diseaseprocess&quot;,</span>
<span class="nc" id="L440">				  value.getDiseaseDiagnosis(), doc));</span>
<span class="nc" id="L441">		}</span>

<span class="nc" id="L443">		extensionElem.appendChild(createTextElement(&quot;clinicalhistory&quot;,</span>
<span class="nc" id="L444">			  meta.getClinicalHistory(),</span>
			  doc));
<span class="nc" id="L446">		appendDiseaseDiagnosesList(extensionElem,</span>
<span class="nc" id="L447">			  cmb.getDiseaseDiagnoses(),</span>
			  doc);

<span class="nc" id="L450">		appendContextURLList(extensionElem, cmb.getContextURLs(), doc);</span>

<span class="nc" id="L452">		extensionElem.appendChild(createTextElement(&quot;inappropriate&quot;,</span>
<span class="nc" id="L453">			  booleanToYesNo(meta.isInappropriate()),</span>
			  doc));
<span class="nc" id="L455">		return extensionElem;</span>
	}

	private static Element createLifecycleElem(CompleteMetadataBean cmb,
											   String nsPrefix,
											   Document doc) {
<span class="nc bnc" id="L461" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L462">			return null;</span>
		}
		Element lifecycleElem;

<span class="nc" id="L466">		lifecycleElem = doc.createElement(nsPrefix + &quot;lifecycle&quot;);</span>
<span class="nc" id="L467">		appendContributors(cmb, lifecycleElem, nsPrefix, doc);</span>

<span class="nc" id="L469">		return lifecycleElem;</span>

	}

	private static Element createTechnicalElem(CompleteMetadataBean cmb,
											   FileLocator fileLocator,
											   String nsPrefix,
											   Document doc) {
<span class="nc bnc" id="L477" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L478">			return null;</span>
		}
		Element technicalElem, extensionElem, locationElem;
		Element durationElem;
<span class="nc" id="L482">		MetadataBean meta = cmb.getMetadata();</span>

<span class="nc" id="L484">		technicalElem = doc.createElement(nsPrefix + &quot;technical&quot;);</span>
<span class="nc" id="L485">		extensionElem = createTechnicalExtensionElem(cmb, nsPrefix, doc);</span>
<span class="nc" id="L486">		technicalElem.appendChild(extensionElem);</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">		if(meta != null) {</span>
<span class="nc" id="L488">			technicalElem.appendChild(createTextElement(nsPrefix + &quot;size&quot;,</span>
<span class="nc" id="L489">				  meta.getFileSize(),</span>
				  doc));
<span class="nc" id="L491">			String location = fileLocator.getContentURL(meta.getLocation());</span>
<span class="nc" id="L492">			locationElem = doc.createElement(nsPrefix + &quot;location&quot;);</span>
<span class="nc" id="L493">			locationElem.setAttribute(&quot;type&quot;, &quot;URI&quot;);</span>
<span class="nc" id="L494">			locationElem.appendChild(doc.createTextNode(location));</span>
<span class="nc" id="L495">			technicalElem.appendChild(locationElem);</span>
		}
<span class="nc" id="L497">		appendRequirementsList(technicalElem,</span>
<span class="nc" id="L498">			  cmb.getRequirements(),</span>
			  nsPrefix,
			  doc);

<span class="nc" id="L502">		String duration = meta.getDuration();</span>
<span class="nc" id="L503">		durationElem = doc.createElement(nsPrefix + &quot;duration&quot;);</span>
<span class="nc bnc" id="L504" title="All 2 branches missed.">		if(duration != null) {</span>
			try {
<span class="nc" id="L506">				long durationLong = Long.parseLong(duration);</span>
<span class="nc" id="L507">				durationElem.appendChild(createDateTimeElem(durationLong,</span>
					  nsPrefix,
					  doc));
<span class="nc" id="L510">			} catch(NumberFormatException ex) {</span>
				//XXX ignore for now??  Should I output an error, log one?
<span class="nc" id="L512">			}</span>
		}
<span class="nc" id="L514">		technicalElem.appendChild(durationElem);</span>

<span class="nc" id="L516">		return technicalElem;</span>
	}

	/**
	 * Creates an element of the form:
	 * &lt;datetime&gt;yyyy-mm-ddThh:mm:ss&lt;/datetime&gt;
	 * The string is meant to be a duration, not a date, so a parameter of
	 * 180 will get a value of 0000-00-00T00:03:00 (3 minutes).
	 */
	private static Element createDateTimeElem(long seconds,
											  String nsPrefix,
											  Document doc) {
<span class="nc" id="L528">		long sec = seconds % 60;</span>
<span class="nc" id="L529">		long minutes = seconds / 60;</span>
<span class="nc" id="L530">		long min = minutes % 60;</span>
<span class="nc" id="L531">		long hours = minutes / 60;</span>
<span class="nc" id="L532">		String dtString = &quot;0000-00-00T&quot; + hours + min + sec;</span>
<span class="nc" id="L533">		Element dateTimeElem = doc.createElement(nsPrefix + &quot;datetime&quot;);</span>
<span class="nc" id="L534">		dateTimeElem.appendChild(doc.createTextNode(dtString));</span>
<span class="nc" id="L535">		return dateTimeElem;</span>
	}


	/**
	 * Creates a technical exstension element of the following form:
	 * If the CompleteMetadataBean's metadata property is not null, you get:
	 * &lt;extension&gt;
	 * &lt;filename&gt;name&lt;/filename&gt;      (OR &lt;filename /&gt; if filename is null)
	 * &lt;fileextension&gt;extension&lt;/fileextension&gt;
	 * (OR &lt;fileextension /&gt; if fileextension is null)
	 * &lt;filewidth&gt;width&lt;/filewidth&gt; (OR &lt;filewidth /&gt; if filewidth is null)
	 * &lt;fileheight&gt;height&lt;/fileheight&gt;
	 * (OR &lt;fileheight /&gt; if fileheight is null)
	 * &lt;/extension&gt;
	 * &lt;p/&gt;
	 * if the metadata property is null, you get:
	 * &lt;extension /&gt;
	 */
	private static Element createTechnicalExtensionElem(CompleteMetadataBean cmb,
														String nsPrefix,
														Document doc) {
<span class="nc bnc" id="L557" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L558">			return null;</span>
		}
<span class="nc" id="L560">		Element extensionElem = doc.createElement(nsPrefix + &quot;extension&quot;);</span>
<span class="nc" id="L561">		MetadataBean meta = cmb.getMetadata();</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">		if(meta != null) {</span>
<span class="nc" id="L563">			extensionElem.appendChild(createTextElement(&quot;filename&quot;,</span>
<span class="nc" id="L564">				  meta.getFileName(),</span>
				  doc));
<span class="nc" id="L566">			extensionElem.appendChild(createTextElement(&quot;fileextension&quot;,</span>
<span class="nc" id="L567">				  meta.getFileExtension(),</span>
				  doc));
<span class="nc" id="L569">			extensionElem.appendChild(createTextElement(&quot;filewidth&quot;,</span>
<span class="nc" id="L570">				  meta.getFileWidth(),</span>
				  doc));
<span class="nc" id="L572">			extensionElem.appendChild(createTextElement(&quot;fileheight&quot;,</span>
<span class="nc" id="L573">				  meta.getFileHeight(),</span>
				  doc));
		}
<span class="nc" id="L576">		return extensionElem;</span>
	}

	private static Element createEducationalElem(CompleteMetadataBean cmb,
												 String nsPrefix,
												 Document doc) {
<span class="nc bnc" id="L582" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L583">			return null;</span>
		}
		Element educationalElem, learningElem;
<span class="nc" id="L586">		educationalElem = doc.createElement(nsPrefix + &quot;educational&quot;);</span>
<span class="nc" id="L587">		Iterator iter = cmb.getTargetUserGroups().iterator();</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">		while(iter.hasNext()) {</span>
<span class="nc" id="L589">			learningElem = createElementWithLang(nsPrefix + &quot;learningcontext&quot;,</span>
				  &quot;en&quot;,
<span class="nc" id="L591">				  ((TargetUserGroupBean)iter.next()).getTargetUserGroup(),</span>
				  nsPrefix,
				  doc);
<span class="nc" id="L594">			educationalElem.appendChild(learningElem);</span>
		}

<span class="nc" id="L597">		return educationalElem;</span>
	}

	private static Element createRightsElem(CompleteMetadataBean cmb,
											String nsPrefix,
											Document doc) {
<span class="nc bnc" id="L603" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L604">			return null;</span>
		}
		Element rightsElem, hasCopyElem, extensionElem;
		ArrayList copyrights, copyrightHolders;
		String hasCopyrights;
<span class="nc" id="L609">		rightsElem = doc.createElement(nsPrefix + &quot;rights&quot;);</span>
<span class="nc" id="L610">		copyrights = cmb.getCopyrights();</span>
<span class="nc" id="L611">		copyrightHolders = cmb.getCopyrightHolders();</span>
<span class="nc bnc" id="L612" title="All 2 branches missed.">		if((copyrights == null ||</span>
<span class="nc bnc" id="L613" title="All 4 branches missed.">			  copyrights.size() == 0) &amp;&amp;</span>
			  (copyrightHolders == null ||
<span class="nc bnc" id="L615" title="All 2 branches missed.">			  copyrightHolders.size() == 0)) {</span>
<span class="nc" id="L616">			hasCopyrights = &quot;no&quot;;</span>
		} else {
<span class="nc" id="L618">			hasCopyrights = &quot;yes&quot;;</span>
		}
<span class="nc" id="L620">		hasCopyElem = createElementWithLang(nsPrefix + &quot;copyrightorotherrestrictions&quot;,</span>
			  null,
			  hasCopyrights,
			  nsPrefix,
			  doc);
<span class="nc" id="L625">		rightsElem.appendChild(hasCopyElem);</span>

<span class="nc" id="L627">		extensionElem = createRightsExtension(copyrights,</span>
			  copyrightHolders,
			  nsPrefix,
			  doc);
<span class="nc" id="L631">		rightsElem.appendChild(extensionElem);</span>
<span class="nc" id="L632">		return rightsElem;</span>
	}

	private static Element createRightsExtension(ArrayList copyrights,
												 ArrayList copyrightHolders,
												 String nsPrefix,
												 Document doc) {
<span class="nc bnc" id="L639" title="All 2 branches missed.">		if(doc == null) {</span>
<span class="nc" id="L640">			return null;</span>
		}
		Element extensionElem, copyrightElem, holderElem;
		String holderString, copyrightString;
		CopyrightBean copyright;
		CopyrightTextBean copyrightText;
		CopyrightHolderBean holder;

<span class="nc" id="L648">		extensionElem = doc.createElement(nsPrefix + &quot;extension&quot;);</span>

<span class="nc bnc" id="L650" title="All 2 branches missed.">		if(copyrightHolders != null) {</span>
<span class="nc" id="L651">			Iterator holderIterator = copyrightHolders.iterator();</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">			while(holderIterator.hasNext()) {</span>
<span class="nc" id="L653">				holder = (CopyrightHolderBean)holderIterator.next();</span>
<span class="nc" id="L654">				holderString = holder.getVCard();</span>
<span class="nc" id="L655">				holderElem = createVCardElem(holderString, nsPrefix, doc);</span>
<span class="nc" id="L656">				copyrightElem = doc.createElement(&quot;copyrightholder&quot;);</span>
<span class="nc" id="L657">				copyrightElem.appendChild(holderElem);</span>
<span class="nc" id="L658">				extensionElem.appendChild(copyrightElem);</span>
			}
<span class="nc" id="L660">		} else {</span>
<span class="nc" id="L661">			copyrightElem = doc.createElement(&quot;copyrightholder&quot;);</span>
<span class="nc" id="L662">			extensionElem.appendChild(copyrightElem);</span>
		}

<span class="nc bnc" id="L665" title="All 2 branches missed.">		if(copyrights != null) {</span>
<span class="nc" id="L666">			Iterator copyrightIterator = copyrights.iterator();</span>
<span class="nc bnc" id="L667" title="All 2 branches missed.">			while(copyrightIterator.hasNext()) {</span>
<span class="nc" id="L668">				copyright = (CopyrightBean)copyrightIterator.next();</span>
<span class="nc" id="L669">				copyrightText = copyright.getCopyrightText();</span>
<span class="nc bnc" id="L670" title="All 2 branches missed.">				if(copyrightText != null) {</span>
<span class="nc" id="L671">					copyrightString = copyrightText.getCopyrightText();</span>
<span class="nc" id="L672">					copyrightElem = createElementWithLang(&quot;copyrightdescription&quot;,</span>
						  null,
						  copyrightString,
						  nsPrefix,
						  doc);
<span class="nc" id="L677">					extensionElem.appendChild(copyrightElem);</span>
				}
			}
<span class="nc" id="L680">		} else {</span>
<span class="nc" id="L681">			copyrightElem = doc.createElement(&quot;copyrightdescription&quot;);</span>
<span class="nc" id="L682">			extensionElem.appendChild(copyrightElem);</span>
		}
<span class="nc" id="L684">		return extensionElem;</span>
	}

	private static void appendRelations(CompleteMetadataBean cmb,
										Element parentElem,
										String nsPrefix,
										Document doc) {
<span class="nc bnc" id="L691" title="All 6 branches missed.">		if(cmb == null || parentElem == null || doc == null) {</span>
<span class="nc" id="L692">			return;</span>
		}
<span class="nc" id="L694">		ArrayList relations = cmb.getRelations();</span>
<span class="nc" id="L695">		Iterator relationIterator = relations.iterator();</span>
		RelationBean relation;
		Element relationElem;
		Element resourceElem;
		String kind;
		String description;
		String resource;

<span class="nc bnc" id="L703" title="All 2 branches missed.">		while(relationIterator.hasNext()) {</span>
<span class="nc" id="L704">			relation = (RelationBean)relationIterator.next();</span>
<span class="nc" id="L705">			relationElem = doc.createElement(nsPrefix + &quot;relation&quot;);</span>
<span class="nc" id="L706">			kind = relation.getKind();</span>
<span class="nc bnc" id="L707" title="All 2 branches missed.">			if(kind != null) {</span>
<span class="nc" id="L708">				relationElem.appendChild(createElementWithLang(nsPrefix + &quot;kind&quot;,</span>
					  null,
					  kind,
					  nsPrefix,
					  doc));
			}
<span class="nc" id="L714">			description = relation.getDescription();</span>
<span class="nc" id="L715">			resource = relation.getResource();</span>
<span class="nc" id="L716">			resourceElem = doc.createElement(nsPrefix + &quot;resource&quot;);</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">			if(description != null) {</span>
<span class="nc" id="L718">				resourceElem.appendChild(createElementWithLang(nsPrefix + &quot;description&quot;,</span>
					  null,
					  description,
					  nsPrefix,
					  doc));
			}
<span class="nc bnc" id="L724" title="All 2 branches missed.">			if(resource != null) {</span>
<span class="nc" id="L725">				resourceElem.appendChild(createCatalogEntryElem(resource,</span>
					  nsPrefix,
					  doc));
			}
<span class="nc" id="L729">			relationElem.appendChild(resourceElem);</span>
<span class="nc" id="L730">			parentElem.appendChild(relationElem);</span>
		}
<span class="nc" id="L732">	}</span>

	private static Element createClassificationElem(CompleteMetadataBean cmb,
													String nsPrefix,
													Document doc) {
<span class="nc bnc" id="L737" title="All 4 branches missed.">		if(cmb == null || doc == null) {</span>
<span class="nc" id="L738">			return null;</span>
		}
		ArrayList paths;
		SortedSet taxons;
		TaxonPathBean taxonPath;
		TaxonBean taxon;
		String source, id, entry;
		Element classificationElem, taxonElem, pathElem, entryElem;
		Iterator pathIterator, taxonIterator;
<span class="nc" id="L747">		classificationElem = doc.createElement(nsPrefix + &quot;classification&quot;);</span>
<span class="nc" id="L748">		paths = cmb.getTaxonPaths();</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">		if(paths != null) {</span>
<span class="nc" id="L750">			pathIterator = paths.iterator();</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">			while(pathIterator.hasNext()) {</span>
<span class="nc" id="L752">				taxonPath = (TaxonPathBean)pathIterator.next();</span>
<span class="nc" id="L753">				source = taxonPath.getSource();</span>
<span class="nc" id="L754">				pathElem = doc.createElement(nsPrefix + &quot;taxonpath&quot;);</span>
<span class="nc" id="L755">				pathElem.appendChild(createTextElement(nsPrefix + &quot;source&quot;,</span>
					  source,
					  doc));
<span class="nc" id="L758">				taxons = taxonPath.getTaxons();</span>
<span class="nc bnc" id="L759" title="All 2 branches missed.">				if(taxons != null) {</span>
<span class="nc" id="L760">					taxonIterator = taxons.iterator();</span>
<span class="nc bnc" id="L761" title="All 2 branches missed.">					while(taxonIterator.hasNext()) {</span>
<span class="nc" id="L762">						taxon = (TaxonBean)taxonIterator.next();</span>
<span class="nc" id="L763">						id = taxon.getId();</span>
<span class="nc" id="L764">						entry = taxon.getEntry();</span>
<span class="nc" id="L765">						taxonElem = doc.createElement(nsPrefix + &quot;taxon&quot;);</span>
<span class="nc" id="L766">						taxonElem.appendChild(createTextElement(nsPrefix + &quot;id&quot;,</span>
							  id,
							  doc));
<span class="nc" id="L769">						entryElem = createElementWithLang(nsPrefix + &quot;entry&quot;,</span>
							  null,
							  entry,
							  nsPrefix,
							  doc);
<span class="nc" id="L774">						taxonElem.appendChild(entryElem);</span>
<span class="nc" id="L775">						pathElem.appendChild(taxonElem);</span>
					}
				}
<span class="nc" id="L778">				classificationElem.appendChild(pathElem);</span>
			}
		}
<span class="nc" id="L781">		ArrayList keywords = cmb.getKeywords();</span>
<span class="nc" id="L782">		appendKeywordList(classificationElem, keywords, nsPrefix, doc);</span>
<span class="nc" id="L783">		return classificationElem;</span>
	}

	/**
	 * Creates an Element of the form:
	 * &lt;elementName&gt;
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue&lt;/langstring&gt;
	 * &lt;/elementName&gt;
	 */
	private static Element createElementWithLang(String elementName,
												 String languageAttr,
												 String textvalue,
												 String nsPrefix,
												 Document doc) {
<span class="nc bnc" id="L797" title="All 2 branches missed.">		if(elementName == null) {</span>
<span class="nc" id="L798">			return null;</span>
		}
<span class="nc" id="L800">		Element retval = doc.createElement(elementName);</span>
<span class="nc bnc" id="L801" title="All 2 branches missed.">		if(textvalue != null) {</span>
<span class="nc" id="L802">			retval.appendChild(createLangstring(textvalue,</span>
				  languageAttr,
				  nsPrefix,
				  doc));
		}
<span class="nc" id="L807">		return retval;</span>
	}

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;elementName&gt;elementValue&lt;/elementName&gt;
	 * OR
	 * &lt;elementName /&gt;
	 */
	private static Element createTextElement(String elementName,
											 String elementValue,
											 Document doc) {
<span class="nc" id="L820">		Element retval = doc.createElement(elementName);</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">		if(elementValue != null) {</span>
<span class="nc" id="L822">			retval.appendChild(doc.createTextNode(elementValue));</span>
		}
<span class="nc" id="L824">		return retval;</span>
	}

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;elementName&gt;elementValue(1)&lt;/elementName&gt;
	 * &lt;elementName&gt;elementValue(2)&lt;/elementName&gt;
	 * &lt;elementName&gt;elementValue(3)&lt;/elementName&gt;
	 * ...
	 * &lt;elementName&gt;elementValue(n)&lt;/elementName&gt;
	 * OR
	 * &lt;elementName /&gt;
	 */
	private static void appendElementList(Element parentElem,
										  String elementName,
										  ArrayList elementValues,
										  Document doc) {
<span class="nc bnc" id="L842" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L843">			return;</span>
		}
<span class="nc bnc" id="L845" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L846">			parentElem.appendChild(doc.createElement(elementName));</span>
		} else {
<span class="nc" id="L848">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L849">			String value = null;</span>
<span class="nc bnc" id="L850" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L851">				value = (String)valueIterator.next();</span>
<span class="nc" id="L852">				parentElem.appendChild(createTextElement(elementName,</span>
					  value,
					  doc));
			}
		}
<span class="nc" id="L857">	}</span>

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;contextURL&gt;elementValue(1)&lt;/contextURL&gt;
	 * &lt;contextURL&gt;elementValue(2)&lt;/contextURL&gt;
	 * &lt;contextURL&gt;elementValue(3)&lt;/contextURL&gt;
	 * ...
	 * &lt;contextURL&gt;elementValue(n)&lt;/contextURL&gt;
	 * OR
	 * &lt;contextURL /&gt;
	 */
	private static void appendContextURLList(Element parentElem,
											 ArrayList elementValues,
											 Document doc) {
<span class="nc bnc" id="L873" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L874">			return;</span>
		}
<span class="nc bnc" id="L876" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L877">			parentElem.appendChild(doc.createElement(&quot;contextURL&quot;));</span>
		} else {
<span class="nc" id="L879">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L880">			ContextURLBean value = null;</span>
<span class="nc bnc" id="L881" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L882">				value = (ContextURLBean)valueIterator.next();</span>
<span class="nc" id="L883">				parentElem.appendChild(createTextElement(&quot;contextURL&quot;,</span>
<span class="nc" id="L884">					  value.getContextURL(),</span>
					  doc));
			}
		}
<span class="nc" id="L888">	}</span>

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;format&gt;elementValue(1)&lt;/format&gt;
	 * &lt;format&gt;elementValue(2)&lt;/format&gt;
	 * &lt;format&gt;elementValue(3)&lt;/format&gt;
	 * ...
	 * &lt;format&gt;elementValue(n)&lt;/format&gt;
	 * OR
	 * &lt;format /&gt;
	 */
	private static void appendFormatList(Element parentElem,
										 ArrayList elementValues,
										 String nsPrefix,
										 Document doc) {
<span class="nc bnc" id="L905" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L906">			return;</span>
		}
<span class="nc bnc" id="L908" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L909">			parentElem.appendChild(doc.createElement(nsPrefix + &quot;format&quot;));</span>
		} else {
<span class="nc" id="L911">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L912">			FormatBean value = null;</span>
<span class="nc bnc" id="L913" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L914">				value = (FormatBean)valueIterator.next();</span>
<span class="nc" id="L915">				parentElem.appendChild(createTextElement(nsPrefix + &quot;format&quot;,</span>
<span class="nc" id="L916">					  value.getFormat(),</span>
					  doc));
			}
		}
<span class="nc" id="L920">	}</span>

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;keyword&gt;elementValue(1)&lt;/keyword&gt;
	 * &lt;keyword&gt;elementValue(2)&lt;/keyword&gt;
	 * &lt;keyword&gt;elementValue(3)&lt;/keyword&gt;
	 * ...
	 * &lt;keyword&gt;elementValue(n)&lt;/keyword&gt;
	 * OR
	 * &lt;keyword /&gt;
	 */
	private static void appendKeywordList(Element parentElem,
										  ArrayList elementValues,
										  String nsPrefix,
										  Document doc) {
<span class="nc bnc" id="L937" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L938">			return;</span>
		}
<span class="nc bnc" id="L940" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L941">			parentElem.appendChild(doc.createElement(nsPrefix + &quot;keyword&quot;));</span>
		} else {
<span class="nc" id="L943">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L944">			KeywordBean value = null;</span>
<span class="nc bnc" id="L945" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L946">				value = (KeywordBean)valueIterator.next();</span>
<span class="nc" id="L947">				parentElem.appendChild(createTextElement(nsPrefix + &quot;keyword&quot;,</span>
<span class="nc" id="L948">					  value.getKeyword(),</span>
					  doc));
			}
		}
<span class="nc" id="L952">	}</span>

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;requirements&gt;elementValue(1)&lt;/requirements&gt;
	 * &lt;requirements&gt;elementValue(2)&lt;/requirements&gt;
	 * &lt;requirements&gt;elementValue(3)&lt;/requirements&gt;
	 * ...
	 * &lt;requirements&gt;elementValue(n)&lt;/requirements&gt;
	 * OR
	 * &lt;requirements /&gt;
	 */
	private static void appendRequirementsList(Element parentElem,
											   ArrayList elementValues,
											   String nsPrefix,
											   Document doc) {
<span class="nc bnc" id="L969" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L970">			return;</span>
		}
<span class="nc bnc" id="L972" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L973">			parentElem.appendChild(doc.createElement(nsPrefix + &quot;requirements&quot;));</span>
		} else {
<span class="nc" id="L975">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L976">			RequirementBean value = null;</span>
			Element requirementElem, typeElem, nameElem;
<span class="nc bnc" id="L978" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L979">				value = (RequirementBean)valueIterator.next();</span>
<span class="nc" id="L980">				requirementElem = doc.createElement(nsPrefix + &quot;requirements&quot;);</span>
<span class="nc" id="L981">				typeElem = createElementWithLang(nsPrefix + &quot;type&quot;,</span>
					  null,
<span class="nc" id="L983">					  value.getRequirementType(),</span>
					  nsPrefix,
					  doc);
<span class="nc" id="L986">				requirementElem.appendChild(typeElem);</span>
<span class="nc" id="L987">				nameElem = createElementWithLang(nsPrefix + &quot;name&quot;,</span>
					  null,
<span class="nc" id="L989">					  value.getRequirementName(),</span>
					  nsPrefix,
					  doc);
<span class="nc" id="L992">				requirementElem.appendChild(nameElem);</span>
<span class="nc" id="L993">				parentElem.appendChild(requirementElem);</span>
			}
		}
<span class="nc" id="L996">	}</span>

	/**
	 * Creates an element with the given name and text value.  If the value
	 * is null, then an empty element will be created:
	 * &lt;diseasediagnosis&gt;elementValue(1)&lt;/diseasediagnosis&gt;
	 * &lt;diseasediagnosis&gt;elementValue(2)&lt;/diseasediagnosis&gt;
	 * &lt;diseasediagnosis&gt;elementValue(3)&lt;/diseasediagnosis&gt;
	 * ...
	 * &lt;diseasediagnosis&gt;elementValue(n)&lt;/diseasediagnosis&gt;
	 * OR
	 * &lt;diseasediagnosis /&gt;
	 */
	private static void appendDiseaseDiagnosesList(Element parentElem,
												   ArrayList elementValues,
												   Document doc) {
<span class="nc bnc" id="L1012" title="All 2 branches missed.">		if(parentElem == null) {</span>
<span class="nc" id="L1013">			return;</span>
		}
<span class="nc bnc" id="L1015" title="All 2 branches missed.">		if(elementValues == null) {</span>
<span class="nc" id="L1016">			parentElem.appendChild(doc.createElement(&quot;diseasediagnosis&quot;));</span>
		} else {
<span class="nc" id="L1018">			Iterator valueIterator = elementValues.iterator();</span>
<span class="nc" id="L1019">			DiseaseDiagnosisBean value = null;</span>
<span class="nc bnc" id="L1020" title="All 2 branches missed.">			while(valueIterator.hasNext()) {</span>
<span class="nc" id="L1021">				value = (DiseaseDiagnosisBean)valueIterator.next();</span>
<span class="nc" id="L1022">				parentElem.appendChild(createTextElement(&quot;diseasediagnosis&quot;,</span>
<span class="nc" id="L1023">					  value.getDiseaseDiagnosis(),</span>
					  doc));
			}
		}
<span class="nc" id="L1027">	}</span>

	/**
	 * Creates an element with the given name and boolean value.
	 * Example:
	 * &lt;elementName&gt;true&lt;/elementName&gt;
	 * OR
	 * &lt;elementName&gt;false&lt;/elementName&gt;
	 */
	private static Element createBooleanElement(String elementName,
												boolean elementValue,
												Document doc) {
<span class="nc" id="L1039">		Element retval = doc.createElement(elementName);</span>
<span class="nc bnc" id="L1040" title="All 2 branches missed.">		if(elementValue) {</span>
<span class="nc" id="L1041">			retval.appendChild(doc.createTextNode(&quot;true&quot;));</span>
		} else {
<span class="nc" id="L1043">			retval.appendChild(doc.createTextNode(&quot;false&quot;));</span>
		}
<span class="nc" id="L1045">		return retval;</span>
	}

	/**
	 * Creates an Element of the form:
	 * &lt;elementName&gt;
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue(1)&lt;/langstring&gt;
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue(2)&lt;/langstring&gt;
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue(3)&lt;/langstring&gt;
	 * ...
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue(n)&lt;/langstring&gt;
	 * &lt;/elementName&gt;
	 */
	private static Element createElementWithLangList(String elementName,
													 String languageAttr,
													 ArrayList textvalues,
													 String nsPrefix,
													 Document doc) {
<span class="nc bnc" id="L1063" title="All 2 branches missed.">		if(elementName == null) {</span>
<span class="nc" id="L1064">			return null;</span>
		}
<span class="nc" id="L1066">		Element retval = doc.createElement(elementName);</span>
<span class="nc bnc" id="L1067" title="All 2 branches missed.">		if(textvalues == null) {</span>
<span class="nc" id="L1068">			return retval;</span>
		}
<span class="nc" id="L1070">		Iterator valuesIterator = textvalues.iterator();</span>
		String value;
<span class="nc bnc" id="L1072" title="All 2 branches missed.">		while(valuesIterator.hasNext()) {</span>
<span class="nc" id="L1073">			value = (String)valuesIterator.next();</span>
<span class="nc" id="L1074">			retval.appendChild(createLangstring(value,</span>
				  languageAttr,
				  nsPrefix,
				  doc));
		}
<span class="nc" id="L1079">		return retval;</span>
	}

	/**
	 * Creates an Element of the form:
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue&lt;/langstring&gt;
	 */
	private static Element createLangstring(String textvalue,
											String languageAttr,
											String nsPrefix,
											Document doc) {
<span class="nc" id="L1090">		Element returnValue = doc.createElement(nsPrefix + &quot;langstring&quot;);</span>
<span class="nc bnc" id="L1091" title="All 2 branches missed.">		if(languageAttr != null) {</span>
<span class="nc" id="L1092">			returnValue.setAttribute(&quot;xml:lang&quot;, languageAttr);</span>
		}
<span class="nc bnc" id="L1094" title="All 2 branches missed.">		if(textvalue != null) {</span>
<span class="nc" id="L1095">			returnValue.appendChild(doc.createTextNode(textvalue));</span>
		}
<span class="nc" id="L1097">		return returnValue;</span>
	}

	public static String getPointerListXML(ArrayList ids)
		  throws IOException {
<span class="nc bnc" id="L1102" title="All 2 branches missed.">		if(ids == null) {</span>
<span class="nc" id="L1103">			return null;</span>
		}
<span class="nc" id="L1105">		ByteArrayOutputStream out = new ByteArrayOutputStream();</span>
		try {
			//create a new Document using JAXP
<span class="nc" id="L1108">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L1109">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L1110">			Document doc = db.newDocument();</span>
<span class="nc" id="L1111">			Element listElem = doc.createElement(&quot;metadatalist&quot;);</span>
<span class="nc" id="L1112">			Element catalogueElem = doc.createElement(&quot;catalogue&quot;);</span>
<span class="nc" id="L1113">			catalogueElem.appendChild(doc.createTextNode(&quot;HEAL.org&quot;));</span>
<span class="nc" id="L1114">			listElem.appendChild(catalogueElem);</span>

<span class="nc" id="L1116">			Iterator idIter = ids.iterator();</span>
			Element entryElem;
			Element langstringElem;
<span class="nc bnc" id="L1119" title="All 2 branches missed.">			while(idIter.hasNext()) {</span>
<span class="nc" id="L1120">				String id = (String)idIter.next();</span>
<span class="nc" id="L1121">				entryElem = doc.createElement(&quot;entry&quot;);</span>
<span class="nc" id="L1122">				langstringElem = doc.createElement(&quot;langstring&quot;);</span>
<span class="nc" id="L1123">				langstringElem.appendChild(doc.createTextNode(id));</span>
<span class="nc" id="L1124">				entryElem.appendChild(langstringElem);</span>
<span class="nc" id="L1125">				listElem.appendChild(entryElem);</span>
<span class="nc" id="L1126">			}</span>

<span class="nc" id="L1128">			doc.appendChild(listElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L1131">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L1132">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L1133">			transformer.transform(new DOMSource(doc), new StreamResult(out));</span>
<span class="nc" id="L1134">		} catch(Exception ex) {</span>
<span class="nc" id="L1135">			throw new IOException(ex.toString());</span>
<span class="nc" id="L1136">		}</span>
<span class="nc" id="L1137">		return out.toString();</span>
	}

	/**
	 * Creates the manifest element for the given metadata, including the
	 * metadata element (hard coded settings),
	 * organizations element (currently empty), and the dynamically
	 * generated resources element.
	 * No attributes are set on the element, but it is assumed that the
	 * namespace for the IMS metadata tags is &quot;imsmd&quot; (specified in
	 * org.heal.module.metadata.HealMetadataXMLConverter.IMSNAMESPACETAG).
	 * This is consistent with all of the manifest examples provided by IMS.
	 */
	private static Element createManifestElement(CompleteMetadataBean[] metaInfo,
												 FileLocator fileLocator,
												 Document doc) {
		Element metametadataElem, organizationsElem, resourcesElem;
		Element manifestElem;

		//manifestElem = doc.createElement(&quot;manifest&quot;);
<span class="nc" id="L1157">		manifestElem = doc.createElement(&quot;imscp:manifest&quot;);</span>

<span class="nc" id="L1159">		metametadataElem = createManifestMetadataElem(doc);</span>
<span class="nc" id="L1160">		manifestElem.appendChild(metametadataElem);</span>

		/* since this is a dynamically generated manifest for
		 * a package constituted of potentially many disparate pieces of
		 * content, we can't really provide any insight as to the
		 * organization of the content, so we leave the organizations
		 * element empty
		 */
<span class="nc" id="L1168">		organizationsElem = doc.createElement(&quot;organizations&quot;);</span>
<span class="nc" id="L1169">		manifestElem.appendChild(organizationsElem);</span>

<span class="nc" id="L1171">		resourcesElem = createManifestResourcesElem(metaInfo,</span>
			  fileLocator,
			  doc);
<span class="nc" id="L1174">		manifestElem.appendChild(resourcesElem);</span>

<span class="nc" id="L1176">		return manifestElem;</span>
	}

	/**
	 * Creates a parent resources element containing multiple resource
	 * elements (one for each metadata).  The resource elements contain
	 * the content's metadata and the path to the file within the package.
	 * No dependency information is generated because this information is not
	 * encoded in the database.
	 */
	private static Element createManifestResourcesElem(CompleteMetadataBean[] metaInfo,
													   FileLocator fileLocator,
													   Document doc) {
<span class="nc" id="L1189">		Element resourcesElem = doc.createElement(&quot;resources&quot;);</span>
		Element resourceElem;
<span class="nc bnc" id="L1191" title="All 2 branches missed.">		for(int i = 0; i &lt; metaInfo.length; i++) {</span>
<span class="nc" id="L1192">			resourceElem = createManifestResourceElem(&quot;RESOURCE&quot; + i, metaInfo[i],</span>
				  fileLocator,
				  doc);
<span class="nc" id="L1195">			resourcesElem.appendChild(resourceElem);</span>
		}
<span class="nc" id="L1197">		return resourcesElem;</span>
	}

	/**
	 * Given an identifier, metadata bean and dom document, creates a resource
	 * element for inclusion in the manifest.  The identifier is used to
	 * give a name to this element.  Usually this will just be something
	 * along the lines of &quot;RESOURCEi&quot; where i is a unique number in this
	 * manifest.
	 * The created element has a name of &quot;resource&quot; with an identifier
	 * of, well, &quot;identifier&quot;.  The included elements are a file entry
	 * to specify the location of the file in the package and the
	 * content's metadata.  No dependency information is supplied.
	 * Also the resource tag contains a &quot;type&quot; attribute that is hardcoded
	 * to be &quot;webcontent&quot; since a) that is all we serve, and b) the IMS v1.1
	 * content packaging specification only defines that setting.
	 */
	private static Element createManifestResourceElem(String identifier,
													  CompleteMetadataBean metadata,
													  FileLocator fileLocator,
													  Document doc) {

		Element resourceElem, metadataElem, fileElem;
<span class="nc" id="L1220">		resourceElem = doc.createElement(&quot;resource&quot;);</span>
<span class="nc" id="L1221">		resourceElem.setAttribute(&quot;identifier&quot;, identifier);</span>
<span class="nc" id="L1222">		resourceElem.setAttribute(&quot;type&quot;, &quot;webcontent&quot;);</span>
<span class="nc" id="L1223">		String nsprefix = HealMetadataXMLConverter.IMSNAMESPACETAG;</span>
<span class="nc" id="L1224">		metadataElem = HealMetadataXMLConverter.metadataToElement(metadata,</span>
			  fileLocator,
			  nsprefix,
			  doc);
<span class="nc" id="L1228">		MetadataBean meta = metadata.getMetadata();</span>
<span class="nc" id="L1229">		String localpath = fileLocator.getContentURL(meta.getLocation());</span>
<span class="nc" id="L1230">		fileElem = doc.createElement(&quot;file&quot;);</span>
<span class="nc" id="L1231">		fileElem.setAttribute(&quot;href&quot;, localpath);</span>
<span class="nc" id="L1232">		resourceElem.appendChild(metadataElem);</span>

<span class="nc" id="L1234">		return resourceElem;</span>
	}

	/**
	 * Creates an element of the form:
	 * &lt;metadata&gt;
	 * &lt;schema&gt;IMS Content&lt;/schema&gt;
	 * &lt;schemaversion&gt;1.1&lt;/schemaversion&gt;
	 * &lt;imsmd:record&gt;
	 * &lt;imsmd:general&gt;
	 * &lt;imsmd:title&gt;
	 * &lt;imsmd:langstring xml:lang=&quot;en-US&quot;&gt;Dynamically Generated HEAL IMS Content Package&lt;/imsmd:langstring&gt;
	 * &lt;/imsmd:title&gt;
	 * &lt;/imsmd:general&gt;
	 * &lt;/imsmd:record&gt;
	 * &lt;/metadata&gt;
	 */
	private static Element createManifestMetadataElem(Document doc) {
		Element schemaElem, schemaversionElem, recordElem;
		Element generalElem, titleElem;
		//Element metadataElem = doc.createElement(&quot;metadata&quot;);
<span class="nc" id="L1255">		Element metadataElem = doc.createElement(&quot;imscp:metadata&quot;);</span>
		//schemaElem = doc.createElement(&quot;schema&quot;);
<span class="nc" id="L1257">		schemaElem = doc.createElement(&quot;imscp:schema&quot;);</span>
<span class="nc" id="L1258">		schemaElem.appendChild(doc.createTextNode(&quot;IMS Content&quot;));</span>
		//schemaversionElem = doc.createElement(&quot;schemaversion&quot;);
<span class="nc" id="L1260">		schemaversionElem = doc.createElement(&quot;imscp:schemaversion&quot;);</span>

<span class="nc" id="L1262">		schemaversionElem.appendChild(doc.createTextNode(&quot;1.1&quot;));</span>
		//recordElem = doc.createElement(HealMetadataXMLConverter.IMSNAMESPACETAG+&quot;:record&quot;);
		//generalElem = doc.createElement(HealMetadataXMLConverter.IMSNAMESPACETAG+&quot;:general&quot;);
		//titleElem = createManifestElementWithLang(HealMetadataXMLConverter.IMSNAMESPACETAG+&quot;:title&quot;,
		//					  &quot;en-US&quot;,
		//					  &quot;Dynamically Generated HEAL IMS Content Package&quot;,
		//					  doc);

<span class="nc" id="L1270">		recordElem = doc.createElement(&quot;record&quot;);</span>
<span class="nc" id="L1271">		generalElem = doc.createElement(&quot;general&quot;);</span>
<span class="nc" id="L1272">		titleElem = createManifestElementWithLang(&quot;title&quot;,</span>
			  &quot;en-US&quot;,
			  &quot;Dynamically Generated HEAL IMS Content Package&quot;,
			  doc);

<span class="nc" id="L1277">		generalElem.appendChild(titleElem);</span>
<span class="nc" id="L1278">		recordElem.appendChild(generalElem);</span>
<span class="nc" id="L1279">		metadataElem.appendChild(schemaElem);</span>
<span class="nc" id="L1280">		metadataElem.appendChild(schemaversionElem);</span>
<span class="nc" id="L1281">		metadataElem.appendChild(recordElem);</span>
<span class="nc" id="L1282">		return metadataElem;</span>
	}

	/**
	 * Creates an Element of the form:
	 * &lt;elementName&gt;
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue&lt;/langstring&gt;
	 * &lt;/elementName&gt;
	 */
	private static Element createManifestElementWithLang(String elementName,
														 String languageAttr,
														 String textvalue,
														 Document doc) {
<span class="nc" id="L1295">		Element retval = doc.createElement(elementName);</span>
<span class="nc" id="L1296">		retval.appendChild(createManifestLangstring(textvalue,</span>
			  languageAttr,
			  doc));
<span class="nc" id="L1299">		return retval;</span>
	}

	/**
	 * Creates an Element of the form:
	 * &lt;langstring xml:lang=&quot;languageAttr&quot;&gt;textvalue&lt;/langstring&gt;
	 */
	private static Element createManifestLangstring(String textvalue,
													String languageAttr,
													Document doc) {
		//Element returnValue = doc.createElement(HealMetadataXMLConverter.IMSNAMESPACETAG+&quot;:langstring&quot;);
<span class="nc" id="L1310">		Element returnValue = doc.createElement(&quot;langstring&quot;);</span>

<span class="nc bnc" id="L1312" title="All 2 branches missed.">		if(languageAttr != null) {</span>
<span class="nc" id="L1313">			returnValue.setAttribute(&quot;xml:lang&quot;, languageAttr);</span>
		}
<span class="nc" id="L1315">		returnValue.appendChild(doc.createTextNode(textvalue));</span>
<span class="nc" id="L1316">		return returnValue;</span>
	}


	/**
	 * Given an array of metadata beans, creates a manifest file for an IMS
	 * package containing the given metadata and content.  The XML manifest
	 * is then written to the provided output stream.
	 */
	public static void getManifestIMSXML(CompleteMetadataBean[] metaInfo,
										 FileLocator fileLocator,
										 OutputStream out)
		  throws IOException {
		try {
			//create a new Document using JAXP
<span class="nc" id="L1331">			DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
<span class="nc" id="L1332">			DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L1333">			Document doc = db.newDocument();</span>

<span class="nc" id="L1335">			Element manifestElem = createManifestElement(metaInfo,</span>
				  fileLocator,
				  doc);

<span class="nc" id="L1339">			manifestElem.setAttribute(&quot;identifier&quot;, &quot;MANIFEST1&quot;);</span>
<span class="nc" id="L1340">			manifestElem.setAttribute(&quot;xmlns:imscp&quot;, &quot;http://www.imsproject.org/xsd/ims_cp_rootv1p1&quot;);</span>
			//manifestElem.setAttribute(&quot;xmlns:&quot;+HealMetadataXMLConverter.IMSNAMESPACETAG,
			//	      &quot;http://www.imsproject.org/xsd/ims_md_rootv1p1&quot;);

<span class="nc" id="L1344">			manifestElem.setAttribute(&quot;xmlns&quot;,</span>
				  &quot;http://www.healcentral.org/xsd/healmd_v1p5&quot;);

<span class="nc" id="L1347">			manifestElem.setAttribute(&quot;xmlns:xsi&quot;, &quot;http://www.w3.org/2000/10/XMLSchema-instance&quot;);</span>
			//manifestElem.setAttribute(&quot;xsi:schemaLocation&quot;,&quot;http://www.imsproject.org/xsd/ims_cp_rootv1p1 http://www.imsproject.org/xsd/ims_cp_rootv1p1.xsd http://www.imsproject.org/xsd/ims_md_rootv1p1 http://www.imsproject.org/xsd/ims_md_rootv1p1.xsd&quot;);
<span class="nc" id="L1349">			manifestElem.setAttribute(&quot;xsi:schemaLocation&quot;, &quot;http://www.imsproject.org/xsd/ims_cp_rootv1p1 http://www.imsproject.org/xsd/ims_cp_rootv1p1.xsd http://www.healcentral.org/services/schema/HEALmdSchemaXMLv1p5 http://www.healcentral.org/services/schema/HEALmdSchemaXMLv1p5.xsd&quot;);</span>


<span class="nc" id="L1352">			doc.appendChild(manifestElem);</span>

			//now that we have the document built, we should write it out.
<span class="nc" id="L1355">			TransformerFactory tFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L1356">			Transformer transformer = tFactory.newTransformer();</span>
<span class="nc" id="L1357">			transformer.transform(new DOMSource(doc), new StreamResult(out));</span>
<span class="nc" id="L1358">		} catch(Exception ex) {</span>
<span class="nc" id="L1359">			ex.printStackTrace();</span>
<span class="nc" id="L1360">			throw new IOException(ex.toString());</span>
<span class="nc" id="L1361">		}</span>
<span class="nc" id="L1362">	}</span>

	/**
	 * if bool is true, &quot;yes&quot; is returned - otherwise &quot;no&quot; is returned
	 */
	private static String booleanToYesNo(boolean bool) {
<span class="nc bnc" id="L1368" title="All 2 branches missed.">		return (bool ? &quot;yes&quot; : &quot;no&quot;);</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>