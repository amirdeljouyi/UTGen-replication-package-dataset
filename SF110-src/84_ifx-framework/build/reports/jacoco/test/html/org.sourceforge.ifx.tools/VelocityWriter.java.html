<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VelocityWriter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">84_ifx-framework</a> &gt; <a href="index.source.html" class="el_package">org.sourceforge.ifx.tools</a> &gt; <span class="el_source">VelocityWriter.java</span></div><h1>VelocityWriter.java</h1><pre class="source lang-java linenums">/*
 * $Id: VelocityWriter.java,v 1.1 2004/05/03 21:41:31 spal Exp $
 * $Source: /cvsroot/ifx-framework/code/src/org/sourceforge/ifx/tools/VelocityWriter.java,v $
 * IFX-Framework - IFX XML to JavaBean application framework.
 * Copyright (C) 2003  The IFX-Framework Team
 * 
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * 
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 * 
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 */
package org.sourceforge.ifx.tools;

import org.apache.velocity.app.Velocity;
import org.apache.velocity.VelocityContext;
import org.apache.velocity.Template;
import org.apache.velocity.exception.ParseErrorException;
import org.apache.velocity.exception.ResourceNotFoundException;

import java.io.File;
import java.io.FileOutputStream;
import java.io.PrintWriter;

/**
 * Uses Velocity templates in the conf/ subdirectory to build Java source
 * files from populated beans. Used by the CodeGenerator tool and the
 * LegacyAdapterGenerator tools.
 * @author Sujit Pal (spal@users.sourceforge.net)
 * @version $Revision: 1.1 $
 */
public class VelocityWriter {

    /** Offset from the project basedir to the template directory */
    private final static String DEFAULT_TEMPLATEDIR = &quot;conf&quot;;
    /** Offset from the project basedir to the src-gen directory */
    private final static String DEFAULT_BASEDIR = &quot;src-gen&quot;;
    /** Default suffix for generated file */
    private final static String DEFAULT_SUFFIX = &quot;java&quot;;

<span class="nc" id="L49">    private String templateDir = DEFAULT_TEMPLATEDIR;</span>
<span class="nc" id="L50">    private String baseDir = DEFAULT_BASEDIR;</span>
<span class="nc" id="L51">    private String suffix = DEFAULT_SUFFIX;</span>

    /**
     * Builds a default VelocityWriter object. Override the defaults with
     * appropriate setXXX() calls.
     */
<span class="nc" id="L57">    public VelocityWriter() {;}</span>

    /**
     * Returns the template directory for this object.
     * @return the template directory.
     */
    public String getTemplateDir() {
<span class="nc" id="L64">        return templateDir;</span>
    }

    /**
     * Set the template directory for this object.
     * @param templateDir the template directory to set.
     */
    public void setTemplateDir(String templateDir) {
<span class="nc" id="L72">        this.templateDir = templateDir;</span>
<span class="nc" id="L73">    }</span>

    /**
     * Return the base directory for this object.
     * @return the base directory.
     */
    public String getBaseDir() {
<span class="nc" id="L80">        return baseDir;</span>
    }

    /**
     * Set the base directory for this object.
     * @param basedir the base directory to set.
     */
    public void setBaseDir(String basedir) {
<span class="nc" id="L88">        this.baseDir = baseDir;</span>
<span class="nc" id="L89">    }</span>

    /**
     * Return the suffix for the generated file.
     * @return the generated file suffix.
     */
    public String getSuffix() {
<span class="nc" id="L96">        return suffix;</span>
    }

    /**
     * Set the suffix for the generated file.
     * @param suffix the generated file suffix to set.
     */
    public void setSuffix(String suffix) {
<span class="nc" id="L104">        this.suffix = suffix;</span>
<span class="nc" id="L105">    }</span>

    /**
     * Instantiates a Velocity engine to write the bean to a file.
     * @param generatedBeanFqcn the fully qualified class name of the bean
     * to be generated.
     * @param templateBean the bean containing values to be fed to the template.
     * @exception Exception if any was thrown.
     */
    public void write(String generatedBeanFqcn, Object templateBean) 
            throws Exception {
<span class="nc" id="L116">        Velocity.init();</span>
<span class="nc" id="L117">        VelocityContext context = new VelocityContext();</span>
<span class="nc" id="L118">        context.put(getUnqualifiedClassName(templateBean), templateBean);</span>
<span class="nc" id="L119">        Template codeTemplate = </span>
<span class="nc" id="L120">            Velocity.getTemplate(getTemplateFileName(templateBean));</span>
<span class="nc" id="L121">        PrintWriter writer = getWriter(generatedBeanFqcn);</span>
<span class="nc" id="L122">        codeTemplate.merge(context, writer);</span>
<span class="nc" id="L123">        writer.flush();</span>
<span class="nc" id="L124">        writer.close();</span>
<span class="nc" id="L125">    }</span>

    /**
     * Returns the template file name. By convention, we name the template
     * file as an all underscore version of the object. For example, the
     * template file for JavaSource.java will be javasource.vm. Templates
     * are stored in the conf/ subdirectory.
     * @param bean the bean object that drives the template.
     * @return the template file name corresponding to the bean.
     * @exception Exception if any are thrown from the method.
     */
    private String getTemplateFileName(Object bean) throws Exception {
<span class="nc" id="L137">        String uqcn = getUnqualifiedClassName(bean);</span>
<span class="nc" id="L138">        String templateFile = getTemplateDir() + &quot;/&quot; + </span>
<span class="nc" id="L139">            uqcn.toLowerCase() + &quot;.vm&quot;;</span>
<span class="nc" id="L140">        return templateFile;</span>
    }

    /**
     * Computes the file name for the generated bean. It also makes parent
     * directories if needed and returns a reference to a PrintWriter.
     * @param fqcn the fully qualified class name for the generated bean.
     * @return a PrintWriter pointing to the new file created.
     * @exception Exception if any are thrown from the method.
     */
    private PrintWriter getWriter(String fqcn) throws Exception {
<span class="nc" id="L151">        File f = new File(getBaseDir() + File.separator + </span>
<span class="nc" id="L152">            fqcn.replace('.', File.separatorChar) + &quot;.&quot; + getSuffix());</span>
<span class="nc" id="L153">        f.getParentFile().mkdirs();</span>
<span class="nc" id="L154">        PrintWriter writer = new PrintWriter(new FileOutputStream(f), true);</span>
<span class="nc" id="L155">        return writer;</span>
    }

    /**
     * Returns the unqualified class name for the bean. The unqualified name
     * has the package name stripped out.
     * @param bean the bean object that drives the template.
     * @return the unqualified (no package portion) name of the bean class.
     * @exception Exception if any are thrown from the method.
     */
    private String getUnqualifiedClassName(Object bean) throws Exception {
<span class="nc" id="L166">        String uqcn = bean.getClass().getName().substring(</span>
<span class="nc" id="L167">            bean.getClass().getName().lastIndexOf(&quot;.&quot;) + 1);</span>
<span class="nc" id="L168">        return uqcn;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>