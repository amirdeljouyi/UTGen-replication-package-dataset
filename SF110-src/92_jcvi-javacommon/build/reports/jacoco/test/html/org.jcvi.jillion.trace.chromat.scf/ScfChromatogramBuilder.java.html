<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ScfChromatogramBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">92_jcvi-javacommon</a> &gt; <a href="index.source.html" class="el_package">org.jcvi.jillion.trace.chromat.scf</a> &gt; <span class="el_source">ScfChromatogramBuilder.java</span></div><h1>ScfChromatogramBuilder.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2013 J. Craig Venter Institute.
 * 	This file is part of Jillion
 * 
 * 	 Jillion is free software: you can redistribute it and/or modify
 * 	it under the terms of the GNU General Public License as published by
 * 	the Free Software Foundation, either version 3 of the License, or
 * 	(at your option) any later version.
 * 	
 * 	 Jillion is distributed in the hope that it will be useful,
 * 	but WITHOUT ANY WARRANTY; without even the implied warranty of
 * 	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * 	GNU General Public License for more details.
 * 	
 * 	You should have received a copy of the GNU General Public License
 * 	along with  Jillion.  If not, see http://www.gnu.org/licenses
 * 
 * Contributors:
 *     Danny Katzel - initial API and implementation
 ******************************************************************************/
/*
 * Created on Oct 2, 2008
 *
 * @author dkatzel
 */
package org.jcvi.jillion.trace.chromat.scf;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.Arrays;
import java.util.Map;

import org.jcvi.jillion.core.pos.PositionSequence;
import org.jcvi.jillion.core.pos.PositionSequenceBuilder;
import org.jcvi.jillion.core.qual.QualitySequence;
import org.jcvi.jillion.core.qual.QualitySequenceBuilder;
import org.jcvi.jillion.core.residue.nt.NucleotideSequence;
import org.jcvi.jillion.core.util.Builder;
import org.jcvi.jillion.internal.trace.chromat.BasicChromatogramBuilder;
import org.jcvi.jillion.internal.trace.chromat.scf.PrivateDataImpl;
import org.jcvi.jillion.internal.trace.chromat.scf.SCFChromatogramImpl;
import org.jcvi.jillion.trace.chromat.Chromatogram;

/**
 * {@code SCFChromatogramBuilder} uses the Builder pattern
 * to create a new {@link ScfChromatogram} instance.
 * @author dkatzel
 *
 *
 */
public final class ScfChromatogramBuilder implements Builder&lt;ScfChromatogram&gt;{

    
    private QualitySequence substitutionConfidence;
    private QualitySequence insertionConfidence;
    private QualitySequence deletionConfidence;

    private byte[] privateData;
   
    private final BasicChromatogramBuilder basicBuilder;
    /**
     * Create a new ScfChromatogramBuilder instance with
     * all fields except for the id unset.  In order
     * to successfully build a valid {@link ScfChromatogram}
     * object please use
     * the various setter methods
     * in this class to set everything
     * before calling {@link #build()}.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null.
     * @throws NullPointerException if either field is null.
     */
<span class="nc" id="L74">    public ScfChromatogramBuilder(String id){</span>
<span class="nc" id="L75">        basicBuilder = new BasicChromatogramBuilder(id);</span>
<span class="nc" id="L76">    }</span>
    /**
     * Create a new ScfChromatogramBuilder instance
     * with the given id and all fields initially set
     * to the the values encoded in the given scf file.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param scfFile a SCF encoded file that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or if
     * the given file is not a valid scf encoded file.
     * @throws NullPointerException if either field is null.
     */
    public ScfChromatogramBuilder(String id, File scfFile) throws IOException{
<span class="nc" id="L90">		this(id);</span>
<span class="nc" id="L91">		SCFChromatogramFileBuilderVisitor visitor = new SCFChromatogramFileBuilderVisitor(this);</span>
<span class="nc" id="L92">	    ScfChromatogramFileParser.parse(scfFile, visitor);       </span>
<span class="nc" id="L93">    }</span>
    /**
     * Create a new ScfChromatogramBuilder instance
     * with the given id and all fields initially set
     * to the the values encoded in the given scf encoded inputStream.
     * The {@link InputStream} will NOT be closed by this constructor,
     * client code must close the stream themselves after returning 
     * from this method (preferably in a finally block).
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param scfInputStream a SCF encoded {@link InputStream} that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or
     * if the {@link InputStream} does not contain valid scf encoded data.
     * @throws NullPointerException if either field is null.
     */
    public ScfChromatogramBuilder(String id, InputStream scfInputStream) throws IOException{
<span class="nc" id="L110">		this(id);</span>
<span class="nc" id="L111">		SCFChromatogramFileBuilderVisitor visitor = new SCFChromatogramFileBuilderVisitor(this);</span>
<span class="nc" id="L112">	    ScfChromatogramFileParser.parse(scfInputStream, visitor);       </span>
<span class="nc" id="L113">    }</span>
    /**
     * Create a new instance of ScfChromatogramBuilder
     * using the given {@link Chromatogram} instance 
     * to set all the initial fields. Only the fields 
     * in the {@link Chromatogram} interface will be copied,
     * any scf specific fields will be null.  Use the various
     * scf specific setter methods to set those values.
     * @param copy a {@link Chromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
<span class="nc" id="L126">    public ScfChromatogramBuilder(Chromatogram copy){</span>
<span class="nc" id="L127">       basicBuilder = new BasicChromatogramBuilder(copy);        </span>
<span class="nc" id="L128">    }</span>
    /**
     * Create a new instance of ScfChromatogramBuilder
     * using the given {@link ScfChromatogram} instance 
     * to set all the initial fields. All the fields 
     * in the {@link ScfChromatogram} interface including
     * scf specific fields will be copied.
     * @param copy a {@link ScfChromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
    public ScfChromatogramBuilder(ScfChromatogram copy){
<span class="nc" id="L141">        this((Chromatogram)copy);</span>
<span class="nc" id="L142">        this.substitutionConfidence =copy.getSubstitutionConfidence();</span>
<span class="nc" id="L143">        this.deletionConfidence =copy.getDeletionConfidence();</span>
<span class="nc" id="L144">        this.insertionConfidence =copy.getInsertionConfidence();</span>
<span class="nc" id="L145">        privateData(copy.getPrivateData().getBytes());</span>
<span class="nc" id="L146">     }</span>
    /**
     * @return the substitutionConfidence
     */
    public QualitySequence substitutionConfidence() {
<span class="nc" id="L151">        return substitutionConfidence;</span>
    }

    /**
     * @param substitutionConfidence the substitutionConfidence to set
     */
    public ScfChromatogramBuilder substitutionConfidence(byte[] substitutionConfidence) {
<span class="nc bnc" id="L158" title="All 2 branches missed.">        this.substitutionConfidence = substitutionConfidence ==null</span>
        		? null
<span class="nc" id="L160">        		: new QualitySequenceBuilder(substitutionConfidence).build();</span>
<span class="nc" id="L161">        return this;</span>
    }

    /**
     * @return the insertionConfidence
     */
    public QualitySequence insertionConfidence() {
<span class="nc" id="L168">        return insertionConfidence;</span>
    }

    /**
     * @param insertionConfidence the insertionConfidence to set
     */
    public ScfChromatogramBuilder insertionConfidence(byte[] insertionConfidence) {
<span class="nc bnc" id="L175" title="All 2 branches missed.">        this.insertionConfidence = insertionConfidence ==null</span>
        		? null
<span class="nc" id="L177">        	:  	new QualitySequenceBuilder(insertionConfidence).build();</span>
<span class="nc" id="L178">        return this;</span>
    }

    /**
     * @return the deletionConfidence
     */
    public QualitySequence deletionConfidence() {
<span class="nc" id="L185">        return deletionConfidence;</span>
    }

    /**
     * @param deletionConfidence the deletionConfidence to set
     */
    public ScfChromatogramBuilder deletionConfidence(byte[] deletionConfidence) {
<span class="nc bnc" id="L192" title="All 2 branches missed.">        this.deletionConfidence = deletionConfidence ==null?null:</span>
<span class="nc" id="L193">        	new QualitySequenceBuilder(deletionConfidence).build();</span>
        
<span class="nc" id="L195">        return this;</span>
    }

    /**
     * @return the privateData
     */
    public byte[] privateData() {
<span class="nc bnc" id="L202" title="All 2 branches missed.">        return privateData==null? null:Arrays.copyOf(privateData, privateData.length);</span>
    }

    /**
     * @param privateData the privateData to set
     */
    public ScfChromatogramBuilder privateData(byte[] privateData) {
<span class="nc bnc" id="L209" title="All 2 branches missed.">        this.privateData = privateData==null? null:Arrays.copyOf(privateData, privateData.length);</span>
<span class="nc" id="L210">        return this;</span>
    }

    public ScfChromatogram build() {
<span class="nc" id="L214">        Chromatogram basicChromo = basicBuilder.build();</span>
<span class="nc" id="L215">        return new SCFChromatogramImpl(basicChromo,</span>
<span class="nc" id="L216">                substitutionConfidence(),</span>
<span class="nc" id="L217">                insertionConfidence(),</span>
<span class="nc" id="L218">                deletionConfidence(),</span>
<span class="nc" id="L219">                createPrivateData());</span>
    }
   
    private PrivateData createPrivateData() {
<span class="nc bnc" id="L223" title="All 2 branches missed.">        if(privateData() ==null){</span>
<span class="nc" id="L224">            return null;</span>
        }
<span class="nc" id="L226">        return new PrivateDataImpl(privateData());</span>
    }

    public final PositionSequence peaks() {
<span class="nc" id="L230">        return basicBuilder.peaks();</span>
    }

    public ScfChromatogramBuilder peaks(short[] peaks) {
<span class="nc" id="L234">        basicBuilder.peaks(new PositionSequenceBuilder(peaks).build());</span>
<span class="nc" id="L235">        return this;</span>
    }

    public final NucleotideSequence basecalls() {
<span class="nc" id="L239">        return basicBuilder.basecalls();</span>
    }

    public ScfChromatogramBuilder basecalls(NucleotideSequence basecalls) {
<span class="nc" id="L243">        basicBuilder.basecalls(basecalls);</span>
<span class="nc" id="L244">        return this;</span>
    }

    public final byte[] aConfidence() {
<span class="nc" id="L248">        return basicBuilder.aConfidence();</span>
    }

    public final ScfChromatogramBuilder aConfidence(byte[] confidence) {
<span class="nc" id="L252">        basicBuilder.aConfidence(confidence);</span>
<span class="nc" id="L253">        return this;</span>
    }

    public final byte[] cConfidence() {
<span class="nc" id="L257">        return basicBuilder.cConfidence();</span>
    }

    public final ScfChromatogramBuilder cConfidence(byte[] confidence) {
<span class="nc" id="L261">        basicBuilder.cConfidence(confidence);</span>
<span class="nc" id="L262">        return this;</span>
    }

    public final byte[] gConfidence() {
<span class="nc" id="L266">        return basicBuilder.gConfidence();</span>
    }

    public final ScfChromatogramBuilder gConfidence(byte[] confidence) {
<span class="nc" id="L270">        basicBuilder.gConfidence(confidence);</span>
<span class="nc" id="L271">        return this;</span>
    }

    public final byte[] tConfidence() {
<span class="nc" id="L275">        return basicBuilder.tConfidence();</span>
    }

    public final ScfChromatogramBuilder tConfidence(byte[] confidence) {
<span class="nc" id="L279">        basicBuilder.tConfidence(confidence);</span>
<span class="nc" id="L280">        return this;</span>
    }

    public final short[] aPositions() {
<span class="nc" id="L284">        return basicBuilder.aPositions();</span>
    }

    public final ScfChromatogramBuilder aPositions(short[] positions) {
<span class="nc" id="L288">        basicBuilder.aPositions(positions);</span>
<span class="nc" id="L289">        return this;</span>
    }

    public final short[] cPositions() {
<span class="nc" id="L293">        return basicBuilder.cPositions();</span>
    }

    public final ScfChromatogramBuilder cPositions(short[] positions) {
<span class="nc" id="L297">        basicBuilder.cPositions(positions);</span>
<span class="nc" id="L298">        return this;</span>
    }

    public final short[] gPositions() {
<span class="nc" id="L302">        return basicBuilder.gPositions();</span>
    }

    public final ScfChromatogramBuilder gPositions(short[] positions) {
<span class="nc" id="L306">        basicBuilder.gPositions(positions);</span>
<span class="nc" id="L307">        return this;</span>
    }

    public final short[] tPositions() {
<span class="nc" id="L311">        return basicBuilder.tPositions();</span>
    }

    public final ScfChromatogramBuilder tPositions(short[] positions) {
<span class="nc" id="L315">        basicBuilder.tPositions(positions);</span>
<span class="nc" id="L316">        return this;</span>
    }

    public final Map&lt;String,String&gt; properties() {
<span class="nc" id="L320">        return basicBuilder.properties();</span>
    }

    public final ScfChromatogramBuilder properties(Map&lt;String,String&gt; properties) {
<span class="nc" id="L324">        basicBuilder.properties(properties);</span>
<span class="nc" id="L325">        return this;</span>
    }

    /**
     * {@code SCFChromatogramFileBuilderVisitor} is a helper class
     * that wraps a {@link ScfChromatogramBuilder} by a {@link ScfChromatogramFileVisitor}.
     * This way when a part of the SCF is visited, its corresponding objects get built 
     * by the builder.
     * @author dkatzel
     *
     *
     */
    private static final class SCFChromatogramFileBuilderVisitor implements ScfChromatogramFileVisitor{
        private final ScfChromatogramBuilder builder;
<span class="nc" id="L339">        private SCFChromatogramFileBuilderVisitor(ScfChromatogramBuilder builder){</span>
<span class="nc" id="L340">        	this.builder = builder;</span>
<span class="nc" id="L341">        }</span>
        
        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitAConfidence(byte[] confidence) {
<span class="nc" id="L348">            builder.aConfidence(confidence);            </span>
<span class="nc" id="L349">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitCConfidence(byte[] confidence) {
<span class="nc" id="L356">            builder.cConfidence(confidence);            </span>
<span class="nc" id="L357">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitGConfidence(byte[] confidence) {
<span class="nc" id="L364">            builder.gConfidence(confidence);            </span>
<span class="nc" id="L365">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitTConfidence(byte[] confidence) {
<span class="nc" id="L372">            builder.tConfidence(confidence);            </span>
<span class="nc" id="L373">        }</span>
        
        /**
         * {@inheritDoc}
         */
         @Override
         public synchronized void visitNewTrace() { 
       	  	//no-op
<span class="nc" id="L381">         }</span>
         /**
         * {@inheritDoc}
         */
         @Override
         public synchronized void visitEndOfTrace() { 
       	  	//no-op
<span class="nc" id="L388">         }</span>


          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitBasecalls(NucleotideSequence basecalls) {  
<span class="nc" id="L396">              builder.basecalls(basecalls);              </span>
<span class="nc" id="L397">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitPeaks(short[] peaks) {  
<span class="nc" id="L404">              builder.peaks(peaks);              </span>
<span class="nc" id="L405">          }</span>

         

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitComments(Map&lt;String,String&gt; comments) {  
<span class="nc" id="L414">              builder.properties(comments);              </span>
<span class="nc" id="L415">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitAPositions(short[] positions) {  
<span class="nc" id="L422">              builder.aPositions(positions);              </span>
<span class="nc" id="L423">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitCPositions(short[] positions) {  
<span class="nc" id="L430">             builder.cPositions(positions);              </span>
<span class="nc" id="L431">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitGPositions(short[] positions) {  
<span class="nc" id="L438">              builder.gPositions(positions);              </span>
<span class="nc" id="L439">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public synchronized void visitTPositions(short[] positions) {  
<span class="nc" id="L446">              builder.tPositions(positions);              </span>
<span class="nc" id="L447">          }</span>

      
       

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitPrivateData(byte[] privateData) {
<span class="nc" id="L457">            builder.privateData(privateData);             </span>
<span class="nc" id="L458">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitSubstitutionConfidence(byte[] confidence) {
<span class="nc" id="L465">            builder.substitutionConfidence(confidence);             </span>
<span class="nc" id="L466">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitInsertionConfidence(byte[] confidence) {
<span class="nc" id="L473">            builder.insertionConfidence(confidence);</span>
<span class="nc" id="L474">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public synchronized void visitDeletionConfidence(byte[] confidence) {
<span class="nc" id="L481">            builder.deletionConfidence(confidence);</span>
<span class="nc" id="L482">        }</span>

        
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>