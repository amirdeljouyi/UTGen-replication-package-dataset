<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ZtrChromatogramBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">92_jcvi-javacommon</a> &gt; <a href="index.source.html" class="el_package">org.jcvi.jillion.trace.chromat.ztr</a> &gt; <span class="el_source">ZtrChromatogramBuilder.java</span></div><h1>ZtrChromatogramBuilder.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyright (c) 2013 J. Craig Venter Institute.
 * 	This file is part of Jillion
 * 
 * 	 Jillion is free software: you can redistribute it and/or modify
 * 	it under the terms of the GNU General Public License as published by
 * 	the Free Software Foundation, either version 3 of the License, or
 * 	(at your option) any later version.
 * 	
 * 	 Jillion is distributed in the hope that it will be useful,
 * 	but WITHOUT ANY WARRANTY; without even the implied warranty of
 * 	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * 	GNU General Public License for more details.
 * 	
 * 	You should have received a copy of the GNU General Public License
 * 	along with  Jillion.  If not, see http://www.gnu.org/licenses
 * 
 * Contributors:
 *     Danny Katzel - initial API and implementation
 ******************************************************************************/
/*
 * Created on Dec 29, 2008
 *
 * @author dkatzel
 */
package org.jcvi.jillion.trace.chromat.ztr;


import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.util.Map;

import org.jcvi.jillion.core.Range;
import org.jcvi.jillion.core.pos.PositionSequence;
import org.jcvi.jillion.core.pos.PositionSequenceBuilder;
import org.jcvi.jillion.core.residue.nt.NucleotideSequence;
import org.jcvi.jillion.core.util.Builder;
import org.jcvi.jillion.internal.trace.chromat.BasicChromatogramBuilder;
import org.jcvi.jillion.internal.trace.chromat.ztr.ZTRChromatogramImpl;
import org.jcvi.jillion.trace.chromat.Chromatogram;

/**
 * &lt;code&gt;ZtrChromatogramBuilder&lt;/code&gt; uses the Builder Pattern
 * to build a {@link ZtrChromatogram} instance.
 * @author dkatzel
 *
 *
 */
public final class ZtrChromatogramBuilder implements Builder&lt;ZtrChromatogram&gt;{
    
    /**
     * Hints for valid range of this sequence.
     */
    private Range clip;

    private final BasicChromatogramBuilder basicBuilder;
    
    /**
     * Create a new {@link ZtrChromatogramBuilder} instance with
     * all fields except for the id unset.  In order
     * to successfully build a valid {@link ZtrChromatogram}
     * object please use
     * the various setter methods
     * in this class to set everything
     * before calling {@link #build()}.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null.
     * @throws NullPointerException if either field is null.
     */
<span class="nc" id="L71">    public ZtrChromatogramBuilder(String id){</span>
<span class="nc" id="L72">        basicBuilder = new BasicChromatogramBuilder(id);</span>
<span class="nc" id="L73">    }</span>
    /**
     * Create a new {@link ZtrChromatogramBuilder} instance
     * with the given id and all fields initially set
     * to the the values encoded in the given ztr file.
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param ztrFile a ZTR encoded file that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or if
     * the given file is not a valid ztr encoded file.
     * @throws NullPointerException if either field is null.
     */
    public ZtrChromatogramBuilder(String id, File ztrFile) throws IOException{
<span class="nc" id="L87">        this(id);</span>
<span class="nc" id="L88">        ZTRChromatogramFileBuilderVisitor visitor = new ZTRChromatogramFileBuilderVisitor(this);</span>
<span class="nc" id="L89">        ZtrChromatogramFileParser.parse(ztrFile, visitor); </span>
<span class="nc" id="L90">    }</span>
    /**
     * Create a new {@link ZtrChromatogramBuilder} instance
     * with the given id and all fields initially set
     * to the the values encoded in the given ztr encoded inputStream.
     * The {@link InputStream} will NOT be closed by this constructor,
     * client code must close the stream themselves after returning 
     * from this method (preferably in a finally block).
     * @param id the id for this {@link Chromatogram} object to have;
     * can not be null. 
     * @param ztrStream a ZTR encoded {@link InputStream} that contains the initial values
     * that this builder should have; can not be null.
     * @throws IOException if there is a problem reading the file or
     * if the {@link InputStream} does not contain valid ztr encoded data.
     * @throws NullPointerException if either field is null.
     */
    public ZtrChromatogramBuilder(String id, InputStream ztrStream) throws IOException{
<span class="nc" id="L107">        this(id);</span>
<span class="nc" id="L108">        ZTRChromatogramFileBuilderVisitor visitor = new ZTRChromatogramFileBuilderVisitor(this);</span>
<span class="nc" id="L109">        ZtrChromatogramFileParser.parse(ztrStream, visitor); </span>
<span class="nc" id="L110">    }</span>
    /**
     * Create a new instance of {@link ZtrChromatogramBuilder}
     * using the given {@link Chromatogram} instance 
     * to set all the initial fields. Only the fields 
     * in the {@link Chromatogram} interface will be copied,
     * any ztr specific fields will be null.  Use the various
     * ztr specific setter methods to set those values.
     * @param copy a {@link Chromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
<span class="nc" id="L123">    public ZtrChromatogramBuilder(Chromatogram copy){</span>
<span class="nc" id="L124">       basicBuilder = new BasicChromatogramBuilder(copy);        </span>
<span class="nc" id="L125">    }</span>
    /**
     * Create a new instance of ZtrChromatogramBuilder
     * using the given {@link ZtrChromatogram} instance 
     * to set all the initial fields. All the fields 
     * in the {@link ZtrChromatogram} interface including
     * ztr specific fields will be copied.
     * @param copy a {@link ZtrChromatogram} object
     * whose fields are used as the initial values of this
     * new Builder; can not be null;
     * @throws NullPointerException if copy is null.
     */
    public ZtrChromatogramBuilder(ZtrChromatogram copy){
<span class="nc" id="L138">        this((Chromatogram)copy);</span>
<span class="nc" id="L139">        clip(copy.getClip());</span>
<span class="nc" id="L140">     }</span>
   /**
    * Gets the ZTR's clip points..
    * @return a Clip, may be null.
    */
    public final Range clip() {
<span class="nc" id="L146">        return clip;</span>
    }
    /**
     * Sets the clip.
     * @param clip the clip to set.
     * @return this.
     */
    public final ZtrChromatogramBuilder clip(Range clip) {
<span class="nc" id="L154">        this.clip = clip;</span>
<span class="nc" id="L155">        return this;</span>
    }
    /**
     * 
    * {@inheritDoc}
     */
    @Override
    public ZtrChromatogram build() {
<span class="nc" id="L163">        return new ZTRChromatogramImpl(basicBuilder.build(),</span>
<span class="nc" id="L164">                clip());</span>
    }
    
    public final PositionSequence peaks() {
<span class="nc" id="L168">        return basicBuilder.peaks();</span>
    }

    public ZtrChromatogramBuilder peaks(short[] peaks) {
<span class="nc" id="L172">        basicBuilder.peaks(new PositionSequenceBuilder(peaks).build());</span>
<span class="nc" id="L173">        return this;</span>
    }

    public final NucleotideSequence basecalls() {
<span class="nc" id="L177">        return basicBuilder.basecalls();</span>
    }

    public ZtrChromatogramBuilder basecalls(NucleotideSequence basecalls) {
<span class="nc" id="L181">        basicBuilder.basecalls(basecalls);</span>
<span class="nc" id="L182">        return this;</span>
    }

    public final byte[] aConfidence() {
<span class="nc" id="L186">        return basicBuilder.aConfidence();</span>
    }

    public final ZtrChromatogramBuilder aConfidence(byte[] confidence) {
<span class="nc" id="L190">        basicBuilder.aConfidence(confidence);</span>
<span class="nc" id="L191">        return this;</span>
    }

    public final byte[] cConfidence() {
<span class="nc" id="L195">        return basicBuilder.cConfidence();</span>
    }

    public final ZtrChromatogramBuilder cConfidence(byte[] confidence) {
<span class="nc" id="L199">        basicBuilder.cConfidence(confidence);</span>
<span class="nc" id="L200">        return this;</span>
    }

    public final byte[] gConfidence() {
<span class="nc" id="L204">        return basicBuilder.gConfidence();</span>
    }

    public final ZtrChromatogramBuilder gConfidence(byte[] confidence) {
<span class="nc" id="L208">        basicBuilder.gConfidence(confidence);</span>
<span class="nc" id="L209">        return this;</span>
    }

    public final byte[] tConfidence() {
<span class="nc" id="L213">        return basicBuilder.tConfidence();</span>
    }

    public final ZtrChromatogramBuilder tConfidence(byte[] confidence) {
<span class="nc" id="L217">        basicBuilder.tConfidence(confidence);</span>
<span class="nc" id="L218">        return this;</span>
    }

    public final short[] aPositions() {
<span class="nc" id="L222">        return basicBuilder.aPositions();</span>
    }

    public final ZtrChromatogramBuilder aPositions(short[] positions) {
<span class="nc" id="L226">        basicBuilder.aPositions(positions);</span>
<span class="nc" id="L227">        return this;</span>
    }

    public final short[] cPositions() {
<span class="nc" id="L231">        return basicBuilder.cPositions();</span>
    }

    public final ZtrChromatogramBuilder cPositions(short[] positions) {
<span class="nc" id="L235">        basicBuilder.cPositions(positions);</span>
<span class="nc" id="L236">        return this;</span>
    }

    public final short[] gPositions() {
<span class="nc" id="L240">        return basicBuilder.gPositions();</span>
    }

    public final ZtrChromatogramBuilder gPositions(short[] positions) {
<span class="nc" id="L244">        basicBuilder.gPositions(positions);</span>
<span class="nc" id="L245">        return this;</span>
    }

    public final short[] tPositions() {
<span class="nc" id="L249">        return basicBuilder.tPositions();</span>
    }

    public final ZtrChromatogramBuilder tPositions(short[] positions) {
<span class="nc" id="L253">        basicBuilder.tPositions(positions);</span>
<span class="nc" id="L254">        return this;</span>
    }

    public final Map&lt;String,String&gt; properties() {
<span class="nc" id="L258">        return basicBuilder.properties();</span>
    }

    public final ZtrChromatogramBuilder properties(Map&lt;String,String&gt; properties) {
<span class="nc" id="L262">        basicBuilder.properties(properties);</span>
<span class="nc" id="L263">        return this;</span>
    }
    
    /**
     * {@code ZTRChromatogramFileBuilderVisitor} is a helper class
     * that wraps a {@link ZtrChromatogramBuilder} by a {@link ZtrChromatogramFileVisitor}.
     * This way when a part of the ZTR is visited, its corresponding objects get built 
     * by the builder.
     * @author dkatzel
     *
     *
     */
    private static final class ZTRChromatogramFileBuilderVisitor implements ZtrChromatogramFileVisitor{
        private final ZtrChromatogramBuilder builder ;
        
<span class="nc" id="L278">        private ZTRChromatogramFileBuilderVisitor(ZtrChromatogramBuilder builder){</span>
<span class="nc" id="L279">        	this.builder = builder;</span>
<span class="nc" id="L280">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public void visitAConfidence(byte[] confidence) {
<span class="nc" id="L287">            builder.aConfidence(confidence);            </span>
<span class="nc" id="L288">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public void visitCConfidence(byte[] confidence) {

<span class="nc" id="L296">            builder.cConfidence(confidence);            </span>
<span class="nc" id="L297">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public void visitGConfidence(byte[] confidence) {

<span class="nc" id="L305">            builder.gConfidence(confidence);            </span>
<span class="nc" id="L306">        }</span>

        /**
        * {@inheritDoc}
        */
        @Override
        public void visitTConfidence(byte[] confidence) {

<span class="nc" id="L314">            builder.tConfidence(confidence);            </span>
<span class="nc" id="L315">        }</span>
        
        /**
         * {@inheritDoc}
         */
         @Override
         public void visitNewTrace() {
        	 //no-op
<span class="nc" id="L323">         }</span>
         /**
         * {@inheritDoc}
         */
         @Override
         public void visitEndOfTrace() {
        	 //no-op
<span class="nc" id="L330">         }</span>


          /**
          * {@inheritDoc}
          */
          @Override
          public void visitBasecalls(NucleotideSequence basecalls) {
  
<span class="nc" id="L339">              builder.basecalls(basecalls);              </span>
<span class="nc" id="L340">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitPeaks(short[] peaks) {
  
<span class="nc" id="L348">              builder.peaks(peaks);              </span>
<span class="nc" id="L349">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitClipRange(Range clipRange) {
  
<span class="nc" id="L357">              builder.clip(clipRange);              </span>
<span class="nc" id="L358">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitComments(Map&lt;String,String&gt; comments) {
  
<span class="nc" id="L366">              builder.properties(comments);              </span>
<span class="nc" id="L367">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitAPositions(short[] positions) {
  
<span class="nc" id="L375">              builder.aPositions(positions);              </span>
<span class="nc" id="L376">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitCPositions(short[] positions) {
  
<span class="nc" id="L384">             builder.cPositions(positions);              </span>
<span class="nc" id="L385">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitGPositions(short[] positions) {
  
<span class="nc" id="L393">              builder.gPositions(positions);              </span>
<span class="nc" id="L394">          }</span>

          /**
          * {@inheritDoc}
          */
          @Override
          public void visitTPositions(short[] positions) {
  
<span class="nc" id="L402">              builder.tPositions(positions);              </span>
<span class="nc" id="L403">          }</span>


    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>